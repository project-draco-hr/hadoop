{
  if (envString != null && envString.length() > 0) {
    String childEnvs[]=envString.split(",");
    Pattern p=Pattern.compile(Shell.getEnvironmentVariableRegex());
    for (    String cEnv : childEnvs) {
      String[] parts=cEnv.split("=");
      Matcher m=p.matcher(parts[1]);
      StringBuffer sb=new StringBuffer();
      while (m.find()) {
        String var=m.group(1);
        String replace=env.get(var);
        if (replace == null)         replace=System.getenv(var);
        if (replace == null)         replace="";
        m.appendReplacement(sb,Matcher.quoteReplacement(replace));
      }
      m.appendTail(sb);
      addToEnvironment(env,parts[0],sb.toString(),classPathSeparator);
    }
  }
}
