{
  Configuration conf=new Configuration();
  conf.setInt(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,DFSConfigKeys.DFS_BYTES_PER_CHECKSUM_DEFAULT);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  cluster.waitActive();
  FSNamesystem fsn=cluster.getNamesystem();
  long lastId=fsn.getLastInodeId();
  assertTrue(lastId == 1001);
  FileSystem fs=cluster.getFileSystem();
  Path path=new Path("/test1");
  assertTrue(fs.mkdirs(path));
  assertTrue(fsn.getLastInodeId() == 1002);
  Path filePath=new Path("/test1/file");
  fs.create(filePath);
  assertTrue(fsn.getLastInodeId() == 1003);
  Path renamedPath=new Path("/test2");
  fs.rename(path,renamedPath);
  assertTrue(fsn.getLastInodeId() == 1003);
  cluster.restartNameNode();
  cluster.waitActive();
  cluster.restartNameNode();
  cluster.waitActive();
  assertTrue(fsn.getLastInodeId() == 1003);
}
