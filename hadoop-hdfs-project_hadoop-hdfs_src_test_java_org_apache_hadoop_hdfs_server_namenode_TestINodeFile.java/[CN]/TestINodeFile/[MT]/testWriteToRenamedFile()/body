{
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  cluster.waitActive();
  FileSystem fs=cluster.getFileSystem();
  Path path=new Path("/test1");
  assertTrue(fs.mkdirs(path));
  int size=conf.getInt(DFSConfigKeys.DFS_BYTES_PER_CHECKSUM_KEY,512);
  byte[] data=new byte[size];
  Path filePath=new Path("/test1/file");
  FSDataOutputStream fos=fs.create(filePath);
  Path renamedPath=new Path("/test2");
  fs.rename(path,renamedPath);
  fs.create(filePath,(short)1);
  try {
    fos.write(data,0,data.length);
    fos.hflush();
    fail("Write should fail after rename");
  }
 catch (  Exception e) {
  }
 finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
