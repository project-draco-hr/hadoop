{
  Set<Principal> principals=new HashSet<Principal>();
  principals.add(new KerberosPrincipal(user));
  Subject subject=new Subject(false,principals,new HashSet<Object>(),new HashSet<Object>());
  LoginContext loginContext=new LoginContext("",subject,null,KerberosConfiguration.createClientConfig(user,keytab));
  try {
    loginContext.login();
    subject=loginContext.getSubject();
    UserGroupInformation ugi=UserGroupInformation.getUGIFromSubject(subject);
    return ugi.doAs(action);
  }
  finally {
    loginContext.logout();
  }
}
