{
  CacheManagerSection s=CacheManagerSection.parseDelimitedFrom(in);
  int numPools=s.getNumPools();
  ArrayList<CachePoolInfoProto> pools=Lists.newArrayListWithCapacity(numPools);
  ArrayList<CacheDirectiveInfoProto> directives=Lists.newArrayListWithCapacity(s.getNumDirectives());
  prog.setTotal(Phase.LOADING_FSIMAGE,currentStep,numPools);
  Counter counter=prog.getCounter(Phase.LOADING_FSIMAGE,currentStep);
  for (int i=0; i < numPools; ++i) {
    pools.add(CachePoolInfoProto.parseDelimitedFrom(in));
    counter.increment();
  }
  for (int i=0; i < s.getNumDirectives(); ++i)   directives.add(CacheDirectiveInfoProto.parseDelimitedFrom(in));
  fsn.getCacheManager().loadState(new CacheManager.PersistState(s,pools,directives));
}
