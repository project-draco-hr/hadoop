{
  final INodeFileWithLink srcWithLink;
  if (file instanceof INodeFileWithLink) {
    srcWithLink=(INodeFileWithLink)file;
  }
 else {
    srcWithLink=new INodeFileWithLink(file);
    file.removeNode();
    parent.addChild(srcWithLink,false);
    namesystem.getBlockManager().addBlockCollection(srcWithLink);
  }
  final INodeFileSnapshot snapshot=new INodeFileSnapshot(srcWithLink);
  srcWithLink.insert(snapshot);
  return snapshot;
}
