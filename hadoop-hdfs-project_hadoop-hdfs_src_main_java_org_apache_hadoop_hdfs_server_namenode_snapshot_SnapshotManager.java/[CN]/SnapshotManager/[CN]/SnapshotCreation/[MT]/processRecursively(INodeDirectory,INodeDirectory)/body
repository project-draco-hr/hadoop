{
  final ReadOnlyList<INode> children=srcDir.getChildrenList(null);
  if (!children.isEmpty()) {
    final List<INode> inodes=new ArrayList<INode>(children.size());
    for (    final INode c : new ArrayList<INode>(ReadOnlyList.Util.asList(children))) {
      final INode i;
      if (c == null) {
        i=null;
      }
 else       if (c instanceof INodeDirectory) {
        i=processINodeDirectory((INodeDirectory)c);
      }
 else       if (c instanceof INodeFileUnderConstruction) {
        throw new IOException("Not yet supported.");
      }
 else       if (c instanceof INodeFile) {
        i=processINodeFile(srcDir,(INodeFile)c);
      }
 else       if (c instanceof INodeSymlink) {
        i=new INodeSymlink((INodeSymlink)c);
      }
 else {
        throw new AssertionError("Unknow INode type: " + c.getClass() + ", inode = "+ c);
      }
      i.setParent(dstDir);
      inodes.add(i);
    }
    dstDir.setChildren(inodes);
  }
}
