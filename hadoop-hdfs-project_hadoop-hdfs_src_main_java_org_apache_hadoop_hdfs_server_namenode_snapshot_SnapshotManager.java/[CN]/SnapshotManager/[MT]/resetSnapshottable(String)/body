{
  final INodesInPath iip=fsdir.getINodesInPath4Write(path);
  final INodeDirectorySnapshottable s=INodeDirectorySnapshottable.valueOf(iip.getLastINode(),path);
  if (s.getNumSnapshots() > 0) {
    throw new SnapshotException("The directory " + path + " has snapshot(s). "+ "Please redo the operation after removing all the snapshots.");
  }
  if (s == fsdir.getRoot()) {
    if (s.getSnapshotQuota() == 0) {
      throw new SnapshotException("Root is not a snapshottable directory");
    }
    s.setSnapshotQuota(0);
  }
 else {
    s.replaceSelf(iip.getLatestSnapshot(),fsdir.getINodeMap());
  }
  removeSnapshottable(s);
}
