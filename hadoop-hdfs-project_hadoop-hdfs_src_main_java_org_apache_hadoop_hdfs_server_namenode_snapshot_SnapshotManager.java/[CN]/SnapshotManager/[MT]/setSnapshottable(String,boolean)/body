{
  final INodesInPath iip=fsdir.getINodesInPath4Write(path);
  final INodeDirectory d=INodeDirectory.valueOf(iip.getLastINode(),path);
  if (checkNestedSnapshottable) {
    checkNestedSnapshottable(d,path);
  }
  final INodeDirectorySnapshottable s;
  if (d.isSnapshottable()) {
    s=(INodeDirectorySnapshottable)d;
    s.setSnapshotQuota(INodeDirectorySnapshottable.SNAPSHOT_LIMIT);
  }
 else {
    s=d.replaceSelf4INodeDirectorySnapshottable(iip.getLatestSnapshotId(),fsdir.getINodeMap());
  }
  addSnapshottable(s);
}
