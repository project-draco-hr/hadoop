{
  HttpServer server=createServer(host,port);
  try {
    InetSocketAddress addr=server.getListenerAddress();
    assertEquals(port,addr.getPort());
    server.openListener();
    addr=server.getListenerAddress();
    assertEquals(host,addr.getHostName());
    int boundPort=addr.getPort();
    if (port == 0) {
      assertTrue(boundPort != 0);
    }
 else     if (findPort) {
      assertTrue(boundPort > port);
      assertTrue(addr.getPort() - port < 8);
    }
  }
 catch (  Exception e) {
    server.stop();
    throw e;
  }
  return server;
}
