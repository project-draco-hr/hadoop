{
  namesystem=fsn;
  datanodeManager=new DatanodeManager(fsn);
  blocksMap=new BlocksMap(DEFAULT_MAP_LOAD_FACTOR);
  replicator=BlockPlacementPolicy.getInstance(conf,namesystem,datanodeManager.getNetworkTopology());
  pendingReplications=new PendingReplicationBlocks(conf.getInt(DFSConfigKeys.DFS_NAMENODE_REPLICATION_PENDING_TIMEOUT_SEC_KEY,DFSConfigKeys.DFS_NAMENODE_REPLICATION_PENDING_TIMEOUT_SEC_DEFAULT) * 1000L);
  this.maxCorruptFilesReturned=conf.getInt(DFSConfigKeys.DFS_DEFAULT_MAX_CORRUPT_FILES_RETURNED_KEY,DFSConfigKeys.DFS_DEFAULT_MAX_CORRUPT_FILES_RETURNED);
  this.defaultReplication=conf.getInt(DFSConfigKeys.DFS_REPLICATION_KEY,DFSConfigKeys.DFS_REPLICATION_DEFAULT);
  this.maxReplication=conf.getInt(DFSConfigKeys.DFS_REPLICATION_MAX_KEY,DFSConfigKeys.DFS_REPLICATION_MAX_DEFAULT);
  this.minReplication=conf.getInt(DFSConfigKeys.DFS_NAMENODE_REPLICATION_MIN_KEY,DFSConfigKeys.DFS_NAMENODE_REPLICATION_MIN_DEFAULT);
  if (minReplication <= 0)   throw new IOException("Unexpected configuration parameters: dfs.namenode.replication.min = " + minReplication + " must be greater than 0");
  if (maxReplication >= (int)Short.MAX_VALUE)   throw new IOException("Unexpected configuration parameters: dfs.replication.max = " + maxReplication + " must be less than "+ (Short.MAX_VALUE));
  if (maxReplication < minReplication)   throw new IOException("Unexpected configuration parameters: dfs.namenode.replication.min = " + minReplication + " must be less than dfs.replication.max = "+ maxReplication);
  this.maxReplicationStreams=conf.getInt(DFSConfigKeys.DFS_NAMENODE_REPLICATION_MAX_STREAMS_KEY,DFSConfigKeys.DFS_NAMENODE_REPLICATION_MAX_STREAMS_DEFAULT);
  this.shouldCheckForEnoughRacks=conf.get(DFSConfigKeys.NET_TOPOLOGY_SCRIPT_FILE_NAME_KEY) == null ? false : true;
  FSNamesystem.LOG.info("defaultReplication = " + defaultReplication);
  FSNamesystem.LOG.info("maxReplication = " + maxReplication);
  FSNamesystem.LOG.info("minReplication = " + minReplication);
  FSNamesystem.LOG.info("maxReplicationStreams = " + maxReplicationStreams);
  FSNamesystem.LOG.info("shouldCheckForEnoughRacks = " + shouldCheckForEnoughRacks);
}
