{
  HdfsConfiguration conf=new HdfsConfiguration();
  if (socketDir == null) {
    conf.set(DFSConfigKeys.DFS_DOMAIN_SOCKET_PATH_KEY,"");
  }
 else {
    conf.set(DFSConfigKeys.DFS_DOMAIN_SOCKET_PATH_KEY,new File(socketDir.getDir(),"TestBlockReaderLocalLegacy.%d.sock").getAbsolutePath());
  }
  conf.setBoolean(DFSConfigKeys.DFS_CLIENT_READ_SHORTCIRCUIT_KEY,true);
  conf.setBoolean(DFSConfigKeys.DFS_CLIENT_USE_LEGACY_BLOCKREADERLOCAL,true);
  conf.setBoolean(DFSConfigKeys.DFS_CLIENT_READ_SHORTCIRCUIT_SKIP_CHECKSUM_KEY,false);
  conf.set(DFSConfigKeys.DFS_BLOCK_LOCAL_PATH_ACCESS_USER_KEY,UserGroupInformation.getCurrentUser().getShortUserName());
  conf.setBoolean(DFSConfigKeys.DFS_CLIENT_DOMAIN_SOCKET_DATA_TRAFFIC,false);
  conf.setInt(HdfsClientConfigKeys.Retry.WINDOW_BASE_KEY,10);
  return conf;
}
