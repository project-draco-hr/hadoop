{
  readLock.lock();
  try {
    Map<ReservationInterval,Resource> allocations=new TreeMap<ReservationInterval,Resource>();
    if (isEmpty()) {
      return allocations;
    }
    Map.Entry<Long,Resource> lastEntry=null;
    for (    Map.Entry<Long,Resource> entry : cumulativeCapacity.entrySet()) {
      if (lastEntry != null && entry.getValue() != null) {
        ReservationInterval interval=new ReservationInterval(lastEntry.getKey(),entry.getKey());
        Resource resource=lastEntry.getValue();
        allocations.put(interval,resource);
      }
      lastEntry=entry;
    }
    return allocations;
  }
  finally {
    readLock.unlock();
  }
}
