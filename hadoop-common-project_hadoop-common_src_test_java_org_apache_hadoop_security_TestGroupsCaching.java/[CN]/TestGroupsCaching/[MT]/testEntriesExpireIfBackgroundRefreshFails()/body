{
  conf.setLong(CommonConfigurationKeys.HADOOP_SECURITY_GROUPS_CACHE_SECS,1);
  conf.setBoolean(CommonConfigurationKeys.HADOOP_SECURITY_GROUPS_CACHE_BACKGROUND_RELOAD,true);
  FakeTimer timer=new FakeTimer();
  final Groups groups=new Groups(conf,timer);
  groups.cacheGroupsAdd(Arrays.asList(myGroups));
  groups.refresh();
  FakeGroupMapping.clearBlackList();
  groups.getGroups("me");
  FakeGroupMapping.setThrowException(true);
  for (int i=0; i < 9; i++) {
    assertEquals(groups.getGroups("me").size(),2);
    timer.advance(1 * 1000);
  }
  timer.advance(2 * 1000);
  try {
    groups.getGroups("me");
    fail("Should have thrown an exception here");
  }
 catch (  Exception e) {
  }
  FakeGroupMapping.setThrowException(false);
  assertEquals(groups.getGroups("me").size(),2);
}
