{
  NodeManager nm=new TestNodeManager1();
  YarnConfiguration conf=createNMConfig();
  nm.init(conf);
  nm.start();
  ContainerId cId=TestNodeManagerShutdown.createContainerId();
  TestNodeManagerShutdown.startContainer(nm,cId,localFS,tmpDir,processStartFile);
  Assert.assertEquals(1,((TestNodeManager1)nm).getNMRegistrationCount());
  nm.getNMDispatcher().getEventHandler().handle(new NodeManagerEvent(NodeManagerEventType.RESYNC));
  try {
    syncBarrier.await();
  }
 catch (  BrokenBarrierException e) {
  }
  Assert.assertEquals(2,((TestNodeManager1)nm).getNMRegistrationCount());
  Assert.assertTrue(nm.getNMContext().getApplications().containsKey(cId.getApplicationAttemptId().getApplicationId()));
  Assert.assertFalse(assertionFailedInThread.get());
  nm.stop();
}
