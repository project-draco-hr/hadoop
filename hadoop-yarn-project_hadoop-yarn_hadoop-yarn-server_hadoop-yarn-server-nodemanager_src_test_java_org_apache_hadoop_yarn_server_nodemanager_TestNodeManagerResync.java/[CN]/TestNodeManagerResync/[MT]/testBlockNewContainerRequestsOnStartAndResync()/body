{
  NodeManager nm=new TestNodeManager2();
  int port=ServerSocketUtil.getPort(49154,10);
  YarnConfiguration conf=createNMConfig(port);
  conf.setBoolean(YarnConfiguration.RM_WORK_PRESERVING_RECOVERY_ENABLED,false);
  nm.init(conf);
  nm.start();
  ContainerId cId=TestNodeManagerShutdown.createContainerId();
  TestNodeManagerShutdown.startContainer(nm,cId,localFS,tmpDir,processStartFile,port);
  nm.getNMDispatcher().getEventHandler().handle(new NodeManagerEvent(NodeManagerEventType.RESYNC));
  try {
    syncBarrier.await();
  }
 catch (  BrokenBarrierException e) {
  }
  Assert.assertFalse(assertionFailedInThread.get());
  nm.stop();
}
