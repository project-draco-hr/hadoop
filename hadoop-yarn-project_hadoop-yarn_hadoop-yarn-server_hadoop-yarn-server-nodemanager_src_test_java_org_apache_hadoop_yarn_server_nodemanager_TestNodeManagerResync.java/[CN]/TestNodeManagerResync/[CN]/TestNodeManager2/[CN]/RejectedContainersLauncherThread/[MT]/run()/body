{
  int numContainers=0;
  int numContainersRejected=0;
  ContainerLaunchContext containerLaunchContext=recordFactory.newRecordInstance(ContainerLaunchContext.class);
  try {
    while (!isStopped && numContainers < 10) {
      ContainerId cId=TestNodeManagerShutdown.createContainerId();
      Container container=BuilderUtils.newContainer(cId,null,null,null,null,null,0);
      StartContainerRequest startRequest=recordFactory.newRecordInstance(StartContainerRequest.class);
      startRequest.setContainerLaunchContext(containerLaunchContext);
      startRequest.setContainer(container);
      System.out.println("no. of containers to be launched: " + numContainers);
      numContainers++;
      try {
        getContainerManager().startContainer(startRequest);
      }
 catch (      YarnRemoteException e) {
        numContainersRejected++;
        Assert.assertTrue(e.getMessage().contains("Rejecting new containers as NodeManager has not" + " yet connected with ResourceManager"));
        Assert.assertTrue(e.getMessage().contains(NMNotYetReadyException.class.getName()));
      }
catch (      IOException e) {
        assertionFailedInThread.set(true);
      }
    }
    Assert.assertEquals(numContainers,numContainersRejected);
  }
 catch (  AssertionError ae) {
    assertionFailedInThread.set(true);
  }
}
