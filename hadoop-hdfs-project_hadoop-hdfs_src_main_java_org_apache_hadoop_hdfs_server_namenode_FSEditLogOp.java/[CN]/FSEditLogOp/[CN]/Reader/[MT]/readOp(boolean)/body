{
  while (true) {
    try {
      limiter.setLimit(MAX_OP_SIZE);
      in.mark(MAX_OP_SIZE);
      return decodeOp();
    }
 catch (    GarbageAfterTerminatorException e) {
      in.reset();
      if (!skipBrokenEdits) {
        throw e;
      }
      long numSkip=e.getNumAfterTerminator();
      try {
        IOUtils.skipFully(in,numSkip);
      }
 catch (      IOException t) {
        FSImage.LOG.error("Failed to skip " + numSkip + " bytes of "+ "garbage after an OP_INVALID.  Unexpected early EOF.",t);
        return null;
      }
    }
catch (    IOException e) {
      in.reset();
      if (!skipBrokenEdits) {
        throw e;
      }
    }
catch (    RuntimeException e) {
      in.reset();
      if (!skipBrokenEdits) {
        throw e;
      }
    }
catch (    Throwable e) {
      in.reset();
      if (!skipBrokenEdits) {
        throw new IOException("got unexpected exception " + e.getMessage(),e);
      }
    }
    if (in.skip(1) < 1) {
      return null;
    }
  }
}
