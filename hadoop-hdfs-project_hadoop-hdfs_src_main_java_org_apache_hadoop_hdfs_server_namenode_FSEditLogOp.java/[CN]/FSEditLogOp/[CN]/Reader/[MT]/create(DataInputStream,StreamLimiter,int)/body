{
  if (logVersion < NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION) {
    return new LengthPrefixedReader(in,limiter,logVersion);
  }
 else   if (NameNodeLayoutVersion.supports(NameNodeLayoutVersion.Feature.EDITLOG_LENGTH,logVersion)) {
    return new LengthPrefixedReader(in,limiter,logVersion);
  }
 else   if (NameNodeLayoutVersion.supports(LayoutVersion.Feature.EDITS_CHECKSUM,logVersion)) {
    Checksum checksum=DataChecksum.newCrc32();
    return new ChecksummedReader(checksum,in,limiter,logVersion);
  }
 else {
    return new LegacyReader(in,limiter,logVersion);
  }
}
