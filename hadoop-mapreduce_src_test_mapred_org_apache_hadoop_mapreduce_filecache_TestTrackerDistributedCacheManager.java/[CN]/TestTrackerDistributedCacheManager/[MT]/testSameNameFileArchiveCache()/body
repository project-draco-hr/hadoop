{
  if (!canRun()) {
    return;
  }
  TrackerDistributedCacheManager manager=spy(new TrackerDistributedCacheManager(conf,taskController));
  URI rsrc=new URI("file://foo/bar/yak");
  Path cacheDir=new Path("file:///localcache");
  Path archivePath=new Path(cacheDir,"archive");
  Path filePath=new Path(cacheDir,"file");
  doReturn(archivePath).when(manager).localizeCache(eq(conf),eq(rsrc),anyLong(),Matchers.<CacheStatus>anyObject(),eq(true),anyBoolean());
  doReturn(filePath).when(manager).localizeCache(eq(conf),eq(rsrc),anyLong(),Matchers.<CacheStatus>anyObject(),eq(false),anyBoolean());
  doNothing().when(manager).checkCacheStatusValidity(Matchers.<Configuration>anyObject(),eq(rsrc),anyLong(),Matchers.<CacheStatus>anyObject(),Matchers.<FileStatus>anyObject(),anyBoolean());
  doReturn(-1L).when(manager).checkStampSinceJobStarted(Matchers.<Configuration>anyObject(),Matchers.<FileSystem>anyObject(),eq(rsrc),anyLong(),Matchers.<CacheStatus>anyObject(),Matchers.<FileStatus>anyObject());
  doReturn(-1L).when(manager).getTimestamp(Matchers.<Configuration>anyObject(),eq(rsrc));
  FileStatus rsrcStatus=mock(FileStatus.class);
  when(rsrcStatus.getLen()).thenReturn(4344L);
  Path localizedPathForFile=manager.getLocalCache(rsrc,conf,"sub",rsrcStatus,false,20L,new Path("file:///tmp"),false,true);
  Path localizedPathForArchive=manager.getLocalCache(rsrc,conf,"sub",rsrcStatus,true,20L,new Path("file:///tmp"),false,true);
  assertNotSame("File and Archive resolve to the same path: " + localizedPathForFile + ". Should differ.",localizedPathForFile,localizedPathForArchive);
}
