{
  renewer=(renewer == null) ? ugi.getShortUserName() : renewer;
  String user=ugi.getUserName();
  Text owner=new Text(user);
  Text realUser=null;
  if (ugi.getRealUser() != null) {
    realUser=new Text(ugi.getRealUser().getUserName());
  }
  TimelineDelegationTokenIdentifier tokenIdentifier=new TimelineDelegationTokenIdentifier(owner,new Text(renewer),realUser);
  Token<TimelineDelegationTokenIdentifier> token=new Token<TimelineDelegationTokenIdentifier>(tokenIdentifier,secretManager);
  SecurityUtil.setTokenService(token,serviceAddr);
  return token;
}
