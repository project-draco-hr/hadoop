{
  Server server=new TestServer(handlerCount,handlerSleep);
  server.start();
  InetSocketAddress address=NetUtils.getConnectAddress(server);
  Client[] clients=new Client[clientCount];
  for (int i=0; i < clientCount; i++) {
    clients[i]=new Client(BytesWritable.class,conf);
  }
  Caller[] callers=new Caller[callerCount];
  for (int i=0; i < callerCount; i++) {
    callers[i]=new Caller(clients[i % clientCount],address,callCount);
    callers[i].start();
  }
  for (int i=0; i < callerCount; i++) {
    callers[i].join();
    assertFalse(callers[i].failed);
  }
  for (int i=0; i < clientCount; i++) {
    clients[i].stop();
  }
  server.stop();
}
