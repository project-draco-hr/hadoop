{
  for (int i=0; i < 5; i++) {
    String src="/test-" + i;
    HdfsFileStatus fileStatus=namesystem.startFile(src,perm,clientMachine,clientMachine,EnumSet.of(CreateFlag.CREATE),true,REPLICATION_FACTOR,DEFAULT_BLOCK_SIZE,null,false);
    LocatedBlock locatedBlock=nameNodeRpc.addBlock(src,clientMachine,null,null,fileStatus.getFileId(),null,null);
    assertEquals("Block should be allocated sufficient locations",REPLICATION_FACTOR,locatedBlock.getLocations().length);
    if (clientRack != null) {
      if (hasBlockReplicaOnRack) {
        assertEquals("First datanode should be rack local",clientRack,locatedBlock.getLocations()[0].getNetworkLocation());
      }
 else {
        for (        DatanodeInfo dni : locatedBlock.getLocations()) {
          assertNotEquals(clientRack,dni.getNetworkLocation());
        }
      }
    }
    nameNodeRpc.abandonBlock(locatedBlock.getBlock(),fileStatus.getFileId(),src,clientMachine);
  }
}
