{
  for (int i=0; i < 5; i++) {
    String src="/test-" + i;
    HdfsFileStatus fileStatus=namesystem.startFile(src,perm,clientMachine,clientMachine,EnumSet.of(CreateFlag.CREATE),true,REPLICATION_FACTOR,DEFAULT_BLOCK_SIZE,null);
    LocatedBlock locatedBlock=nameNodeRpc.addBlock(src,clientMachine,null,null,fileStatus.getFileId(),null);
    assertEquals("Block should be allocated sufficient locations",REPLICATION_FACTOR,locatedBlock.getLocations().length);
    if (clientRack != null) {
      assertEquals("First datanode should be rack local",clientRack,locatedBlock.getLocations()[0].getNetworkLocation());
    }
    nameNodeRpc.abandonBlock(locatedBlock.getBlock(),fileStatus.getFileId(),src,clientMachine);
  }
}
