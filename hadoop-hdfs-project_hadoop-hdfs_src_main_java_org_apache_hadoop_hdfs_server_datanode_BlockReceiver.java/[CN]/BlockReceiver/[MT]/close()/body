{
  IOException ioe=null;
  try {
    if (checksumOut != null) {
      checksumOut.flush();
      if (datanode.getDnConf().syncOnClose && (cout instanceof FileOutputStream)) {
        ((FileOutputStream)cout).getChannel().force(true);
      }
      checksumOut.close();
      checksumOut=null;
    }
  }
 catch (  IOException e) {
    ioe=e;
  }
 finally {
    IOUtils.closeStream(checksumOut);
  }
  try {
    if (out != null) {
      out.flush();
      if (datanode.getDnConf().syncOnClose && (out instanceof FileOutputStream)) {
        ((FileOutputStream)out).getChannel().force(true);
      }
      out.close();
      out=null;
    }
  }
 catch (  IOException e) {
    ioe=e;
  }
 finally {
    IOUtils.closeStream(out);
  }
  if (ioe != null) {
    datanode.checkDiskError(ioe);
    throw ioe;
  }
}
