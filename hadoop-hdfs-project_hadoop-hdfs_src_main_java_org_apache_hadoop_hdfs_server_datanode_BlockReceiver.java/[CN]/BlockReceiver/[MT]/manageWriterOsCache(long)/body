{
  try {
    if (outFd != null && offsetInBlock > lastCacheManagementOffset + CACHE_DROP_LAG_BYTES) {
      long begin=Time.monotonicNow();
      if (syncBehindWrites) {
        if (syncBehindWritesInBackground) {
          this.datanode.getFSDataset().submitBackgroundSyncFileRangeRequest(block,outFd,lastCacheManagementOffset,offsetInBlock - lastCacheManagementOffset,NativeIO.POSIX.SYNC_FILE_RANGE_WRITE);
        }
 else {
          NativeIO.POSIX.syncFileRangeIfPossible(outFd,lastCacheManagementOffset,offsetInBlock - lastCacheManagementOffset,NativeIO.POSIX.SYNC_FILE_RANGE_WRITE);
        }
      }
      long dropPos=lastCacheManagementOffset - CACHE_DROP_LAG_BYTES;
      if (dropPos > 0 && dropCacheBehindWrites) {
        NativeIO.POSIX.getCacheManipulator().posixFadviseIfPossible(block.getBlockName(),outFd,0,dropPos,NativeIO.POSIX.POSIX_FADV_DONTNEED);
      }
      lastCacheManagementOffset=offsetInBlock;
      long duration=Time.monotonicNow() - begin;
      if (duration > datanodeSlowLogThresholdMs) {
        LOG.warn("Slow manageWriterOsCache took " + duration + "ms (threshold="+ datanodeSlowLogThresholdMs+ "ms)");
      }
    }
  }
 catch (  Throwable t) {
    LOG.warn("Error managing cache for writer of block " + block,t);
  }
}
