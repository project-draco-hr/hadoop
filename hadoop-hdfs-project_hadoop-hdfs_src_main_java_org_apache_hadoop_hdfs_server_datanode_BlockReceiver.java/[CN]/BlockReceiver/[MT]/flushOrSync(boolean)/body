{
  if (isSync && (out != null || checksumOut != null)) {
    datanode.metrics.incrFsyncCount();
  }
  if (checksumOut != null) {
    checksumOut.flush();
    if (isSync && (cout instanceof FileOutputStream)) {
      long start=Util.now();
      ((FileOutputStream)cout).getChannel().force(true);
      datanode.metrics.addFsync(Util.now() - start);
    }
  }
  if (out != null) {
    out.flush();
    if (isSync && (out instanceof FileOutputStream)) {
      long start=Util.now();
      ((FileOutputStream)out).getChannel().force(true);
      datanode.metrics.addFsync(Util.now() - start);
    }
  }
}
