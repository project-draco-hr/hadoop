{
  long flushTotalNanos=0;
  if (checksumOut != null) {
    long flushStartNanos=System.nanoTime();
    checksumOut.flush();
    long flushEndNanos=System.nanoTime();
    if (isSync && (cout instanceof FileOutputStream)) {
      long fsyncStartNanos=flushEndNanos;
      ((FileOutputStream)cout).getChannel().force(true);
      datanode.metrics.addFsyncNanos(System.nanoTime() - fsyncStartNanos);
    }
    flushTotalNanos+=flushEndNanos - flushStartNanos;
  }
  if (out != null) {
    long flushStartNanos=System.nanoTime();
    out.flush();
    long flushEndNanos=System.nanoTime();
    if (isSync && (out instanceof FileOutputStream)) {
      long fsyncStartNanos=flushEndNanos;
      ((FileOutputStream)out).getChannel().force(true);
      datanode.metrics.addFsyncNanos(System.nanoTime() - fsyncStartNanos);
    }
    flushTotalNanos+=flushEndNanos - flushStartNanos;
  }
  if (checksumOut != null || out != null) {
    datanode.metrics.addFlushNanos(flushTotalNanos);
    if (isSync) {
      datanode.metrics.incrFsyncCount();
    }
  }
}
