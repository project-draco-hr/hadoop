{
  if (toRead < 0) {
    toRead=(maxPacketReadLen > 0 ? maxPacketReadLen : buf.capacity()) - buf.limit();
  }
  int nRead=in.read(buf.array(),buf.limit(),toRead);
  if (nRead < 0) {
    throw new EOFException("while trying to read " + toRead + " bytes");
  }
  bufRead=buf.limit() + nRead;
  buf.limit(bufRead);
  return nRead;
}
