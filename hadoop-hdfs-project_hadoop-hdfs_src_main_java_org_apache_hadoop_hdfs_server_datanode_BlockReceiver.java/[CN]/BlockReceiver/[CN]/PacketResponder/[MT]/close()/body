{
synchronized (ackQueue) {
    while (isRunning() && ackQueue.size() != 0) {
      try {
        ackQueue.wait();
      }
 catch (      InterruptedException e) {
        running=false;
        Thread.currentThread().interrupt();
      }
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug(myString + ": closing");
    }
    running=false;
    ackQueue.notifyAll();
  }
synchronized (this) {
    notifyAll();
  }
}
