{
  Status[] replies=null;
  if (mirrorError) {
    replies=MIRROR_ERROR_STATUS;
  }
 else {
    short ackLen=type == PacketResponderType.LAST_IN_PIPELINE ? 0 : ack.getNumOfReplies();
    replies=new Status[1 + ackLen];
    replies[0]=Status.SUCCESS;
    for (int i=0; i < ackLen; i++) {
      replies[i + 1]=ack.getReply(i);
    }
  }
  PipelineAck replyAck=new PipelineAck(seqno,replies,totalAckTimeNanos);
  if (replyAck.isSuccess() && offsetInBlock > replicaInfo.getBytesAcked()) {
    replicaInfo.setBytesAcked(offsetInBlock);
  }
  replyAck.write(upstreamOut);
  upstreamOut.flush();
  if (LOG.isDebugEnabled()) {
    LOG.debug(myString + ", replyAck=" + replyAck);
  }
}
