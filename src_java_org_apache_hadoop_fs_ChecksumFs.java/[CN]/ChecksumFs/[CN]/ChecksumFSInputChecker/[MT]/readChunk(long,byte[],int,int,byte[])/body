{
  boolean eof=false;
  if (needChecksum()) {
    try {
      final long checksumPos=getChecksumFilePos(pos);
      if (checksumPos != sums.getPos()) {
        sums.seek(checksumPos);
      }
      sums.readFully(checksum);
    }
 catch (    EOFException e) {
      eof=true;
    }
    len=bytesPerSum;
  }
  if (pos != datas.getPos()) {
    datas.seek(pos);
  }
  final int nread=readFully(datas,buf,offset,len);
  if (eof && nread > 0) {
    throw new ChecksumException("Checksum error: " + file + " at "+ pos,pos);
  }
  return nread;
}
