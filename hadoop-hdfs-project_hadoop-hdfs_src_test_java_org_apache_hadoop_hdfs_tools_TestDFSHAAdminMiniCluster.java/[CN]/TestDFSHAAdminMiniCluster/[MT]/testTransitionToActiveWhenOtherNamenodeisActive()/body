{
  NameNode nn1=cluster.getNameNode(0);
  NameNode nn2=cluster.getNameNode(1);
  if (nn1.getState() != null && !nn1.getState().equals(HAServiceState.STANDBY.name())) {
    cluster.transitionToStandby(0);
  }
  if (nn2.getState() != null && !nn2.getState().equals(HAServiceState.STANDBY.name())) {
    cluster.transitionToStandby(1);
  }
  assertTrue(nn1.isStandbyState());
  assertTrue(nn2.isStandbyState());
  runTool("-transitionToActive","nn1");
  runTool("-transitionToActive","nn2");
  assertFalse("Both namenodes cannot be active",nn1.isActiveState() && nn2.isActiveState());
  cluster.shutdownNameNode(0);
  if (nn2.getState() != null && !nn2.getState().equals(HAServiceState.STANDBY.name())) {
    cluster.transitionToStandby(1);
  }
  assertTrue(nn2.isStandbyState());
  assertFalse(cluster.isNameNodeUp(0));
  runTool("-transitionToActive","nn2","--forceactive");
  assertTrue("Namenode nn2 should be active",nn2.isActiveState());
}
