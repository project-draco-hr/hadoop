{
  String queueName="single2";
  String user="dodo";
  QueueMetrics metrics=QueueMetrics.forQueue(ms,queueName,null,true);
  MetricsSource queueSource=queueSource(ms,queueName);
  AppSchedulingInfo app=mockApp(user);
  metrics.submitApp(user);
  MetricsSource userSource=userSource(ms,queueName,user);
  checkApps(queueSource,1,1,0,0,0,0);
  checkApps(userSource,1,1,0,0,0,0);
  metrics.setAvailableResourcesToQueue(Resources.createResource(100 * GB));
  metrics.setAvailableResourcesToUser(user,Resources.createResource(10 * GB));
  metrics.incrPendingResources(user,5,Resources.createResource(15 * GB));
  checkResources(queueSource,0,0,0,0,100,15,5,0,0);
  checkResources(userSource,0,0,0,0,10,15,5,0,0);
  metrics.incrAppsRunning(user);
  checkApps(queueSource,1,0,1,0,0,0);
  checkApps(userSource,1,0,1,0,0,0);
  metrics.allocateResources(user,3,Resources.createResource(2 * GB));
  checkResources(queueSource,6,3,3,0,100,9,2,0,0);
  checkResources(userSource,6,3,3,0,10,9,2,0,0);
  metrics.releaseResources(user,1,Resources.createResource(2 * GB));
  checkResources(queueSource,4,2,3,1,100,9,2,0,0);
  checkResources(userSource,4,2,3,1,10,9,2,0,0);
  metrics.finishApp(app,RMAppAttemptState.FINISHED);
  checkApps(queueSource,1,0,0,1,0,0);
  checkApps(userSource,1,0,0,1,0,0);
}
