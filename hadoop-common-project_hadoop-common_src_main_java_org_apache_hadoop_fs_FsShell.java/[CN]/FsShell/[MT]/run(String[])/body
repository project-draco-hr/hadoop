{
  init();
  int exitCode=-1;
  if (argv.length < 1) {
    printUsage(System.err);
  }
 else {
    String cmd=argv[0];
    Command instance=null;
    try {
      instance=commandFactory.getInstance(cmd);
      if (instance == null) {
        throw new UnknownCommandException();
      }
      TraceScope scope=tracer.newScope(instance.getCommandName());
      if (scope.getSpan() != null) {
        String args=StringUtils.join(" ",argv);
        if (args.length() > 2048) {
          args=args.substring(0,2048);
        }
        scope.getSpan().addKVAnnotation("args",args);
      }
      try {
        exitCode=instance.run(Arrays.copyOfRange(argv,1,argv.length));
      }
  finally {
        scope.close();
      }
    }
 catch (    IllegalArgumentException e) {
      displayError(cmd,e.getLocalizedMessage());
      printUsage(System.err);
      if (instance != null) {
        printInstanceUsage(System.err,instance);
      }
    }
catch (    Exception e) {
      LOG.debug("Error",e);
      displayError(cmd,"Fatal internal error");
      e.printStackTrace(System.err);
    }
  }
  tracer.close();
  return exitCode;
}
