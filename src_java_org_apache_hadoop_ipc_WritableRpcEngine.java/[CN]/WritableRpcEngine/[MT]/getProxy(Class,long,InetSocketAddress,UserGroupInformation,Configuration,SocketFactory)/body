{
  Object proxy=Proxy.newProxyInstance(protocol.getClassLoader(),new Class[]{protocol},new Invoker(protocol,addr,ticket,conf,factory));
  if (proxy instanceof VersionedProtocol) {
    long serverVersion=((VersionedProtocol)proxy).getProtocolVersion(protocol.getName(),clientVersion);
    if (serverVersion != clientVersion) {
      throw new RPC.VersionMismatch(protocol.getName(),clientVersion,serverVersion);
    }
  }
  return proxy;
}
