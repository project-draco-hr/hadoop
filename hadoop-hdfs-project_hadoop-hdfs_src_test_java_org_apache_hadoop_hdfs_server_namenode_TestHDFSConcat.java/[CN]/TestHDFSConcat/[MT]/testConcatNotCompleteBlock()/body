{
  long trgFileLen=blockSize * 3;
  long srcFileLen=blockSize * 3 + 20;
  String name1="/trg", name2="/src";
  Path filePath1=new Path(name1);
  DFSTestUtil.createFile(dfs,filePath1,trgFileLen,REPL_FACTOR,1);
  HdfsFileStatus fStatus=nn.getFileInfo(name1);
  long fileLen=fStatus.getLen();
  assertEquals(fileLen,trgFileLen);
  FSDataInputStream stm=dfs.open(filePath1);
  byte[] byteFile1=new byte[(int)trgFileLen];
  stm.readFully(0,byteFile1);
  stm.close();
  LocatedBlocks lb1=nn.getBlockLocations(name1,0,trgFileLen);
  Path filePath2=new Path(name2);
  DFSTestUtil.createFile(dfs,filePath2,srcFileLen,REPL_FACTOR,1);
  fStatus=nn.getFileInfo(name2);
  fileLen=fStatus.getLen();
  assertEquals(srcFileLen,fileLen);
  stm=dfs.open(filePath2);
  byte[] byteFile2=new byte[(int)srcFileLen];
  stm.readFully(0,byteFile2);
  stm.close();
  LocatedBlocks lb2=nn.getBlockLocations(name2,0,srcFileLen);
  System.out.println("trg len=" + trgFileLen + "; src len="+ srcFileLen);
  dfs.concat(filePath1,new Path[]{filePath2});
  long totalLen=trgFileLen + srcFileLen;
  fStatus=nn.getFileInfo(name1);
  fileLen=fStatus.getLen();
  stm=dfs.open(filePath1);
  byte[] byteFileConcat=new byte[(int)fileLen];
  stm.readFully(0,byteFileConcat);
  stm.close();
  LocatedBlocks lbConcat=nn.getBlockLocations(name1,0,fileLen);
  assertEquals(lbConcat.locatedBlockCount(),lb1.locatedBlockCount() + lb2.locatedBlockCount());
  System.out.println("file1 len=" + fileLen + "; total len="+ totalLen);
  assertEquals(fileLen,totalLen);
  fStatus=nn.getFileInfo(name2);
  assertNull("File " + name2 + "still exists",fStatus);
  checkFileContent(byteFileConcat,new byte[][]{byteFile1,byteFile2});
}
