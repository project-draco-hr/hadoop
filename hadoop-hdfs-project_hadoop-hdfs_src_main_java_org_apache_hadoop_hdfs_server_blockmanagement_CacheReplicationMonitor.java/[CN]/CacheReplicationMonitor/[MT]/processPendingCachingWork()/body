{
  Block[] timedOutItems=pendingCacheBlocks.getTimedOutBlocks();
  if (timedOutItems != null) {
    namesystem.writeLock();
    try {
      for (int i=0; i < timedOutItems.length; i++) {
        Block block=timedOutItems[i];
        final short numCached=cacheReplManager.getNumCached(block);
        final short cacheReplication=cacheReplManager.getCacheReplication(block);
        if (numCached < cacheReplication) {
synchronized (neededCacheBlocks) {
            neededCacheBlocks.add(block);
          }
        }
      }
    }
  finally {
      namesystem.writeUnlock();
    }
  }
}
