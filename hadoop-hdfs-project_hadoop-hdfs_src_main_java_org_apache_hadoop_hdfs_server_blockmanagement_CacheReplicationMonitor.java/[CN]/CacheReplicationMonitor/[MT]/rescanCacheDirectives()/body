{
  FSDirectory fsDir=namesystem.getFSDirectory();
  final long now=new Date().getTime();
  for (  CacheDirective directive : cacheManager.getCacheDirectives()) {
    scannedDirectives++;
    if (directive.getExpiryTime() > 0 && directive.getExpiryTime() <= now) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Directive " + directive.getId() + ": the directive "+ "expired at "+ directive.getExpiryTime()+ " (now = "+ now+ ")");
      }
      continue;
    }
    String path=directive.getPath();
    INode node;
    try {
      node=fsDir.getINode(path);
    }
 catch (    UnresolvedLinkException e) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Directive " + directive.getId() + ": got UnresolvedLinkException while resolving path "+ path);
      }
      continue;
    }
    if (node == null) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Directive " + directive.getId() + ": No inode found at "+ path);
      }
    }
 else     if (node.isDirectory()) {
      INodeDirectory dir=node.asDirectory();
      ReadOnlyList<INode> children=dir.getChildrenList(Snapshot.CURRENT_STATE_ID);
      for (      INode child : children) {
        if (child.isFile()) {
          rescanFile(directive,child.asFile());
        }
      }
    }
 else     if (node.isFile()) {
      rescanFile(directive,node.asFile());
    }
 else {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Directive " + directive.getId() + ": ignoring non-directive, non-file inode "+ node);
      }
    }
  }
}
