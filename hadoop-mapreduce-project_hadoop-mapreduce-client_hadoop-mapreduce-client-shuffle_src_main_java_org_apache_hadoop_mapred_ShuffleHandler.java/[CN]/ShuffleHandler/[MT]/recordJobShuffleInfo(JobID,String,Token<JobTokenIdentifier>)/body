{
  if (stateDb != null) {
    TokenProto tokenProto=TokenProto.newBuilder().setIdentifier(ByteString.copyFrom(jobToken.getIdentifier())).setPassword(ByteString.copyFrom(jobToken.getPassword())).setKind(jobToken.getKind().toString()).setService(jobToken.getService().toString()).build();
    JobShuffleInfoProto proto=JobShuffleInfoProto.newBuilder().setUser(user).setJobToken(tokenProto).build();
    try {
      stateDb.put(bytes(jobId.toString()),proto.toByteArray());
    }
 catch (    DBException e) {
      throw new IOException("Error storing " + jobId,e);
    }
  }
  addJobToken(jobId,user,jobToken);
}
