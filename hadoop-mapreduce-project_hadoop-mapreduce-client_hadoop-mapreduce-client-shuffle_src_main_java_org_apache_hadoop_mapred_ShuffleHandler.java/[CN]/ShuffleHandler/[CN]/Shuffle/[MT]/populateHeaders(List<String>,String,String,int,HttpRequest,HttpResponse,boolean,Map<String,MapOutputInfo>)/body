{
  long contentLength=0;
  for (  String mapId : mapIds) {
    String base=outputBaseStr + mapId;
    MapOutputInfo outputInfo=getMapOutputInfo(base,mapId,reduce,user);
    if (mapOutputInfoMap.size() < mapOutputMetaInfoCacheSize) {
      mapOutputInfoMap.put(mapId,outputInfo);
    }
    Path indexFileName=lDirAlloc.getLocalPathToRead(base + "/file.out.index",conf);
    IndexRecord info=indexCache.getIndexInformation(mapId,reduce,indexFileName,user);
    ShuffleHeader header=new ShuffleHeader(mapId,info.partLength,info.rawLength,reduce);
    DataOutputBuffer dob=new DataOutputBuffer();
    header.write(dob);
    contentLength+=info.partLength;
    contentLength+=dob.getLength();
  }
  setResponseHeaders(response,keepAliveParam,contentLength);
}
