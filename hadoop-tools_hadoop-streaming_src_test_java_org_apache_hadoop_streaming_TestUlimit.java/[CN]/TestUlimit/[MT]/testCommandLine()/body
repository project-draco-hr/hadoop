{
  if (UtilTest.isCygwin()) {
    return;
  }
  try {
    final int numSlaves=2;
    Configuration conf=new Configuration();
    dfs=new MiniDFSCluster(conf,numSlaves,true,null);
    fs=dfs.getFileSystem();
    mr=new MiniMRCluster(numSlaves,fs.getUri().toString(),1);
    writeInputFile(fs,inputPath);
    map=UtilTest.makeJavaCommand(UlimitApp.class,new String[]{});
    runProgram(SET_MEMORY_LIMIT);
    fs.delete(outputPath,true);
    assertFalse("output not cleaned up",fs.exists(outputPath));
    mr.waitUntilIdle();
  }
 catch (  IOException e) {
    fail(StringUtils.stringifyException(e));
  }
 finally {
    if (mr != null) {
      mr.shutdown();
    }
    if (dfs != null) {
      dfs.shutdown();
    }
  }
}
