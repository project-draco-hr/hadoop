{
  FakeProgressive fakeProgress=new FakeProgressive();
  fakeCore.resetFake();
  heapPlugin.initialize(conf,metrics,monitor,fakeProgress);
  int numLoops=0;
  while (fakeProgress.getProgress() < 1) {
    ++numLoops;
    float progress=numLoops / 100.0F;
    fakeProgress.setProgress(progress);
    heapPlugin.emulate();
  }
  assertEquals("Cumulative heap usage emulator plugin failed (total usage)!",expectedTotalHeapUsageInMB,fakeCore.getHeapUsageInMB(),1L);
  assertEquals("Cumulative heap usage emulator plugin failed (num calls)!",expectedTotalNumCalls,fakeCore.getNumCalls(),0L);
}
