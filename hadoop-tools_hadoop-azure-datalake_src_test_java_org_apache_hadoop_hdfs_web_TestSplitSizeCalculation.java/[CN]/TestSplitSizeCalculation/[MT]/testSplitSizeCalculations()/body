{
  getMockServer().enqueue(new MockResponse().setResponseCode(200).setBody(TestADLResponseData.getGetFileStatusJSONResponse(128 * 1024 * 1024)));
  getMockServer().enqueue(new MockResponse().setResponseCode(200).setBody(TestADLResponseData.getGetFileStatusJSONResponse(128 * 1024 * 1024)));
  getMockServer().enqueue(new MockResponse().setResponseCode(200).setBody(TestADLResponseData.getGetFileStatusJSONResponse(128 * 1024 * 1024)));
  getMockServer().enqueue(new MockResponse().setResponseCode(200).setBody(TestADLResponseData.getGetFileStatusJSONResponse(128 * 1024 * 1024)));
  URL url=getMockServer().getUrl("");
  BatchByteArrayInputStream stream=getMockAdlFileSystem().new BatchByteArrayInputStream(url,new Path("/test1/test2"),16 * 1024 * 1024,4);
  Assert.assertEquals(1,stream.getSplitSize(1 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(2 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(3 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(4 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(5 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(6 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(7 * 1024 * 1024));
  Assert.assertEquals(2,stream.getSplitSize(8 * 1024 * 1024));
  Assert.assertEquals(4,stream.getSplitSize(16 * 1024 * 1024));
  Assert.assertEquals(3,stream.getSplitSize(12 * 1024 * 1024));
  Assert.assertEquals(4,stream.getSplitSize(102 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(102));
  stream.close();
  stream=getMockAdlFileSystem().new BatchByteArrayInputStream(url,new Path("/test1/test2"),4 * 1024 * 1024,4);
  Assert.assertEquals(1,stream.getSplitSize(1 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(2 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(3 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(4 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(5 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(8 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(5 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(6 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(7 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(16 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(12 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(102 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(102));
  stream.close();
  stream=getMockAdlFileSystem().new BatchByteArrayInputStream(url,new Path("/test1/test2"),16 * 1024 * 1024,2);
  Assert.assertEquals(1,stream.getSplitSize(1 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(2 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(3 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(4 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(5 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(5 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(6 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(7 * 1024 * 1024));
  Assert.assertEquals(2,stream.getSplitSize(8 * 1024 * 1024));
  Assert.assertEquals(2,stream.getSplitSize(16 * 1024 * 1024));
  Assert.assertEquals(2,stream.getSplitSize(12 * 1024 * 1024));
  Assert.assertEquals(2,stream.getSplitSize(102 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(102));
  stream.close();
  stream=getMockAdlFileSystem().new BatchByteArrayInputStream(url,new Path("/test1/test2"),8 * 1024 * 1024,2);
  Assert.assertEquals(1,stream.getSplitSize(1 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(2 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(3 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(4 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(5 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(6 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(7 * 1024 * 1024));
  Assert.assertEquals(2,stream.getSplitSize(8 * 1024 * 1024));
  Assert.assertEquals(2,stream.getSplitSize(16 * 1024 * 1024));
  Assert.assertEquals(2,stream.getSplitSize(12 * 1024 * 1024));
  Assert.assertEquals(2,stream.getSplitSize(102 * 1024 * 1024));
  Assert.assertEquals(1,stream.getSplitSize(102));
  stream.close();
}
