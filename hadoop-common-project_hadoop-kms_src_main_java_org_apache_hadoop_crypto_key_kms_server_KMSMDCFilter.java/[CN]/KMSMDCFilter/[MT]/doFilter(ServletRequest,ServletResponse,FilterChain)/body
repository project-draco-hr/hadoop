{
  try {
    DATA_TL.remove();
    Principal principal=((HttpServletRequest)request).getUserPrincipal();
    String method=((HttpServletRequest)request).getMethod();
    StringBuffer requestURL=((HttpServletRequest)request).getRequestURL();
    String queryString=((HttpServletRequest)request).getQueryString();
    if (queryString != null) {
      requestURL.append("?").append(queryString);
    }
    DATA_TL.set(new Data(principal,method,requestURL));
    chain.doFilter(request,response);
  }
  finally {
    DATA_TL.remove();
  }
}
