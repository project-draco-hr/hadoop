{
  Preconditions.checkState(bpNSInfo != null,"register() should be called after handshake()");
  bpRegistration=dn.createBPRegistration(bpNSInfo);
  LOG.info(this + " beginning handshake with NN");
  while (shouldRun()) {
    try {
      bpRegistration=bpNamenode.registerDatanode(bpRegistration);
      break;
    }
 catch (    SocketTimeoutException e) {
      LOG.info("Problem connecting to server: " + nnAddr);
      sleepAndLogInterrupts(1000,"connecting to server");
    }
  }
  LOG.info("Block pool " + this + " successfully registered with NN");
  dn.bpRegistrationSucceeded(bpRegistration,getBlockPoolId());
  scheduleBlockReport(dnConf.initialBlockReportDelay);
}
