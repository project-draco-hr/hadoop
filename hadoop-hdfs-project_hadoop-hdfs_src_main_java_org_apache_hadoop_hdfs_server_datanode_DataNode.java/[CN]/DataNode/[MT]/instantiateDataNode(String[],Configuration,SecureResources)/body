{
  if (conf == null)   conf=new HdfsConfiguration();
  if (args != null) {
    GenericOptionsParser hParser=new GenericOptionsParser(conf,args);
    args=hParser.getRemainingArgs();
  }
  if (!parseArguments(args,conf)) {
    LOG.error("Bad command line arguments");
    printUsage(System.err);
    return null;
  }
  Collection<StorageLocation> dataLocations=getStorageLocations(conf);
  UserGroupInformation.setConfiguration(conf);
  SecurityUtil.login(conf,DFS_DATANODE_KEYTAB_FILE_KEY,DFS_DATANODE_USER_NAME_KEY);
  return makeInstance(dataLocations,conf,resources);
}
