{
  checkSuperuserPrivilege();
  LOG.info("shutdownDatanode command received (upgrade=" + forUpgrade + "). Shutting down Datanode...");
  if (shutdownInProgress) {
    throw new IOException("Shutdown already in progress.");
  }
  shutdownInProgress=true;
  shutdownForUpgrade=forUpgrade;
  Thread shutdownThread=new Thread("Async datanode shutdown thread"){
    @Override public void run(){
      if (!shutdownForUpgrade) {
        try {
          Thread.sleep(1000);
        }
 catch (        InterruptedException ie) {
        }
      }
      shutdown();
    }
  }
;
  shutdownThread.setDaemon(true);
  shutdownThread.start();
}
