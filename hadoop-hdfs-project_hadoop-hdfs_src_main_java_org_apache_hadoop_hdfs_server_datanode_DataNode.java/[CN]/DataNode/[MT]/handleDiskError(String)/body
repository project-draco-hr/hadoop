{
  final boolean hasEnoughResources=data.hasEnoughResource();
  LOG.warn("DataNode.handleDiskError: Keep Running: " + hasEnoughResources);
  int dpError=hasEnoughResources ? DatanodeProtocol.DISK_ERROR : DatanodeProtocol.FATAL_DISK_ERROR;
  metrics.incrVolumeFailures();
  for (  BPOfferService bpos : blockPoolManager.getAllNamenodeThreads()) {
    DatanodeProtocolClientSideTranslatorPB nn=bpos.bpNamenode;
    try {
      nn.errorReport(bpos.bpRegistration,dpError,errMsgr);
    }
 catch (    IOException e) {
      LOG.warn("Error reporting disk failure to NameNode",e);
    }
  }
  if (hasEnoughResources) {
    scheduleAllBlockReport(0);
    return;
  }
  LOG.warn("DataNode is shutting down: " + errMsgr);
  shouldRun=false;
}
