{
  if (null == id) {
    id=bpRegistration;
  }
  if (storage.getDatanodeUuid() == null) {
    storage.setDatanodeUuid(bpRegistration.getDatanodeUuid());
    storage.writeAll();
    LOG.info("Datanode ID " + bpRegistration.getDatanodeUuid() + " is assigned to new storage "+ bpRegistration);
  }
 else   if (!storage.getDatanodeUuid().equals(bpRegistration.getDatanodeUuid())) {
    throw new IOException("Inconsistent Datanode IDs. Name-node returned " + bpRegistration.getDatanodeUuid() + ". Expecting "+ storage.getDatanodeUuid());
  }
  registerBlockPoolWithSecretManager(bpRegistration,blockPoolId);
}
