{
  DatanodeRegistration bpRegistration=createUnknownBPRegistration();
  String blockPoolId=nsInfo.getBlockPoolID();
  bpRegistration.setStorageID(getStorageId());
  StorageInfo storageInfo=storage.getBPStorage(blockPoolId);
  if (storageInfo == null) {
    bpRegistration.storageInfo.layoutVersion=HdfsConstants.LAYOUT_VERSION;
    bpRegistration.setStorageInfo(nsInfo);
  }
 else {
    bpRegistration.setStorageInfo(storageInfo);
  }
  return bpRegistration;
}
