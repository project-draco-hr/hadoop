{
  StorageInfo storageInfo=storage.getBPStorage(nsInfo.getBlockPoolID());
  if (storageInfo == null) {
    storageInfo=new StorageInfo(nsInfo);
  }
  DatanodeID dnId=new DatanodeID(streamingAddr.getAddress().getHostAddress(),hostName,getStorageId(),getXferPort(),getInfoPort(),getIpcPort());
  return new DatanodeRegistration(dnId,storageInfo,new ExportedBlockKeys(),VersionInfo.getVersion());
}
