{
  HttpServer.Builder builder=new HttpServer.Builder().setName("datanode").setConf(conf).setACL(new AccessControlList(conf.get(DFS_ADMIN," ")));
  HttpConfig.Policy policy=DFSUtil.getHttpPolicy(conf);
  InetSocketAddress infoSocAddr=DataNode.getInfoAddr(conf);
  String infoHost=infoSocAddr.getHostName();
  if (policy.isHttpEnabled()) {
    if (secureResources == null) {
      int port=infoSocAddr.getPort();
      builder.addEndpoint(URI.create("http://" + infoHost + ":"+ port));
      if (port == 0) {
        builder.setFindPort(true);
      }
    }
 else {
      builder.setConnector(secureResources.getListener());
    }
  }
  if (policy.isHttpsEnabled()) {
    InetSocketAddress secInfoSocAddr=NetUtils.createSocketAddr(conf.get(DFS_DATANODE_HTTPS_ADDRESS_KEY,infoHost + ":" + 0));
    Configuration sslConf=DFSUtil.loadSslConfiguration(conf);
    DFSUtil.loadSslConfToHttpServerBuilder(builder,sslConf);
    int port=secInfoSocAddr.getPort();
    if (port == 0) {
      builder.setFindPort(true);
    }
    builder.addEndpoint(URI.create("https://" + infoHost + ":"+ port));
  }
  this.infoServer=builder.build();
  this.infoServer.addInternalServlet(null,"/streamFile/*",StreamFile.class);
  this.infoServer.addInternalServlet(null,"/getFileChecksum/*",FileChecksumServlets.GetServlet.class);
  this.infoServer.setAttribute("datanode",this);
  this.infoServer.setAttribute(JspHelper.CURRENT_CONF,conf);
  this.infoServer.addServlet(null,"/blockScannerReport",DataBlockScanner.Servlet.class);
  if (WebHdfsFileSystem.isEnabled(conf,LOG)) {
    infoServer.addJerseyResourcePackage(DatanodeWebHdfsMethods.class.getPackage().getName() + ";" + Param.class.getPackage().getName(),WebHdfsFileSystem.PATH_PREFIX + "/*");
  }
  this.infoServer.start();
  int connIdx=0;
  if (policy.isHttpEnabled()) {
    infoPort=infoServer.getConnectorAddress(connIdx++).getPort();
  }
  if (policy.isHttpsEnabled()) {
    infoSecurePort=infoServer.getConnectorAddress(connIdx).getPort();
  }
}
