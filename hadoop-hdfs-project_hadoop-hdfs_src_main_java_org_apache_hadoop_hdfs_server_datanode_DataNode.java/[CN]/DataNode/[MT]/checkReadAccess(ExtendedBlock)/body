{
  try {
    getDNRegistrationForBP(block.getBlockPoolId());
  }
 catch (  IOException e) {
    throw new org.apache.hadoop.ipc.RetriableException("Datanode not registered. Try again later.");
  }
  if (isBlockTokenEnabled) {
    Set<TokenIdentifier> tokenIds=UserGroupInformation.getCurrentUser().getTokenIdentifiers();
    if (tokenIds.size() != 1) {
      throw new IOException("Can't continue since none or more than one " + "BlockTokenIdentifier is found.");
    }
    for (    TokenIdentifier tokenId : tokenIds) {
      BlockTokenIdentifier id=(BlockTokenIdentifier)tokenId;
      if (LOG.isDebugEnabled()) {
        LOG.debug("Got: " + id.toString());
      }
      blockPoolTokenSecretManager.checkAccess(id,null,block,BlockTokenIdentifier.AccessMode.READ);
    }
  }
}
