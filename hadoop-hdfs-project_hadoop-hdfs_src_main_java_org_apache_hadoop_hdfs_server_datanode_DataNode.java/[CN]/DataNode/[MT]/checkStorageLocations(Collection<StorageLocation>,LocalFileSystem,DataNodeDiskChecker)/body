{
  ArrayList<StorageLocation> locations=new ArrayList<StorageLocation>();
  StringBuilder invalidDirs=new StringBuilder();
  for (  StorageLocation location : dataDirs) {
    final URI uri=location.getUri();
    try {
      dataNodeDiskChecker.checkDir(localFS,new Path(uri));
      locations.add(location);
    }
 catch (    IOException ioe) {
      LOG.warn("Invalid " + DFS_DATANODE_DATA_DIR_KEY + " "+ location.getFile()+ " : ",ioe);
      invalidDirs.append("\"").append(uri.getPath()).append("\" ");
    }
  }
  if (locations.size() == 0) {
    throw new IOException("All directories in " + DFS_DATANODE_DATA_DIR_KEY + " are invalid: "+ invalidDirs);
  }
  return locations;
}
