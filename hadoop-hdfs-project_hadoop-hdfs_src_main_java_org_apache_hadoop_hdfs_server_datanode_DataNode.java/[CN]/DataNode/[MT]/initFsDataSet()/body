{
  if (data != null) {
    return;
  }
  boolean simulatedFSDataset=conf.getBoolean(DFS_DATANODE_SIMULATEDDATASTORAGE_KEY,DFS_DATANODE_SIMULATEDDATASTORAGE_DEFAULT);
  if (simulatedFSDataset) {
    storage.createStorageID(getPort());
    conf.set(DFS_DATANODE_STORAGEID_KEY,getStorageId());
    try {
      data=(FSDatasetInterface)ReflectionUtils.newInstance(Class.forName("org.apache.hadoop.hdfs.server.datanode.SimulatedFSDataset"),conf);
    }
 catch (    ClassNotFoundException e) {
      throw new IOException(StringUtils.stringifyException(e));
    }
  }
 else {
    data=new FSDataset(this,storage,conf);
  }
}
