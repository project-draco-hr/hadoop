{
  final String dnAddr=datanodeid.getIpcAddr(connectToDnViaHostname);
  final InetSocketAddress addr=NetUtils.createSocketAddr(dnAddr);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Connecting to datanode " + dnAddr + " addr="+ addr);
  }
  final UserGroupInformation loginUgi=UserGroupInformation.getLoginUser();
  try {
    return loginUgi.doAs(new PrivilegedExceptionAction<InterDatanodeProtocol>(){
      @Override public InterDatanodeProtocol run() throws IOException {
        return new InterDatanodeProtocolTranslatorPB(addr,loginUgi,conf,NetUtils.getDefaultSocketFactory(conf),socketTimeout);
      }
    }
);
  }
 catch (  InterruptedException ie) {
    throw new IOException(ie.getMessage());
  }
}
