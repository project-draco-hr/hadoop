{
  TcpPeerServer tcpPeerServer;
  if (secureResources != null) {
    tcpPeerServer=new TcpPeerServer(secureResources);
  }
 else {
    tcpPeerServer=new TcpPeerServer(dnConf.socketWriteTimeout,DataNode.getStreamingAddr(conf));
  }
  tcpPeerServer.setReceiveBufferSize(HdfsConstants.DEFAULT_DATA_SOCKET_SIZE);
  streamingAddr=tcpPeerServer.getStreamingAddr();
  LOG.info("Opened streaming server at " + streamingAddr);
  this.threadGroup=new ThreadGroup("dataXceiverServer");
  this.dataXceiverServer=new Daemon(threadGroup,new DataXceiverServer(tcpPeerServer,conf,this));
  this.threadGroup.setDaemon(true);
  DomainPeerServer domainPeerServer=getDomainPeerServer(conf,streamingAddr.getPort());
  if (domainPeerServer != null) {
    this.localDataXceiverServer=new Daemon(threadGroup,new DataXceiverServer(domainPeerServer,conf,this));
    LOG.info("Listening on UNIX domain socket: " + domainPeerServer.getBindPath());
  }
}
