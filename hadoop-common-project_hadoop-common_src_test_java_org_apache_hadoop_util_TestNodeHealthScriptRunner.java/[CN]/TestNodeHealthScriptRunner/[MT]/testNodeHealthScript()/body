{
  String errorScript="echo ERROR\n echo \"Tracker not healthy\"";
  String normalScript="echo \"I am all fine\"";
  String failWithExitCodeScript="echo \"Not healthy\"; exit -1";
  String timeOutScript=Shell.WINDOWS ? "@echo off\nping -n 4 127.0.0.1 >nul\necho \"I am fine\"" : "sleep 4\necho \"I am fine\"";
  Configuration conf=new Configuration();
  writeNodeHealthScriptFile(normalScript,true);
  NodeHealthScriptRunner nodeHealthScriptRunner=new NodeHealthScriptRunner(nodeHealthscriptFile.getAbsolutePath(),500,1000,new String[]{});
  nodeHealthScriptRunner.init(conf);
  TimerTask timerTask=nodeHealthScriptRunner.getTimerTask();
  timerTask.run();
  Assert.assertTrue("Node health status reported unhealthy",nodeHealthScriptRunner.isHealthy());
  Assert.assertEquals("",nodeHealthScriptRunner.getHealthReport());
  writeNodeHealthScriptFile(errorScript,true);
  timerTask.run();
  Assert.assertFalse("Node health status reported healthy",nodeHealthScriptRunner.isHealthy());
  Assert.assertTrue(nodeHealthScriptRunner.getHealthReport().contains("ERROR"));
  writeNodeHealthScriptFile(normalScript,true);
  timerTask.run();
  Assert.assertTrue("Node health status reported unhealthy",nodeHealthScriptRunner.isHealthy());
  Assert.assertEquals("",nodeHealthScriptRunner.getHealthReport());
  writeNodeHealthScriptFile(failWithExitCodeScript,true);
  timerTask.run();
  Assert.assertFalse("Node health status reported healthy",nodeHealthScriptRunner.isHealthy());
  writeNodeHealthScriptFile(timeOutScript,true);
  timerTask.run();
  Assert.assertFalse("Node health status reported healthy even after timeout",nodeHealthScriptRunner.isHealthy());
  Assert.assertEquals(NodeHealthScriptRunner.NODE_HEALTH_SCRIPT_TIMED_OUT_MSG,nodeHealthScriptRunner.getHealthReport());
}
