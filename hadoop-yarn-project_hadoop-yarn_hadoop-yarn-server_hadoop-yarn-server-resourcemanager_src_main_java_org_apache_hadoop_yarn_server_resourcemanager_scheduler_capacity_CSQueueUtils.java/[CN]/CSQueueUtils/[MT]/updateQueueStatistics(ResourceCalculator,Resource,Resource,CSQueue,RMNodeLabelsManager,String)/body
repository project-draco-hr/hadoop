{
  QueueCapacities queueCapacities=childQueue.getQueueCapacities();
  ResourceUsage queueResourceUsage=childQueue.getQueueResourceUsage();
  if (nodePartition == null) {
    for (    String partition : Sets.union(queueCapacities.getNodePartitionsSet(),queueResourceUsage.getNodePartitionsSet())) {
      updateUsedCapacity(rc,nlm.getResourceByLabel(partition,cluster),minimumAllocation,queueResourceUsage,queueCapacities,partition);
    }
  }
 else {
    updateUsedCapacity(rc,nlm.getResourceByLabel(nodePartition,cluster),minimumAllocation,queueResourceUsage,queueCapacities,nodePartition);
  }
  if (nodePartition == null || nodePartition.equals(RMNodeLabelsManager.NO_LABEL)) {
    childQueue.getMetrics().setAvailableResourcesToQueue(getNonPartitionedMaxAvailableResourceToQueue(rc,nlm.getResourceByLabel(RMNodeLabelsManager.NO_LABEL,cluster),childQueue));
  }
}
