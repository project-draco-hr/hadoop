{
  List<DatanodeDescriptor> chosenNodes=new ArrayList<DatanodeDescriptor>();
  chosenNodes.add(dataNodes[0]);
  DatanodeDescriptor[] targets;
  targets=replicator.chooseTarget(filename,0,dataNodes[0],chosenNodes,BLOCK_SIZE);
  assertEquals(targets.length,0);
  targets=replicator.chooseTarget(filename,1,dataNodes[0],chosenNodes,BLOCK_SIZE);
  assertEquals(targets.length,1);
  assertFalse(cluster.isOnSameRack(dataNodes[0],targets[0]));
  targets=replicator.chooseTarget(filename,2,dataNodes[0],chosenNodes,BLOCK_SIZE);
  assertEquals(targets.length,2);
  assertTrue(cluster.isOnSameRack(dataNodes[0],targets[0]));
  assertFalse(cluster.isOnSameRack(targets[0],targets[1]));
  targets=replicator.chooseTarget(filename,3,dataNodes[0],chosenNodes,BLOCK_SIZE);
  assertEquals(targets.length,3);
  assertTrue(cluster.isOnSameRack(dataNodes[0],targets[0]));
  assertFalse(cluster.isOnSameRack(targets[0],targets[2]));
}
