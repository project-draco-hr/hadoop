from __future__ import with_statement
import ConfigParser
from hadoop.cloud.cluster import get_cluster
from hadoop.cloud.service import InstanceTemplate
from hadoop.cloud.service import HadoopService
from hadoop.cloud.service import NAMENODE
from hadoop.cloud.service import SECONDARY_NAMENODE
from hadoop.cloud.service import JOBTRACKER
from hadoop.cloud.service import DATANODE
from hadoop.cloud.service import TASKTRACKER
from hadoop.cloud.util import merge_config_with_options
from hadoop.cloud.util import xstr
import logging
from optparse import OptionParser
from optparse import make_option
import os
import sys
version_file = os.path.join(sys.path[0], 'VERSION')
VERSION = open(version_file, 'r').read().strip()
DEFAULT_CLOUD_PROVIDER = 'ec2'
DEFAULT_CONFIG_DIR_NAME = '.hadoop-cloud'
DEFAULT_CONFIG_DIR = os.path.join(os.environ['HOME'], DEFAULT_CONFIG_DIR_NAME)
CONFIG_FILENAME = 'clusters.cfg'
CONFIG_DIR_OPTION = make_option('--config-dir', metavar='CONFIG-DIR', help='The configuration directory.')
PROVIDER_OPTION = make_option('--cloud-provider', metavar='PROVIDER', help="The cloud provider, e.g. 'ec2' for Amazon EC2.")
BASIC_OPTIONS = [CONFIG_DIR_OPTION, PROVIDER_OPTION]
LAUNCH_OPTIONS = [CONFIG_DIR_OPTION, PROVIDER_OPTION, make_option('-a', '--ami', metavar='AMI', help='The AMI ID of the image to launch. (Amazon EC2 only. Deprecated, use --image-id.)'), make_option('-e', '--env', metavar='ENV', action='append', help='An environment variable to pass to instances. (May be specified multiple times.)'), make_option('-f', '--user-data-file', metavar='URL', help='The URL of the file containing user data to be made available to instances.'), make_option('--image-id', metavar='ID', help='The ID of the image to launch.'), make_option('-k', '--key-name', metavar='KEY-PAIR', help='The key pair to use when launching instances. (Amazon EC2 only.)'), make_option('-p', '--user-packages', metavar='PACKAGES', help='A space-separated list of packages to install on instances on start up.'), make_option('-t', '--instance-type', metavar='TYPE', help='The type of instance to be launched. One of m1.small, m1.large, m1.xlarge, c1.medium, or c1.xlarge.'), make_option('-z', '--availability-zone', metavar='ZONE', help='The availability zone to run the instances in.'), make_option('--auto-shutdown', metavar='TIMEOUT_MINUTES', help='The time in minutes after launch when an instance will be automatically shut down.'), make_option('--client-cidr', metavar='CIDR', action='append', help='The CIDR of the client, which is used to allow access through the firewall to the master node. (May be specified multiple times.)'), make_option('--public-key', metavar='FILE', help='The public key to authorize on launching instances. (Non-EC2 providers only.)')]
SNAPSHOT_OPTIONS = [CONFIG_DIR_OPTION, PROVIDER_OPTION, make_option('-k', '--key-name', metavar='KEY-PAIR', help='The key pair to use when launching instances.'), make_option('-z', '--availability-zone', metavar='ZONE', help='The availability zone to run the instances in.'), make_option('--ssh-options', metavar='SSH-OPTIONS', help='SSH options to use.')]
PLACEMENT_OPTIONS = [CONFIG_DIR_OPTION, PROVIDER_OPTION, make_option('-z', '--availability-zone', metavar='ZONE', help='The availability zone to run the instances in.')]
FORCE_OPTIONS = [CONFIG_DIR_OPTION, PROVIDER_OPTION, make_option('--force', action='store_true', default=False, help='Do not ask for confirmation.')]
SSH_OPTIONS = [CONFIG_DIR_OPTION, PROVIDER_OPTION, make_option('--ssh-options', metavar='SSH-OPTIONS', help='SSH options to use.')]
