{
  YarnConfiguration conf=new YarnConfiguration();
  conf.set(YarnConfiguration.RM_NODES_EXCLUDE_FILE_PATH,hostFile.getAbsolutePath());
  writeToHostsFile("");
  MockRM rm1=new MockRM(conf);
  rm1.start();
  rm1.registerNode("localhost:1234",8000);
  rm1.registerNode("host2:1234",8000);
  Assert.assertEquals(0,ClusterMetrics.getMetrics().getNumDecommisionedNMs());
  String ip=NetUtils.normalizeHostName("localhost");
  writeToHostsFile("host2",ip);
  rm1.getNodesListManager().refreshNodes(conf);
  Assert.assertEquals(2,ClusterMetrics.getMetrics().getNumDecommisionedNMs());
  MockRM rm2=new MockRM(conf);
  rm2.start();
  Assert.assertEquals(2,ClusterMetrics.getMetrics().getNumDecommisionedNMs());
  rm1.stop();
  rm2.stop();
}
