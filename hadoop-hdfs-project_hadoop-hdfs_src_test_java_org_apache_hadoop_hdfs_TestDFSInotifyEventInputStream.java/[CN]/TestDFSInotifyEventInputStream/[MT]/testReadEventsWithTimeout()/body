{
  Configuration conf=new HdfsConfiguration();
  MiniQJMHACluster cluster=new MiniQJMHACluster.Builder(conf).build();
  try {
    cluster.getDfsCluster().waitActive();
    cluster.getDfsCluster().transitionToActive(0);
    final DFSClient client=new DFSClient(cluster.getDfsCluster().getNameNode(0).getNameNodeAddress(),conf);
    DFSInotifyEventInputStream eis=client.getInotifyEventStream();
    ScheduledExecutorService ex=Executors.newSingleThreadScheduledExecutor();
    ex.schedule(new Runnable(){
      @Override public void run(){
        try {
          client.mkdirs("/dir",null,false);
        }
 catch (        IOException e) {
          LOG.error("Unable to create /dir",e);
        }
      }
    }
,1,TimeUnit.SECONDS);
    EventBatch batch=eis.poll(5,TimeUnit.SECONDS);
    Assert.assertNotNull(batch);
    Assert.assertEquals(1,batch.getEvents().length);
    Assert.assertTrue(batch.getEvents()[0].getEventType() == Event.EventType.CREATE);
    Assert.assertEquals("/dir",((Event.CreateEvent)batch.getEvents()[0]).getPath());
  }
  finally {
    cluster.shutdown();
  }
}
