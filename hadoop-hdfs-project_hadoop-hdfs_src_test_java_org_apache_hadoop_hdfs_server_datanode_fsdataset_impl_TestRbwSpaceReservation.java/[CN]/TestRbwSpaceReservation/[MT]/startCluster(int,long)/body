{
  initConfig(blockSize);
  cluster=new MiniDFSCluster.Builder(conf).storagesPerDatanode(STORAGES_PER_DATANODE).numDataNodes(REPL_FACTOR).build();
  fs=cluster.getFileSystem();
  client=fs.getClient();
  cluster.waitActive();
  if (perVolumeCapacity >= 0) {
    List<? extends FsVolumeSpi> volumes=cluster.getDataNodes().get(0).getFSDataset().getVolumes();
    assertThat(volumes.size(),is(1));
    singletonVolume=((FsVolumeImpl)volumes.get(0));
    singletonVolume.setCapacityForTesting(perVolumeCapacity);
  }
}
