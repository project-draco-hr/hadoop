{
  Configuration conf=new Configuration();
  String inputData="1234567890ab12ab345";
  Path inputFile=createInputFile(conf,inputData);
  conf.setInt("io.file.buffer.size",10);
  conf.setInt(org.apache.hadoop.mapreduce.lib.input.LineRecordReader.MAX_LINE_LENGTH,Integer.MAX_VALUE);
  String delimiter="ab";
  byte[] recordDelimiterBytes=delimiter.getBytes(Charsets.UTF_8);
  FileSplit split=new FileSplit(inputFile,0,15,(String[])null);
  LineRecordReader reader=new LineRecordReader(conf,split,recordDelimiterBytes);
  LongWritable key=new LongWritable();
  Text value=new Text();
  reader.next(key,value);
  assertEquals(10,value.getLength());
  assertEquals(12,reader.getPos());
  reader.next(key,value);
  assertEquals(2,value.getLength());
  assertEquals(16,reader.getPos());
  reader.next(key,value);
  assertEquals(3,value.getLength());
  assertEquals(19,reader.getPos());
  assertFalse(reader.next(key,value));
  assertEquals(19,reader.getPos());
  split=new FileSplit(inputFile,15,4,(String[])null);
  reader=new LineRecordReader(conf,split,recordDelimiterBytes);
  assertEquals(19,reader.getPos());
  assertFalse(reader.next(key,value));
  assertEquals(19,reader.getPos());
  inputData="123456789aab";
  inputFile=createInputFile(conf,inputData);
  split=new FileSplit(inputFile,0,12,(String[])null);
  reader=new LineRecordReader(conf,split,recordDelimiterBytes);
  reader.next(key,value);
  assertEquals(10,value.getLength());
  assertEquals(12,reader.getPos());
  assertFalse(reader.next(key,value));
  assertEquals(12,reader.getPos());
  inputData="123456789a";
  inputFile=createInputFile(conf,inputData);
  split=new FileSplit(inputFile,0,10,(String[])null);
  reader=new LineRecordReader(conf,split,recordDelimiterBytes);
  reader.next(key,value);
  assertEquals(10,value.getLength());
  assertEquals(10,reader.getPos());
  assertFalse(reader.next(key,value));
  assertEquals(10,reader.getPos());
  inputData="123456789ab";
  inputFile=createInputFile(conf,inputData);
  split=new FileSplit(inputFile,0,11,(String[])null);
  reader=new LineRecordReader(conf,split,recordDelimiterBytes);
  reader.next(key,value);
  assertEquals(9,value.getLength());
  assertEquals(11,reader.getPos());
  assertFalse(reader.next(key,value));
  assertEquals(11,reader.getPos());
}
