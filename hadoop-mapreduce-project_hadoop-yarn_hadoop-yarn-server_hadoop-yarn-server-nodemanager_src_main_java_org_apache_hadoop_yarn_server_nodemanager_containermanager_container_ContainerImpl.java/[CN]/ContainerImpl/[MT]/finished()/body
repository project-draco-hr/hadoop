{
switch (getContainerState()) {
case EXITED_WITH_SUCCESS:
    metrics.endRunningContainer();
  metrics.completedContainer();
NMAuditLogger.logSuccess(getUser(),AuditConstants.FINISH_SUCCESS_CONTAINER,"ContainerImpl",getContainerID().getApplicationAttemptId().getApplicationId(),getContainerID());
break;
case EXITED_WITH_FAILURE:
metrics.endRunningContainer();
case LOCALIZATION_FAILED:
metrics.failedContainer();
NMAuditLogger.logFailure(getUser(),AuditConstants.FINISH_FAILED_CONTAINER,"ContainerImpl","Container failed with state: " + getContainerState(),getContainerID().getApplicationAttemptId().getApplicationId(),getContainerID());
break;
case CONTAINER_CLEANEDUP_AFTER_KILL:
metrics.endRunningContainer();
case NEW:
metrics.killedContainer();
NMAuditLogger.logSuccess(getUser(),AuditConstants.FINISH_KILLED_CONTAINER,"ContainerImpl",getContainerID().getApplicationAttemptId().getApplicationId(),getContainerID());
}
metrics.releaseContainer(getLaunchContext().getResource());
ContainerId containerID=getContainerID();
@SuppressWarnings("rawtypes") EventHandler eventHandler=dispatcher.getEventHandler();
eventHandler.handle(new ApplicationContainerFinishedEvent(containerID));
eventHandler.handle(new ContainerStopMonitoringEvent(containerID));
eventHandler.handle(new LogHandlerContainerFinishedEvent(containerID,exitCode));
}
