{
  KeyProvider provider=KeyProviderFactory.getProviders(conf).get(0);
  byte[] key=new byte[32];
  for (int i=0; i < key.length; ++i) {
    key[i]=(byte)i;
  }
  try {
    provider.createKey("key5",key,KeyProvider.options(conf));
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw e;
  }
  provider.flush();
  provider=KeyProviderFactory.getProviders(conf).get(0);
  assertArrayEquals(key,provider.getCurrentKey("key5").getMaterial());
  FileSystem fs=path.getFileSystem(conf);
  FileStatus s=fs.getFileStatus(path);
  assertTrue("Permissions should have been retained from the preexisting keystore.",s.getPermission().toString().equals("rwxrwxrwx"));
}
