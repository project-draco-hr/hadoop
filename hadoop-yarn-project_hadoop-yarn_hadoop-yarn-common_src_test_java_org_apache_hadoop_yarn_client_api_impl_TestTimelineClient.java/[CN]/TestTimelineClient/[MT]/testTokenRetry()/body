{
  int newMaxRetries=5;
  long newIntervalMs=500;
  YarnConfiguration conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.TIMELINE_SERVICE_CLIENT_MAX_RETRIES,newMaxRetries);
  conf.setLong(YarnConfiguration.TIMELINE_SERVICE_CLIENT_RETRY_INTERVAL_MS,newIntervalMs);
  conf.setBoolean(YarnConfiguration.TIMELINE_SERVICE_ENABLED,true);
  conf.set(CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTHENTICATION,"kerberos");
  UserGroupInformation.setConfiguration(conf);
  TimelineClientImpl client=createTimelineClient(conf);
  try {
    client.getDelegationToken(UserGroupInformation.getCurrentUser().getShortUserName());
    Assert.fail("Exception expected!" + "Timeline server should be off to run this test. ");
  }
 catch (  RuntimeException ce) {
    Assert.assertTrue("Handler exception for reason other than retry: " + ce.toString(),ce.getMessage().contains("Connection retries limit exceeded"));
    Assert.assertTrue("Retry filter didn't perform any retries! ",client.connectionRetry.retried);
  }
}
