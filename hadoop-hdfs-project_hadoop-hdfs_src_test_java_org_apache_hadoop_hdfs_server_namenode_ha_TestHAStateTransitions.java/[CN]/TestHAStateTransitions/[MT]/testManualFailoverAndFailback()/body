{
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleHATopology()).numDataNodes(1).build();
  try {
    cluster.waitActive();
    cluster.transitionToActive(0);
    LOG.info("Starting with NN 0 active");
    FileSystem fs=HATestUtil.configureFailoverFs(cluster,conf);
    fs.mkdirs(TEST_DIR);
    LOG.info("Failing over to NN 1");
    cluster.transitionToStandby(0);
    cluster.transitionToActive(1);
    assertTrue(fs.exists(TEST_DIR));
    DFSTestUtil.writeFile(fs,TEST_FILE_PATH,TEST_FILE_DATA);
    LOG.info("Failing over to NN 0");
    cluster.transitionToStandby(1);
    cluster.transitionToActive(0);
    assertTrue(fs.exists(TEST_DIR));
    assertEquals(TEST_FILE_DATA,DFSTestUtil.readFile(fs,TEST_FILE_PATH));
    LOG.info("Removing test file");
    fs.delete(TEST_DIR,true);
    assertFalse(fs.exists(TEST_DIR));
    LOG.info("Failing over to NN 1");
    cluster.transitionToStandby(0);
    cluster.transitionToActive(1);
    assertFalse(fs.exists(TEST_DIR));
  }
  finally {
    cluster.shutdown();
  }
}
