{
  int nn0=2 * nsIndex, nn1=2 * nsIndex + 1;
  cluster.transitionToActive(nn0);
  LOG.info("Starting with NN 0 active in namespace " + nsIndex);
  FileSystem fs=HATestUtil.configureFailoverFs(cluster,conf);
  fs.mkdirs(TEST_DIR);
  LOG.info("Failing over to NN 1 in namespace " + nsIndex);
  cluster.transitionToStandby(nn0);
  cluster.transitionToActive(nn1);
  assertTrue(fs.exists(TEST_DIR));
  DFSTestUtil.writeFile(fs,TEST_FILE_PATH,TEST_FILE_DATA);
  LOG.info("Failing over to NN 0 in namespace " + nsIndex);
  cluster.transitionToStandby(nn1);
  cluster.transitionToActive(nn0);
  assertTrue(fs.exists(TEST_DIR));
  assertEquals(TEST_FILE_DATA,DFSTestUtil.readFile(fs,TEST_FILE_PATH));
  LOG.info("Removing test file");
  fs.delete(TEST_DIR,true);
  assertFalse(fs.exists(TEST_DIR));
  LOG.info("Failing over to NN 1 in namespace " + nsIndex);
  cluster.transitionToStandby(nn0);
  cluster.transitionToActive(nn1);
  assertFalse(fs.exists(TEST_DIR));
}
