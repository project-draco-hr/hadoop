{
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).build();
  StorageDirectory sd=cluster.getNameNode().getFSImage().getStorage().getStorageDir(0);
  File editLog=NNStorage.getInProgressEditsFile(sd,1);
  EditLogValidation validation=EditLogFileInputStream.validateEditLog(editLog);
  assertEquals("Edit log should contain a header as valid length",HEADER_LEN,validation.getValidLength());
  assertEquals(1,validation.getNumTransactions());
  assertEquals("Edit log should have 1MB of bytes allocated",1024 * 1024,editLog.length());
  cluster.getFileSystem().mkdirs(new Path("/tmp"),new FsPermission((short)777));
  long oldLength=validation.getValidLength();
  validation=EditLogFileInputStream.validateEditLog(editLog);
  assertTrue("Edit log should have more valid data after writing a txn " + "(was: " + oldLength + " now: "+ validation.getValidLength()+ ")",validation.getValidLength() > oldLength);
  assertEquals(2,validation.getNumTransactions());
  assertEquals("Edit log should be 1MB long",1024 * 1024,editLog.length());
  assertTrue("Edit log disk space used should be at least 257 blocks",256 * 4096 <= new DU(editLog,conf).getUsed());
}
