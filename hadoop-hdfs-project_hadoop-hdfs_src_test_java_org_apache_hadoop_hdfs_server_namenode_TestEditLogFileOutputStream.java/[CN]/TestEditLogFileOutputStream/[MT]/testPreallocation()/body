{
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).build();
  final long START_TXID=1;
  StorageDirectory sd=cluster.getNameNode().getFSImage().getStorage().getStorageDir(0);
  File editLog=NNStorage.getInProgressEditsFile(sd,START_TXID);
  EditLogValidation validation=EditLogFileInputStream.validateEditLog(editLog);
  assertEquals("Edit log should contain a header as valid length",HEADER_LEN,validation.getValidLength());
  assertEquals(validation.getEndTxId(),START_TXID);
  assertEquals("Edit log should have 1MB pre-allocated, plus 4 bytes " + "for the version number",EditLogFileOutputStream.PREALLOCATION_LENGTH + 4,editLog.length());
  cluster.getFileSystem().mkdirs(new Path("/tmp"),new FsPermission((short)777));
  long oldLength=validation.getValidLength();
  validation=EditLogFileInputStream.validateEditLog(editLog);
  assertTrue("Edit log should have more valid data after writing a txn " + "(was: " + oldLength + " now: "+ validation.getValidLength()+ ")",validation.getValidLength() > oldLength);
  assertEquals(1,validation.getEndTxId() - START_TXID);
  assertEquals("Edit log should be 1MB long, plus 4 bytes for the version number",EditLogFileOutputStream.PREALLOCATION_LENGTH + 4,editLog.length());
  assertTrue("Edit log disk space used should be at least 257 blocks",256 * 4096 <= new DU(editLog,conf).getUsed());
}
