{
  CSAssignment assignment=new CSAssignment(Resources.createResource(0,0),NodeType.NODE_LOCAL);
  printChildQueues();
  for (Iterator<CSQueue> iter=childQueues.iterator(); iter.hasNext(); ) {
    CSQueue childQueue=iter.next();
    if (LOG.isDebugEnabled()) {
      LOG.debug("Trying to assign to queue: " + childQueue.getQueuePath() + " stats: "+ childQueue);
    }
    ResourceLimits childLimits=getResourceLimitsOfChild(childQueue,cluster,limits);
    assignment=childQueue.assignContainers(cluster,node,needToUnreserve,childLimits);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Assigned to queue: " + childQueue.getQueuePath() + " stats: "+ childQueue+ " --> "+ assignment.getResource()+ ", "+ assignment.getType());
    }
    if (Resources.greaterThan(resourceCalculator,cluster,assignment.getResource(),Resources.none())) {
      iter.remove();
      LOG.info("Re-sorting assigned queue: " + childQueue.getQueuePath() + " stats: "+ childQueue);
      childQueues.add(childQueue);
      if (LOG.isDebugEnabled()) {
        printChildQueues();
      }
      break;
    }
  }
  return assignment;
}
