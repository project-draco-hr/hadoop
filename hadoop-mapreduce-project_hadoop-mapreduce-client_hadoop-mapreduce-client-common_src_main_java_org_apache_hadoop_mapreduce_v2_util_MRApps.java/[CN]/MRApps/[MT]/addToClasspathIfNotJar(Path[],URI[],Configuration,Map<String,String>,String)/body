{
  if (paths != null) {
    HashMap<Path,String> linkLookup=new HashMap<Path,String>();
    if (withLinks != null) {
      for (      URI u : withLinks) {
        Path p=new Path(u);
        FileSystem remoteFS=p.getFileSystem(conf);
        p=remoteFS.resolvePath(p.makeQualified(remoteFS.getUri(),remoteFS.getWorkingDirectory()));
        String name=(null == u.getFragment()) ? p.getName() : u.getFragment();
        if (!name.toLowerCase().endsWith(".jar")) {
          linkLookup.put(p,name);
        }
      }
    }
    for (    Path p : paths) {
      FileSystem remoteFS=p.getFileSystem(conf);
      p=remoteFS.resolvePath(p.makeQualified(remoteFS.getUri(),remoteFS.getWorkingDirectory()));
      String name=linkLookup.get(p);
      if (name == null) {
        name=p.getName();
      }
      if (!name.toLowerCase().endsWith(".jar")) {
        MRApps.addToEnvironment(environment,classpathEnvVar,crossPlatformifyMREnv(conf,Environment.PWD) + Path.SEPARATOR + name,conf);
      }
    }
  }
}
