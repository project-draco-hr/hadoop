{
  InputStream classpathFileStream=null;
  try {
    ClassLoader thisClassLoader=Thread.currentThread().getContextClassLoader();
    String mrAppGeneratedClasspathFile="mrapp-generated-classpath";
    classpathFileStream=thisClassLoader.getResourceAsStream(mrAppGeneratedClasspathFile);
    BufferedReader reader=new BufferedReader(new InputStreamReader(classpathFileStream));
    String cp=reader.readLine();
    if (cp != null) {
      addToClassPath(environment,cp.trim());
    }
    addToClassPath(environment,thisClassLoader.getResource(mrAppGeneratedClasspathFile).getFile());
    if (System.getenv().get("YARN_HOME") != null) {
      ShellCommandExecutor exec=new ShellCommandExecutor(new String[]{System.getenv().get("YARN_HOME") + "/bin/yarn","classpath"});
      exec.execute();
      addToClassPath(environment,exec.getOutput().trim());
    }
    if (System.getenv().get("HADOOP_MAPRED_HOME") != null) {
      ShellCommandExecutor exec=new ShellCommandExecutor(new String[]{System.getenv().get("HADOOP_MAPRED_HOME") + "/bin/mapred","classpath"});
      exec.execute();
      addToClassPath(environment,exec.getOutput().trim());
    }
  }
  finally {
    if (classpathFileStream != null) {
      classpathFileStream.close();
    }
  }
}
