{
  InputStream classpathFileStream=null;
  BufferedReader reader=null;
  try {
    ClassLoader thisClassLoader=Thread.currentThread().getContextClassLoader();
    String mrAppGeneratedClasspathFile="mrapp-generated-classpath";
    classpathFileStream=thisClassLoader.getResourceAsStream(mrAppGeneratedClasspathFile);
    URL classpathResource=thisClassLoader.getResource(mrAppGeneratedClasspathFile);
    if (classpathResource != null) {
      String classpathElement=classpathResource.getFile();
      if (classpathElement.contains("!")) {
        classpathElement=classpathElement.substring(0,classpathElement.indexOf("!"));
      }
 else {
        classpathElement=new File(classpathElement).getParent();
      }
      Apps.addToEnvironment(environment,Environment.CLASSPATH.name(),classpathElement);
    }
    if (classpathFileStream != null) {
      reader=new BufferedReader(new InputStreamReader(classpathFileStream));
      String cp=reader.readLine();
      if (cp != null) {
        Apps.addToEnvironment(environment,Environment.CLASSPATH.name(),cp.trim());
      }
    }
    for (    String c : conf.getStrings(YarnConfiguration.YARN_APPLICATION_CLASSPATH,YarnConfiguration.DEFAULT_YARN_APPLICATION_CLASSPATH)) {
      Apps.addToEnvironment(environment,Environment.CLASSPATH.name(),c.trim());
    }
    for (    String c : conf.getStrings(MRJobConfig.MAPREDUCE_APPLICATION_CLASSPATH,MRJobConfig.DEFAULT_MAPREDUCE_APPLICATION_CLASSPATH)) {
      Apps.addToEnvironment(environment,Environment.CLASSPATH.name(),c.trim());
    }
  }
  finally {
    if (classpathFileStream != null) {
      classpathFileStream.close();
    }
    if (reader != null) {
      reader.close();
    }
  }
}
