{
  HdfsBlocksMetadata resp;
  try {
    String poolId=request.getBlockPoolId();
    List<Token<BlockTokenIdentifier>> tokens=new ArrayList<Token<BlockTokenIdentifier>>(request.getTokensCount());
    for (    TokenProto b : request.getTokensList()) {
      tokens.add(PBHelper.convert(b));
    }
    long[] blockIds=Longs.toArray(request.getBlockIdsList());
    resp=impl.getHdfsBlocksMetadata(poolId,blockIds,tokens);
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
  List<ByteString> volumeIdsByteStrings=new ArrayList<ByteString>(resp.getVolumeIds().size());
  for (  byte[] b : resp.getVolumeIds()) {
    volumeIdsByteStrings.add(ByteString.copyFrom(b));
  }
  Builder builder=GetHdfsBlockLocationsResponseProto.newBuilder();
  builder.addAllVolumeIds(volumeIdsByteStrings);
  builder.addAllVolumeIndexes(resp.getVolumeIndexes());
  return builder.build();
}
