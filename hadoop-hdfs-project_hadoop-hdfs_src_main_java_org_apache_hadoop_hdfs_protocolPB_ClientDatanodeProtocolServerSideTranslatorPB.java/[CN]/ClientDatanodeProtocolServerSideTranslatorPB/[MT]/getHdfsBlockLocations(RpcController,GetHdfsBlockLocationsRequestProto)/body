{
  HdfsBlocksMetadata resp;
  try {
    List<ExtendedBlock> blocks=new ArrayList<ExtendedBlock>(request.getBlocksCount());
    for (    ExtendedBlockProto b : request.getBlocksList()) {
      blocks.add(PBHelper.convert(b));
    }
    List<Token<BlockTokenIdentifier>> tokens=new ArrayList<Token<BlockTokenIdentifier>>(request.getTokensCount());
    for (    TokenProto b : request.getTokensList()) {
      tokens.add(PBHelper.convert(b));
    }
    resp=impl.getHdfsBlocksMetadata(blocks,tokens);
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
  List<ByteString> volumeIdsByteStrings=new ArrayList<ByteString>(resp.getVolumeIds().size());
  for (  byte[] b : resp.getVolumeIds()) {
    volumeIdsByteStrings.add(ByteString.copyFrom(b));
  }
  Builder builder=GetHdfsBlockLocationsResponseProto.newBuilder();
  builder.addAllVolumeIds(volumeIdsByteStrings);
  builder.addAllVolumeIndexes(resp.getVolumeIndexes());
  return builder.build();
}
