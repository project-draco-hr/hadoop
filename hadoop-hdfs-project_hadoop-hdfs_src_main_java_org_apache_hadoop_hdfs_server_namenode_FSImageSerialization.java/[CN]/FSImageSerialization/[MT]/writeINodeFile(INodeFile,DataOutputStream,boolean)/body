{
  byte[] name=node.getLocalNameBytes();
  out.writeShort(name.length);
  out.write(name);
  INodeFile fileINode=node;
  out.writeShort(fileINode.getFileReplication());
  out.writeLong(fileINode.getModificationTime());
  out.writeLong(fileINode.getAccessTime());
  out.writeLong(fileINode.getPreferredBlockSize());
  if (writeBlock) {
    Block[] blocks=fileINode.getBlocks();
    out.writeInt(blocks.length);
    out.writeBoolean(true);
    for (    Block blk : blocks)     blk.write(out);
  }
 else {
    out.writeInt(0);
    out.writeBoolean(false);
  }
  if (node instanceof INodeFileSnapshot || node instanceof INodeFileUnderConstructionSnapshot) {
    out.writeLong(node.computeFileSize(true));
    if (node instanceof INodeFileUnderConstructionSnapshot) {
      out.writeBoolean(true);
      writeString(((INodeFileUnderConstruction)node).getClientName(),out);
      writeString(((INodeFileUnderConstruction)node).getClientMachine(),out);
    }
 else {
      out.writeBoolean(false);
    }
  }
 else {
    out.writeLong(-1);
    out.writeBoolean(node instanceof FileWithSnapshot);
  }
  FsPermission filePerm=TL_DATA.get().FILE_PERM;
  filePerm.fromShort(fileINode.getFsPermissionShort());
  PermissionStatus.write(out,fileINode.getUserName(),fileINode.getGroupName(),filePerm);
}
