{
  ServerSocket server;
  if (port < 0) {
    server=new ServerSocket(0);
  }
 else {
    int freePort=port + 1;
    while (true) {
      try {
        server=new ServerSocket(freePort);
        break;
      }
 catch (      IOException e) {
        if (e instanceof BindException) {
          if (freePort >= MAX_AVAILABLE_PORT || freePort < MIN_AVAILABLE_PORT) {
            throw e;
          }
        }
 else {
          throw e;
        }
        freePort+=1;
      }
    }
  }
  int fport=server.getLocalPort();
  server.close();
  return fport;
}
