{
  Configuration conf=new Configuration();
  final String permStr=conf.get(DFSConfigKeys.DFS_DATANODE_DATA_DIR_PERMISSION_KEY);
  FsPermission expected=new FsPermission(permStr);
  FileSystem localFS=FileSystem.getLocal(conf);
  for (  DataNode dn : cluster.getDataNodes()) {
    try (FsDatasetSpi.FsVolumeReferences volumes=dn.getFSDataset().getFsVolumeReferences()){
      for (      FsVolumeSpi vol : volumes) {
        String dir=vol.getBasePath();
        Path dataDir=new Path(dir);
        FsPermission actual=localFS.getFileStatus(dataDir).getPermission();
        assertEquals("Permission for dir: " + dataDir + ", is "+ actual+ ", while expected is "+ expected,expected,actual);
      }
    }
   }
}
