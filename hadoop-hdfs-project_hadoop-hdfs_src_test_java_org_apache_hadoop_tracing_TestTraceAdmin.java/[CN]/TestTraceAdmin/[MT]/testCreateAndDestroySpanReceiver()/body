{
  Configuration conf=new Configuration();
  conf=new Configuration();
  conf.set(SpanReceiverHost.SPAN_RECEIVERS_CONF_KEY,"");
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
  cluster.waitActive();
  TemporarySocketDirectory tempDir=new TemporarySocketDirectory();
  String tracePath=new File(tempDir.getDir(),"tracefile").getAbsolutePath();
  try {
    TraceAdmin trace=new TraceAdmin();
    trace.setConf(conf);
    Assert.assertEquals("ret:0, [no span receivers found]\n",runTraceCommand(trace,"-list","-host",getHostPortForNN(cluster)));
    Assert.assertEquals("ret:0, Added trace span receiver 1 with " + "configuration local-file-span-receiver.path = " + tracePath + "\n",runTraceCommand(trace,"-add","-host",getHostPortForNN(cluster),"-class","org.htrace.impl.LocalFileSpanReceiver","-Clocal-file-span-receiver.path=" + tracePath));
    String list=runTraceCommand(trace,"-list","-host",getHostPortForNN(cluster));
    Assert.assertTrue(list.startsWith("ret:0"));
    Assert.assertTrue(list.contains("1   org.htrace.impl.LocalFileSpanReceiver"));
    Assert.assertEquals("ret:0, Removed trace span receiver 1\n",runTraceCommand(trace,"-remove","1","-host",getHostPortForNN(cluster)));
    Assert.assertEquals("ret:0, [no span receivers found]\n",runTraceCommand(trace,"-list","-host",getHostPortForNN(cluster)));
    Assert.assertEquals("ret:0, Added trace span receiver 2 with " + "configuration local-file-span-receiver.path = " + tracePath + "\n",runTraceCommand(trace,"-add","-host",getHostPortForNN(cluster),"-class","LocalFileSpanReceiver","-Clocal-file-span-receiver.path=" + tracePath));
    Assert.assertEquals("ret:0, Removed trace span receiver 2\n",runTraceCommand(trace,"-remove","2","-host",getHostPortForNN(cluster)));
  }
  finally {
    cluster.shutdown();
    tempDir.close();
  }
}
