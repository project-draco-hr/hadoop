{
  assertCounter("VolumeFailures",expectedVolumeFailuresCounter,getMetrics(dn.getMetrics().name()));
  FsDatasetSpi<?> fsd=dn.getFSDataset();
  assertEquals(expectedFailedVolumes.length,fsd.getNumFailedVolumes());
  assertArrayEquals(expectedFailedVolumes,fsd.getFailedStorageLocations());
  if (expectedFailedVolumes.length > 0) {
    assertTrue(fsd.getLastVolumeFailureDate() > 0);
    long expectedCapacityLost=getExpectedCapacityLost(expectCapacityKnown,expectedFailedVolumes.length);
    assertEquals(expectedCapacityLost,fsd.getEstimatedCapacityLostTotal());
  }
 else {
    assertEquals(0,fsd.getLastVolumeFailureDate());
    assertEquals(0,fsd.getEstimatedCapacityLostTotal());
  }
}
