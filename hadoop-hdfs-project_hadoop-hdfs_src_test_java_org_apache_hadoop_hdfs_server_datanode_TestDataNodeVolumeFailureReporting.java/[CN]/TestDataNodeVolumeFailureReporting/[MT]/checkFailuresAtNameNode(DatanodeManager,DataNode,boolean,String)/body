{
  DatanodeDescriptor dd=cluster.getNamesystem().getBlockManager().getDatanodeManager().getDatanode(dn.getDatanodeId());
  assertEquals(expectedFailedVolumes.length,dd.getVolumeFailures());
  VolumeFailureSummary volumeFailureSummary=dd.getVolumeFailureSummary();
  if (expectedFailedVolumes.length > 0) {
    assertArrayEquals(expectedFailedVolumes,volumeFailureSummary.getFailedStorageLocations());
    assertTrue(volumeFailureSummary.getLastVolumeFailureDate() > 0);
    long expectedCapacityLost=getExpectedCapacityLost(expectCapacityKnown,expectedFailedVolumes.length);
    assertEquals(expectedCapacityLost,volumeFailureSummary.getEstimatedCapacityLostTotal());
  }
 else {
    assertNull(volumeFailureSummary);
  }
}
