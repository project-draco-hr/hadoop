{
  final int failedDNIdx=2;
  final int length=cellSize * (dataBlocks + 2);
  Path testPath=new Path(file);
  final byte[] bytes=StripedFileTestUtil.generateBytes(length);
  DFSTestUtil.writeFile(fs,testPath,bytes);
  BlockLocation[] locs=fs.getFileBlockLocations(testPath,cellSize * 5,cellSize);
  String name=(locs[0].getNames())[failedDNIdx];
  for (  DataNode dn : cluster.getDataNodes()) {
    int port=dn.getXferPort();
    if (name.contains(Integer.toString(port))) {
      dn.shutdown();
      break;
    }
  }
  try (FSDataInputStream fsdis=fs.open(testPath)){
    byte[] buf=new byte[length];
    int readLen=fsdis.read(startOffsetInFile,buf,0,buf.length);
    Assert.assertEquals("The length of file should be the same to write size",length - startOffsetInFile,readLen);
    byte[] expected=new byte[readLen];
    for (int i=startOffsetInFile; i < length; i++) {
      expected[i - startOffsetInFile]=StripedFileTestUtil.getByte(i);
    }
    for (int i=startOffsetInFile; i < length; i++) {
      Assert.assertEquals("Byte at " + i + " should be the same",expected[i - startOffsetInFile],buf[i - startOffsetInFile]);
    }
  }
 }
