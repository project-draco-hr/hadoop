{
  String rootDir="/";
  StringBuffer fsnStrBefore=fsn.getFSDirectory().getINode(rootDir).dumpTreeRecursively();
  cluster.shutdown();
  cluster=new MiniDFSCluster.Builder(conf).format(false).numDataNodes(REPLICATION).build();
  cluster.waitActive();
  fsn=cluster.getNamesystem();
  hdfs=cluster.getFileSystem();
  StringBuffer fsnStrMiddle=fsn.getFSDirectory().getINode(rootDir).dumpTreeRecursively();
  hdfs.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
  hdfs.saveNamespace();
  hdfs.setSafeMode(SafeModeAction.SAFEMODE_LEAVE);
  cluster.shutdown();
  cluster=new MiniDFSCluster.Builder(conf).format(false).numDataNodes(REPLICATION).build();
  cluster.waitActive();
  fsn=cluster.getNamesystem();
  hdfs=cluster.getFileSystem();
  StringBuffer fsnStrAfter=fsn.getFSDirectory().getINode(rootDir).dumpTreeRecursively();
  System.out.println("================== Original FSDir ==================");
  System.out.println(fsnStrBefore.toString());
  System.out.println("================== FSDir After Applying Edit Logs ==================");
  System.out.println(fsnStrMiddle.toString());
  System.out.println("================ FSDir After FSImage Saving/Loading ================");
  System.out.println(fsnStrAfter.toString());
  System.out.println("====================================================");
  assertEquals(fsnStrBefore.toString(),fsnStrMiddle.toString());
  assertEquals(fsnStrBefore.toString(),fsnStrAfter.toString());
}
