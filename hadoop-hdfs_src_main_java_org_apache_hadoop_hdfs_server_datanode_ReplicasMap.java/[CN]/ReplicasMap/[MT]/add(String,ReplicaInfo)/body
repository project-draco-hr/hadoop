{
  checkBlockPool(bpid);
  checkBlock(replicaInfo);
synchronized (mutex) {
    Map<Long,ReplicaInfo> m=map.get(bpid);
    if (m == null) {
      m=new HashMap<Long,ReplicaInfo>();
      map.put(bpid,m);
    }
    return m.put(replicaInfo.getBlockId(),replicaInfo);
  }
}
