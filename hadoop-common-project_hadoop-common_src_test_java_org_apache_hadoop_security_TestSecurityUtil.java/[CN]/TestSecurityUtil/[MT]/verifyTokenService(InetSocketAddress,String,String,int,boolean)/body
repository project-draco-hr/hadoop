{
  Configuration conf=new Configuration(false);
  conf.setBoolean(CommonConfigurationKeys.HADOOP_SECURITY_TOKEN_SERVICE_USE_IP,useIp);
  SecurityUtil.setConfiguration(conf);
  String serviceHost=useIp ? ip : StringUtils.toLowerCase(host);
  Token<?> token=new Token<TokenIdentifier>();
  Text service=new Text(serviceHost + ":" + port);
  assertEquals(service,SecurityUtil.buildTokenService(addr));
  SecurityUtil.setTokenService(token,addr);
  assertEquals(service,token.getService());
  InetSocketAddress serviceAddr=SecurityUtil.getTokenServiceAddr(token);
  assertNotNull(serviceAddr);
  verifyValues(serviceAddr,serviceHost,ip,port);
}
