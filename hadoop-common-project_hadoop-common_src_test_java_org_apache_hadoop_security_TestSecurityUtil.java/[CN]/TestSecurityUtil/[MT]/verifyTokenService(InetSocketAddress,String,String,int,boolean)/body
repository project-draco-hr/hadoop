{
  SecurityUtil.setTokenServiceUseIp(useIp);
  String serviceHost=useIp ? ip : host.toLowerCase(Locale.ENGLISH);
  Token<?> token=new Token<TokenIdentifier>();
  Text service=new Text(serviceHost + ":" + port);
  assertEquals(service,SecurityUtil.buildTokenService(addr));
  SecurityUtil.setTokenService(token,addr);
  assertEquals(service,token.getService());
  InetSocketAddress serviceAddr=SecurityUtil.getTokenServiceAddr(token);
  assertNotNull(serviceAddr);
  verifyValues(serviceAddr,serviceHost,ip,port);
}
