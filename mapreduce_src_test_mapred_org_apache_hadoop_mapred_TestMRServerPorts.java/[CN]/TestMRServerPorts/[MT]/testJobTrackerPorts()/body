{
  NameNode nn=null;
  DataNode dn=null;
  try {
    nn=hdfs.startNameNode();
    setDataNodePorts(hdfs.getConfig());
    dn=hdfs.startDataNode(1,hdfs.getConfig());
    JobConf conf2=new JobConf(hdfs.getConfig());
    conf2.set(JTConfig.JT_IPC_ADDRESS,FileSystem.getDefaultUri(hdfs.getConfig()).toString());
    conf2.set(JTConfig.JT_HTTP_ADDRESS,THIS_HOST);
    boolean started=canStartJobTracker(conf2);
    assertFalse(started);
    conf2.set(JTConfig.JT_IPC_ADDRESS,THIS_HOST);
    conf2.set(JTConfig.JT_HTTP_ADDRESS,hdfs.getConfig().get("dfs.http.address"));
    started=canStartJobTracker(conf2);
    assertFalse(started);
    conf2.set(JTConfig.JT_IPC_ADDRESS,THIS_HOST);
    conf2.set(JTConfig.JT_HTTP_ADDRESS,THIS_HOST);
    started=canStartJobTracker(conf2);
    assertTrue(started);
  }
  finally {
    hdfs.stopDataNode(dn);
    hdfs.stopNameNode(nn);
  }
}
