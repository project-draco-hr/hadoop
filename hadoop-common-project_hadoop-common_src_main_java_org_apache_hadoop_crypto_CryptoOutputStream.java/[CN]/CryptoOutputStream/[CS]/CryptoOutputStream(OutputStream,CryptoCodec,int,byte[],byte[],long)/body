{
  super(out);
  Preconditions.checkArgument(bufferSize >= MIN_BUFFER_SIZE,"Minimum value of buffer size is 512.");
  this.key=key;
  this.initIV=iv;
  this.iv=iv.clone();
  inBuffer=ByteBuffer.allocateDirect(bufferSize);
  outBuffer=ByteBuffer.allocateDirect(bufferSize);
  this.streamOffset=streamOffset;
  this.codec=codec;
  try {
    encryptor=codec.getEncryptor();
  }
 catch (  GeneralSecurityException e) {
    throw new IOException(e);
  }
  updateEncryptor();
}
