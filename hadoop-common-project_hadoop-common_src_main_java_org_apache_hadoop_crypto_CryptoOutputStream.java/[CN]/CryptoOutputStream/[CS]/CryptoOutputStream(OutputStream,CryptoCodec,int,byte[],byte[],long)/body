{
  super(out);
  CryptoStreamUtils.checkCodec(codec);
  this.bufferSize=CryptoStreamUtils.checkBufferSize(codec,bufferSize);
  this.codec=codec;
  this.key=key.clone();
  this.initIV=iv.clone();
  this.iv=iv.clone();
  inBuffer=ByteBuffer.allocateDirect(this.bufferSize);
  outBuffer=ByteBuffer.allocateDirect(this.bufferSize);
  this.streamOffset=streamOffset;
  try {
    encryptor=codec.createEncryptor();
  }
 catch (  GeneralSecurityException e) {
    throw new IOException(e);
  }
  updateEncryptor();
}
