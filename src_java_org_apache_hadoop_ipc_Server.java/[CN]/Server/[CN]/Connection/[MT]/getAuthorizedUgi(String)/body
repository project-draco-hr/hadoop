{
  if (authMethod == SaslRpcServer.AuthMethod.DIGEST) {
    TokenIdentifier tokenId=SaslRpcServer.getIdentifier(authorizedId,secretManager);
    UserGroupInformation ugi=tokenId.getUser();
    if (ugi == null) {
      throw new AccessControlException("Can't retrieve username from tokenIdentifier.");
    }
    ugi.addTokenIdentifier(tokenId);
    return ugi;
  }
 else {
    return UserGroupInformation.createRemoteUser(authorizedId);
  }
}
