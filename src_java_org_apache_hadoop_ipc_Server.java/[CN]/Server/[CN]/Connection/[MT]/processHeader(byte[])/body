{
  DataInputStream in=new DataInputStream(new ByteArrayInputStream(buf));
  header.readFields(in);
  try {
    String protocolClassName=header.getProtocol();
    if (protocolClassName != null) {
      protocol=getProtocolClass(header.getProtocol(),conf);
    }
  }
 catch (  ClassNotFoundException cnfe) {
    throw new IOException("Unknown protocol: " + header.getProtocol());
  }
  UserGroupInformation protocolUser=header.getUgi();
  if (!useSasl) {
    user=protocolUser;
  }
 else   if (protocolUser != null && !protocolUser.equals(user)) {
    throw new AccessControlException("Authenticated user (" + user + ") doesn't match what the client claims to be ("+ protocolUser+ ")");
  }
}
