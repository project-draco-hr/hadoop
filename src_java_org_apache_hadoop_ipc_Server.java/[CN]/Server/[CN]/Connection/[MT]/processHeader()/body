{
  DataInputStream in=new DataInputStream(new ByteArrayInputStream(data.array()));
  header.readFields(in);
  try {
    String protocolClassName=header.getProtocol();
    if (protocolClassName != null) {
      protocol=getProtocolClass(header.getProtocol(),conf);
    }
  }
 catch (  ClassNotFoundException cnfe) {
    throw new IOException("Unknown protocol: " + header.getProtocol());
  }
  UserGroupInformation ugi=header.getUgi();
  user=null;
  if (ugi != null) {
    user=SecurityUtil.getSubject(conf,header.getUgi().getUserName());
  }
}
