{
  ApplicationAttemptId applicationAttemptId=authorizeRequest();
  AllocateResponseLock lock=responseMap.get(applicationAttemptId);
  if (lock == null) {
    throwApplicationDoesNotExistInCacheException(applicationAttemptId);
  }
synchronized (lock) {
    this.amLivelinessMonitor.receivedPing(applicationAttemptId);
    rmContext.getDispatcher().getEventHandler().handle(new RMAppAttemptUnregistrationEvent(applicationAttemptId,request.getTrackingUrl(),request.getFinalApplicationStatus(),request.getDiagnostics()));
    if (rmContext.getRMApps().get(applicationAttemptId.getApplicationId()).isAppSafeToUnregister()) {
      return FinishApplicationMasterResponse.newInstance(true);
    }
 else {
      return FinishApplicationMasterResponse.newInstance(false);
    }
  }
}
