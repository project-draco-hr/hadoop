{
  ApplicationAttemptId applicationAttemptId=request.getApplicationAttemptId();
  authorizeRequest(applicationAttemptId);
  AllocateResponse lastResponse=responseMap.get(applicationAttemptId);
  if (lastResponse == null) {
    String message="Application doesn't exist in cache " + applicationAttemptId;
    LOG.error(message);
    throw RPCUtil.getRemoteException(message);
  }
synchronized (lastResponse) {
    this.amLivelinessMonitor.receivedPing(applicationAttemptId);
    rmContext.getDispatcher().getEventHandler().handle(new RMAppAttemptUnregistrationEvent(applicationAttemptId,request.getTrackingUrl(),request.getFinalApplicationStatus(),request.getDiagnostics()));
    FinishApplicationMasterResponse response=recordFactory.newRecordInstance(FinishApplicationMasterResponse.class);
    return response;
  }
}
