{
  String currentUser=System.getProperty("user.name");
  config.set(DefaultImpersonationProvider.getTestProvider().getProxySuperuserGroupConfKey(currentUser),"*");
  config.set(DefaultImpersonationProvider.getTestProvider().getProxySuperuserIpConfKey(currentUser),"*");
  ProxyUsers.refreshSuperUserGroupsConfiguration(config);
  cluster=new MiniDFSCluster.Builder(config).numDataNodes(1).build();
  cluster.waitActive();
  hdfs=cluster.getFileSystem();
  nn=cluster.getNameNode();
  config.setInt("nfs3.mountd.port",0);
  config.setInt("nfs3.server.port",0);
  Nfs3 nfs3=new Nfs3(config);
  nfs3.startServiceInternal(false);
  nfsd=(RpcProgramNfs3)nfs3.getRpcProgram();
  securityHandler=Mockito.mock(SecurityHandler.class);
  Mockito.when(securityHandler.getUser()).thenReturn(System.getProperty("user.name"));
}
