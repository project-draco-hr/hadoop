{
  int tryPort=port;
  int tries=0;
  while (true) {
    if (tries > 0 || tryPort == 0) {
      tryPort=port + rand.nextInt(65535 - port);
    }
    if (tryPort == 0) {
      continue;
    }
    LOG.info("Using port " + tryPort);
    try (ServerSocket s=new ServerSocket(tryPort)){
      return tryPort;
    }
 catch (    IOException e) {
      tries++;
      if (tries >= retries) {
        LOG.info("Port is already in use; giving up");
        throw e;
      }
 else {
        LOG.info("Port is already in use; trying again");
      }
    }
  }
}
