{
  AuthenticationToken token;
  String delegationParam=this.getEncodedDelegationTokenFromRequest(request);
  if (delegationParam != null) {
    Token<RMDelegationTokenIdentifier> dt=new Token<RMDelegationTokenIdentifier>();
    ;
    dt.decodeFromUrlString(delegationParam);
    UserGroupInformation ugi=this.verifyToken(dt);
    if (ugi == null) {
      throw new AuthenticationException("Invalid token");
    }
    final String shortName=ugi.getShortUserName();
    token=new AuthenticationToken(shortName,ugi.getUserName(),getType());
  }
 else {
    token=super.authenticate(request,response);
    if (token != null) {
      token=new AuthenticationToken(token.getUserName(),token.getName(),super.getType());
    }
  }
  return token;
}
