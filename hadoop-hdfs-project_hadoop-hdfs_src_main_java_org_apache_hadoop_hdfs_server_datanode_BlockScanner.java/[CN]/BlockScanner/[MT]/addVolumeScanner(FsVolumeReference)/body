{
  boolean success=false;
  try {
    FsVolumeSpi volume=ref.getVolume();
    if (!isEnabled()) {
      LOG.debug("Not adding volume scanner for {}, because the block " + "scanner is disabled.",volume.getBasePath());
      return;
    }
    VolumeScanner scanner=scanners.get(volume.getStorageID());
    if (scanner != null) {
      LOG.error("Already have a scanner for volume {}.",volume.getBasePath());
      return;
    }
    LOG.debug("Adding scanner for volume {} (StorageID {})",volume.getBasePath(),volume.getStorageID());
    scanner=new VolumeScanner(conf,datanode,ref);
    scanner.start();
    scanners.put(volume.getStorageID(),scanner);
    success=true;
  }
  finally {
    if (!success) {
      IOUtils.cleanup(null,ref);
    }
  }
}
