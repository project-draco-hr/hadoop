{
  Path srcPath=new Path(srcf);
  Path dstPath=new Path(dstf);
  FileSystem fs=srcPath.getFileSystem(getConf());
  URI srcURI=fs.getUri();
  URI dstURI=dstPath.getFileSystem(getConf()).getUri();
  if (srcURI.compareTo(dstURI) != 0) {
    throw new IOException("src and destination filesystems do not match.");
  }
  Path[] srcs=FileUtil.stat2Paths(fs.globStatus(srcPath),srcPath);
  Path dst=new Path(dstf);
  if (srcs.length > 1 && !fs.isDirectory(dst)) {
    throw new IOException("When moving multiple files, " + "destination should be a directory.");
  }
  for (int i=0; i < srcs.length; i++) {
    if (!fs.rename(srcs[i],dst)) {
      FileStatus srcFstatus=null;
      FileStatus dstFstatus=null;
      try {
        srcFstatus=fs.getFileStatus(srcs[i]);
      }
 catch (      FileNotFoundException e) {
        throw new FileNotFoundException(srcs[i] + ": No such file or directory");
      }
      try {
        dstFstatus=fs.getFileStatus(dst);
      }
 catch (      IOException e) {
      }
      if ((srcFstatus != null) && (dstFstatus != null)) {
        if (srcFstatus.isDir() && !dstFstatus.isDir()) {
          throw new IOException("cannot overwrite non directory " + dst + " with directory "+ srcs[i]);
        }
      }
      throw new IOException("Failed to rename " + srcs[i] + " to "+ dst);
    }
  }
}
