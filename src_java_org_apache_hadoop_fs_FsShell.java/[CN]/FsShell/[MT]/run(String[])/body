{
  commandFactory.setConf(getConf());
  commandFactory.registerCommands(FsCommand.class);
  if (argv.length < 1) {
    printUsage("");
    return -1;
  }
  int exitCode=-1;
  int i=0;
  String cmd=argv[i++];
  try {
    init();
  }
 catch (  RPC.VersionMismatch v) {
    LOG.debug("Version mismatch",v);
    System.err.println("Version Mismatch between client and server" + "... command aborted.");
    return exitCode;
  }
catch (  IOException e) {
    LOG.debug("Error",e);
    System.err.println("Bad connection to FS. Command aborted. Exception: " + e.getLocalizedMessage());
    return exitCode;
  }
  try {
    Command instance=commandFactory.getInstance(cmd);
    if (instance != null) {
      exitCode=instance.run(Arrays.copyOfRange(argv,i,argv.length));
    }
 else     if ("-help".equals(cmd)) {
      if (i < argv.length) {
        printHelp(argv[i]);
      }
 else {
        printHelp("");
      }
    }
 else {
      System.err.println(cmd + ": Unknown command");
      printUsage("");
    }
  }
 catch (  Exception e) {
    exitCode=1;
    LOG.debug("Error",e);
    displayError(cmd,e);
    if (e instanceof IllegalArgumentException) {
      exitCode=-1;
      printUsage(cmd);
    }
  }
  return exitCode;
}
