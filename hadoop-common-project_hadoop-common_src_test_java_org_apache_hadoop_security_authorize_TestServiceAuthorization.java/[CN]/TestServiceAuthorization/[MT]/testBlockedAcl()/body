{
  UserGroupInformation drwho=UserGroupInformation.createUserForTesting("drwho@EXAMPLE.COM",new String[]{"group1","group2"});
  ServiceAuthorizationManager serviceAuthorizationManager=new ServiceAuthorizationManager();
  Configuration conf=new Configuration();
  conf.set(ACL_CONFIG,"user1 group1");
  serviceAuthorizationManager.refresh(conf,new TestPolicyProvider());
  try {
    serviceAuthorizationManager.authorize(drwho,TestProtocol.class,conf,InetAddress.getByName(ADDRESS));
  }
 catch (  AuthorizationException e) {
    fail();
  }
  conf.set(ACL_CONFIG + ServiceAuthorizationManager.BLOCKED,"drwho2 group3");
  serviceAuthorizationManager.refresh(conf,new TestPolicyProvider());
  try {
    serviceAuthorizationManager.authorize(drwho,TestProtocol.class,conf,InetAddress.getByName(ADDRESS));
  }
 catch (  AuthorizationException e) {
    fail();
  }
  conf.set(ACL_CONFIG + ServiceAuthorizationManager.BLOCKED,"drwho group3");
  serviceAuthorizationManager.refresh(conf,new TestPolicyProvider());
  try {
    serviceAuthorizationManager.authorize(drwho,TestProtocol.class,conf,InetAddress.getByName(ADDRESS));
    fail();
  }
 catch (  AuthorizationException e) {
  }
  conf.set(ACL_CONFIG + ServiceAuthorizationManager.BLOCKED,"drwho2 group3");
  serviceAuthorizationManager.refresh(conf,new TestPolicyProvider());
  try {
    serviceAuthorizationManager.authorize(drwho,TestProtocol.class,conf,InetAddress.getByName(ADDRESS));
  }
 catch (  AuthorizationException e) {
    fail();
  }
  conf.set(ACL_CONFIG + ServiceAuthorizationManager.BLOCKED,"drwho2 group2");
  serviceAuthorizationManager.refresh(conf,new TestPolicyProvider());
  try {
    serviceAuthorizationManager.authorize(drwho,TestProtocol.class,conf,InetAddress.getByName(ADDRESS));
    fail();
  }
 catch (  AuthorizationException e) {
  }
  conf.set(ACL_CONFIG + ServiceAuthorizationManager.BLOCKED,"");
  serviceAuthorizationManager.refresh(conf,new TestPolicyProvider());
  try {
    serviceAuthorizationManager.authorize(drwho,TestProtocol.class,conf,InetAddress.getByName(ADDRESS));
  }
 catch (  AuthorizationException e) {
    fail();
  }
}
