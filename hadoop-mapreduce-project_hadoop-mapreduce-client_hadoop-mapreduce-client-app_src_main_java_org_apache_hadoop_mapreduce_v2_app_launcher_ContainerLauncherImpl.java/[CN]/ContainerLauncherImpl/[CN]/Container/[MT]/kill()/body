{
  if (this.state == ContainerState.PREP) {
    this.state=ContainerState.KILLED_BEFORE_LAUNCH;
  }
 else   if (!isCompletelyDone()) {
    LOG.info("KILLING " + taskAttemptID);
    ContainerManagementProtocolProxyData proxy=null;
    try {
      proxy=getCMProxy(this.containerMgrAddress,this.containerID);
      StopContainerRequest stopRequest=Records.newRecord(StopContainerRequest.class);
      stopRequest.setContainerId(this.containerID);
      proxy.getContainerManagementProtocol().stopContainer(stopRequest);
    }
 catch (    Throwable t) {
      String message="cleanup failed for container " + this.containerID + " : "+ StringUtils.stringifyException(t);
      context.getEventHandler().handle(new TaskAttemptDiagnosticsUpdateEvent(this.taskAttemptID,message));
      LOG.warn(message);
    }
 finally {
      if (proxy != null) {
        cmProxy.mayBeCloseProxy(proxy);
      }
    }
    this.state=ContainerState.DONE;
  }
  context.getEventHandler().handle(new TaskAttemptEvent(this.taskAttemptID,TaskAttemptEventType.TA_CONTAINER_CLEANED));
}
