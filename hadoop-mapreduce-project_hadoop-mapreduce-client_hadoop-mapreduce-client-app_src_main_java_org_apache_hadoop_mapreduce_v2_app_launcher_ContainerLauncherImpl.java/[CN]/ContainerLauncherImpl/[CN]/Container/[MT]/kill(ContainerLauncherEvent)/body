{
  if (this.state == ContainerState.PREP) {
    this.state=ContainerState.KILLED_BEFORE_LAUNCH;
  }
 else {
    final String containerManagerBindAddr=event.getContainerMgrAddress();
    ContainerId containerID=event.getContainerID();
    ContainerToken containerToken=event.getContainerToken();
    TaskAttemptId taskAttemptID=event.getTaskAttemptID();
    LOG.info("KILLING " + taskAttemptID);
    ContainerManager proxy=null;
    try {
      proxy=getCMProxy(containerID,containerManagerBindAddr,containerToken);
      StopContainerRequest stopRequest=Records.newRecord(StopContainerRequest.class);
      stopRequest.setContainerId(event.getContainerID());
      proxy.stopContainer(stopRequest);
    }
 catch (    Throwable t) {
      String message="cleanup failed for container " + event.getContainerID() + " : "+ StringUtils.stringifyException(t);
      context.getEventHandler().handle(new TaskAttemptDiagnosticsUpdateEvent(taskAttemptID,message));
      LOG.warn(message);
    }
 finally {
      if (proxy != null) {
        ContainerLauncherImpl.this.rpc.stopProxy(proxy,getConfig());
      }
    }
    this.state=ContainerState.DONE;
  }
  context.getEventHandler().handle(new TaskAttemptEvent(event.getTaskAttemptID(),TaskAttemptEventType.TA_CONTAINER_CLEANED));
}
