{
  LOG.info("Launching " + taskAttemptID);
  if (this.state == ContainerState.KILLED_BEFORE_LAUNCH) {
    state=ContainerState.DONE;
    sendContainerLaunchFailedMsg(taskAttemptID,"Container was killed before it was launched");
    return;
  }
  ContainerManager proxy=null;
  try {
    proxy=getCMProxy(containerID,containerMgrAddress,containerToken);
    ContainerLaunchContext containerLaunchContext=event.getContainer();
    StartContainerRequest startRequest=Records.newRecord(StartContainerRequest.class);
    startRequest.setContainerLaunchContext(containerLaunchContext);
    StartContainerResponse response=proxy.startContainer(startRequest);
    ByteBuffer portInfo=response.getServiceResponse(ShuffleHandler.MAPREDUCE_SHUFFLE_SERVICEID);
    int port=-1;
    if (portInfo != null) {
      port=ShuffleHandler.deserializeMetaData(portInfo);
    }
    LOG.info("Shuffle port returned by ContainerManager for " + taskAttemptID + " : "+ port);
    if (port < 0) {
      this.state=ContainerState.FAILED;
      throw new IllegalStateException("Invalid shuffle port number " + port + " returned for "+ taskAttemptID);
    }
    context.getEventHandler().handle(new TaskAttemptContainerLaunchedEvent(taskAttemptID,port));
    this.state=ContainerState.RUNNING;
  }
 catch (  Throwable t) {
    String message="Container launch failed for " + containerID + " : "+ StringUtils.stringifyException(t);
    this.state=ContainerState.FAILED;
    sendContainerLaunchFailedMsg(taskAttemptID,message);
  }
 finally {
    if (proxy != null) {
      ContainerLauncherImpl.this.rpc.stopProxy(proxy,getConfig());
    }
  }
}
