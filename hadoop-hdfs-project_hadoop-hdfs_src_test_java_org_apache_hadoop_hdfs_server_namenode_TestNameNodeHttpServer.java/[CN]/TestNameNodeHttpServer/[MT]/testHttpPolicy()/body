{
  conf.set(DFSConfigKeys.DFS_HTTP_POLICY_KEY,policy.name());
  conf.set(DFSConfigKeys.DFS_NAMENODE_HTTPS_ADDRESS_KEY,"localhost:0");
  InetSocketAddress addr=InetSocketAddress.createUnresolved("localhost",0);
  NameNodeHttpServer server=null;
  try {
    server=new NameNodeHttpServer(conf,null,addr);
    server.start();
    Assert.assertTrue(implies(policy.isHttpEnabled(),canAccess("http",server.getHttpAddress())));
    Assert.assertTrue(implies(!policy.isHttpEnabled(),server.getHttpAddress() == null));
    Assert.assertTrue(implies(policy.isHttpsEnabled(),canAccess("https",server.getHttpsAddress())));
    Assert.assertTrue(implies(!policy.isHttpsEnabled(),server.getHttpsAddress() == null));
  }
  finally {
    if (server != null) {
      server.stop();
    }
  }
}
