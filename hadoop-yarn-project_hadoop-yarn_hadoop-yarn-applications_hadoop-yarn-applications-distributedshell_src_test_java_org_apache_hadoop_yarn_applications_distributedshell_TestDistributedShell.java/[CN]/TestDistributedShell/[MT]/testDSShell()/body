{
  String[] args={"--jar",APPMASTER_JAR,"--num_containers","2","--shell_command",Shell.WINDOWS ? "dir" : "ls","--master_memory","512","--master_vcores","2","--container_memory","128","--container_vcores","1"};
  LOG.info("Initializing DS Client");
  final Client client=new Client(new Configuration(yarnCluster.getConfig()));
  boolean initSuccess=client.init(args);
  Assert.assertTrue(initSuccess);
  LOG.info("Running DS Client");
  final AtomicBoolean result=new AtomicBoolean(false);
  Thread t=new Thread(){
    public void run(){
      try {
        result.set(client.run());
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
  }
;
  t.start();
  YarnClient yarnClient=YarnClient.createYarnClient();
  yarnClient.init(new Configuration(yarnCluster.getConfig()));
  yarnClient.start();
  String hostName=NetUtils.getHostname();
  boolean verified=false;
  String errorMessage="";
  while (!verified) {
    List<ApplicationReport> apps=yarnClient.getApplications();
    if (apps.size() == 0) {
      Thread.sleep(10);
      continue;
    }
    ApplicationReport appReport=apps.get(0);
    if (appReport.getHost().equals("N/A")) {
      Thread.sleep(10);
      continue;
    }
    errorMessage="Expected host name to start with '" + hostName + "', was '"+ appReport.getHost()+ "'. Expected rpc port to be '-1', was '"+ appReport.getRpcPort()+ "'.";
    if (checkHostname(appReport.getHost()) && appReport.getRpcPort() == -1) {
      verified=true;
    }
    if (appReport.getYarnApplicationState() == YarnApplicationState.FINISHED) {
      break;
    }
  }
  Assert.assertTrue(errorMessage,verified);
  t.join();
  LOG.info("Client run completed. Result=" + result);
  Assert.assertTrue(result.get());
  TimelineEntities entitiesAttempts=yarnCluster.getApplicationHistoryServer().getTimelineStore().getEntities(ApplicationMaster.DSEntity.DS_APP_ATTEMPT.toString(),null,null,null,null,null,null,null,null);
  Assert.assertNotNull(entitiesAttempts);
  Assert.assertEquals(1,entitiesAttempts.getEntities().size());
  Assert.assertEquals(2,entitiesAttempts.getEntities().get(0).getEvents().size());
  Assert.assertEquals(entitiesAttempts.getEntities().get(0).getEntityType().toString(),ApplicationMaster.DSEntity.DS_APP_ATTEMPT.toString());
  TimelineEntities entities=yarnCluster.getApplicationHistoryServer().getTimelineStore().getEntities(ApplicationMaster.DSEntity.DS_CONTAINER.toString(),null,null,null,null,null,null,null,null);
  Assert.assertNotNull(entities);
  Assert.assertEquals(2,entities.getEntities().size());
  Assert.assertEquals(entities.getEntities().get(0).getEntityType().toString(),ApplicationMaster.DSEntity.DS_CONTAINER.toString());
}
