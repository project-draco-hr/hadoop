{
  System.gc();
  System.runFinalization();
  int nUpdaterThreadsStart=getWasbThreadCount();
  assertTrue("Existing WASB threads have not been cleared",nUpdaterThreadsStart == 0);
  final int nFilesystemsToSpawn=10;
  AzureBlobStorageTestAccount testAccount=null;
  for (int i=0; i < nFilesystemsToSpawn; i++) {
    testAccount=AzureBlobStorageTestAccount.createMock();
    testAccount.getFileSystem();
  }
  int nUpdaterThreadsAfterSpawn=getWasbThreadCount();
  Assume.assumeTrue("Background threads should have spawned.",nUpdaterThreadsAfterSpawn == 10);
  testAccount=null;
  System.gc();
  System.runFinalization();
  int nUpdaterThreadsAfterCleanup=getWasbThreadCount();
  assertTrue("Finalizers should have reduced the thread count.  ",nUpdaterThreadsAfterCleanup == 0);
}
