{
  try {
    if (!HttpServer.hasAdministratorAccess(getServletContext(),request,response)) {
      return;
    }
    response.setContentType("application/json; charset=utf8");
    PrintWriter writer=response.getWriter();
    JsonFactory jsonFactory=new JsonFactory();
    JsonGenerator jg=jsonFactory.createJsonGenerator(writer);
    jg.useDefaultPrettyPrinter();
    jg.writeStartObject();
    if (mBeanServer == null) {
      jg.writeStringField("result","ERROR");
      jg.writeStringField("message","No MBeanServer could be found");
      jg.close();
      LOG.error("No MBeanServer could be found.");
      response.setStatus(HttpServletResponse.SC_NOT_FOUND);
      return;
    }
    String getmethod=request.getParameter("get");
    if (getmethod != null) {
      String[] splitStrings=getmethod.split("\\:\\:");
      if (splitStrings.length != 2) {
        jg.writeStringField("result","ERROR");
        jg.writeStringField("message","query format is not as expected.");
        jg.close();
        response.setStatus(HttpServletResponse.SC_BAD_REQUEST);
        return;
      }
      listBeans(jg,new ObjectName(splitStrings[0]),splitStrings[1],response);
      jg.close();
      return;
    }
    String qry=request.getParameter("qry");
    if (qry == null) {
      qry="*:*";
    }
    listBeans(jg,new ObjectName(qry),null,response);
    jg.close();
  }
 catch (  IOException e) {
    LOG.error("Caught an exception while processing JMX request",e);
    response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
  }
catch (  MalformedObjectNameException e) {
    LOG.error("Caught an exception while processing JMX request",e);
    response.setStatus(HttpServletResponse.SC_BAD_REQUEST);
  }
}
