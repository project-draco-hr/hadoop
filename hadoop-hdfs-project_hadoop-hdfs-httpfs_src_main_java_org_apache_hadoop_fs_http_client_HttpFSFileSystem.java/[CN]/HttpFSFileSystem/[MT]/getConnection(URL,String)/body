{
  Class<? extends Authenticator> klass=getConf().getClass("httpfs.authenticator.class",HttpKerberosAuthenticator.class,Authenticator.class);
  Authenticator authenticator=ReflectionUtils.newInstance(klass,getConf());
  try {
    HttpURLConnection conn=new AuthenticatedURL(authenticator).openConnection(url,authToken);
    conn.setRequestMethod(method);
    if (method.equals(HTTP_POST) || method.equals(HTTP_PUT)) {
      conn.setDoOutput(true);
    }
    return conn;
  }
 catch (  Exception ex) {
    throw new IOException(ex);
  }
}
