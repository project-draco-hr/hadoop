{
  Map<String,String> params=new HashMap<String,String>();
  params.put(OP_PARAM,Operation.LISTSTATUS_BATCH.toString());
  if (token != null) {
    params.put(START_AFTER_PARAM,new String(token,Charsets.UTF_8));
  }
  HttpURLConnection conn=getConnection(Operation.LISTSTATUS_BATCH.getMethod(),params,f,true);
  HttpExceptionUtils.validateResponse(conn,HttpURLConnection.HTTP_OK);
  JSONObject json=(JSONObject)HttpFSUtils.jsonParse(conn);
  JSONObject listing=(JSONObject)json.get(DIRECTORY_LISTING_JSON);
  FileStatus[] statuses=toFileStatuses((JSONObject)listing.get(PARTIAL_LISTING_JSON),f);
  byte[] newToken=null;
  if (statuses.length > 0) {
    newToken=statuses[statuses.length - 1].getPath().getName().toString().getBytes(Charsets.UTF_8);
  }
  final long remainingEntries=(Long)listing.get(REMAINING_ENTRIES_JSON);
  final boolean hasMore=remainingEntries > 0 ? true : false;
  return new DirectoryEntries(statuses,newToken,hasMore);
}
