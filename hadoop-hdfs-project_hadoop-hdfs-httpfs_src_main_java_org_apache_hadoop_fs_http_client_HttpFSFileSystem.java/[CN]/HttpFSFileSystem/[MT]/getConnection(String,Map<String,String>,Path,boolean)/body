{
  if (!realUser.getShortUserName().equals(doAs)) {
    params.put(DO_AS_PARAM,doAs);
  }
  HttpFSKerberosAuthenticator.injectDelegationToken(params,delegationToken);
  if (makeQualified) {
    path=makeQualified(path);
  }
  final URL url=HttpFSUtils.createURL(path,params);
  return doAsRealUserIfNecessary(new Callable<HttpURLConnection>(){
    @Override public HttpURLConnection call() throws Exception {
      return getConnection(url,method);
    }
  }
);
}
