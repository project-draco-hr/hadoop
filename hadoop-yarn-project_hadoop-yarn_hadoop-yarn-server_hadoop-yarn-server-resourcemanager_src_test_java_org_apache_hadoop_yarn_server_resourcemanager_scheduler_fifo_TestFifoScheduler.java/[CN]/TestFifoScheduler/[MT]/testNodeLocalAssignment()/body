{
  AsyncDispatcher dispatcher=new InlineDispatcher();
  RMContainerTokenSecretManager containerTokenSecretManager=new RMContainerTokenSecretManager(new Configuration());
  containerTokenSecretManager.rollMasterKey();
  RMContext rmContext=new RMContextImpl(dispatcher,null,null,null,null,null,containerTokenSecretManager,null);
  FifoScheduler scheduler=new FifoScheduler();
  scheduler.reinitialize(new Configuration(),rmContext);
  RMNode node0=MockNodes.newNodeInfo(1,Resources.createResource(1024 * 64),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node0);
  scheduler.handle(nodeEvent1);
  int _appId=1;
  int _appAttemptId=1;
  ApplicationAttemptId appAttemptId=createAppAttemptId(_appId,_appAttemptId);
  AppAddedSchedulerEvent appEvent1=new AppAddedSchedulerEvent(appAttemptId,"queue1","user1");
  scheduler.handle(appEvent1);
  int memory=64;
  int nConts=3;
  int priority=20;
  List<ResourceRequest> ask=new ArrayList<ResourceRequest>();
  ResourceRequest nodeLocal=createResourceRequest(memory,node0.getHostName(),priority,nConts);
  ResourceRequest rackLocal=createResourceRequest(memory,node0.getRackName(),priority,nConts);
  ResourceRequest any=createResourceRequest(memory,ResourceRequest.ANY,priority,nConts);
  ask.add(nodeLocal);
  ask.add(rackLocal);
  ask.add(any);
  scheduler.allocate(appAttemptId,ask,new ArrayList<ContainerId>());
  NodeUpdateSchedulerEvent node0Update=new NodeUpdateSchedulerEvent(node0);
  Assert.assertEquals(3,nodeLocal.getNumContainers());
  scheduler.handle(node0Update);
  Assert.assertEquals(0,nodeLocal.getNumContainers());
  SchedulerAppReport info=scheduler.getSchedulerAppInfo(appAttemptId);
  Assert.assertEquals(3,info.getLiveContainers().size());
}
