{
  String sessionId=conf.get(DFSConfigKeys.DFS_METRICS_SESSION_ID_KEY);
  MetricsSystem ms=DefaultMetricsSystem.instance();
  JvmMetrics jm=JvmMetrics.create("DataNode",sessionId,ms);
  String name="DataNodeActivity-" + (dnName.isEmpty() ? "UndefinedDataNodeName" + ThreadLocalRandom.current().nextInt() : dnName.replace(':','-'));
  int[] intervals=conf.getInts(DFSConfigKeys.DFS_METRICS_PERCENTILES_INTERVALS_KEY);
  return ms.register(name,null,new DataNodeMetrics(name,sessionId,intervals,jm));
}
