{
  final Token<DelegationTokenIdentifier> token=getDelegationToken(fs,"JobTracker");
  DelegationTokenIdentifier identifier=new DelegationTokenIdentifier();
  byte[] tokenId=token.getIdentifier();
  identifier.readFields(new DataInputStream(new ByteArrayInputStream(tokenId)));
  LOG.info("A valid token should have non-null password, " + "and should be renewed successfully");
  assertTrue(null != dtSecretManager.retrievePassword(identifier));
  dtSecretManager.renewToken(token,"JobTracker");
  Configuration clientConf=dfs.getConf();
  doRenewOrCancel(token,clientConf,TokenTestAction.RENEW);
  Configuration emptyConf=new Configuration();
  try {
    doRenewOrCancel(token,emptyConf,TokenTestAction.RENEW);
    fail("Did not throw trying to renew with an empty conf!");
  }
 catch (  IOException ioe) {
    GenericTestUtils.assertExceptionContains("Unable to map logical nameservice URI",ioe);
  }
  cluster.transitionToStandby(0);
  cluster.transitionToActive(1);
  doRenewOrCancel(token,clientConf,TokenTestAction.RENEW);
  doRenewOrCancel(token,clientConf,TokenTestAction.CANCEL);
}
