{
  final Token<DelegationTokenIdentifier> token=dfs.getDelegationToken("test");
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser("test");
  URI haUri=new URI("hdfs://my-ha-uri/");
  token.setService(HAUtil.buildTokenServiceForLogicalUri(haUri));
  ugi.addToken(token);
  HAUtil.cloneDelegationTokenForLogicalUri(ugi,haUri,nn0.getNameNodeAddress());
  HAUtil.cloneDelegationTokenForLogicalUri(ugi,haUri,nn1.getNameNodeAddress());
  Collection<Token<? extends TokenIdentifier>> tokens=ugi.getTokens();
  assertEquals(3,tokens.size());
  LOG.info("Tokens:\n" + Joiner.on("\n").join(tokens));
  InetSocketAddress addr=nn0.getNameNodeAddress();
  Text ipcDtService=new Text(addr.getAddress().getHostAddress() + ":" + addr.getPort());
  Token<DelegationTokenIdentifier> token2=DelegationTokenSelector.selectHdfsDelegationToken(ipcDtService,ugi);
  assertNotNull(token2);
  assertArrayEquals(token.getIdentifier(),token2.getIdentifier());
  assertArrayEquals(token.getPassword(),token2.getPassword());
}
