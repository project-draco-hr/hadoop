{
  SecurityUtilTestHelper.setTokenServiceUseIp(true);
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_DELEGATION_TOKEN_ALWAYS_USE_KEY,true);
  conf.set(CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTH_TO_LOCAL,"RULE:[2:$1@$0](JobTracker@.*FOO.COM)s/@.*//" + "DEFAULT");
  cluster=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleHATopology()).numDataNodes(0).build();
  cluster.waitActive();
  String logicalName=HATestUtil.getLogicalHostname(cluster);
  HATestUtil.setFailoverConfigurations(cluster,conf,logicalName,0);
  nn0=cluster.getNameNode(0);
  nn1=cluster.getNameNode(1);
  fs=HATestUtil.configureFailoverFs(cluster,conf);
  dfs=(DistributedFileSystem)fs;
  cluster.transitionToActive(0);
  dtSecretManager=NameNodeAdapter.getDtSecretManager(nn0.getNamesystem());
}
