{
  if (dir.list() == null) {
    throw new DiskErrorException("Directory is not readable: " + dir.toString());
  }
  try {
    File tempFile=File.createTempFile("checkDirAccess",null,dir);
    if (!tempFile.delete()) {
      throw new DiskErrorException("Directory is not writable: " + dir.toString());
    }
  }
 catch (  IOException e) {
    throw new DiskErrorException("Directory is not writable: " + dir.toString(),e);
  }
  try {
    String[] cdCmd=new String[]{"cmd","/C","cd",dir.getAbsolutePath()};
    Shell.execCommand(null,cdCmd,SHELL_TIMEOUT);
  }
 catch (  Shell.ExitCodeException e) {
    throw new DiskErrorException("Directory is not executable: " + dir.toString(),e);
  }
catch (  IOException e) {
    throw new DiskErrorException("Directory is not executable: " + dir.toString(),e);
  }
}
