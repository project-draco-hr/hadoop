{
  TimelineDomain domainToReplace=domainsById.get(domain.getId());
  Long currentTimestamp=System.currentTimeMillis();
  TimelineDomain domainToStore=createTimelineDomain(domain.getId(),domain.getDescription(),domain.getOwner(),domain.getReaders(),domain.getWriters(),(domainToReplace == null ? currentTimestamp : domainToReplace.getCreatedTime()),currentTimestamp);
  domainsById.put(domainToStore.getId(),domainToStore);
  Set<TimelineDomain> domainsByOneOwner=domainsByOwner.get(domainToStore.getOwner());
  if (domainsByOneOwner == null) {
    domainsByOneOwner=new HashSet<TimelineDomain>();
    domainsByOwner.put(domainToStore.getOwner(),domainsByOneOwner);
  }
  if (domainToReplace != null) {
    domainsByOneOwner.remove(domainToReplace);
  }
  domainsByOneOwner.add(domainToStore);
}
