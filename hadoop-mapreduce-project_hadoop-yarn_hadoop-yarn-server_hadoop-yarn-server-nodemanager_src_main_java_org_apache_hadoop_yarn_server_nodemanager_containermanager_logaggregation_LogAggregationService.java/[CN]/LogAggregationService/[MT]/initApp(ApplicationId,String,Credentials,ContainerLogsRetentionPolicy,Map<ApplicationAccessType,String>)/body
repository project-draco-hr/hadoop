{
  UserGroupInformation userUgi=UserGroupInformation.createRemoteUser(user);
  if (credentials != null) {
    for (    Token<? extends TokenIdentifier> token : credentials.getAllTokens()) {
      userUgi.addToken(token);
    }
  }
  createAppDir(user,appId,userUgi);
  AppLogAggregator appLogAggregator=new AppLogAggregatorImpl(this.dispatcher,this.deletionService,getConfig(),appId,userUgi,this.localRootLogDirs,getRemoteNodeLogFileForApp(appId,user),logRetentionPolicy,appAcls);
  if (this.appLogAggregators.putIfAbsent(appId,appLogAggregator) != null) {
    throw new YarnException("Duplicate initApp for " + appId);
  }
  this.threadPool.execute(appLogAggregator);
}
