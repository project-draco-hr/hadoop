def testAllocateWithInvalidStateStore(self):
    jobid = '1234.hadoop.apache.org'
    self.client._hodRunner__cfg['hod']['operation'] = ('allocate %s %s' % (self.clusterDir, 3))
    stateFile = open(self.statePath, 'w')
    os.chmod(self.cfg['hod']['user_state'], 384)
    ret = self.client.operation()
    os.chmod(self.cfg['hod']['user_state'], 448)
    stateFile.close()
    os.remove(self.statePath)
    self.assertTrue(self.log.hasMessage((INVALID_STATE_FILE_MSGS[0] % os.path.realpath(self.statePath)), 'critical'))
    self.assertEquals(ret, 1)
    stateFile = open(self.statePath, 'w')
    os.chmod(self.cfg['hod']['user_state'], 320)
    ret = self.client.operation()
    os.chmod(self.cfg['hod']['user_state'], 448)
    stateFile.close()
    os.remove(self.statePath)
    self.assertTrue(self.log.hasMessage((INVALID_STATE_FILE_MSGS[0] % os.path.realpath(self.statePath)), 'critical'))
    self.assertEquals(ret, 1)
