{
  File localDir=make(stub(File.class).returning(true).from.exists());
  when(localDir.mkdir()).thenReturn(true);
  FsPermission normalPerm=new FsPermission("700");
  FsPermission badPerm=new FsPermission("000");
  FileStatus stat=make(stub(FileStatus.class).returning(normalPerm,normalPerm,badPerm).from.getPermission());
  when(stat.isDirectory()).thenReturn(true);
  LocalFileSystem fs=make(stub(LocalFileSystem.class).returning(stat).from.getFileStatus(any(Path.class)));
  when(fs.pathToFile(any(Path.class))).thenReturn(localDir);
  Collection<URI> uris=Arrays.asList(new URI("file:/p1/"),new URI("file:/p2/"),new URI("file:/p3/"));
  List<File> dirs=DataNode.getDataDirsFromURIs(uris,fs,normalPerm);
  verify(fs,times(2)).setPermission(any(Path.class),eq(normalPerm));
  verify(fs,times(6)).getFileStatus(any(Path.class));
  assertEquals("number of valid data dirs",dirs.size(),1);
}
