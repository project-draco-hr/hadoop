{
  byte[] base=KeyBuilder.newInstance().add(TOKEN_ENTRY_PREFIX).getBytesForLookup();
  int numTokens=0;
  LeveldbIterator iterator=null;
  try {
    for (iterator=new LeveldbIterator(db), iterator.seek(base); iterator.hasNext(); iterator.next()) {
      byte[] k=iterator.peekNext().getKey();
      if (!prefixMatches(base,base.length,k)) {
        break;
      }
      byte[] v=iterator.peekNext().getValue();
      loadTokenData(state,v);
      ++numTokens;
    }
  }
 catch (  DBException e) {
    throw new IOException(e);
  }
 finally {
    IOUtils.cleanup(LOG,iterator);
  }
  return numTokens;
}
