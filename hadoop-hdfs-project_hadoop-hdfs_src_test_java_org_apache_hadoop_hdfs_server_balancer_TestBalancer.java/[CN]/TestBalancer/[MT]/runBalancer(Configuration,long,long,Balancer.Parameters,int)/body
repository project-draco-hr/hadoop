{
  waitForHeartBeat(totalUsedSpace,totalCapacity,client,cluster);
  Collection<URI> namenodes=DFSUtil.getNsServiceRpcUris(conf);
  final int r=runBalancer(namenodes,p,conf);
  if (conf.getInt(DFSConfigKeys.DFS_DATANODE_BALANCE_MAX_NUM_CONCURRENT_MOVES_KEY,DFSConfigKeys.DFS_DATANODE_BALANCE_MAX_NUM_CONCURRENT_MOVES_DEFAULT) == 0) {
    assertEquals(ExitStatus.NO_MOVE_PROGRESS.getExitCode(),r);
    return;
  }
 else {
    assertEquals(ExitStatus.SUCCESS.getExitCode(),r);
  }
  waitForHeartBeat(totalUsedSpace,totalCapacity,client,cluster);
  LOG.info("  .");
  waitForBalancer(totalUsedSpace,totalCapacity,client,cluster,p,excludedNodes);
}
