{
  final Configuration conf=new HdfsConfiguration();
  initSecureConf(conf);
  final UserGroupInformation ugi=UserGroupInformation.loginUserFromKeytabAndReturnUGI(principal,keytabFile.getAbsolutePath());
  try {
    ugi.doAs(new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        testUnknownDatanode(conf);
        assertTrue(UserGroupInformation.isLoginKeytabBased());
        return null;
      }
    }
);
  }
  finally {
    UserGroupInformation.setConfiguration(new Configuration());
  }
}
