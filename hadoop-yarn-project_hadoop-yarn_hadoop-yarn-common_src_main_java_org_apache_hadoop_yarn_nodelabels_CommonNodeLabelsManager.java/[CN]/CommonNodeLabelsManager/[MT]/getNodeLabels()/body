{
  try {
    readLock.lock();
    Map<NodeId,Set<String>> nodeToLabels=new HashMap<NodeId,Set<String>>();
    for (    Entry<String,Host> entry : nodeCollections.entrySet()) {
      String hostName=entry.getKey();
      Host host=entry.getValue();
      for (      NodeId nodeId : host.nms.keySet()) {
        Set<String> nodeLabels=getLabelsByNode(nodeId);
        if (nodeLabels == null || nodeLabels.isEmpty()) {
          continue;
        }
        nodeToLabels.put(nodeId,nodeLabels);
      }
      if (!host.labels.isEmpty()) {
        nodeToLabels.put(NodeId.newInstance(hostName,WILDCARD_PORT),host.labels);
      }
    }
    return Collections.unmodifiableMap(nodeToLabels);
  }
  finally {
    readLock.unlock();
  }
}
