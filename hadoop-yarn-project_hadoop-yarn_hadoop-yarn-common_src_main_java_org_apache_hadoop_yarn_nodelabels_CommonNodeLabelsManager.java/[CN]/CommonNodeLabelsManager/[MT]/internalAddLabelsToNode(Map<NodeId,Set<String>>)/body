{
  Map<NodeId,Set<String>> newNMToLabels=new HashMap<NodeId,Set<String>>();
  for (  Entry<NodeId,Set<String>> entry : addedLabelsToNode.entrySet()) {
    NodeId nodeId=entry.getKey();
    Set<String> labels=entry.getValue();
    createHostIfNonExisted(nodeId.getHost());
    if (nodeId.getPort() == WILDCARD_PORT) {
      Host host=nodeCollections.get(nodeId.getHost());
      host.labels.addAll(labels);
      newNMToLabels.put(nodeId,host.labels);
    }
 else {
      createNodeIfNonExisted(nodeId);
      Node nm=getNMInNodeSet(nodeId);
      if (nm.labels == null) {
        nm.labels=new HashSet<String>();
      }
      nm.labels.addAll(labels);
      newNMToLabels.put(nodeId,nm.labels);
    }
  }
  if (null != dispatcher) {
    dispatcher.getEventHandler().handle(new UpdateNodeToLabelsMappingsEvent(newNMToLabels));
  }
  LOG.info("addLabelsToNode:");
  for (  Entry<NodeId,Set<String>> entry : newNMToLabels.entrySet()) {
    LOG.info("  NM=" + entry.getKey() + ", labels=["+ StringUtils.join(entry.getValue().iterator(),",")+ "]");
  }
}
