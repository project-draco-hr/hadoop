{
  try {
    readLock.lock();
    Map<NodeId,Set<T>> nodeToLabels=new HashMap<>();
    for (    Entry<String,Host> entry : nodeCollections.entrySet()) {
      String hostName=entry.getKey();
      Host host=entry.getValue();
      for (      NodeId nodeId : host.nms.keySet()) {
        if (type.isAssignableFrom(String.class)) {
          Set<String> nodeLabels=getLabelsByNode(nodeId);
          if (nodeLabels == null || nodeLabels.isEmpty()) {
            continue;
          }
          nodeToLabels.put(nodeId,(Set<T>)nodeLabels);
        }
 else {
          Set<NodeLabel> nodeLabels=getLabelsInfoByNode(nodeId);
          if (nodeLabels == null || nodeLabels.isEmpty()) {
            continue;
          }
          nodeToLabels.put(nodeId,(Set<T>)nodeLabels);
        }
      }
      if (!host.labels.isEmpty()) {
        if (type.isAssignableFrom(String.class)) {
          nodeToLabels.put(NodeId.newInstance(hostName,WILDCARD_PORT),(Set<T>)host.labels);
        }
 else {
          nodeToLabels.put(NodeId.newInstance(hostName,WILDCARD_PORT),(Set<T>)createNodeLabelFromLabelNames(host.labels));
        }
      }
    }
    return Collections.unmodifiableMap(nodeToLabels);
  }
  finally {
    readLock.unlock();
  }
}
