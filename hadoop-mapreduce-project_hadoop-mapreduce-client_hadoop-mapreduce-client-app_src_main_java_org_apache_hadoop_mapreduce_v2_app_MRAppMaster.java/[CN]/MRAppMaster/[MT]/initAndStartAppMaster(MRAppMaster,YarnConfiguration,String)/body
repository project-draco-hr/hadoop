{
  UserGroupInformation.setConfiguration(conf);
  Credentials credentials=UserGroupInformation.getCurrentUser().getCredentials();
  UserGroupInformation appMasterUgi=UserGroupInformation.createRemoteUser(jobUserName);
  appMasterUgi.addCredentials(credentials);
  appMasterUgi.doAs(new PrivilegedExceptionAction<Object>(){
    @Override public Object run() throws Exception {
      appMaster.init(conf);
      appMaster.start();
      if (appMaster.errorHappenedShutDown) {
        throw new IOException("Was asked to shut down.");
      }
      return null;
    }
  }
);
}
