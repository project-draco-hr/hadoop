{
  try {
    String applicationAttemptIdStr=System.getenv(ApplicationConstants.APPLICATION_ATTEMPT_ID_ENV);
    if (applicationAttemptIdStr == null) {
      String msg=ApplicationConstants.APPLICATION_ATTEMPT_ID_ENV + " is null";
      LOG.error(msg);
      throw new IOException(msg);
    }
    ApplicationAttemptId applicationAttemptId=ConverterUtils.toApplicationAttemptId(applicationAttemptIdStr);
    MRAppMaster appMaster=new MRAppMaster(applicationAttemptId);
    Runtime.getRuntime().addShutdownHook(new CompositeServiceShutdownHook(appMaster));
    YarnConfiguration conf=new YarnConfiguration(new JobConf());
    conf.addResource(new Path(MRJobConfig.JOB_CONF_FILE));
    conf.set(MRJobConfig.USER_NAME,System.getProperty("user.name"));
    UserGroupInformation.setConfiguration(conf);
    appMaster.init(conf);
    appMaster.start();
  }
 catch (  Throwable t) {
    LOG.fatal("Error starting MRAppMaster",t);
    System.exit(1);
  }
}
