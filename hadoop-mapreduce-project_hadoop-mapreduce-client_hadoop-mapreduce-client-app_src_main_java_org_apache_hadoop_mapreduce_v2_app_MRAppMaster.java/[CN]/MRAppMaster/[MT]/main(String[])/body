{
  try {
    String applicationAttemptIdStr=System.getenv(ApplicationConstants.APPLICATION_ATTEMPT_ID_ENV);
    if (applicationAttemptIdStr == null) {
      String msg=ApplicationConstants.APPLICATION_ATTEMPT_ID_ENV + " is null";
      LOG.error(msg);
      throw new IOException(msg);
    }
    ApplicationAttemptId applicationAttemptId=ConverterUtils.toApplicationAttemptId(applicationAttemptIdStr);
    MRAppMaster appMaster=new MRAppMaster(applicationAttemptId);
    Runtime.getRuntime().addShutdownHook(new CompositeServiceShutdownHook(appMaster));
    YarnConfiguration conf=new YarnConfiguration(new JobConf());
    conf.addResource(new Path(MRJobConfig.JOB_CONF_FILE));
    String jobUserName=System.getenv(ApplicationConstants.Environment.USER.name());
    conf.set(MRJobConfig.USER_NAME,jobUserName);
    initAndStartAppMaster(appMaster,conf,jobUserName);
  }
 catch (  Throwable t) {
    LOG.fatal("Error starting MRAppMaster",t);
    System.exit(1);
  }
}
