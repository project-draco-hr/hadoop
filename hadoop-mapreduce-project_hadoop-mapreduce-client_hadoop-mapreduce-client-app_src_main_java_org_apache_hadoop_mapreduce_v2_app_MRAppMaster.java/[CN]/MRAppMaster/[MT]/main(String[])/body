{
  try {
    Thread.setDefaultUncaughtExceptionHandler(new YarnUncaughtExceptionHandler());
    String containerIdStr=System.getenv(ApplicationConstants.AM_CONTAINER_ID_ENV);
    String nodeHostString=System.getenv(ApplicationConstants.NM_HOST_ENV);
    String nodePortString=System.getenv(ApplicationConstants.NM_PORT_ENV);
    String nodeHttpPortString=System.getenv(ApplicationConstants.NM_HTTP_PORT_ENV);
    String appSubmitTimeStr=System.getenv(ApplicationConstants.APP_SUBMIT_TIME_ENV);
    validateInputParam(containerIdStr,ApplicationConstants.AM_CONTAINER_ID_ENV);
    validateInputParam(nodeHostString,ApplicationConstants.NM_HOST_ENV);
    validateInputParam(nodePortString,ApplicationConstants.NM_PORT_ENV);
    validateInputParam(nodeHttpPortString,ApplicationConstants.NM_HTTP_PORT_ENV);
    validateInputParam(appSubmitTimeStr,ApplicationConstants.APP_SUBMIT_TIME_ENV);
    ContainerId containerId=ConverterUtils.toContainerId(containerIdStr);
    ApplicationAttemptId applicationAttemptId=containerId.getApplicationAttemptId();
    long appSubmitTime=Long.parseLong(appSubmitTimeStr);
    MRAppMaster appMaster=new MRAppMaster(applicationAttemptId,containerId,nodeHostString,Integer.parseInt(nodePortString),Integer.parseInt(nodeHttpPortString),appSubmitTime);
    ShutdownHookManager.get().addShutdownHook(new MRAppMasterShutdownHook(appMaster),SHUTDOWN_HOOK_PRIORITY);
    YarnConfiguration conf=new YarnConfiguration(new JobConf());
    conf.addResource(new Path(MRJobConfig.JOB_CONF_FILE));
    String jobUserName=System.getenv(ApplicationConstants.Environment.USER.name());
    conf.set(MRJobConfig.USER_NAME,jobUserName);
    conf.setBoolean("fs.automatic.close",false);
    initAndStartAppMaster(appMaster,conf,jobUserName);
  }
 catch (  Throwable t) {
    LOG.fatal("Error starting MRAppMaster",t);
    System.exit(1);
  }
}
