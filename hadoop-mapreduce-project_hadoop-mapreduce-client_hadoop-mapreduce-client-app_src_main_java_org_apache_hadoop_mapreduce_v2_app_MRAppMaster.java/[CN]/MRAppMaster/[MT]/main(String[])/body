{
  try {
    Thread.setDefaultUncaughtExceptionHandler(new YarnUncaughtExceptionHandler());
    String containerIdStr=System.getenv(Environment.CONTAINER_ID.name());
    String nodeHostString=System.getenv(Environment.NM_HOST.name());
    String nodePortString=System.getenv(Environment.NM_PORT.name());
    String nodeHttpPortString=System.getenv(Environment.NM_HTTP_PORT.name());
    String appSubmitTimeStr=System.getenv(ApplicationConstants.APP_SUBMIT_TIME_ENV);
    String maxAppAttempts=System.getenv(ApplicationConstants.MAX_APP_ATTEMPTS_ENV);
    validateInputParam(containerIdStr,Environment.CONTAINER_ID.name());
    validateInputParam(nodeHostString,Environment.NM_HOST.name());
    validateInputParam(nodePortString,Environment.NM_PORT.name());
    validateInputParam(nodeHttpPortString,Environment.NM_HTTP_PORT.name());
    validateInputParam(appSubmitTimeStr,ApplicationConstants.APP_SUBMIT_TIME_ENV);
    validateInputParam(maxAppAttempts,ApplicationConstants.MAX_APP_ATTEMPTS_ENV);
    ContainerId containerId=ConverterUtils.toContainerId(containerIdStr);
    ApplicationAttemptId applicationAttemptId=containerId.getApplicationAttemptId();
    long appSubmitTime=Long.parseLong(appSubmitTimeStr);
    MRAppMaster appMaster=new MRAppMaster(applicationAttemptId,containerId,nodeHostString,Integer.parseInt(nodePortString),Integer.parseInt(nodeHttpPortString),appSubmitTime,Integer.parseInt(maxAppAttempts));
    ShutdownHookManager.get().addShutdownHook(new MRAppMasterShutdownHook(appMaster),SHUTDOWN_HOOK_PRIORITY);
    JobConf conf=new JobConf(new YarnConfiguration());
    conf.addResource(new Path(MRJobConfig.JOB_CONF_FILE));
    String jobUserName=System.getenv(ApplicationConstants.Environment.USER.name());
    conf.set(MRJobConfig.USER_NAME,jobUserName);
    conf.setBoolean("fs.automatic.close",false);
    MRApps.setJobClassLoader(conf);
    initAndStartAppMaster(appMaster,conf,jobUserName);
  }
 catch (  Throwable t) {
    LOG.fatal("Error starting MRAppMaster",t);
    System.exit(1);
  }
}
