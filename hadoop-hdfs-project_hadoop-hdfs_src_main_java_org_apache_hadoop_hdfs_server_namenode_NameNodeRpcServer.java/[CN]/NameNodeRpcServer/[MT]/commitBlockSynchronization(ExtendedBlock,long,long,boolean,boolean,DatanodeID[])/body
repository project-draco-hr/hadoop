{
  nn.checkOperation(OperationCategory.WRITE);
  if (nn.isStandbyState()) {
    if (namesystem.isGenStampInFuture(newgenerationstamp)) {
      LOG.info("Required GS=" + newgenerationstamp + ", Queuing commitBlockSynchronization message");
      namesystem.getPendingDataNodeMessages().queueMessage(new PendingDataNodeMessages.CommitBlockSynchronizationMessage(block,newgenerationstamp,newlength,closeFile,deleteblock,newtargets,newgenerationstamp));
      return;
    }
  }
  namesystem.commitBlockSynchronization(block,newgenerationstamp,newlength,closeFile,deleteblock,newtargets);
}
