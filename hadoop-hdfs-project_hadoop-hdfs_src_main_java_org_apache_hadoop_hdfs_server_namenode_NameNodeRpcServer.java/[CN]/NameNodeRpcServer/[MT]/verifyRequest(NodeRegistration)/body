{
  final String id=nodeReg.getRegistrationID();
  final String expectedID=namesystem.getRegistrationID();
  if (!expectedID.equals(id)) {
    LOG.warn("Registration IDs mismatched: the " + nodeReg.getClass().getSimpleName() + " ID is "+ id+ " but the expected ID is "+ expectedID);
    throw new UnregisteredNodeException(nodeReg);
  }
  if (!namesystem.isRollingUpgrade()) {
    final int lv=nodeReg.getVersion();
    final int expectedLV=nodeReg instanceof NamenodeRegistration ? NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION : DataNodeLayoutVersion.CURRENT_LAYOUT_VERSION;
    if (expectedLV != nodeReg.getVersion()) {
      LOG.warn("Layout versions mismatched: the " + nodeReg.getClass().getSimpleName() + " LV is "+ lv+ " but the expected LV is "+ expectedLV);
      throw new UnregisteredNodeException(nodeReg);
    }
  }
}
