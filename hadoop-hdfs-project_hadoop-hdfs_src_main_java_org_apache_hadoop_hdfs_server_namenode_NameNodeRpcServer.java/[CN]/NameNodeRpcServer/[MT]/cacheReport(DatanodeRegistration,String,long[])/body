{
  verifyRequest(nodeReg);
  BlockListAsLongs blist=new BlockListAsLongs(blocks);
  namesystem.getBlockManager().processCacheReport(nodeReg,poolId,blist);
  if (nn.getFSImage().isUpgradeFinalized() && !nn.isStandbyState()) {
    return new FinalizeCommand(poolId);
  }
  return null;
}
