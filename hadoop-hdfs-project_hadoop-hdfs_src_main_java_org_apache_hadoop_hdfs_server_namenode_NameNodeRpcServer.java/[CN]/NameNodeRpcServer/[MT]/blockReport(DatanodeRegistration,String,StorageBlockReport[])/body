{
  verifyRequest(nodeReg);
  if (blockStateChangeLog.isDebugEnabled()) {
    blockStateChangeLog.debug("*BLOCK* NameNode.blockReport: " + "from " + nodeReg + ", reports.length="+ reports.length);
  }
  final BlockManager bm=namesystem.getBlockManager();
  for (  StorageBlockReport r : reports) {
    final BlockListAsLongs blocks=new BlockListAsLongs(r.getBlocks());
    bm.processReport(nodeReg,r.getStorage(),poolId,blocks);
  }
  DatanodeDescriptor datanode=bm.getDatanodeManager().getDatanode(nodeReg);
  datanode.receivedBlockReport();
  if (nn.getFSImage().isUpgradeFinalized() && !nn.isStandbyState())   return new FinalizeCommand(poolId);
  return null;
}
