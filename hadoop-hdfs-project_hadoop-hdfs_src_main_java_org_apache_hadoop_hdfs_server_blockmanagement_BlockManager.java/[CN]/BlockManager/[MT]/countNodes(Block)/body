{
  int decommissioned=0;
  int live=0;
  int corrupt=0;
  int excess=0;
  int stale=0;
  Iterator<DatanodeDescriptor> nodeIter=blocksMap.nodeIterator(b);
  Collection<DatanodeDescriptor> nodesCorrupt=corruptReplicas.getNodes(b);
  while (nodeIter.hasNext()) {
    DatanodeDescriptor node=nodeIter.next();
    if ((nodesCorrupt != null) && (nodesCorrupt.contains(node))) {
      corrupt++;
    }
 else     if (node.isDecommissionInProgress() || node.isDecommissioned()) {
      decommissioned++;
    }
 else {
      LightWeightLinkedSet<Block> blocksExcess=excessReplicateMap.get(node.getStorageID());
      if (blocksExcess != null && blocksExcess.contains(b)) {
        excess++;
      }
 else {
        live++;
      }
    }
    if (node.areBlockContentsStale()) {
      stale++;
    }
  }
  return new NumberReplicas(live,decommissioned,corrupt,excess,stale);
}
