{
  if (blkIndex < 0)   return null;
  BlockInfo curBlock=fileINode.getBlocks()[blkIndex];
  if (curBlock.isComplete())   return curBlock;
  BlockInfoUnderConstruction ucBlock=(BlockInfoUnderConstruction)curBlock;
  if (!force && ucBlock.numNodes() < minReplication)   throw new IOException("Cannot complete block: " + "block does not satisfy minimal replication requirement.");
  if (!force && ucBlock.getBlockUCState() != BlockUCState.COMMITTED)   throw new IOException("Cannot complete block: block has not been COMMITTED by the client");
  BlockInfo completeBlock=ucBlock.convertToCompleteBlock();
  fileINode.setBlock(blkIndex,completeBlock);
  return blocksMap.replaceBlock(completeBlock);
}
