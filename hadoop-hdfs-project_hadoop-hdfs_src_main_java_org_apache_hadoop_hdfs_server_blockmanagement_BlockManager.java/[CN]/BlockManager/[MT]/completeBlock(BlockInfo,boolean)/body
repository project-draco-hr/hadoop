{
  if (curBlock.isComplete()) {
    return;
  }
  int numNodes=curBlock.numNodes();
  if (!force && !hasMinStorage(curBlock,numNodes)) {
    throw new IOException("Cannot complete block: " + "block does not satisfy minimal replication requirement.");
  }
  if (!force && curBlock.getBlockUCState() != BlockUCState.COMMITTED) {
    throw new IOException("Cannot complete block: block has not been COMMITTED by the client");
  }
  curBlock.convertToCompleteBlock();
  bmSafeMode.adjustBlockTotals(0,1);
  final int minStorage=curBlock.isStriped() ? ((BlockInfoStriped)curBlock).getRealDataBlockNum() : minReplication;
  bmSafeMode.incrementSafeBlockCount(Math.min(numNodes,minStorage),curBlock);
}
