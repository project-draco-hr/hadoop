{
  final Iterator<? extends Block> it=node.getBlockIterator();
  while (it.hasNext()) {
    removeStoredBlock(it.next(),node);
  }
  pendingDNMessages.removeAllMessagesForDatanode(node);
  node.resetBlocks();
  invalidateBlocks.remove(node);
  boolean stale=false;
  for (  DatanodeStorageInfo storage : node.getStorageInfos()) {
    if (storage.areBlockContentsStale()) {
      stale=true;
      break;
    }
  }
  if (stale) {
    rescanPostponedMisreplicatedBlocks();
  }
}
