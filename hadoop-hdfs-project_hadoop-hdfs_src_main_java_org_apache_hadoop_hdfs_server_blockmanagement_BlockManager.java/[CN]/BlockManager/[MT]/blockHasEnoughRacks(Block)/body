{
  if (!this.shouldCheckForEnoughRacks) {
    return true;
  }
  boolean enoughRacks=false;
  Collection<DatanodeDescriptor> corruptNodes=corruptReplicas.getNodes(b);
  int numExpectedReplicas=getReplication(b);
  String rackName=null;
  for (  DatanodeStorageInfo storage : blocksMap.getStorages(b)) {
    final DatanodeDescriptor cur=storage.getDatanodeDescriptor();
    if (!cur.isDecommissionInProgress() && !cur.isDecommissioned()) {
      if ((corruptNodes == null) || !corruptNodes.contains(cur)) {
        if (numExpectedReplicas == 1 || (numExpectedReplicas > 1 && !datanodeManager.hasClusterEverBeenMultiRack())) {
          enoughRacks=true;
          break;
        }
        String rackNameNew=cur.getNetworkLocation();
        if (rackName == null) {
          rackName=rackNameNew;
        }
 else         if (!rackName.equals(rackNameNew)) {
          enoughRacks=true;
          break;
        }
      }
    }
  }
  return enoughRacks;
}
