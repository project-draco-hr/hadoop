{
  if (!namesystem.isInStartupSafeMode()) {
    return countNodes(b).liveReplicas();
  }
  int live=0;
  Collection<DatanodeDescriptor> nodesCorrupt=corruptReplicas.getNodes(b);
  for (  DatanodeStorageInfo storage : blocksMap.getStorages(b,State.NORMAL)) {
    final DatanodeDescriptor node=storage.getDatanodeDescriptor();
    if ((nodesCorrupt == null) || (!nodesCorrupt.contains(node)))     live++;
  }
  return live;
}
