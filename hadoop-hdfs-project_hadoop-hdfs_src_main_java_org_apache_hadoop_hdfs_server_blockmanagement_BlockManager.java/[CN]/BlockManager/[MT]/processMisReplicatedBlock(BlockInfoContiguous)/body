{
  BlockCollection bc=block.getBlockCollection();
  if (bc == null) {
    addToInvalidates(block);
    return MisReplicationResult.INVALID;
  }
  if (!block.isComplete()) {
    return MisReplicationResult.UNDER_CONSTRUCTION;
  }
  short expectedReplication=bc.getBlockReplication();
  NumberReplicas num=countNodes(block);
  int numCurrentReplica=num.liveReplicas();
  if (isNeededReplication(block,expectedReplication,numCurrentReplica)) {
    if (neededReplications.add(block,numCurrentReplica,num.decommissionedReplicas(),expectedReplication)) {
      return MisReplicationResult.UNDER_REPLICATED;
    }
  }
  if (numCurrentReplica > expectedReplication) {
    if (num.replicasOnStaleNodes() > 0) {
      return MisReplicationResult.POSTPONE;
    }
    processOverReplicatedBlock(block,expectedReplication,null,null);
    return MisReplicationResult.OVER_REPLICATED;
  }
  return MisReplicationResult.OK;
}
