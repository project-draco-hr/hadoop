{
  if (!datanodeManager.hasClusterEverBeenMultiRack()) {
    return true;
  }
  boolean enoughRacks=false;
  Set<String> rackNameSet=new HashSet<>();
  int dataBlockNum=((BlockInfoStriped)storedBlock).getRealDataBlockNum();
  for (  DatanodeStorageInfo storage : blocksMap.getStorages(storedBlock)) {
    final DatanodeDescriptor cur=storage.getDatanodeDescriptor();
    if (!cur.isDecommissionInProgress() && !cur.isDecommissioned()) {
      if ((corruptNodes == null) || !corruptNodes.contains(cur)) {
        String rackNameNew=cur.getNetworkLocation();
        rackNameSet.add(rackNameNew);
        if (rackNameSet.size() >= dataBlockNum) {
          enoughRacks=true;
          break;
        }
      }
    }
  }
  return enoughRacks;
}
