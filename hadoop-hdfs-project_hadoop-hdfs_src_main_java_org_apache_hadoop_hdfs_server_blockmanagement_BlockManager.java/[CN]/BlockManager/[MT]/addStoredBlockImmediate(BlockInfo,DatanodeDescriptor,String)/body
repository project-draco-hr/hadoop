{
  assert(storedBlock != null && namesystem.hasWriteLock());
  if (!namesystem.isInStartupSafeMode() || namesystem.isPopulatingReplQueues()) {
    addStoredBlock(storedBlock,node,storageID,null,false);
    return;
  }
  node.addBlock(storageID,storedBlock);
  int numCurrentReplica=countLiveNodes(storedBlock);
  if (storedBlock.getBlockUCState() == BlockUCState.COMMITTED && numCurrentReplica >= minReplication) {
    completeBlock((MutableBlockCollection)storedBlock.getBlockCollection(),storedBlock,false);
  }
 else   if (storedBlock.isComplete()) {
    namesystem.incrementSafeBlockCount(numCurrentReplica);
  }
}
