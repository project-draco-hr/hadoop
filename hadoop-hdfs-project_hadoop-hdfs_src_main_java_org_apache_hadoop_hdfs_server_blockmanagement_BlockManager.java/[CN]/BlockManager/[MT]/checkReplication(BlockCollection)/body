{
  for (  BlockInfo block : bc.getBlocks()) {
    short expected=getExpectedReplicaNum(block);
    final NumberReplicas n=countNodes(block);
    final int pending=pendingReplications.getNumReplicas(block);
    if (!hasEnoughEffectiveReplicas(block,n,pending,expected)) {
      neededReplications.add(block,n.liveReplicas() + pending,n.readOnlyReplicas(),n.decommissionedAndDecommissioning(),expected);
    }
 else     if (n.liveReplicas() > expected) {
      processOverReplicatedBlock(block,expected,null,null);
    }
  }
}
