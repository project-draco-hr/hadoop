{
  for (  BlockInfo block : bc.getBlocks()) {
    short expected=getExpectedReplicaNum(block);
    final NumberReplicas n=countNodes(block);
    final int pending=pendingReconstruction.getNumReplicas(block);
    if (!hasEnoughEffectiveReplicas(block,n,pending,expected)) {
      neededReconstruction.add(block,n.liveReplicas() + pending,n.readOnlyReplicas(),n.decommissionedAndDecommissioning(),expected);
    }
 else     if (shouldProcessExtraRedundancy(n,expected)) {
      processExtraRedundancyBlock(block,expected,null,null);
    }
  }
}
