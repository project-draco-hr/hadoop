{
  List<List<Block>> blocksToReplicate=null;
  namesystem.writeLock();
  try {
    blocksToReplicate=neededReplications.chooseUnderReplicatedBlocks(blocksToProcess);
  }
  finally {
    namesystem.writeUnlock();
  }
  return computeReplicationWorkForBlocks(blocksToReplicate);
}
