{
  assert(storedBlock != null && namesystem.hasWriteLock());
  if (!namesystem.isInStartupSafeMode() || namesystem.isPopulatingReplQueues()) {
    addStoredBlock(storedBlock,reported,storageInfo,null,false);
    return;
  }
  AddBlockResult result=storageInfo.addBlock(storedBlock,reported);
  int numCurrentReplica=countLiveNodes(storedBlock);
  if (storedBlock.getBlockUCState() == BlockUCState.COMMITTED && hasMinStorage(storedBlock,numCurrentReplica)) {
    completeBlock(storedBlock.getBlockCollection(),storedBlock,false);
  }
 else   if (storedBlock.isComplete() && result == AddBlockResult.ADDED) {
    namesystem.incrementSafeBlockCount(numCurrentReplica,storedBlock);
  }
}
