{
  Collection<DatanodeDescriptor> nodes=corruptReplicas.getNodes(blk);
  boolean removedFromBlocksMap=true;
  if (nodes == null)   return;
  DatanodeDescriptor[] nodesCopy=nodes.toArray(new DatanodeDescriptor[0]);
  for (  DatanodeDescriptor node : nodesCopy) {
    try {
      if (!invalidateBlock(new BlockToMarkCorrupt(blk,null),node)) {
        removedFromBlocksMap=false;
      }
    }
 catch (    IOException e) {
      blockLog.info("invalidateCorruptReplicas " + "error in deleting bad block " + blk + " on "+ node,e);
      removedFromBlocksMap=false;
    }
  }
  if (removedFromBlocksMap) {
    corruptReplicas.removeFromCorruptReplicasMap(blk);
  }
}
