{
  assert(storedBlock != null && namesystem.hasWriteLock());
  if (!namesystem.isInStartupSafeMode() || namesystem.isPopulatingReplQueues()) {
    addStoredBlock(storedBlock,storageInfo,null,false);
    return;
  }
  AddBlockResult result=storageInfo.addBlock(storedBlock);
  int numCurrentReplica=countLiveNodes(storedBlock);
  if (storedBlock.getBlockUCState() == BlockUCState.COMMITTED && numCurrentReplica >= minReplication) {
    completeBlock(storedBlock.getBlockCollection(),storedBlock,false);
  }
 else   if (storedBlock.isComplete() && result == AddBlockResult.ADDED) {
    namesystem.incrementSafeBlockCount(numCurrentReplica);
  }
}
