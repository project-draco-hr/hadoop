{
  NumberReplicas numberReplicas=new NumberReplicas();
  Collection<DatanodeDescriptor> nodesCorrupt=corruptReplicas.getNodes(b);
  if (b.isStriped()) {
    countReplicasForStripedBlock(numberReplicas,(BlockInfoStriped)b,nodesCorrupt,inStartupSafeMode);
  }
 else {
    for (    DatanodeStorageInfo storage : blocksMap.getStorages(b)) {
      checkReplicaOnStorage(numberReplicas,b,storage,nodesCorrupt,inStartupSafeMode);
    }
  }
  return numberReplicas;
}
