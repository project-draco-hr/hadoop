{
  Assert.assertFalse(DistCpSync.sync(options,conf));
  final Path spath=new Path(source,HdfsConstants.DOT_SNAPSHOT_DIR + Path.SEPARATOR + "s2");
  Assert.assertEquals(spath,options.getSourcePaths().get(0));
  options.setSourcePaths(Arrays.asList(source));
  dfs.allowSnapshot(source);
  dfs.allowSnapshot(target);
  Assert.assertFalse(DistCpSync.sync(options,conf));
  Assert.assertEquals(spath,options.getSourcePaths().get(0));
  options.setSourcePaths(Arrays.asList(source));
  dfs.createSnapshot(source,"s1");
  dfs.createSnapshot(source,"s2");
  dfs.createSnapshot(target,"s1");
  Assert.assertTrue(DistCpSync.sync(options,conf));
  options.setSourcePaths(Arrays.asList(source));
  final Path subTarget=new Path(target,"sub");
  dfs.mkdirs(subTarget);
  Assert.assertFalse(DistCpSync.sync(options,conf));
  Assert.assertEquals(spath,options.getSourcePaths().get(0));
  options.setSourcePaths(Arrays.asList(source));
  dfs.delete(subTarget,true);
  Assert.assertTrue(DistCpSync.sync(options,conf));
}
