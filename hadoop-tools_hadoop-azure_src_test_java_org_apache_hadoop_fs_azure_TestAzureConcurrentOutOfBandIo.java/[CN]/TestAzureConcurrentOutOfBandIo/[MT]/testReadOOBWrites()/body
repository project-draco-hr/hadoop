{
  byte[] dataBlockWrite=new byte[UPLOAD_BLOCK_SIZE];
  byte[] dataBlockRead=new byte[UPLOAD_BLOCK_SIZE];
  OutputStream outputStream=testAccount.getStore().storefile("WASB_String.txt",new PermissionStatus("","",FsPermission.getDefault()));
  Arrays.fill(dataBlockWrite,(byte)255);
  for (int i=0; i < NUMBER_OF_BLOCKS; i++) {
    outputStream.write(dataBlockWrite);
  }
  outputStream.flush();
  outputStream.close();
  DataBlockWriter writeBlockTask=new DataBlockWriter(testAccount,"WASB_String.txt");
  writeBlockTask.startWriting();
  int count=0;
  DataInputStream inputStream=null;
  for (int i=0; i < 5; i++) {
    try {
      inputStream=testAccount.getStore().retrieve("WASB_String.txt");
      count=0;
      int c=0;
      while (c >= 0) {
        c=inputStream.read(dataBlockRead,0,UPLOAD_BLOCK_SIZE);
        if (c < 0) {
          break;
        }
        count+=c;
      }
    }
 catch (    IOException e) {
      System.out.println(e.getCause().toString());
      e.printStackTrace();
      fail();
    }
    if (null != inputStream) {
      inputStream.close();
    }
  }
  writeBlockTask.stopWriting();
  assertEquals(NUMBER_OF_BLOCKS * UPLOAD_BLOCK_SIZE,count);
}
