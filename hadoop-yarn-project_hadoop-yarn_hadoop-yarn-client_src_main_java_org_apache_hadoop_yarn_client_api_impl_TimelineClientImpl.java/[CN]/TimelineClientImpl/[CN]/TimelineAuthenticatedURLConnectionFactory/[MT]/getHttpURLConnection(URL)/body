{
  try {
    if (dToken == null) {
      dToken=selectToken();
      if (LOG.isDebugEnabled()) {
        LOG.debug("Timeline delegation token: " + dToken.toString());
      }
    }
    if (dToken != null) {
      Map<String,String> params=new HashMap<String,String>();
      TimelineAuthenticator.injectDelegationToken(params,dToken);
      url=TimelineAuthenticator.appendParams(url,params);
      if (LOG.isDebugEnabled()) {
        LOG.debug("URL with delegation token: " + url);
      }
    }
    return new AuthenticatedURL(authenticator).openConnection(url,token);
  }
 catch (  AuthenticationException e) {
    LOG.error("Authentication failed when openning connection [" + url + "] with token ["+ token+ "].",e);
    throw new IOException(e);
  }
}
