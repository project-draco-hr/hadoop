{
  Mockito.doReturn(STANDBY_READY_RESULT).when(mockProtocol).getServiceStatus();
  final String nsSpecificKey=DFSConfigKeys.DFS_HA_FENCE_METHODS_KEY + "." + NSID;
  final String nnSpecificKey=nsSpecificKey + ".nn1";
  HdfsConfiguration conf=getHAConf();
  conf.set(DFSConfigKeys.DFS_HA_FENCE_METHODS_KEY,"shell(true)");
  tool.setConf(conf);
  assertEquals(0,runTool("-failover","nn1","nn2","--forcefence"));
  conf.set(nnSpecificKey,"shell(false)");
  tool.setConf(conf);
  assertEquals(-1,runTool("-failover","nn1","nn2","--forcefence"));
  conf.unset(nnSpecificKey);
  conf.set(nsSpecificKey,"shell(false)");
  tool.setConf(conf);
  assertEquals(-1,runTool("-failover","nn1","nn2","--forcefence"));
  conf.set(nsSpecificKey,"shell(true)");
  tool.setConf(conf);
  assertEquals(0,runTool("-failover","nn1","nn2","--forcefence"));
}
