{
  if (conf == null) {
    conf=new Configuration();
  }
  String serverFactoryClassName=conf.get(RPC_SERVER_FACTORY_CLASS_KEY);
  if (serverFactoryClassName == null) {
    if (conf.get(RPC_SERIALIZER_KEY,RPC_SERIALIZER_DEFAULT).equals(RPC_SERIALIZER_DEFAULT)) {
      return RpcServerFactoryPBImpl.get();
    }
 else {
      throw new YarnException("Unknown serializer: [" + conf.get(RPC_SERIALIZER_KEY) + "]. Use keys: ["+ RPC_CLIENT_FACTORY_CLASS_KEY+ "]["+ RPC_SERVER_FACTORY_CLASS_KEY+ "] to specify factories");
    }
  }
 else {
    return (RpcServerFactory)getFactoryClassInstance(serverFactoryClassName);
  }
}
