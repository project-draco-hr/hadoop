{
  InetSocketAddress datanodeAddr=DFSUtil.getSocketAddress(datanode);
  Configuration conf=getConf();
  conf.set(CommonConfigurationKeys.HADOOP_SECURITY_SERVICE_USER_NAME_KEY,conf.get(DFSConfigKeys.DFS_DATANODE_USER_NAME_KEY,""));
  ClientDatanodeProtocol dnProtocol=RPC.getProxy(ClientDatanodeProtocol.class,ClientDatanodeProtocol.versionID,datanodeAddr,getUGI(),conf,NetUtils.getSocketFactory(conf,ClientDatanodeProtocol.class));
  return dnProtocol;
}
