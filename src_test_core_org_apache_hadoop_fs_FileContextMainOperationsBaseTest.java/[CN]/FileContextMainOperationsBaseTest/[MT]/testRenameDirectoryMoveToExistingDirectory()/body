{
  if (!renameSupported())   return;
  Path src=getTestRootPath("test/hadoop/dir");
  fc.mkdirs(src,FsPermission.getDefault());
  createFile(getTestRootPath("test/hadoop/dir/file1"));
  createFile(getTestRootPath("test/hadoop/dir/subdir/file2"));
  Path dst=getTestRootPath("test/new/newdir");
  fc.mkdirs(dst.getParent(),FsPermission.getDefault());
  rename(src,dst,true,false,true);
  Assert.assertFalse("Nested file1 exists",fc.exists(getTestRootPath("test/hadoop/dir/file1")));
  Assert.assertFalse("Nested file2 exists",fc.exists(getTestRootPath("test/hadoop/dir/subdir/file2")));
  Assert.assertTrue("Renamed nested file1 exists",fc.exists(getTestRootPath("test/new/newdir/file1")));
  Assert.assertTrue("Renamed nested exists",fc.exists(getTestRootPath("test/new/newdir/subdir/file2")));
}
