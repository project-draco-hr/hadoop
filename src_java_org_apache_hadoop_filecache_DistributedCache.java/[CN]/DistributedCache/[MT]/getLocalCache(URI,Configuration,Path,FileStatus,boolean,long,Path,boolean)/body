{
  String cacheId=makeRelative(cache,conf);
  CacheStatus lcacheStatus;
  Path localizedPath;
synchronized (cachedArchives) {
    lcacheStatus=cachedArchives.get(cacheId);
    if (lcacheStatus == null) {
      lcacheStatus=new CacheStatus(baseDir,new Path(baseDir,new Path(cacheId)));
      cachedArchives.put(cacheId,lcacheStatus);
    }
synchronized (lcacheStatus) {
      localizedPath=localizeCache(conf,cache,confFileStamp,lcacheStatus,fileStatus,isArchive,currentWorkDir,honorSymLinkConf);
      lcacheStatus.refcount++;
    }
  }
  long size=0;
synchronized (baseDirSize) {
    Long get=baseDirSize.get(baseDir);
    if (get != null) {
      size=get.longValue();
    }
  }
  long allowedSize=conf.getLong("local.cache.size",DEFAULT_CACHE_SIZE);
  if (allowedSize < size) {
    deleteCache(conf);
  }
  return localizedPath;
}
