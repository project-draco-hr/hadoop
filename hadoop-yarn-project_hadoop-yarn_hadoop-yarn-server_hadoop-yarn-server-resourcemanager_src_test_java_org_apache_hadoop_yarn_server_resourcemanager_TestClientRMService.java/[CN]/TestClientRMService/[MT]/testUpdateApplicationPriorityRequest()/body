{
  int maxPriority=10;
  int appPriority=5;
  YarnConfiguration conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.MAX_CLUSTER_LEVEL_APPLICATION_PRIORITY,maxPriority);
  MockRM rm=new MockRM(conf);
  rm.init(conf);
  rm.start();
  RMApp app1=rm.submitApp(1024,Priority.newInstance(appPriority));
  Assert.assertEquals("Incorrect priority has been set to application",appPriority,app1.getApplicationSubmissionContext().getPriority().getPriority());
  appPriority=9;
  ClientRMService rmService=rm.getClientRMService();
  UpdateApplicationPriorityRequest updateRequest=UpdateApplicationPriorityRequest.newInstance(app1.getApplicationId(),Priority.newInstance(appPriority));
  rmService.updateApplicationPriority(updateRequest);
  Assert.assertEquals("Incorrect priority has been set to application",appPriority,app1.getApplicationSubmissionContext().getPriority().getPriority());
  rm.killApp(app1.getApplicationId());
  rm.waitForState(app1.getApplicationId(),RMAppState.KILLED);
  appPriority=8;
  UpdateApplicationPriorityRequest updateRequestNew=UpdateApplicationPriorityRequest.newInstance(app1.getApplicationId(),Priority.newInstance(appPriority));
  rmService.updateApplicationPriority(updateRequestNew);
  Assert.assertNotEquals("Priority should not be updated as app is in KILLED state",appPriority,app1.getApplicationSubmissionContext().getPriority().getPriority());
  Assert.assertEquals("Priority should be same as old one before update",9,app1.getApplicationSubmissionContext().getPriority().getPriority());
  ApplicationId invalidAppId=ApplicationId.newInstance(123456789L,3);
  updateRequest=UpdateApplicationPriorityRequest.newInstance(invalidAppId,Priority.newInstance(appPriority));
  try {
    rmService.updateApplicationPriority(updateRequest);
    Assert.fail("ApplicationNotFoundException should be thrown for invalid application id");
  }
 catch (  ApplicationNotFoundException e) {
  }
  rm.stop();
}
