{
  if (closed) {
    return;
  }
  closed=true;
  try {
    if (multiPartUpload == null) {
      putObject();
    }
 else {
      if (buffer.size() > 0) {
        multiPartUpload.uploadPartAsync(new ByteArrayInputStream(buffer.toByteArray()),buffer.size());
      }
      final List<PartETag> partETags=multiPartUpload.waitForAllPartUploads();
      multiPartUpload.complete(partETags);
    }
    statistics.incrementWriteOps(1);
    fs.finishedWrite(key);
    LOG.debug("Upload complete for bucket '{}' key '{}'",bucket,key);
  }
  finally {
    buffer=null;
    super.close();
  }
}
