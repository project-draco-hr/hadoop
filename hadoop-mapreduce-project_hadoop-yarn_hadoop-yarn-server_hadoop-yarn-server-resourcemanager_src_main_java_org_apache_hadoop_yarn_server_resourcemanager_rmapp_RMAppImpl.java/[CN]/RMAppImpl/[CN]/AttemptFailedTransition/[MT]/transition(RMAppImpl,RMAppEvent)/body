{
  RMAppFailedAttemptEvent failedEvent=((RMAppFailedAttemptEvent)event);
  if (app.attempts.size() == app.maxRetries) {
    String msg="Application " + app.getApplicationId() + " failed "+ app.maxRetries+ " times due to "+ failedEvent.getDiagnostics()+ ". Failing the application.";
    LOG.info(msg);
    app.diagnostics.append(msg);
    FINAL_TRANSITION.transition(app,event);
    return RMAppState.FAILED;
  }
  app.createNewAttempt();
  return initialState;
}
