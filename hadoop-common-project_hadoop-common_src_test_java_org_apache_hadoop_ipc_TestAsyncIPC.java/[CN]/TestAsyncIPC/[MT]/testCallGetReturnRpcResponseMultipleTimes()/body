{
  int handlerCount=10, callCount=100;
  Server server=new TestIPC.TestServer(handlerCount,false,conf);
  InetSocketAddress addr=NetUtils.getConnectAddress(server);
  server.start();
  final Client client=new Client(LongWritable.class,conf);
  int asyncCallCount=client.getAsyncCallCount();
  try {
    AsyncCaller caller=new AsyncCaller(client,addr,callCount);
    caller.run();
    caller.waitForReturnValues();
    String msg=String.format("First time, expected not failed for caller: %s.",caller);
    assertFalse(msg,caller.failed);
    caller.waitForReturnValues();
    assertTrue(asyncCallCount == client.getAsyncCallCount());
    msg=String.format("Second time, expected not failed for caller: %s.",caller);
    assertFalse(msg,caller.failed);
    assertTrue(asyncCallCount == client.getAsyncCallCount());
  }
  finally {
    client.stop();
    server.stop();
  }
}
