{
  try {
    setupFCs();
    svc2.isHealthy=false;
    waitForHealthState(thr2.zkfc,HealthMonitor.State.SERVICE_UNHEALTHY);
    thr1.zkfc.getElectorForTests().preventSessionReestablishmentForTests();
    try {
      expireActiveLockHolder(svc1);
      LOG.info("Expired svc1's ZK session. Waiting a second to give svc2" + " a chance to take the lock, if it is ever going to.");
      Thread.sleep(1000);
      waitForActiveLockHolder(null);
    }
  finally {
      LOG.info("Allowing svc1's elector to re-establish its connection");
      thr1.zkfc.getElectorForTests().allowSessionReestablishmentForTests();
    }
    waitForActiveLockHolder(svc1);
  }
  finally {
    stopFCs();
  }
}
