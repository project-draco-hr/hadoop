{
  try {
    cluster.start();
    DummyHAService svc1=cluster.getService(1);
    LOG.info("Faking svc0 unhealthy, should failover to svc1");
    cluster.setHealthy(0,false);
    LOG.info("Waiting for svc0 to enter initializing state");
    cluster.waitForHAState(0,HAServiceState.INITIALIZING);
    cluster.waitForHAState(1,HAServiceState.ACTIVE);
    LOG.info("Allowing svc0 to be healthy again, making svc1 unreachable " + "and fail to gracefully go to standby");
    cluster.setUnreachable(1,true);
    cluster.setHealthy(0,true);
    cluster.waitForHAState(0,HAServiceState.ACTIVE);
    Mockito.verify(svc1.fencer).fence(Mockito.same(svc1));
  }
  finally {
    cluster.stop();
  }
}
