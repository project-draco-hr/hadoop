{
  while (running) {
    Thread.sleep(blockFixInterval);
    purgeHistory();
    List<Path> corruptFiles=getCorruptFiles();
    filterUnfixableSourceFiles(corruptFiles.iterator());
    if (corruptFiles.isEmpty()) {
      continue;
    }
    LOG.info("Found " + corruptFiles.size() + " corrupt files.");
    helper.sortCorruptFiles(corruptFiles);
    for (    Path srcPath : corruptFiles) {
      if (!running)       break;
      try {
        boolean fixed=helper.fixFile(srcPath);
        LOG.info("Adding " + srcPath + " to history");
        history.put(srcPath.toString(),new java.util.Date());
        if (fixed) {
          incrFilesFixed();
        }
      }
 catch (      IOException ie) {
        LOG.error("Hit error while processing " + srcPath + ": "+ StringUtils.stringifyException(ie));
      }
    }
  }
}
