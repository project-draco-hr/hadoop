{
  Configuration configuration=new Configuration(conf);
  if (!initialized) {
    if (rmContext.getConfigurationProvider() instanceof LocalConfigurationProvider) {
      this.conf=new CapacitySchedulerConfiguration(configuration,true);
    }
 else {
      try {
        this.conf=new CapacitySchedulerConfiguration(rmContext.getConfigurationProvider().getConfiguration(configuration,YarnConfiguration.CS_CONFIGURATION_FILE),false);
      }
 catch (      Exception e) {
        throw new IOException(e);
      }
    }
    validateConf(this.conf);
    this.minimumAllocation=this.conf.getMinimumAllocation();
    this.maximumAllocation=this.conf.getMaximumAllocation();
    this.calculator=this.conf.getResourceCalculator();
    this.usePortForNodeName=this.conf.getUsePortForNodeName();
    this.applications=new ConcurrentHashMap<ApplicationId,SchedulerApplication>();
    this.rmContext=rmContext;
    initializeQueues(this.conf);
    initialized=true;
    LOG.info("Initialized CapacityScheduler with " + "calculator=" + getResourceCalculator().getClass() + ", "+ "minimumAllocation=<"+ getMinimumResourceCapability()+ ">, "+ "maximumAllocation=<"+ getMaximumResourceCapability()+ ">");
  }
 else {
    CapacitySchedulerConfiguration oldConf=this.conf;
    this.conf=new CapacitySchedulerConfiguration(conf,rmContext.getConfigurationProvider() instanceof LocalConfigurationProvider);
    validateConf(this.conf);
    try {
      LOG.info("Re-initializing queues...");
      reinitializeQueues(this.conf);
    }
 catch (    Throwable t) {
      this.conf=oldConf;
      throw new IOException("Failed to re-init queues",t);
    }
  }
}
