{
  if (LOG.isDebugEnabled()) {
    LOG.debug("nodeUpdate: " + nm + " clusterResources: "+ clusterResource);
  }
  FiCaSchedulerNode node=getNode(nm.getNodeID());
  SchedulerUtils.updateResourceIfChanged(node,nm,clusterResource,LOG);
  List<UpdatedContainerInfo> containerInfoList=nm.pullContainerUpdates();
  List<ContainerStatus> newlyLaunchedContainers=new ArrayList<ContainerStatus>();
  List<ContainerStatus> completedContainers=new ArrayList<ContainerStatus>();
  for (  UpdatedContainerInfo containerInfo : containerInfoList) {
    newlyLaunchedContainers.addAll(containerInfo.getNewlyLaunchedContainers());
    completedContainers.addAll(containerInfo.getCompletedContainers());
  }
  for (  ContainerStatus launchedContainer : newlyLaunchedContainers) {
    containerLaunchedOnNode(launchedContainer.getContainerId(),node);
  }
  for (  ContainerStatus completedContainer : completedContainers) {
    ContainerId containerId=completedContainer.getContainerId();
    LOG.debug("Container FINISHED: " + containerId);
    completedContainer(getRMContainer(containerId),completedContainer,RMContainerEventType.FINISHED);
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("Node being looked for scheduling " + nm + " availableResource: "+ node.getAvailableResource());
  }
  RMContainer reservedContainer=node.getReservedContainer();
  if (reservedContainer != null) {
    FiCaSchedulerApp reservedApplication=getApplication(reservedContainer.getApplicationAttemptId());
    LOG.info("Trying to fulfill reservation for application " + reservedApplication.getApplicationId() + " on node: "+ nm);
    LeafQueue queue=((LeafQueue)reservedApplication.getQueue());
    CSAssignment assignment=queue.assignContainers(clusterResource,node);
    RMContainer excessReservation=assignment.getExcessReservation();
    if (excessReservation != null) {
      Container container=excessReservation.getContainer();
      queue.completedContainer(clusterResource,assignment.getApplication(),node,excessReservation,SchedulerUtils.createAbnormalContainerStatus(container.getId(),SchedulerUtils.UNRESERVED_CONTAINER),RMContainerEventType.RELEASED,null);
    }
  }
  if (node.getReservedContainer() == null) {
    root.assignContainers(clusterResource,node);
  }
 else {
    LOG.info("Skipping scheduling since node " + nm + " is reserved by application "+ node.getReservedContainer().getContainerId().getApplicationAttemptId());
  }
}
