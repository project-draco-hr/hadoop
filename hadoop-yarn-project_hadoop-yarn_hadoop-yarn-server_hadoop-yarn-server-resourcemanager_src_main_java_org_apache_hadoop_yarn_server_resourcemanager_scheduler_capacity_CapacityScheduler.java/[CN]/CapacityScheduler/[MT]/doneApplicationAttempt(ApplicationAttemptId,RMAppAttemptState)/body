{
  LOG.info("Application Attempt " + applicationAttemptId + " is done."+ " finalState="+ rmAppAttemptFinalState);
  FiCaSchedulerApp application=getApplication(applicationAttemptId);
  if (application == null) {
    LOG.info("Unknown application " + applicationAttemptId + " has completed!");
    return;
  }
  for (  RMContainer rmContainer : application.getLiveContainers()) {
    completedContainer(rmContainer,SchedulerUtils.createAbnormalContainerStatus(rmContainer.getContainerId(),SchedulerUtils.COMPLETED_APPLICATION),RMContainerEventType.KILL);
  }
  for (  RMContainer rmContainer : application.getReservedContainers()) {
    completedContainer(rmContainer,SchedulerUtils.createAbnormalContainerStatus(rmContainer.getContainerId(),"Application Complete"),RMContainerEventType.KILL);
  }
  application.stop(rmAppAttemptFinalState);
  String queueName=application.getQueue().getQueueName();
  CSQueue queue=queues.get(queueName);
  if (!(queue instanceof LeafQueue)) {
    LOG.error("Cannot finish application " + "from non-leaf queue: " + queueName);
  }
 else {
    queue.finishApplicationAttempt(application,queue.getQueueName());
  }
  appAttempts.remove(applicationAttemptId);
}
