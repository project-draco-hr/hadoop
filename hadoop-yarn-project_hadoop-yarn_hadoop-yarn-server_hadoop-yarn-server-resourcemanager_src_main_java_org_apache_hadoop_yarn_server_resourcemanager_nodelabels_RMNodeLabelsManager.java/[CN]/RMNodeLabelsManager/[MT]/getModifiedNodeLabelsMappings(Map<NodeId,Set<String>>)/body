{
  Map<NodeId,Set<String>> effectiveModifiedLabels=new HashMap<>();
  for (  Entry<NodeId,Set<String>> nodeLabelMappingEntry : replaceLabelsToNode.entrySet()) {
    NodeId nodeId=nodeLabelMappingEntry.getKey();
    Set<String> modifiedNodeLabels=nodeLabelMappingEntry.getValue();
    Set<String> labelsBeforeModification=null;
    Host host=nodeCollections.get(nodeId.getHost());
    if (host == null) {
      effectiveModifiedLabels.put(nodeId,modifiedNodeLabels);
      continue;
    }
 else     if (nodeId.getPort() == WILDCARD_PORT) {
      labelsBeforeModification=host.labels;
    }
 else     if (host.nms.get(nodeId) != null) {
      labelsBeforeModification=host.nms.get(nodeId).labels;
    }
    if (labelsBeforeModification == null || labelsBeforeModification.size() != modifiedNodeLabels.size() || !labelsBeforeModification.containsAll(modifiedNodeLabels)) {
      effectiveModifiedLabels.put(nodeId,modifiedNodeLabels);
    }
  }
  return effectiveModifiedLabels;
}
