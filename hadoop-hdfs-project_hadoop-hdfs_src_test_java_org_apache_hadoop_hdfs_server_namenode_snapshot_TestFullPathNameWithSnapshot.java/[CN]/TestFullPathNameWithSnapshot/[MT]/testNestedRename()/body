{
  final Path sdir1=new Path("/dir1");
  final Path sdir2=new Path("/dir2");
  final Path foo=new Path(sdir1,"foo");
  final Path bar=new Path(foo,"bar");
  dfs.mkdirs(bar);
  dfs.mkdirs(sdir2);
  SnapshotTestHelper.createSnapshot(dfs,sdir1,"s1");
  final Path bar2=new Path(sdir2,"bar");
  dfs.rename(bar,bar2);
  final Path foo2=new Path(bar2,"foo");
  dfs.rename(foo,foo2);
  INode bar2Node=fsdir.getINode(bar2.toString());
  Assert.assertTrue(bar2Node instanceof INodeReference.DstReference);
  byte[][] bar2Components=FSDirectory.getPathComponentsWithSnapshot(bar2Node);
  DFSTestUtil.checkComponentsEquals(INode.getPathComponents(bar2.toString()),bar2Components);
  String oldbar=SnapshotTestHelper.getSnapshotPath(sdir1,"s1","foo/bar").toString();
  INode oldbarNode=fsdir.getINode(oldbar);
  Assert.assertTrue(oldbarNode instanceof INodeReference.WithName);
  byte[][] oldbarComponents=FSDirectory.getPathComponentsWithSnapshot(oldbarNode);
  DFSTestUtil.checkComponentsEquals(INode.getPathComponents(oldbar),oldbarComponents);
  INode foo2Node=fsdir.getINode(foo2.toString());
  Assert.assertTrue(foo2Node instanceof INodeReference.DstReference);
  byte[][] foo2Components=FSDirectory.getPathComponentsWithSnapshot(foo2Node);
  DFSTestUtil.checkComponentsEquals(INode.getPathComponents(foo2.toString()),foo2Components);
  String oldfoo=SnapshotTestHelper.getSnapshotPath(sdir1,"s1",foo.getName()).toString();
  INode oldfooNode=fsdir.getINode(oldfoo);
  Assert.assertTrue(oldfooNode instanceof INodeReference.WithName);
  byte[][] oldfooComponents=FSDirectory.getPathComponentsWithSnapshot(oldfooNode);
  DFSTestUtil.checkComponentsEquals(INode.getPathComponents(oldfoo),oldfooComponents);
}
