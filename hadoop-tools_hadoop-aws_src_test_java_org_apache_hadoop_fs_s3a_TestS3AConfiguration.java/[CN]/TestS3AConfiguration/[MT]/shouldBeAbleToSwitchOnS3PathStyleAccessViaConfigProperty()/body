{
  conf=new Configuration();
  conf.set(Constants.PATH_STYLE_ACCESS,Boolean.toString(true));
  assertTrue(conf.getBoolean(Constants.PATH_STYLE_ACCESS,false));
  try {
    fs=S3ATestUtils.createTestFileSystem(conf);
    final Object object=getClientOptionsField(fs.getAmazonS3Client(),"clientOptions");
    assertNotNull(object);
    assertTrue("Unexpected type found for clientOptions!",object instanceof S3ClientOptions);
    assertTrue("Expected to find path style access to be switched on!",((S3ClientOptions)object).isPathStyleAccess());
    byte[] file=ContractTestUtils.toAsciiByteArray("test file");
    ContractTestUtils.writeAndRead(fs,new Path("/path/style/access/testFile"),file,file.length,conf.getInt(Constants.FS_S3A_BLOCK_SIZE,file.length),false,true);
  }
 catch (  final AmazonS3Exception e) {
    LOG.error("Caught exception: ",e);
    assertEquals(e.getStatusCode(),HttpStatus.SC_MOVED_PERMANENTLY);
  }
}
