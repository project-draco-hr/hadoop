{
  boolean isExcluded=false;
  if (scope.startsWith("~")) {
    isExcluded=true;
    scope=scope.substring(1);
  }
  scope=NodeBase.normalize(scope);
  int count=0;
  netlock.readLock().lock();
  try {
    for (    Node node : excludedNodes) {
      if ((NodeBase.getPath(node) + NodeBase.PATH_SEPARATOR_STR).startsWith(scope + NodeBase.PATH_SEPARATOR_STR)) {
        count++;
      }
    }
    Node n=getNode(scope);
    int scopeNodeCount=1;
    if (n instanceof InnerNode) {
      scopeNodeCount=((InnerNode)n).getNumOfLeaves();
    }
    if (isExcluded) {
      return clusterMap.getNumOfLeaves() - scopeNodeCount - excludedNodes.size() + count;
    }
 else {
      return scopeNodeCount - count;
    }
  }
  finally {
    netlock.readLock().unlock();
  }
}
