{
  this.setUp(8,1,1);
  taskTrackerManager.addJobInProgressListener(scheduler.jobQueuesManager);
  Map<String,AbstractQueue> map=setUpHierarchy(70,30,80,20);
  scheduler.updateContextInfoForTests();
  TaskSchedulingContext mapTSC=map.get("rt.gta").getQueueSchedulingContext().getMapTSC();
  assertEquals(mapTSC.getCapacity(),2);
  mapTSC=map.get("rt.sch").getQueueSchedulingContext().getMapTSC();
  assertEquals(mapTSC.getCapacity(),5);
  mapTSC=map.get("rt.sch.prod").getQueueSchedulingContext().getMapTSC();
  assertEquals(mapTSC.getCapacity(),4);
  mapTSC=map.get("rt.sch.misc").getQueueSchedulingContext().getMapTSC();
  assertEquals(mapTSC.getCapacity(),1);
  assertUsedCapacity(map,new String[]{"rt.gta","rt.sch","rt.sch.prod","rt.sch.misc"},new int[]{0,0,0,0});
  taskTrackerManager.submitJobAndInit(JobStatus.PREP,20,20,"rt.sch.misc","u1");
  taskTrackerManager.submitJobAndInit(JobStatus.PREP,20,20,"rt.gta","u1");
  int counter=0;
  Map<String,String> expectedStrings=new HashMap<String,String>();
  expectedStrings.put(MAP,"attempt_test_0001_m_000001_0 on tt1");
  expectedStrings.put(REDUCE,"attempt_test_0001_r_000001_0 on tt1");
  checkMultipleTaskAssignment(taskTrackerManager,scheduler,"tt1",expectedStrings);
  assertUsedCapacity(map,new String[]{"rt.gta","rt.sch","rt.sch.prod","rt.sch.misc"},new int[]{0,1,0,1});
  expectedStrings.clear();
  expectedStrings.put(MAP,"attempt_test_0002_m_000001_0 on tt2");
  expectedStrings.put(REDUCE,"attempt_test_0002_r_000001_0 on tt2");
  checkMultipleTaskAssignment(taskTrackerManager,scheduler,"tt2",expectedStrings);
  assertUsedCapacity(map,new String[]{"rt.gta","rt.sch","rt.sch.prod","rt.sch.misc"},new int[]{1,1,0,1});
  expectedStrings.clear();
  expectedStrings.put(MAP,"attempt_test_0001_m_000002_0 on tt3");
  expectedStrings.put(REDUCE,"attempt_test_0001_r_000002_0 on tt3");
  checkMultipleTaskAssignment(taskTrackerManager,scheduler,"tt3",expectedStrings);
  assertUsedCapacity(map,new String[]{"rt.gta","rt.sch","rt.sch.prod","rt.sch.misc"},new int[]{1,2,0,2});
  expectedStrings.clear();
  expectedStrings.put(MAP,"attempt_test_0001_m_000003_0 on tt4");
  expectedStrings.put(REDUCE,"attempt_test_0001_r_000003_0 on tt4");
  checkMultipleTaskAssignment(taskTrackerManager,scheduler,"tt4",expectedStrings);
  assertUsedCapacity(map,new String[]{"rt.gta","rt.sch","rt.sch.prod","rt.sch.misc"},new int[]{1,3,0,3});
  expectedStrings.clear();
  expectedStrings.put(MAP,"attempt_test_0002_m_000002_0 on tt5");
  expectedStrings.put(REDUCE,"attempt_test_0002_r_000002_0 on tt5");
  checkMultipleTaskAssignment(taskTrackerManager,scheduler,"tt5",expectedStrings);
  assertUsedCapacity(map,new String[]{"rt.gta","rt.sch","rt.sch.prod","rt.sch.misc"},new int[]{2,3,0,3});
  expectedStrings.clear();
  expectedStrings.put(MAP,"attempt_test_0001_m_000004_0 on tt6");
  expectedStrings.put(REDUCE,"attempt_test_0001_r_000004_0 on tt6");
  checkMultipleTaskAssignment(taskTrackerManager,scheduler,"tt6",expectedStrings);
  assertUsedCapacity(map,new String[]{"rt.gta","rt.sch","rt.sch.prod","rt.sch.misc"},new int[]{2,4,0,4});
  expectedStrings.clear();
  expectedStrings.put(MAP,"attempt_test_0001_m_000005_0 on tt7");
  expectedStrings.put(REDUCE,"attempt_test_0001_r_000005_0 on tt7");
  checkMultipleTaskAssignment(taskTrackerManager,scheduler,"tt7",expectedStrings);
  assertUsedCapacity(map,new String[]{"rt.gta","rt.sch","rt.sch.prod","rt.sch.misc"},new int[]{2,5,0,5});
  expectedStrings.clear();
  expectedStrings.put(MAP,"attempt_test_0001_m_000006_0 on tt8");
  expectedStrings.put(REDUCE,"attempt_test_0001_r_000006_0 on tt8");
  checkMultipleTaskAssignment(taskTrackerManager,scheduler,"tt8",expectedStrings);
}
