{
  if (!canRun()) {
    return;
  }
  Configuration conf2=new Configuration(conf);
  conf2.set(MRConfig.LOCAL_DIR,ROOT_MAPRED_LOCAL_DIR.toString());
  conf2.setLong(TTConfig.TT_LOCAL_CACHE_SIZE,LOCAL_CACHE_LIMIT);
  conf2.setLong(TTConfig.TT_LOCAL_CACHE_SUBDIRS_LIMIT,LOCAL_CACHE_SUBDIR);
  conf2.setLong(TTConfig.TT_DISTRIBUTED_CACHE_CHECK_PERIOD,CACHE_DELETE_PERIOD_MS);
  refreshConf(conf2);
  TrackerDistributedCacheManager manager=new TrackerDistributedCacheManager(conf2,taskController);
  manager.startCleanupThread();
  FileSystem localfs=FileSystem.getLocal(conf2);
  String userName=getJobOwnerName();
  conf2.set(MRJobConfig.USER_NAME,userName);
  Path localCache=manager.getLocalCache(firstCacheFile.toUri(),conf2,TaskTracker.getPrivateDistributedCacheDir(userName),fs.getFileStatus(firstCacheFile),false,getFileStamp(firstCacheFile),new Path(TEST_ROOT_DIR),false,false);
  manager.releaseCache(firstCacheFile.toUri(),conf2,getFileStamp(firstCacheFile),TrackerDistributedCacheManager.getLocalizedCacheOwner(false));
  manager.getLocalCache(secondCacheFile.toUri(),conf2,TaskTracker.getPrivateDistributedCacheDir(userName),fs.getFileStatus(secondCacheFile),false,getFileStamp(secondCacheFile),new Path(TEST_ROOT_DIR),false,false);
  checkCacheDeletion(localfs,localCache,"DistributedCache failed " + "deleting old cache when the cache store is full.");
  Path thirdCacheFile=new Path(TEST_ROOT_DIR,"thirdcachefile");
  Path fourthCacheFile=new Path(TEST_ROOT_DIR,"fourthcachefile");
  createTempFile(thirdCacheFile,1);
  createTempFile(fourthCacheFile,1);
  Path thirdLocalCache=manager.getLocalCache(thirdCacheFile.toUri(),conf2,TaskTracker.getPrivateDistributedCacheDir(userName),fs.getFileStatus(thirdCacheFile),false,getFileStamp(thirdCacheFile),new Path(TEST_ROOT_DIR),false,false);
  manager.releaseCache(thirdCacheFile.toUri(),conf2,getFileStamp(thirdCacheFile),TrackerDistributedCacheManager.getLocalizedCacheOwner(false));
  manager.getLocalCache(fourthCacheFile.toUri(),conf2,TaskTracker.getPrivateDistributedCacheDir(userName),fs.getFileStatus(fourthCacheFile),false,getFileStamp(fourthCacheFile),new Path(TEST_ROOT_DIR),false,false);
  checkCacheDeletion(localfs,thirdLocalCache,"DistributedCache failed deleting old" + " cache when the cache exceeds the number of sub directories limit.");
  new File(thirdCacheFile.toString()).delete();
  new File(fourthCacheFile.toString()).delete();
  manager.stopCleanupThread();
}
