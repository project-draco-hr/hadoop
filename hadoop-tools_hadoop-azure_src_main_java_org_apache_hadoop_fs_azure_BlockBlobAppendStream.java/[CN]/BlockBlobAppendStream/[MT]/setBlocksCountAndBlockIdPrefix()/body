{
  try {
    if (nextBlockCount == UNSET_BLOCKS_COUNT && blockIdPrefix == null) {
      List<BlockEntry> blockEntries=blob.downloadBlockList(BlockListingFilter.COMMITTED,new BlobRequestOptions(),opContext);
      String blockZeroBlockId=(blockEntries.size() > 0) ? blockEntries.get(0).getId() : "";
      String prefix=UUID.randomUUID().toString() + "-";
      String sampleNewerVersionBlockId=generateNewerVersionBlockId(prefix,0);
      if (blockEntries.size() > 0 && blockZeroBlockId.length() < sampleNewerVersionBlockId.length()) {
        this.blockIdPrefix="";
        nextBlockCount=(long)(sequenceGenerator.nextInt(Integer.MAX_VALUE)) + sequenceGenerator.nextInt(Integer.MAX_VALUE - MAX_BLOCK_COUNT);
        nextBlockCount+=blockEntries.size();
      }
 else {
        this.blockIdPrefix=prefix;
        nextBlockCount=blockEntries.size();
      }
    }
  }
 catch (  StorageException ex) {
    LOG.debug("Encountered storage exception during setting next Block Count and BlockId prefix." + " StorageException : {} ErrorCode : {}",ex,ex.getErrorCode());
    throw new IOException(ex);
  }
}
