{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Loading directory section");
  }
  while (true) {
    FsImageProto.INodeDirectorySection.DirEntry e=FsImageProto.INodeDirectorySection.DirEntry.parseDelimitedFrom(in);
    if (e == null) {
      break;
    }
    long[] l=new long[e.getChildrenCount() + e.getRefChildrenCount()];
    for (int i=0; i < e.getChildrenCount(); ++i) {
      l[i]=e.getChildren(i);
    }
    for (int i=e.getChildrenCount(); i < l.length; i++) {
      int refId=e.getRefChildren(i - e.getChildrenCount());
      l[i]=refList.get(refId).getReferredId();
    }
    dirmap.put(e.getParent(),l);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Loaded directory (parent " + e.getParent() + ") with "+ e.getChildrenCount()+ " children and "+ e.getRefChildrenCount()+ " reference children");
    }
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("Loaded " + dirmap.size() + " directories");
  }
}
