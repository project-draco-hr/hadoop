{
  prepareToExitState(context);
  s.prepareToEnterState(context);
  context.writeLock();
  try {
    exitState(context);
    context.setState(s);
    s.enterState(context);
    s.updateLastHATransitionTime();
  }
  finally {
    context.writeUnlock();
  }
}
