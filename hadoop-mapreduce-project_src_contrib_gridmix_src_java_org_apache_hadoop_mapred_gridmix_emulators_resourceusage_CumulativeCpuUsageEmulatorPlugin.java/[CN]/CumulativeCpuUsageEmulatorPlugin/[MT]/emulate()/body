{
  if (enabled) {
    float currentProgress=progress.getProgress();
    if (lastSeenProgress < currentProgress && ((currentProgress - lastSeenProgress) >= emulationInterval || currentProgress == 1)) {
      long currentCpuUsage=getCurrentCPUUsage();
      float rate=(currentCpuUsage - lastSeenCpuUsage) / (currentProgress - lastSeenProgress);
      long projectedUsage=currentCpuUsage + (long)((1 - currentProgress) * rate);
      if (projectedUsage < targetCpuUsage) {
        long currentWeighedTarget=(long)(targetCpuUsage * getWeightForProgressInterval(currentProgress));
        while (getCurrentCPUUsage() < currentWeighedTarget) {
          emulatorCore.compute();
          try {
            Thread.sleep(100);
          }
 catch (          InterruptedException ie) {
            String message="CumulativeCpuUsageEmulatorPlugin got interrupted. Exiting.";
            throw new RuntimeException(message);
          }
        }
      }
      lastSeenProgress=progress.getProgress();
      lastSeenCpuUsage=getCurrentCPUUsage();
    }
  }
}
