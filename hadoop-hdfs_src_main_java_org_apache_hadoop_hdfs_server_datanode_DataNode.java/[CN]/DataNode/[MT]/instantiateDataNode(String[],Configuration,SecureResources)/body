{
  if (conf == null)   conf=new HdfsConfiguration();
  if (args != null) {
    GenericOptionsParser hParser=new GenericOptionsParser(conf,args);
    args=hParser.getRemainingArgs();
  }
  if (!parseArguments(args,conf)) {
    printUsage();
    return null;
  }
  if (conf.get("dfs.network.script") != null) {
    LOG.error("This configuration for rack identification is not supported" + " anymore. RackID resolution is handled by the NameNode.");
    System.exit(-1);
  }
  Collection<URI> dataDirs=getStorageDirs(conf);
  dnThreadName="DataNode: [" + StringUtils.uriToString(dataDirs.toArray(new URI[0])) + "]";
  UserGroupInformation.setConfiguration(conf);
  SecurityUtil.login(conf,DFS_DATANODE_KEYTAB_FILE_KEY,DFS_DATANODE_USER_NAME_KEY);
  return makeInstance(dataDirs,conf,resources);
}
