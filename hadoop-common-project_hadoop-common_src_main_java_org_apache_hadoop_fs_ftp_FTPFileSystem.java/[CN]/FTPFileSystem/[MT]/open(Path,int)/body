{
  FTPClient client=connect();
  Path workDir=new Path(client.printWorkingDirectory());
  Path absolute=makeAbsolute(workDir,file);
  FileStatus fileStat=getFileStatus(client,absolute);
  if (fileStat.isDirectory()) {
    disconnect(client);
    throw new FileNotFoundException("Path " + file + " is a directory.");
  }
  client.allocate(bufferSize);
  Path parent=absolute.getParent();
  client.changeWorkingDirectory(parent.toUri().getPath());
  InputStream is=client.retrieveFileStream(file.getName());
  FSDataInputStream fis=new FSDataInputStream(new FTPInputStream(is,client,statistics));
  if (!FTPReply.isPositivePreliminary(client.getReplyCode())) {
    fis.close();
    throw new IOException("Unable to open file: " + file + ", Aborting");
  }
  return fis;
}
