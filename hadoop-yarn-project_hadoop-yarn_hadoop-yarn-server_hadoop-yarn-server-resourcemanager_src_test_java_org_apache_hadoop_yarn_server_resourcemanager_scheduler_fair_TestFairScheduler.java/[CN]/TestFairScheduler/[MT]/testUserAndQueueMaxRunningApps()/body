{
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queue1\">");
  out.println("<maxRunningApps>2</maxRunningApps>");
  out.println("</queue>");
  out.println("<user name=\"user1\">");
  out.println("<maxRunningApps>1</maxRunningApps>");
  out.println("</user>");
  out.println("</allocations>");
  out.close();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1");
  verifyAppRunnable(attId1,true);
  verifyQueueNumRunnable("queue1",1,0);
  ApplicationAttemptId attId2=createSchedulingRequest(1024,"queue2","user1");
  verifyAppRunnable(attId2,false);
  verifyQueueNumRunnable("queue2",0,1);
  ApplicationAttemptId attId3=createSchedulingRequest(1024,"queue1","user2");
  verifyAppRunnable(attId3,true);
  verifyQueueNumRunnable("queue1",2,0);
  ApplicationAttemptId attId4=createSchedulingRequest(1024,"queue1","user2");
  verifyAppRunnable(attId4,false);
  verifyQueueNumRunnable("queue1",2,1);
  AppRemovedSchedulerEvent appRemovedEvent1=new AppRemovedSchedulerEvent(attId1,RMAppAttemptState.FINISHED);
  scheduler.handle(appRemovedEvent1);
  verifyAppRunnable(attId2,true);
  verifyQueueNumRunnable("queue2",1,0);
  verifyAppRunnable(attId4,true);
  verifyQueueNumRunnable("queue1",2,0);
  ApplicationAttemptId attId5=createSchedulingRequest(1024,"queue1","user2");
  verifyAppRunnable(attId5,false);
  verifyQueueNumRunnable("queue1",2,1);
}
