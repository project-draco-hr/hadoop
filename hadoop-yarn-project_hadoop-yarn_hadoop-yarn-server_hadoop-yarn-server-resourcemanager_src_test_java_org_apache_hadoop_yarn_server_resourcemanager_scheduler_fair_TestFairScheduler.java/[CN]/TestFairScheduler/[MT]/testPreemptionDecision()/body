{
  Configuration conf=createConfiguration();
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  MockClock clock=new MockClock();
  scheduler.setClock(clock);
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println("<?xml version=\"1.0\"?>");
  out.println("<allocations>");
  out.println("<queue name=\"queueA\">");
  out.println("<weight>.25</weight>");
  out.println("<minResources>1024</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueB\">");
  out.println("<weight>.25</weight>");
  out.println("<minResources>1024</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueC\">");
  out.println("<weight>.25</weight>");
  out.println("<minResources>1024</minResources>");
  out.println("</queue>");
  out.println("<queue name=\"queueD\">");
  out.println("<weight>.25</weight>");
  out.println("<minResources>1024</minResources>");
  out.println("</queue>");
  out.print("<defaultMinSharePreemptionTimeout>5</defaultMinSharePreemptionTimeout>");
  out.print("<fairSharePreemptionTimeout>10</fairSharePreemptionTimeout>");
  out.println("</allocations>");
  out.close();
  QueueManager queueManager=scheduler.getQueueManager();
  queueManager.initialize();
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(2 * 1024));
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(2 * 1024));
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  scheduler.handle(nodeEvent2);
  RMNode node3=MockNodes.newNodeInfo(1,Resources.createResource(2 * 1024));
  NodeAddedSchedulerEvent nodeEvent3=new NodeAddedSchedulerEvent(node3);
  scheduler.handle(nodeEvent3);
  ApplicationAttemptId app1=createSchedulingRequest(1 * 1024,"queueA","user1",1,1);
  ApplicationAttemptId app2=createSchedulingRequest(1 * 1024,"queueA","user1",1,2);
  ApplicationAttemptId app3=createSchedulingRequest(1 * 1024,"queueA","user1",1,3);
  ApplicationAttemptId app4=createSchedulingRequest(1 * 1024,"queueB","user1",1,1);
  ApplicationAttemptId app5=createSchedulingRequest(1 * 1024,"queueB","user1",1,2);
  ApplicationAttemptId app6=createSchedulingRequest(1 * 1024,"queueB","user1",1,3);
  scheduler.update();
  for (int i=0; i < 2; i++) {
    NodeUpdateSchedulerEvent nodeUpdate1=new NodeUpdateSchedulerEvent(node1,new LinkedList<ContainerStatus>(),new LinkedList<ContainerStatus>());
    scheduler.handle(nodeUpdate1);
    NodeUpdateSchedulerEvent nodeUpdate2=new NodeUpdateSchedulerEvent(node2,new LinkedList<ContainerStatus>(),new LinkedList<ContainerStatus>());
    scheduler.handle(nodeUpdate2);
    NodeUpdateSchedulerEvent nodeUpdate3=new NodeUpdateSchedulerEvent(node3,new LinkedList<ContainerStatus>(),new LinkedList<ContainerStatus>());
    scheduler.handle(nodeUpdate3);
  }
  ApplicationAttemptId app7=createSchedulingRequest(1 * 1024,"queueC","user1",1,1);
  ApplicationAttemptId app8=createSchedulingRequest(1 * 1024,"queueC","user1",1,2);
  ApplicationAttemptId app9=createSchedulingRequest(1 * 1024,"queueC","user1",1,3);
  ApplicationAttemptId app10=createSchedulingRequest(1 * 1024,"queueD","user1",1,1);
  ApplicationAttemptId app11=createSchedulingRequest(1 * 1024,"queueD","user1",1,2);
  ApplicationAttemptId app12=createSchedulingRequest(1 * 1024,"queueD","user1",1,3);
  scheduler.update();
  FSQueueSchedulable schedC=scheduler.getQueueManager().getQueue("queueC").getQueueSchedulable();
  FSQueueSchedulable schedD=scheduler.getQueueManager().getQueue("queueD").getQueueSchedulable();
  assertTrue(Resources.equals(Resources.none(),scheduler.resToPreempt(schedC,clock.getTime())));
  assertTrue(Resources.equals(Resources.none(),scheduler.resToPreempt(schedD,clock.getTime())));
  clock.tick(6);
  assertTrue(Resources.equals(Resources.createResource(1024),scheduler.resToPreempt(schedC,clock.getTime())));
  assertTrue(Resources.equals(Resources.createResource(1024),scheduler.resToPreempt(schedD,clock.getTime())));
  scheduler.update();
  clock.tick(6);
  assertTrue(Resources.equals(Resources.createResource(1536),scheduler.resToPreempt(schedC,clock.getTime())));
  assertTrue(Resources.equals(Resources.createResource(1536),scheduler.resToPreempt(schedD,clock.getTime())));
}
