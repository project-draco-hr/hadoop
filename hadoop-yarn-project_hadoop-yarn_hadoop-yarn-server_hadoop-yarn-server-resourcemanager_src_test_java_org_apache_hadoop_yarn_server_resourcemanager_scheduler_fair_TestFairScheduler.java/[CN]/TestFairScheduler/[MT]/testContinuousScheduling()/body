{
  FairScheduler fs=new FairScheduler();
  Configuration conf=createConfiguration();
  conf.setBoolean(FairSchedulerConfiguration.CONTINUOUS_SCHEDULING_ENABLED,true);
  fs.reinitialize(conf,resourceManager.getRMContext());
  Assert.assertTrue("Continuous scheduling should be enabled.",fs.isContinuousSchedulingEnabled());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(8 * 1024,8),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  fs.handle(nodeEvent1);
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(8 * 1024,8),2,"127.0.0.2");
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  fs.handle(nodeEvent2);
  Assert.assertEquals(fs.getClusterCapacity().getMemory(),16 * 1024);
  Assert.assertEquals(fs.getClusterCapacity().getVirtualCores(),16);
  ApplicationAttemptId appAttemptId=createAppAttemptId(this.APP_ID++,this.ATTEMPT_ID++);
  fs.addApplication(appAttemptId.getApplicationId(),"queue11","user11");
  fs.addApplicationAttempt(appAttemptId);
  List<ResourceRequest> ask=new ArrayList<ResourceRequest>();
  ResourceRequest request=createResourceRequest(1024,1,ResourceRequest.ANY,1,1,true);
  ask.add(request);
  fs.allocate(appAttemptId,ask,new ArrayList<ContainerId>(),null,null);
  Thread.sleep(fs.getConf().getContinuousSchedulingSleepMs() + 500);
  FSSchedulerApp app=fs.appAttempts.get(appAttemptId);
  while (app.getCurrentConsumption().equals(Resources.none())) {
  }
  Assert.assertEquals(1024,app.getCurrentConsumption().getMemory());
  Assert.assertEquals(1,app.getCurrentConsumption().getVirtualCores());
  request=createResourceRequest(1024,1,ResourceRequest.ANY,2,1,true);
  ask.clear();
  ask.add(request);
  fs.allocate(appAttemptId,ask,new ArrayList<ContainerId>(),null,null);
  while (app.getCurrentConsumption().equals(Resources.createResource(1024,1))) {
  }
  Assert.assertEquals(2048,app.getCurrentConsumption().getMemory());
  Assert.assertEquals(2,app.getCurrentConsumption().getVirtualCores());
  Set<NodeId> nodes=new HashSet<NodeId>();
  Iterator<RMContainer> it=app.getLiveContainers().iterator();
  while (it.hasNext()) {
    nodes.add(it.next().getContainer().getNodeId());
  }
  Assert.assertEquals(2,nodes.size());
}
