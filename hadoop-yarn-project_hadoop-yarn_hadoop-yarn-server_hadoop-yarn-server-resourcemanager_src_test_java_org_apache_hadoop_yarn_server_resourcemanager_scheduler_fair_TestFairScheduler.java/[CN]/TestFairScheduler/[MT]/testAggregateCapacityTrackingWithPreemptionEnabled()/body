{
  int KB=1024;
  int iterationNumber=10;
  Configuration conf=createConfiguration();
  conf.setBoolean("yarn.scheduler.fair.preemption",true);
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node=MockNodes.newNodeInfo(1,Resources.createResource(KB * iterationNumber));
  NodeAddedSchedulerEvent nodeAddEvent=new NodeAddedSchedulerEvent(node);
  scheduler.handle(nodeAddEvent);
  for (int i=0; i < iterationNumber; i++) {
    createSchedulingRequest(KB,"queue1","user1",1);
    scheduler.update();
    NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node);
    scheduler.handle(updateEvent);
    assertEquals(KB,scheduler.getQueueManager().getQueue("queue1").getResourceUsage().getMemory());
    TimeUnit.SECONDS.sleep(1);
  }
}
