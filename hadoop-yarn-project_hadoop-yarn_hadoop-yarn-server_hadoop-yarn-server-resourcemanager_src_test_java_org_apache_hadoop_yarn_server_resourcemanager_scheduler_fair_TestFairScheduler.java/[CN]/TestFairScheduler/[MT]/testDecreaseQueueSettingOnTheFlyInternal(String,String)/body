{
  conf.set(FairSchedulerConfiguration.ALLOCATION_FILE,ALLOC_FILE);
  PrintWriter out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println(allocBefore);
  out.close();
  scheduler.init(conf);
  scheduler.start();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(8192,8),1,"127.0.0.1");
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  ApplicationAttemptId attId1=createSchedulingRequest(1024,"queue1","user1",1);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1);
  scheduler.handle(updateEvent);
  assertEquals(1,scheduler.getSchedulerApp(attId1).getLiveContainers().size());
  ApplicationAttemptId attId2=createSchedulingRequest(1024,"queue1","user1",1);
  scheduler.update();
  scheduler.handle(updateEvent);
  ApplicationAttemptId attId3=createSchedulingRequest(1024,"queue1","user1",1);
  scheduler.update();
  scheduler.handle(updateEvent);
  ApplicationAttemptId attId4=createSchedulingRequest(1024,"queue1","user1",1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(1,scheduler.getSchedulerApp(attId2).getLiveContainers().size());
  assertEquals(1,scheduler.getSchedulerApp(attId3).getLiveContainers().size());
  assertEquals(0,scheduler.getSchedulerApp(attId4).getLiveContainers().size());
  out=new PrintWriter(new FileWriter(ALLOC_FILE));
  out.println(allocAfter);
  out.close();
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(1,scheduler.getSchedulerApp(attId2).getLiveContainers().size());
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(1,scheduler.getSchedulerApp(attId3).getLiveContainers().size());
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(0,scheduler.getSchedulerApp(attId4).getLiveContainers().size());
  AppAttemptRemovedSchedulerEvent appRemovedEvent1=new AppAttemptRemovedSchedulerEvent(attId1,RMAppAttemptState.FINISHED,false);
  scheduler.handle(appRemovedEvent1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(0,scheduler.getSchedulerApp(attId4).getLiveContainers().size());
  appRemovedEvent1=new AppAttemptRemovedSchedulerEvent(attId2,RMAppAttemptState.FINISHED,false);
  scheduler.handle(appRemovedEvent1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(0,scheduler.getSchedulerApp(attId4).getLiveContainers().size());
  appRemovedEvent1=new AppAttemptRemovedSchedulerEvent(attId3,RMAppAttemptState.FINISHED,false);
  scheduler.handle(appRemovedEvent1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(1,scheduler.getSchedulerApp(attId4).getLiveContainers().size());
}
