{
  RMNode node1=MockNodes.newNodeInfo(1,Resources.createResource(1024));
  NodeAddedSchedulerEvent nodeEvent1=new NodeAddedSchedulerEvent(node1);
  scheduler.handle(nodeEvent1);
  createSchedulingRequest(1024,"queue1","user1",1);
  scheduler.update();
  NodeUpdateSchedulerEvent updateEvent=new NodeUpdateSchedulerEvent(node1,new ArrayList<ContainerStatus>(),new ArrayList<ContainerStatus>());
  scheduler.handle(updateEvent);
  assertEquals(1024,scheduler.getQueueManager().getQueue("queue1").getQueueSchedulable().getResourceUsage().getMemory());
  ApplicationAttemptId attId=createSchedulingRequest(1024,"queue2","user1",1);
  scheduler.update();
  scheduler.handle(updateEvent);
  assertEquals(0,scheduler.getQueueManager().getQueue("queue2").getQueueSchedulable().getResourceUsage().getMemory());
  assertEquals(1024,scheduler.applications.get(attId).getCurrentReservation().getMemory());
  RMNode node2=MockNodes.newNodeInfo(1,Resources.createResource(1024));
  NodeAddedSchedulerEvent nodeEvent2=new NodeAddedSchedulerEvent(node2);
  NodeUpdateSchedulerEvent updateEvent2=new NodeUpdateSchedulerEvent(node2,new ArrayList<ContainerStatus>(),new ArrayList<ContainerStatus>());
  scheduler.handle(nodeEvent2);
  scheduler.handle(updateEvent2);
  assertEquals(1024,scheduler.getQueueManager().getQueue("queue2").getQueueSchedulable().getResourceUsage().getMemory());
  assertEquals(1024,scheduler.applications.get(attId).getCurrentReservation().getMemory());
  scheduler.handle(updateEvent);
  assertEquals(0,scheduler.applications.get(attId).getCurrentReservation().getMemory());
}
