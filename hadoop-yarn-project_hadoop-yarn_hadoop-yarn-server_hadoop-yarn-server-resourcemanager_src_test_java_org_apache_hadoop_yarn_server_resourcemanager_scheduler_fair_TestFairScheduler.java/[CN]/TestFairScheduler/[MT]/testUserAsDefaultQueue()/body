{
  Configuration conf=createConfiguration();
  conf.set(FairSchedulerConfiguration.USER_AS_DEFAULT_QUEUE,"true");
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  RMContext rmContext=resourceManager.getRMContext();
  Map<ApplicationId,RMApp> appsMap=rmContext.getRMApps();
  ApplicationAttemptId appAttemptId=createAppAttemptId(1,1);
  RMApp rmApp=new RMAppImpl(appAttemptId.getApplicationId(),rmContext,conf,null,null,null,ApplicationSubmissionContext.newInstance(null,null,null,null,null,false,false,0,null,null),null,null,0,null);
  appsMap.put(appAttemptId.getApplicationId(),rmApp);
  AppAddedSchedulerEvent appAddedEvent=new AppAddedSchedulerEvent(appAttemptId,"default","user1");
  scheduler.handle(appAddedEvent);
  assertEquals(1,scheduler.getQueueManager().getLeafQueue("user1",true).getRunnableAppSchedulables().size());
  assertEquals(0,scheduler.getQueueManager().getLeafQueue("default",true).getRunnableAppSchedulables().size());
  assertEquals("root.user1",rmApp.getQueue());
  conf.set(FairSchedulerConfiguration.USER_AS_DEFAULT_QUEUE,"false");
  scheduler.reinitialize(conf,resourceManager.getRMContext());
  scheduler.getQueueManager().initialize();
  AppAddedSchedulerEvent appAddedEvent2=new AppAddedSchedulerEvent(createAppAttemptId(2,1),"default","user2");
  scheduler.handle(appAddedEvent2);
  assertEquals(1,scheduler.getQueueManager().getLeafQueue("user1",true).getRunnableAppSchedulables().size());
  assertEquals(1,scheduler.getQueueManager().getLeafQueue("default",true).getRunnableAppSchedulables().size());
  assertEquals(0,scheduler.getQueueManager().getLeafQueue("user2",true).getRunnableAppSchedulables().size());
}
