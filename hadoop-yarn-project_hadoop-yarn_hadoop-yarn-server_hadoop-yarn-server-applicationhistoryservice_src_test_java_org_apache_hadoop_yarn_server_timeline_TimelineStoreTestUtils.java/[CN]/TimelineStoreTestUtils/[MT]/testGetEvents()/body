{
  SortedSet<String> sortedSet=new TreeSet<String>();
  sortedSet.add(entityId1);
  List<EventsOfOneEntity> timelines=store.getEntityTimelines(entityType1,sortedSet,null,null,null,null).getAllEvents();
  assertEquals(1,timelines.size());
  verifyEntityTimeline(timelines.get(0),entityId1,entityType1,ev2,ev1);
  sortedSet.add(entityId1b);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,null,null,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entityId1,entityType1,ev2,ev1);
  verifyEntityTimeline(timelines.get(1),entityId1b,entityType1,ev2,ev1);
  timelines=store.getEntityTimelines(entityType1,sortedSet,1l,null,null,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entityId1,entityType1,ev2);
  verifyEntityTimeline(timelines.get(1),entityId1b,entityType1,ev2);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,345l,null,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entityId1,entityType1,ev2);
  verifyEntityTimeline(timelines.get(1),entityId1b,entityType1,ev2);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,123l,null,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entityId1,entityType1,ev2);
  verifyEntityTimeline(timelines.get(1),entityId1b,entityType1,ev2);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,null,345l,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entityId1,entityType1,ev1);
  verifyEntityTimeline(timelines.get(1),entityId1b,entityType1,ev1);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,null,123l,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entityId1,entityType1,ev1);
  verifyEntityTimeline(timelines.get(1),entityId1b,entityType1,ev1);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,null,null,Collections.singleton("end_event")).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entityId1,entityType1,ev2);
  verifyEntityTimeline(timelines.get(1),entityId1b,entityType1,ev2);
  sortedSet.add(entityId2);
  timelines=store.getEntityTimelines(entityType2,sortedSet,null,null,null,null).getAllEvents();
  assertEquals(1,timelines.size());
  verifyEntityTimeline(timelines.get(0),entityId2,entityType2,ev3,ev4);
}
