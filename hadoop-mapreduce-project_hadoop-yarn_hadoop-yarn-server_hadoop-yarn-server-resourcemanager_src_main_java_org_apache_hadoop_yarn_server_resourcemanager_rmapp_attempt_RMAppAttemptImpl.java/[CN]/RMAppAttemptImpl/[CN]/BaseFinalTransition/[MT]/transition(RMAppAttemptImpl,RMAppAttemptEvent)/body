{
  appAttempt.masterService.unregisterAttempt(appAttempt.applicationAttemptId);
  ApplicationId applicationId=appAttempt.getAppAttemptId().getApplicationId();
  RMAppEvent appEvent=null;
switch (finalAttemptState) {
case FINISHED:
{
      appEvent=new RMAppEvent(applicationId,RMAppEventType.ATTEMPT_FINISHED);
    }
  break;
case KILLED:
{
  appEvent=new RMAppFailedAttemptEvent(applicationId,RMAppEventType.ATTEMPT_KILLED,"Application killed by user.");
}
break;
case FAILED:
{
appEvent=new RMAppFailedAttemptEvent(applicationId,RMAppEventType.ATTEMPT_FAILED,appAttempt.getDiagnostics());
}
break;
default :
{
LOG.error("Cannot get this state!! Error!!");
}
break;
}
appAttempt.eventHandler.handle(appEvent);
appAttempt.eventHandler.handle(new AppRemovedSchedulerEvent(appAttempt.getAppAttemptId(),finalAttemptState));
}
