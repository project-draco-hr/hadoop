{
  String scheme=request.getScheme();
  final LocatedBlocks blks=nnproxy.getBlockLocations(i.getFullPath(new Path(parent)).toUri().getPath(),0,1);
  final DatanodeID host=pickSrcDatanode(blks,i);
  final String hostname;
  if (host instanceof DatanodeInfo) {
    hostname=((DatanodeInfo)host).getHostName();
  }
 else {
    hostname=host.getHost();
  }
  String dtParam="";
  if (dt != null) {
    dtParam=JspHelper.getDelegationTokenUrlParam(dt);
  }
  NameNode nn=(NameNode)getServletContext().getAttribute("name.node");
  String addr=NameNode.getHostPortString(nn.getNameNodeAddress());
  String addrParam=JspHelper.getUrlParam(JspHelper.NAMENODE_ADDRESS,addr);
  return new URI(scheme,null,hostname,"https".equals(scheme) ? (Integer)getServletContext().getAttribute("datanode.https.port") : host.getInfoPort(),"/streamFile" + i.getFullName(parent),"ugi=" + ugi.getShortUserName() + dtParam+ addrParam,null);
}
