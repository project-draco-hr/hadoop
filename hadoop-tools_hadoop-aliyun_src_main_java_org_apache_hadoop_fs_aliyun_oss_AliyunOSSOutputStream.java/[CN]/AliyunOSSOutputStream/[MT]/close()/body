{
  if (closed) {
    return;
  }
  closed=true;
  if (backupStream != null) {
    backupStream.close();
  }
  long dataLen=tmpFile.length();
  try {
    if (dataLen <= partSizeThreshold) {
      store.uploadObject(key,tmpFile);
    }
 else {
      store.multipartUploadObject(key,tmpFile);
    }
  }
  finally {
    if (!tmpFile.delete()) {
      LOG.warn("Can not delete file: " + tmpFile);
    }
  }
}
