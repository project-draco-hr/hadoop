{
  ContainerId containerID=this.container.getId();
switch (getContainerState()) {
case EXITED_WITH_SUCCESS:
    metrics.endRunningContainer();
  metrics.completedContainer();
NMAuditLogger.logSuccess(user,AuditConstants.FINISH_SUCCESS_CONTAINER,"ContainerImpl",containerID.getApplicationAttemptId().getApplicationId(),containerID);
break;
case EXITED_WITH_FAILURE:
metrics.endRunningContainer();
case LOCALIZATION_FAILED:
metrics.failedContainer();
NMAuditLogger.logFailure(user,AuditConstants.FINISH_FAILED_CONTAINER,"ContainerImpl","Container failed with state: " + getContainerState(),containerID.getApplicationAttemptId().getApplicationId(),containerID);
break;
case CONTAINER_CLEANEDUP_AFTER_KILL:
metrics.endRunningContainer();
case NEW:
metrics.killedContainer();
NMAuditLogger.logSuccess(user,AuditConstants.FINISH_KILLED_CONTAINER,"ContainerImpl",containerID.getApplicationAttemptId().getApplicationId(),containerID);
}
metrics.releaseContainer(this.container.getResource());
@SuppressWarnings("rawtypes") EventHandler eventHandler=dispatcher.getEventHandler();
eventHandler.handle(new ApplicationContainerFinishedEvent(containerID));
eventHandler.handle(new ContainerStopMonitoringEvent(containerID));
eventHandler.handle(new LogHandlerContainerFinishedEvent(containerID,exitCode));
}
