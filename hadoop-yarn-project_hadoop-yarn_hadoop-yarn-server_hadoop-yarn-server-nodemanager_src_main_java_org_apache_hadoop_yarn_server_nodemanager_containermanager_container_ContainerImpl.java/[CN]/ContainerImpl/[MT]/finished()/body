{
  ApplicationId applicationId=containerId.getApplicationAttemptId().getApplicationId();
switch (getContainerState()) {
case EXITED_WITH_SUCCESS:
    metrics.endRunningContainer();
  metrics.completedContainer();
NMAuditLogger.logSuccess(user,AuditConstants.FINISH_SUCCESS_CONTAINER,"ContainerImpl",applicationId,containerId);
break;
case EXITED_WITH_FAILURE:
if (wasLaunched) {
metrics.endRunningContainer();
}
case LOCALIZATION_FAILED:
metrics.failedContainer();
NMAuditLogger.logFailure(user,AuditConstants.FINISH_FAILED_CONTAINER,"ContainerImpl","Container failed with state: " + getContainerState(),applicationId,containerId);
break;
case CONTAINER_CLEANEDUP_AFTER_KILL:
if (wasLaunched) {
metrics.endRunningContainer();
}
case NEW:
metrics.killedContainer();
NMAuditLogger.logSuccess(user,AuditConstants.FINISH_KILLED_CONTAINER,"ContainerImpl",applicationId,containerId);
}
metrics.releaseContainer(this.resource);
@SuppressWarnings("rawtypes") EventHandler eventHandler=dispatcher.getEventHandler();
eventHandler.handle(new ApplicationContainerFinishedEvent(containerId));
eventHandler.handle(new ContainerStopMonitoringEvent(containerId));
eventHandler.handle(new LogHandlerContainerFinishedEvent(containerId,exitCode));
}
