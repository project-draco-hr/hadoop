{
  xceiverCount-=node.getXceiverCount();
  if (!(node.isDecommissionInProgress() || node.isDecommissioned())) {
    capacityUsed-=node.getDfsUsed();
    blockPoolUsed-=node.getBlockPoolUsed();
    nodesInService--;
    nodesInServiceXceiverCount-=node.getXceiverCount();
    capacityTotal-=node.getCapacity();
    capacityRemaining-=node.getRemaining();
    cacheCapacity-=node.getCacheCapacity();
    cacheUsed-=node.getCacheUsed();
  }
 else   if (!node.isDecommissioned()) {
    cacheCapacity-=node.getCacheCapacity();
    cacheUsed-=node.getCacheUsed();
  }
  Set<StorageType> storageTypes=new HashSet<>();
  for (  DatanodeStorageInfo storageInfo : node.getStorageInfos()) {
    statsMap.subtractStorage(storageInfo,node);
    storageTypes.add(storageInfo.getStorageType());
  }
  for (  StorageType storageType : storageTypes) {
    statsMap.subtractNode(storageType,node);
  }
}
