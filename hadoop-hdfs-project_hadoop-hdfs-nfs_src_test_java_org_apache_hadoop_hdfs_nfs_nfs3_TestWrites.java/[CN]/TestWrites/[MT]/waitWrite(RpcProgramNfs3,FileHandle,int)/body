{
  int waitedTime=0;
  ConcurrentMap<FileHandle,OpenFileCtx> openFileMap=nfsd.getWriteManager().getOpenFileMap();
  OpenFileCtx ctx=openFileMap.get(handle);
  assertTrue(ctx != null);
  do {
    Thread.sleep(3000);
    waitedTime+=3000;
    if (ctx.getPendingWritesForTest().size() == 0) {
      return;
    }
  }
 while (waitedTime < maxWaitTime);
  fail("Write can't finish.");
}
