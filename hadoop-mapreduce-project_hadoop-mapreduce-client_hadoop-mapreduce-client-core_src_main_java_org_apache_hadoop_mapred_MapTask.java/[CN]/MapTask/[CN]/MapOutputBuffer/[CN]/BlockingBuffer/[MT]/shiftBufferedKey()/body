{
  int headbytelen=bufvoid - bufmark;
  bufvoid=bufmark;
  final int kvbidx=4 * kvindex;
  final int kvbend=4 * kvend;
  final int avail=Math.min(distanceTo(0,kvbidx),distanceTo(0,kvbend));
  if (bufindex + headbytelen < avail) {
    System.arraycopy(kvbuffer,0,kvbuffer,headbytelen,bufindex);
    System.arraycopy(kvbuffer,bufvoid,kvbuffer,0,headbytelen);
    bufindex+=headbytelen;
    bufferRemaining-=kvbuffer.length - bufvoid;
  }
 else {
    byte[] keytmp=new byte[bufindex];
    System.arraycopy(kvbuffer,0,keytmp,0,bufindex);
    bufindex=0;
    out.write(kvbuffer,bufmark,headbytelen);
    out.write(keytmp);
  }
}
