{
  if (snapshotId == Snapshot.CURRENT_STATE_ID) {
    if (!isCurrentFileDeleted()) {
      file.recordModification(priorSnapshotId);
      deleteCurrentFile();
    }
    collectBlocksAndClear(bsps,file,collectedBlocks,removedINodes);
    return new QuotaCounts.Builder().build();
  }
 else {
    priorSnapshotId=getDiffs().updatePrior(snapshotId,priorSnapshotId);
    return diffs.deleteSnapshotDiff(bsps,snapshotId,priorSnapshotId,file,collectedBlocks,removedINodes);
  }
}
