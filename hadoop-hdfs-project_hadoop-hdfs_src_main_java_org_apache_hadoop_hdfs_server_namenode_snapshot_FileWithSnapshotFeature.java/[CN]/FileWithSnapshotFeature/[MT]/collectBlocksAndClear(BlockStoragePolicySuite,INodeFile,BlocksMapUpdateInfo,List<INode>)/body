{
  if (isCurrentFileDeleted() && getDiffs().asList().isEmpty()) {
    file.destroyAndCollectBlocks(bsps,info,removedINodes,null);
    return;
  }
  final long max;
  FileDiff diff=getDiffs().getLast();
  if (isCurrentFileDeleted()) {
    max=diff == null ? 0 : diff.getFileSize();
  }
 else {
    max=file.computeFileSize();
  }
  FileDiff last=diffs.getLast();
  BlockInfoContiguous[] snapshotBlocks=last == null ? null : last.getBlocks();
  if (snapshotBlocks == null)   file.collectBlocksBeyondMax(max,info);
 else   file.collectBlocksBeyondSnapshot(snapshotBlocks,info);
}
