{
  boolean contentTypeOK=true;
  HttpServletRequest httpReq=(HttpServletRequest)request;
  HttpServletResponse httpRes=(HttpServletResponse)response;
  String method=httpReq.getMethod();
  if (method.equals("PUT") || method.equals("POST")) {
    String op=httpReq.getParameter(HttpFSFileSystem.OP_PARAM);
    if (op != null && UPLOAD_OPERATIONS.contains(op.toUpperCase())) {
      if ("true".equalsIgnoreCase(httpReq.getParameter(HttpFSParametersProvider.DataParam.NAME))) {
        String contentType=httpReq.getContentType();
        contentTypeOK=HttpFSFileSystem.UPLOAD_CONTENT_TYPE.equalsIgnoreCase(contentType);
      }
    }
  }
  if (contentTypeOK) {
    chain.doFilter(httpReq,httpRes);
  }
 else {
    httpRes.sendError(HttpServletResponse.SC_BAD_REQUEST,"Data upload requests must have content-type set to '" + HttpFSFileSystem.UPLOAD_CONTENT_TYPE + "'");
  }
}
