{
  if (currentOffset + len > dataLength) {
    len=(int)dataLength - (int)currentOffset;
  }
  int bytesRead=in.read(b,off,len);
  if (bytesRead < 0) {
    throw new ChecksumException("Checksum Error",0);
  }
  sum.update(b,off,bytesRead);
  currentOffset+=bytesRead;
  if (disableChecksumValidation) {
    return bytesRead;
  }
  if (currentOffset == dataLength) {
    csum=new byte[checksumSize];
    IOUtils.readFully(in,csum,0,checksumSize);
    if (!sum.compare(csum,0)) {
      throw new ChecksumException("Checksum Error",0);
    }
  }
  return bytesRead;
}
