{
  HttpURLConnection conn=(HttpURLConnection)url.openConnection();
  conn.setRequestMethod(TYPE);
  conn.setInstanceFollowRedirects(false);
  String response=IOUtils.toString(conn.getInputStream());
  LOG.info("Response was : " + response);
  Assert.assertEquals("Response wasn't " + HttpURLConnection.HTTP_OK,HttpURLConnection.HTTP_OK,conn.getResponseCode());
  JSONObject responseJson=new JSONObject(response);
  Assert.assertTrue("Response didn't give us a location. " + response,responseJson.has("Location"));
  if (TYPE.equals("CREATE")) {
    URL dnLocation=new URL(responseJson.getString("Location"));
    HttpURLConnection dnConn=(HttpURLConnection)dnLocation.openConnection();
    dnConn.setRequestMethod("OPTIONS");
    Assert.assertEquals("Datanode url : " + dnLocation + " didn't allow "+ "CORS",HttpURLConnection.HTTP_OK,dnConn.getResponseCode());
  }
}
