{
  MiniDFSCluster cluster=null;
  final Configuration conf=WebHdfsTestUtil.createConf();
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).build();
    final FileSystem webHdfs=WebHdfsTestUtil.getWebHdfsFileSystem(conf,WebHdfsConstants.WEBHDFS_SCHEME);
    webHdfs.getDelegationToken(null);
    fail("No exception is thrown.");
  }
 catch (  AccessControlException ace) {
    Assert.assertTrue(ace.getMessage().startsWith(WebHdfsFileSystem.CANT_FALLBACK_TO_INSECURE_MSG));
  }
 finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
