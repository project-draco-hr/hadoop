{
  MiniDFSCluster cluster=null;
  try {
    Configuration conf=new Configuration();
    cluster=new MiniDFSCluster.Builder(conf).build();
    cluster.waitActive();
    DistributedFileSystem hdfs=cluster.getFileSystem();
    final URI uri=new URI(WebHdfsConstants.WEBHDFS_SCHEME + "://" + cluster.getHttpUri(0).replace("http://",""));
    final Configuration confTemp=new Configuration();
{
      WebHdfsFileSystem webhdfs=(WebHdfsFileSystem)FileSystem.get(uri,confTemp);
      assertEquals(hdfs.getHomeDirectory().toUri().getPath(),webhdfs.getHomeDirectory().toUri().getPath());
      webhdfs.close();
    }
{
      WebHdfsFileSystem webhdfs=createWebHDFSAsTestUser(confTemp,uri,"XXX");
      assertNotEquals(hdfs.getHomeDirectory().toUri().getPath(),webhdfs.getHomeDirectory().toUri().getPath());
      webhdfs.close();
    }
  }
  finally {
    if (cluster != null)     cluster.shutdown();
  }
}
