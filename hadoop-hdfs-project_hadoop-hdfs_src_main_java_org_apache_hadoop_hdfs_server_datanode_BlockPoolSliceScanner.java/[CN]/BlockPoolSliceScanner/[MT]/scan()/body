{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Starting to scan blockpool: " + blockPoolId);
  }
  try {
    adjustThrottler();
    while (datanode.shouldRun && !datanode.blockScanner.blockScannerThread.isInterrupted() && datanode.isBPServiceAlive(blockPoolId)) {
      long now=Time.monotonicNow();
synchronized (this) {
        if (now >= (currentPeriodStart + scanPeriod)) {
          startNewPeriod();
        }
      }
      if (((now - getEarliestScanTime()) >= scanPeriod) || ((!blockInfoSet.isEmpty()) && !(this.isFirstBlockProcessed()))) {
        verifyFirstBlock();
      }
 else {
        if (LOG.isDebugEnabled()) {
          LOG.debug("All remaining blocks were processed recently, " + "so this run is complete");
        }
        break;
      }
    }
  }
 catch (  RuntimeException e) {
    LOG.warn("RuntimeException during BlockPoolScanner.scan()",e);
    throw e;
  }
 finally {
    rollVerificationLogs();
    if (LOG.isDebugEnabled()) {
      LOG.debug("Done scanning block pool: " + blockPoolId);
    }
  }
}
