{
  final HdfsAdmin dfsAdmin=new HdfsAdmin(FileSystem.getDefaultUri(conf),conf);
  final Path baseFile=new Path("/base");
  final int len=8192;
  DFSTestUtil.createFile(fs,baseFile,len,(short)1,0xFEED);
  final Path zone=new Path("/zone");
  fs.mkdirs(zone);
  dfsAdmin.createEncryptionZone(zone,null);
  final Path encFile1=new Path(zone,"myfile");
  DFSTestUtil.createFile(fs,encFile1,len,(short)1,0xFEED);
  validateFiles(baseFile,encFile1,len);
  List<EncryptionZone> zones=dfsAdmin.listEncryptionZones();
  assertEquals("Expected 1 EZ",1,zones.size());
  String keyId=zones.get(0).getKeyId();
  cluster.getNamesystem().getProvider().rollNewVersion(keyId);
  cluster.getNamesystem().getFSDirectory().ezManager.kickMonitor();
  validateFiles(baseFile,encFile1,len);
  final Path encFile2=new Path(zone,"myfile2");
  DFSTestUtil.createFile(fs,encFile2,len,(short)1,0xFEED);
  FileEncryptionInfo feInfo1=getFileEncryptionInfo(encFile1);
  FileEncryptionInfo feInfo2=getFileEncryptionInfo(encFile2);
  assertFalse("EDEKs should be different",Arrays.equals(feInfo1.getEncryptedDataEncryptionKey(),feInfo2.getEncryptedDataEncryptionKey()));
  assertNotEquals("Key was rolled, versions should be different",feInfo1.getEzKeyVersionName(),feInfo2.getEzKeyVersionName());
  validateFiles(encFile1,encFile2,len);
}
