{
  final HdfsAdmin dfsAdmin=new HdfsAdmin(FileSystem.getDefaultUri(conf),conf);
  final int N_EZs=5;
  final Set<String> ezPathNames=new HashSet<String>(N_EZs);
  for (int i=0; i < N_EZs; i++) {
    final Path p=new Path(TEST_PATH,"" + i);
    ezPathNames.add(p.toString());
    FileSystem.mkdirs(fs,p,new FsPermission((short)0777));
    dfsAdmin.createEncryptionZone(p,null);
  }
  final List<EncryptionZone> zones=dfsAdmin.listEncryptionZones();
  Preconditions.checkState(zones.size() == N_EZs,"wrong number of EZs returned");
  for (  EncryptionZone z : zones) {
    final String ezPathName=z.getPath();
    Preconditions.checkState(ezPathNames.remove(ezPathName),"Path " + ezPathName + " not returned from listEZ");
  }
  Preconditions.checkState(ezPathNames.size() == 0);
}
