{
  List<MaterializedReplica> replicas=new ArrayList<>();
  String poolId=cluster.getNamesystem().getBlockPoolId();
  List<Map<DatanodeStorage,BlockListAsLongs>> blocks=cluster.getAllBlockReports(poolId);
  for (int i=0; i < blocks.size(); i++) {
    Map<DatanodeStorage,BlockListAsLongs> map=blocks.get(i);
    for (    Map.Entry<DatanodeStorage,BlockListAsLongs> e : map.entrySet()) {
      for (      Block b : e.getValue()) {
        replicas.add(cluster.getMaterializedReplica(i,new ExtendedBlock(poolId,b)));
      }
    }
  }
  return replicas;
}
