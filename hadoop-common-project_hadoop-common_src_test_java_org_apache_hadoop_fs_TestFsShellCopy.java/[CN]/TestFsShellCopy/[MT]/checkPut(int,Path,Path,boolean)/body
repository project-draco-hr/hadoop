{
  String argv[]=null;
  String srcPath=src.toString();
  if (useWindowsPath) {
    srcPath=(new File(srcPath)).getAbsolutePath();
  }
  if (dest != null) {
    argv=new String[]{"-put",srcPath,pathAsString(dest)};
  }
 else {
    argv=new String[]{"-put",srcPath};
    dest=new Path(Path.CUR_DIR);
  }
  Path target;
  if (lfs.exists(dest)) {
    if (lfs.isDirectory(dest)) {
      target=new Path(pathAsString(dest),src.getName());
    }
 else {
      target=dest;
    }
  }
 else {
    target=new Path(lfs.getWorkingDirectory(),dest);
  }
  boolean targetExists=lfs.exists(target);
  Path parent=lfs.makeQualified(target).getParent();
  System.out.println("COPY src[" + src.getName() + "] -> ["+ dest+ "] as ["+ target+ "]");
  String lsArgv[]=new String[]{"-ls","-R",pathAsString(parent)};
  shell.run(lsArgv);
  int gotExit=shell.run(argv);
  System.out.println("copy exit:" + gotExit);
  lsArgv=new String[]{"-ls","-R",pathAsString(parent)};
  shell.run(lsArgv);
  if (exitCode == 0) {
    assertTrue(lfs.exists(target));
    assertTrue(lfs.isFile(src) == lfs.isFile(target));
    assertEquals(1,lfs.listStatus(lfs.makeQualified(target).getParent()).length);
  }
 else {
    assertEquals(targetExists,lfs.exists(target));
  }
  assertEquals(exitCode,gotExit);
}
