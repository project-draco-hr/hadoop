{
  final Server server=new TestServer(1,true);
  server.start();
  final InetSocketAddress addr=NetUtils.getConnectAddress(server);
  DatanodeID fakeDnId=new DatanodeID("localhost:" + addr.getPort(),"fake-storage",0,addr.getPort());
  ExtendedBlock b=new ExtendedBlock("fake-pool",new Block(12345L));
  LocatedBlock fakeBlock=new LocatedBlock(b,new DatanodeInfo[0]);
  ClientDatanodeProtocol proxy=null;
  try {
    proxy=DFSUtil.createClientDatanodeProtocolProxy(fakeDnId,conf,500,fakeBlock);
    proxy.getReplicaVisibleLength(null);
    fail("Did not get expected exception: SocketTimeoutException");
  }
 catch (  SocketTimeoutException e) {
    LOG.info("Got the expected Exception: SocketTimeoutException");
  }
 finally {
    if (proxy != null) {
      RPC.stopProxy(proxy);
    }
    server.stop();
  }
}
