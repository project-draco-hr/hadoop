{
  HttpConfig.setPolicy(HttpConfig.Policy.HTTPS_ONLY);
  File base=new File(BASEDIR);
  FileUtil.fullyDelete(base);
  base.mkdirs();
  String classpathDir=KeyStoreTestUtil.getClasspathDir(TestSSLHttpServer.class);
  Configuration conf=new Configuration();
  String keystoresDir=new File(BASEDIR).getAbsolutePath();
  String sslConfsDir=KeyStoreTestUtil.getClasspathDir(TestSSLHttpServer.class);
  KeyStoreTestUtil.setupSSLConfig(keystoresDir,sslConfsDir,conf,false);
  conf.setBoolean(CommonConfigurationKeysPublic.HADOOP_SSL_ENABLED_KEY,true);
  Writer writer=new FileWriter(new File(classpathDir,CONFIG_SITE_XML));
  conf.writeXml(writer);
  writer.close();
  conf.setInt(HttpServer.HTTP_MAX_THREADS,10);
  conf.addResource(CONFIG_SITE_XML);
  server=createServer("test",conf);
  server.addServlet("echo","/echo",TestHttpServer.EchoServlet.class);
  server.start();
  baseUrl=new URL("https://localhost:" + server.getPort() + "/");
  LOG.info("HTTP server started: " + baseUrl);
}
