{
  final byte[] buf=new byte[1024];
  final MiniDFSCluster cluster=new MiniDFSCluster.Builder(new HdfsConfiguration()).numDataNodes(1).build();
  cluster.waitActive();
  try (DistributedFileSystem fs=cluster.getFileSystem()){
    final int len1=200;
    final int len2=300;
    final Path p=new Path("/foo");
    FSDataOutputStream out=fs.create(p);
    out.write(buf,0,len1);
    out.close();
    out=fs.append(p);
    out.write(buf,0,len2);
    out.hflush();
    FSDataInputStream in=fs.open(p);
    final int length=in.read(0,buf,0,len1 + len2);
    assertTrue(length > 0);
    in.close();
    out.close();
  }
  finally {
    cluster.shutdown();
  }
}
