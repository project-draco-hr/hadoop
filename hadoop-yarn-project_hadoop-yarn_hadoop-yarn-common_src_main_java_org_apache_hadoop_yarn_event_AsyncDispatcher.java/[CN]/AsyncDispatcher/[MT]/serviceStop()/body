{
  if (drainEventsOnStop) {
    blockNewEvents=true;
    LOG.info("AsyncDispatcher is draining to stop, igonring any new events.");
synchronized (waitForDrained) {
      while (!drained && eventHandlingThread != null && eventHandlingThread.isAlive()) {
        waitForDrained.wait(1000);
        LOG.info("Waiting for AsyncDispatcher to drain. Thread state is :" + eventHandlingThread.getState());
      }
    }
  }
  stopped=true;
  if (eventHandlingThread != null) {
    eventHandlingThread.interrupt();
    try {
      eventHandlingThread.join();
    }
 catch (    InterruptedException ie) {
      LOG.warn("Interrupted Exception while stopping",ie);
    }
  }
  super.serviceStop();
}
