{
  ApplicationId appId=ApplicationId.newInstance(1,2);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,0);
  JobId jobId=MRBuilderUtils.newJobId(appId,1);
  TaskId taskId=MRBuilderUtils.newTaskId(jobId,1,TaskType.MAP);
  TaskAttemptId attemptId=MRBuilderUtils.newTaskAttemptId(taskId,0);
  Path jobFile=mock(Path.class);
  MockEventHandler eventHandler=new MockEventHandler();
  TaskAttemptListener taListener=mock(TaskAttemptListener.class);
  when(taListener.getAddress()).thenReturn(new InetSocketAddress("localhost",0));
  JobConf jobConf=new JobConf();
  jobConf.setClass("fs.file.impl",StubbedFS.class,FileSystem.class);
  jobConf.setBoolean("fs.file.impl.disable.cache",true);
  jobConf.set(JobConf.MAPRED_MAP_TASK_ENV,"");
  jobConf.set(MRJobConfig.APPLICATION_ATTEMPT_ID,"10");
  TaskSplitMetaInfo splits=mock(TaskSplitMetaInfo.class);
  when(splits.getLocations()).thenReturn(new String[]{"127.0.0.1"});
  TaskAttemptImpl taImpl=new MapTaskAttemptImpl(taskId,1,eventHandler,jobFile,1,splits,jobConf,taListener,new Token(),new Credentials(),new SystemClock(),null);
  NodeId nid=NodeId.newInstance("127.0.0.1",0);
  ContainerId contId=ContainerId.newContainerId(appAttemptId,3);
  Container container=mock(Container.class);
  when(container.getId()).thenReturn(contId);
  when(container.getNodeId()).thenReturn(nid);
  taImpl.handle(new TaskAttemptEvent(attemptId,TaskAttemptEventType.TA_SCHEDULE));
  taImpl.handle(new TaskAttemptContainerAssignedEvent(attemptId,container,mock(Map.class)));
  taImpl.handle(new TaskAttemptEvent(attemptId,TaskAttemptEventType.TA_KILL));
  taImpl.handle(new TaskAttemptEvent(attemptId,TaskAttemptEventType.TA_CONTAINER_CLEANED));
  taImpl.handle(new TaskAttemptEvent(attemptId,TaskAttemptEventType.TA_CONTAINER_LAUNCH_FAILED));
  assertFalse(eventHandler.internalError);
  assertEquals("Task attempt is not assigned on the local node",Locality.NODE_LOCAL,taImpl.getLocality());
}
