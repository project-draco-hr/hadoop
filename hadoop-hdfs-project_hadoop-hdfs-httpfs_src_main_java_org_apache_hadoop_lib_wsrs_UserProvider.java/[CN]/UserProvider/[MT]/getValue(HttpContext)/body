{
  Principal principal=httpContext.getRequest().getUserPrincipal();
  if (principal == null) {
    final String user=httpContext.getRequest().getQueryParameters().getFirst(USER_NAME_PARAM);
    if (user != null) {
      principal=new Principal(){
        @Override public String getName(){
          return new UserParam(user).value();
        }
      }
;
    }
  }
  if (principal != null) {
    MDC.put("user",principal.getName());
  }
  return principal;
}
