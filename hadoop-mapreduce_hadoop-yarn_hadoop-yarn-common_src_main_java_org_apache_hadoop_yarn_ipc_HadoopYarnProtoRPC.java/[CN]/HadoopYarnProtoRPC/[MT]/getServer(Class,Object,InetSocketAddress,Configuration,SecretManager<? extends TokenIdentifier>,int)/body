{
  LOG.info("Creating a HadoopYarnProtoRpc server for protocol " + protocol + " with "+ numHandlers+ " handlers");
  LOG.info("Configured SecurityInfo class name is " + conf.get(YarnConfiguration.YARN_SECURITY_INFO));
  final RPC.Server hadoopServer;
  hadoopServer=RpcFactoryProvider.getServerFactory(conf).getServer(protocol,instance,addr,conf,secretManager,numHandlers);
  Server server=new Server(){
    @Override public void close(){
      hadoopServer.stop();
    }
    @Override public int getPort(){
      return hadoopServer.getListenerAddress().getPort();
    }
    @Override public void join() throws InterruptedException {
      hadoopServer.join();
    }
    @Override public void start(){
      hadoopServer.start();
    }
  }
;
  return server;
}
