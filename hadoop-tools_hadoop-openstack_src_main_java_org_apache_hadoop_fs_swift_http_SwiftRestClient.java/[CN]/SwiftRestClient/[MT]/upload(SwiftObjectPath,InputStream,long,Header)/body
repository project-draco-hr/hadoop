{
  preRemoteCommand("upload");
  try {
    perform("upload",pathToURI(path),new PutMethodProcessor<byte[]>(){
      @Override public byte[] extractResult(      PutMethod method) throws IOException {
        return method.getResponseBody();
      }
      @Override protected void setup(      PutMethod method) throws SwiftInternalStateException {
        method.setRequestEntity(new InputStreamRequestEntity(data,length));
        setHeaders(method,requestHeaders);
      }
    }
);
  }
  finally {
    data.close();
  }
}
