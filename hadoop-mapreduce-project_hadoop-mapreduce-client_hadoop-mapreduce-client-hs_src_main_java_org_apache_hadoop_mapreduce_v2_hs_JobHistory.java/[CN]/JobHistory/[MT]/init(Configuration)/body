{
  LOG.info("JobHistory Init");
  this.conf=conf;
  this.appID=RecordFactoryProvider.getRecordFactory(conf).newRecordInstance(ApplicationId.class);
  this.appAttemptID=RecordFactoryProvider.getRecordFactory(conf).newRecordInstance(ApplicationAttemptId.class);
  debugMode=conf.getBoolean(JHConfig.HISTORY_DEBUG_MODE_KEY,false);
  serialNumberLowDigits=debugMode ? 1 : 3;
  serialNumberFormat=("%0" + (JobHistoryUtils.SERIAL_NUMBER_DIRECTORY_DIGITS + serialNumberLowDigits) + "d");
  String doneDirPrefix=null;
  doneDirPrefix=JobHistoryUtils.getConfiguredHistoryServerDoneDirPrefix(conf);
  try {
    doneDirPrefixPath=FileContext.getFileContext(conf).makeQualified(new Path(doneDirPrefix));
    doneDirFc=FileContext.getFileContext(doneDirPrefixPath.toUri(),conf);
    mkdir(doneDirFc,doneDirPrefixPath,new FsPermission(JobHistoryUtils.HISTORY_DONE_DIR_PERMISSION));
  }
 catch (  IOException e) {
    throw new YarnException("Error creating done directory: [" + doneDirPrefixPath + "]",e);
  }
  String intermediateDoneDirPrefix=null;
  intermediateDoneDirPrefix=JobHistoryUtils.getConfiguredHistoryIntermediateDoneDirPrefix(conf);
  try {
    intermediateDoneDirPath=FileContext.getFileContext(conf).makeQualified(new Path(intermediateDoneDirPrefix));
    intermediateDoneDirFc=FileContext.getFileContext(intermediateDoneDirPath.toUri(),conf);
    mkdir(intermediateDoneDirFc,intermediateDoneDirPath,new FsPermission(JobHistoryUtils.HISTORY_INTERMEDIATE_DONE_DIR_PERMISSIONS.toShort()));
  }
 catch (  IOException e) {
    LOG.info("error creating done directory on dfs " + e);
    throw new YarnException("Error creating intermediate done directory: [" + intermediateDoneDirPath + "]",e);
  }
  jobListCacheSize=conf.getInt(JHConfig.HISTORY_SERVER_JOBLIST_CACHE_SIZE_KEY,DEFAULT_JOBLIST_CACHE_SIZE);
  loadedJobCacheSize=conf.getInt(JHConfig.HISTORY_SERVER_LOADED_JOB_CACHE_SIZE_KEY,DEFAULT_LOADEDJOB_CACHE_SIZE);
  dateStringCacheSize=conf.getInt(JHConfig.HISTORY_SERVER_DATESTRING_CACHE_SIZE_KEY,DEFAULT_DATESTRING_CACHE_SIZE);
  moveThreadInterval=conf.getLong(JHConfig.HISTORY_SERVER_MOVE_THREAD_INTERVAL,DEFAULT_MOVE_THREAD_INTERVAL);
  numMoveThreads=conf.getInt(JHConfig.HISTORY_SERVER_NUM_MOVE_THREADS,DEFAULT_MOVE_THREAD_COUNT);
  try {
    initExisting();
  }
 catch (  IOException e) {
    throw new YarnException("Failed to intialize existing directories",e);
  }
  super.init(conf);
}
