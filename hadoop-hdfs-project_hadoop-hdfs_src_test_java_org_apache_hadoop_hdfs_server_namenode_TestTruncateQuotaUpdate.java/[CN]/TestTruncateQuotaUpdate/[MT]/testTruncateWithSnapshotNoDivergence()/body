{
  INodeFile file=createMockFile(BLOCKSIZE * 2 + BLOCKSIZE / 2,REPLICATION);
  addSnapshotFeature(file,file.getContiguousBlocks());
  QuotaCounts count=new QuotaCounts.Builder().build();
  file.computeQuotaDeltaForTruncate(BLOCKSIZE + BLOCKSIZE / 2,null,count);
  Assert.assertEquals(BLOCKSIZE * REPLICATION,count.getStorageSpace());
  count=new QuotaCounts.Builder().build();
  file.computeQuotaDeltaForTruncate(BLOCKSIZE,null,count);
  Assert.assertEquals(0,count.getStorageSpace());
  count=new QuotaCounts.Builder().build();
  file.computeQuotaDeltaForTruncate(0,null,count);
  Assert.assertEquals(0,count.getStorageSpace());
}
