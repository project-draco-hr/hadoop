{
  long totalCapacity=0;
  long totalRemaining=0;
  long totalBlockPoolUsed=0;
  long totalDfsUsed=0;
  setCacheCapacity(cacheCapacity);
  setCacheUsed(cacheUsed);
  setXceiverCount(xceiverCount);
  setLastUpdate(Time.now());
  this.volumeFailures=volFailures;
  for (  StorageReport report : reports) {
    DatanodeStorageInfo storage=storageMap.get(report.getStorageID());
    if (storage != null) {
      storage.receivedHeartbeat(report);
      totalCapacity+=report.getCapacity();
      totalRemaining+=report.getRemaining();
      totalBlockPoolUsed+=report.getBlockPoolUsed();
      totalDfsUsed+=report.getDfsUsed();
    }
 else {
      LOG.warn("Unrecognized storage ID " + report.getStorageID());
    }
  }
  rollBlocksScheduled(getLastUpdate());
  setCapacity(totalCapacity);
  setRemaining(totalRemaining);
  setBlockPoolUsed(totalBlockPoolUsed);
  setDfsUsed(totalDfsUsed);
}
