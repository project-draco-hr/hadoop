{
  final long requiredSize=blockSize * HdfsServerConstants.MIN_BLOCKS_FOR_WRITE;
  final long scheduledSize=blockSize * getBlocksScheduled(t);
  long remaining=0;
  DatanodeStorageInfo storage=null;
  for (  DatanodeStorageInfo s : getStorageInfos()) {
    if (s.getState() == State.NORMAL && s.getStorageType() == t) {
      if (storage == null) {
        storage=s;
      }
      long r=s.getRemaining();
      if (r >= requiredSize) {
        remaining+=r;
      }
    }
  }
  if (requiredSize > remaining - scheduledSize) {
    return null;
  }
  return storage;
}
