{
  final Server server=new TestServer(1,true);
  server.start();
  final InetSocketAddress addr=NetUtils.getConnectAddress(server);
  DatanodeID fakeDnId=new DatanodeID("localhost:" + addr.getPort(),"fake-storage",0,addr.getPort());
  DatanodeInfo dInfo=new DatanodeInfo(fakeDnId);
  InterDatanodeProtocol proxy=null;
  try {
    proxy=DataNode.createInterDataNodeProtocolProxy(dInfo,conf,500);
    proxy.initReplicaRecovery(new RecoveringBlock(new ExtendedBlock("bpid",1),null,100));
    fail("Expected SocketTimeoutException exception, but did not get.");
  }
  finally {
    if (proxy != null) {
      RPC.stopProxy(proxy);
    }
    server.stop();
  }
}
