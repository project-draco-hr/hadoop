{
  cluster.shutdown();
  namesystem=null;
  filesystem=null;
  cluster=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleHATopology()).numDataNodes(1).build();
  FSNamesystem ns0=cluster.getNamesystem(0);
  ExtendedBlock oldBlock=new ExtendedBlock();
  ExtendedBlock newBlock=new ExtendedBlock();
  DatanodeID[] newNodes=new DatanodeID[2];
  newCall();
  try {
    ns0.updatePipeline("testClient",oldBlock,newBlock,newNodes);
    fail("Expect StandbyException from the updatePipeline call");
  }
 catch (  StandbyException e) {
    GenericTestUtils.assertExceptionContains(HAServiceState.STANDBY.toString(),e);
  }
  cluster.transitionToActive(0);
  try {
    ns0.updatePipeline("testClient",oldBlock,newBlock,newNodes);
  }
 catch (  IOException e) {
  }
}
