{
  String bindAddress=WebAppUtils.getWebAppBindURL(getConfig(),YarnConfiguration.NM_BIND_HOST,WebAppUtils.getNMWebAppURLWithoutScheme(getConfig()));
  boolean enableCors=getConfig().getBoolean(YarnConfiguration.NM_WEBAPP_ENABLE_CORS_FILTER,YarnConfiguration.DEFAULT_NM_WEBAPP_ENABLE_CORS_FILTER);
  if (enableCors) {
    getConfig().setBoolean(HttpCrossOriginFilterInitializer.PREFIX + HttpCrossOriginFilterInitializer.ENABLED_SUFFIX,true);
  }
  LOG.info("Instantiating NMWebApp at " + bindAddress);
  try {
    this.webApp=WebApps.$for("node",Context.class,this.nmContext,"ws").at(bindAddress).with(getConfig()).withHttpSpnegoPrincipalKey(YarnConfiguration.NM_WEBAPP_SPNEGO_USER_NAME_KEY).withHttpSpnegoKeytabKey(YarnConfiguration.NM_WEBAPP_SPNEGO_KEYTAB_FILE_KEY).withCSRFProtection(YarnConfiguration.NM_CSRF_PREFIX).withXFSProtection(YarnConfiguration.NM_XFS_PREFIX).start(this.nmWebApp);
    this.port=this.webApp.httpServer().getConnectorAddress(0).getPort();
  }
 catch (  Exception e) {
    String msg="NMWebapps failed to start.";
    LOG.error(msg,e);
    throw new YarnRuntimeException(msg,e);
  }
  super.serviceStart();
}
