{
  try {
    resourceManager.registerNode(host,memory,vCores);
    int attempts=10;
    Collection<Plan> plans;
    do {
      DrainDispatcher dispatcher=(DrainDispatcher)resourceManager.getRMContext().getDispatcher();
      dispatcher.await();
      LOG.info("Waiting for node capacity to be added to plan");
      plans=resourceManager.getRMContext().getReservationSystem().getAllPlans().values();
      if (checkCapacity(plans)) {
        break;
      }
      Thread.sleep(100);
    }
 while (attempts-- > 0);
    if (attempts <= 0) {
      Assert.fail("Exhausted attempts in checking if node capacity was " + "added to the plan");
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
    Assert.fail(e.getMessage());
  }
}
