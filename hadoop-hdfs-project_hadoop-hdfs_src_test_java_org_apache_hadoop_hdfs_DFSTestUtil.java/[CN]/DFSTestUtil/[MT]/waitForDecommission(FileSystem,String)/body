{
  DatanodeInfo dn=null;
  int count=0;
  final int ATTEMPTS=20;
  do {
    Thread.sleep(1000);
    DistributedFileSystem dfs=(DistributedFileSystem)fs;
    for (    DatanodeInfo info : dfs.getDataNodeStats()) {
      if (name.equals(info.getXferAddr())) {
        dn=info;
      }
    }
    count++;
  }
 while ((dn == null || dn.isDecommissionInProgress() || !dn.isDecommissioned()) && count < ATTEMPTS);
  if (count == ATTEMPTS) {
    throw new TimeoutException("Timed out waiting for datanode " + name + " to decommission.");
  }
}
