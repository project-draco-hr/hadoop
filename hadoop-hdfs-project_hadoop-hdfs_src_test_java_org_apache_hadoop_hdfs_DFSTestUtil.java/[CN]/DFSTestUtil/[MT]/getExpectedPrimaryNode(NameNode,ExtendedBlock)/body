{
  FSNamesystem fsn=nn.getNamesystem();
  BlockInfoContiguous storedBlock=fsn.getStoredBlock(blk.getLocalBlock());
  assertTrue("Block " + blk + " should be under construction, "+ "got: "+ storedBlock,storedBlock instanceof BlockInfoContiguousUnderConstruction);
  BlockInfoContiguousUnderConstruction ucBlock=(BlockInfoContiguousUnderConstruction)storedBlock;
  final DatanodeStorageInfo[] storages=ucBlock.getExpectedStorageLocations();
  DatanodeStorageInfo expectedPrimary=storages[0];
  long mostRecentLastUpdate=expectedPrimary.getDatanodeDescriptor().getLastUpdateMonotonic();
  for (int i=1; i < storages.length; i++) {
    final long lastUpdate=storages[i].getDatanodeDescriptor().getLastUpdateMonotonic();
    if (lastUpdate > mostRecentLastUpdate) {
      expectedPrimary=storages[i];
      mostRecentLastUpdate=lastUpdate;
    }
  }
  return expectedPrimary.getDatanodeDescriptor();
}
