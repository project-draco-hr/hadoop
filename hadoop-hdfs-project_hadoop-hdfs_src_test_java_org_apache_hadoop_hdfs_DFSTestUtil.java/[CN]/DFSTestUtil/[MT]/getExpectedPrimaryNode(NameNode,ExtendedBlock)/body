{
  BlockManager bm0=nn.getNamesystem().getBlockManager();
  BlockInfoContiguous storedBlock=bm0.getStoredBlock(blk.getLocalBlock());
  assertTrue("Block " + blk + " should be under construction, "+ "got: "+ storedBlock,storedBlock instanceof BlockInfoContiguousUnderConstruction);
  BlockInfoContiguousUnderConstruction ucBlock=(BlockInfoContiguousUnderConstruction)storedBlock;
  final DatanodeStorageInfo[] storages=ucBlock.getExpectedStorageLocations();
  DatanodeStorageInfo expectedPrimary=storages[0];
  long mostRecentLastUpdate=expectedPrimary.getDatanodeDescriptor().getLastUpdate();
  for (int i=1; i < storages.length; i++) {
    final long lastUpdate=storages[i].getDatanodeDescriptor().getLastUpdate();
    if (lastUpdate > mostRecentLastUpdate) {
      expectedPrimary=storages[i];
      mostRecentLastUpdate=lastUpdate;
    }
  }
  return expectedPrimary.getDatanodeDescriptor();
}
