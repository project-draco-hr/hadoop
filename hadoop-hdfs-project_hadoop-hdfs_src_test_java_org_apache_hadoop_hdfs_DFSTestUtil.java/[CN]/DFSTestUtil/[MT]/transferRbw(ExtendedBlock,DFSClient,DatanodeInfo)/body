{
  assertEquals(2,datanodes.length);
  final long writeTimeout=dfsClient.getDatanodeWriteTimeout(datanodes.length);
  try (Socket s=DataStreamer.createSocketForPipeline(datanodes[0],datanodes.length,dfsClient);DataOutputStream out=new DataOutputStream(new BufferedOutputStream(NetUtils.getOutputStream(s,writeTimeout),DFSUtilClient.getSmallBufferSize(dfsClient.getConfiguration())));DataInputStream in=new DataInputStream(NetUtils.getInputStream(s))){
    new Sender(out).transferBlock(b,new Token<BlockTokenIdentifier>(),dfsClient.clientName,new DatanodeInfo[]{datanodes[1]},new StorageType[]{StorageType.DEFAULT});
    out.flush();
    return BlockOpResponseProto.parseDelimitedFrom(in);
  }
 }
