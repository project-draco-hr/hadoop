{
  assertEquals(2,datanodes.length);
  final Socket s=DFSOutputStream.createSocketForPipeline(datanodes[0],datanodes.length,dfsClient);
  final long writeTimeout=dfsClient.getDatanodeWriteTimeout(datanodes.length);
  final DataOutputStream out=new DataOutputStream(new BufferedOutputStream(NetUtils.getOutputStream(s,writeTimeout),HdfsConstants.SMALL_BUFFER_SIZE));
  final DataInputStream in=new DataInputStream(NetUtils.getInputStream(s));
  new Sender(out).transferBlock(b,new Token<BlockTokenIdentifier>(),dfsClient.clientName,new DatanodeInfo[]{datanodes[1]},new StorageType[]{StorageType.DEFAULT});
  out.flush();
  return BlockOpResponseProto.parseDelimitedFrom(in);
}
