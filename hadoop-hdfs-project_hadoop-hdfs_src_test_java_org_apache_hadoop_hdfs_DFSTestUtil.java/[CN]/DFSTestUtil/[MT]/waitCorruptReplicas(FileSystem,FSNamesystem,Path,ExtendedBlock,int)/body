{
  int count=0;
  final int ATTEMPTS=50;
  int repls=ns.getBlockManager().numCorruptReplicas(b.getLocalBlock());
  while (repls != corruptRepls && count < ATTEMPTS) {
    try {
      IOUtils.copyBytes(fs.open(file),new IOUtils.NullOutputStream(),512,true);
    }
 catch (    IOException e) {
    }
    System.out.println("Waiting for " + corruptRepls + " corrupt replicas");
    count++;
    for (int i=0; i < 10; i++) {
      repls=ns.getBlockManager().numCorruptReplicas(b.getLocalBlock());
      Thread.sleep(100);
      if (repls == corruptRepls) {
        break;
      }
    }
  }
  if (count == ATTEMPTS) {
    throw new TimeoutException("Timed out waiting for corrupt replicas." + " Waiting for " + corruptRepls + ", but only found "+ repls);
  }
}
