{
  ClusterStatus cs=new ClusterStatus();
  Configuration conf=new Configuration();
  List<InetSocketAddress> isas=null;
  try {
    isas=DFSUtil.getNNServiceRpcAddresses(conf);
  }
 catch (  Exception e) {
    cs.setError(e);
    return cs;
  }
  for (  InetSocketAddress isa : isas) {
    NamenodeMXBeanHelper nnHelper=null;
    try {
      nnHelper=new NamenodeMXBeanHelper(isa,conf);
      String mbeanProps=queryMbean(nnHelper.httpAddress,conf);
      NamenodeStatus nn=nnHelper.getNamenodeStatus(mbeanProps);
      if (cs.clusterid.isEmpty() || cs.clusterid.equals("")) {
        cs.clusterid=nnHelper.getClusterId(mbeanProps);
      }
      cs.addNamenodeStatus(nn);
    }
 catch (    Exception e) {
      cs.addException(isa.getHostName(),e);
      continue;
    }
  }
  return cs;
}
