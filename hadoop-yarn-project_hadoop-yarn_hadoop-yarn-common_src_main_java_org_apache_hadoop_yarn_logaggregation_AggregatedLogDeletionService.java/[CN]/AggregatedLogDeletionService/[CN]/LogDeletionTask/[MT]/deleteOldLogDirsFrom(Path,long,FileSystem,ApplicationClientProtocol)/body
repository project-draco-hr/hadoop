{
  try {
    for (    FileStatus appDir : fs.listStatus(dir)) {
      if (appDir.isDirectory() && appDir.getModificationTime() < cutoffMillis) {
        boolean appTerminated=isApplicationTerminated(ApplicationId.fromString(appDir.getPath().getName()),rmClient);
        if (appTerminated && shouldDeleteLogDir(appDir,cutoffMillis,fs)) {
          try {
            LOG.info("Deleting aggregated logs in " + appDir.getPath());
            fs.delete(appDir.getPath(),true);
          }
 catch (          IOException e) {
            logIOException("Could not delete " + appDir.getPath(),e);
          }
        }
 else         if (!appTerminated) {
          try {
            for (            FileStatus node : fs.listStatus(appDir.getPath())) {
              if (node.getModificationTime() < cutoffMillis) {
                try {
                  fs.delete(node.getPath(),true);
                }
 catch (                IOException ex) {
                  logIOException("Could not delete " + appDir.getPath(),ex);
                }
              }
            }
          }
 catch (          IOException e) {
            logIOException("Error reading the contents of " + appDir.getPath(),e);
          }
        }
      }
    }
  }
 catch (  IOException e) {
    logIOException("Could not read the contents of " + dir,e);
  }
}
