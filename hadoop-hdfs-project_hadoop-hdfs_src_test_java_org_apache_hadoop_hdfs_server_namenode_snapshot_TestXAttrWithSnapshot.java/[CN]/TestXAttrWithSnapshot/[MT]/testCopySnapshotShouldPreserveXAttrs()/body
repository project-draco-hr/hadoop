{
  FileSystem.mkdirs(hdfs,path,FsPermission.createImmutable((short)0700));
  hdfs.setXAttr(path,name1,value1);
  hdfs.setXAttr(path,name2,value2);
  SnapshotTestHelper.createSnapshot(hdfs,path,snapshotName);
  Path snapshotCopy=new Path(path.toString() + "-copy");
  String[] argv=new String[]{"-cp","-px",snapshotPath.toUri().toString(),snapshotCopy.toUri().toString()};
  int ret=ToolRunner.run(new FsShell(conf),argv);
  assertEquals("cp -px is not working on a snapshot",SUCCESS,ret);
  Map<String,byte[]> xattrs=hdfs.getXAttrs(snapshotCopy);
  assertArrayEquals(value1,xattrs.get(name1));
  assertArrayEquals(value2,xattrs.get(name2));
}
