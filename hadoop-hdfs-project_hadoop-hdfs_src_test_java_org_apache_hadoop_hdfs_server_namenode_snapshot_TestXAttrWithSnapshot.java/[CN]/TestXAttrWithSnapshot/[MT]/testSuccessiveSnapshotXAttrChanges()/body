{
  FileSystem.mkdirs(hdfs,path,FsPermission.createImmutable((short)0700));
  hdfs.setXAttr(path,name1,value1);
  SnapshotTestHelper.createSnapshot(hdfs,path,snapshotName);
  Map<String,byte[]> xattrs=hdfs.getXAttrs(snapshotPath);
  Assert.assertEquals(1,xattrs.size());
  Assert.assertArrayEquals(value1,xattrs.get(name1));
  hdfs.setXAttr(path,name1,newValue1);
  hdfs.setXAttr(path,name2,value2);
  SnapshotTestHelper.createSnapshot(hdfs,path,snapshotName2);
  xattrs=hdfs.getXAttrs(snapshotPath2);
  Assert.assertEquals(2,xattrs.size());
  Assert.assertArrayEquals(newValue1,xattrs.get(name1));
  Assert.assertArrayEquals(value2,xattrs.get(name2));
  hdfs.setXAttr(path,name1,value1);
  hdfs.removeXAttr(path,name2);
  SnapshotTestHelper.createSnapshot(hdfs,path,snapshotName3);
  xattrs=hdfs.getXAttrs(snapshotPath3);
  Assert.assertEquals(1,xattrs.size());
  Assert.assertArrayEquals(value1,xattrs.get(name1));
  xattrs=hdfs.getXAttrs(snapshotPath);
  Assert.assertEquals(1,xattrs.size());
  Assert.assertArrayEquals(value1,xattrs.get(name1));
  xattrs=hdfs.getXAttrs(snapshotPath2);
  Assert.assertEquals(2,xattrs.size());
  Assert.assertArrayEquals(newValue1,xattrs.get(name1));
  Assert.assertArrayEquals(value2,xattrs.get(name2));
  hdfs.deleteSnapshot(path,snapshotName2);
  xattrs=hdfs.getXAttrs(snapshotPath);
  Assert.assertEquals(1,xattrs.size());
  Assert.assertArrayEquals(value1,xattrs.get(name1));
  xattrs=hdfs.getXAttrs(snapshotPath3);
  Assert.assertEquals(1,xattrs.size());
  Assert.assertArrayEquals(value1,xattrs.get(name1));
  hdfs.deleteSnapshot(path,snapshotName);
  hdfs.deleteSnapshot(path,snapshotName3);
}
