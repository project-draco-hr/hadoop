{
  FileSystem.mkdirs(hdfs,path,FsPermission.createImmutable((short)0700));
  hdfs.setXAttr(path,name1,value1);
  hdfs.setXAttr(path,name2,value2);
  SnapshotTestHelper.createSnapshot(hdfs,path,snapshotName);
  Map<String,byte[]> xattrs=hdfs.getXAttrs(path);
  Assert.assertEquals(xattrs.size(),2);
  Assert.assertArrayEquals(value1,xattrs.get(name1));
  Assert.assertArrayEquals(value2,xattrs.get(name2));
  xattrs=hdfs.getXAttrs(snapshotPath);
  Assert.assertEquals(xattrs.size(),2);
  Assert.assertArrayEquals(value1,xattrs.get(name1));
  Assert.assertArrayEquals(value2,xattrs.get(name2));
  hdfs.removeXAttr(path,name1);
  hdfs.removeXAttr(path,name2);
  doSnapshotRootRemovalAssertions(path,snapshotPath);
  restart(false);
  doSnapshotRootRemovalAssertions(path,snapshotPath);
  restart(true);
  doSnapshotRootRemovalAssertions(path,snapshotPath);
}
