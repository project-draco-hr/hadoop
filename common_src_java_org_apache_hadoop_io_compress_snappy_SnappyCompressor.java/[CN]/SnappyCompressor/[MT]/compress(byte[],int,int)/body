{
  if (b == null) {
    throw new NullPointerException();
  }
  if (off < 0 || len < 0 || off > b.length - len) {
    throw new ArrayIndexOutOfBoundsException();
  }
  if (finished || outBuf.position() == 0) {
    finished=true;
    return 0;
  }
  if (compressedBuf.position() == 0) {
    try {
      outBuf.limit(outBuf.position());
      outBuf.rewind();
      int lim=Snappy.compress(outBuf,compressedBuf);
      compressedBuf.limit(lim);
      compressedBuf.rewind();
    }
 catch (    SnappyException e) {
      throw new IOException(e);
    }
  }
  int n=(compressedBuf.limit() - compressedBuf.position()) > len ? len : (compressedBuf.limit() - compressedBuf.position());
  if (n == 0) {
    finished=true;
    return 0;
  }
  compressedBuf.get(b,off,n);
  bytesWritten+=n;
  if (compressedBuf.position() == compressedBuf.limit()) {
    finished=true;
    outBuf.limit(outBuf.capacity());
    outBuf.rewind();
    compressedBuf.limit(compressedBuf.capacity());
    compressedBuf.rewind();
  }
  return n;
}
