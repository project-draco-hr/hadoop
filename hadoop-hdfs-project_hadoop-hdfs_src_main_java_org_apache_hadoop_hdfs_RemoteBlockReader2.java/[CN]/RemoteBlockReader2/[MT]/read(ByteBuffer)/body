{
  if (curPacketBuf == null || curDataSlice.remaining() == 0 && bytesNeededToFinish > 0) {
    readNextPacket();
  }
  if (curDataSlice.remaining() == 0) {
    return -1;
  }
  int nRead=Math.min(curDataSlice.remaining(),buf.remaining());
  ByteBuffer writeSlice=curDataSlice.duplicate();
  writeSlice.limit(writeSlice.position() + nRead);
  buf.put(writeSlice);
  curDataSlice.position(writeSlice.position());
  return nRead;
}
