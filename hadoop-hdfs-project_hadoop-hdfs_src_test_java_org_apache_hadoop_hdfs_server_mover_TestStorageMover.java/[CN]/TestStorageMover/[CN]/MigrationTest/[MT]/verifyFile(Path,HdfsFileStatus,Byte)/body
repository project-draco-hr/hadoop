{
  HdfsLocatedFileStatus fileStatus=(HdfsLocatedFileStatus)status;
  byte policyId=fileStatus.getStoragePolicy();
  BlockStoragePolicy policy=policies.getPolicy(policyId);
  if (expectedPolicyId != null) {
    Assert.assertEquals((byte)expectedPolicyId,policy.getId());
  }
  final List<StorageType> types=policy.chooseStorageTypes(status.getReplication());
  for (  LocatedBlock lb : fileStatus.getBlockLocations().getLocatedBlocks()) {
    final Mover.StorageTypeDiff diff=new Mover.StorageTypeDiff(types,lb.getStorageTypes());
    Assert.assertTrue(fileStatus.getFullName(parent.toString()) + " with policy " + policy+ " has non-empty overlap: "+ diff+ ", the corresponding block is "+ lb.getBlock().getLocalBlock(),diff.removeOverlap(true));
  }
}
