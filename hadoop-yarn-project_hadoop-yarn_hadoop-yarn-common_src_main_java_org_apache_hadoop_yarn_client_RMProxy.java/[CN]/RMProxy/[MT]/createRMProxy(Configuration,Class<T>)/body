{
  YarnConfiguration conf=(configuration instanceof YarnConfiguration) ? (YarnConfiguration)configuration : new YarnConfiguration(configuration);
  RetryPolicy retryPolicy=createRetryPolicy(conf);
  if (HAUtil.isHAEnabled(conf)) {
    RMFailoverProxyProvider<T> provider=INSTANCE.createRMFailoverProxyProvider(conf,protocol);
    return (T)RetryProxy.create(protocol,provider,retryPolicy);
  }
 else {
    InetSocketAddress rmAddress=INSTANCE.getRMAddress(conf,protocol);
    LOG.info("Connecting to ResourceManager at " + rmAddress);
    T proxy=RMProxy.<T>getProxy(conf,protocol,rmAddress);
    return (T)RetryProxy.create(protocol,proxy,retryPolicy);
  }
}
