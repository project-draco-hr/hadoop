{
  LOG.info("Computing metdata");
  InputStream blockContents=null;
  DataInputStream blockMetadata=null;
  try {
    blockContents=new FileInputStream(localBlockFile);
    blockMetadata=computeMetadata(getConf(),blockContents);
    blockContents.close();
    blockContents=new FileInputStream(localBlockFile);
    sendFixedBlock(datanode,blockContents,blockMetadata,block,blockSize);
  }
  finally {
    if (blockContents != null) {
      blockContents.close();
      blockContents=null;
    }
    if (blockMetadata != null) {
      blockMetadata.close();
      blockMetadata=null;
    }
  }
}
