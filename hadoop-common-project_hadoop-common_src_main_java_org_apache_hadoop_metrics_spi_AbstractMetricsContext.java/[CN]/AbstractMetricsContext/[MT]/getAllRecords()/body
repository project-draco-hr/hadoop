{
  Map<String,Collection<OutputRecord>> out=new TreeMap<String,Collection<OutputRecord>>();
  for (  Map.Entry<String,RecordMap> recordEntry : bufferedData.entrySet()) {
    RecordMap recordMap=recordEntry.getValue();
synchronized (recordMap) {
      List<OutputRecord> records=new ArrayList<OutputRecord>();
      Set<Entry<TagMap,MetricMap>> entrySet=recordMap.entrySet();
      for (      Entry<TagMap,MetricMap> entry : entrySet) {
        OutputRecord outRec=new OutputRecord(entry.getKey(),entry.getValue());
        records.add(outRec);
      }
      out.put(recordEntry.getKey(),records);
    }
  }
  return out;
}
