{
  String pathStr=path.toString();
  HdfsFileStatus status=dfs.getFileInfo(pathStr);
  if (!status.isDir()) {
    for (int retries=10; retries > 0; retries--) {
      if (dfs.recoverLease(pathStr)) {
        return;
      }
 else {
        try {
          Thread.sleep(1000);
        }
 catch (        InterruptedException ignored) {
        }
      }
    }
    throw new IOException("Failed to recover lease of " + path);
  }
  byte prev[]=HdfsFileStatus.EMPTY_NAME;
  DirectoryListing dirList;
  do {
    dirList=dfs.listPaths(pathStr,prev);
    HdfsFileStatus files[]=dirList.getPartialListing();
    for (    HdfsFileStatus f : files) {
      recoverAllLeases(dfs,f.getFullPath(path));
    }
    prev=dirList.getLastName();
  }
 while (dirList.hasMore());
}
