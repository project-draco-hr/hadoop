{
  deleteQueuesConfigFile();
  Document doc=createDocument();
  createSimpleDocument(doc);
  writeToFile(doc,QUEUES_CONFIG_FILE_PATH);
  QueueManager qm=new QueueManager(QUEUES_CONFIG_FILE_PATH,true);
  Queue beforeRefreshRoot=qm.getRoot();
  Set<Queue> rootQueues=beforeRefreshRoot.getChildren();
  for (  Queue qs : rootQueues) {
    if (qs.getName().equals("q1")) {
      assertEquals(qs.getProperties().getProperty("capacity"),"10");
      assertEquals(qs.getProperties().getProperty("maxCapacity"),"35");
    }
 else     if (qs.getName().equals("p1")) {
      Set<Queue> children=qs.getChildren();
      for (      Queue child : children) {
        if (child.getName().equals("p1" + NAME_SEPARATOR + "p12")) {
          assertTrue(child.getAcls().get(toFullPropertyName(child.getName(),ACL_SUBMIT_JOB_TAG)).isUserAllowed(createUGI("u1")));
          assertTrue(child.getAcls().get(toFullPropertyName(child.getName(),ACL_ADMINISTER_JOB_TAG)).isUserAllowed(createUGI("u2")));
          assertTrue(child.getState().equals(QueueState.STOPPED));
        }
 else {
          assertTrue(child.getState().equals(QueueState.RUNNING));
        }
      }
    }
  }
  deleteQueuesConfigFile();
  doc=createDocument();
  refreshSimpleDocument(doc);
  writeToFile(doc,QUEUES_CONFIG_FILE_PATH);
  QueueConfigurationParser cp=new QueueConfigurationParser(QUEUES_CONFIG_FILE_PATH,true);
  qm.getRoot().isHierarchySameAs(cp.getRoot());
  qm.setQueues(cp.getRoot().getChildren().toArray(new Queue[cp.getRoot().getChildren().size()]));
  Queue afterRefreshRoot=qm.getRoot();
  rootQueues=afterRefreshRoot.getChildren();
  for (  Queue qs : rootQueues) {
    if (qs.getName().equals("q1")) {
      assertEquals(qs.getProperties().getProperty("capacity"),"70");
      assertEquals(qs.getProperties().getProperty("maxCapacity"),"35");
    }
 else     if (qs.getName().equals("p1")) {
      Set<Queue> children=qs.getChildren();
      for (      Queue child : children) {
        if (child.getName().equals("p1" + NAME_SEPARATOR + "p12")) {
          assertTrue(child.getAcls().get(toFullPropertyName(child.getName(),ACL_SUBMIT_JOB_TAG)).isUserAllowed(createUGI("u3")));
          assertTrue(child.getAcls().get(toFullPropertyName(child.getName(),ACL_ADMINISTER_JOB_TAG)).isUserAllowed(createUGI("u4")));
          assertTrue(child.getState().equals(QueueState.RUNNING));
        }
 else {
          assertTrue(child.getState().equals(QueueState.STOPPED));
        }
      }
    }
  }
}
