{
  Set<Path> createdFiles=createFiles();
  JobConf conf=new JobConf();
  Path inputDir=(withGlob) ? new Path(workDir,"a*") : workDir;
  FileInputFormat.setInputPaths(conf,inputDir);
  conf.setInputFormat(DummyFileInputFormat.class);
  if (withFilter) {
    FileInputFormat.setInputPathFilter(conf,TestPathFilter.class);
  }
  DummyFileInputFormat inputFormat=(DummyFileInputFormat)conf.getInputFormat();
  Set<Path> computedFiles=new HashSet<Path>();
  for (  FileStatus file : inputFormat.listStatus(conf)) {
    computedFiles.add(file.getPath());
  }
  createdFiles.remove(localFs.makeQualified(new Path(workDir,"_hello")));
  createdFiles.remove(localFs.makeQualified(new Path(workDir,".hello")));
  if (withFilter) {
    createdFiles.remove(localFs.makeQualified(new Path(workDir,"aa")));
    createdFiles.remove(localFs.makeQualified(new Path(workDir,"bb")));
  }
  if (withGlob) {
    createdFiles.remove(localFs.makeQualified(new Path(workDir,"b")));
    createdFiles.remove(localFs.makeQualified(new Path(workDir,"bb")));
  }
  assertEquals(createdFiles,computedFiles);
}
