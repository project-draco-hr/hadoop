{
  JobConf jobConf=new JobConf(conf);
  jobConf.setNumMapTasks(1);
  jobConf.setNumReduceTasks(1);
  jobConf.setMapperClass(MemoryLoaderMapper.class);
  jobConf.setReducerClass(MemoryLoaderReducer.class);
  jobConf.setInputFormat(TextInputFormat.class);
  jobConf.setOutputKeyClass(LongWritable.class);
  jobConf.setOutputValueClass(Text.class);
  jobConf.setMaxMapAttempts(1);
  jobConf.setMaxReduceAttempts(1);
  jobConf.set(JobConf.MAPRED_TASK_JAVA_OPTS,heapOptions);
  jobConf.setLong(MemoryLoaderMapper.TARGET_VALUE,targetMapValue);
  jobConf.setLong(MemoryLoaderReducer.TARGET_VALUE,targetReduceValue);
  FileInputFormat.setInputPaths(jobConf,inDir);
  Path outDir=new Path(testRootDir,"out");
  fs.delete(outDir,true);
  FileOutputFormat.setOutputPath(jobConf,outDir);
  RunningJob job=client.submitJob(jobConf);
  job.waitForCompletion();
  JobID jobID=job.getID();
  assertTrue("Job " + jobID + " failed!",job.isSuccessful());
  return job;
}
