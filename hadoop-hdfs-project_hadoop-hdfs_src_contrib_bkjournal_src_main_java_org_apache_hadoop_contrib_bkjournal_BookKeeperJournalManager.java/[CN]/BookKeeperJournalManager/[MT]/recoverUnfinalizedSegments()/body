{
  wl.acquire();
synchronized (this) {
    try {
      EditLogLedgerMetadata l=EditLogLedgerMetadata.read(zkc,inprogressZNode());
      long endTxId=recoverLastTxId(l);
      if (endTxId == HdfsConstants.INVALID_TXID) {
        LOG.error("Unrecoverable corruption has occurred in segment " + l.toString() + " at path "+ inprogressZNode()+ ". Unable to continue recovery.");
        throw new IOException("Unrecoverable corruption, please check logs.");
      }
      finalizeLogSegment(l.getFirstTxId(),endTxId);
    }
 catch (    KeeperException.NoNodeException nne) {
    }
 finally {
      if (wl.haveLock()) {
        wl.release();
      }
    }
  }
}
