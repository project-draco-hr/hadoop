{
  BufferedInputStream in=null;
  try {
    in=new BufferedInputStream(new FileInputStream(file));
    S3Object object=new S3Object(key);
    object.setDataInputStream(in);
    object.setContentType("binary/octet-stream");
    object.setContentLength(file.length());
    if (md5Hash != null) {
      object.setMd5Hash(md5Hash);
    }
    s3Service.putObject(bucket,object);
  }
 catch (  S3ServiceException e) {
    handleS3ServiceException(e);
  }
 finally {
    if (in != null) {
      try {
        in.close();
      }
 catch (      IOException e) {
      }
    }
  }
}
