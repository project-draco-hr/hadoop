{
  if (multipartEnabled && file.length() >= multipartBlockSize) {
    storeLargeFile(key,file,md5Hash);
    return;
  }
  BufferedInputStream in=null;
  try {
    in=new BufferedInputStream(new FileInputStream(file));
    S3Object object=new S3Object(key);
    object.setDataInputStream(in);
    object.setContentType("binary/octet-stream");
    object.setContentLength(file.length());
    object.setServerSideEncryptionAlgorithm(serverSideEncryptionAlgorithm);
    if (md5Hash != null) {
      object.setMd5Hash(md5Hash);
    }
    s3Service.putObject(bucket,object);
  }
 catch (  ServiceException e) {
    handleException(e,key);
  }
 finally {
    IOUtils.closeStream(in);
  }
}
