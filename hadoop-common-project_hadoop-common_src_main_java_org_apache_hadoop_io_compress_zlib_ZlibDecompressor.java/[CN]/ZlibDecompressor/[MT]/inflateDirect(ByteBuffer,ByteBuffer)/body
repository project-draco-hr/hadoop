{
  assert(this instanceof ZlibDirectDecompressor);
  ByteBuffer presliced=dst;
  if (dst.position() > 0) {
    presliced=dst;
    dst=dst.slice();
  }
  Buffer originalCompressed=compressedDirectBuf;
  Buffer originalUncompressed=uncompressedDirectBuf;
  int originalBufferSize=directBufferSize;
  compressedDirectBuf=src;
  compressedDirectBufOff=src.position();
  compressedDirectBufLen=src.remaining();
  uncompressedDirectBuf=dst;
  directBufferSize=dst.remaining();
  int n=0;
  try {
    n=inflateBytesDirect();
    presliced.position(presliced.position() + n);
    if (compressedDirectBufLen > 0) {
      src.position(compressedDirectBufOff);
    }
 else {
      src.position(src.limit());
    }
  }
  finally {
    compressedDirectBuf=originalCompressed;
    uncompressedDirectBuf=originalUncompressed;
    compressedDirectBufOff=0;
    compressedDirectBufLen=0;
    directBufferSize=originalBufferSize;
  }
  return n;
}
