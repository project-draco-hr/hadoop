{
  src=normalizePath(src);
  String[] names=INode.getPathNames(src);
  byte[][] components=INode.getPathComponents(names);
  INode[] inodes=new INode[components.length];
  writeLock();
  try {
    rootDir.getExistingPathINodes(components,inodes,false);
    StringBuilder pathbuilder=new StringBuilder();
    int i=1;
    for (; i < inodes.length && inodes[i] != null; i++) {
      pathbuilder.append(Path.SEPARATOR + names[i]);
      if (!inodes[i].isDirectory()) {
        throw new FileAlreadyExistsException("Parent path is not a directory: " + pathbuilder + " "+ inodes[i].getLocalName());
      }
    }
    for (; i < inodes.length; i++) {
      pathbuilder.append(Path.SEPARATOR + names[i]);
      String cur=pathbuilder.toString();
      unprotectedMkdir(inodes,i,components[i],permissions,inheritPermission || i != components.length - 1,now);
      if (inodes[i] == null) {
        return false;
      }
      if (getFSNamesystem() != null)       NameNode.getNameNodeMetrics().incrFilesCreated();
      fsImage.getEditLog().logMkDir(cur,inodes[i]);
      if (NameNode.stateChangeLog.isDebugEnabled()) {
        NameNode.stateChangeLog.debug("DIR* FSDirectory.mkdirs: created directory " + cur);
      }
    }
  }
  finally {
    writeUnlock();
  }
  return true;
}
