{
  TestSource source=new TestSource("test");
  MetricsSourceBuilder sb=MetricsAnnotations.newSourceBuilder(source);
  final MetricsSource s=sb.build();
  List<MetricsTag> injectedTags=new ArrayList<MetricsTag>();
  MetricsSourceAdapter sa=new MetricsSourceAdapter("test","test","test desc",s,injectedTags,null,null,1,false);
  MetricsCollectorImpl builder=new MetricsCollectorImpl();
  Iterable<MetricsRecordImpl> metricsRecords=sa.getMetrics(builder,true);
  MetricsRecordImpl metricsRecord=metricsRecords.iterator().next();
  assertEquals(0L,metricsRecord.metrics().iterator().next().value().longValue());
  Thread.sleep(100);
  assertEquals(0L,(Number)sa.getAttribute("C1"));
  source.incrementCnt();
  builder=new MetricsCollectorImpl();
  metricsRecords=sa.getMetrics(builder,true);
  metricsRecord=metricsRecords.iterator().next();
  assertTrue(metricsRecord.metrics().iterator().hasNext());
  Thread.sleep(100);
  assertEquals(1L,(Number)sa.getAttribute("C1"));
}
