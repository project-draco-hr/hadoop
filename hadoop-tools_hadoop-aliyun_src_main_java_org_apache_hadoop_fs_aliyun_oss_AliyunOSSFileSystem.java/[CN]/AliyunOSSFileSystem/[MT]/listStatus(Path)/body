{
  String key=pathToKey(path);
  if (LOG.isDebugEnabled()) {
    LOG.debug("List status for path: " + path);
  }
  final List<FileStatus> result=new ArrayList<FileStatus>();
  final FileStatus fileStatus=getFileStatus(path);
  if (fileStatus.isDirectory()) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("listStatus: doing listObjects for directory " + key);
    }
    ObjectListing objects=store.listObjects(key,maxKeys,null,false);
    while (true) {
      statistics.incrementReadOps(1);
      for (      OSSObjectSummary objectSummary : objects.getObjectSummaries()) {
        String objKey=objectSummary.getKey();
        if (objKey.equals(key + "/")) {
          if (LOG.isDebugEnabled()) {
            LOG.debug("Ignoring: " + objKey);
          }
          continue;
        }
 else {
          Path keyPath=keyToPath(objectSummary.getKey()).makeQualified(uri,workingDir);
          if (LOG.isDebugEnabled()) {
            LOG.debug("Adding: fi: " + keyPath);
          }
          result.add(new FileStatus(objectSummary.getSize(),false,1,getDefaultBlockSize(keyPath),objectSummary.getLastModified().getTime(),keyPath));
        }
      }
      for (      String prefix : objects.getCommonPrefixes()) {
        if (prefix.equals(key + "/")) {
          if (LOG.isDebugEnabled()) {
            LOG.debug("Ignoring: " + prefix);
          }
          continue;
        }
 else {
          Path keyPath=keyToPath(prefix).makeQualified(uri,workingDir);
          if (LOG.isDebugEnabled()) {
            LOG.debug("Adding: rd: " + keyPath);
          }
          result.add(new FileStatus(0,true,1,0,0,keyPath));
        }
      }
      if (objects.isTruncated()) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("listStatus: list truncated - getting next batch");
        }
        String nextMarker=objects.getNextMarker();
        objects=store.listObjects(key,maxKeys,nextMarker,false);
        statistics.incrementReadOps(1);
      }
 else {
        break;
      }
    }
  }
 else {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Adding: rd (not a dir): " + path);
    }
    result.add(fileStatus);
  }
  return result.toArray(new FileStatus[result.size()]);
}
