{
  if (saslPropsResolver == null) {
    throw new IOException(String.format("Cannot create a secured " + "connection if DataNode listens on unprivileged port (%d) and no " + "protection is defined in configuration property %s.",datanodeId.getXferPort(),DFS_DATA_TRANSFER_PROTECTION_KEY));
  }
  Map<String,String> saslProps=saslPropsResolver.getClientProperties(addr);
  String userName=buildUserName(accessToken);
  char[] password=buildClientPassword(accessToken);
  CallbackHandler callbackHandler=new SaslClientCallbackHandler(userName,password);
  return doSaslHandshake(underlyingOut,underlyingIn,userName,saslProps,callbackHandler);
}
