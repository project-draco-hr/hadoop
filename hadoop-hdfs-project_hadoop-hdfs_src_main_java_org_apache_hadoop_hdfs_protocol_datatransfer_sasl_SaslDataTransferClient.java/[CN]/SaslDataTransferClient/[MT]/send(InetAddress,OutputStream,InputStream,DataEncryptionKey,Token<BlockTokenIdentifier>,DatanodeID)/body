{
  if (encryptionKey != null) {
    LOG.debug("SASL client doing encrypted handshake for addr = {}, datanodeId = {}",addr,datanodeId);
    return getEncryptedStreams(underlyingOut,underlyingIn,encryptionKey);
  }
 else   if (!UserGroupInformation.isSecurityEnabled()) {
    LOG.debug("SASL client skipping handshake in unsecured configuration for " + "addr = {}, datanodeId = {}",addr,datanodeId);
    return null;
  }
 else   if (datanodeId.getXferPort() < 1024) {
    LOG.debug("SASL client skipping handshake in secured configuration with " + "privileged port for addr = {}, datanodeId = {}",addr,datanodeId);
    return null;
  }
 else   if (fallbackToSimpleAuth != null && fallbackToSimpleAuth.get()) {
    LOG.debug("SASL client skipping handshake in secured configuration with " + "unsecured cluster for addr = {}, datanodeId = {}",addr,datanodeId);
    return null;
  }
 else   if (saslPropsResolver != null) {
    LOG.debug("SASL client doing general handshake for addr = {}, datanodeId = {}",addr,datanodeId);
    return getSaslStreams(addr,underlyingOut,underlyingIn,accessToken,datanodeId);
  }
 else {
    LOG.debug("SASL client skipping handshake in secured configuration with no SASL " + "protection configured for addr = {}, datanodeId = {}",addr,datanodeId);
    return null;
  }
}
