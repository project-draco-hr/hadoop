{
  long lastHeartbeatTime=rmHeartbeatHandler.getLastHeartbeatTime();
  long now=context.getClock().getTime();
  while (now - lastHeartbeatTime > commitWindowMs) {
    rmHeartbeatHandler.runOnNextHeartbeat(new Runnable(){
      @Override public void run(){
synchronized (EventProcessor.this) {
          EventProcessor.this.notify();
        }
      }
    }
);
    wait();
    lastHeartbeatTime=rmHeartbeatHandler.getLastHeartbeatTime();
    now=context.getClock().getTime();
  }
}
