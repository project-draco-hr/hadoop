{
  boolean commitJobIsRepeatable=false;
  try {
    commitJobIsRepeatable=committer.isCommitJobRepeatable(event.getJobContext());
  }
 catch (  IOException e) {
    LOG.warn("Exception in committer.isCommitJobRepeatable():",e);
  }
  try {
    touchz(startCommitFile,commitJobIsRepeatable);
    jobCommitStarted();
    waitForValidCommitWindow();
    committer.commitJob(event.getJobContext());
    touchz(endCommitSuccessFile,commitJobIsRepeatable);
    context.getEventHandler().handle(new JobCommitCompletedEvent(event.getJobID()));
  }
 catch (  Exception e) {
    LOG.error("Could not commit job",e);
    try {
      touchz(endCommitFailureFile,commitJobIsRepeatable);
    }
 catch (    Exception e2) {
      LOG.error("could not create failure file.",e2);
    }
    context.getEventHandler().handle(new JobCommitFailedEvent(event.getJobID(),StringUtils.stringifyException(e)));
  }
 finally {
    jobCommitEnded();
  }
}
