{
  try {
    touchz(startCommitFile);
    jobCommitStarted();
    waitForValidCommitWindow();
    committer.commitJob(event.getJobContext());
    touchz(endCommitSuccessFile);
    context.getEventHandler().handle(new JobCommitCompletedEvent(event.getJobID()));
  }
 catch (  Exception e) {
    try {
      touchz(endCommitFailureFile);
    }
 catch (    Exception e2) {
      LOG.error("could not create failure file.",e2);
    }
    LOG.error("Could not commit job",e);
    context.getEventHandler().handle(new JobCommitFailedEvent(event.getJobID(),StringUtils.stringifyException(e)));
  }
 finally {
    jobCommitEnded();
  }
}
