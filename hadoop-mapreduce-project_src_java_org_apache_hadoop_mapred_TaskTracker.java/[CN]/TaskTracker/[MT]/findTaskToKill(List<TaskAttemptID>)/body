{
  TaskInProgress killMe=null;
  for (Iterator it=runningTasks.values().iterator(); it.hasNext(); ) {
    TaskInProgress tip=(TaskInProgress)it.next();
    if (tasksToExclude != null && tasksToExclude.contains(tip.getTask().getTaskID())) {
      continue;
    }
    if ((tip.getRunState() == TaskStatus.State.RUNNING || tip.getRunState() == TaskStatus.State.COMMIT_PENDING) && !tip.wasKilled) {
      if (killMe == null) {
        killMe=tip;
      }
 else       if (!tip.getTask().isMapTask()) {
        if (killMe.getTask().isMapTask() || (tip.getTask().getProgress().get() < killMe.getTask().getProgress().get())) {
          killMe=tip;
        }
      }
 else       if (killMe.getTask().isMapTask() && tip.getTask().getProgress().get() < killMe.getTask().getProgress().get()) {
        killMe=tip;
      }
    }
  }
  return killMe;
}
