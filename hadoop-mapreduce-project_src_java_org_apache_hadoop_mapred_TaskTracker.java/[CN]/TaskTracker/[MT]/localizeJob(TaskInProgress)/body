{
  Task t=tip.getTask();
  JobID jobId=t.getJobID();
  RunningJob rjob=addTaskToJob(jobId,tip);
  getLocalizer().initializeUserDirs(t.getUser());
synchronized (rjob) {
    if (!rjob.localized) {
      JobConf localJobConf=localizeJobFiles(t,rjob);
      initializeJobLogDir(jobId,localJobConf);
      JobInitializationContext context=new JobInitializationContext();
      context.jobid=jobId;
      context.user=t.getUser();
      context.workDir=new File(localJobConf.get(JOB_LOCAL_DIR));
      taskController.initializeJob(context);
      rjob.jobConf=localJobConf;
      rjob.keepJobFiles=((localJobConf.getKeepTaskFilesPattern() != null) || localJobConf.getKeepFailedTaskFiles());
      rjob.localized=true;
    }
  }
  return rjob;
}
