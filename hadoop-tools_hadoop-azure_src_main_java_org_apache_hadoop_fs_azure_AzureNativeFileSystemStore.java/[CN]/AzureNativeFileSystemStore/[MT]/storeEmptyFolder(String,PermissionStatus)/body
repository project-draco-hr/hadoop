{
  if (null == storageInteractionLayer) {
    final String errMsg=String.format("Storage session expected for URI '%s' but does not exist.",sessionUri);
    throw new AssertionError(errMsg);
  }
  if (!isAuthenticatedAccess()) {
    throw new AzureException("Uploads to to public accounts using anonymous access is prohibited.");
  }
  try {
    checkContainer(ContainerAccessType.PureWrite);
    CloudBlobWrapper blob=getBlobReference(key);
    storePermissionStatus(blob,permissionStatus);
    storeFolderAttribute(blob);
    openOutputStream(blob).close();
  }
 catch (  StorageException e) {
    throw new AzureException(e);
  }
catch (  URISyntaxException e) {
    throw new AzureException(e);
  }
catch (  IOException e) {
    Throwable t=e.getCause();
    if (t != null && t instanceof StorageException) {
      StorageException se=(StorageException)t;
      if (!se.getErrorCode().equals("LeaseIdMissing")) {
        throw new AzureException(e);
      }
    }
 else {
      throw new AzureException(e);
    }
  }
}
