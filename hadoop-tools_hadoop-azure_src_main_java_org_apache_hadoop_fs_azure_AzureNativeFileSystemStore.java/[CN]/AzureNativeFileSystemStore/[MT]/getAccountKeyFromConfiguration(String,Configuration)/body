{
  String key=null;
  String keyProviderClass=conf.get(KEY_ACCOUNT_KEYPROVIDER_PREFIX + accountName);
  KeyProvider keyProvider=null;
  if (keyProviderClass == null) {
    keyProvider=new SimpleKeyProvider();
  }
 else {
    Object keyProviderObject=null;
    try {
      Class<?> clazz=conf.getClassByName(keyProviderClass);
      keyProviderObject=clazz.newInstance();
    }
 catch (    Exception e) {
      throw new KeyProviderException("Unable to load key provider class.",e);
    }
    if (!(keyProviderObject instanceof KeyProvider)) {
      throw new KeyProviderException(keyProviderClass + " specified in config is not a valid KeyProvider class.");
    }
    keyProvider=(KeyProvider)keyProviderObject;
  }
  key=keyProvider.getStorageAccountKey(accountName,conf);
  return key;
}
