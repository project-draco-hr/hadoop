{
  if (null == storageInteractionLayer) {
    final String errMsg=String.format("Storage session expected for URI '%s' but does not exist.",sessionUri);
    throw new AssertionError(errMsg);
  }
  LOG.debug("Retrieving metadata for {}",key);
  try {
    if (checkContainer(ContainerAccessType.PureRead) == ContainerState.DoesntExist) {
      return null;
    }
    if (key.equals("/")) {
      return new FileMetadata(key,0,defaultPermissionNoBlobMetadata(),BlobMaterialization.Implicit);
    }
    CloudBlobWrapper blob=getBlobReference(key);
    if (null != blob && blob.exists(getInstrumentedContext())) {
      LOG.debug("Found {} as an explicit blob. Checking if it's a file or folder.",key);
      blob.downloadAttributes(getInstrumentedContext());
      BlobProperties properties=blob.getProperties();
      if (retrieveFolderAttribute(blob)) {
        LOG.debug("{} is a folder blob.",key);
        return new FileMetadata(key,properties.getLastModified().getTime(),getPermissionStatus(blob),BlobMaterialization.Explicit);
      }
 else {
        LOG.debug("{} is a normal blob.",key);
        return new FileMetadata(key,getDataLength(blob,properties),properties.getLastModified().getTime(),getPermissionStatus(blob));
      }
    }
    Iterable<ListBlobItem> objects=listRootBlobs(key,true,EnumSet.of(BlobListingDetails.METADATA),null,getInstrumentedContext());
    for (    ListBlobItem blobItem : objects) {
      if (blobItem instanceof CloudBlockBlobWrapper || blobItem instanceof CloudPageBlobWrapper) {
        LOG.debug("Found blob as a directory-using this file under it to infer its properties {}",blobItem.getUri());
        blob=(CloudBlobWrapper)blobItem;
        BlobProperties properties=blob.getProperties();
        return new FileMetadata(key,properties.getLastModified().getTime(),getPermissionStatus(blob),BlobMaterialization.Implicit);
      }
    }
    return null;
  }
 catch (  Exception e) {
    throw new AzureException(e);
  }
}
