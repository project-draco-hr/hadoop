{
  LOG.debug("Processing fileDiffEntry");
  DiffEntry.Builder headerBld=DiffEntry.newBuilder();
  headerBld.setType(DiffEntry.Type.FILEDIFF);
  Node fileDiffHeader=new Node();
  loadNodeChildren(fileDiffHeader,"fileDiffEntry fields","fileDiff");
  Long inodeId=fileDiffHeader.removeChildLong(SNAPSHOT_DIFF_SECTION_INODE_ID);
  if (inodeId == null) {
    throw new IOException("<fileDiffEntry> contained no <inodeid> entry.");
  }
  headerBld.setInodeId(inodeId);
  Integer expectedDiffs=fileDiffHeader.removeChildInt(SNAPSHOT_DIFF_SECTION_COUNT);
  if (expectedDiffs == null) {
    throw new IOException("<fileDiffEntry> contained no <count> entry.");
  }
  headerBld.setNumOfDiff(expectedDiffs);
  fileDiffHeader.verifyNoRemainingKeys("fileDiffEntry");
  headerBld.build().writeDelimitedTo(out);
  for (int actualDiffs=0; actualDiffs < expectedDiffs; actualDiffs++) {
    try {
      expectTag(SNAPSHOT_DIFF_SECTION_FILE_DIFF,false);
    }
 catch (    IOException e) {
      throw new IOException("Only read " + (actualDiffs + 1) + " diffs out of "+ expectedDiffs,e);
    }
    Node fileDiff=new Node();
    loadNodeChildren(fileDiff,"fileDiff fields");
    FsImageProto.SnapshotDiffSection.FileDiff.Builder bld=FsImageProto.SnapshotDiffSection.FileDiff.newBuilder();
    Integer snapshotId=fileDiff.removeChildInt(SNAPSHOT_DIFF_SECTION_SNAPSHOT_ID);
    if (snapshotId != null) {
      bld.setSnapshotId(snapshotId);
    }
    Long size=fileDiff.removeChildLong(SNAPSHOT_DIFF_SECTION_SIZE);
    if (size != null) {
      bld.setFileSize(size);
    }
    String name=fileDiff.removeChildStr(SECTION_NAME);
    if (name != null) {
      bld.setName(ByteString.copyFrom(name,"UTF8"));
    }
    fileDiff.verifyNoRemainingKeys("fileDiff");
    bld.build().writeDelimitedTo(out);
  }
  expectTagEnd(SNAPSHOT_DIFF_SECTION_FILE_DIFF_ENTRY);
}
