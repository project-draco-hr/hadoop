{
  String bpid=nn.getNamesystem().getBlockPoolId();
  BPOfferService bpos=null;
  for (  BPOfferService thisBpos : dn.getAllBpOs()) {
    if (thisBpos.getBlockPoolId().equals(bpid)) {
      bpos=thisBpos;
      break;
    }
  }
  Preconditions.checkArgument(bpos != null,"No such bpid: %s",bpid);
  DatanodeProtocolClientSideTranslatorPB origNN=bpos.getBpNamenode();
  DatanodeProtocolClientSideTranslatorPB spy=Mockito.spy(origNN);
  bpos.setBpNamenode(spy);
  return spy;
}
