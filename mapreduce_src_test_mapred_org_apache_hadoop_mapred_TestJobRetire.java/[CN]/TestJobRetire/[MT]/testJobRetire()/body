{
  MiniMRCluster mr=null;
  try {
    JobConf conf=new JobConf();
    mr=startCluster(conf,1);
    JobConf jobConf=mr.createJobConf();
    JobTracker jobtracker=mr.getJobTrackerRunner().getJobTracker();
    Path inDir=new Path(testDir,"input1");
    Path outDir=new Path(testDir,"output1");
    JobID id1=validateJobRetire(jobConf,inDir,outDir,jobtracker);
    outDir=new Path(testDir,"output2");
    JobID id2=validateJobRetire(jobConf,inDir,outDir,jobtracker);
    assertNull("Job not removed from cache",jobtracker.getJobStatus(id1));
    assertEquals("Total job in cache not correct",1,jobtracker.getAllJobs().length);
  }
  finally {
    if (mr != null) {
      mr.shutdown();
    }
    FileUtil.fullyDelete(new File(testDir.toString()));
  }
}
