{
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  setup(csConf);
  final String user_0="user_0";
  final ApplicationAttemptId appAttemptId_0=TestUtils.getMockApplicationAttemptId(0,0);
  LeafQueue a=stubLeafQueue((LeafQueue)queues.get(A));
  FiCaSchedulerApp app_0=new FiCaSchedulerApp(appAttemptId_0,user_0,a,mock(ActiveUsersManager.class),spyRMContext);
  String host_0="host_0";
  FiCaSchedulerNode node_0=TestUtils.getMockNode(host_0,DEFAULT_RACK,0,8 * GB);
  String host_1="host_1";
  FiCaSchedulerNode node_1=TestUtils.getMockNode(host_1,DEFAULT_RACK,0,8 * GB);
  Resource clusterResource=Resources.createResource(2 * 8 * GB);
  Priority priorityMap=TestUtils.createMockPriority(5);
  Resource capability=Resources.createResource(2 * GB,0);
  RMApplicationHistoryWriter writer=mock(RMApplicationHistoryWriter.class);
  SystemMetricsPublisher publisher=mock(SystemMetricsPublisher.class);
  RMContext rmContext=mock(RMContext.class);
  ContainerAllocationExpirer expirer=mock(ContainerAllocationExpirer.class);
  DrainDispatcher drainDispatcher=new DrainDispatcher();
  when(rmContext.getContainerAllocationExpirer()).thenReturn(expirer);
  when(rmContext.getDispatcher()).thenReturn(drainDispatcher);
  when(rmContext.getRMApplicationHistoryWriter()).thenReturn(writer);
  when(rmContext.getSystemMetricsPublisher()).thenReturn(publisher);
  when(rmContext.getYarnConfiguration()).thenReturn(new YarnConfiguration());
  ApplicationAttemptId appAttemptId=BuilderUtils.newApplicationAttemptId(app_0.getApplicationId(),1);
  ContainerId containerId=BuilderUtils.newContainerId(appAttemptId,1);
  Container container=TestUtils.getMockContainer(containerId,node_1.getNodeID(),Resources.createResource(2 * GB),priorityMap);
  RMContainer rmContainer=new RMContainerImpl(container,appAttemptId,node_1.getNodeID(),"user",rmContext);
  Container container_1=TestUtils.getMockContainer(containerId,node_0.getNodeID(),Resources.createResource(1 * GB),priorityMap);
  RMContainer rmContainer_1=new RMContainerImpl(container_1,appAttemptId,node_0.getNodeID(),"user",rmContext);
  NodeId unreserveId=app_0.getNodeIdToUnreserve(priorityMap,capability,cs.getResourceCalculator(),clusterResource);
  assertEquals(null,unreserveId);
  app_0.reserve(node_0,priorityMap,rmContainer_1,container_1);
  app_0.unreserve(priorityMap,node_0,rmContainer_1);
  unreserveId=app_0.getNodeIdToUnreserve(priorityMap,capability,cs.getResourceCalculator(),clusterResource);
  assertEquals(null,unreserveId);
  app_0.reserve(node_0,priorityMap,rmContainer_1,container_1);
  unreserveId=app_0.getNodeIdToUnreserve(priorityMap,capability,cs.getResourceCalculator(),clusterResource);
  assertEquals(null,unreserveId);
  app_0.reserve(node_1,priorityMap,rmContainer,container);
  unreserveId=app_0.getNodeIdToUnreserve(priorityMap,capability,cs.getResourceCalculator(),clusterResource);
  assertEquals(node_1.getNodeID(),unreserveId);
}
