{
  if (isValidBlock(b)) {
    throw new ReplicaAlreadyExistsException("Block " + b + " is valid, and cannot be written to.");
  }
  if (isValidRbw(b)) {
    throw new ReplicaAlreadyExistsException("Block " + b + " is being written, and cannot be written to.");
  }
  final Map<Block,BInfo> map=getMap(b.getBlockPoolId());
  BInfo binfo=new BInfo(b.getBlockPoolId(),b.getLocalBlock(),true);
  map.put(binfo.theBlock,binfo);
  return new ReplicaHandler(binfo,null);
}
