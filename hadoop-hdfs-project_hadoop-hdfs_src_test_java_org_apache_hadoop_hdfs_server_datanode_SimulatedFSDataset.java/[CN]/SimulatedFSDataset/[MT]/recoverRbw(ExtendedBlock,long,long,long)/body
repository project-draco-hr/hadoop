{
  final Map<Block,BInfo> map=getMap(b.getBlockPoolId());
  BInfo binfo=map.get(b.getLocalBlock());
  if (binfo == null) {
    throw new ReplicaNotFoundException("Block " + b + " does not exist, and cannot be appended to.");
  }
  if (binfo.isFinalized()) {
    throw new ReplicaAlreadyExistsException("Block " + b + " is valid, and cannot be written to.");
  }
  map.remove(b);
  binfo.theBlock.setGenerationStamp(newGS);
  map.put(binfo.theBlock,binfo);
  return new ReplicaHandler(binfo,null);
}
