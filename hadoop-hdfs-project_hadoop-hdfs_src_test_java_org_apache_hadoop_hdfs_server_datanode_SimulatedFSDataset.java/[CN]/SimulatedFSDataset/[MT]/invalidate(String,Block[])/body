{
  boolean error=false;
  if (invalidBlks == null) {
    return;
  }
  final Map<Block,BInfo> map=getMap(bpid);
  for (  Block b : invalidBlks) {
    if (b == null) {
      continue;
    }
    BInfo binfo=map.get(b);
    if (binfo == null) {
      error=true;
      DataNode.LOG.warn("Invalidate: Missing block");
      continue;
    }
    storage.free(bpid,binfo.getNumBytes());
    blockMap.remove(b);
  }
  if (error) {
    throw new IOException("Invalidate: Missing blocks.");
  }
}
