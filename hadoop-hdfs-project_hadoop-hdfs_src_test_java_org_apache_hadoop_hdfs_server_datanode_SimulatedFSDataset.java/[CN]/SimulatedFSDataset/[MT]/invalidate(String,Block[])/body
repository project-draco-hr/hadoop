{
  boolean error=false;
  if (invalidBlks == null) {
    return;
  }
  final Map<Block,BInfo> map=getMap(bpid);
  for (  Block b : invalidBlks) {
    if (b == null) {
      continue;
    }
    BInfo binfo=map.get(b);
    if (binfo == null) {
      error=true;
      DataNode.LOG.warn("Invalidate: Missing block");
      continue;
    }
    storage.free(bpid,binfo.getNumBytes());
    map.remove(b);
    if (datanode != null) {
      datanode.notifyNamenodeDeletedBlock(new ExtendedBlock(bpid,b),binfo.getStorageUuid());
    }
  }
  if (error) {
    throw new IOException("Invalidate: Missing blocks.");
  }
}
