{
  CopyListingFileStatus copyListingFileStatus=new CopyListingFileStatus(fileStatus);
  if (preserveAcls) {
    FsPermission perm=fileStatus.getPermission();
    if (perm.getAclBit()) {
      List<AclEntry> aclEntries=fileSystem.getAclStatus(fileStatus.getPath()).getEntries();
      copyListingFileStatus.setAclEntries(aclEntries);
    }
  }
  if (preserveXAttrs || preserveRawXAttrs) {
    Map<String,byte[]> srcXAttrs=fileSystem.getXAttrs(fileStatus.getPath());
    if (preserveXAttrs && preserveRawXAttrs) {
      copyListingFileStatus.setXAttrs(srcXAttrs);
    }
 else {
      Map<String,byte[]> trgXAttrs=Maps.newHashMap();
      final String rawNS=XAttr.NameSpace.RAW.name().toLowerCase();
      for (      Map.Entry<String,byte[]> ent : srcXAttrs.entrySet()) {
        final String xattrName=ent.getKey();
        if (xattrName.startsWith(rawNS)) {
          if (preserveRawXAttrs) {
            trgXAttrs.put(xattrName,ent.getValue());
          }
        }
 else         if (preserveXAttrs) {
          trgXAttrs.put(xattrName,ent.getValue());
        }
      }
      copyListingFileStatus.setXAttrs(trgXAttrs);
    }
  }
  return copyListingFileStatus;
}
