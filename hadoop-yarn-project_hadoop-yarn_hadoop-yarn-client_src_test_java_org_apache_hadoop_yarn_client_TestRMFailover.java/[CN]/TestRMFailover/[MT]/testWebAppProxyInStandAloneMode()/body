{
  conf.setBoolean(YarnConfiguration.AUTO_FAILOVER_ENABLED,false);
  WebAppProxyServer webAppProxyServer=new WebAppProxyServer();
  try {
    conf.set(YarnConfiguration.PROXY_ADDRESS,"0.0.0.0:9099");
    cluster.init(conf);
    cluster.start();
    getAdminService(0).transitionToActive(req);
    assertFalse("RM never turned active",-1 == cluster.getActiveRMIndex());
    verifyConnections();
    webAppProxyServer.init(conf);
    Assert.assertEquals(STATE.INITED,webAppProxyServer.getServiceState());
    webAppProxyServer.start();
    Assert.assertEquals(STATE.STARTED,webAppProxyServer.getServiceState());
    URL wrongUrl=new URL("http://0.0.0.0:9099/proxy/" + fakeAppId);
    HttpURLConnection proxyConn=(HttpURLConnection)wrongUrl.openConnection();
    proxyConn.connect();
    verifyResponse(proxyConn);
    explicitFailover();
    verifyConnections();
    proxyConn.connect();
    verifyResponse(proxyConn);
  }
  finally {
    webAppProxyServer.stop();
  }
}
