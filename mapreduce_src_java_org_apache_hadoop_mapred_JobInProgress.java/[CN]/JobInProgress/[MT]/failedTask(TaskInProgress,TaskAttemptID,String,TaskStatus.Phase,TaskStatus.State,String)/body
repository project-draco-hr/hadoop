{
  TaskStatus status=TaskStatus.createTaskStatus(tip.isMapTask(),taskid,0.0f,tip.isMapTask() ? numSlotsPerMap : numSlotsPerReduce,state,reason,reason,trackerName,phase,new Counters());
  TaskStatus oldStatus=tip.getTaskStatus(taskid);
  long startTime=oldStatus == null ? JobTracker.getClock().getTime() : oldStatus.getStartTime();
  status.setStartTime(startTime);
  status.setFinishTime(JobTracker.getClock().getTime());
  boolean wasComplete=tip.isComplete();
  updateTaskStatus(tip,status);
  boolean isComplete=tip.isComplete();
  if (wasComplete && !isComplete) {
    TaskType taskType=getTaskType(tip);
    TaskFailedEvent tfe=new TaskFailedEvent(tip.getTIPId(),tip.getExecFinishTime(),taskType,reason,TaskStatus.State.FAILED.toString(),taskid);
    jobHistory.logEvent(tfe,tip.getJob().getJobID());
  }
}
