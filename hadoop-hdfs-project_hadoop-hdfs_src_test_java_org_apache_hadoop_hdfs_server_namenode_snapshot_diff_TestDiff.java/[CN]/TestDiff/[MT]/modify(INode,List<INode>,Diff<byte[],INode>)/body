{
  final int i=Diff.search(current,inode.getKey());
  Assert.assertTrue(i >= 0);
  final INodeDirectory oldinode=(INodeDirectory)current.get(i);
  final INodeDirectory newinode=new INodeDirectory(oldinode,false);
  newinode.updateModificationTime(oldinode.getModificationTime() + 1,null);
  current.set(i,newinode);
  if (diff != null) {
    final boolean testUndo=RANDOM.nextInt(UNDO_TEST_P) == 0;
    String before=null;
    if (testUndo) {
      before=diff.toString();
    }
    final UndoInfo<INode> undoInfo=diff.modify(oldinode,newinode);
    if (testUndo) {
      final String after=diff.toString();
      diff.undoModify(oldinode,newinode,undoInfo);
      assertDiff(before,diff);
      diff.modify(oldinode,newinode);
      assertDiff(after,diff);
    }
  }
}
