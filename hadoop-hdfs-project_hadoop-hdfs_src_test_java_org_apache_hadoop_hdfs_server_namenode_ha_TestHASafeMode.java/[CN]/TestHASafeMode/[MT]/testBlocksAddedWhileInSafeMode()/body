{
  banner("Starting with NN0 active and NN1 standby, creating some blocks");
  DFSTestUtil.createFile(fs,new Path("/test"),3 * BLOCK_SIZE,(short)3,1L);
  nn0.getRpcServer().rollEditLog();
  banner("Restarting standby");
  restartStandby();
  String status=nn1.getNamesystem().getSafemode();
  assertTrue("Bad safemode status: '" + status + "'",status.startsWith("Safe mode is ON." + "The reported blocks 3 has reached the threshold 0.9990 of " + "total blocks 3. Safe mode will be turned off automatically"));
  banner("Creating some blocks while SBN is in safe mode");
  DFSTestUtil.createFile(fs,new Path("/test2"),5 * BLOCK_SIZE,(short)3,1L);
  banner("Waiting for standby to catch up to active namespace");
  HATestUtil.waitForStandbyToCatchUp(nn0,nn1);
  status=nn1.getNamesystem().getSafemode();
  assertTrue("Bad safemode status: '" + status + "'",status.startsWith("Safe mode is ON." + "The reported blocks 8 has reached the threshold 0.9990 of " + "total blocks 8. Safe mode will be turned off automatically"));
}
