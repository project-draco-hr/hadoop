{
  out.writeInt(children.size());
  int dirNum=0;
  int i=0;
  for (  INode child : children) {
    FSImageSerialization.saveINode2Image(child,out,false);
    if (child.isDirectory()) {
      dirNum++;
    }
    if (i++ % 50 == 0) {
      context.checkCancelled();
    }
  }
  return dirNum;
}
