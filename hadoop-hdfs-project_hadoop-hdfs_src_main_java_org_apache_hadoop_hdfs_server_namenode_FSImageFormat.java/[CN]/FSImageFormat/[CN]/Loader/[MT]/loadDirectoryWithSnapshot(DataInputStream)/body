{
  String parentPath=FSImageSerialization.readString(in);
  final INodeDirectory parent=INodeDirectory.valueOf(namesystem.dir.rootDir.getNode(parentPath,false),parentPath);
  loadChildren(parent,in);
  int numSnapshots=in.readInt();
  INodeDirectorySnapshottable snapshottableParent=null;
  if (numSnapshots >= 0) {
    snapshottableParent=(INodeDirectorySnapshottable)parent;
    SnapshotFSImageFormat.loadSnapshotList(snapshottableParent,numSnapshots,in,this);
  }
  int numSnapshotDiffs=in.readInt();
  if (numSnapshotDiffs >= 0) {
    INodeDirectoryWithSnapshot parentWithSnapshot=(INodeDirectoryWithSnapshot)parent;
    SnapshotFSImageFormat.loadSnapshotDiffList(parentWithSnapshot,numSnapshotDiffs,in,this);
  }
  int numSubTree=in.readInt();
  for (int i=0; i < numSubTree; i++) {
    loadDirectoryWithSnapshot(in);
  }
}
