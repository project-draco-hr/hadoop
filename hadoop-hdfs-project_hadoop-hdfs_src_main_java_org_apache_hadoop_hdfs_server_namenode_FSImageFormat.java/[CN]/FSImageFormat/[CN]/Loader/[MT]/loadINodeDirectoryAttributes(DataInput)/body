{
  final int layoutVersion=getLayoutVersion();
  if (!LayoutVersion.supports(Feature.OPTIMIZE_SNAPSHOT_INODES,layoutVersion)) {
    return loadINodeWithLocalName(true,in,false).asDirectory();
  }
  final byte[] name=FSImageSerialization.readLocalName(in);
  final PermissionStatus permissions=PermissionStatus.read(in);
  final long modificationTime=in.readLong();
  final long nsQuota=in.readLong();
  final long dsQuota=in.readLong();
  AclFeature aclFeature=permissions.getPermission().getAclBit() ? loadAclFeature(in,layoutVersion) : null;
  return nsQuota == -1L && dsQuota == -1L ? new INodeDirectoryAttributes.SnapshotCopy(name,permissions,aclFeature,modificationTime) : new INodeDirectoryAttributes.CopyWithQuota(name,permissions,aclFeature,modificationTime,nsQuota,dsQuota);
}
