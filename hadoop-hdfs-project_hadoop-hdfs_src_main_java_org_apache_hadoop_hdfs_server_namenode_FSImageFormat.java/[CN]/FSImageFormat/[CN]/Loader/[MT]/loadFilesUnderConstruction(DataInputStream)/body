{
  FSDirectory fsDir=namesystem.dir;
  int size=in.readInt();
  LOG.info("Number of files under construction = " + size);
  for (int i=0; i < size; i++) {
    INodeFileUnderConstruction cons=FSImageSerialization.readINodeUnderConstruction(in);
    String path=cons.getLocalName();
    INode old=fsDir.getFileINode(path);
    if (old == null) {
      throw new IOException("Found lease for non-existent file " + path);
    }
    if (old.isDirectory()) {
      throw new IOException("Found lease for directory " + path);
    }
    INodeFile oldnode=(INodeFile)old;
    fsDir.replaceNode(path,oldnode,cons);
    namesystem.leaseManager.addLease(cons.getClientName(),path);
  }
}
