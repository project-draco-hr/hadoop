{
  byte[][] pathComponents;
  byte[][] parentPath={{}};
  FSDirectory fsDir=namesystem.dir;
  INodeDirectory parentINode=fsDir.rootDir;
  for (long i=0; i < numFiles; i++) {
    pathComponents=FSImageSerialization.readPathComponents(in);
    final INodeWithAdditionalFields newNode=loadINode(pathComponents[pathComponents.length - 1],false,in);
    if (isRoot(pathComponents)) {
      updateRootAttr(newNode);
      continue;
    }
    if (!isParent(pathComponents,parentPath)) {
      parentINode=getParentINodeDirectory(pathComponents);
      parentPath=getParent(pathComponents);
    }
    addToParent(parentINode,newNode);
  }
}
