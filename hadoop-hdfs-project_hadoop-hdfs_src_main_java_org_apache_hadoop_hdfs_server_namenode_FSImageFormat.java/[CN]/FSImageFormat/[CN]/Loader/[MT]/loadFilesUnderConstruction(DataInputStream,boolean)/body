{
  FSDirectory fsDir=namesystem.dir;
  int size=in.readInt();
  LOG.info("Number of files under construction = " + size);
  for (int i=0; i < size; i++) {
    INodeFileUnderConstruction cons=FSImageSerialization.readINodeUnderConstruction(in,supportSnapshot);
    String path=cons.getLocalName();
    final INodesInPath iip=fsDir.getLastINodeInPath(path);
    INodeFile oldnode=INodeFile.valueOf(iip.getINode(0),path);
    cons.setLocalName(oldnode.getLocalNameBytes());
    if (oldnode instanceof FileWithSnapshot && cons instanceof FileWithSnapshot) {
      ((FileWithSnapshot)oldnode).insertBefore((FileWithSnapshot)cons);
    }
    fsDir.unprotectedReplaceINodeFile(path,oldnode,cons,iip.getLatestSnapshot());
    namesystem.leaseManager.addLease(cons.getClientName(),path);
  }
}
