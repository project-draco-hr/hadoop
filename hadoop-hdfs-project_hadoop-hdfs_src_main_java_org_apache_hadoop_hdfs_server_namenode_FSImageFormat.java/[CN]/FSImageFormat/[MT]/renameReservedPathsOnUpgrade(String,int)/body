{
  final String oldPath=path;
  if (!LayoutVersion.supports(Feature.ADD_INODE_ID,layoutVersion)) {
    String[] components=INode.getPathNames(path);
    if (components.length > 1) {
      components[1]=DFSUtil.bytes2String(renameReservedRootComponentOnUpgrade(DFSUtil.string2Bytes(components[1]),layoutVersion));
      path=DFSUtil.strings2PathString(components);
    }
  }
  if (!LayoutVersion.supports(Feature.SNAPSHOT,layoutVersion)) {
    String[] components=INode.getPathNames(path);
    if (components.length == 0) {
      return path;
    }
    for (int i=0; i < components.length; i++) {
      components[i]=DFSUtil.bytes2String(renameReservedComponentOnUpgrade(DFSUtil.string2Bytes(components[i]),layoutVersion));
    }
    path=DFSUtil.strings2PathString(components);
  }
  if (!path.equals(oldPath)) {
    LOG.info("Upgrade process renamed reserved path " + oldPath + " to "+ path);
  }
  return path;
}
