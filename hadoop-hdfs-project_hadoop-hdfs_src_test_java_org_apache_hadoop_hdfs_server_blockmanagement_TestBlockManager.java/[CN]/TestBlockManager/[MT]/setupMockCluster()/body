{
  conf=new HdfsConfiguration();
  conf.set(DFSConfigKeys.NET_TOPOLOGY_SCRIPT_FILE_NAME_KEY,"need to set a dummy value here so it assumes a multi-rack cluster");
  fsn=Mockito.mock(FSNamesystem.class);
  Mockito.doReturn(true).when(fsn).hasWriteLock();
  bm=new BlockManager(fsn,fsn,conf);
  nodes=ImmutableList.of(BlockManagerTestUtil.getDatanodeDescriptor("1.1.1.1","/rackA",true),BlockManagerTestUtil.getDatanodeDescriptor("2.2.2.2","/rackA",true),BlockManagerTestUtil.getDatanodeDescriptor("3.3.3.3","/rackA",true),BlockManagerTestUtil.getDatanodeDescriptor("4.4.4.4","/rackB",true),BlockManagerTestUtil.getDatanodeDescriptor("5.5.5.5","/rackB",true),BlockManagerTestUtil.getDatanodeDescriptor("6.6.6.6","/rackB",true));
  rackA=nodes.subList(0,3);
  rackB=nodes.subList(3,6);
}
