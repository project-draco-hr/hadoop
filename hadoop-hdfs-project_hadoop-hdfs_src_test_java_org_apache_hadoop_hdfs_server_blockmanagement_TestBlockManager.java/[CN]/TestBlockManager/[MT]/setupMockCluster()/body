{
  Configuration conf=new HdfsConfiguration();
  conf.set(DFSConfigKeys.NET_TOPOLOGY_SCRIPT_FILE_NAME_KEY,"need to set a dummy value here so it assumes a multi-rack cluster");
  fsn=Mockito.mock(FSNamesystem.class);
  Mockito.doReturn(true).when(fsn).hasWriteLock();
  bm=new BlockManager(fsn,conf);
  final String[] racks={"/rackA","/rackA","/rackA","/rackB","/rackB","/rackB"};
  storages=DFSTestUtil.createDatanodeStorageInfos(racks);
  nodes=Arrays.asList(DFSTestUtil.toDatanodeDescriptor(storages));
  rackA=nodes.subList(0,3);
  rackB=nodes.subList(3,6);
}
