{
  assertEquals("Block not initially pending replication",0,bm.pendingReplications.getNumReplicas(block));
  assertTrue("computeReplicationWork should indicate replication is needed",bm.computeReplicationWorkForBlock(block,1));
  assertTrue("replication is pending after work is computed",bm.pendingReplications.getNumReplicas(block) > 0);
  LinkedListMultimap<DatanodeDescriptor,BlockTargetPair> repls=getAllPendingReplications();
  assertEquals(1,repls.size());
  Entry<DatanodeDescriptor,BlockTargetPair> repl=repls.entries().iterator().next();
  DatanodeDescriptor[] targets=repl.getValue().targets;
  DatanodeDescriptor[] pipeline=new DatanodeDescriptor[1 + targets.length];
  pipeline[0]=repl.getKey();
  System.arraycopy(targets,0,pipeline,1,targets.length);
  return pipeline;
}
