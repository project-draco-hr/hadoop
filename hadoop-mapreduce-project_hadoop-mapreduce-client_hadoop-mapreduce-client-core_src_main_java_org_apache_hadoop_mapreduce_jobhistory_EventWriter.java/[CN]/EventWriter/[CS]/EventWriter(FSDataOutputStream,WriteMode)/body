{
  this.out=out;
  this.writeMode=mode;
  if (this.writeMode == WriteMode.JSON) {
    this.jsonOutput=true;
    out.writeBytes(VERSION);
  }
 else   if (this.writeMode == WriteMode.BINARY) {
    this.jsonOutput=false;
    out.writeBytes(VERSION_BINARY);
  }
 else {
    throw new IOException("Unknown mode: " + mode);
  }
  out.writeBytes("\n");
  out.writeBytes(Event.SCHEMA$.toString());
  out.writeBytes("\n");
  if (!this.jsonOutput) {
    this.encoder=EncoderFactory.get().binaryEncoder(out,null);
  }
 else {
    this.encoder=EncoderFactory.get().jsonEncoder(Event.SCHEMA$,out);
  }
}
