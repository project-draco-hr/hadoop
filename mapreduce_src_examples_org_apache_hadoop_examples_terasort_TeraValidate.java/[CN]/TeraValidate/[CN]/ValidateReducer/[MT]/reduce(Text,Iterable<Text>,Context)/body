{
  if (ERROR.equals(key)) {
    for (    Text val : values) {
      context.write(key,val);
    }
  }
 else   if (CHECKSUM.equals(key)) {
    Unsigned16 tmp=new Unsigned16();
    Unsigned16 sum=new Unsigned16();
    for (    Text val : values) {
      tmp.set(val.toString());
      sum.add(tmp);
    }
    context.write(CHECKSUM,new Text(sum.toString()));
  }
 else {
    Text value=values.iterator().next();
    if (firstKey) {
      firstKey=false;
    }
 else {
      if (value.compareTo(lastValue) < 0) {
        context.write(ERROR,new Text("bad key partitioning:\n  file " + lastKey + " key "+ textifyBytes(lastValue)+ "\n  file "+ key+ " key "+ textifyBytes(value)));
      }
    }
    lastKey.set(key);
    lastValue.set(value);
  }
}
