{
  LOG.info("doTestPurge started---------------------------:" + " iter " + iter + " blockSize="+ blockSize+ " stripeLength="+ stripeLength);
  mySetup(targetReplication,metaReplication,stripeLength);
  Path dir=new Path("/user/dhruba/raidtest/");
  Path file1=new Path(dir + "/file" + iter);
  RaidNode cnode=null;
  try {
    Path destPath=new Path("/destraid/user/dhruba/raidtest");
    fileSys.delete(dir,true);
    fileSys.delete(destPath,true);
    TestRaidNode.createOldFile(fileSys,file1,1,numBlock,blockSize);
    LOG.info("doTestPurge created test files for iteration " + iter);
    Configuration localConf=new Configuration(conf);
    localConf.set(RaidNode.RAID_LOCATION_KEY,"/destraid");
    cnode=RaidNode.createRaidNode(null,localConf);
    FileStatus[] listPaths=null;
    while (true) {
      try {
        listPaths=fileSys.listStatus(destPath);
        int count=0;
        if (listPaths != null && listPaths.length == 1) {
          for (          FileStatus s : listPaths) {
            LOG.info("doTestPurge found path " + s.getPath());
            if (!s.getPath().toString().endsWith(".tmp")) {
              count++;
            }
          }
        }
        if (count > 0) {
          break;
        }
      }
 catch (      FileNotFoundException e) {
      }
      LOG.info("doTestPurge waiting for files to be raided. Found " + (listPaths == null ? "none" : listPaths.length));
      Thread.sleep(1000);
    }
    LOG.info("doTestPurge all files found in Raid.");
    assertTrue("Unable to delete original file " + file1,fileSys.delete(file1,true));
    LOG.info("deleted file " + file1);
    while (fileSys.exists(destPath)) {
      LOG.info("doTestPurge waiting for parity files to be removed.");
      Thread.sleep(1000);
    }
  }
 catch (  Exception e) {
    LOG.info("doTestPurge Exception " + e + StringUtils.stringifyException(e));
    throw e;
  }
 finally {
    if (cnode != null) {
      cnode.stop();
      cnode.join();
    }
    LOG.info("doTestPurge delete file " + file1);
    fileSys.delete(file1,true);
  }
  LOG.info("doTestPurge completed:" + " blockSize=" + blockSize + " stripeLength="+ stripeLength);
}
