{
  config.setBoolean(DFSConfigKeys.DFS_SUPPORT_APPEND_KEY,true);
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster(config,2,true,null);
    FileSystem fs=cluster.getFileSystem();
    createControlFile(fs,fileSize,nrFiles);
    long tStart=System.currentTimeMillis();
    writeTest(fs);
    long execTime=System.currentTimeMillis() - tStart;
    analyzeResult(fs,TEST_TYPE_WRITE,execTime,DEFAULT_RES_FILE_NAME);
    tStart=System.currentTimeMillis();
    readTest(fs);
    execTime=System.currentTimeMillis() - tStart;
    analyzeResult(fs,TEST_TYPE_READ,execTime,DEFAULT_RES_FILE_NAME);
    tStart=System.currentTimeMillis();
    appendTest(fs);
    execTime=System.currentTimeMillis() - tStart;
    analyzeResult(fs,TEST_TYPE_APPEND,execTime,DEFAULT_RES_FILE_NAME);
    cleanup(fs);
  }
  finally {
    if (cluster != null)     cluster.shutdown();
  }
}
