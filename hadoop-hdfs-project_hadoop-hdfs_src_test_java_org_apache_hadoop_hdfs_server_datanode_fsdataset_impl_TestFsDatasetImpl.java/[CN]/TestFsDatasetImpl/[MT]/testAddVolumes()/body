{
  final int numNewVolumes=3;
  final int numExistingVolumes=dataset.getVolumes().size();
  final int totalVolumes=numNewVolumes + numExistingVolumes;
  List<StorageLocation> newLocations=new ArrayList<StorageLocation>();
  Set<String> expectedVolumes=new HashSet<String>();
  for (int i=0; i < numNewVolumes; i++) {
    String path=BASE_DIR + "/newData" + i;
    newLocations.add(StorageLocation.parse(path));
    when(storage.getStorageDir(numExistingVolumes + i)).thenReturn(createStorageDirectory(new File(path)));
  }
  when(storage.getNumStorageDirs()).thenReturn(totalVolumes);
  dataset.addVolumes(newLocations,Arrays.asList(BLOCK_POOL_IDS));
  assertEquals(totalVolumes,dataset.getVolumes().size());
  assertEquals(totalVolumes,dataset.storageMap.size());
  Set<String> actualVolumes=new HashSet<String>();
  for (int i=0; i < numNewVolumes; i++) {
    dataset.getVolumes().get(numExistingVolumes + i).getBasePath();
  }
  assertEquals(actualVolumes,expectedVolumes);
}
