{
  final DataNode datanode=Mockito.mock(DataNode.class);
  storage=Mockito.mock(DataStorage.class);
  scanner=Mockito.mock(DataBlockScanner.class);
  this.conf=new Configuration();
  final DNConf dnConf=new DNConf(conf);
  when(datanode.getConf()).thenReturn(conf);
  when(datanode.getDnConf()).thenReturn(dnConf);
  when(datanode.getBlockScanner()).thenReturn(scanner);
  createStorageDirs(storage,conf,NUM_INIT_VOLUMES);
  dataset=new FsDatasetImpl(datanode,storage,conf);
  for (  String bpid : BLOCK_POOL_IDS) {
    dataset.addBlockPool(bpid,conf);
  }
  assertEquals(NUM_INIT_VOLUMES,dataset.getVolumes().size());
  assertEquals(0,dataset.getNumFailedVolumes());
}
