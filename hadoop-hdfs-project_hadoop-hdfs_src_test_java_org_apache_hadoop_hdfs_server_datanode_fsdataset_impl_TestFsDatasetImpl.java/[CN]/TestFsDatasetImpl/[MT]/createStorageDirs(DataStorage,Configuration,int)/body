{
  List<Storage.StorageDirectory> dirs=new ArrayList<Storage.StorageDirectory>();
  List<String> dirStrings=new ArrayList<String>();
  for (int i=0; i < numDirs; i++) {
    File loc=new File(BASE_DIR + "/data" + i);
    dirStrings.add(loc.toString());
    loc.mkdirs();
    dirs.add(createStorageDirectory(loc));
    when(storage.getStorageDir(i)).thenReturn(dirs.get(i));
  }
  String dataDir=StringUtils.join(",",dirStrings);
  conf.set(DFSConfigKeys.DFS_DATANODE_DATA_DIR_KEY,dataDir);
  when(storage.dirIterator()).thenReturn(dirs.iterator());
  when(storage.getNumStorageDirs()).thenReturn(numDirs);
}
