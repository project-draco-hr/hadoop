{
  Configuration conf=new Configuration();
  try {
    RPC.setProtocolEngine(conf,HAServiceProtocolPB.class,ProtobufRpcEngine.class);
    HAServiceProtocolServerSideTranslatorPB haServiceProtocolXlator=new HAServiceProtocolServerSideTranslatorPB(new MockHAProtocolImpl());
    BlockingService haPbService=HAServiceProtocolService.newReflectiveBlockingService(haServiceProtocolXlator);
    Server server=new RPC.Builder(conf).setProtocol(HAServiceProtocolPB.class).setInstance(haPbService).setBindAddress(serverAddress.getHostName()).setPort(serverAddress.getPort()).build();
    server.start();
    return NetUtils.getConnectAddress(server);
  }
 catch (  IOException e) {
    return null;
  }
}
