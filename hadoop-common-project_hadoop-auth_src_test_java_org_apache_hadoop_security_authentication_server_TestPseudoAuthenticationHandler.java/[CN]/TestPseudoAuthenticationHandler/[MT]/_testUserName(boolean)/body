{
  PseudoAuthenticationHandler handler=new PseudoAuthenticationHandler();
  try {
    Properties props=new Properties();
    props.setProperty(PseudoAuthenticationHandler.ANONYMOUS_ALLOWED,Boolean.toString(anonymous));
    handler.init(props);
    HttpServletRequest request=Mockito.mock(HttpServletRequest.class);
    HttpServletResponse response=Mockito.mock(HttpServletResponse.class);
    Mockito.when(request.getParameter(PseudoAuthenticator.USER_NAME)).thenReturn("user");
    AuthenticationToken token=handler.authenticate(request,response);
    assertNotNull(token);
    assertEquals("user",token.getUserName());
    assertEquals("user",token.getName());
    assertEquals(PseudoAuthenticationHandler.TYPE,token.getType());
  }
  finally {
    handler.destroy();
  }
}
