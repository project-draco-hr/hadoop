{
  BlockCommandProto.Builder builder=BlockCommandProto.newBuilder().setBlockPoolId(cmd.getBlockPoolId());
switch (cmd.getAction()) {
case DatanodeProtocol.DNA_TRANSFER:
    builder.setAction(BlockCommandProto.Action.TRANSFER);
  break;
case DatanodeProtocol.DNA_INVALIDATE:
builder.setAction(BlockCommandProto.Action.INVALIDATE);
break;
}
Block[] blocks=cmd.getBlocks();
for (int i=0; i < blocks.length; i++) {
builder.addBlocks(PBHelper.convert(blocks[i]));
}
DatanodeInfo[][] infos=cmd.getTargets();
for (int i=0; i < infos.length; i++) {
builder.addTargets(PBHelper.convert(infos[i]));
}
return builder.build();
}
