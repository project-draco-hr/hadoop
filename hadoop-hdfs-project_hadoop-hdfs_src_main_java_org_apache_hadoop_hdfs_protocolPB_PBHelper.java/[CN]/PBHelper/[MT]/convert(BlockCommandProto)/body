{
  List<BlockProto> blockProtoList=blkCmd.getBlocksList();
  Block[] blocks=new Block[blockProtoList.size()];
  for (int i=0; i < blockProtoList.size(); i++) {
    blocks[i]=PBHelper.convert(blockProtoList.get(i));
  }
  List<DatanodeInfosProto> targetList=blkCmd.getTargetsList();
  DatanodeInfo[][] targets=new DatanodeInfo[targetList.size()][];
  for (int i=0; i < targetList.size(); i++) {
    targets[i]=PBHelper.convert(targetList.get(i));
  }
  int action=DatanodeProtocol.DNA_UNKNOWN;
switch (blkCmd.getAction()) {
case TRANSFER:
    action=DatanodeProtocol.DNA_TRANSFER;
  break;
case INVALIDATE:
action=DatanodeProtocol.DNA_INVALIDATE;
break;
case SHUTDOWN:
action=DatanodeProtocol.DNA_SHUTDOWN;
break;
case CACHE:
action=DatanodeProtocol.DNA_CACHE;
break;
case UNCACHE:
action=DatanodeProtocol.DNA_UNCACHE;
break;
default :
throw new AssertionError("Unknown action type: " + blkCmd.getAction());
}
return new BlockCommand(action,blkCmd.getBlockPoolId(),blocks,targets);
}
