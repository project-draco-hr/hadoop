{
  if (proto == null)   return null;
  List<DatanodeInfoProto> locs=proto.getLocsList();
  DatanodeInfo[] targets=new DatanodeInfo[locs.size()];
  for (int i=0; i < locs.size(); i++) {
    targets[i]=PBHelper.convert(locs.get(i));
  }
  List<StorageTypeProto> storageTypesList=proto.getStorageTypesList();
  StorageType[] storageTypes=new StorageType[locs.size()];
  if ((storageTypesList != null) && (storageTypesList.size() == locs.size())) {
    for (int i=0; i < storageTypesList.size(); ++i) {
      storageTypes[i]=PBHelper.convertType(storageTypesList.get(i));
    }
  }
  final int storageIDsCount=proto.getStorageIDsCount();
  final String[] storageIDs=storageIDsCount == 0 ? null : proto.getStorageIDsList().toArray(new String[storageIDsCount]);
  List<DatanodeInfo> cachedLocs=new ArrayList<DatanodeInfo>(locs.size());
  List<Boolean> isCachedList=proto.getIsCachedList();
  for (int i=0; i < isCachedList.size(); i++) {
    if (isCachedList.get(i)) {
      cachedLocs.add(targets[i]);
    }
  }
  LocatedBlock lb=new LocatedBlock(PBHelper.convert(proto.getB()),targets,storageIDs,storageTypes,proto.getOffset(),proto.getCorrupt(),cachedLocs.toArray(new DatanodeInfo[0]));
  lb.setBlockToken(PBHelper.convert(proto.getBlockToken()));
  return lb;
}
