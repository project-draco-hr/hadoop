{
  Text haService=HAUtil.buildTokenServiceForLogicalUri(haUri,HdfsConstants.HDFS_URI_SCHEME);
  Token<DelegationTokenIdentifier> haToken=tokenSelector.selectToken(haService,ugi.getTokens());
  if (haToken != null) {
    for (    InetSocketAddress singleNNAddr : nnAddrs) {
      Token<DelegationTokenIdentifier> specificToken=new Token.PrivateToken<DelegationTokenIdentifier>(haToken);
      SecurityUtil.setTokenService(specificToken,singleNNAddr);
      Text alias=new Text(buildTokenServicePrefixForLogicalUri(HdfsConstants.HDFS_URI_SCHEME) + "//" + specificToken.getService());
      ugi.addToken(alias,specificToken);
      if (LOG.isDebugEnabled()) {
        LOG.debug("Mapped HA service delegation token for logical URI " + haUri + " to namenode "+ singleNNAddr);
      }
    }
  }
 else {
    if (LOG.isDebugEnabled()) {
      LOG.debug("No HA service delegation token found for logical URI " + haUri);
    }
  }
}
