{
  final FSNamesystem fsn=cluster.getNamesystem();
  final Path foo=new Path("/foo");
  try (FSDataOutputStream out=dfs.create(foo,true)){
    DFSStripedOutputStream sout=(DFSStripedOutputStream)out.getWrappedStream();
    writeAndFlushStripedOutputStream(sout,DFS_BYTES_PER_CHECKSUM_DEFAULT);
    final List<DatanodeDescriptor> dnList=new ArrayList<>();
    fsn.getBlockManager().getDatanodeManager().fetchDatanodes(dnList,null,false);
    for (    DatanodeDescriptor dn : dnList) {
      Assert.assertEquals(1,dn.getBlocksScheduled());
    }
  }
   for (  DataNode dn : cluster.getDataNodes()) {
    DataNodeTestUtils.triggerBlockReport(dn);
  }
  final List<DatanodeDescriptor> dnList=new ArrayList<>();
  fsn.getBlockManager().getDatanodeManager().fetchDatanodes(dnList,null,false);
  for (  DatanodeDescriptor dn : dnList) {
    Assert.assertEquals(0,dn.getBlocksScheduled());
  }
}
