{
  Server server=new TestServer(1,false,serverParamClass,serverResponseClass);
  InetSocketAddress addr=NetUtils.getConnectAddress(server);
  server.start();
  WRITABLE_FAULTS_ENABLED=true;
  Client client=new Client(clientResponseClass,conf);
  try {
    LongWritable param=clientParamClass.newInstance();
    try {
      call(client,param,addr,0,conf);
      fail("Expected an exception to have been thrown");
    }
 catch (    Throwable t) {
      assertExceptionContains(t,"Injected fault");
    }
    WRITABLE_FAULTS_ENABLED=false;
    call(client,param,addr,0,conf);
  }
  finally {
    client.stop();
    server.stop();
  }
}
