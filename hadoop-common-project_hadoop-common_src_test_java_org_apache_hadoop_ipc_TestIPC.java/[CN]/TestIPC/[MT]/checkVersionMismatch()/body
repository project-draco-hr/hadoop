{
  try (final ServerSocket listenSocket=new ServerSocket()){
    listenSocket.bind(null);
    InetSocketAddress addr=(InetSocketAddress)listenSocket.getLocalSocketAddress();
    ExecutorService executor=Executors.newSingleThreadExecutor();
    executor.submit(new Runnable(){
      @Override public void run(){
        try {
          Socket socket=listenSocket.accept();
          socket.getOutputStream().write(NetworkTraces.RESPONSE_TO_HADOOP_0_20_3_RPC);
          socket.close();
        }
 catch (        Throwable t) {
        }
      }
    }
);
    try {
      Client client=new Client(LongWritable.class,conf);
      call(client,0,addr,conf);
    }
 catch (    RemoteException re) {
      Assert.assertEquals(RPC.VersionMismatch.class.getName(),re.getClassName());
      Assert.assertEquals(NetworkTraces.HADOOP0_20_ERROR_MSG,re.getMessage());
      return;
    }
    Assert.fail("didn't get version mismatch");
  }
 }
