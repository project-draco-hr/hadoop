{
  int[] maxAppAttemtps=new int[]{1,2,3};
  Boolean[] expectedBools=new Boolean[]{true,true,false};
  String applicationAttemptIdStr="appattempt_1317529182569_0004_000002";
  String containerIdStr="container_1317529182569_0004_000002_1";
  String userName="TestAppMasterUser";
  ApplicationAttemptId applicationAttemptId=ConverterUtils.toApplicationAttemptId(applicationAttemptIdStr);
  ContainerId containerId=ConverterUtils.toContainerId(containerIdStr);
  JobConf conf=new JobConf();
  conf.set(MRJobConfig.MR_AM_STAGING_DIR,stagingDir);
  File stagingDir=new File(MRApps.getStagingAreaDir(conf,userName).toString());
  stagingDir.mkdirs();
  for (int i=0; i < maxAppAttemtps.length; ++i) {
    MRAppMasterTest appMaster=new MRAppMasterTest(applicationAttemptId,containerId,"host",-1,-1,System.currentTimeMillis(),maxAppAttemtps[i],false,true);
    MRAppMaster.initAndStartAppMaster(appMaster,conf,userName);
    assertEquals("isLastAMRetry is correctly computed.",expectedBools[i],appMaster.isLastAMRetry());
  }
}
