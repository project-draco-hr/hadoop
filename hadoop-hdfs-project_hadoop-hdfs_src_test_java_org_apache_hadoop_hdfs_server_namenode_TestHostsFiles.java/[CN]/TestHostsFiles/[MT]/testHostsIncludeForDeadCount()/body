{
  Configuration conf=getConf();
  HostsFileWriter hostsFileWriter=new HostsFileWriter();
  hostsFileWriter.initialize(conf,"temp/decommission");
  hostsFileWriter.initIncludeHosts(new String[]{"localhost:52","127.0.0.1:7777"});
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).build();
    final FSNamesystem ns=cluster.getNameNode().getNamesystem();
    assertTrue(ns.getNumDeadDataNodes() == 2);
    assertTrue(ns.getNumLiveDataNodes() == 0);
    MBeanServer mbs=ManagementFactory.getPlatformMBeanServer();
    ObjectName mxbeanName=new ObjectName("Hadoop:service=NameNode,name=FSNamesystemState");
    String nodes=mbs.getAttribute(mxbeanName,"NumDeadDataNodes") + "";
    assertTrue((Integer)mbs.getAttribute(mxbeanName,"NumDeadDataNodes") == 2);
    assertTrue((Integer)mbs.getAttribute(mxbeanName,"NumLiveDataNodes") == 0);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
    hostsFileWriter.cleanup();
  }
}
