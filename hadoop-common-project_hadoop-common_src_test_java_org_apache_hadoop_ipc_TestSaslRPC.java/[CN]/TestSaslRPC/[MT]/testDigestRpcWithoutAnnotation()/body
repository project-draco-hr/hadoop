{
  TestTokenSecretManager sm=new TestTokenSecretManager();
  try {
    SecurityUtil.setSecurityInfoProviders(new CustomSecurityInfo());
    final Server server=new RPC.Builder(conf).setProtocol(TestSaslProtocol.class).setInstance(new TestSaslImpl()).setBindAddress(ADDRESS).setPort(0).setNumHandlers(5).setVerbose(true).setSecretManager(sm).build();
    doDigestRpc(server,sm);
  }
  finally {
    SecurityUtil.setSecurityInfoProviders(new SecurityInfo[0]);
  }
}
