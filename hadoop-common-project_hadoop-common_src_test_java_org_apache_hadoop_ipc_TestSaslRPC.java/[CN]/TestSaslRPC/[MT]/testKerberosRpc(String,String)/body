{
  final Configuration newConf=new Configuration(conf);
  newConf.set(SERVER_PRINCIPAL_KEY,principal);
  newConf.set(SERVER_KEYTAB_KEY,keytab);
  SecurityUtil.login(newConf,SERVER_KEYTAB_KEY,SERVER_PRINCIPAL_KEY);
  TestUserGroupInformation.verifyLoginMetrics(1,0);
  UserGroupInformation current=UserGroupInformation.getCurrentUser();
  System.out.println("UGI: " + current);
  Server server=setupTestServer(newConf,5);
  TestRpcService proxy=null;
  try {
    proxy=getClient(addr,newConf);
    proxy.ping(null,newEmptyRequest());
  }
  finally {
    stop(server,proxy);
  }
  System.out.println("Test is successful.");
}
