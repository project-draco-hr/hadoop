{
  BadTokenSecretManager sm=new BadTokenSecretManager();
  final Server server=setupTestServer(conf,5,sm);
  boolean succeeded=false;
  try {
    doDigestRpc(server,sm);
  }
 catch (  ServiceException e) {
    assertTrue(e.getCause() instanceof RemoteException);
    RemoteException re=(RemoteException)e.getCause();
    LOG.info("LOGGING MESSAGE: " + re.getLocalizedMessage());
    assertEquals(ERROR_MESSAGE,re.getLocalizedMessage());
    assertTrue(re.unwrapRemoteException() instanceof InvalidToken);
    succeeded=true;
  }
  assertTrue(succeeded);
}
