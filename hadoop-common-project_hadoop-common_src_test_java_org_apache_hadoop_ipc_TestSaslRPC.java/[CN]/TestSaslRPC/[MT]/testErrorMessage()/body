{
  BadTokenSecretManager sm=new BadTokenSecretManager();
  final Server server=new RPC.Builder(conf).setProtocol(TestSaslProtocol.class).setInstance(new TestSaslImpl()).setBindAddress(ADDRESS).setPort(0).setNumHandlers(5).setVerbose(true).setSecretManager(sm).build();
  boolean succeeded=false;
  try {
    doDigestRpc(server,sm);
  }
 catch (  RemoteException e) {
    LOG.info("LOGGING MESSAGE: " + e.getLocalizedMessage());
    assertTrue(ERROR_MESSAGE.equals(e.getLocalizedMessage()));
    assertTrue(e.unwrapRemoteException() instanceof InvalidToken);
    succeeded=true;
  }
  assertTrue(succeeded);
}
