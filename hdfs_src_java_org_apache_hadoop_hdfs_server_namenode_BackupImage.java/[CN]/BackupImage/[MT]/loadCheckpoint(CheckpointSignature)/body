{
  if (!editLog.isOpen())   editLog.open();
  FSDirectory fsDir=getFSNamesystem().dir;
  if (fsDir.isEmpty()) {
    Iterator<StorageDirectory> itImage=storage.dirIterator(NameNodeDirType.IMAGE);
    Iterator<StorageDirectory> itEdits=storage.dirIterator(NameNodeDirType.EDITS);
    if (!itImage.hasNext() || !itEdits.hasNext())     throw new IOException("Could not locate checkpoint directories");
    StorageDirectory sdName=itImage.next();
    StorageDirectory sdEdits=itEdits.next();
    getFSDirectoryRootLock().writeLock();
    try {
      loadFSImage(NNStorage.getStorageFile(sdName,NameNodeFile.IMAGE));
    }
  finally {
      getFSDirectoryRootLock().writeUnlock();
    }
    loadFSEdits(sdEdits);
  }
  storage.setStorageInfo(sig);
  storage.setImageDigest(sig.imageDigest);
  storage.setCheckpointTime(sig.checkpointTime);
}
