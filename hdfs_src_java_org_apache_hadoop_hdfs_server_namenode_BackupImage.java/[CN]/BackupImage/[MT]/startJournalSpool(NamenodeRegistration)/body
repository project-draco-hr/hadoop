{
switch (jsState) {
case OFF:
    break;
case INPROGRESS:
  return;
case WAIT:
waitSpoolEnd();
}
for (Iterator<StorageDirectory> it=storage.dirIterator(NameNodeDirType.EDITS); it.hasNext(); ) {
StorageDirectory sd=it.next();
File jsDir=getJSpoolDir(sd);
if (!jsDir.exists() && !jsDir.mkdirs()) {
throw new IOException("Mkdirs failed to create " + jsDir.getCanonicalPath());
}
File eFile=storage.getEditFile(sd);
if (!eFile.exists()) {
editLog.createEditLogFile(eFile);
}
}
if (!editLog.isOpen()) editLog.open();
editLog.divertFileStreams(STORAGE_JSPOOL_DIR + "/" + STORAGE_JSPOOL_FILE);
setCheckpointState(CheckpointStates.ROLLED_EDITS);
if (backupInputStream == null) backupInputStream=new EditLogBackupInputStream(nnReg.getAddress());
jsState=JSpoolState.INPROGRESS;
}
