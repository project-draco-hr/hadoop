{
  if (aclBuilder.size() > MAX_ENTRIES) {
    throw new AclException("Invalid ACL: ACL has " + aclBuilder.size() + " entries, which exceeds maximum of "+ MAX_ENTRIES+ ".");
  }
  aclBuilder.trimToSize();
  Collections.sort(aclBuilder,ACL_ENTRY_COMPARATOR);
  AclEntry prevEntry=null;
  for (  AclEntry entry : aclBuilder) {
    if (prevEntry != null && ACL_ENTRY_COMPARATOR.compare(prevEntry,entry) == 0) {
      throw new AclException("Invalid ACL: multiple entries with same scope, type and name.");
    }
    if (entry.getName() != null && (entry.getType() == MASK || entry.getType() == OTHER)) {
      throw new AclException("Invalid ACL: this entry type must not have a name: " + entry + ".");
    }
    prevEntry=entry;
  }
  int pivot=calculatePivotOnDefaultEntries(aclBuilder);
  for (  AclEntryType type : EnumSet.of(USER,GROUP,OTHER)) {
    AclEntry accessEntryKey=new AclEntry.Builder().setScope(ACCESS).setType(type).build();
    if (Collections.binarySearch(aclBuilder,accessEntryKey,ACL_ENTRY_COMPARATOR) < 0) {
      throw new AclException("Invalid ACL: the user, group and other entries are required.");
    }
    if (pivot != PIVOT_NOT_FOUND) {
      AclEntry defaultEntryKey=new AclEntry.Builder().setScope(DEFAULT).setType(type).build();
      if (Collections.binarySearch(aclBuilder,defaultEntryKey,ACL_ENTRY_COMPARATOR) < 0) {
        throw new AclException("Invalid default ACL: the user, group and other entries are required.");
      }
    }
  }
  return Collections.unmodifiableList(aclBuilder);
}
