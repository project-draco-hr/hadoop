{
  localFS.delete(new Path(localDir.getAbsolutePath()),true);
  localFS.delete(new Path(tmpDir.getAbsolutePath()),true);
  localFS.delete(new Path(localLogDir.getAbsolutePath()),true);
  localFS.delete(new Path(remoteLogDir.getAbsolutePath()),true);
  localDir.mkdir();
  tmpDir.mkdir();
  localLogDir.mkdir();
  remoteLogDir.mkdir();
  LOG.info("Created localDir in " + localDir.getAbsolutePath());
  LOG.info("Created tmpDir in " + tmpDir.getAbsolutePath());
  String bindAddress="0.0.0.0:12345";
  conf.set(YarnConfiguration.NM_ADDRESS,bindAddress);
  conf.set(YarnConfiguration.NM_LOCAL_DIRS,localDir.getAbsolutePath());
  conf.set(YarnConfiguration.NM_LOG_DIRS,localLogDir.getAbsolutePath());
  conf.set(YarnConfiguration.NM_REMOTE_APP_LOG_DIR,remoteLogDir.getAbsolutePath());
  delSrvc=createDeletionService();
  delSrvc.init(conf);
  exec=createContainerExecutor();
  nodeHealthChecker=new NodeHealthCheckerService();
  nodeHealthChecker.init(conf);
  dirsHandler=nodeHealthChecker.getDiskHandler();
  containerManager=createContainerManager(delSrvc);
  ((NMContext)context).setContainerManager(containerManager);
  nodeStatusUpdater.init(conf);
  containerManager.init(conf);
  nodeStatusUpdater.start();
}
