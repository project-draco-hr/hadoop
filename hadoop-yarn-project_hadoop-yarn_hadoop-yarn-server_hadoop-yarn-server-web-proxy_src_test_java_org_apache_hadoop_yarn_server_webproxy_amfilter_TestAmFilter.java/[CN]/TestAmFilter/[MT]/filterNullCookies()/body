{
  HttpServletRequest request=Mockito.mock(HttpServletRequest.class);
  Mockito.when(request.getCookies()).thenReturn(null);
  Mockito.when(request.getRemoteAddr()).thenReturn(proxyHost);
  HttpServletResponse response=Mockito.mock(HttpServletResponse.class);
  final AtomicBoolean invoked=new AtomicBoolean();
  FilterChain chain=new FilterChain(){
    @Override public void doFilter(    ServletRequest servletRequest,    ServletResponse servletResponse) throws IOException, ServletException {
      invoked.set(true);
    }
  }
;
  Map<String,String> params=new HashMap<String,String>();
  params.put(AmIpFilter.PROXY_HOST,proxyHost);
  params.put(AmIpFilter.PROXY_URI_BASE,proxyUri);
  FilterConfig conf=new DummyFilterConfig(params);
  Filter filter=new TestAmIpFilter();
  filter.init(conf);
  filter.doFilter(request,response,chain);
  assertTrue(invoked.get());
  filter.destroy();
}
