{
  FSNamesystem fsn=Mockito.mock(FSNamesystem.class);
  Mockito.when(fsn.hasWriteLock()).thenReturn(true);
  Configuration conf=new Configuration();
  conf.setBoolean(DFSConfigKeys.DFS_REJECT_UNRESOLVED_DN_TOPOLOGY_MAPPING_KEY,true);
  conf.setClass(CommonConfigurationKeysPublic.NET_TOPOLOGY_NODE_SWITCH_MAPPING_IMPL_KEY,TestDatanodeManager.MyResolver.class,DNSToSwitchMapping.class);
  DatanodeManager dm=new DatanodeManager(Mockito.mock(BlockManager.class),fsn,conf);
  String storageID="someStorageID-123";
  DatanodeRegistration dr=Mockito.mock(DatanodeRegistration.class);
  Mockito.when(dr.getDatanodeUuid()).thenReturn(storageID);
  try {
    dm.registerDatanode(dr);
    Assert.fail("Expected an UnresolvedTopologyException");
  }
 catch (  UnresolvedTopologyException ute) {
    LOG.info("Expected - topology is not resolved and " + "registration is rejected.");
  }
catch (  Exception e) {
    Assert.fail("Expected an UnresolvedTopologyException");
  }
}
