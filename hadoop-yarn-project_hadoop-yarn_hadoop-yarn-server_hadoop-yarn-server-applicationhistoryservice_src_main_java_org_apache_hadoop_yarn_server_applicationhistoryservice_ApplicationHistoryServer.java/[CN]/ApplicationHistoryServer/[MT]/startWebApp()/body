{
  Configuration conf=getConfig();
  String initializers=conf.get("hadoop.http.filter.initializers");
  initializers=initializers == null || initializers.length() == 0 ? "" : initializers;
  if (!initializers.contains(TimelineAuthenticationFilterInitializer.class.getName())) {
    initializers=TimelineAuthenticationFilterInitializer.class.getName() + "," + initializers;
  }
  String[] parts=initializers.split(",");
  ArrayList<String> target=new ArrayList<String>();
  for (  String filterInitializer : parts) {
    filterInitializer=filterInitializer.trim();
    if (filterInitializer.equals(AuthenticationFilterInitializer.class.getName())) {
      continue;
    }
    target.add(filterInitializer);
  }
  String actualInitializers=org.apache.commons.lang.StringUtils.join(target,",");
  if (!actualInitializers.equals(initializers)) {
    conf.set("hadoop.http.filter.initializers",actualInitializers);
  }
  String bindAddress=WebAppUtils.getWebAppBindURL(conf,YarnConfiguration.TIMELINE_SERVICE_BIND_HOST,WebAppUtils.getAHSWebAppURLWithoutScheme(conf));
  LOG.info("Instantiating AHSWebApp at " + bindAddress);
  try {
    AHSWebApp ahsWebApp=AHSWebApp.getInstance();
    ahsWebApp.setApplicationHistoryManager(historyManager);
    ahsWebApp.setTimelineDelegationTokenSecretManagerService(secretManagerService);
    ahsWebApp.setTimelineDataManager(timelineDataManager);
    webApp=WebApps.$for("applicationhistory",ApplicationHistoryClientService.class,ahsClientService,"ws").with(conf).at(bindAddress).start(ahsWebApp);
  }
 catch (  Exception e) {
    String msg="AHSWebApp failed to start.";
    LOG.error(msg,e);
    throw new YarnRuntimeException(msg,e);
  }
}
