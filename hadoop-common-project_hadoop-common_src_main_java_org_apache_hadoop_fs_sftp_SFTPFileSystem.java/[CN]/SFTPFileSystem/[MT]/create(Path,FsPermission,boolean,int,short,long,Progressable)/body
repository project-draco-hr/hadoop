{
  final ChannelSftp client=connect();
  Path workDir;
  try {
    workDir=new Path(client.pwd());
  }
 catch (  SftpException e) {
    throw new IOException(e);
  }
  Path absolute=makeAbsolute(workDir,f);
  if (exists(client,f)) {
    if (overwrite) {
      delete(client,f,false);
    }
 else {
      disconnect(client);
      throw new IOException(String.format(E_FILE_EXIST,f));
    }
  }
  Path parent=absolute.getParent();
  if (parent == null || !mkdirs(client,parent,FsPermission.getDefault())) {
    parent=(parent == null) ? new Path("/") : parent;
    disconnect(client);
    throw new IOException(String.format(E_CREATE_DIR,parent));
  }
  OutputStream os;
  try {
    client.cd(parent.toUri().getPath());
    os=client.put(f.getName());
  }
 catch (  SftpException e) {
    throw new IOException(e);
  }
  FSDataOutputStream fos=new FSDataOutputStream(os,statistics){
    @Override public void close() throws IOException {
      super.close();
      disconnect(client);
    }
  }
;
  return fos;
}
