{
  if (closed == true) {
    return;
  }
  try {
    if (errorCount == 0) {
      if (blkInProgress == true) {
        throw new IllegalStateException("Close() called with active block appender.");
      }
      BlockAppender appender=prepareMetaBlock(DataIndex.BLOCK_NAME,getDefaultCompressionAlgorithm());
      try {
        dataIndex.write(appender);
      }
  finally {
        appender.close();
      }
      long offsetIndexMeta=out.getPos();
      metaIndex.write(out);
      out.writeLong(offsetIndexMeta);
      API_VERSION.write(out);
      Magic.write(out);
      out.flush();
    }
  }
  finally {
    closed=true;
  }
}
