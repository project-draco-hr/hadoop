{
  Configuration conf=new HdfsConfiguration();
  conf.setInt(DFSConfigKeys.DFS_REPLICATION_KEY,1);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  try {
    cluster.waitActive();
    FileSystem fs=cluster.getFileSystem();
    Path path=new Path("testBlockIdGeneration.dat");
    DFSTestUtil.createFile(fs,path,IO_SIZE,BLOCK_SIZE * 10,BLOCK_SIZE,REPLICATION,SEED);
    List<LocatedBlock> blocks=DFSTestUtil.getAllBlocks(fs,path);
    LOG.info("Block0 id is " + blocks.get(0).getBlock().getBlockId());
    long nextBlockExpectedId=blocks.get(0).getBlock().getBlockId() + 1;
    for (int i=1; i < blocks.size(); ++i) {
      long nextBlockId=blocks.get(i).getBlock().getBlockId();
      LOG.info("Block" + i + " id is "+ nextBlockId);
      assertThat(nextBlockId,is(nextBlockExpectedId));
      ++nextBlockExpectedId;
    }
  }
  finally {
    cluster.shutdown();
  }
}
