{
  this.recordFactory=RecordFactoryProvider.getRecordFactory(conf);
  try {
    FileContext lfs=getLocalFileContext(conf);
    String[] sLocalDirs=conf.getStrings(YarnConfiguration.NM_LOCAL_DIRS,YarnConfiguration.DEFAULT_NM_LOCAL_DIRS);
    localDirs=new ArrayList<Path>(sLocalDirs.length);
    logDirs=new ArrayList<Path>(sLocalDirs.length);
    sysDirs=new ArrayList<Path>(sLocalDirs.length);
    for (    String sLocaldir : sLocalDirs) {
      Path localdir=new Path(sLocaldir);
      localDirs.add(localdir);
      Path userdir=new Path(localdir,ContainerLocalizer.USERCACHE);
      lfs.mkdir(userdir,null,true);
      Path filedir=new Path(localdir,ContainerLocalizer.FILECACHE);
      lfs.mkdir(filedir,null,true);
      Path sysdir=new Path(localdir,NM_PRIVATE_DIR);
      lfs.mkdir(sysdir,NM_PRIVATE_PERM,true);
      sysDirs.add(sysdir);
    }
    String[] sLogdirs=conf.getStrings(YarnConfiguration.NM_LOG_DIRS,YarnConfiguration.DEFAULT_NM_LOG_DIRS);
    for (    String sLogdir : sLogdirs) {
      Path logdir=new Path(sLogdir);
      logDirs.add(logdir);
      lfs.mkdir(logdir,null,true);
    }
  }
 catch (  IOException e) {
    throw new YarnException("Failed to initialize LocalizationService",e);
  }
  localDirs=Collections.unmodifiableList(localDirs);
  logDirs=Collections.unmodifiableList(logDirs);
  sysDirs=Collections.unmodifiableList(sysDirs);
  cacheTargetSize=conf.getLong(YarnConfiguration.NM_LOCALIZER_CACHE_TARGET_SIZE_MB,YarnConfiguration.DEFAULT_NM_LOCALIZER_CACHE_TARGET_SIZE_MB) << 20;
  cacheCleanupPeriod=conf.getLong(YarnConfiguration.NM_LOCALIZER_CACHE_CLEANUP_INTERVAL_MS,YarnConfiguration.DEFAULT_NM_LOCALIZER_CACHE_CLEANUP_INTERVAL_MS);
  localizationServerAddress=NetUtils.createSocketAddr(conf.get(YarnConfiguration.NM_LOCALIZER_ADDRESS,YarnConfiguration.DEFAULT_NM_LOCALIZER_ADDRESS),YarnConfiguration.DEFAULT_NM_LOCALIZER_PORT,YarnConfiguration.NM_LOCALIZER_ADDRESS);
  localizerTracker=createLocalizerTracker(conf);
  addService(localizerTracker);
  dispatcher.register(LocalizerEventType.class,localizerTracker);
  super.init(conf);
}
