{
  Configuration newConf=new Configuration(conf);
  org.apache.log4j.Logger.getLogger(DecommissionManager.class).setLevel(Level.TRACE);
  newConf.setInt("dfs.namenode.decommission.nodes.per.interval",1);
  newConf.setInt(DFSConfigKeys.DFS_NAMENODE_DECOMMISSION_INTERVAL_KEY,Integer.MAX_VALUE);
  startCluster(1,3,newConf);
  final FileSystem fs=cluster.getFileSystem();
  final DatanodeManager datanodeManager=cluster.getNamesystem().getBlockManager().getDatanodeManager();
  final DecommissionManager decomManager=datanodeManager.getDecomManager();
  DFSTestUtil.createFile(fs,new Path("/file1"),64,(short)3,0xBAD1DEA);
  for (int i=0; i < 3; i++) {
    doDecomCheck(datanodeManager,decomManager,1);
  }
}
