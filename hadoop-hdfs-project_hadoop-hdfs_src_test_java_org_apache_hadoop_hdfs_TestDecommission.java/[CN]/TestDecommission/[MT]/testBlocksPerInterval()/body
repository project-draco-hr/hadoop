{
  org.apache.log4j.Logger.getLogger(DecommissionManager.class).setLevel(Level.TRACE);
  getConf().setInt(DFSConfigKeys.DFS_NAMENODE_DECOMMISSION_BLOCKS_PER_INTERVAL_KEY,3);
  getConf().setInt(DFSConfigKeys.DFS_NAMENODE_DECOMMISSION_INTERVAL_KEY,Integer.MAX_VALUE);
  startCluster(1,3);
  final FileSystem fs=getCluster().getFileSystem();
  final DatanodeManager datanodeManager=getCluster().getNamesystem().getBlockManager().getDatanodeManager();
  final DecommissionManager decomManager=datanodeManager.getDecomManager();
  DFSTestUtil.createFile(fs,new Path("/file1"),64,(short)3,0xBAD1DEA);
  doDecomCheck(datanodeManager,decomManager,3);
  DFSTestUtil.createFile(fs,new Path("/file2"),64,(short)3,0xBAD1DEA);
  doDecomCheck(datanodeManager,decomManager,2);
  DFSTestUtil.createFile(fs,new Path("/file3"),64,(short)3,0xBAD1DEA);
  doDecomCheck(datanodeManager,decomManager,1);
  DFSTestUtil.createFile(fs,new Path("/file4"),64,(short)3,0xBAD1DEA);
  doDecomCheck(datanodeManager,decomManager,1);
}
