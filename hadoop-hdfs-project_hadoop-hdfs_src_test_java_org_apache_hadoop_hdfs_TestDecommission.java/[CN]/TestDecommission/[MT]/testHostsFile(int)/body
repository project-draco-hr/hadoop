{
  int numDatanodes=1;
  startCluster(numNameNodes,numDatanodes,true,null,false);
  final String bogusIp="127.0.30.1";
  initIncludeHost(bogusIp);
  for (int j=0; j < numNameNodes; j++) {
    refreshNodes(j);
    DFSClient client=getDfsClient(j);
    DatanodeInfo[] info=client.datanodeReport(DatanodeReportType.LIVE);
    for (int i=0; i < 5 && info.length != 0; i++) {
      LOG.info("Waiting for datanode to be marked dead");
      Thread.sleep(HEARTBEAT_INTERVAL * 1000);
      info=client.datanodeReport(DatanodeReportType.LIVE);
    }
    assertEquals("Number of live nodes should be 0",0,info.length);
    info=client.datanodeReport(DatanodeReportType.DEAD);
    assertEquals("There should be 1 dead node",1,info.length);
    assertEquals(bogusIp,info[0].getHostName());
  }
}
