{
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(conf);
  CapacityScheduler cs=Mockito.spy(new CapacityScheduler());
  cs.setConf(new YarnConfiguration());
  RMContext mockRmContext=Mockito.spy(new RMContextImpl(null,null,null,null,null,null,new RMContainerTokenSecretManager(conf),new NMTokenSecretManagerInRM(conf),new ClientToAMTokenSecretManagerInRM(),null));
  cs.setRMContext(mockRmContext);
  try {
    cs.serviceInit(conf);
  }
 catch (  Exception e) {
    Assert.fail(e.getMessage());
  }
  when(mockRmContext.getScheduler()).thenReturn(cs);
  Resource r=Resource.newInstance(numContainers * 1024,numContainers);
  doReturn(r).when(cs).getClusterResource();
  return cs;
}
