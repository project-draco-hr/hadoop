{
  CapacityScheduler spyCs=new CapacityScheduler();
  cs=spy(spyCs);
  rmContext=TestUtils.getMockRMContext();
  csConf=new CapacitySchedulerConfiguration();
  csConf.setBoolean("yarn.scheduler.capacity.user-metrics.enable",true);
  final String newRoot="root" + System.currentTimeMillis();
  setupQueueConfiguration(csConf,newRoot);
  YarnConfiguration conf=new YarnConfiguration();
  cs.setConf(conf);
  csContext=mock(CapacitySchedulerContext.class);
  when(csContext.getConfiguration()).thenReturn(csConf);
  when(csContext.getConf()).thenReturn(conf);
  when(csContext.getMinimumResourceCapability()).thenReturn(Resources.createResource(GB));
  when(csContext.getMaximumResourceCapability()).thenReturn(Resources.createResource(16 * GB));
  when(csContext.getClusterResources()).thenReturn(Resources.createResource(100 * 16 * GB));
  root=CapacityScheduler.parseQueue(csContext,csConf,null,CapacitySchedulerConfiguration.ROOT,queues,queues,CapacityScheduler.queueComparator,CapacityScheduler.applicationComparator,TestUtils.spyHook);
  cs.reinitialize(csConf,null,rmContext);
}
