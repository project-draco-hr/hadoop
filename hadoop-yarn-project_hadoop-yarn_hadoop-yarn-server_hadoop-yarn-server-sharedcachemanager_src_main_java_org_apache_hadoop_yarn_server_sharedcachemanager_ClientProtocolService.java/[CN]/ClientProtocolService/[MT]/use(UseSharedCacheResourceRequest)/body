{
  UseSharedCacheResourceResponse response=recordFactory.newRecordInstance(UseSharedCacheResourceResponse.class);
  UserGroupInformation callerUGI;
  try {
    callerUGI=UserGroupInformation.getCurrentUser();
  }
 catch (  IOException ie) {
    LOG.info("Error getting UGI ",ie);
    throw RPCUtil.getRemoteException(ie);
  }
  String fileName=this.store.addResourceReference(request.getResourceKey(),new SharedCacheResourceReference(request.getAppId(),callerUGI.getShortUserName()));
  if (fileName != null) {
    response.setPath(getCacheEntryFilePath(request.getResourceKey(),fileName));
    this.metrics.incCacheHitCount();
  }
 else {
    this.metrics.incCacheMissCount();
  }
  return response;
}
