{
  final DataNodeProperties dnprop=cluster.stopDataNode(0);
  cluster.restartNameNode("-rollingUpgrade","rollback");
  cluster.restartDataNode(dnprop,true);
  final DistributedFileSystem dfs=cluster.getFileSystem();
  Assert.assertTrue(dfs.exists(foo));
  Assert.assertFalse(dfs.exists(bar));
  AppendTestUtil.checkFullFile(dfs,file,data.length,data);
}
