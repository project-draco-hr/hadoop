{
  Collection<URI> namespaceDirs=FSNamesystem.getNamespaceDirs(conf);
  Collection<URI> namespaceEditsDirs=FSNamesystem.getNamespaceEditsDirs(conf);
  if (namespaceDirs.size() == 1) {
    LOG.warn("Only one " + DFS_NAMENODE_NAME_DIR_KEY + " directory configured , beware data loss!");
  }
  if (namespaceEditsDirs.size() == 1) {
    LOG.warn("Only one " + DFS_NAMENODE_EDITS_DIR_KEY + " directory configured , beware data loss!");
  }
  FSImage fsImage=new FSImage(conf,namespaceDirs,namespaceEditsDirs);
  FSNamesystem namesystem=new FSNamesystem(conf,fsImage);
  long loadStart=now();
  StartupOption startOpt=NameNode.getStartupOption(conf);
  namesystem.loadFSImage(startOpt,fsImage);
  long timeTakenToLoadFSImage=now() - loadStart;
  LOG.info("Finished loading FSImage in " + timeTakenToLoadFSImage + " msecs");
  NameNode.getNameNodeMetrics().setFsImageLoadTime((int)timeTakenToLoadFSImage);
  return namesystem;
}
