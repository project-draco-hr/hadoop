{
  checkOperation(OperationCategory.WRITE);
  writeLock();
  try {
    checkOperation(OperationCategory.WRITE);
    for (int i=0; i < blocks.length; i++) {
      ExtendedBlock blk=blocks[i].getBlock();
      DatanodeInfo[] nodes=blocks[i].getLocations();
      String[] storageIDs=blocks[i].getStorageIDs();
      for (int j=0; j < nodes.length; j++) {
        NameNode.stateChangeLog.info("*DIR* reportBadBlocks for block: {} on" + " datanode: {}",blk,nodes[j].getXferAddr());
        blockManager.findAndMarkBlockAsCorrupt(blk,nodes[j],storageIDs == null ? null : storageIDs[j],"client machine reported it");
      }
    }
  }
  finally {
    writeUnlock();
  }
}
