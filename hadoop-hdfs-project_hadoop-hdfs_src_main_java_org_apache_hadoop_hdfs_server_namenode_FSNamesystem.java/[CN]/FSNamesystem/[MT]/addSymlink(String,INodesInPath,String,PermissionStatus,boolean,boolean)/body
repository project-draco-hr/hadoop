{
  waitForLoadingFSImage();
  final long modTime=now();
  if (createParent) {
    INodesInPath parentIIP=iip.getParentINodesInPath();
    if (parentIIP == null || (parentIIP=FSDirMkdirOp.mkdirsRecursively(dir,parentIIP,dirPerms,true,modTime)) == null) {
      return null;
    }
 else {
      iip=INodesInPath.append(parentIIP,null,iip.getLastLocalName());
    }
  }
  final String userName=dirPerms.getUserName();
  long id=dir.allocateNewInodeId();
  INodeSymlink newNode=dir.addSymlink(iip,id,target,modTime,modTime,new PermissionStatus(userName,null,FsPermission.getDefault()));
  if (newNode == null) {
    NameNode.stateChangeLog.info("addSymlink: failed to add " + path);
    return null;
  }
  getEditLog().logSymlink(path,target,modTime,modTime,newNode,logRetryCache);
  if (NameNode.stateChangeLog.isDebugEnabled()) {
    NameNode.stateChangeLog.debug("addSymlink: " + path + " is added");
  }
  return newNode;
}
