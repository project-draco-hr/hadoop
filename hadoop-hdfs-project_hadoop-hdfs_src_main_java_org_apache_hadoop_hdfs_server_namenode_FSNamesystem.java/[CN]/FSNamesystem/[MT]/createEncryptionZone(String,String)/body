{
  final CacheEntry cacheEntry=RetryCache.waitForCompletion(retryCache);
  if (cacheEntry != null && cacheEntry.isSuccess()) {
    return;
  }
  boolean success=false;
  try {
    if (provider == null) {
      throw new IOException("Can't create an encryption zone for " + src + " since no key provider is available.");
    }
    if (keyName == null || keyName.isEmpty()) {
      throw new IOException("Must specify a key name when creating an " + "encryption zone");
    }
    KeyProvider.Metadata metadata=provider.getMetadata(keyName);
    if (metadata == null) {
      throw new IOException("Key " + keyName + " doesn't exist.");
    }
    generateEncryptedDataEncryptionKey(keyName);
    createEncryptionZoneInt(src,metadata.getCipher(),keyName,cacheEntry != null);
    success=true;
  }
 catch (  AccessControlException e) {
    logAuditEvent(false,"createEncryptionZone",src);
    throw e;
  }
 finally {
    RetryCache.setState(cacheEntry,success);
  }
}
