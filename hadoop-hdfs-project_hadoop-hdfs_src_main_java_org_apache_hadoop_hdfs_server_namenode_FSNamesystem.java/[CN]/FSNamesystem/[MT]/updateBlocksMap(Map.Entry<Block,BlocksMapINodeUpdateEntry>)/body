{
  Block block=entry.getKey();
  BlocksMapINodeUpdateEntry value=entry.getValue();
  if (value == null) {
    blockManager.removeBlock(block);
  }
 else {
    BlockCollection toDelete=value.getToDelete();
    BlockInfo originalBlockInfo=blockManager.getStoredBlock(block);
    if (originalBlockInfo != null && toDelete == originalBlockInfo.getBlockCollection()) {
      blockManager.addBlockCollection(originalBlockInfo,value.getToReplace());
    }
  }
}
