{
  boolean success=false;
  writeLock();
  BlocksMapUpdateInfo blocksToBeDeleted=null;
  try {
    checkOperation(OperationCategory.WRITE);
    checkNameNodeSafeMode("Cannot delete snapshot for " + snapshotRoot);
    blocksToBeDeleted=FSDirSnapshotOp.deleteSnapshot(dir,snapshotManager,snapshotRoot,snapshotName,logRetryCache);
    success=true;
  }
  finally {
    writeUnlock();
  }
  getEditLog().logSync();
  if (blocksToBeDeleted != null) {
    removeBlocks(blocksToBeDeleted);
  }
  String rootPath=Snapshot.getSnapshotPath(snapshotRoot,snapshotName);
  logAuditEvent(success,"deleteSnapshot",rootPath,null,null);
}
