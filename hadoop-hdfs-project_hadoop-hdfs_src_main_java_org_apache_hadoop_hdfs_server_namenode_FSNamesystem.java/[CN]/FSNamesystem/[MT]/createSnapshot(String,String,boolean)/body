{
  String snapshotPath=null;
  writeLock();
  try {
    checkOperation(OperationCategory.WRITE);
    checkNameNodeSafeMode("Cannot create snapshot for " + snapshotRoot);
    snapshotPath=FSDirSnapshotOp.createSnapshot(dir,snapshotManager,snapshotRoot,snapshotName,logRetryCache);
  }
  finally {
    writeUnlock();
  }
  getEditLog().logSync();
  logAuditEvent(snapshotPath != null,"createSnapshot",snapshotRoot,snapshotPath,null);
  return snapshotPath;
}
