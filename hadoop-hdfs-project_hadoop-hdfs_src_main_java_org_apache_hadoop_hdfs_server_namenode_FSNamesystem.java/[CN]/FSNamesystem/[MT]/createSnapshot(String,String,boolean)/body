{
  String snapshotPath=null;
  boolean success=false;
  writeLock();
  try {
    checkOperation(OperationCategory.WRITE);
    checkNameNodeSafeMode("Cannot create snapshot for " + snapshotRoot);
    snapshotPath=FSDirSnapshotOp.createSnapshot(dir,snapshotManager,snapshotRoot,snapshotName,logRetryCache);
    success=true;
  }
 catch (  AccessControlException ace) {
    logAuditEvent(success,"createSnapshot",snapshotRoot,snapshotPath,null);
    throw ace;
  }
 finally {
    writeUnlock();
  }
  getEditLog().logSync();
  logAuditEvent(success,"createSnapshot",snapshotRoot,snapshotPath,null);
  return snapshotPath;
}
