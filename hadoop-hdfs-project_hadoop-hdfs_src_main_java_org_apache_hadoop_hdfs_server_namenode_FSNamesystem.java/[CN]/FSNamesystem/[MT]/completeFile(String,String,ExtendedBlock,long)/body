{
  if (NameNode.stateChangeLog.isDebugEnabled()) {
    NameNode.stateChangeLog.debug("DIR* NameSystem.completeFile: " + src + " for "+ holder);
  }
  checkBlock(last);
  boolean success=false;
  checkOperation(OperationCategory.WRITE);
  byte[][] pathComponents=FSDirectory.getPathComponentsForReservedPath(src);
  writeLock();
  try {
    checkOperation(OperationCategory.WRITE);
    if (isInSafeMode()) {
      throw new SafeModeException("Cannot complete file " + src,safeMode);
    }
    src=FSDirectory.resolvePath(src,pathComponents,dir);
    success=completeFileInternal(src,holder,ExtendedBlock.getLocalBlock(last),fileId);
  }
  finally {
    writeUnlock();
  }
  getEditLog().logSync();
  NameNode.stateChangeLog.info("DIR* completeFile: " + src + " is closed by "+ holder);
  return success;
}
