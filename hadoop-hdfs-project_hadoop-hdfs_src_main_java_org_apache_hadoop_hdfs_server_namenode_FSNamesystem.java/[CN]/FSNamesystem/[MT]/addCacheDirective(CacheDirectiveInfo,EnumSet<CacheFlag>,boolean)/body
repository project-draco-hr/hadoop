{
  CacheDirectiveInfo effectiveDirective=null;
  boolean success=false;
  String effectiveDirectiveStr;
  if (!flags.contains(CacheFlag.FORCE)) {
    cacheManager.waitForRescanIfNeeded();
  }
  writeLock();
  try {
    checkOperation(OperationCategory.WRITE);
    checkNameNodeSafeMode("Cannot add cache directive");
    effectiveDirective=FSNDNCacheOp.addCacheDirective(this,cacheManager,directive,flags,logRetryCache);
    success=true;
  }
 catch (  AccessControlException ace) {
    logAuditEvent(success,"addCacheDirective",null,null,null);
    throw ace;
  }
 finally {
    writeUnlock();
    if (success) {
      getEditLog().logSync();
    }
  }
  effectiveDirectiveStr=effectiveDirective.toString();
  logAuditEvent(success,"addCacheDirective",effectiveDirectiveStr,null,null);
  return effectiveDirective.getId();
}
