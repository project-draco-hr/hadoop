{
  checkOperation(OperationCategory.READ);
  GetBlockLocationsResult res=null;
  FSPermissionChecker pc=getPermissionChecker();
  readLock();
  try {
    checkOperation(OperationCategory.READ);
    res=getBlockLocations(pc,srcArg,offset,length,true,true);
  }
 catch (  AccessControlException e) {
    logAuditEvent(false,"open",srcArg);
    throw e;
  }
 finally {
    readUnlock();
  }
  logAuditEvent(true,"open",srcArg);
  if (res.updateAccessTime()) {
    byte[][] pathComponents=FSDirectory.getPathComponentsForReservedPath(srcArg);
    String src=srcArg;
    writeLock();
    final long now=now();
    try {
      checkOperation(OperationCategory.WRITE);
      src=dir.resolvePath(pc,srcArg,pathComponents);
      final INodesInPath iip=dir.getINodesInPath(src,true);
      INode inode=iip.getLastINode();
      boolean updateAccessTime=inode != null && now > inode.getAccessTime() + getAccessTimePrecision();
      if (!isInSafeMode() && updateAccessTime) {
        boolean changed=FSDirAttrOp.setTimes(dir,inode,-1,now,false,iip.getLatestSnapshotId());
        if (changed) {
          getEditLog().logTimes(src,-1,now);
        }
      }
    }
 catch (    Throwable e) {
      LOG.warn("Failed to update the access time of " + src,e);
    }
 finally {
      writeUnlock();
    }
  }
  LocatedBlocks blocks=res.blocks;
  if (blocks != null) {
    blockManager.getDatanodeManager().sortLocatedBlocks(clientMachine,blocks.getLocatedBlocks());
    LocatedBlock lastBlock=blocks.getLastLocatedBlock();
    if (lastBlock != null) {
      ArrayList<LocatedBlock> lastBlockList=Lists.newArrayList(lastBlock);
      blockManager.getDatanodeManager().sortLocatedBlocks(clientMachine,lastBlockList);
    }
  }
  return blocks;
}
