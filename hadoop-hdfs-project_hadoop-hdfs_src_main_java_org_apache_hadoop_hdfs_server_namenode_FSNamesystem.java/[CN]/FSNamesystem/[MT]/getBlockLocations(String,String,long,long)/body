{
  LocatedBlocks blocks=getBlockLocations(src,offset,length,true,true,true);
  if (blocks != null) {
    blockManager.getDatanodeManager().sortLocatedBlocks(clientMachine,blocks.getLocatedBlocks());
    LocatedBlock lastBlock=blocks.getLastLocatedBlock();
    if (lastBlock != null) {
      ArrayList<LocatedBlock> lastBlockList=new ArrayList<LocatedBlock>();
      lastBlockList.add(lastBlock);
      blockManager.getDatanodeManager().sortLocatedBlocks(clientMachine,lastBlockList);
    }
    for (    LocatedBlock lb : blocks.getLocatedBlocks()) {
      cacheReplicationManager.setCachedLocations(lb);
    }
  }
  return blocks;
}
