{
  LOG.info("Stopping services started for active state");
  writeLock();
  try {
    stopSecretManager();
    leaseManager.stopMonitor();
    if (nnrmthread != null) {
      ((NameNodeResourceMonitor)nnrmthread.getRunnable()).stopMonitor();
      nnrmthread.interrupt();
    }
    if (nnEditLogRoller != null) {
      ((NameNodeEditLogRoller)nnEditLogRoller.getRunnable()).stop();
      nnEditLogRoller.interrupt();
    }
    if (dir != null && dir.fsImage != null) {
      if (dir.fsImage.editLog != null) {
        dir.fsImage.editLog.close();
      }
      dir.fsImage.updateLastAppliedTxIdFromWritten();
    }
    if (cacheManager != null) {
      cacheManager.stopMonitorThread();
      cacheManager.clearDirectiveStats();
    }
    blockManager.getDatanodeManager().clearPendingCachingCommands();
    blockManager.getDatanodeManager().setShouldSendCachingCommands(false);
    blockManager.clearQueues();
    initializedReplQueues=false;
  }
  finally {
    writeUnlock();
  }
}
