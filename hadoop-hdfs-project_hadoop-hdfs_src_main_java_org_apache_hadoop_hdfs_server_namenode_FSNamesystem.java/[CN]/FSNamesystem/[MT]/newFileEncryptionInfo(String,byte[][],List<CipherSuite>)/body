{
  INodesInPath iip=null;
  CipherSuite suite=null;
  KeyVersion latestEZKeyVersion=null;
  readLock();
  try {
    src=FSDirectory.resolvePath(src,pathComponents,dir);
    iip=dir.getINodesInPath4Write(src);
    if (!dir.isInAnEZ(iip)) {
      return null;
    }
    suite=chooseCipherSuite(iip,cipherSuites);
    if (suite != null) {
      Preconditions.checkArgument(!suite.equals(CipherSuite.UNKNOWN),"Chose an UNKNOWN CipherSuite!");
    }
    latestEZKeyVersion=dir.getLatestKeyVersion(iip);
  }
  finally {
    readUnlock();
  }
  if (latestEZKeyVersion == null) {
    latestEZKeyVersion=dir.updateLatestKeyVersion(iip);
  }
  Preconditions.checkState(latestEZKeyVersion != null);
  KeyProviderCryptoExtension.EncryptedKeyVersion edek=null;
  try {
    edek=provider.generateEncryptedKey(latestEZKeyVersion);
  }
 catch (  GeneralSecurityException e) {
    throw new IOException(e);
  }
  Preconditions.checkNotNull(edek);
  return new FileEncryptionInfo(suite,edek.getEncryptedKey().getMaterial(),edek.getIv(),edek.getKeyVersionName());
}
