{
  writeLock();
  try {
    stopSecretManager();
    boolean isEditlogOpenForWrite=getEditLog().isOpenForWrite();
    if (isEditlogOpenForWrite) {
      getEditLog().logSyncAll();
    }
    if (!isInSafeMode()) {
      safeMode=new SafeModeInfo(resourcesLow);
      return;
    }
    if (resourcesLow) {
      safeMode.setResourcesLow();
    }
    safeMode.setManual();
    if (isEditlogOpenForWrite) {
      getEditLog().logSyncAll();
    }
    NameNode.stateChangeLog.info("STATE* Safe mode is ON. " + safeMode.getTurnOffTip());
  }
  finally {
    writeUnlock();
  }
}
