{
  INodeFile node=(INodeFile)file;
  INodeFileUnderConstruction cons=new INodeFileUnderConstruction(node.getLocalNameBytes(),node.getReplication(),node.getModificationTime(),node.getPreferredBlockSize(),node.getBlocks(),node.getPermissionStatus(),leaseHolder,clientMachine,clientNode);
  dir.replaceNode(src,node,cons);
  leaseManager.addLease(cons.getClientName(),src);
  LocatedBlock ret=blockManager.convertLastBlockToUnderConstruction(cons);
  if (writeToEditLog) {
    getEditLog().logOpenFile(src,cons);
  }
  return ret;
}
