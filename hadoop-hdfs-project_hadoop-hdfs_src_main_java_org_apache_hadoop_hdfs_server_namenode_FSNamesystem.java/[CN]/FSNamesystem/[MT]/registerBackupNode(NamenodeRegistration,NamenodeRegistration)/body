{
  writeLock();
  try {
    if (getFSImage().getStorage().getNamespaceID() != bnReg.getNamespaceID())     throw new IOException("Incompatible namespaceIDs: " + " Namenode namespaceID = " + getFSImage().getStorage().getNamespaceID() + "; "+ bnReg.getRole()+ " node namespaceID = "+ bnReg.getNamespaceID());
    if (bnReg.getRole() == NamenodeRole.BACKUP) {
      getFSImage().getEditLog().registerBackupNode(bnReg,nnReg);
    }
  }
  finally {
    writeUnlock();
  }
}
