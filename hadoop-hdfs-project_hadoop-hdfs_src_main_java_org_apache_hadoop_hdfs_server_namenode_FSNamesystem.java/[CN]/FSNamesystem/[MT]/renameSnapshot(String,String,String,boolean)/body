{
  checkOperation(OperationCategory.WRITE);
  boolean success=false;
  writeLock();
  try {
    checkOperation(OperationCategory.WRITE);
    checkNameNodeSafeMode("Cannot rename snapshot for " + path);
    FSDirSnapshotOp.renameSnapshot(dir,snapshotManager,path,snapshotOldName,snapshotNewName,logRetryCache);
    success=true;
  }
  finally {
    writeUnlock();
  }
  getEditLog().logSync();
  String oldSnapshotRoot=Snapshot.getSnapshotPath(path,snapshotOldName);
  String newSnapshotRoot=Snapshot.getSnapshotPath(path,snapshotNewName);
  logAuditEvent(success,"renameSnapshot",oldSnapshotRoot,newSnapshotRoot,null);
}
