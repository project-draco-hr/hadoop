{
  LOG.info("Starting services required for active state");
  writeLock();
  try {
    FSEditLog editLog=dir.fsImage.getEditLog();
    if (!editLog.isSegmentOpen()) {
      editLog.initJournalsForWrite();
      editLog.recoverUnclosedStreams();
      LOG.info("Catching up to latest edits from old active before " + "taking over writer role in edits logs.");
      editLogTailer.catchupDuringFailover();
      long nextTxId=dir.fsImage.getLastAppliedTxId() + 1;
      LOG.info("Will take over writing edit logs at txnid " + nextTxId);
      editLog.setNextTxId(nextTxId);
      dir.fsImage.editLog.openForWrite();
    }
    if (UserGroupInformation.isSecurityEnabled()) {
      startSecretManager();
    }
    leaseManager.startMonitor();
  }
  finally {
    writeUnlock();
  }
}
