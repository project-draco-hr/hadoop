{
  try {
    Metadata metadata=FSDirEncryptionZoneOp.ensureKeyIsInitialized(dir,keyName,src);
    checkSuperuserPrivilege();
    FSPermissionChecker pc=getPermissionChecker();
    checkOperation(OperationCategory.WRITE);
    final HdfsFileStatus resultingStat;
    writeLock();
    try {
      checkSuperuserPrivilege();
      checkOperation(OperationCategory.WRITE);
      checkNameNodeSafeMode("Cannot create encryption zone on " + src);
      resultingStat=FSDirEncryptionZoneOp.createEncryptionZone(dir,src,pc,metadata.getCipher(),keyName,logRetryCache);
    }
  finally {
      writeUnlock();
    }
    getEditLog().logSync();
    logAuditEvent(true,"createEncryptionZone",src,null,resultingStat);
  }
 catch (  AccessControlException e) {
    logAuditEvent(false,"createEncryptionZone",src);
    throw e;
  }
}
