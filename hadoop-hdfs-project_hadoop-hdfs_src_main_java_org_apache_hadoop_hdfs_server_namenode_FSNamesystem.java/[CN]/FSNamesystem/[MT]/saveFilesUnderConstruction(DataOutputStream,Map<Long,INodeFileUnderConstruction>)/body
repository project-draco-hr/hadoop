{
synchronized (leaseManager) {
    Map<String,INodeFileUnderConstruction> nodes=leaseManager.getINodesUnderConstruction();
    for (    Map.Entry<String,INodeFileUnderConstruction> entry : nodes.entrySet()) {
      snapshotUCMap.remove(entry.getValue().getId());
    }
    out.writeInt(nodes.size() + snapshotUCMap.size());
    for (    Map.Entry<String,INodeFileUnderConstruction> entry : nodes.entrySet()) {
      FSImageSerialization.writeINodeUnderConstruction(out,entry.getValue(),entry.getKey());
    }
    for (    Map.Entry<Long,INodeFileUnderConstruction> entry : snapshotUCMap.entrySet()) {
      StringBuilder b=new StringBuilder();
      b.append(FSDirectory.DOT_RESERVED_PATH_PREFIX).append(Path.SEPARATOR).append(FSDirectory.DOT_INODES_STRING).append(Path.SEPARATOR).append(entry.getValue().getId());
      FSImageSerialization.writeINodeUnderConstruction(out,entry.getValue(),b.toString());
    }
  }
}
