{
  LocatedBlock locatedBlock;
  checkOperation(OperationCategory.WRITE);
  writeLock();
  try {
    checkOperation(OperationCategory.WRITE);
    checkUCBlock(block,clientName);
    block.setGenerationStamp(nextGenerationStamp(blockIdManager.isLegacyBlock(block.getLocalBlock())));
    locatedBlock=new LocatedBlock(block,new DatanodeInfo[0]);
    blockManager.setBlockToken(locatedBlock,AccessMode.WRITE);
  }
  finally {
    writeUnlock();
  }
  getEditLog().logSync();
  return locatedBlock;
}
