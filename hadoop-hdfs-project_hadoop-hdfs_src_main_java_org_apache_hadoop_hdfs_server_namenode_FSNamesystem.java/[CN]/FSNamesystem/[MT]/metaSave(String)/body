{
  writeLock();
  try {
    checkSuperuserPrivilege();
    File file=new File(System.getProperty("hadoop.log.dir"),filename);
    PrintWriter out=new PrintWriter(new BufferedWriter(new FileWriter(file,true)));
    long totalInodes=this.dir.totalInodes();
    long totalBlocks=this.getBlocksTotal();
    out.println(totalInodes + " files and directories, " + totalBlocks+ " blocks = "+ (totalInodes + totalBlocks)+ " total");
    final List<DatanodeDescriptor> live=new ArrayList<DatanodeDescriptor>();
    final List<DatanodeDescriptor> dead=new ArrayList<DatanodeDescriptor>();
    blockManager.getDatanodeManager().fetchDatanodes(live,dead,false);
    out.println("Live Datanodes: " + live.size());
    out.println("Dead Datanodes: " + dead.size());
    blockManager.metaSave(out);
    out.flush();
    out.close();
  }
  finally {
    writeUnlock();
  }
}
