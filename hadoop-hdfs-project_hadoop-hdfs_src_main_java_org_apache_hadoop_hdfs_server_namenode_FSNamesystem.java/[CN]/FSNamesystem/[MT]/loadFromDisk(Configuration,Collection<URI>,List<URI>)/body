{
  if (namespaceDirs.size() == 1) {
    LOG.warn("Only one image storage directory (" + DFS_NAMENODE_NAME_DIR_KEY + ") configured. Beware of dataloss"+ " due to lack of redundant storage directories!");
  }
  if (namespaceEditsDirs.size() == 1) {
    LOG.warn("Only one namespace edits storage directory (" + DFS_NAMENODE_EDITS_DIR_KEY + ") configured. Beware of dataloss"+ " due to lack of redundant storage directories!");
  }
  FSImage fsImage=new FSImage(conf,namespaceDirs,namespaceEditsDirs);
  FSNamesystem namesystem=new FSNamesystem(conf,fsImage);
  StartupOption startOpt=NameNode.getStartupOption(conf);
  if (startOpt == StartupOption.RECOVER) {
    namesystem.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
  }
  long loadStart=now();
  String nameserviceId=DFSUtil.getNamenodeNameServiceId(conf);
  namesystem.loadFSImage(startOpt,fsImage,HAUtil.isHAEnabled(conf,nameserviceId));
  long timeTakenToLoadFSImage=now() - loadStart;
  LOG.info("Finished loading FSImage in " + timeTakenToLoadFSImage + " msecs");
  NameNodeMetrics nnMetrics=NameNode.getNameNodeMetrics();
  if (nnMetrics != null) {
    nnMetrics.setFsImageLoadTime((int)timeTakenToLoadFSImage);
  }
  return namesystem;
}
