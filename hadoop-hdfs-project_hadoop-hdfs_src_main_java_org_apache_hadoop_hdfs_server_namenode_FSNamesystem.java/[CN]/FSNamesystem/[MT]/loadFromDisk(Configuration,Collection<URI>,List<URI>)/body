{
  if (namespaceDirs.size() == 1) {
    LOG.warn("Only one " + DFS_NAMENODE_NAME_DIR_KEY + " directory configured , beware data loss!");
  }
  if (namespaceEditsDirs.size() == 1) {
    LOG.warn("Only one " + DFS_NAMENODE_EDITS_DIR_KEY + " directory configured , beware data loss!");
  }
  FSImage fsImage=new FSImage(conf,namespaceDirs,namespaceEditsDirs);
  FSNamesystem namesystem=new FSNamesystem(conf,fsImage);
  long loadStart=now();
  StartupOption startOpt=NameNode.getStartupOption(conf);
  String nameserviceId=DFSUtil.getNamenodeNameServiceId(conf);
  namesystem.loadFSImage(startOpt,fsImage,HAUtil.isHAEnabled(conf,nameserviceId));
  long timeTakenToLoadFSImage=now() - loadStart;
  LOG.info("Finished loading FSImage in " + timeTakenToLoadFSImage + " msecs");
  NameNodeMetrics nnMetrics=NameNode.getNameNodeMetrics();
  if (nnMetrics != null) {
    nnMetrics.setFsImageLoadTime((int)timeTakenToLoadFSImage);
  }
  return namesystem;
}
