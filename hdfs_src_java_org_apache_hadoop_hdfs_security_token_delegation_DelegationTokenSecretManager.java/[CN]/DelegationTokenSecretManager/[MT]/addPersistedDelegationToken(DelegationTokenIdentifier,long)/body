{
  if (running) {
    throw new IOException("Can't add persisted delegation token to a running SecretManager.");
  }
  int keyId=identifier.getMasterKeyId();
  DelegationKey dKey=allKeys.get(keyId);
  if (dKey == null) {
    LOG.warn("No KEY found for persisted identifier " + identifier.toString());
    return;
  }
  byte[] password=createPassword(identifier.getBytes(),dKey.getKey());
  if (identifier.getSequenceNumber() > this.delegationTokenSequenceNumber) {
    this.delegationTokenSequenceNumber=identifier.getSequenceNumber();
  }
  if (currentTokens.get(identifier) == null) {
    currentTokens.put(identifier,new DelegationTokenInformation(expiryTime,password));
  }
 else {
    throw new IOException("Same delegation token being added twice; invalid entry in fsimage or editlogs");
  }
}
