{
  StringWriter output=new StringWriter();
  PrintWriter out=new PrintWriter(output);
  LsrPBImage v=new LsrPBImage(new Configuration(),out);
  v.visit(new RandomAccessFile(originalFsimage,"r"));
  out.close();
  Pattern pattern=Pattern.compile("([d\\-])([rwx\\-]{9})\\s*(-|\\d+)\\s*(\\w+)\\s*(\\w+)\\s*(\\d+)\\s*(\\d+)\\s*([\b/]+)");
  int count=0;
  for (  String s : output.toString().split("\n")) {
    Matcher m=pattern.matcher(s);
    assertTrue(m.find());
    LsElements e=new LsElements();
    e.isDir=m.group(1).equals("d");
    e.perms=m.group(2);
    e.replication=m.group(3).equals("-") ? 0 : Integer.parseInt(m.group(3));
    e.username=m.group(4);
    e.groupname=m.group(5);
    e.filesize=Long.parseLong(m.group(7));
    String path=m.group(8);
    if (!path.equals("/")) {
      compareFiles(writtenFiles.get(path),e);
    }
    ++count;
  }
  assertEquals(writtenFiles.size() + 1,count);
}
