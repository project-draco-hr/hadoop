{
  final String DELIMITER="\t";
  ByteArrayOutputStream output=new ByteArrayOutputStream();
  try (PrintStream o=new PrintStream(output)){
    PBImageDelimitedTextWriter v=new PBImageDelimitedTextWriter(o,DELIMITER,db);
    v.visit(new RandomAccessFile(originalFsimage,"r"));
  }
   Set<String> fileNames=new HashSet<>();
  try (ByteArrayInputStream input=new ByteArrayInputStream(output.toByteArray());BufferedReader reader=new BufferedReader(new InputStreamReader(input))){
    String line;
    boolean header=true;
    while ((line=reader.readLine()) != null) {
      System.out.println(line);
      String[] fields=line.split(DELIMITER);
      assertEquals(12,fields.length);
      if (!header) {
        fileNames.add(fields[0]);
      }
      header=false;
    }
  }
   for (Iterator<String> it=fileNames.iterator(); it.hasNext(); ) {
    String filename=it.next();
    if (filename.startsWith("/dirContainingInvalidXMLChar")) {
      it.remove();
    }
 else     if (filename.equals("/")) {
      it.remove();
    }
  }
  assertEquals(writtenFiles.keySet(),fileNames);
}
