{
  File testFile=new File(ROOT,"/basicCheck");
  File outputFile=new File(ROOT,"/fileDistributionCheckOutput");
  int totalFiles=0;
  BufferedReader reader=null;
  try {
    DFSTestUtil.copyFile(originalFsimage,testFile);
    ImageVisitor v=new FileDistributionVisitor(outputFile.getPath(),0,0);
    OfflineImageViewer oiv=new OfflineImageViewer(testFile.getPath(),v,false);
    oiv.go();
    reader=new BufferedReader(new FileReader(outputFile));
    String line=reader.readLine();
    assertEquals(line,"Size\tNumFiles");
    while ((line=reader.readLine()) != null) {
      String[] row=line.split("\t");
      assertEquals(row.length,2);
      totalFiles+=Integer.parseInt(row[1]);
    }
  }
  finally {
    if (reader != null) {
      reader.close();
    }
    if (testFile.exists())     testFile.delete();
    if (outputFile.exists())     outputFile.delete();
  }
  assertEquals(totalFiles,NUM_DIRS * FILES_PER_DIR);
}
