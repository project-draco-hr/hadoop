{
  String nodeCreatePath=getNodePath(delegationTokensRootPath,DELEGATION_TOKEN_PREFIX + rmDTIdentifier.getSequenceNumber());
  ByteArrayOutputStream seqOs=new ByteArrayOutputStream();
  DataOutputStream seqOut=new DataOutputStream(seqOs);
  RMDelegationTokenIdentifierData identifierData=new RMDelegationTokenIdentifierData(rmDTIdentifier,renewDate);
  try {
    if (LOG.isDebugEnabled()) {
      LOG.debug((isUpdate ? "Storing " : "Updating ") + "RMDelegationToken_" + rmDTIdentifier.getSequenceNumber());
    }
    if (isUpdate) {
      trx.setData(nodeCreatePath,identifierData.toByteArray(),-1);
    }
 else {
      trx.create(nodeCreatePath,identifierData.toByteArray(),zkAcl,CreateMode.PERSISTENT);
      seqOut.writeInt(rmDTIdentifier.getSequenceNumber());
      if (LOG.isDebugEnabled()) {
        LOG.debug((isUpdate ? "Storing " : "Updating ") + dtSequenceNumberPath + ". SequenceNumber: "+ rmDTIdentifier.getSequenceNumber());
      }
      trx.setData(dtSequenceNumberPath,seqOs.toByteArray(),-1);
    }
  }
  finally {
    seqOs.close();
  }
}
