{
  if (connectionContextRead) {
    processRpcRequest(buf);
  }
 else {
    processConnectionContext(buf);
    connectionContextRead=true;
    if (!authorizeConnection()) {
      throw new AccessControlException("Connection from " + this + " for protocol "+ connectionContext.getProtocol()+ " is unauthorized for user "+ user);
    }
  }
}
