{
  RpcSaslProto negotiateMessage=negotiateResponse;
  if (enabledAuthMethods.contains(AuthMethod.TOKEN)) {
    saslServer=createSaslServer(AuthMethod.TOKEN);
    byte[] challenge=saslServer.evaluateResponse(new byte[0]);
    RpcSaslProto.Builder negotiateBuilder=RpcSaslProto.newBuilder(negotiateResponse);
    negotiateBuilder.getAuthsBuilder(0).setChallenge(ByteString.copyFrom(challenge));
    negotiateMessage=negotiateBuilder.build();
  }
  sentNegotiate=true;
  return negotiateMessage;
}
