{
  try {
    if (user != null && user.getRealUser() != null && (authMethod != AuthMethod.TOKEN)) {
      ProxyUsers.authorize(user,this.getHostAddress());
    }
    authorize(user,protocolName,getHostInetAddress());
    if (LOG.isDebugEnabled()) {
      LOG.debug("Successfully authorized " + connectionContext);
    }
    rpcMetrics.incrAuthorizationSuccesses();
  }
 catch (  AuthorizationException ae) {
    LOG.info("Connection from " + this + " for protocol "+ connectionContext.getProtocol()+ " is unauthorized for user "+ user);
    rpcMetrics.incrAuthorizationFailures();
    throw new WrappedRpcServerException(RpcErrorCodeProto.FATAL_UNAUTHORIZED,ae);
  }
}
