def hadoopVersion(hadoopDir, java_home, log):
    hadoopVersion = {'major': None, 'minor': None, }
    hadoopPath = os.path.join(hadoopDir, 'bin', 'hadoop')
    cmd = ('%s version' % hadoopPath)
    log.debug(('Executing command %s to find hadoop version' % cmd))
    env = os.environ
    env['JAVA_HOME'] = java_home
    hadoopVerCmd = simpleCommand('HadoopVersion', cmd, env)
    hadoopVerCmd.start()
    hadoopVerCmd.wait()
    hadoopVerCmd.join()
    if (hadoopVerCmd.exit_code() == 0):
        verLine = hadoopVerCmd.output()[0]
        log.debug(('Version from hadoop command: %s' % verLine))
        hadoopVerRegExp = re.compile('Hadoop ([0-9]+)\\.([0-9]+).*')
        verMatch = hadoopVerRegExp.match(verLine)
        if (verMatch != None):
            hadoopVersion['major'] = verMatch.group(1)
            hadoopVersion['minor'] = verMatch.group(2)
    return hadoopVersion
