{
  if (proxy == null) {
    throw new HadoopIllegalArgumentException("Cannot close proxy since it is null");
  }
  try {
    if (proxy instanceof Closeable) {
      ((Closeable)proxy).close();
      return;
    }
 else {
      InvocationHandler handler=Proxy.getInvocationHandler(proxy);
      if (handler instanceof Closeable) {
        ((Closeable)handler).close();
        return;
      }
    }
  }
 catch (  IOException e) {
    LOG.error("Closing proxy or invocation handler caused exception",e);
  }
catch (  IllegalArgumentException e) {
    LOG.error("RPC.stopProxy called on non proxy.",e);
  }
  throw new HadoopIllegalArgumentException("Cannot close proxy - is not Closeable or " + "does not provide closeable invocation handler " + proxy.getClass());
}
