{
  if (protocol == null) {
    throw new IllegalArgumentException("Null protocol");
  }
  long version;
  ProtocolInfo anno=protocol.getAnnotation(ProtocolInfo.class);
  if (anno != null) {
    version=anno.protocolVersion();
    if (version != -1)     return version;
  }
  try {
    Field versionField=protocol.getField("versionID");
    versionField.setAccessible(true);
    return versionField.getLong(protocol);
  }
 catch (  NoSuchFieldException ex) {
    throw new RuntimeException(ex);
  }
catch (  IllegalAccessException ex) {
    throw new RuntimeException(ex);
  }
}
