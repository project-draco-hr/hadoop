{
  final DatanodeInfo[] infos=client.datanodeReport(type);
  assertEquals(numDatanodes,infos.length);
  final DatanodeStorageReport[] reports=client.getDatanodeStorageReport(type);
  assertEquals(numDatanodes,reports.length);
  for (int i=0; i < infos.length; i++) {
    assertEquals(infos[i],reports[i].getDatanodeInfo());
    final DataNode d=findDatanode(infos[i].getDatanodeUuid(),datanodes);
    if (bpid != null) {
      final StorageReport[] computed=reports[i].getStorageReports();
      Arrays.sort(computed,CMP);
      final StorageReport[] expected=d.getFSDataset().getStorageReports(bpid);
      Arrays.sort(expected,CMP);
      assertEquals(expected.length,computed.length);
      for (int j=0; j < expected.length; j++) {
        assertEquals(expected[j].getStorage().getStorageID(),computed[j].getStorage().getStorageID());
      }
    }
  }
}
