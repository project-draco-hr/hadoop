{
  List<TokenProto> tokensProtos=new ArrayList<TokenProto>(tokens.size());
  for (  Token<BlockTokenIdentifier> t : tokens) {
    tokensProtos.add(PBHelper.convert(t));
  }
  GetHdfsBlockLocationsRequestProto request=GetHdfsBlockLocationsRequestProto.newBuilder().setBlockPoolId(blockPoolId).addAllBlockIds(Longs.asList(blockIds)).addAllTokens(tokensProtos).build();
  GetHdfsBlockLocationsResponseProto response;
  try {
    response=rpcProxy.getHdfsBlockLocations(NULL_CONTROLLER,request);
  }
 catch (  ServiceException e) {
    throw ProtobufHelper.getRemoteException(e);
  }
  List<ByteString> volumeIdsByteStrings=response.getVolumeIdsList();
  List<byte[]> volumeIds=new ArrayList<byte[]>(volumeIdsByteStrings.size());
  for (  ByteString bs : volumeIdsByteStrings) {
    volumeIds.add(bs.toByteArray());
  }
  List<Integer> volumeIndexes=response.getVolumeIndexesList();
  return new HdfsBlocksMetadata(blockPoolId,blockIds,volumeIds,volumeIndexes);
}
