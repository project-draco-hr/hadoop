{
  hdfs.allowSnapshot(sub1.toString());
  hdfs.createSnapshot("s1",sub1.toString());
  final Path file3=new Path(sub1,"file3");
  DFSTestUtil.createFile(hdfs,file3,1024,REPLICATION,seed);
  String[] names=INode.getPathNames(file3.toString());
  byte[][] components=INode.getPathComponents(names);
  INodesInPath nodesInPath=fsdir.rootDir.getExistingPathINodes(components,components.length,false);
  INode[] inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length);
  assertFalse(nodesInPath.isSnapshot());
  assertEquals(nodesInPath.getSnapshotRootIndex(),-1);
  assertEquals(inodes[components.length - 1].getFullPathName(),file3.toString());
  assertEquals(inodes[components.length - 2].getFullPathName(),sub1.toString());
  assertEquals(inodes[components.length - 3].getFullPathName(),dir.toString());
  String snapshotPath=sub1.toString() + "/.snapshot/s1/file3";
  names=INode.getPathNames(snapshotPath);
  components=INode.getPathComponents(names);
  nodesInPath=fsdir.rootDir.getExistingPathINodes(components,components.length,false);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length - 1);
  assertEquals(nodesInPath.getSize(),components.length - 2);
  assertTrue(nodesInPath.isSnapshot());
  assertEquals(nodesInPath.getSnapshotRootIndex(),3);
  assertTrue(inodes[nodesInPath.getSnapshotRootIndex()] instanceof INodeDirectorySnapshotRoot);
  assertNull(inodes[inodes.length - 1]);
  assertTrue(inodes[inodes.length - 2] instanceof INodeDirectorySnapshotRoot);
}
