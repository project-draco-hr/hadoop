{
  ZlibFactory.setCompressionLevel(conf,CompressionLevel.BEST_COMPRESSION);
  ZlibFactory.setCompressionStrategy(conf,CompressionStrategy.DEFAULT_STRATEGY);
  Compressor c1=CodecPool.getCompressor(codec);
  CodecPool.returnCompressor(c1);
  ZlibFactory.setCompressionLevel(conf,CompressionLevel.NO_COMPRESSION);
  Compressor c2=CodecPool.getCompressor(codec,conf);
  assertTrue("Got mismatched ZlibCompressor",c1 == c2);
  ByteArrayOutputStream bos=new ByteArrayOutputStream();
  CompressionOutputStream cos=null;
  byte[] b=new byte[1 << 15];
  Arrays.fill(b,(byte)43);
  try {
    cos=codec.createOutputStream(bos,c2);
    cos.write(b);
  }
  finally {
    if (cos != null) {
      cos.close();
    }
    CodecPool.returnCompressor(c2);
  }
  byte[] outbytes=bos.toByteArray();
  assertTrue("Compressed bytes contrary to configuration",outbytes.length >= b.length);
}
