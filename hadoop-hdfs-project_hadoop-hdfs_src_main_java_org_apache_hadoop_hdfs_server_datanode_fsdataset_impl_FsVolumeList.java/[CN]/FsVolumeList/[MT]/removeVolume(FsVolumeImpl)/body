{
  while (true) {
    final FsVolumeImpl[] curVolumes=volumes.get();
    final List<FsVolumeImpl> volumeList=Lists.newArrayList(curVolumes);
    if (volumeList.remove(target)) {
      if (volumes.compareAndSet(curVolumes,volumeList.toArray(new FsVolumeImpl[volumeList.size()]))) {
        target.shutdown();
        FsDatasetImpl.LOG.info("Removed volume: " + target);
        break;
      }
 else {
        if (FsDatasetImpl.LOG.isDebugEnabled()) {
          FsDatasetImpl.LOG.debug("The volume list has been changed concurrently, " + "retry to remove volume: " + target);
        }
      }
    }
 else {
      if (FsDatasetImpl.LOG.isDebugEnabled()) {
        FsDatasetImpl.LOG.debug("Volume " + target + " does not exist or is removed by others.");
      }
      break;
    }
  }
}
