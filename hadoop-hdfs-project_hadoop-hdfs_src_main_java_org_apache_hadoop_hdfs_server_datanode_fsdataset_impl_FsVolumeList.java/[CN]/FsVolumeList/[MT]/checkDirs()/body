{
synchronized (checkDirsMutex) {
    ArrayList<FsVolumeImpl> removedVols=null;
    final List<FsVolumeImpl> volumeList=getVolumes();
    for (Iterator<FsVolumeImpl> i=volumeList.iterator(); i.hasNext(); ) {
      final FsVolumeImpl fsv=i.next();
      try (FsVolumeReference ref=fsv.obtainReference()){
        fsv.checkDirs();
      }
 catch (      DiskErrorException e) {
        FsDatasetImpl.LOG.warn("Removing failed volume " + fsv + ": ",e);
        if (removedVols == null) {
          removedVols=new ArrayList<>(1);
        }
        removedVols.add(fsv);
        removeVolume(fsv);
        numFailedVolumes++;
      }
catch (      ClosedChannelException e) {
        FsDatasetImpl.LOG.debug("Caught exception when obtaining " + "reference count on closed volume",e);
      }
catch (      IOException e) {
        FsDatasetImpl.LOG.error("Unexpected IOException",e);
      }
    }
    if (removedVols != null && removedVols.size() > 0) {
      FsDatasetImpl.LOG.warn("Completed checkDirs. Removed " + removedVols.size() + " volumes. Current volumes: "+ this);
    }
    return removedVols;
  }
}
