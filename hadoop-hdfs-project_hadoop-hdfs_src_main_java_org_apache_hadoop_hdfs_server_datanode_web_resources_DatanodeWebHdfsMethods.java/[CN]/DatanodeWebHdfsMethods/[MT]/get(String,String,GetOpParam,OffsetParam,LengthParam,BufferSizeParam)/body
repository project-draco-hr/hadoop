{
  final DataNode datanode=(DataNode)context.getAttribute("datanode");
  final Configuration conf=new Configuration(datanode.getConf());
switch (op.getValue()) {
case OPEN:
{
      final int b=bufferSize.getValue(conf);
      final DFSClient dfsclient=newDfsClient(nnId,conf);
      HdfsDataInputStream in=null;
      try {
        in=new HdfsDataInputStream(dfsclient.open(fullpath,b,true));
        in.seek(offset.getValue());
      }
 catch (      IOException ioe) {
        IOUtils.cleanup(LOG,in);
        IOUtils.cleanup(LOG,dfsclient);
        throw ioe;
      }
      final long n=length.getValue() != null ? Math.min(length.getValue(),in.getVisibleLength() - offset.getValue()) : in.getVisibleLength() - offset.getValue();
      int outBufferSize=response.getBufferSize();
      if (n > Integer.MAX_VALUE) {
        outBufferSize-=12;
      }
      return Response.ok(new OpenEntity(in,n,outBufferSize,dfsclient)).type(MediaType.APPLICATION_OCTET_STREAM).header("Access-Control-Allow-Methods","GET").header("Access-Control-Allow-Origin","*").build();
    }
case GETFILECHECKSUM:
{
    MD5MD5CRC32FileChecksum checksum=null;
    DFSClient dfsclient=newDfsClient(nnId,conf);
    try {
      checksum=dfsclient.getFileChecksum(fullpath,Long.MAX_VALUE);
      dfsclient.close();
      dfsclient=null;
    }
  finally {
      IOUtils.cleanup(LOG,dfsclient);
    }
    final String js=JsonUtil.toJsonString(checksum);
    return Response.ok(js).type(MediaType.APPLICATION_JSON).build();
  }
default :
throw new UnsupportedOperationException(op + " is not supported");
}
}
