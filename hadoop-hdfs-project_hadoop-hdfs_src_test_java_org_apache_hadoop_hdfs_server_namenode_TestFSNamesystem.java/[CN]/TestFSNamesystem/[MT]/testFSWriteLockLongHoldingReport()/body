{
  final long writeLockReportingThreshold=100L;
  final long writeLockSuppressWarningInterval=10000L;
  Configuration conf=new Configuration();
  conf.setLong(DFSConfigKeys.DFS_NAMENODE_WRITE_LOCK_REPORTING_THRESHOLD_MS_KEY,writeLockReportingThreshold);
  conf.setTimeDuration(DFSConfigKeys.DFS_LOCK_SUPPRESS_WARNING_INTERVAL_KEY,writeLockSuppressWarningInterval,TimeUnit.MILLISECONDS);
  FSImage fsImage=Mockito.mock(FSImage.class);
  FSEditLog fsEditLog=Mockito.mock(FSEditLog.class);
  Mockito.when(fsImage.getEditLog()).thenReturn(fsEditLog);
  FSNamesystem fsn=new FSNamesystem(conf,fsImage);
  FakeTimer timer=new FakeTimer();
  fsn.setTimer(timer);
  timer.advance(writeLockSuppressWarningInterval);
  LogCapturer logs=LogCapturer.captureLogs(FSNamesystem.LOG);
  GenericTestUtils.setLogLevel(FSNamesystem.LOG,Level.INFO);
  fsn.writeLock();
  fsn.writeUnlock();
  assertFalse(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  fsn.writeLock();
  timer.advance(writeLockReportingThreshold + 10);
  logs.clearOutput();
  fsn.writeUnlock();
  assertTrue(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  fsn.writeLockInterruptibly();
  timer.advance(writeLockReportingThreshold + 10);
  logs.clearOutput();
  fsn.writeUnlock();
  assertFalse(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  fsn.writeLock();
  timer.advance(writeLockReportingThreshold / 2 + 1);
  fsn.writeLockInterruptibly();
  timer.advance(writeLockReportingThreshold / 2 + 1);
  fsn.writeLock();
  timer.advance(writeLockReportingThreshold / 2);
  logs.clearOutput();
  fsn.writeUnlock();
  assertFalse(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  logs.clearOutput();
  fsn.writeUnlock();
  assertFalse(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  logs.clearOutput();
  fsn.writeUnlock();
  assertFalse(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  timer.advance(writeLockSuppressWarningInterval);
  fsn.writeLock();
  timer.advance(writeLockReportingThreshold + 100);
  logs.clearOutput();
  fsn.writeUnlock();
  assertTrue(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  assertTrue(logs.getOutput().contains("Number of suppressed write-lock " + "reports: 2"));
}
