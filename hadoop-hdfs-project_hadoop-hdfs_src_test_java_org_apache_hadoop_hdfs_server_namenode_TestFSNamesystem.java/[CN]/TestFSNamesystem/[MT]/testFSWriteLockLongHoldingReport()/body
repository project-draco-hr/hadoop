{
  final long writeLockReportingThreshold=100L;
  Configuration conf=new Configuration();
  conf.setLong(DFSConfigKeys.DFS_NAMENODE_WRITE_LOCK_REPORTING_THRESHOLD_MS_KEY,writeLockReportingThreshold);
  FSImage fsImage=Mockito.mock(FSImage.class);
  FSEditLog fsEditLog=Mockito.mock(FSEditLog.class);
  Mockito.when(fsImage.getEditLog()).thenReturn(fsEditLog);
  FSNamesystem fsn=new FSNamesystem(conf,fsImage);
  LogCapturer logs=LogCapturer.captureLogs(FSNamesystem.LOG);
  GenericTestUtils.setLogLevel(FSNamesystem.LOG,Level.INFO);
  fsn.writeLock();
  Thread.sleep(writeLockReportingThreshold / 2);
  fsn.writeUnlock();
  assertFalse(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  fsn.writeLock();
  Thread.sleep(writeLockReportingThreshold + 10);
  logs.clearOutput();
  fsn.writeUnlock();
  assertTrue(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  fsn.writeLockInterruptibly();
  Thread.sleep(writeLockReportingThreshold + 10);
  logs.clearOutput();
  fsn.writeUnlock();
  assertTrue(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  fsn.writeLock();
  Thread.sleep(writeLockReportingThreshold / 2 + 1);
  fsn.writeLockInterruptibly();
  Thread.sleep(writeLockReportingThreshold / 2 + 1);
  fsn.writeLock();
  Thread.sleep(writeLockReportingThreshold / 2);
  logs.clearOutput();
  fsn.writeUnlock();
  assertFalse(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  logs.clearOutput();
  fsn.writeUnlock();
  assertFalse(logs.getOutput().contains(GenericTestUtils.getMethodName()));
  logs.clearOutput();
  fsn.writeUnlock();
  assertTrue(logs.getOutput().contains(GenericTestUtils.getMethodName()));
}
