{
  if (StringUtils.equalsIgnoreCase("binary",processor)) {
    return new BinaryEditsVisitor(filename);
  }
  OfflineEditsVisitor vis;
  OutputStream fout=new FileOutputStream(filename);
  OutputStream out=null;
  try {
    if (!printToScreen) {
      out=fout;
    }
 else {
      OutputStream outs[]=new OutputStream[2];
      outs[0]=fout;
      outs[1]=System.out;
      out=new TeeOutputStream(outs);
    }
    if (StringUtils.equalsIgnoreCase("xml",processor)) {
      vis=new XmlEditsVisitor(out);
    }
 else     if (StringUtils.equalsIgnoreCase("stats",processor)) {
      vis=new StatisticsEditsVisitor(out);
    }
 else {
      throw new IOException("Unknown proccesor " + processor + " (valid processors: xml, binary, stats)");
    }
    out=fout=null;
    return vis;
  }
  finally {
    IOUtils.closeStream(fout);
    IOUtils.closeStream(out);
  }
}
