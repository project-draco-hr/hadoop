{
  int totalReal=countRealBlocks(block_map);
  System.out.println("countRealBlocks counted " + totalReal + " blocks");
  int totalNN=countNNBlocks(block_map,fn,fs);
  System.out.println("countNNBlocks counted " + totalNN + " blocks");
  for (  String bid : block_map.keySet()) {
    BlockLocs bl=block_map.get(bid);
    assertEquals("Num files should match num locations",bl.num_files,bl.num_locs);
  }
  assertEquals("Num physical blocks should match num stored in the NN",totalReal,totalNN);
  FSNamesystem fsn=cluster.getNamesystem();
  fsn.computeDatanodeWork();
  long underRepl=fsn.getUnderReplicatedBlocks();
  long pendRepl=fsn.getPendingReplicationBlocks();
  long totalRepl=underRepl + pendRepl;
  System.out.println("underreplicated after = " + underRepl + " and pending repl ="+ pendRepl+ "; total underRepl = "+ totalRepl);
  System.out.println("total blocks (real and replicating):" + (totalReal + totalRepl) + " vs. all files blocks "+ blocks_num * 2);
  assertEquals("Incorrect total block count",totalReal + totalRepl,blocks_num * repl);
}
