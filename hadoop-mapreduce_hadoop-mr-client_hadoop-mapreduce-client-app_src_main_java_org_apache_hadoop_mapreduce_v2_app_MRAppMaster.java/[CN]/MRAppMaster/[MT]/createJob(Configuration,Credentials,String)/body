{
  Job newJob=new JobImpl(appID,conf,dispatcher.getEventHandler(),taskAttemptListener,jobTokenSecretManager,fsTokens,clock,startCount,completedTasksFromPreviousRun,metrics,user);
  ((RunningAppContext)context).jobs.put(newJob.getID(),newJob);
  dispatcher.register(JobFinishEvent.Type.class,new EventHandler<JobFinishEvent>(){
    @Override public void handle(    JobFinishEvent event){
      try {
        Thread.sleep(5000);
      }
 catch (      InterruptedException e) {
        e.printStackTrace();
      }
      LOG.info("Calling stop for all the services");
      try {
        stop();
      }
 catch (      Throwable t) {
        LOG.warn("Graceful stop failed ",t);
      }
      LOG.info("Exiting MR AppMaster..GoodBye!");
      System.exit(0);
    }
  }
);
  return newJob;
}
