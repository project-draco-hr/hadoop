{
  BlockPlacementPolicyWithUpgradeDomain upgradeDomainPolicy=(BlockPlacementPolicyWithUpgradeDomain)replicator;
  List<DatanodeStorageInfo> first=new ArrayList<>();
  List<DatanodeStorageInfo> second=new ArrayList<>();
  List<StorageType> excessTypes=new ArrayList<>();
  excessTypes.add(StorageType.DEFAULT);
  first.add(storages[0]);
  first.add(storages[1]);
  second.add(storages[4]);
  second.add(storages[8]);
  DatanodeStorageInfo chosenStorage=upgradeDomainPolicy.chooseReplicaToDelete(null,null,(short)3,first,second,excessTypes);
  assertEquals(chosenStorage,storages[1]);
  first.clear();
  second.clear();
  excessTypes.add(StorageType.DEFAULT);
  first.add(storages[0]);
  first.add(storages[1]);
  first.add(storages[4]);
  first.add(storages[5]);
  chosenStorage=upgradeDomainPolicy.chooseReplicaToDelete(null,null,(short)3,first,second,excessTypes);
  assertTrue(chosenStorage.equals(storages[1]) || chosenStorage.equals(storages[4]));
}
