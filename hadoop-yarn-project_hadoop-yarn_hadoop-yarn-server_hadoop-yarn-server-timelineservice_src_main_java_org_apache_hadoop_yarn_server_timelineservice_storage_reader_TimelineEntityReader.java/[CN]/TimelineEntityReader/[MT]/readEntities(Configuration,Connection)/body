{
  validateParams();
  augmentParams(hbaseConf,conn);
  NavigableSet<TimelineEntity> entities=new TreeSet<>();
  FilterList filterList=createFilterList();
  if (LOG.isDebugEnabled() && filterList != null) {
    LOG.debug("FilterList created for scan is - " + filterList);
  }
  ResultScanner results=getResults(hbaseConf,conn,filterList);
  try {
    for (    Result result : results) {
      TimelineEntity entity=parseEntity(result);
      if (entity == null) {
        continue;
      }
      entities.add(entity);
      if (!sortedKeys) {
        if (entities.size() > filters.getLimit()) {
          entities.pollLast();
        }
      }
 else {
        if (entities.size() == filters.getLimit()) {
          break;
        }
      }
    }
    return entities;
  }
  finally {
    results.close();
  }
}
