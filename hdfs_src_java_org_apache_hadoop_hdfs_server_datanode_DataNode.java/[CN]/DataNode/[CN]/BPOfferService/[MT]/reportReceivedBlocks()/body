{
  Block[] blockArray=null;
  String[] delHintArray=null;
synchronized (receivedBlockList) {
synchronized (delHints) {
      int numBlocks=receivedBlockList.size();
      if (numBlocks > 0) {
        if (numBlocks != delHints.size()) {
          LOG.warn("Panic: receiveBlockList and delHints are not of " + "the same length");
        }
        blockArray=receivedBlockList.toArray(new Block[numBlocks]);
        delHintArray=delHints.toArray(new String[numBlocks]);
      }
    }
  }
  if (blockArray != null) {
    if (delHintArray == null || delHintArray.length != blockArray.length) {
      LOG.warn("Panic: block array & delHintArray are not the same");
    }
    bpNamenode.blockReceived(bpRegistration,blockPoolId,blockArray,delHintArray);
synchronized (receivedBlockList) {
synchronized (delHints) {
        for (int i=0; i < blockArray.length; i++) {
          receivedBlockList.remove(blockArray[i]);
          delHints.remove(delHintArray[i]);
        }
      }
    }
  }
}
