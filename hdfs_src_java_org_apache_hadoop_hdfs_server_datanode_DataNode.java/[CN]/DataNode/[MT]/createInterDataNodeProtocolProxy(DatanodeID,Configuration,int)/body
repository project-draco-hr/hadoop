{
  final InetSocketAddress addr=NetUtils.createSocketAddr(datanodeid.getHost() + ":" + datanodeid.getIpcPort());
  if (InterDatanodeProtocol.LOG.isDebugEnabled()) {
    InterDatanodeProtocol.LOG.debug("InterDatanodeProtocol addr=" + addr);
  }
  UserGroupInformation loginUgi=UserGroupInformation.getLoginUser();
  try {
    return loginUgi.doAs(new PrivilegedExceptionAction<InterDatanodeProtocol>(){
      public InterDatanodeProtocol run() throws IOException {
        return (InterDatanodeProtocol)RPC.getProxy(InterDatanodeProtocol.class,InterDatanodeProtocol.versionID,addr,UserGroupInformation.getCurrentUser(),conf,NetUtils.getDefaultSocketFactory(conf),socketTimeout);
      }
    }
);
  }
 catch (  InterruptedException ie) {
    throw new IOException(ie.getMessage());
  }
}
