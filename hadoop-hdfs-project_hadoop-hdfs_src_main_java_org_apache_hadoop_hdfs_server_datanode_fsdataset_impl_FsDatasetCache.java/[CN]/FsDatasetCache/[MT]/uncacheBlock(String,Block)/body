{
  MappableBlock mapBlock=cachedBlocks.get(block.getBlockId());
  if (mapBlock != null && mapBlock.getBlockPoolId().equals(bpid) && mapBlock.getBlock().equals(block)) {
    mapBlock.close();
    cachedBlocks.remove(mapBlock);
    long bytes=mapBlock.getNumBytes();
    long used=usedBytes.get();
    while (!usedBytes.compareAndSet(used,used - bytes)) {
      used=usedBytes.get();
    }
  }
}
