{
  cluster.getMaterializedReplica(0,block).truncateData(10);
  DataNodeTestUtils.runDirectoryScanner(cluster.getDataNodes().get(0));
  DataNodeProperties dnProps=cluster.stopDataNode(0);
  for (int dirIndex=0; dirIndex < 2; dirIndex++) {
    final String bpid=cluster.getNamesystem().getBlockPoolId();
    File storageDir=cluster.getStorageDir(dnIndex,dirIndex);
    File dataDir=MiniDFSCluster.getFinalizedDir(storageDir,bpid);
    File scanLogFile=new File(dataDir,"dncp_block_verification.log.curr");
    if (scanLogFile.exists()) {
      for (int i=0; !scanLogFile.delete(); i++) {
        assertTrue("Could not delete log file in one minute",i < 60);
        try {
          Thread.sleep(1000);
        }
 catch (        InterruptedException ignored) {
        }
      }
    }
  }
  cluster.restartDataNode(dnProps);
}
