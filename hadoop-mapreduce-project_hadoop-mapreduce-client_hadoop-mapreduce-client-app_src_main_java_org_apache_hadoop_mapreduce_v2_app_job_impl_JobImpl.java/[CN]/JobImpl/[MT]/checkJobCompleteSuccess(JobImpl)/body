{
  if (job.completedTaskCount == job.tasks.size()) {
    try {
      job.getCommitter().commitJob(job.getJobContext());
    }
 catch (    IOException e) {
      LOG.error("Could not do commit for Job",e);
      job.addDiagnostic("Job commit failed: " + e.getMessage());
      job.abortJob(org.apache.hadoop.mapreduce.JobStatus.State.FAILED);
      return job.finished(JobStateInternal.FAILED);
    }
    job.logJobHistoryFinishedEvent();
    return job.finished(JobStateInternal.SUCCEEDED);
  }
  return null;
}
