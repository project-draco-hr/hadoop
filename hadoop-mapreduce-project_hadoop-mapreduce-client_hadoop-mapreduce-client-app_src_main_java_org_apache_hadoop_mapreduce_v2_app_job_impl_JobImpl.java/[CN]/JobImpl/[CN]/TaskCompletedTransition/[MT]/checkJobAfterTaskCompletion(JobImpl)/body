{
  if (job.failedMapTaskCount * 100 > job.allowedMapFailuresPercent * job.numMapTasks || job.failedReduceTaskCount * 100 > job.allowedReduceFailuresPercent * job.numReduceTasks) {
    job.setFinishTime();
    String diagnosticMsg="Job failed as tasks failed. " + "failedMaps:" + job.failedMapTaskCount + " failedReduces:"+ job.failedReduceTaskCount;
    LOG.info(diagnosticMsg);
    job.addDiagnostic(diagnosticMsg);
    job.eventHandler.handle(new CommitterJobAbortEvent(job.jobId,job.jobContext,org.apache.hadoop.mapreduce.JobStatus.State.FAILED));
    return JobStateInternal.FAIL_ABORT;
  }
  return job.checkReadyForCommit();
}
