{
  if (job.failedMapTaskCount * 100 > job.allowedMapFailuresPercent * job.numMapTasks || job.failedReduceTaskCount * 100 > job.allowedReduceFailuresPercent * job.numReduceTasks) {
    job.setFinishTime();
    String diagnosticMsg="Job failed as tasks failed. " + "failedMaps:" + job.failedMapTaskCount + " failedReduces:"+ job.failedReduceTaskCount;
    LOG.info(diagnosticMsg);
    job.addDiagnostic(diagnosticMsg);
    job.abortJob(org.apache.hadoop.mapreduce.JobStatus.State.FAILED);
    return job.finished(JobStateInternal.FAILED);
  }
  JobStateInternal jobCompleteSuccess=JobImpl.checkJobCompleteSuccess(job);
  if (jobCompleteSuccess != null) {
    return jobCompleteSuccess;
  }
  return job.getInternalState();
}
