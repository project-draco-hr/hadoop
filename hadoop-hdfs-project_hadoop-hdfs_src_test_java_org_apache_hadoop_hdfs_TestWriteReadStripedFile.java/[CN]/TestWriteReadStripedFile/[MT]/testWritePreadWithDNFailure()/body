{
  final int failedDNIdx=2;
  final int length=cellSize * (dataBlocks + 2);
  Path testPath=new Path("/foo");
  final byte[] bytes=generateBytes(length);
  DFSTestUtil.writeFile(fs,testPath,new String(bytes));
  BlockLocation[] locs=fs.getFileBlockLocations(testPath,cellSize * 5,cellSize);
  String name=(locs[0].getNames())[failedDNIdx];
  for (  DataNode dn : cluster.getDataNodes()) {
    int port=dn.getXferPort();
    if (name.contains(Integer.toString(port))) {
      dn.shutdown();
      break;
    }
  }
  int startOffsetInFile=cellSize * 5;
  try (FSDataInputStream fsdis=fs.open(testPath)){
    byte[] buf=new byte[length];
    int readLen=fsdis.read(startOffsetInFile,buf,0,buf.length);
    Assert.assertEquals("The length of file should be the same to write size",length - startOffsetInFile,readLen);
    RSRawDecoder rsRawDecoder=new RSRawDecoder(dataBlocks,parityBlocks);
    byte[] expected=new byte[readLen];
    for (int i=startOffsetInFile; i < length; i++) {
      if ((i / cellSize) % dataBlocks == failedDNIdx) {
        expected[i - startOffsetInFile]=(byte)7;
      }
 else {
        expected[i - startOffsetInFile]=getByte(i);
      }
    }
    for (int i=startOffsetInFile; i < length; i++) {
      Assert.assertEquals("Byte at " + i + " should be the same",expected[i - startOffsetInFile],buf[i - startOffsetInFile]);
    }
  }
 }
