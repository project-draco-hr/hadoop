{
  InetSocketAddress nnAddr1=cluster.getNameNode(0).getNameNodeAddress();
  InetSocketAddress nnAddr2=cluster.getNameNode(1).getNameNodeAddress();
  String nameServiceId1=DFSUtil.getNameServiceIdFromAddress(conf,nnAddr1,DFS_NAMENODE_RPC_ADDRESS_KEY);
  String nameServiceId2=DFSUtil.getNameServiceIdFromAddress(conf,nnAddr2,DFS_NAMENODE_RPC_ADDRESS_KEY);
  ClientProtocol nn1=DFSUtil.createNamenode(nnAddr1,conf);
  ClientProtocol nn2=DFSUtil.createNamenode(nnAddr2,conf);
  DFSClient dfsClient1=new DFSClient(null,nn1,conf,null);
  DFSClient dfsClient2=new DFSClient(null,nn2,conf,null);
  OutputStream out1=dfsClient1.create(TEST_FILE.toString(),false);
  OutputStream out2=dfsClient2.create(TEST_FILE.toString(),false);
  AppendTestUtil.write(out1,0,FILE_LENGTH_TO_VERIFY);
  AppendTestUtil.write(out2,0,FILE_LENGTH_TO_VERIFY);
  out1.close();
  out2.close();
  FileSystem fs=configureFailoverFs(cluster,conf);
  AppendTestUtil.check(fs,TEST_FILE,FILE_LENGTH_TO_VERIFY);
  cluster.getNameNode(0).stop();
  AppendTestUtil.check(fs,TEST_FILE,FILE_LENGTH_TO_VERIFY);
  fs.close();
}
