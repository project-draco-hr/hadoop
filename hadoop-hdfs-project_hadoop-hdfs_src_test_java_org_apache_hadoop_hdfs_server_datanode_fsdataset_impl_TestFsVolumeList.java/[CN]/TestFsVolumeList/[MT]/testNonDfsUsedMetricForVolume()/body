{
  File volDir=new File(baseDir,"volume-0");
  volDir.mkdirs();
  long diskCapacity=1000L;
  long duReserved=100L;
  long dfsUsage=200L;
  long actualNonDfsUsage=300L;
  long reservedForReplicas=50L;
  conf.setLong(DFSConfigKeys.DFS_DATANODE_DU_RESERVED_KEY,duReserved);
  FsVolumeImpl volume=new FsVolumeImpl(dataset,"storage-id",volDir,conf,StorageType.DEFAULT);
  FsVolumeImpl spyVolume=Mockito.spy(volume);
  long testCapacity=diskCapacity - duReserved;
  spyVolume.setCapacityForTesting(testCapacity);
  long dfAvailable=diskCapacity - dfsUsage - actualNonDfsUsage;
  Mockito.doReturn(dfAvailable).when(spyVolume).getDfAvailable();
  Mockito.doReturn(dfsUsage).when(spyVolume).getDfsUsed();
  Mockito.doReturn(reservedForReplicas).when(spyVolume).getReservedForReplicas();
  Mockito.doReturn(actualNonDfsUsage).when(spyVolume).getActualNonDfsUsed();
  long expectedNonDfsUsage=actualNonDfsUsage - duReserved;
  assertEquals(expectedNonDfsUsage,spyVolume.getNonDfsUsed());
}
