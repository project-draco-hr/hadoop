{
  writeLock.lock();
  try {
    Metadata meta=getMetadata(name);
    if (meta == null) {
      throw new IOException("Key " + name + " not found");
    }
    if (meta.getBitLength() != 8 * material.length) {
      throw new IOException("Wrong key length. Required " + meta.getBitLength() + ", but got "+ (8 * material.length));
    }
    int nextVersion=meta.addVersion();
    String versionName=buildVersionName(name,nextVersion);
    return innerSetKeyVersion(versionName,material,meta.getCipher());
  }
  finally {
    writeLock.unlock();
  }
}
