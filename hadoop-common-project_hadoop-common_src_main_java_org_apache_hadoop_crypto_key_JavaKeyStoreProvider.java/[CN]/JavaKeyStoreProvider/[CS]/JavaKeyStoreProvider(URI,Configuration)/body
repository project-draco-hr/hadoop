{
  super(conf);
  this.uri=uri;
  path=ProviderUtils.unnestUri(uri);
  fs=path.getFileSystem(conf);
  if (System.getenv().containsKey(KEYSTORE_PASSWORD_ENV_VAR)) {
    password=System.getenv(KEYSTORE_PASSWORD_ENV_VAR).toCharArray();
  }
  if (password == null) {
    String pwFile=conf.get(KEYSTORE_PASSWORD_FILE_KEY);
    if (pwFile != null) {
      ClassLoader cl=Thread.currentThread().getContextClassLoader();
      URL pwdFile=cl.getResource(pwFile);
      if (pwdFile == null) {
        throw new IOException("Password file does not exists");
      }
      try (InputStream is=pwdFile.openStream()){
        password=IOUtils.toString(is).trim().toCharArray();
      }
     }
  }
  if (password == null) {
    password=KEYSTORE_PASSWORD_DEFAULT;
  }
  try {
    Path oldPath=constructOldPath(path);
    Path newPath=constructNewPath(path);
    keyStore=KeyStore.getInstance(SCHEME_NAME);
    FsPermission perm=null;
    if (fs.exists(path)) {
      if (fs.exists(newPath)) {
        throw new IOException(String.format("Keystore not loaded due to some inconsistency " + "('%s' and '%s' should not exist together)!!",path,newPath));
      }
      perm=tryLoadFromPath(path,oldPath);
    }
 else {
      perm=tryLoadIncompleteFlush(oldPath,newPath);
    }
    permissions=perm;
  }
 catch (  KeyStoreException e) {
    throw new IOException("Can't create keystore",e);
  }
catch (  NoSuchAlgorithmException e) {
    throw new IOException("Can't load keystore " + path,e);
  }
catch (  CertificateException e) {
    throw new IOException("Can't load keystore " + path,e);
  }
  ReadWriteLock lock=new ReentrantReadWriteLock(true);
  readLock=lock.readLock();
  writeLock=lock.writeLock();
}
