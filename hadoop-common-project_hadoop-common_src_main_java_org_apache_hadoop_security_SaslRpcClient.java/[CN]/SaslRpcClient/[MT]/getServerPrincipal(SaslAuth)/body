{
  KerberosInfo krbInfo=SecurityUtil.getKerberosInfo(protocol,conf);
  LOG.debug("Get kerberos info proto:" + protocol + " info:"+ krbInfo);
  if (krbInfo == null) {
    return null;
  }
  String serverKey=krbInfo.serverPrincipal();
  if (serverKey == null) {
    throw new IllegalArgumentException("Can't obtain server Kerberos config key from protocol=" + protocol.getCanonicalName());
  }
  String confPrincipal=SecurityUtil.getServerPrincipal(conf.get(serverKey),serverAddr.getAddress());
  if (confPrincipal == null || confPrincipal.isEmpty()) {
    throw new IllegalArgumentException("Failed to specify server's Kerberos principal name");
  }
  KerberosName name=new KerberosName(confPrincipal);
  if (name.getHostName() == null) {
    throw new IllegalArgumentException("Kerberos principal name does NOT have the expected hostname part: " + confPrincipal);
  }
  KerberosPrincipal serverPrincipal=new KerberosPrincipal(authType.getProtocol() + "/" + authType.getServerId());
  if (!serverPrincipal.getName().equals(confPrincipal)) {
    throw new IllegalArgumentException("Server has invalid Kerberos principal: " + serverPrincipal);
  }
  return confPrincipal;
}
