{
  KerberosInfo krbInfo=SecurityUtil.getKerberosInfo(protocol,conf);
  LOG.debug("Get kerberos info proto:" + protocol + " info:"+ krbInfo);
  if (krbInfo == null) {
    return null;
  }
  String serverKey=krbInfo.serverPrincipal();
  if (serverKey == null) {
    throw new IllegalArgumentException("Can't obtain server Kerberos config key from protocol=" + protocol.getCanonicalName());
  }
  String serverPrincipal=new KerberosPrincipal(authType.getProtocol() + "/" + authType.getServerId()).getName();
  boolean isPrincipalValid=false;
  String serverKeyPattern=conf.get(serverKey + ".pattern");
  if (serverKeyPattern != null && !serverKeyPattern.isEmpty()) {
    Pattern pattern=GlobPattern.compile(serverKeyPattern);
    isPrincipalValid=pattern.matcher(serverPrincipal).matches();
  }
 else {
    String confPrincipal=SecurityUtil.getServerPrincipal(conf.get(serverKey),serverAddr.getAddress());
    if (LOG.isDebugEnabled()) {
      LOG.debug("getting serverKey: " + serverKey + " conf value: "+ conf.get(serverKey)+ " principal: "+ confPrincipal);
    }
    if (confPrincipal == null || confPrincipal.isEmpty()) {
      throw new IllegalArgumentException("Failed to specify server's Kerberos principal name");
    }
    KerberosName name=new KerberosName(confPrincipal);
    if (name.getHostName() == null) {
      throw new IllegalArgumentException("Kerberos principal name does NOT have the expected hostname part: " + confPrincipal);
    }
    isPrincipalValid=serverPrincipal.equals(confPrincipal);
  }
  if (!isPrincipalValid) {
    throw new IllegalArgumentException("Server has invalid Kerberos principal: " + serverPrincipal);
  }
  return serverPrincipal;
}
