{
  AWSCredentialProviderList credentials=new AWSCredentialProviderList();
  Class<?>[] awsClasses;
  try {
    awsClasses=conf.getClasses(AWS_CREDENTIALS_PROVIDER);
  }
 catch (  RuntimeException e) {
    Throwable c=e.getCause() != null ? e.getCause() : e;
    throw new IOException("From option " + AWS_CREDENTIALS_PROVIDER + ' '+ c,c);
  }
  if (awsClasses.length == 0) {
    S3xLoginHelper.Login creds=getAWSAccessKeys(binding,conf);
    credentials.add(new BasicAWSCredentialsProvider(creds.getUser(),creds.getPassword()));
    credentials.add(new EnvironmentVariableCredentialsProvider());
    credentials.add(new InstanceProfileCredentialsProvider());
  }
 else {
    for (    Class<?> aClass : awsClasses) {
      credentials.add(createAWSCredentialProvider(conf,aClass,fsURI));
    }
  }
  return credentials;
}
