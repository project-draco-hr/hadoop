{
  Configuration myConf=new Configuration(mrCluster.getConfig());
  myConf.setInt(MRJobConfig.NUM_MAPS,1);
  myConf.setInt(MRJobConfig.MAP_MAX_ATTEMPTS,2);
  Job job=new Job(myConf);
  job.setJarByClass(FailingMapper.class);
  job.setJobName("failmapper");
  job.setOutputKeyClass(Text.class);
  job.setOutputValueClass(Text.class);
  job.setInputFormatClass(RandomInputFormat.class);
  job.setOutputFormatClass(TextOutputFormat.class);
  job.setMapperClass(FailingMapper.class);
  job.setNumReduceTasks(0);
  FileOutputFormat.setOutputPath(job,new Path(mrCluster.getTestWorkDir().getAbsolutePath(),"failmapper-output"));
  job.addFileToClassPath(APP_JAR);
  boolean succeeded=job.waitForCompletion(true);
  Assert.assertFalse(succeeded);
  return job;
}
