{
  OutputStream out=null;
  try {
    if (featureRedirectOff) {
      AppendADLNoRedirectParam skipRedirect=new AppendADLNoRedirectParam(true);
      Param<?,?>[] tmpParam=featureFlushWhenEOF ? new Param<?,?>[parameters.length + 3] : new Param<?,?>[parameters.length + 1];
      System.arraycopy(parameters,0,tmpParam,0,parameters.length);
      tmpParam[parameters.length]=skipRedirect;
      if (featureFlushWhenEOF) {
        tmpParam[parameters.length + 1]=new ADLFlush(endOfFile);
        tmpParam[parameters.length + 2]=new OffsetParam(length);
      }
      out=new FsPathOutputStreamRunner(ADLPostOpParam.Op.APPEND,fsPath,len,tmpParam).run();
    }
 else {
      out=new FsPathOutputStreamRunner(ADLPostOpParam.Op.APPEND,fsPath,len,parameters).run();
    }
    if (buffer != null) {
      out.write(buffer,off,len);
      length+=len;
    }
  }
  finally {
    if (out != null) {
      out.close();
    }
  }
}
