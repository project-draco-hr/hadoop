{
  if (!canRun()) {
    return;
  }
  Configuration conf2=new Configuration(conf);
  conf2.set(MRConfig.LOCAL_DIR,ROOT_MAPRED_LOCAL_DIR.toString());
  conf2.setLong(TTConfig.TT_LOCAL_CACHE_SIZE,21 * 1024l);
  conf2.setLong(TTConfig.TT_LOCAL_CACHE_SUBDIRS_LIMIT,3);
  conf2.setFloat(TTConfig.TT_LOCAL_CACHE_KEEP_AROUND_PCT,0.75f);
  conf2.setLong(TTConfig.TT_DISTRIBUTED_CACHE_CHECK_PERIOD,CACHE_DELETE_PERIOD_MS);
  refreshConf(conf2);
  TrackerDistributedCacheManager manager=new TrackerDistributedCacheManager(conf2,taskController);
  manager.startCleanupThread();
  FileSystem localfs=FileSystem.getLocal(conf2);
  String userName=getJobOwnerName();
  conf2.set(MRJobConfig.USER_NAME,userName);
  Path thirdCacheFile=new Path(TEST_ROOT_DIR,"thirdcachefile");
  Path fourthCacheFile=new Path(TEST_ROOT_DIR,"fourthcachefile");
  createTempFile(thirdCacheFile,1);
  createTempFile(fourthCacheFile,1);
  Path firstLocalCache=manager.getLocalCache(firstCacheFile.toUri(),conf2,TaskTracker.getPrivateDistributedCacheDir(userName),fs.getFileStatus(firstCacheFile),false,getFileStamp(firstCacheFile),new Path(TEST_ROOT_DIR),false,false);
  Path secondLocalCache=manager.getLocalCache(secondCacheFile.toUri(),conf2,TaskTracker.getPrivateDistributedCacheDir(userName),fs.getFileStatus(secondCacheFile),false,getFileStamp(secondCacheFile),new Path(TEST_ROOT_DIR),false,false);
  Path thirdLocalCache=manager.getLocalCache(thirdCacheFile.toUri(),conf2,TaskTracker.getPrivateDistributedCacheDir(userName),fs.getFileStatus(thirdCacheFile),false,getFileStamp(thirdCacheFile),new Path(TEST_ROOT_DIR),false,false);
  manager.releaseCache(thirdCacheFile.toUri(),conf2,getFileStamp(thirdCacheFile),TrackerDistributedCacheManager.getLocalizedCacheOwner(false),false);
  manager.releaseCache(secondCacheFile.toUri(),conf2,getFileStamp(secondCacheFile),TrackerDistributedCacheManager.getLocalizedCacheOwner(false),false);
  manager.releaseCache(firstCacheFile.toUri(),conf2,getFileStamp(firstCacheFile),TrackerDistributedCacheManager.getLocalizedCacheOwner(false),false);
  manager.getLocalCache(fourthCacheFile.toUri(),conf2,TaskTracker.getPrivateDistributedCacheDir(userName),fs.getFileStatus(fourthCacheFile),false,getFileStamp(fourthCacheFile),new Path(TEST_ROOT_DIR),false,false);
  checkCacheDeletion(localfs,secondLocalCache,"DistributedCache failed " + "deleting second cache LRU order");
  checkCacheDeletion(localfs,thirdLocalCache,"DistributedCache failed deleting third" + " cache LRU order.");
  checkCacheNOTDeletion(localfs,firstLocalCache,"DistributedCache failed " + "Deleted first cache LRU order.");
  checkCacheNOTDeletion(localfs,fourthCacheFile,"DistributedCache failed " + "Deleted fourth cache LRU order.");
  new File(thirdCacheFile.toString()).delete();
  new File(fourthCacheFile.toString()).delete();
  manager.stopCleanupThread();
}
