{
  ExtendedBlock prevBlock=null;
  for (int jdx=0; jdx < blocksPerFile; jdx++) {
    LocatedBlock loc=nameNode.addBlock(fileName,clientName,prevBlock,null);
    prevBlock=loc.getBlock();
    for (    DatanodeInfo dnInfo : loc.getLocations()) {
      int dnIdx=Arrays.binarySearch(datanodes,dnInfo.getName());
      datanodes[dnIdx].addBlock(loc.getBlock().getLocalBlock());
      nameNode.blockReceived(datanodes[dnIdx].dnRegistration,loc.getBlock().getBlockPoolId(),new Block[]{loc.getBlock().getLocalBlock()},new String[]{""});
    }
  }
  return prevBlock;
}
