{
  ExtendedBlock prevBlock=null;
  for (int jdx=0; jdx < blocksPerFile; jdx++) {
    LocatedBlock loc=nameNodeProto.addBlock(fileName,clientName,prevBlock,null);
    prevBlock=loc.getBlock();
    for (    DatanodeInfo dnInfo : loc.getLocations()) {
      int dnIdx=Arrays.binarySearch(datanodes,dnInfo.getName());
      datanodes[dnIdx].addBlock(loc.getBlock().getLocalBlock());
      nameNodeProto.blockReceivedAndDeleted(datanodes[dnIdx].dnRegistration,loc.getBlock().getBlockPoolId(),new ReceivedDeletedBlockInfo[]{new ReceivedDeletedBlockInfo(loc.getBlock().getLocalBlock(),"")});
    }
  }
  return prevBlock;
}
