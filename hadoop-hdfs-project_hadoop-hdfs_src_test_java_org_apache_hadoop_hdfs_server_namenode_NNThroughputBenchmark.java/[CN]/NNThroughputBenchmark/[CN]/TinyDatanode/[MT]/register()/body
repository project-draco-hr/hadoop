{
  nsInfo=nameNodeProto.versionRequest();
  dnRegistration=new DatanodeRegistration(new DatanodeID(DNS.getDefaultIP("default"),DNS.getDefaultHost("default","default"),"",getNodePort(dnIdx),DFSConfigKeys.DFS_DATANODE_HTTP_DEFAULT_PORT,DFSConfigKeys.DFS_DATANODE_HTTPS_DEFAULT_PORT,DFSConfigKeys.DFS_DATANODE_IPC_DEFAULT_PORT),new DataStorage(nsInfo,""),new ExportedBlockKeys(),VersionInfo.getVersion());
  DataNode.setNewStorageID(dnRegistration);
  dnRegistration=nameNodeProto.registerDatanode(dnRegistration);
  storage=new DatanodeStorage(dnRegistration.getStorageID());
  final StorageBlockReport[] reports={new StorageBlockReport(storage,new BlockListAsLongs(null,null).getBlockListAsLongs())};
  nameNodeProto.blockReport(dnRegistration,nameNode.getNamesystem().getBlockPoolId(),reports);
}
