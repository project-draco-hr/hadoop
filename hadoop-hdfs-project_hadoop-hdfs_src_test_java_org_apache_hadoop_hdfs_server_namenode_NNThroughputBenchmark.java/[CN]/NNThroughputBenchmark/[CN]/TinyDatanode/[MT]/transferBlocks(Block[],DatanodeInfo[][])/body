{
  for (int i=0; i < blocks.length; i++) {
    DatanodeInfo blockTargets[]=xferTargets[i];
    for (int t=0; t < blockTargets.length; t++) {
      DatanodeInfo dnInfo=blockTargets[t];
      DatanodeRegistration receivedDNReg;
      receivedDNReg=new DatanodeRegistration(dnInfo.getIpAddr(),dnInfo.getXferPort());
      receivedDNReg.setStorageInfo(new DataStorage(nsInfo,dnInfo.getStorageID()));
      receivedDNReg.setInfoPort(dnInfo.getInfoPort());
      receivedDNReg.setIpcPort(dnInfo.getIpcPort());
      ReceivedDeletedBlockInfo[] rdBlocks={new ReceivedDeletedBlockInfo(blocks[i],ReceivedDeletedBlockInfo.BlockStatus.RECEIVED_BLOCK,null)};
      StorageReceivedDeletedBlocks[] report={new StorageReceivedDeletedBlocks(receivedDNReg.getStorageID(),rdBlocks)};
      nameNodeProto.blockReceivedAndDeleted(receivedDNReg,nameNode.getNamesystem().getBlockPoolId(),report);
    }
  }
  return blocks.length;
}
