{
  journal.newEpoch(FAKE_NSINFO,1);
  journal.startLogSegment(makeRI(1),1,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
  journal.journal(makeRI(2),1,1,3,QJMTestUtil.createTxnData(1,3));
  try {
    journal.finalizeLogSegment(makeRI(3),1,6);
    fail("did not fail to finalize");
  }
 catch (  JournalOutOfSyncException e) {
    GenericTestUtils.assertExceptionContains("but only written up to txid 3",e);
  }
  journal.close();
  journal=new Journal(conf,TEST_LOG_DIR,JID,StartupOption.REGULAR,mockErrorReporter);
  try {
    journal.finalizeLogSegment(makeRI(4),1,6);
    fail("did not fail to finalize");
  }
 catch (  JournalOutOfSyncException e) {
    GenericTestUtils.assertExceptionContains("disk only contains up to txid 3",e);
  }
}
