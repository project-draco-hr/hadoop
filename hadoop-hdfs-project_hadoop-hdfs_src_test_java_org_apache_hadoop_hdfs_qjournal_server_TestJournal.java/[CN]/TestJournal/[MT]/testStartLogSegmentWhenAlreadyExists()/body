{
  journal.newEpoch(FAKE_NSINFO,1);
  journal.startLogSegment(makeRI(1),1,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
  journal.journal(makeRI(2),1,1,1,QJMTestUtil.createTxnData(1,1));
  journal.startLogSegment(makeRI(3),1,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
  journal.journal(makeRI(4),1,1,1,QJMTestUtil.createTxnData(1,1));
  journal.journal(makeRI(5),1,2,3,QJMTestUtil.createTxnData(2,3));
  try {
    journal.startLogSegment(makeRI(6),1,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
    fail("Did not fail to start log segment which would overwrite " + "an existing one");
  }
 catch (  IllegalStateException ise) {
    GenericTestUtils.assertExceptionContains("seems to contain valid transactions",ise);
  }
  journal.finalizeLogSegment(makeRI(7),1,4);
  try {
    journal.startLogSegment(makeRI(8),1,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
    fail("Did not fail to start log segment which would overwrite " + "an existing one");
  }
 catch (  IllegalStateException ise) {
    GenericTestUtils.assertExceptionContains("have a finalized segment",ise);
  }
}
