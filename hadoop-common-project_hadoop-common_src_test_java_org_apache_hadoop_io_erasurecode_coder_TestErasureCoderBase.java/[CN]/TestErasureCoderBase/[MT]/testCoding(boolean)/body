{
  this.usingDirectBuffer=usingDirectBuffer;
  ErasureCoder encoder=createEncoder();
  ECBlockGroup blockGroup=prepareBlockGroupForEncoding();
  TestBlock[] clonedDataBlocks=cloneBlocksWithData((TestBlock[])blockGroup.getDataBlocks());
  TestBlock[] toEraseBlocks=copyDataBlocksToErase(clonedDataBlocks);
  ErasureCodingStep codingStep;
  try {
    codingStep=encoder.calculateCoding(blockGroup);
    performCodingStep(codingStep);
  }
  finally {
    encoder.release();
  }
  eraseSomeDataBlocks(clonedDataBlocks);
  blockGroup=new ECBlockGroup(clonedDataBlocks,blockGroup.getParityBlocks());
  ErasureCoder decoder=createDecoder();
  try {
    codingStep=decoder.calculateCoding(blockGroup);
    performCodingStep(codingStep);
  }
  finally {
    decoder.release();
  }
  compareAndVerify(toEraseBlocks,codingStep.getOutputBlocks());
}
