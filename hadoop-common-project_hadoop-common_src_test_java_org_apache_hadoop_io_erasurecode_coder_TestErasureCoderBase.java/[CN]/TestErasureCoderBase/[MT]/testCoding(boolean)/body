{
  this.usingDirectBuffer=usingDirectBuffer;
  ErasureEncoder encoder=createEncoder();
  ECBlockGroup blockGroup=prepareBlockGroupForEncoding();
  TestBlock[] clonedDataBlocks=cloneBlocksWithData((TestBlock[])blockGroup.getDataBlocks());
  TestBlock[] toEraseBlocks=copyDataBlocksToErase(clonedDataBlocks);
  ErasureCodingStep codingStep=encoder.encode(blockGroup);
  performCodingStep(codingStep);
  eraseSomeDataBlocks(clonedDataBlocks);
  blockGroup=new ECBlockGroup(clonedDataBlocks,blockGroup.getParityBlocks());
  ErasureDecoder decoder=createDecoder();
  codingStep=decoder.decode(blockGroup);
  performCodingStep(codingStep);
  compareAndVerify(toEraseBlocks,codingStep.getOutputBlocks());
}
