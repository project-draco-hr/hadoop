{
  final FSDataOutputStream out=fs.create(name,false,4096,replication,blocksize);
  try {
    for (long n=length; n > 0; ) {
      ran.nextBytes(buffer);
      final int w=n < buffer.length ? (int)n : buffer.length;
      out.write(buffer,0,w);
      md5.update(buffer,0,w);
      n-=w;
    }
  }
  finally {
    IOUtils.closeStream(out);
  }
  return md5.digest();
}
