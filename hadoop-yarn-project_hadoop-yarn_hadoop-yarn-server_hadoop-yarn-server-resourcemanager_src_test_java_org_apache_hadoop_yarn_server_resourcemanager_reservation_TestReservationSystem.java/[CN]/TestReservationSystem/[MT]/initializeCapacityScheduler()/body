{
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  ReservationSystemTestUtil.setupQueueConfiguration(conf);
  CapacityScheduler cs=Mockito.spy(new CapacityScheduler());
  cs.setConf(conf);
  mockRMContext=ReservationSystemTestUtil.createRMContext(conf);
  cs.setRMContext(mockRMContext);
  try {
    cs.serviceInit(conf);
  }
 catch (  Exception e) {
    Assert.fail(e.getMessage());
  }
  ReservationSystemTestUtil.initializeRMContext(10,cs,mockRMContext);
  return cs;
}
