{
  HttpServer testServer=HttpServerFunctionalTest.createServer("hdfs");
  try {
    testServer.addServlet("GetImage","/getimage",TestGetImageServlet.class);
    testServer.start();
    URL serverURL=HttpServerFunctionalTest.getServerURL(testServer);
    TransferFsImage.timeout=2000;
    try {
      TransferFsImage.getFileClient(serverURL.getAuthority(),"txid=1",null,null,false);
      fail("TransferImage Should fail with timeout");
    }
 catch (    SocketTimeoutException e) {
      assertEquals("Read should timeout","Read timed out",e.getMessage());
    }
  }
  finally {
    if (testServer != null) {
      testServer.stop();
    }
  }
}
