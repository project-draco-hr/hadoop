{
  Configuration conf=new HdfsConfiguration();
  conf.setBoolean(DFS_DATANODE_NON_LOCAL_LAZY_PERSIST,nonLocalLazyPersist == NonLocalLazyPersist.ALLOWED);
  DatanodeRegistration mockDnReg=mock(DatanodeRegistration.class);
  DataNodeMetrics mockMetrics=mock(DataNodeMetrics.class);
  DataNode mockDn=mock(DataNode.class);
  when(mockDn.getConf()).thenReturn(conf);
  DNConf dnConf=new DNConf(mockDn);
  when(mockDn.getDnConf()).thenReturn(dnConf);
  when(mockDn.getMetrics()).thenReturn(mockMetrics);
  when(mockDn.getDNRegistrationForBP("Dummy-pool")).thenReturn(mockDnReg);
  return mockDn;
}
