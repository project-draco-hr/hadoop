{
  DataXceiver xceiverSpy=spy(DataXceiver.create(getMockPeer(locality),getMockDn(nonLocalLazyPersist),mock(DataXceiverServer.class)));
  doReturn(mock(BlockReceiver.class)).when(xceiverSpy).getBlockReceiver(any(ExtendedBlock.class),any(StorageType.class),any(DataInputStream.class),anyString(),anyString(),any(BlockConstructionStage.class),anyLong(),anyLong(),anyLong(),anyString(),any(DatanodeInfo.class),any(DataNode.class),any(DataChecksum.class),any(CachingStrategy.class),captor.capture(),anyBoolean());
  doReturn(mock(DataOutputStream.class)).when(xceiverSpy).getBufferedOutputStream();
  return xceiverSpy;
}
