{
  ApplicationMasterProtocol mockScheduler=mock(ApplicationMasterProtocol.class);
  when(mockScheduler.allocate(isA(AllocateRequest.class))).thenThrow(RPCUtil.getRemoteException(new IOException("forcefail")));
  Configuration conf=new Configuration();
  LocalContainerAllocator lca=new StubbedLocalContainerAllocator(mockScheduler);
  lca.init(conf);
  lca.start();
  try {
    lca.heartbeat();
    Assert.fail("heartbeat was supposed to throw");
  }
 catch (  YarnException e) {
  }
 finally {
    lca.stop();
  }
  conf.setLong(MRJobConfig.MR_AM_TO_RM_WAIT_INTERVAL_MS,0);
  lca=new StubbedLocalContainerAllocator(mockScheduler);
  lca.init(conf);
  lca.start();
  try {
    lca.heartbeat();
    Assert.fail("heartbeat was supposed to throw");
  }
 catch (  YarnRuntimeException e) {
  }
 finally {
    lca.stop();
  }
}
