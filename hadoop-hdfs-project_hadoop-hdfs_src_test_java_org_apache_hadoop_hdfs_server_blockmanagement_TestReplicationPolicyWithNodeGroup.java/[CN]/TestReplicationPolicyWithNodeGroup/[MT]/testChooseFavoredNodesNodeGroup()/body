{
  updateHeartbeatWithUsage(dataNodes[3],2 * HdfsServerConstants.MIN_BLOCKS_FOR_WRITE * BLOCK_SIZE,0L,(HdfsServerConstants.MIN_BLOCKS_FOR_WRITE - 1) * BLOCK_SIZE,0L,0L,0L,0,0);
  DatanodeStorageInfo[] targets;
  List<DatanodeDescriptor> expectedTargets=new ArrayList<DatanodeDescriptor>();
  expectedTargets.add(dataNodes[0]);
  expectedTargets.add(dataNodes[4]);
  List<DatanodeDescriptor> favouredNodes=new ArrayList<DatanodeDescriptor>();
  favouredNodes.add(dataNodes[3]);
  favouredNodes.add(dataNodes[0]);
  targets=chooseTarget(2,dataNodes[7],null,favouredNodes);
  assertTrue("1st Replica is incorrect",expectedTargets.contains(targets[0].getDatanodeDescriptor()));
  assertTrue("2nd Replica is incorrect",expectedTargets.contains(targets[1].getDatanodeDescriptor()));
}
