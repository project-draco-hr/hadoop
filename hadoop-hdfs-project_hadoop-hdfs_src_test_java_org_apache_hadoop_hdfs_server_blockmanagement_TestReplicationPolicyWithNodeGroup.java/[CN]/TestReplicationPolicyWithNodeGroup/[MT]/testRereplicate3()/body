{
  setupDataNodeCapacity();
  List<DatanodeDescriptor> chosenNodes=new ArrayList<DatanodeDescriptor>();
  chosenNodes.add(dataNodes[0]);
  chosenNodes.add(dataNodes[3]);
  DatanodeDescriptor[] targets;
  targets=chooseTarget(0,chosenNodes);
  assertEquals(targets.length,0);
  targets=chooseTarget(1,chosenNodes);
  assertEquals(targets.length,1);
  assertTrue(cluster.isOnSameRack(dataNodes[0],targets[0]));
  assertFalse(cluster.isOnSameRack(dataNodes[3],targets[0]));
  targets=chooseTarget(1,dataNodes[3],chosenNodes);
  assertEquals(targets.length,1);
  assertTrue(cluster.isOnSameRack(dataNodes[3],targets[0]));
  assertFalse(cluster.isOnSameNodeGroup(dataNodes[3],targets[0]));
  assertFalse(cluster.isOnSameRack(dataNodes[0],targets[0]));
  targets=chooseTarget(2,chosenNodes);
  assertEquals(targets.length,2);
  assertTrue(cluster.isOnSameRack(dataNodes[0],targets[0]));
  assertFalse(cluster.isOnSameNodeGroup(dataNodes[0],targets[0]));
  targets=chooseTarget(2,dataNodes[3],chosenNodes);
  assertEquals(targets.length,2);
  assertTrue(cluster.isOnSameRack(dataNodes[3],targets[0]));
}
