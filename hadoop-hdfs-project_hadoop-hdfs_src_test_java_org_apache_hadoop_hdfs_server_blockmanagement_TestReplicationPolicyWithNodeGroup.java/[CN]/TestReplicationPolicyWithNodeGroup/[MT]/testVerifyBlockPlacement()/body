{
  LocatedBlock locatedBlock;
  BlockPlacementStatus status;
  ExtendedBlock b=new ExtendedBlock("fake-pool",new Block(12345L));
  List<DatanodeStorageInfo> set=new ArrayList<>();
  set.clear();
  set.add(storages[0]);
  set.add(storages[1]);
  set.add(storages[4]);
  locatedBlock=BlockManager.newLocatedBlock(b,set.toArray(new DatanodeStorageInfo[set.size()]),0,false);
  status=replicator.verifyBlockPlacement(locatedBlock.getLocations(),set.size());
  assertFalse(status.isPlacementPolicySatisfied());
  set.clear();
  set.add(storages[0]);
  set.add(storages[2]);
  set.add(storages[5]);
  locatedBlock=BlockManager.newLocatedBlock(b,set.toArray(new DatanodeStorageInfo[set.size()]),0,false);
  status=replicator.verifyBlockPlacement(locatedBlock.getLocations(),set.size());
  assertTrue(status.isPlacementPolicySatisfied());
  set.clear();
  set.add(storages[0]);
  set.add(storages[1]);
  set.add(storages[2]);
  locatedBlock=BlockManager.newLocatedBlock(b,set.toArray(new DatanodeStorageInfo[set.size()]),0,false);
  status=replicator.verifyBlockPlacement(locatedBlock.getLocations(),set.size());
  assertFalse(status.isPlacementPolicySatisfied());
  assertTrue(status.getErrorDescription().contains("node group"));
  assertTrue(status.getErrorDescription().contains("more rack(s)"));
  set.clear();
  set.add(storages[0]);
  set.add(storages[5]);
  set.add(storages[7]);
  locatedBlock=BlockManager.newLocatedBlock(b,set.toArray(new DatanodeStorageInfo[set.size()]),0,false);
  status=replicator.verifyBlockPlacement(locatedBlock.getLocations(),set.size());
  assertTrue(status.isPlacementPolicySatisfied());
  set.clear();
  set.add(storages[0]);
  set.add(storages[1]);
  set.add(storages[5]);
  set.add(storages[7]);
  locatedBlock=BlockManager.newLocatedBlock(b,set.toArray(new DatanodeStorageInfo[set.size()]),0,false);
  status=replicator.verifyBlockPlacement(locatedBlock.getLocations(),set.size());
  assertFalse(status.isPlacementPolicySatisfied());
  assertTrue(status.getErrorDescription().contains("node group"));
  assertFalse(status.getErrorDescription().contains("more rack(s)"));
  set.clear();
  set.add(storages[0]);
  set.add(storages[1]);
  set.add(storages[2]);
  locatedBlock=BlockManager.newLocatedBlock(b,set.toArray(new DatanodeStorageInfo[set.size()]),0,false);
  status=replicator.verifyBlockPlacement(locatedBlock.getLocations(),set.size());
  assertFalse(status.isPlacementPolicySatisfied());
  assertTrue(status.getErrorDescription().contains("node group"));
  assertTrue(status.getErrorDescription().contains("more rack(s)"));
  set.clear();
  set.add(storages[0]);
  set.add(storages[1]);
  locatedBlock=BlockManager.newLocatedBlock(b,set.toArray(new DatanodeStorageInfo[set.size()]),0,false);
  status=replicator.verifyBlockPlacement(locatedBlock.getLocations(),set.size());
  assertFalse(status.isPlacementPolicySatisfied());
  assertTrue(status.getErrorDescription().contains("node group"));
  assertTrue(status.getErrorDescription().contains("more rack(s)"));
}
