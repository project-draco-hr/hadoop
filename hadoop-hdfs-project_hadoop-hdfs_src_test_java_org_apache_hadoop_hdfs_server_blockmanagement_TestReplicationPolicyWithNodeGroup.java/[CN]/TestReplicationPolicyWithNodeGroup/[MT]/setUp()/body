{
  FileSystem.setDefaultUri(CONF,"hdfs://localhost:0");
  CONF.set(DFSConfigKeys.DFS_NAMENODE_HTTP_ADDRESS_KEY,"0.0.0.0:0");
  CONF.set(DFSConfigKeys.DFS_BLOCK_REPLICATOR_CLASSNAME_KEY,BlockPlacementPolicyWithNodeGroup.class.getName());
  CONF.set(CommonConfigurationKeysPublic.NET_TOPOLOGY_IMPL_KEY,NetworkTopologyWithNodeGroup.class.getName());
  File baseDir=PathUtils.getTestDir(TestReplicationPolicyWithNodeGroup.class);
  CONF.set(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY,new File(baseDir,"name").getPath());
  DFSTestUtil.formatNameNode(CONF);
  namenode=new NameNode(CONF);
  final BlockManager bm=namenode.getNamesystem().getBlockManager();
  replicator=bm.getBlockPlacementPolicy();
  cluster=bm.getDatanodeManager().getNetworkTopology();
  for (int i=0; i < NUM_OF_DATANODES; i++) {
    cluster.add(dataNodes[i]);
  }
  setupDataNodeCapacity();
}
