{
  DatanodeDescriptor[] targets;
  BlockPlacementPolicyDefault repl=(BlockPlacementPolicyDefault)replicator;
  List<DatanodeDescriptor> chosenNodes=new ArrayList<DatanodeDescriptor>();
  Set<Node> excludedNodes=new HashSet<Node>();
  excludedNodes.add(dataNodes[1]);
  targets=repl.chooseTarget(filename,4,dataNodes[0],chosenNodes,false,excludedNodes,BLOCK_SIZE);
  assertEquals(targets.length,4);
  assertEquals(targets[0],dataNodes[0]);
  assertTrue(cluster.isNodeGroupAware());
  for (int i=1; i < 4; i++) {
    assertFalse(cluster.isOnSameNodeGroup(targets[0],targets[i]));
  }
  assertTrue(cluster.isOnSameRack(targets[1],targets[2]) || cluster.isOnSameRack(targets[2],targets[3]));
  assertFalse(cluster.isOnSameRack(targets[1],targets[3]));
  excludedNodes.clear();
  chosenNodes.clear();
  excludedNodes.add(dataNodes[1]);
  chosenNodes.add(dataNodes[2]);
  targets=repl.chooseTarget(filename,1,dataNodes[0],chosenNodes,true,excludedNodes,BLOCK_SIZE);
  System.out.println("targets=" + Arrays.asList(targets));
  assertEquals(2,targets.length);
  int i=0;
  for (; i < targets.length && !dataNodes[2].equals(targets[i]); i++)   ;
  assertTrue(i < targets.length);
}
