{
  RegisterNodeManagerRequest req=Records.newRecord(RegisterNodeManagerRequest.class);
  req.setNodeId(nodeId);
  req.setHttpPort(httpPort);
  Resource resource=BuilderUtils.newResource(memory,vCores);
  req.setResource(resource);
  req.setContainerStatuses(containerReports);
  req.setNMVersion(version);
  req.setRunningApplications(runningApplications);
  RegisterNodeManagerResponse registrationResponse=resourceTracker.registerNodeManager(req);
  this.currentContainerTokenMasterKey=registrationResponse.getContainerTokenMasterKey();
  this.currentNMTokenMasterKey=registrationResponse.getNMTokenMasterKey();
  Resource newResource=registrationResponse.getResource();
  if (newResource != null) {
    memory=(int)newResource.getMemorySize();
    vCores=newResource.getVirtualCores();
  }
  containerStats.clear();
  if (containerReports != null) {
    for (    NMContainerStatus report : containerReports) {
      if (report.getContainerState() != ContainerState.COMPLETE) {
        containerStats.put(report.getContainerId(),ContainerStatus.newInstance(report.getContainerId(),report.getContainerState(),report.getDiagnostics(),report.getContainerExitStatus()));
      }
    }
  }
  return registrationResponse;
}
