{
  InetAddress IPAddress=InetAddress.getByName(host);
  byte[] sendData=request.getBytes();
  byte[] receiveData=new byte[65535];
  DatagramSocket socket=this.clientSocket == null ? new DatagramSocket() : this.clientSocket;
  try {
    DatagramPacket sendPacket=new DatagramPacket(sendData,sendData.length,IPAddress,port);
    socket.send(sendPacket);
    socket.setSoTimeout(500);
    DatagramPacket receivePacket=new DatagramPacket(receiveData,receiveData.length);
    socket.receive(receivePacket);
    XDR xdr=new XDR(Arrays.copyOfRange(receiveData,0,receivePacket.getLength()));
    RpcReply reply=RpcReply.read(xdr);
    if (reply.getState() != RpcReply.ReplyState.MSG_ACCEPTED) {
      throw new IOException("Request failed: " + reply.getState());
    }
  }
  finally {
    if (this.clientSocket == null) {
      socket.close();
    }
  }
}
