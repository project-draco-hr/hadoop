{
  HttpServletResponse rsp=(HttpServletResponse)response;
  HttpServletRequest rqst=(HttpServletRequest)request;
  String userId=getUserId(request);
  String groups=getGroups(request);
  List<Path> allowedPaths=getAllowedPaths(request);
  UserGroupInformation ugi=UserGroupInformation.createRemoteUser(userId);
  String filePath=getPathFromRequest(rqst);
  if (filePath == null || !checkHdfsPath(filePath,allowedPaths)) {
    String msg="User " + userId + " ("+ groups+ ") is not authorized to access path "+ filePath;
    LOG.warn(msg);
    rsp.sendError(HttpServletResponse.SC_FORBIDDEN,msg);
    return;
  }
  request.setAttribute("authorized.ugi",ugi);
  LOG.info("User: " + userId + "("+ groups+ ") Request: "+ rqst.getPathInfo()+ " From: "+ rqst.getRemoteAddr());
  chain.doFilter(request,response);
}
