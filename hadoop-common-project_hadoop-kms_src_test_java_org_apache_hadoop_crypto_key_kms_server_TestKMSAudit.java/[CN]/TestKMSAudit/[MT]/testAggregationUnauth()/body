{
  UserGroupInformation luser=Mockito.mock(UserGroupInformation.class);
  Mockito.when(luser.getShortUserName()).thenReturn("luser");
  kmsAudit.unauthorized(luser,KMSOp.GENERATE_EEK,"k2");
  kmsAudit.evictCacheForTesting();
  kmsAudit.ok(luser,KMSOp.GENERATE_EEK,"k3","testmsg");
  kmsAudit.ok(luser,KMSOp.GENERATE_EEK,"k3","testmsg");
  kmsAudit.ok(luser,KMSOp.GENERATE_EEK,"k3","testmsg");
  kmsAudit.ok(luser,KMSOp.GENERATE_EEK,"k3","testmsg");
  kmsAudit.ok(luser,KMSOp.GENERATE_EEK,"k3","testmsg");
  kmsAudit.unauthorized(luser,KMSOp.GENERATE_EEK,"k3");
  Thread.sleep(1000);
  kmsAudit.ok(luser,KMSOp.GENERATE_EEK,"k3","testmsg");
  kmsAudit.evictCacheForTesting();
  String out=getAndResetLogOutput();
  System.out.println(out);
  Assert.assertTrue(out.matches("UNAUTHORIZED\\[op=GENERATE_EEK, key=k2, user=luser\\] " + "OK\\[op=GENERATE_EEK, key=k3, user=luser, accessCount=1, interval=[^m]{1,4}ms\\] testmsg" + "OK\\[op=GENERATE_EEK, key=k3, user=luser, accessCount=5, interval=[^m]{1,4}ms\\] testmsg"+ "UNAUTHORIZED\\[op=GENERATE_EEK, key=k3, user=luser\\] "+ "OK\\[op=GENERATE_EEK, key=k3, user=luser, accessCount=1, interval=[^m]{1,4}ms\\] testmsg") || out.matches("UNAUTHORIZED\\[op=GENERATE_EEK, key=k2, user=luser\\] " + "OK\\[op=GENERATE_EEK, key=k3, user=luser, accessCount=1, interval=[^m]{1,4}ms\\] testmsg" + "UNAUTHORIZED\\[op=GENERATE_EEK, key=k3, user=luser\\] "+ "OK\\[op=GENERATE_EEK, key=k3, user=luser, accessCount=5, interval=[^m]{1,4}ms\\] testmsg"+ "OK\\[op=GENERATE_EEK, key=k3, user=luser, accessCount=1, interval=[^m]{1,4}ms\\] testmsg"));
}
