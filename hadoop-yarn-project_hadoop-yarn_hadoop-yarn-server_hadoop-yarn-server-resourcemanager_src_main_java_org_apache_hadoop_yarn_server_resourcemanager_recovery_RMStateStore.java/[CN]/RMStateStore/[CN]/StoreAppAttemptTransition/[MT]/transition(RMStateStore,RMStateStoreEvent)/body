{
  if (!(event instanceof RMStateStoreAppAttemptEvent)) {
    LOG.error("Illegal event type: " + event.getClass());
    return RMStateStoreState.ACTIVE;
  }
  boolean isFenced=false;
  ApplicationAttemptStateData attemptState=((RMStateStoreAppAttemptEvent)event).getAppAttemptState();
  try {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Storing info for attempt: " + attemptState.getAttemptId());
    }
    store.storeApplicationAttemptStateInternal(attemptState.getAttemptId(),attemptState);
    store.notifyApplicationAttempt(new RMAppAttemptEvent(attemptState.getAttemptId(),RMAppAttemptEventType.ATTEMPT_NEW_SAVED));
  }
 catch (  Exception e) {
    LOG.error("Error storing appAttempt: " + attemptState.getAttemptId(),e);
    isFenced=store.notifyStoreOperationFailedInternal(e);
  }
  return finalState(isFenced);
}
