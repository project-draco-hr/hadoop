{
  UserGroupInformation ugi;
  ugi=UserGroupInformation.createRemoteUser("me");
  ugi.addToken(token);
  ugi.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      CustomProtocol client=(CustomProtocol)RPC.getProxy(CustomProtocol.class,1L,am.address,conf);
      client.ping();
      Assert.assertTrue(am.pinged);
      return null;
    }
  }
);
}
