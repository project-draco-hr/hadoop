{
  final DfsClientConf conf=client.getConf();
  final String dnAddr=first.getXferAddr(conf.isConnectToDnViaHostname());
  if (LOG.isDebugEnabled()) {
    LOG.debug("Connecting to datanode " + dnAddr);
  }
  final InetSocketAddress isa=NetUtils.createSocketAddr(dnAddr);
  final Socket sock=client.socketFactory.createSocket();
  final int timeout=client.getDatanodeReadTimeout(length);
  NetUtils.connect(sock,isa,client.getRandomLocalInterfaceAddr(),conf.getSocketTimeout());
  sock.setSoTimeout(timeout);
  sock.setSendBufferSize(HdfsConstants.DEFAULT_DATA_SOCKET_SIZE);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Send buf size " + sock.getSendBufferSize());
  }
  return sock;
}
