{
  while (datanode.shouldRun) {
    Socket s=null;
    try {
      s=ss.accept();
      s.setTcpNoDelay(true);
      int curXceiverCount=datanode.getXceiverCount();
      if (curXceiverCount > maxXceiverCount) {
        throw new IOException("Xceiver count " + curXceiverCount + " exceeds the limit of concurrent xcievers: "+ maxXceiverCount);
      }
      new Daemon(datanode.threadGroup,new DataXceiver(s,datanode,this)).start();
    }
 catch (    SocketTimeoutException ignored) {
    }
catch (    AsynchronousCloseException ace) {
      if (datanode.shouldRun) {
        LOG.warn(datanode.getDisplayName() + ":DataXceiverServer: ",ace);
      }
    }
catch (    IOException ie) {
      IOUtils.closeSocket(s);
      LOG.warn(datanode.getDisplayName() + ":DataXceiverServer: ",ie);
    }
catch (    OutOfMemoryError ie) {
      IOUtils.closeSocket(s);
      LOG.warn("DataNode is out of memory. Will retry in 30 seconds.",ie);
      try {
        Thread.sleep(30 * 1000);
      }
 catch (      InterruptedException e) {
      }
    }
catch (    Throwable te) {
      LOG.error(datanode.getDisplayName() + ":DataXceiverServer: Exiting due to: ",te);
      datanode.shouldRun=false;
    }
  }
  try {
    ss.close();
  }
 catch (  IOException ie) {
    LOG.warn(datanode.getDisplayName() + " :DataXceiverServer: close exception",ie);
  }
}
