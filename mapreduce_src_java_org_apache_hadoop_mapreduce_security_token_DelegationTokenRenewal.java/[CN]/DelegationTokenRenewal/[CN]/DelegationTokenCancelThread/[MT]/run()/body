{
  while (true) {
    TokenWithConf tokenWithConf=null;
    try {
      tokenWithConf=queue.take();
      DistributedFileSystem dfs=null;
      try {
        dfs=getDFSForToken(tokenWithConf.token,tokenWithConf.conf);
      }
 catch (      Exception e) {
        LOG.info("couldn't get DFS to cancel. Will retry over HTTPS");
        dfs=null;
      }
      if (dfs != null) {
        dfs.cancelDelegationToken(tokenWithConf.token);
      }
 else {
        cancelDelegationTokenOverHttps(tokenWithConf.token,tokenWithConf.conf);
      }
      if (LOG.isDebugEnabled()) {
        LOG.debug("Canceling token " + tokenWithConf.token.getService() + " for dfs="+ dfs);
      }
    }
 catch (    IOException e) {
      LOG.warn("Failed to cancel token " + tokenWithConf.token + " "+ StringUtils.stringifyException(e));
    }
catch (    InterruptedException ie) {
      return;
    }
catch (    Throwable t) {
      LOG.warn("Got exception " + StringUtils.stringifyException(t) + ". Exiting..");
      System.exit(-1);
    }
  }
}
