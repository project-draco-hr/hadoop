{
  if (fp == null) {
    throw new IOException("Trying to use aborted output stream");
  }
  try {
    if (doubleBuf != null) {
      doubleBuf.close();
      doubleBuf=null;
    }
    if (fc != null && fc.isOpen()) {
      fc.truncate(fc.position());
      fc.close();
      fc=null;
    }
    fp.close();
    fp=null;
  }
  finally {
    IOUtils.cleanup(LOG,fc,fp);
    doubleBuf=null;
    fc=null;
    fp=null;
  }
  fp=null;
}
