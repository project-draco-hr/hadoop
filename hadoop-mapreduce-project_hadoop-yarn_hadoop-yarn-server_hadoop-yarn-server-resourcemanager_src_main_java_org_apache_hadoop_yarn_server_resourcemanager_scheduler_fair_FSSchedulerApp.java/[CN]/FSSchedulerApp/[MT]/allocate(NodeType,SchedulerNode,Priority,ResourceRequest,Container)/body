{
  NodeType allowed=this.allowedLocalityLevel.get(priority);
  if (allowed != null) {
    if (allowed.equals(NodeType.OFF_SWITCH) && (type.equals(NodeType.NODE_LOCAL) || type.equals(NodeType.RACK_LOCAL))) {
      this.resetAllowedLocalityLevel(priority,type);
    }
 else     if (allowed.equals(NodeType.RACK_LOCAL) && type.equals(NodeType.NODE_LOCAL)) {
      this.resetAllowedLocalityLevel(priority,type);
    }
  }
  return super.allocate(type,node,priority,request,container);
}
