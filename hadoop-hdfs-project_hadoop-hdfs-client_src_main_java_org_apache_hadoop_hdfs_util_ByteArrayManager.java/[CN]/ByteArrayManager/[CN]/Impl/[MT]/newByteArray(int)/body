{
  Preconditions.checkArgument(arrayLength >= 0);
  LOG.debug("allocate({})",arrayLength);
  final byte[] array;
  if (arrayLength == 0) {
    array=EMPTY_BYTE_ARRAY;
  }
 else {
    final int powerOfTwo=arrayLength <= MIN_ARRAY_LENGTH ? MIN_ARRAY_LENGTH : leastPowerOfTwo(arrayLength);
    final long count=counters.get(powerOfTwo,true).increment();
    final boolean aboveThreshold=count > conf.countThreshold;
    final FixedLengthManager manager=managers.get(powerOfTwo,aboveThreshold);
    LOG.debug(": count={}, {}Threshold",count,aboveThreshold ? "above" : "below");
    array=manager != null ? manager.allocate() : new byte[powerOfTwo];
  }
  LOG.debug(", return byte[{}]",array.length);
  return array;
}
