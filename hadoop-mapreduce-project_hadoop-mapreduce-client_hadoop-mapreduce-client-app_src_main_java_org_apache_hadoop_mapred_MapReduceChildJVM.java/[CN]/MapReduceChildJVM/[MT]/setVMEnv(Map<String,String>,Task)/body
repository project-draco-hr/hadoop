{
  JobConf conf=task.conf;
  environment.put(Environment.SHELL.name(),conf.get(MRJobConfig.MAPRED_ADMIN_USER_SHELL,MRJobConfig.DEFAULT_SHELL));
  Apps.addToEnvironment(environment,Environment.LD_LIBRARY_PATH.name(),Environment.PWD.$());
  String mapredChildEnv=getChildEnv(conf,task.isMapTask());
  Apps.setEnvFromInputString(environment,mapredChildEnv);
  Apps.setEnvFromInputString(environment,conf.get(MRJobConfig.MAPRED_ADMIN_USER_ENV,MRJobConfig.DEFAULT_MAPRED_ADMIN_USER_ENV));
  environment.put("HADOOP_ROOT_LOGGER",getChildLogLevel(conf,task.isMapTask()) + ",CLA");
  String hadoopClientOpts=System.getenv("HADOOP_CLIENT_OPTS");
  if (hadoopClientOpts == null) {
    hadoopClientOpts="";
  }
 else {
    hadoopClientOpts=hadoopClientOpts + " ";
  }
  long logSize=TaskLog.getTaskLogLength(conf);
  Vector<String> logProps=new Vector<String>(4);
  setupLog4jProperties(task,logProps,logSize);
  Iterator<String> it=logProps.iterator();
  StringBuffer buffer=new StringBuffer();
  while (it.hasNext()) {
    buffer.append(" " + it.next());
  }
  hadoopClientOpts=hadoopClientOpts + buffer.toString();
  environment.put("HADOOP_CLIENT_OPTS",hadoopClientOpts);
  environment.put(MRJobConfig.STDOUT_LOGFILE_ENV,getTaskLogFile(TaskLog.LogName.STDOUT));
  environment.put(MRJobConfig.STDERR_LOGFILE_ENV,getTaskLogFile(TaskLog.LogName.STDERR));
  environment.put(MRJobConfig.APPLICATION_ATTEMPT_ID_ENV,conf.get(MRJobConfig.APPLICATION_ATTEMPT_ID).toString());
}
