{
  am.allocate(Arrays.asList(ResourceRequest.newInstance(Priority.newInstance(priority),"*",Resources.createResource(mem),nContainer)),null);
  ContainerId lastContainerId=ContainerId.newContainerId(am.getApplicationAttemptId(),startContainerId + nContainer - 1);
  Assert.assertTrue(rm.waitForState(nm,lastContainerId,RMContainerState.ALLOCATED,10 * 1000));
  am.allocate(null,null);
  for (int cId=startContainerId; cId < startContainerId + nContainer; cId++) {
    sentRMContainerLaunched(rm,ContainerId.newContainerId(am.getApplicationAttemptId(),cId));
    rm.waitForContainerState(ContainerId.newContainerId(am.getApplicationAttemptId(),cId),RMContainerState.RUNNING);
  }
}
