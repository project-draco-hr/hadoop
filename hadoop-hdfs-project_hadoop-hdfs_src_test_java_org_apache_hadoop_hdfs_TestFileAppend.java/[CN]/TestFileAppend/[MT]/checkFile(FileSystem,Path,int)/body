{
  boolean done=false;
  while (!done) {
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      ;
    }
    done=true;
    BlockLocation[] locations=fileSys.getFileBlockLocations(fileSys.getFileStatus(name),0,AppendTestUtil.FILE_SIZE);
    if (locations.length < AppendTestUtil.NUM_BLOCKS) {
      System.out.println("Number of blocks found " + locations.length);
      done=false;
      continue;
    }
    for (int idx=0; idx < AppendTestUtil.NUM_BLOCKS; idx++) {
      if (locations[idx].getHosts().length < repl) {
        System.out.println("Block index " + idx + " not yet replciated.");
        done=false;
        break;
      }
    }
  }
  byte[] expected=new byte[AppendTestUtil.NUM_BLOCKS * AppendTestUtil.BLOCK_SIZE];
  if (simulatedStorage) {
    for (int i=0; i < expected.length; i++) {
      expected[i]=SimulatedFSDataset.DEFAULT_DATABYTE;
    }
  }
 else {
    System.arraycopy(fileContents,0,expected,0,expected.length);
  }
  AppendTestUtil.checkFullFile(fileSys,name,AppendTestUtil.NUM_BLOCKS * AppendTestUtil.BLOCK_SIZE,expected,"Read 1",false);
}
