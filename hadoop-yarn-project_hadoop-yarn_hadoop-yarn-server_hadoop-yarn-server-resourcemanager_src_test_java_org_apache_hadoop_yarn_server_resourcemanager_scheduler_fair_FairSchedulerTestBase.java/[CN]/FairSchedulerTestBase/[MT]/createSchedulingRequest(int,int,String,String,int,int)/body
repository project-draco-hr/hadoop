{
  ApplicationAttemptId id=createAppAttemptId(this.APP_ID++,this.ATTEMPT_ID++);
  scheduler.addApplication(id.getApplicationId(),queueId,userId);
  if (scheduler.getSchedulerApplications().containsKey(id.getApplicationId())) {
    scheduler.addApplicationAttempt(id,false,true);
  }
  List<ResourceRequest> ask=new ArrayList<ResourceRequest>();
  ResourceRequest request=createResourceRequest(memory,vcores,ResourceRequest.ANY,priority,numContainers,true);
  ask.add(request);
  scheduler.allocate(id,ask,new ArrayList<ContainerId>(),null,null);
  RMApp rmApp=mock(RMApp.class);
  RMAppAttempt rmAppAttempt=mock(RMAppAttempt.class);
  when(rmApp.getCurrentAppAttempt()).thenReturn(rmAppAttempt);
  when(rmAppAttempt.getRMAppAttemptMetrics()).thenReturn(new RMAppAttemptMetrics(id));
  resourceManager.getRMContext().getRMApps().put(id.getApplicationId(),rmApp);
  return id;
}
