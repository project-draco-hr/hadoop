{
  ReceivedDeletedBlockInfo[] receivedAndDeletedBlockArray=null;
  int currentReceivedRequestsCounter;
synchronized (receivedAndDeletedBlockList) {
    currentReceivedRequestsCounter=pendingReceivedRequests;
    int numBlocks=receivedAndDeletedBlockList.size();
    if (numBlocks > 0) {
      receivedAndDeletedBlockArray=receivedAndDeletedBlockList.toArray(new ReceivedDeletedBlockInfo[numBlocks]);
    }
  }
  if (receivedAndDeletedBlockArray != null) {
    StorageReceivedDeletedBlocks[] report={new StorageReceivedDeletedBlocks(bpRegistration.getStorageID(),receivedAndDeletedBlockArray)};
    bpNamenode.blockReceivedAndDeleted(bpRegistration,bpos.getBlockPoolId(),report);
synchronized (receivedAndDeletedBlockList) {
      for (int i=0; i < receivedAndDeletedBlockArray.length; i++) {
        receivedAndDeletedBlockList.remove(receivedAndDeletedBlockArray[i]);
      }
      pendingReceivedRequests-=currentReceivedRequestsCounter;
    }
  }
}
