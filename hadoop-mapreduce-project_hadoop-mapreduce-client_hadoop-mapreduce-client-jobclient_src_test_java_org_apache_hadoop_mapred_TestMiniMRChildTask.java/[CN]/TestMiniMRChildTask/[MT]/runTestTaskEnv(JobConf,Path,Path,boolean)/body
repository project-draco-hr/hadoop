{
  String input="The input";
  configure(conf,inDir,outDir,input,EnvCheckMapper.class,EnvCheckReducer.class);
  String mapTaskEnvKey=JobConf.MAPRED_MAP_TASK_ENV;
  String reduceTaskEnvKey=JobConf.MAPRED_MAP_TASK_ENV;
  String mapTaskJavaOptsKey=JobConf.MAPRED_MAP_TASK_JAVA_OPTS;
  String reduceTaskJavaOptsKey=JobConf.MAPRED_REDUCE_TASK_JAVA_OPTS;
  String mapTaskJavaOpts=MAP_OPTS_VAL;
  String reduceTaskJavaOpts=REDUCE_OPTS_VAL;
  conf.setBoolean(OLD_CONFIGS,oldConfigs);
  if (oldConfigs) {
    mapTaskEnvKey=reduceTaskEnvKey=JobConf.MAPRED_TASK_ENV;
    mapTaskJavaOptsKey=reduceTaskJavaOptsKey=JobConf.MAPRED_TASK_JAVA_OPTS;
    mapTaskJavaOpts=reduceTaskJavaOpts=TASK_OPTS_VAL;
  }
  conf.set(mapTaskEnvKey,Shell.WINDOWS ? "MY_PATH=/tmp,LANG=en_us_8859_1,LD_LIBRARY_PATH=%LD_LIBRARY_PATH%;/tmp," + "PATH=%PATH%;/tmp,NEW_PATH=%NEW_PATH%;/tmp" : "MY_PATH=/tmp,LANG=en_us_8859_1,LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/tmp," + "PATH=$PATH:/tmp,NEW_PATH=$NEW_PATH:/tmp");
  conf.set(reduceTaskEnvKey,Shell.WINDOWS ? "MY_PATH=/tmp,LANG=en_us_8859_1,LD_LIBRARY_PATH=%LD_LIBRARY_PATH%;/tmp," + "PATH=%PATH%;/tmp,NEW_PATH=%NEW_PATH%;/tmp" : "MY_PATH=/tmp,LANG=en_us_8859_1,LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/tmp," + "PATH=$PATH:/tmp,NEW_PATH=$NEW_PATH:/tmp");
  conf.set("path",System.getenv("PATH"));
  conf.set(mapTaskJavaOptsKey,mapTaskJavaOpts);
  conf.set(reduceTaskJavaOptsKey,reduceTaskJavaOpts);
  Job job=new Job(conf);
  job.addFileToClassPath(APP_JAR);
  job.setJarByClass(TestMiniMRChildTask.class);
  job.setMaxMapAttempts(1);
  job.waitForCompletion(true);
  boolean succeeded=job.waitForCompletion(true);
  assertTrue("The environment checker job failed.",succeeded);
}
