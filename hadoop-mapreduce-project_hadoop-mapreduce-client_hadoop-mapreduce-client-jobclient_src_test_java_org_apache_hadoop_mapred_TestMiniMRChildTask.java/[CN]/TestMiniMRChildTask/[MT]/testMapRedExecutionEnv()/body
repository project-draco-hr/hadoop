{
  if (Shell.WINDOWS) {
    try {
      Map<String,String> environment=new HashMap<String,String>();
      String setupHadoopHomeCommand="HADOOP_COMMON_HOME=C:\\fake\\PATH\\to\\hadoop\\common\\home";
      MRApps.setEnvFromInputString(environment,setupHadoopHomeCommand,conf);
      MRApps.setEnvFromInputString(environment,conf.get(MRJobConfig.MAPRED_ADMIN_USER_ENV,MRJobConfig.DEFAULT_MAPRED_ADMIN_USER_ENV),conf);
      String executionPaths=environment.get("PATH");
      String toFind="C:\\fake\\PATH\\to\\hadoop\\common\\home\\bin";
      assertTrue("execution path does not include the hadoop lib location " + toFind,executionPaths.contains(toFind));
    }
 catch (    Exception e) {
      e.printStackTrace();
      fail("Exception in testing execution environment for MapReduce task");
      tearDown();
    }
  }
  try {
    JobConf conf=new JobConf(mr.getConfig());
    Path rootDir=new Path(System.getProperty("test.build.data","build/test/data"));
    Path inDir=new Path(rootDir,"input");
    Path outDir=new Path(rootDir,"output");
    String input="The input";
    configure(conf,inDir,outDir,input,ExecutionEnvCheckMapClass.class,IdentityReducer.class);
    launchTest(conf,inDir,outDir,input);
  }
 catch (  Exception e) {
    e.printStackTrace();
    fail("Exception in testing propagation of env setting to child task");
    tearDown();
  }
}
