{
  Collection<Schedulable> schedulables=new ArrayList<Schedulable>();
  int takenResources=handleFixedFairShares(allSchedulables,schedulables,isSteadyShare,type);
  if (schedulables.isEmpty()) {
    return;
  }
  int totalMaxShare=0;
  for (  Schedulable sched : schedulables) {
    int maxShare=getResourceValue(sched.getMaxShare(),type);
    totalMaxShare=(int)Math.min((long)maxShare + (long)totalMaxShare,Integer.MAX_VALUE);
    if (totalMaxShare == Integer.MAX_VALUE) {
      break;
    }
  }
  int totalResource=Math.max((getResourceValue(totalResources,type) - takenResources),0);
  totalResource=Math.min(totalMaxShare,totalResource);
  double rMax=1.0;
  while (resourceUsedWithWeightToResourceRatio(rMax,schedulables,type) < totalResource) {
    rMax*=2.0;
  }
  double left=0;
  double right=rMax;
  for (int i=0; i < COMPUTE_FAIR_SHARES_ITERATIONS; i++) {
    double mid=(left + right) / 2.0;
    int plannedResourceUsed=resourceUsedWithWeightToResourceRatio(mid,schedulables,type);
    if (plannedResourceUsed == totalResource) {
      right=mid;
      break;
    }
 else     if (plannedResourceUsed < totalResource) {
      left=mid;
    }
 else {
      right=mid;
    }
  }
  for (  Schedulable sched : schedulables) {
    if (isSteadyShare) {
      setResourceValue(computeShare(sched,right,type),((FSQueue)sched).getSteadyFairShare(),type);
    }
 else {
      setResourceValue(computeShare(sched,right,type),sched.getFairShare(),type);
    }
  }
}
