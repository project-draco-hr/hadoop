{
  PermissionCollection permissionCollection=super.getPermissions(domain);
  for (  Principal principal : domain.getPrincipals()) {
    Set<Permission> principalPermissions=permissions.get(principal);
    if (principalPermissions != null) {
      for (      Permission permission : principalPermissions) {
        permissionCollection.add(permission);
      }
    }
    for (    Permission permission : allowedPermissions) {
      permissionCollection.add(permission);
    }
  }
  return permissionCollection;
}
