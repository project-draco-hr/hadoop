{
  Configuration conf=new Configuration();
  conf.set("hadoop.http.authentication.foo","bar");
  FilterContainer container=Mockito.mock(FilterContainer.class);
  Mockito.doAnswer(new Answer(){
    public Object answer(    InvocationOnMock invocationOnMock) throws Throwable {
      Object[] args=invocationOnMock.getArguments();
      assertEquals("authentication",args[0]);
      assertEquals(AuthenticationFilter.class.getName(),args[1]);
      Map<String,String> conf=(Map<String,String>)args[2];
      assertEquals("/",conf.get("cookie.path"));
      assertEquals("simple",conf.get("type"));
      assertEquals("36000",conf.get("token.validity"));
      assertEquals("hadoop",conf.get("signature.secret"));
      assertNull(conf.get("cookie.domain"));
      assertEquals("true",conf.get("simple.anonymous.allowed"));
      assertEquals("HTTP/localhost@LOCALHOST",conf.get("kerberos.principal"));
      assertEquals(System.getProperty("user.home") + "/hadoop.keytab",conf.get("kerberos.keytab"));
      assertEquals("bar",conf.get("foo"));
      return null;
    }
  }
).when(container).addFilter(Mockito.<String>anyObject(),Mockito.<String>anyObject(),Mockito.<Map<String,String>>anyObject());
  new AuthenticationFilterInitializer().initFilter(container,conf);
}
