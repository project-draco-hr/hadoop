{
  JobConf configuration=new JobConf();
  configuration.set(MRJobConfig.MAP_MEMORY_MB,String.valueOf(300));
  configuration.set(MRJobConfig.REDUCE_MEMORY_MB,String.valueOf(-1));
  Assert.assertEquals(configuration.getMaxVirtualMemoryForTask(),300 * 1024 * 1024);
  configuration=new JobConf();
  configuration.set(MRJobConfig.MAP_MEMORY_MB,String.valueOf(-1));
  configuration.set(MRJobConfig.REDUCE_MEMORY_MB,String.valueOf(200));
  Assert.assertEquals(configuration.getMaxVirtualMemoryForTask(),200 * 1024 * 1024);
  configuration=new JobConf();
  configuration.set(MRJobConfig.MAP_MEMORY_MB,String.valueOf(-1));
  configuration.set(MRJobConfig.REDUCE_MEMORY_MB,String.valueOf(-1));
  configuration.set("mapred.task.maxvmem",String.valueOf(1 * 1024 * 1024));
  Assert.assertEquals(configuration.getMaxVirtualMemoryForTask(),1 * 1024 * 1024);
  configuration=new JobConf();
  configuration.set("mapred.task.maxvmem",String.valueOf(1 * 1024 * 1024));
  Assert.assertEquals(configuration.getMaxVirtualMemoryForTask(),1 * 1024 * 1024);
  configuration=new JobConf();
  configuration.setMaxVirtualMemoryForTask(2 * 1024 * 1024);
  Assert.assertEquals(configuration.getMemoryForMapTask(),2);
  Assert.assertEquals(configuration.getMemoryForReduceTask(),2);
  configuration=new JobConf();
  configuration.set(MRJobConfig.MAP_MEMORY_MB,String.valueOf(300));
  configuration.set(MRJobConfig.REDUCE_MEMORY_MB,String.valueOf(400));
  configuration.setMaxVirtualMemoryForTask(2 * 1024 * 1024);
  Assert.assertEquals(configuration.getMemoryForMapTask(),2);
  Assert.assertEquals(configuration.getMemoryForReduceTask(),2);
}
