{
  JobConf configuration=new JobConf();
  configuration.set(MRJobConfig.MAP_MEMORY_MB,String.valueOf(300));
  configuration.set(MRJobConfig.REDUCE_MEMORY_MB,String.valueOf(300));
  Assert.assertEquals(configuration.getMemoryForMapTask(),300);
  Assert.assertEquals(configuration.getMemoryForReduceTask(),300);
  configuration.set("mapred.task.maxvmem",String.valueOf(2 * 1024 * 1024));
  configuration.set(MRJobConfig.MAP_MEMORY_MB,String.valueOf(300));
  configuration.set(MRJobConfig.REDUCE_MEMORY_MB,String.valueOf(300));
  Assert.assertEquals(configuration.getMemoryForMapTask(),2);
  Assert.assertEquals(configuration.getMemoryForReduceTask(),2);
  configuration=new JobConf();
  configuration.set("mapred.task.maxvmem","-1");
  configuration.set(MRJobConfig.MAP_MEMORY_MB,String.valueOf(300));
  configuration.set(MRJobConfig.REDUCE_MEMORY_MB,String.valueOf(400));
  Assert.assertEquals(configuration.getMemoryForMapTask(),300);
  Assert.assertEquals(configuration.getMemoryForReduceTask(),400);
  configuration=new JobConf();
  configuration.set("mapred.task.maxvmem",String.valueOf(2 * 1024 * 1024));
  configuration.set(MRJobConfig.MAP_MEMORY_MB,"-1");
  configuration.set(MRJobConfig.REDUCE_MEMORY_MB,"-1");
  Assert.assertEquals(configuration.getMemoryForMapTask(),2);
  Assert.assertEquals(configuration.getMemoryForReduceTask(),2);
  configuration=new JobConf();
  configuration.set("mapred.task.maxvmem",String.valueOf(-1));
  configuration.set(MRJobConfig.MAP_MEMORY_MB,"-1");
  configuration.set(MRJobConfig.REDUCE_MEMORY_MB,"-1");
  Assert.assertEquals(configuration.getMemoryForMapTask(),-1);
  Assert.assertEquals(configuration.getMemoryForReduceTask(),-1);
  configuration=new JobConf();
  configuration.set("mapred.task.maxvmem",String.valueOf(2 * 1024 * 1024));
  configuration.set(MRJobConfig.MAP_MEMORY_MB,"3");
  configuration.set(MRJobConfig.REDUCE_MEMORY_MB,"3");
  Assert.assertEquals(configuration.getMemoryForMapTask(),2);
  Assert.assertEquals(configuration.getMemoryForReduceTask(),2);
}
