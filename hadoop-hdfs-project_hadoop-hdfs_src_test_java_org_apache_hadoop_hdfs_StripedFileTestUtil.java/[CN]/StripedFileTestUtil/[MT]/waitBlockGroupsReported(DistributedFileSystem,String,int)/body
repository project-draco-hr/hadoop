{
  boolean success;
  final int ATTEMPTS=40;
  int count=0;
  do {
    success=true;
    count++;
    LocatedBlocks lbs=fs.getClient().getLocatedBlocks(src,0);
    for (    LocatedBlock lb : lbs.getLocatedBlocks()) {
      short expected=(short)(getRealTotalBlockNum((int)lb.getBlockSize()) - numDeadDNs);
      int reported=lb.getLocations().length;
      if (reported < expected) {
        success=false;
        LOG.info("blockGroup " + lb.getBlock() + " of file "+ src+ " has reported internalBlocks "+ reported+ " (desired "+ expected+ "); locations "+ Joiner.on(' ').join(lb.getLocations()));
        Thread.sleep(1000);
        break;
      }
    }
    if (success) {
      LOG.info("All blockGroups of file " + src + " verified to have all internalBlocks.");
    }
  }
 while (!success && count < ATTEMPTS);
  if (count == ATTEMPTS) {
    throw new TimeoutException("Timed out waiting for " + src + " to have all the internalBlocks");
  }
}
