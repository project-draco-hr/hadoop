{
  RpcEngine engine=PROTOCOL_ENGINES.get(protocol);
  if (engine == null) {
    Class<?> impl=conf.getClass(ENGINE_PROP + "." + protocol.getName(),WritableRpcEngine.class);
    engine=(RpcEngine)ReflectionUtils.newInstance(impl,conf);
    if (protocol.isInterface())     PROXY_ENGINES.put(Proxy.getProxyClass(protocol.getClassLoader(),protocol),engine);
    PROTOCOL_ENGINES.put(protocol,engine);
  }
  return engine;
}
