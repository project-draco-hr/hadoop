{
  long startTime=System.currentTimeMillis();
  IOException ioe;
  while (true) {
    try {
      return getProtocolProxy(protocol,clientVersion,addr,UserGroupInformation.getCurrentUser(),conf,NetUtils.getDefaultSocketFactory(conf),rpcTimeout);
    }
 catch (    ConnectException se) {
      LOG.info("Server at " + addr + " not available yet, Zzzzz...");
      ioe=se;
    }
catch (    SocketTimeoutException te) {
      LOG.info("Problem connecting to server: " + addr);
      ioe=te;
    }
catch (    NoRouteToHostException nrthe) {
      LOG.info("No route to host for server: " + addr);
      ioe=nrthe;
    }
    if (System.currentTimeMillis() - timeout >= startTime) {
      throw ioe;
    }
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException ie) {
    }
  }
}
