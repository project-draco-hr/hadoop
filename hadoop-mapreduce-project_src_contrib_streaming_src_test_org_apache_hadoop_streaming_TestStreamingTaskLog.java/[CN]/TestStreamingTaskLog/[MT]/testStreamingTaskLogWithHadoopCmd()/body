{
  try {
    final int numSlaves=1;
    JobConf conf=new JobConf();
    fs=FileSystem.getLocal(conf);
    Path testDir=new Path(System.getProperty("test.build.data","/tmp"));
    if (fs.exists(testDir)) {
      fs.delete(testDir,true);
    }
    fs.mkdirs(testDir);
    File scriptFile=createScript(testDir.toString() + "/testTaskLog.sh");
    conf.setBoolean(JTConfig.JT_PERSIST_JOBSTATUS,false);
    mr=new MiniMRCluster(numSlaves,fs.getUri().toString(),1,null,null,conf);
    writeInputFile(fs,inputPath);
    map=scriptFile.getAbsolutePath();
    runStreamJobAndValidateEnv();
    fs.delete(outputPath,true);
    assertFalse("output not cleaned up",fs.exists(outputPath));
    mr.waitUntilIdle();
  }
 catch (  IOException e) {
    fail(e.toString());
  }
 finally {
    if (mr != null) {
      mr.shutdown();
    }
  }
}
