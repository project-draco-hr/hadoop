{
  readLock.lock();
  try {
    if (forceConfiguredMaxAllocation && System.currentTimeMillis() - ResourceManager.getClusterTimeStamp() > configuredMaxAllocationWaitTime) {
      forceConfiguredMaxAllocation=false;
    }
    if (forceConfiguredMaxAllocation || maxNodeMemory == -1 || maxNodeVCores == -1) {
      return configuredMaxAllocation;
    }
    return Resources.createResource(Math.min(configuredMaxAllocation.getMemorySize(),maxNodeMemory),Math.min(configuredMaxAllocation.getVirtualCores(),maxNodeVCores));
  }
  finally {
    readLock.unlock();
  }
}
