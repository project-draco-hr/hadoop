{
  writeLock.lock();
  try {
    nodes.put(node.getNodeID(),node);
    nodeNameToNodeMap.put(node.getNodeName(),node);
    String rackName=node.getRackName();
    List<N> nodesList=nodesPerRack.get(rackName);
    if (nodesList == null) {
      nodesList=new ArrayList<>();
      nodesPerRack.put(rackName,nodesList);
    }
    nodesList.add(node);
    Resources.addTo(clusterCapacity,node.getTotalResource());
    updateMaxResources(node,true);
  }
  finally {
    writeLock.unlock();
  }
}
