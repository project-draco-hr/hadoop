{
  writeLock.lock();
  try {
    nodes.put(node.getNodeID(),node);
    String rackName=node.getRackName();
    Integer numNodes=nodesPerRack.get(rackName);
    if (numNodes == null) {
      numNodes=0;
    }
    nodesPerRack.put(rackName,++numNodes);
    Resources.addTo(clusterCapacity,node.getTotalResource());
    updateMaxResources(node,true);
  }
  finally {
    writeLock.unlock();
  }
}
