{
  RMStateStore store=stateStoreHelper.getRMStateStore();
  when(rmContext.getStateStore()).thenReturn(store);
  store.setRMDispatcher(dispatcher);
  RMState state=store.loadState();
  Map<String,Map<ReservationId,ReservationAllocationStateProto>> reservationState=state.getReservationState();
  Assert.assertNotNull(reservationState);
  Map<ReservationId,ReservationAllocationStateProto> reservations=reservationState.get(planName);
  Assert.assertNotNull(reservations);
  ReservationAllocationStateProto storedReservationAllocation=reservations.get(r1);
  Assert.assertNotNull(storedReservationAllocation);
  assertAllocationStateEqual(allocationStateProto,storedReservationAllocation);
  assertAllocationStateEqual(allocation,storedReservationAllocation);
}
