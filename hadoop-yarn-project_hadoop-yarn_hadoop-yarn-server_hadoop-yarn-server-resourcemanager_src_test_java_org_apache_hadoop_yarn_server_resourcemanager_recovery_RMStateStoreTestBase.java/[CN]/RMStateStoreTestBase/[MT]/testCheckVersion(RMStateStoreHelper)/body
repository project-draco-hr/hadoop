{
  RMStateStore store=stateStoreHelper.getRMStateStore();
  store.setRMDispatcher(new TestDispatcher());
  RMStateVersion defaultVersion=stateStoreHelper.getCurrentVersion();
  store.checkVersion();
  Assert.assertEquals(defaultVersion,store.loadVersion());
  RMStateVersion compatibleVersion=RMStateVersion.newInstance(defaultVersion.getMajorVersion(),defaultVersion.getMinorVersion() + 2);
  stateStoreHelper.writeVersion(compatibleVersion);
  Assert.assertEquals(compatibleVersion,store.loadVersion());
  store.checkVersion();
  Assert.assertEquals(defaultVersion,store.loadVersion());
  RMStateVersion incompatibleVersion=RMStateVersion.newInstance(defaultVersion.getMajorVersion() + 2,defaultVersion.getMinorVersion());
  stateStoreHelper.writeVersion(incompatibleVersion);
  try {
    store.checkVersion();
    Assert.fail("Invalid version, should fail.");
  }
 catch (  Throwable t) {
    Assert.assertTrue(t instanceof RMStateVersionIncompatibleException);
  }
}
