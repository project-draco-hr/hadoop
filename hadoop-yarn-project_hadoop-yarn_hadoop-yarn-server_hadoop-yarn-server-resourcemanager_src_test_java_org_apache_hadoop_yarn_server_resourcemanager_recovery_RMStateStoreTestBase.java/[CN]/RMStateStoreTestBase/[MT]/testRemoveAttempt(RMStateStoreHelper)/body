{
  RMStateStore store=stateStoreHelper.getRMStateStore();
  TestDispatcher dispatcher=new TestDispatcher();
  store.setRMDispatcher(dispatcher);
  ApplicationId appId=ApplicationId.newInstance(1383183339,6);
  storeApp(store,appId,123456,564321);
  ApplicationAttemptId attemptId1=ApplicationAttemptId.newInstance(appId,1);
  RMAppAttempt attempt1=storeAttempt(store,attemptId1,ContainerId.newContainerId(attemptId1,1).toString(),null,null,dispatcher);
  ApplicationAttemptId attemptId2=ApplicationAttemptId.newInstance(appId,2);
  RMAppAttempt attempt2=storeAttempt(store,attemptId2,ContainerId.newContainerId(attemptId2,1).toString(),null,null,dispatcher);
  store.removeApplicationAttemptInternal(attemptId1);
  Assert.assertFalse(stateStoreHelper.attemptExists(attempt1));
  Assert.assertTrue(stateStoreHelper.attemptExists(attempt2));
  Thread.sleep(1000);
  store.close();
  store=stateStoreHelper.getRMStateStore();
  RMState state=store.loadState();
  Map<ApplicationId,ApplicationStateData> rmAppState=state.getApplicationState();
  ApplicationStateData appState=rmAppState.get(appId);
  assertNotNull(appState);
  assertEquals(2,appState.getFirstAttemptId());
  assertNull(appState.getAttempt(attemptId1));
  assertNotNull(appState.getAttempt(attemptId2));
}
