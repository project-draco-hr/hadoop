{
  final boolean needReport=coarseLock.getWriteHoldCount() == 1 && coarseLock.isWriteLockedByCurrentThread();
  final long currentTime=timer.monotonicNow();
  final long writeLockInterval=currentTime - writeLockHeldTimeStamp;
  boolean logReport=false;
  int numSuppressedWarnings=0;
  long longestLockHeldInterval=0;
  if (needReport && writeLockInterval >= this.writeLockReportingThreshold) {
    if (writeLockInterval > longestWriteLockHeldInterval) {
      longestWriteLockHeldInterval=writeLockInterval;
    }
    if (currentTime - timeStampOfLastWriteLockReport > this.lockSuppressWarningInterval) {
      logReport=true;
      numSuppressedWarnings=numWriteLockWarningsSuppressed;
      numWriteLockWarningsSuppressed=0;
      longestLockHeldInterval=longestWriteLockHeldInterval;
      longestWriteLockHeldInterval=0;
      timeStampOfLastWriteLockReport=currentTime;
    }
 else {
      numWriteLockWarningsSuppressed++;
    }
  }
  coarseLock.writeLock().unlock();
  if (logReport) {
    FSNamesystem.LOG.info("FSNamesystem write lock held for " + writeLockInterval + " ms via\n"+ StringUtils.getStackTrace(Thread.currentThread())+ "\tNumber of suppressed write-lock reports: "+ numSuppressedWarnings+ "\n\tLongest write-lock held interval: "+ longestLockHeldInterval);
  }
}
