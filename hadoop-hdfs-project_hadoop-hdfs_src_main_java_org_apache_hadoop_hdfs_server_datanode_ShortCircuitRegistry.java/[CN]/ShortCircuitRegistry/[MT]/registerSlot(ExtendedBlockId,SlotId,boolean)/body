{
  if (!enabled) {
    if (LOG.isTraceEnabled()) {
      LOG.trace(this + " can't register a slot because the " + "ShortCircuitRegistry is not enabled.");
    }
    throw new UnsupportedOperationException();
  }
  ShmId shmId=slotId.getShmId();
  RegisteredShm shm=segments.get(shmId);
  if (shm == null) {
    throw new InvalidRequestException("there is no shared memory segment " + "registered with shmId " + shmId);
  }
  Slot slot=shm.registerSlot(slotId.getSlotIdx(),blockId);
  if (isCached) {
    slot.makeAnchorable();
  }
 else {
    slot.makeUnanchorable();
  }
  boolean added=slots.put(blockId,slot);
  Preconditions.checkState(added);
  if (LOG.isTraceEnabled()) {
    LOG.trace(this + ": registered " + blockId+ " with slot "+ slotId+ " (isCached="+ isCached+ ")");
  }
}
