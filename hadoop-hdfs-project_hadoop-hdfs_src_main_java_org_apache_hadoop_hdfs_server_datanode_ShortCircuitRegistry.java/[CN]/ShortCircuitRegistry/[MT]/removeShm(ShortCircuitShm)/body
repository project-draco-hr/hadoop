{
  if (LOG.isTraceEnabled()) {
    LOG.debug("removing shm " + shm);
  }
  RegisteredShm removedShm=segments.remove(shm.getShmId());
  Preconditions.checkState(removedShm == shm,"failed to remove " + shm.getShmId());
  for (Iterator<Slot> iter=shm.slotIterator(); iter.hasNext(); ) {
    Slot slot=iter.next();
    boolean removed=slots.remove(slot.getBlockId(),slot);
    Preconditions.checkState(removed);
    slot.makeInvalid();
  }
  shm.free();
}
