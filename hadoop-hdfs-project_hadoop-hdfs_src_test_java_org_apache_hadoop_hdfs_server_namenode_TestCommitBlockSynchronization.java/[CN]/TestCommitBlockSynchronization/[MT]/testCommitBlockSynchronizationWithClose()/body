{
  INodeFile file=mockFileUnderConstruction();
  Block block=new Block(blockId,length,genStamp);
  FSNamesystem namesystemSpy=makeNameSystemSpy(block,file);
  DatanodeID[] newTargets=new DatanodeID[0];
  ExtendedBlock lastBlock=new ExtendedBlock();
  namesystemSpy.commitBlockSynchronization(lastBlock,genStamp,length,true,false,newTargets,null);
  namesystemSpy.commitBlockSynchronization(lastBlock,genStamp,length,true,false,newTargets,null);
  BlockInfoContiguous completedBlockInfo=new BlockInfoContiguous(block,(short)1);
  completedBlockInfo.setBlockCollection(file);
  completedBlockInfo.setGenerationStamp(genStamp);
  doReturn(completedBlockInfo).when(namesystemSpy).getStoredBlock(any(Block.class));
  doReturn(completedBlockInfo).when(file).getLastBlock();
  namesystemSpy.commitBlockSynchronization(lastBlock,genStamp,length,true,false,newTargets,null);
}
