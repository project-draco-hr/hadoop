{
  try {
    startCleanupThreads();
    boolean denied=false;
    while (running && !shuttingDown && !denied) {
      boolean staleState=false;
      try {
        while (running && !staleState && !shuttingDown&& !denied) {
          try {
            State osState=offerService();
            if (osState == State.STALE) {
              staleState=true;
            }
 else             if (osState == State.DENIED) {
              denied=true;
            }
          }
 catch (          Exception ex) {
            if (!shuttingDown) {
              LOG.info("Lost connection to JobTracker [" + jobTrackAddr + "].  Retrying...",ex);
              try {
                Thread.sleep(5000);
              }
 catch (              InterruptedException ie) {
              }
            }
          }
        }
      }
  finally {
        close();
      }
      if (shuttingDown) {
        return;
      }
      LOG.warn("Reinitializing local state");
      initialize();
    }
    if (denied) {
      shutdown();
    }
  }
 catch (  IOException iex) {
    LOG.error("Got fatal exception while reinitializing TaskTracker: " + StringUtils.stringifyException(iex));
    return;
  }
catch (  InterruptedException i) {
    LOG.error("Got interrupted while reinitializing TaskTracker: " + i.getMessage());
    return;
  }
}
