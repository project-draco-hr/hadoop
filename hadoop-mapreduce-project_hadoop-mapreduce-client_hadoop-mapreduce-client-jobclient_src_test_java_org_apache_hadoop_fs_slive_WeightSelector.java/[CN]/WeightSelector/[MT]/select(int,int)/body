{
  List<OperationWeight> validOps=new ArrayList<OperationWeight>(operations.size());
  for (  OperationType type : operations.keySet()) {
    OperationInfo opinfo=operations.get(type);
    if (opinfo == null || opinfo.amountLeft <= 0) {
      continue;
    }
    Weightable weighter=weights.get(opinfo.distribution);
    if (weighter != null) {
      OperationWeight weightOp=new OperationWeight(opinfo.operation,weighter.weight(elapsed,duration));
      validOps.add(weightOp);
    }
 else {
      throw new RuntimeException("Unable to get weight for distribution " + opinfo.distribution);
    }
  }
  if (validOps.isEmpty()) {
    return null;
  }
  return getSelector().select(validOps);
}
