{
  LOG.debug("Processing Plan Command.");
  Preconditions.checkState(cmd.hasOption(DiskBalancer.PLAN));
  verifyCommandOptions(DiskBalancer.PLAN,cmd);
  if (cmd.getOptionValue(DiskBalancer.PLAN) == null) {
    throw new IllegalArgumentException("A node name is required to create a" + " plan.");
  }
  if (cmd.hasOption(DiskBalancer.BANDWIDTH)) {
    this.bandwidth=Integer.parseInt(cmd.getOptionValue(DiskBalancer.BANDWIDTH));
  }
  if (cmd.hasOption(DiskBalancer.MAXERROR)) {
    this.maxError=Integer.parseInt(cmd.getOptionValue(DiskBalancer.MAXERROR));
  }
  readClusterInfo(cmd);
  String output=null;
  if (cmd.hasOption(DiskBalancer.OUTFILE)) {
    output=cmd.getOptionValue(DiskBalancer.OUTFILE);
  }
  setOutputPath(output);
  DiskBalancerDataNode node=getNode(cmd.getOptionValue(DiskBalancer.PLAN));
  if (node == null) {
    throw new IllegalArgumentException("Unable to find the specified node. " + cmd.getOptionValue(DiskBalancer.PLAN));
  }
  this.thresholdPercentage=getThresholdPercentage(cmd);
  LOG.debug("threshold Percentage is {}",this.thresholdPercentage);
  setNodesToProcess(node);
  populatePathNames(node);
  NodePlan plan=null;
  List<NodePlan> plans=getCluster().computePlan(this.thresholdPercentage);
  setPlanParams(plans);
  if (plans.size() > 0) {
    plan=plans.get(0);
  }
  try (FSDataOutputStream beforeStream=create(String.format(DiskBalancer.BEFORE_TEMPLATE,cmd.getOptionValue(DiskBalancer.PLAN)))){
    beforeStream.write(getCluster().toJson().getBytes(StandardCharsets.UTF_8));
  }
   if (plan != null && plan.getVolumeSetPlans().size() > 0) {
    LOG.info("Writing plan to : {}",getOutputPath());
    try (FSDataOutputStream planStream=create(String.format(DiskBalancer.PLAN_TEMPLATE,cmd.getOptionValue(DiskBalancer.PLAN)))){
      planStream.write(plan.toJson().getBytes(StandardCharsets.UTF_8));
    }
   }
 else {
    LOG.info("No plan generated. DiskBalancing not needed for node: {} " + "threshold used: {}",cmd.getOptionValue(DiskBalancer.PLAN),this.thresholdPercentage);
  }
  if (cmd.hasOption(DiskBalancer.VERBOSE) && plans.size() > 0) {
    printToScreen(plans);
  }
}
