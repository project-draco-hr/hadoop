{
  int n=Math.min(len,userBufLen);
  if (userBuf != null && b != null)   System.arraycopy(userBuf,userBufOff,b,off,n);
  userBufOff+=n;
  userBufLen-=n;
  nwrite+=n;
  if (finish && userBufLen <= 0)   finished=true;
  return n;
}
