{
  ArgumentCaptor<RMAppAttemptState> finalState=ArgumentCaptor.forClass(RMAppAttemptState.class);
  verify(writer).applicationAttemptFinished(any(RMAppAttempt.class),finalState.capture());
  Assert.assertEquals(state,finalState.getValue());
  finalState=ArgumentCaptor.forClass(RMAppAttemptState.class);
  verify(publisher).appAttemptFinished(any(RMAppAttempt.class),finalState.capture(),any(RMApp.class),anyLong());
  Assert.assertEquals(state,finalState.getValue());
}
