{
  Container amContainer=allocateApplicationAttempt();
  launchApplicationAttempt(amContainer);
  runApplicationAttempt(amContainer,"host",8042,"oldtrackingurl",false);
  applicationAttempt.handle(new RMAppAttemptEvent(applicationAttempt.getAppAttemptId(),RMAppAttemptEventType.FAIL,FAILED_DIAGNOSTICS));
  assertEquals(RMAppAttemptState.FINAL_SAVING,applicationAttempt.getAppAttemptState());
  sendAttemptUpdateSavedEvent(applicationAttempt);
  assertEquals(RMAppAttemptState.FAILED,applicationAttempt.getAppAttemptState());
  NodeId anyNodeId=NodeId.newInstance("host",1234);
  applicationAttempt.handle(new RMAppAttemptContainerFinishedEvent(applicationAttempt.getAppAttemptId(),BuilderUtils.newContainerStatus(amContainer.getId(),ContainerState.COMPLETE,"",0,amContainer.getResource()),anyNodeId));
  assertEquals(1,applicationAttempt.getJustFinishedContainers().size());
  assertEquals(amContainer,applicationAttempt.getMasterContainer());
  assertEquals(0,application.getRanNodes().size());
  String rmAppPageUrl=pjoin(RM_WEBAPP_ADDR,"cluster","app",applicationAttempt.getAppAttemptId().getApplicationId());
  assertEquals(rmAppPageUrl,applicationAttempt.getOriginalTrackingUrl());
  assertEquals(rmAppPageUrl,applicationAttempt.getTrackingUrl());
  verifyAMHostAndPortInvalidated();
  verifyApplicationAttemptFinished(RMAppAttemptState.FAILED);
}
