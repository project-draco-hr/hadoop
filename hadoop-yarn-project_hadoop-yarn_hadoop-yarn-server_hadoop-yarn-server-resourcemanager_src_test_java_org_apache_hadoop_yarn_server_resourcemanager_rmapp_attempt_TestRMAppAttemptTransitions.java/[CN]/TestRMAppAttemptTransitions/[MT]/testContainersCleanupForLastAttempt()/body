{
  applicationAttempt=new RMAppAttemptImpl(applicationAttempt.getAppAttemptId(),rmContext,scheduler,masterService,submissionContext,new Configuration(),true);
  when(submissionContext.getKeepContainersAcrossApplicationAttempts()).thenReturn(true);
  when(submissionContext.getMaxAppAttempts()).thenReturn(1);
  Container amContainer=allocateApplicationAttempt();
  launchApplicationAttempt(amContainer);
  runApplicationAttempt(amContainer,"host",8042,"oldtrackingurl",false);
  ContainerStatus cs1=ContainerStatus.newInstance(amContainer.getId(),ContainerState.COMPLETE,"some error",123);
  ApplicationAttemptId appAttemptId=applicationAttempt.getAppAttemptId();
  applicationAttempt.handle(new RMAppAttemptContainerFinishedEvent(appAttemptId,cs1));
  assertEquals(YarnApplicationAttemptState.RUNNING,applicationAttempt.createApplicationAttemptState());
  sendAttemptUpdateSavedEvent(applicationAttempt);
  assertEquals(RMAppAttemptState.FAILED,applicationAttempt.getAppAttemptState());
  assertFalse(transferStateFromPreviousAttempt);
}
