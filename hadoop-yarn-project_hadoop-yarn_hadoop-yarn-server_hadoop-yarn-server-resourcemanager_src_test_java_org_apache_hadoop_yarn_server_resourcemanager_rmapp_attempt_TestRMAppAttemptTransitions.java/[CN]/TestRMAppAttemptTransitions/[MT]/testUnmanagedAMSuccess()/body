{
  unmanagedAM=true;
  when(submissionContext.getUnmanagedAM()).thenReturn(true);
  scheduleApplicationAttempt();
  testAppAttemptLaunchedState(null);
  verify(amLivelinessMonitor,times(1)).register(applicationAttempt.getAppAttemptId());
  runApplicationAttempt(null,"host",8042,"oldtrackingurl",true);
  applicationAttempt.handle(new RMAppAttemptContainerAcquiredEvent(applicationAttempt.getAppAttemptId(),mock(Container.class)));
  applicationAttempt.handle(new RMAppAttemptContainerFinishedEvent(applicationAttempt.getAppAttemptId(),mock(ContainerStatus.class)));
  String trackingUrl="mytrackingurl";
  String diagnostics="Successful";
  FinalApplicationStatus finalStatus=FinalApplicationStatus.SUCCEEDED;
  applicationAttempt.handle(new RMAppAttemptUnregistrationEvent(applicationAttempt.getAppAttemptId(),trackingUrl,finalStatus,diagnostics));
  testAppAttemptFinishedState(null,finalStatus,trackingUrl,diagnostics,1,true);
}
