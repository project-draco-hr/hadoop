{
  final INode referred=ref.getReferredINode();
  if (!(referred instanceof WithCount)) {
    return -1;
  }
  WithCount wc=(WithCount)referred;
  if (ref == wc.getParentReference()) {
    wc.setParent(null);
  }
  return ((WithCount)referred).decrementReferenceCount();
}
