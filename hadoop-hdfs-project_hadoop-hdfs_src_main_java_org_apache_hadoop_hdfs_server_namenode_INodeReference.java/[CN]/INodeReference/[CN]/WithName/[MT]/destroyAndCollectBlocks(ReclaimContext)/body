{
  int snapshot=getSelfSnapshot();
  reclaimContext.quotaDelta().add(computeQuotaUsage(reclaimContext.bsps));
  if (removeReference(this) <= 0) {
    getReferredINode().destroyAndCollectBlocks(reclaimContext.getCopy());
  }
 else {
    int prior=getPriorSnapshot(this);
    INode referred=getReferredINode().asReference().getReferredINode();
    if (snapshot != Snapshot.NO_SNAPSHOT_ID) {
      if (prior != Snapshot.NO_SNAPSHOT_ID && snapshot <= prior) {
        return;
      }
      ReclaimContext newCtx=reclaimContext.getCopy();
      referred.cleanSubtree(newCtx,snapshot,prior);
      INodeReference ref=getReferredINode().getParentReference();
      if (ref != null) {
        reclaimContext.quotaDelta().addUpdatePath(ref,newCtx.quotaDelta().getCountsCopy());
      }
    }
  }
}
