{
  Preconditions.checkArgument(snapshot != null);
  Preconditions.checkArgument(prior != null);
  Quota.Counts counts=getReferredINode().cleanSubtree(snapshot,prior,collectedBlocks,removedINodes);
  INodeReference ref=getReferredINode().getParentReference();
  if (ref != null) {
    ref.addSpaceConsumed(-counts.get(Quota.NAMESPACE),-counts.get(Quota.DISKSPACE),true,Snapshot.INVALID_ID);
  }
  return counts;
}
