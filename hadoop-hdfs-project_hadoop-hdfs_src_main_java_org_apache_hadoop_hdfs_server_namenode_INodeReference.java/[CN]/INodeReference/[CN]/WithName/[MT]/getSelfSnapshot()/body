{
  INode referred=getReferredINode().asReference().getReferredINode();
  Snapshot snapshot=null;
  if (referred.isFile() && referred.asFile().isWithSnapshot()) {
    snapshot=referred.asFile().getDiffs().getPrior(lastSnapshotId);
  }
 else   if (referred instanceof INodeDirectoryWithSnapshot) {
    snapshot=((INodeDirectoryWithSnapshot)referred).getDiffs().getPrior(lastSnapshotId);
  }
  return snapshot;
}
