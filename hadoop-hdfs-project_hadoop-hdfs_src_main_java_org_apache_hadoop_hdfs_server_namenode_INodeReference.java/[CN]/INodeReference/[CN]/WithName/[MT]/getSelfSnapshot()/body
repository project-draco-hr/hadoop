{
  INode referred=getReferredINode().asReference().getReferredINode();
  Snapshot snapshot=null;
  if (referred instanceof FileWithSnapshot) {
    snapshot=((FileWithSnapshot)referred).getDiffs().getPrior(lastSnapshotId);
  }
 else   if (referred instanceof INodeDirectoryWithSnapshot) {
    snapshot=((INodeDirectoryWithSnapshot)referred).getDiffs().getPrior(lastSnapshotId);
  }
  return snapshot;
}
