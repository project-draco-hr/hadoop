{
  INode referred=getReferredINode().asReference().getReferredINode();
  int snapshot=Snapshot.NO_SNAPSHOT_ID;
  if (referred.isFile() && referred.asFile().isWithSnapshot()) {
    snapshot=referred.asFile().getDiffs().getPrior(lastSnapshotId);
  }
 else   if (referred.isDirectory()) {
    DirectoryWithSnapshotFeature sf=referred.asDirectory().getDirectoryWithSnapshotFeature();
    if (sf != null) {
      snapshot=sf.getDiffs().getPrior(lastSnapshotId);
    }
  }
  return snapshot;
}
