{
  super(ContainerManagerImpl.class.getName());
  this.context=context;
  this.dirsHandler=dirsHandler;
  dispatcher=new AsyncDispatcher();
  this.deletionService=deletionContext;
  this.metrics=metrics;
  rsrcLocalizationSrvc=createResourceLocalizationService(exec,deletionContext,context);
  addService(rsrcLocalizationSrvc);
  containersLauncher=createContainersLauncher(context,exec);
  addService(containersLauncher);
  this.nodeStatusUpdater=nodeStatusUpdater;
  auxiliaryServices=new AuxServices();
  auxiliaryServices.registerServiceListener(this);
  addService(auxiliaryServices);
  Configuration conf=context.getConf();
  if (YarnConfiguration.timelineServiceV2Enabled(conf) && YarnConfiguration.systemMetricsPublisherEnabled(conf)) {
    LOG.info("YARN system metrics publishing service is enabled");
    nmMetricsPublisher=createNMTimelinePublisher(context);
    context.setNMTimelinePublisher(nmMetricsPublisher);
  }
  this.containersMonitor=new ContainersMonitorImpl(exec,dispatcher,this.context);
  addService(this.containersMonitor);
  dispatcher.register(ContainerEventType.class,new ContainerEventDispatcher());
  dispatcher.register(ApplicationEventType.class,createApplicationEventDispatcher());
  dispatcher.register(LocalizationEventType.class,new LocalizationEventHandlerWrapper(rsrcLocalizationSrvc,nmMetricsPublisher));
  dispatcher.register(AuxServicesEventType.class,auxiliaryServices);
  dispatcher.register(ContainersMonitorEventType.class,containersMonitor);
  dispatcher.register(ContainersLauncherEventType.class,containersLauncher);
  addService(dispatcher);
  ReentrantReadWriteLock lock=new ReentrantReadWriteLock();
  this.readLock=lock.readLock();
  this.writeLock=lock.writeLock();
}
