{
  Map<ContainerId,Container> containers=context.getContainers();
  if (containers.isEmpty()) {
    return;
  }
  LOG.info("Containers still running on " + CMgrCompletedContainersEvent.Reason.ON_NODEMANAGER_RESYNC + " : "+ containers.keySet());
  List<ContainerId> containerIds=new ArrayList<ContainerId>(containers.keySet());
  LOG.info("Waiting for containers to be killed");
  this.handle(new CMgrCompletedContainersEvent(containerIds,CMgrCompletedContainersEvent.Reason.ON_NODEMANAGER_RESYNC));
  boolean allContainersCompleted=false;
  while (!containers.isEmpty() && !allContainersCompleted) {
    allContainersCompleted=true;
    for (    Entry<ContainerId,Container> container : containers.entrySet()) {
      if (((ContainerImpl)container.getValue()).getCurrentState() != ContainerState.COMPLETE) {
        allContainersCompleted=false;
        try {
          Thread.sleep(1000);
        }
 catch (        InterruptedException ex) {
          LOG.warn("Interrupted while sleeping on container kill on resync",ex);
        }
        break;
      }
    }
  }
  if (allContainersCompleted) {
    LOG.info("All containers in DONE state");
  }
 else {
    LOG.info("Done waiting for containers to be killed. Still alive: " + containers.keySet());
  }
}
