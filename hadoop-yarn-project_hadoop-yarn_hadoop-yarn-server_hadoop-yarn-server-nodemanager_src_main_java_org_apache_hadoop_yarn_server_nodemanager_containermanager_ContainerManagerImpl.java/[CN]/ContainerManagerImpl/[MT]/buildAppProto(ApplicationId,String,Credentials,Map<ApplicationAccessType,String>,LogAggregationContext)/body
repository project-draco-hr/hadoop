{
  ContainerManagerApplicationProto.Builder builder=ContainerManagerApplicationProto.newBuilder();
  builder.setId(((ApplicationIdPBImpl)appId).getProto());
  builder.setUser(user);
  if (logAggregationContext != null) {
    builder.setLogAggregationContext(((LogAggregationContextPBImpl)logAggregationContext).getProto());
  }
  builder.clearCredentials();
  if (credentials != null) {
    DataOutputBuffer dob=new DataOutputBuffer();
    try {
      credentials.writeTokenStorageToStream(dob);
      builder.setCredentials(ByteString.copyFrom(dob.getData()));
    }
 catch (    IOException e) {
      LOG.error("Cannot serialize credentials",e);
    }
  }
  builder.clearAcls();
  if (appAcls != null) {
    for (    Map.Entry<ApplicationAccessType,String> acl : appAcls.entrySet()) {
      ApplicationACLMapProto p=ApplicationACLMapProto.newBuilder().setAccessType(ProtoUtils.convertToProtoFormat(acl.getKey())).setAcl(acl.getValue()).build();
      builder.addAcls(p);
    }
  }
  return builder.build();
}
