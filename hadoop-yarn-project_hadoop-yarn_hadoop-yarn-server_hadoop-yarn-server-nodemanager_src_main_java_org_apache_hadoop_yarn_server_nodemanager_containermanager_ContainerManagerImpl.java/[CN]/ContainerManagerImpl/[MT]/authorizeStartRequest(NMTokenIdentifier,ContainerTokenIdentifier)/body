{
  ContainerId containerId=containerTokenIdentifier.getContainerID();
  String containerIDStr=containerId.toString();
  boolean unauthorized=false;
  StringBuilder messageBuilder=new StringBuilder("Unauthorized request to start container. ");
  if (!nmTokenIdentifier.getApplicationAttemptId().getApplicationId().equals(containerId.getApplicationAttemptId().getApplicationId())) {
    unauthorized=true;
    messageBuilder.append("\nNMToken for application attempt : ").append(nmTokenIdentifier.getApplicationAttemptId()).append(" was used for starting container with container token").append(" issued for application attempt : ").append(containerId.getApplicationAttemptId());
  }
 else   if (!this.context.getContainerTokenSecretManager().isValidStartContainerRequest(containerTokenIdentifier)) {
    unauthorized=true;
    messageBuilder.append("\n Attempt to relaunch the same ").append("container with id ").append(containerIDStr).append(".");
  }
 else   if (containerTokenIdentifier.getExpiryTimeStamp() < System.currentTimeMillis()) {
    unauthorized=true;
    messageBuilder.append("\nThis token is expired. current time is ").append(System.currentTimeMillis()).append(" found ").append(containerTokenIdentifier.getExpiryTimeStamp());
    messageBuilder.append("\nNote: System times on machines may be out of sync.").append(" Check system time and time zones.");
  }
  if (unauthorized) {
    String msg=messageBuilder.toString();
    LOG.error(msg);
    throw RPCUtil.getRemoteException(msg);
  }
}
