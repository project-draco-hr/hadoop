{
  ApplicationId appId=new ApplicationIdPBImpl(p.getId());
  Credentials creds=new Credentials();
  creds.readTokenStorageStream(new DataInputStream(p.getCredentials().newInput()));
  List<ApplicationACLMapProto> aclProtoList=p.getAclsList();
  Map<ApplicationAccessType,String> acls=new HashMap<ApplicationAccessType,String>(aclProtoList.size());
  for (  ApplicationACLMapProto aclProto : aclProtoList) {
    acls.put(ProtoUtils.convertFromProtoFormat(aclProto.getAccessType()),aclProto.getAcl());
  }
  LOG.info("Recovering application " + appId);
  ApplicationImpl app=new ApplicationImpl(dispatcher,p.getUser(),appId,creds,context);
  context.getApplications().put(appId,app);
  app.handle(new ApplicationInitEvent(appId,acls));
}
