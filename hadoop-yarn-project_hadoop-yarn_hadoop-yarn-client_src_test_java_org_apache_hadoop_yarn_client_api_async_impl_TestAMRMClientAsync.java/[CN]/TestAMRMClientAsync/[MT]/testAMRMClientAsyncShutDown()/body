{
  Configuration conf=new Configuration();
  TestCallbackHandler callbackHandler=new TestCallbackHandler();
  @SuppressWarnings("unchecked") AMRMClient<ContainerRequest> client=mock(AMRMClientImpl.class);
  createAllocateResponse(new ArrayList<ContainerStatus>(),new ArrayList<Container>(),null);
  when(client.allocate(anyFloat())).thenThrow(new ApplicationAttemptNotFoundException("app not found, shut down"));
  AMRMClientAsync<ContainerRequest> asyncClient=AMRMClientAsync.createAMRMClientAsync(client,10,callbackHandler);
  asyncClient.init(conf);
  asyncClient.start();
  asyncClient.registerApplicationMaster("localhost",1234,null);
  Thread.sleep(50);
  verify(client,times(1)).allocate(anyFloat());
  asyncClient.stop();
}
