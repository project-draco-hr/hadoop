{
  int sequenceNum;
  int id;
  DelegationKey key;
  long now=System.currentTimeMillis();
synchronized (this) {
    id=currentId;
    key=currentKey;
    sequenceNum=++delegationTokenSequenceNumber;
  }
  identifier.setIssueDate(now);
  identifier.setMaxDate(now + tokenMaxLifetime);
  identifier.setMasterKeyId(id);
  identifier.setSequenceNumber(sequenceNum);
  byte[] password=createPassword(identifier.getBytes(),key.getKey());
synchronized (currentTokens) {
    currentTokens.put(identifier,new DelegationTokenInformation(now + tokenRenewInterval,password));
  }
  return password;
}
