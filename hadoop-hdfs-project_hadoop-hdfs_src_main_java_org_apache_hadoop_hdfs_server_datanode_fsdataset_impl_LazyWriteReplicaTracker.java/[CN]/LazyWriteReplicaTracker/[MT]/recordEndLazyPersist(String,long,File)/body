{
  Map<Long,ReplicaState> map=replicaMaps.get(bpid);
  ReplicaState replicaState=map.get(blockId);
  if (replicaState == null) {
    throw new IllegalStateException("Unknown replica bpid=" + bpid + "; blockId="+ blockId);
  }
  replicaState.state=State.LAZY_PERSIST_COMPLETE;
  replicaState.savedBlockFile=savedBlockFile;
  if (replicasNotPersisted.peek() == replicaState) {
    replicasNotPersisted.remove();
  }
 else {
    replicasNotPersisted.remove(replicaState);
  }
  replicasPersisted.put(replicaState,System.currentTimeMillis() / 1000);
}
