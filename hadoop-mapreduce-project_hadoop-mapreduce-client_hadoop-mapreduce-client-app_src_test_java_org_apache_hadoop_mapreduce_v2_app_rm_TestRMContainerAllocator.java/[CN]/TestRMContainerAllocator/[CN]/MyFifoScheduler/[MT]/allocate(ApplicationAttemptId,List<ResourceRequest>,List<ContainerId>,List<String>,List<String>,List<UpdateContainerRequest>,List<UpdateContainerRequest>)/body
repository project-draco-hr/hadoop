{
  List<ResourceRequest> askCopy=new ArrayList<ResourceRequest>();
  for (  ResourceRequest req : ask) {
    ResourceRequest reqCopy=ResourceRequest.newInstance(req.getPriority(),req.getResourceName(),req.getCapability(),req.getNumContainers(),req.getRelaxLocality());
    askCopy.add(reqCopy);
  }
  SecurityUtil.setTokenServiceUseIp(false);
  lastAsk=ask;
  lastRelease=release;
  lastBlacklistAdditions=blacklistAdditions;
  lastBlacklistRemovals=blacklistRemovals;
  Allocation allocation=super.allocate(applicationAttemptId,askCopy,release,blacklistAdditions,blacklistRemovals,increaseRequests,decreaseRequests);
  if (forceResourceLimit != null) {
    allocation.setResourceLimit(forceResourceLimit);
  }
  return allocation;
}
