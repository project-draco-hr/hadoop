{
  INode inode=store.retrieveINode(makeAbsolute(file));
  if (inode != null) {
    if (overwrite) {
      delete(file,true);
    }
 else {
      throw new FileAlreadyExistsException("File already exists: " + file);
    }
  }
 else {
    Path parent=file.getParent();
    if (parent != null) {
      if (!mkdirs(parent)) {
        throw new IOException("Mkdirs failed to create " + parent.toString());
      }
    }
  }
  return new FSDataOutputStream(new S3OutputStream(getConf(),store,makeAbsolute(file),blockSize,progress,bufferSize),statistics);
}
