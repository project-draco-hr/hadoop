{
  Configuration conf=new Configuration();
  conf.set(YarnConfiguration.IPC_RPC_IMPL,HadoopYarnProtoRPC.class.getName());
  YarnRPC rpc=YarnRPC.create(conf);
  String bindAddr="localhost:0";
  InetSocketAddress addr=NetUtils.createSocketAddr(bindAddr);
  Server server=rpc.getServer(CollectorNodemanagerProtocol.class,new DummyNMCollectorService(),addr,conf,null,1);
  server.start();
  ApplicationClientProtocol unknownProxy=(ApplicationClientProtocol)rpc.getProxy(ApplicationClientProtocol.class,NetUtils.getConnectAddress(server),conf);
  try {
    unknownProxy.getNewApplication(Records.newRecord(GetNewApplicationRequest.class));
    Assert.fail("Excepted RPC call to fail with unknown method.");
  }
 catch (  YarnException e) {
    Assert.assertTrue(e.getMessage().matches("Unknown method getNewApplication called on.*" + "org.apache.hadoop.yarn.proto.ApplicationClientProtocol" + "\\$ApplicationClientProtocolService\\$BlockingInterface protocol."));
  }
catch (  Exception e) {
    e.printStackTrace();
  }
  CollectorNodemanagerProtocol proxy=(CollectorNodemanagerProtocol)rpc.getProxy(CollectorNodemanagerProtocol.class,NetUtils.getConnectAddress(server),conf);
  try {
    ReportNewCollectorInfoRequest request=ReportNewCollectorInfoRequest.newInstance(DEFAULT_APP_ID,DEFAULT_COLLECTOR_ADDR);
    proxy.reportNewCollectorInfo(request);
  }
 catch (  YarnException e) {
    Assert.fail("RPC call failured is not expected here.");
  }
  try {
    proxy.reportNewCollectorInfo(Records.newRecord(ReportNewCollectorInfoRequest.class));
    Assert.fail("Excepted RPC call to fail with YarnException.");
  }
 catch (  YarnException e) {
    Assert.assertTrue(e.getMessage().contains(ILLEGAL_NUMBER_MESSAGE));
  }
  try {
    GetTimelineCollectorContextRequest request=GetTimelineCollectorContextRequest.newInstance(ApplicationId.newInstance(0,1));
    GetTimelineCollectorContextResponse response=proxy.getTimelineCollectorContext(request);
    Assert.assertEquals("test_user_id",response.getUserId());
    Assert.assertEquals("test_flow_name",response.getFlowName());
    Assert.assertEquals("test_flow_version",response.getFlowVersion());
    Assert.assertEquals(12345678L,response.getFlowRunId());
  }
 catch (  YarnException|IOException e) {
    Assert.fail("RPC call failured is not expected here.");
  }
  try {
    GetTimelineCollectorContextRequest request=GetTimelineCollectorContextRequest.newInstance(ApplicationId.newInstance(0,2));
    proxy.getTimelineCollectorContext(request);
    Assert.fail("RPC call failured is expected here.");
  }
 catch (  YarnException|IOException e) {
    Assert.assertTrue(e instanceof YarnException);
    Assert.assertTrue(e.getMessage().contains("The application is not found."));
  }
  server.stop();
}
