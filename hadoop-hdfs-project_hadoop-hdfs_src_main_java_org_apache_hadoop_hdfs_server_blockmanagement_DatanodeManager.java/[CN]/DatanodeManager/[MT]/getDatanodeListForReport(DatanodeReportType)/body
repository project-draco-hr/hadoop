{
  final boolean listLiveNodes=type == DatanodeReportType.ALL || type == DatanodeReportType.LIVE;
  final boolean listDeadNodes=type == DatanodeReportType.ALL || type == DatanodeReportType.DEAD;
  final boolean listDecommissioningNodes=type == DatanodeReportType.ALL || type == DatanodeReportType.DECOMMISSIONING;
  ArrayList<DatanodeDescriptor> nodes;
  final HostSet foundNodes=new HostSet();
  final Iterable<InetSocketAddress> includedNodes=hostConfigManager.getIncludes();
synchronized (this) {
    nodes=new ArrayList<>(datanodeMap.size());
    for (    DatanodeDescriptor dn : datanodeMap.values()) {
      final boolean isDead=isDatanodeDead(dn);
      final boolean isDecommissioning=dn.isDecommissionInProgress();
      if (((listLiveNodes && !isDead) || (listDeadNodes && isDead) || (listDecommissioningNodes && isDecommissioning)) && hostConfigManager.isIncluded(dn)) {
        nodes.add(dn);
      }
      foundNodes.add(dn.getResolvedAddress());
    }
  }
  Collections.sort(nodes);
  if (listDeadNodes) {
    for (    InetSocketAddress addr : includedNodes) {
      if (foundNodes.matchedBy(addr)) {
        continue;
      }
      DatanodeDescriptor dn=new DatanodeDescriptor(new DatanodeID(addr.getAddress().getHostAddress(),addr.getHostName(),"",addr.getPort() == 0 ? defaultXferPort : addr.getPort(),defaultInfoPort,defaultInfoSecurePort,defaultIpcPort));
      setDatanodeDead(dn);
      if (hostConfigManager.isExcluded(dn)) {
        dn.setDecommissioned();
      }
      nodes.add(dn);
    }
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("getDatanodeListForReport with " + "includedNodes = " + hostConfigManager.getIncludes() + ", excludedNodes = "+ hostConfigManager.getExcludes()+ ", foundNodes = "+ foundNodes+ ", nodes = "+ nodes);
  }
  return nodes;
}
