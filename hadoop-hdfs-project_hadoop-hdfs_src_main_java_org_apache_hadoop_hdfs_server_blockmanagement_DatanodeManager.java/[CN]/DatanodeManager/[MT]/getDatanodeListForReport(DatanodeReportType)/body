{
  boolean listLiveNodes=type == DatanodeReportType.ALL || type == DatanodeReportType.LIVE;
  boolean listDeadNodes=type == DatanodeReportType.ALL || type == DatanodeReportType.DEAD;
  ArrayList<DatanodeDescriptor> nodes;
  final HostFileManager.HostSet foundNodes=new HostFileManager.HostSet();
  final HostFileManager.HostSet includedNodes=hostFileManager.getIncludes();
  final HostFileManager.HostSet excludedNodes=hostFileManager.getExcludes();
synchronized (datanodeMap) {
    nodes=new ArrayList<DatanodeDescriptor>(datanodeMap.size());
    for (    DatanodeDescriptor dn : datanodeMap.values()) {
      final boolean isDead=isDatanodeDead(dn);
      if ((listLiveNodes && !isDead) || (listDeadNodes && isDead)) {
        nodes.add(dn);
      }
      foundNodes.add(HostFileManager.resolvedAddressFromDatanodeID(dn));
    }
  }
  if (listDeadNodes) {
    for (    InetSocketAddress addr : includedNodes) {
      if (foundNodes.matchedBy(addr) || excludedNodes.match(addr)) {
        continue;
      }
      DatanodeDescriptor dn=new DatanodeDescriptor(new DatanodeID(addr.getAddress().getHostAddress(),addr.getHostName(),"",addr.getPort() == 0 ? defaultXferPort : addr.getPort(),defaultInfoPort,defaultInfoSecurePort,defaultIpcPort));
      dn.setLastUpdate(0);
      nodes.add(dn);
    }
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("getDatanodeListForReport with " + "includedNodes = " + hostFileManager.getIncludes() + ", excludedNodes = "+ hostFileManager.getExcludes()+ ", foundNodes = "+ foundNodes+ ", nodes = "+ nodes);
  }
  return nodes;
}
