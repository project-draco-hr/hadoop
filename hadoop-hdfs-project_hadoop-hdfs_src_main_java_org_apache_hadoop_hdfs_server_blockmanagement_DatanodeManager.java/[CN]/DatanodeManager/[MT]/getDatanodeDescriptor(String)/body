{
  DatanodeDescriptor node=null;
  int colon=address.indexOf(":");
  int xferPort;
  String host=address;
  if (colon > 0) {
    host=address.substring(0,colon);
    xferPort=Integer.parseInt(address.substring(colon + 1));
    node=getDatanodeByXferAddr(host,xferPort);
  }
  if (node == null) {
    node=getDatanodeByHost(host);
  }
  if (node == null) {
    String networkLocation=resolveNetworkLocation(host);
    List<Node> rackNodes=getNetworkTopology().getDatanodesInRack(networkLocation);
    if (rackNodes != null) {
      for (      Node rackNode : rackNodes) {
        if (((DatanodeDescriptor)rackNode).getIpAddr().equals(host)) {
          node=(DatanodeDescriptor)rackNode;
          break;
        }
      }
      if (node == null && !rackNodes.isEmpty()) {
        node=(DatanodeDescriptor)(rackNodes.get(DFSUtil.getRandom().nextInt(rackNodes.size())));
      }
    }
    if (node == null) {
      node=(DatanodeDescriptor)getNetworkTopology().chooseRandom(NodeBase.ROOT);
    }
  }
  return node;
}
