{
  Node client=getDatanodeByHost(targethost);
  if (client == null) {
    List<String> hosts=new ArrayList<String>(1);
    hosts.add(targethost);
    String rName=dnsToSwitchMapping.resolve(hosts).get(0);
    if (rName != null)     client=new NodeBase(rName + NodeBase.PATH_SEPARATOR_STR + targethost);
  }
  Comparator<DatanodeInfo> comparator=avoidStaleDataNodesForRead ? new DFSUtil.DecomStaleComparator(staleInterval) : DFSUtil.DECOM_COMPARATOR;
  for (  LocatedBlock b : locatedblocks) {
    DatanodeInfo[] di=b.getLocations();
    Arrays.sort(di,comparator);
    int lastActiveIndex=di.length - 1;
    while (lastActiveIndex > 0 && isInactive(di[lastActiveIndex])) {
      --lastActiveIndex;
    }
    int activeLen=lastActiveIndex + 1;
    networktopology.sortByDistance(client,b.getLocations(),activeLen);
    b.updateCachedStorageInfo();
  }
}
