{
  final Map<String,DatanodeDescriptor> copy;
synchronized (this) {
    copy=new HashMap<>(datanodeMap);
  }
  for (  DatanodeDescriptor node : copy.values()) {
    if (!hostConfigManager.isIncluded(node)) {
      node.setDisallowed(true);
    }
 else {
      long maintenanceExpireTimeInMS=hostConfigManager.getMaintenanceExpirationTimeInMS(node);
      if (node.maintenanceNotExpired(maintenanceExpireTimeInMS)) {
        decomManager.startMaintenance(node,maintenanceExpireTimeInMS);
      }
 else       if (hostConfigManager.isExcluded(node)) {
        decomManager.startDecommission(node);
      }
 else {
        decomManager.stopMaintenance(node);
        decomManager.stopDecommission(node);
      }
    }
    node.setUpgradeDomain(hostConfigManager.getUpgradeDomain(node));
  }
}
