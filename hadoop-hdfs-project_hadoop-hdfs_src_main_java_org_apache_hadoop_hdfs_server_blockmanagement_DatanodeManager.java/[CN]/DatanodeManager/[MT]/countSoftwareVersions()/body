{
synchronized (this) {
    datanodesSoftwareVersions.clear();
    for (    DatanodeDescriptor dn : datanodeMap.values()) {
      if (shouldCountVersion(dn)) {
        Integer num=datanodesSoftwareVersions.get(dn.getSoftwareVersion());
        num=num == null ? 1 : num + 1;
        datanodesSoftwareVersions.put(dn.getSoftwareVersion(),num);
      }
    }
  }
}
