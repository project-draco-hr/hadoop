{
synchronized (datanodeMap) {
    HashMap<String,Integer> versionCount=new HashMap<String,Integer>();
    for (    DatanodeDescriptor dn : datanodeMap.values()) {
      if (shouldCountVersion(dn)) {
        Integer num=versionCount.get(dn.getSoftwareVersion());
        num=num == null ? 1 : num + 1;
        versionCount.put(dn.getSoftwareVersion(),num);
      }
    }
    this.datanodesSoftwareVersions=versionCount;
  }
}
