{
  int cellSize=ecPolicy.getCellSize();
  int dataBlkNum=ecPolicy.getNumDataUnits();
  List<DatanodeID> failedList=new ArrayList<>();
  for (  BlockRecord r : rurList) {
    int blockIndex=(int)(r.rInfo.getBlockId() & BLOCK_GROUP_INDEX_MASK);
    long newSize=getInternalBlockLength(safeLength,cellSize,dataBlkNum,blockIndex);
    try {
      r.updateReplicaUnderRecovery(bpid,recoveryId,r.rInfo.getBlockId(),newSize);
    }
 catch (    IOException e) {
      InterDatanodeProtocol.LOG.warn("Failed to updateBlock (newblock=" + ", datanode=" + r.id + ")",e);
      failedList.add(r.id);
    }
  }
  if (!failedList.isEmpty()) {
    throw new IOException("Cannot recover " + block + ", the following datanodes failed: "+ failedList);
  }
}
