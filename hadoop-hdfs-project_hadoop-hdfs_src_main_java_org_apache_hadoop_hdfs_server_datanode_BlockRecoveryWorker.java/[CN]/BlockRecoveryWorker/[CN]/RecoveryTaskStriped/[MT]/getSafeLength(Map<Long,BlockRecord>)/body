{
  final int cellSize=ecPolicy.getCellSize();
  final int dataBlkNum=ecPolicy.getNumDataUnits();
  Preconditions.checkArgument(syncBlocks.size() >= dataBlkNum);
  final int stripeSize=dataBlkNum * cellSize;
  long[] blockLengths=new long[syncBlocks.size()];
  int i=0;
  for (  BlockRecord r : syncBlocks.values()) {
    ReplicaRecoveryInfo rInfo=r.getReplicaRecoveryInfo();
    blockLengths[i++]=rInfo.getNumBytes();
  }
  Arrays.sort(blockLengths);
  int lastFullStripeIdx=(int)(blockLengths[blockLengths.length - dataBlkNum] / cellSize);
  return lastFullStripeIdx * stripeSize;
}
