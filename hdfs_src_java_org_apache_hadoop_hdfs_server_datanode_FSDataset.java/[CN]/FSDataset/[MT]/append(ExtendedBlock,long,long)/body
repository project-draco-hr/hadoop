{
  if (newGS < b.getGenerationStamp()) {
    throw new IOException("The new generation stamp " + newGS + " should be greater than the replica "+ b+ "'s generation stamp");
  }
  ReplicaInfo replicaInfo=getReplicaInfo(b);
  DataNode.LOG.info("Appending to replica " + replicaInfo);
  if (replicaInfo.getState() != ReplicaState.FINALIZED) {
    throw new ReplicaNotFoundException(ReplicaNotFoundException.UNFINALIZED_REPLICA + b);
  }
  if (replicaInfo.getNumBytes() != expectedBlockLen) {
    throw new IOException("Corrupted replica " + replicaInfo + " with a length of "+ replicaInfo.getNumBytes()+ " expected length is "+ expectedBlockLen);
  }
  return append(b.getBlockPoolId(),(FinalizedReplica)replicaInfo,newGS,b.getNumBytes());
}
