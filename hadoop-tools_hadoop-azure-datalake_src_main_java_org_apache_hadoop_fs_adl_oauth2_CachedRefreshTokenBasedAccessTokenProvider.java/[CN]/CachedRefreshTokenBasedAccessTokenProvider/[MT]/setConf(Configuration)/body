{
  String id=conf.get(OAUTH_CLIENT_ID_KEY);
  if (null == id) {
    throw new IllegalArgumentException("Missing client ID");
  }
synchronized (CACHE) {
    instance=CACHE.get(id);
    if (null == instance || conf.getBoolean(FORCE_REFRESH,false) || replace(instance,conf)) {
      instance=newInstance();
      instance.setConf(new Configuration(conf));
      CACHE.put(id,instance);
      LOG.debug("Created new client {}",id);
    }
  }
}
