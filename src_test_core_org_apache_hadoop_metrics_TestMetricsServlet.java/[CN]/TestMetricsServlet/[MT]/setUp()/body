{
  nc1=new NoEmitMetricsContext();
  nc1.init("test1",ContextFactory.getFactory());
  nc2=new NoEmitMetricsContext();
  nc2.init("test2",ContextFactory.getFactory());
  contexts=new ArrayList<MetricsContext>();
  contexts.add(nc1);
  contexts.add(nc2);
  MetricsRecord r=nc1.createRecord("testRecord");
  r.setTag("testTag1","testTagValue1");
  r.setTag("testTag2","testTagValue2");
  r.setMetric("testMetric1",1);
  r.setMetric("testMetric2",33);
  r.update();
  Map<String,Collection<OutputRecord>> m=nc1.getAllRecords();
  assertEquals(1,m.size());
  assertEquals(1,m.values().size());
  Collection<OutputRecord> outputRecords=m.values().iterator().next();
  assertEquals(1,outputRecords.size());
  outputRecord=outputRecords.iterator().next();
}
