{
  if (UserGroupInformation.isSecurityEnabled()) {
    UserGroupInformation ugi=null;
    try {
      ugi=UserGroupInformation.getLoginUser();
    }
 catch (    IOException e) {
      LOG.fatal("Exception while getting login user",e);
      e.printStackTrace();
      Runtime.getRuntime().exit(-1);
    }
    return ugi.doAs(action);
  }
 else {
    return action.run();
  }
}
