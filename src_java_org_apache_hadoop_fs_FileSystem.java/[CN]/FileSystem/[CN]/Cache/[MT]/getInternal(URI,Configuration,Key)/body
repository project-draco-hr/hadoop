{
  FileSystem fs=map.get(key);
  if (fs == null) {
    fs=createFileSystem(uri,conf);
    if (map.isEmpty() && !clientFinalizer.isAlive()) {
      Runtime.getRuntime().addShutdownHook(clientFinalizer);
    }
    fs.key=key;
    map.put(key,fs);
    if (conf.getBoolean("fs.automatic.close",true)) {
      toAutoClose.add(key);
    }
  }
  return fs;
}
