{
  List<IOException> exceptions=new ArrayList<IOException>();
  for (; !map.isEmpty(); ) {
    Map.Entry<Key,FileSystem> e=map.entrySet().iterator().next();
    final Key key=e.getKey();
    final FileSystem fs=e.getValue();
    remove(key,fs);
    if (fs != null) {
      try {
        fs.close();
      }
 catch (      IOException ioe) {
        exceptions.add(ioe);
      }
    }
  }
  if (!exceptions.isEmpty()) {
    throw MultipleIOException.createIOException(exceptions);
  }
}
