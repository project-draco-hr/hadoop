{
  this.conf=conf;
  storage=new NNStorage(conf,imageDirs,editsDirs);
  if (conf.getBoolean(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_RESTORE_KEY,DFSConfigKeys.DFS_NAMENODE_NAME_DIR_RESTORE_DEFAULT)) {
    storage.setRestoreFailedStorage(true);
  }
  this.editLog=new FSEditLog(conf,storage,editsDirs);
  String nameserviceId=DFSUtil.getNamenodeNameServiceId(conf);
  if (!HAUtil.isHAEnabled(conf,nameserviceId)) {
    editLog.initJournalsForWrite();
  }
 else {
    editLog.initSharedJournalsForRead();
  }
  archivalManager=new NNStorageRetentionManager(conf,storage,editLog);
}
