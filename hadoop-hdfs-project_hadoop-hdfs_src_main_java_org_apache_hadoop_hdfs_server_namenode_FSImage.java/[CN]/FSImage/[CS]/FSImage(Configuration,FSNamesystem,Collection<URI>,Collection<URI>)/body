{
  this.conf=conf;
  setCheckpointDirectories(FSImage.getCheckpointDirs(conf,null),FSImage.getCheckpointEditsDirs(conf,null));
  storage=new NNStorage(conf,imageDirs,editsDirs);
  if (conf.getBoolean(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_RESTORE_KEY,DFSConfigKeys.DFS_NAMENODE_NAME_DIR_RESTORE_DEFAULT)) {
    storage.setRestoreFailedStorage(true);
  }
  this.editLog=new FSEditLog(storage);
  setFSNamesystem(ns);
  archivalManager=new NNStorageRetentionManager(conf,storage,editLog);
}
