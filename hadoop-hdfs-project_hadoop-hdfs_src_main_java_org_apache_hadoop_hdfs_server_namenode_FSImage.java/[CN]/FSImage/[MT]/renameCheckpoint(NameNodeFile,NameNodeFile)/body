{
  ArrayList<StorageDirectory> al=null;
  FSImageTransactionalStorageInspector inspector=new FSImageTransactionalStorageInspector(EnumSet.of(fromNnf));
  storage.inspectStorageDirs(inspector);
  for (  FSImageFile image : inspector.getFoundImages()) {
    try {
      renameImageFileInDir(image.sd,fromNnf,toNnf,image.txId,true);
    }
 catch (    IOException ioe) {
      LOG.warn("Unable to rename checkpoint in " + image.sd,ioe);
      if (al == null) {
        al=Lists.newArrayList();
      }
      al.add(image.sd);
    }
  }
  if (al != null) {
    storage.reportErrorsOnDirectories(al);
  }
}
