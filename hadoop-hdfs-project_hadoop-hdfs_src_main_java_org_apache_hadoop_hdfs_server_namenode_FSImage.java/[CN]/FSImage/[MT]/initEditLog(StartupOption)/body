{
  Preconditions.checkState(getNamespaceID() != 0,"Must know namespace ID before initting edit log");
  String nameserviceId=DFSUtil.getNamenodeNameServiceId(conf);
  if (!HAUtil.isHAEnabled(conf,nameserviceId)) {
    editLog.initJournalsForWrite();
    editLog.recoverUnclosedStreams();
  }
 else   if (HAUtil.isHAEnabled(conf,nameserviceId) && (startOpt == StartupOption.UPGRADE || RollingUpgradeStartupOption.ROLLBACK.matches(startOpt))) {
    editLog.initJournalsForWrite();
    if (startOpt == StartupOption.UPGRADE) {
      long sharedLogCTime=editLog.getSharedLogCTime();
      if (this.storage.getCTime() < sharedLogCTime) {
        throw new IOException("It looks like the shared log is already " + "being upgraded but this NN has not been upgraded yet. You " + "should restart this NameNode with the '" + StartupOption.BOOTSTRAPSTANDBY.getName() + "' option to bring "+ "this NN in sync with the other.");
      }
    }
    editLog.recoverUnclosedStreams();
  }
 else {
    editLog.initSharedJournalsForRead();
  }
}
