{
  Collection<URI> checkpointDirs=FSImage.getCheckpointDirs(conf,null);
  List<URI> checkpointEditsDirs=FSImage.getCheckpointEditsDirs(conf,null);
  if (checkpointDirs == null || checkpointDirs.isEmpty()) {
    throw new IOException("Cannot import image from a checkpoint. " + "\"dfs.namenode.checkpoint.dir\" is not set.");
  }
  if (checkpointEditsDirs == null || checkpointEditsDirs.isEmpty()) {
    throw new IOException("Cannot import image from a checkpoint. " + "\"dfs.namenode.checkpoint.dir\" is not set.");
  }
  FSImage realImage=target.getFSImage();
  FSImage ckptImage=new FSImage(conf,checkpointDirs,checkpointEditsDirs);
  target.dir.fsImage=ckptImage;
  try {
    ckptImage.recoverTransitionRead(StartupOption.REGULAR,target,null);
  }
  finally {
    ckptImage.close();
  }
  realImage.getStorage().setStorageInfo(ckptImage.getStorage());
  realImage.getEditLog().setNextTxId(ckptImage.getEditLog().getLastWrittenTxId() + 1);
  realImage.initEditLog(StartupOption.IMPORT);
  target.dir.fsImage=realImage;
  realImage.getStorage().setBlockPoolID(ckptImage.getBlockPoolID());
  saveNamespace(target);
  getStorage().writeAll();
}
