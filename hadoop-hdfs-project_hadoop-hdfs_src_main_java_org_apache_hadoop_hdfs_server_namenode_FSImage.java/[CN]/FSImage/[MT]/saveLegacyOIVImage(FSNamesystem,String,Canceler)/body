{
  FSImageCompression compression=FSImageCompression.createCompression(conf);
  long txid=getLastAppliedOrWrittenTxId();
  SaveNamespaceContext ctx=new SaveNamespaceContext(source,txid,canceler);
  FSImageFormat.Saver saver=new FSImageFormat.Saver(ctx);
  String imageFileName=NNStorage.getLegacyOIVImageFileName(txid);
  File imageFile=new File(targetDir,imageFileName);
  saver.save(imageFile,compression);
  archivalManager.purgeOldLegacyOIVImages(targetDir,txid);
}
