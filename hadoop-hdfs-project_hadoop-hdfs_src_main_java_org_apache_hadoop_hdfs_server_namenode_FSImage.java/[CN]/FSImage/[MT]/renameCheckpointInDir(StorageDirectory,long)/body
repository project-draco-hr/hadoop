{
  File ckpt=NNStorage.getStorageFile(sd,NameNodeFile.IMAGE_NEW,txid);
  File curFile=NNStorage.getStorageFile(sd,NameNodeFile.IMAGE,txid);
  if (LOG.isDebugEnabled()) {
    LOG.debug("renaming  " + ckpt.getAbsolutePath() + " to "+ curFile.getAbsolutePath());
  }
  if (!ckpt.renameTo(curFile)) {
    if (!curFile.delete() || !ckpt.renameTo(curFile)) {
      throw new IOException("renaming  " + ckpt.getAbsolutePath() + " to "+ curFile.getAbsolutePath()+ " FAILED");
    }
  }
}
