{
  HftpFileSystem hfs=mock(HftpFileSystem.class);
  DelegationTokenSecretManager dtSecretManager=dfsCluster.getNamesystem().getDelegationTokenSecretManager();
  String renewer="renewer";
  jConf.set(JTConfig.JT_USER_NAME,renewer);
  DelegationTokenIdentifier dtId=new DelegationTokenIdentifier(new Text("user"),new Text(renewer),null);
  final Token<DelegationTokenIdentifier> t=new Token<DelegationTokenIdentifier>(dtId,dtSecretManager);
  final URI uri=new URI("hftp://host:2222/file1");
  final String fs_addr=SecurityUtil.buildDTServiceName(uri,NameNode.DEFAULT_PORT);
  t.setService(new Text(fs_addr));
  Mockito.doAnswer(new Answer<URI>(){
    @Override public URI answer(    InvocationOnMock invocation) throws Throwable {
      return uri;
    }
  }
).when(hfs).getUri();
  Mockito.doAnswer(new Answer<Token<DelegationTokenIdentifier>>(){
    @Override public Token<DelegationTokenIdentifier> answer(    InvocationOnMock invocation) throws Throwable {
      return t;
    }
  }
).when(hfs).getDelegationToken(renewer);
  Mockito.doAnswer(new Answer<String>(){
    @Override public String answer(    InvocationOnMock invocation) throws Throwable {
      return fs_addr;
    }
  }
).when(hfs).getCanonicalServiceName();
  Credentials credentials=new Credentials();
  Path p=new Path(uri.toString());
  System.out.println("Path for hftp=" + p + "; fs_addr="+ fs_addr+ "; rn="+ renewer);
  TokenCache.obtainTokensForNamenodesInternal(hfs,credentials,jConf);
  Collection<Token<? extends TokenIdentifier>> tns=credentials.getAllTokens();
  assertEquals("number of tokens is not 1",1,tns.size());
  boolean found=false;
  for (  Token<? extends TokenIdentifier> tt : tns) {
    System.out.println("token=" + tt);
    if (tt.getKind().equals(DelegationTokenIdentifier.HDFS_DELEGATION_KIND) && tt.getService().equals(new Text(fs_addr))) {
      found=true;
      assertEquals("different token",tt,t);
    }
    assertTrue("didn't find token for " + p,found);
  }
}
