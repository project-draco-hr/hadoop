{
  final NameNode nn=NameNodeHttpServer.getNameNodeFromContext(context);
  final Configuration conf=(Configuration)context.getAttribute(JspHelper.CURRENT_CONF);
  FSNamesystem fsn=nn.getNamesystem();
  DatanodeID datanode=null;
  if (fsn != null && fsn.getNumLiveDataNodes() >= 1) {
    datanode=getRandomDatanode(nn);
  }
  if (datanode == null) {
    throw new IOException("Can't browse the DFS since there are no " + "live nodes available to redirect to.");
  }
  UserGroupInformation ugi=JspHelper.getUGI(context,request,conf);
  String tokenString=getDelegationToken(nn.getRpcServer(),request,conf,ugi);
  InetSocketAddress rpcAddr=nn.getNameNodeAddress();
  String rpcHost=rpcAddr.getAddress().isAnyLocalAddress() ? URI.create(request.getRequestURL().toString()).getHost() : rpcAddr.getAddress().getHostAddress();
  String addr=rpcHost + ":" + rpcAddr.getPort();
  final String redirectLocation=JspHelper.Url.url(request.getScheme(),datanode) + "/browseDirectory.jsp?namenodeInfoPort=" + request.getServerPort()+ "&dir=/"+ (tokenString == null ? "" : JspHelper.getDelegationTokenUrlParam(tokenString))+ JspHelper.getUrlParam(JspHelper.NAMENODE_ADDRESS,addr);
  resp.sendRedirect(redirectLocation);
}
