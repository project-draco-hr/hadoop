{
  final NameNode nn=NameNodeHttpServer.getNameNodeFromContext(context);
  final Configuration conf=(Configuration)context.getAttribute(JspHelper.CURRENT_CONF);
  final DatanodeID datanode=getRandomDatanode(nn);
  UserGroupInformation ugi=JspHelper.getUGI(context,request,conf);
  String tokenString=getDelegationToken(nn.getRpcServer(),request,conf,ugi);
  final String redirectLocation;
  final String nodeToRedirect;
  int redirectPort;
  if (datanode != null) {
    nodeToRedirect=datanode.getHost();
    redirectPort=datanode.getInfoPort();
  }
 else {
    nodeToRedirect=nn.getHttpAddress().getHostName();
    redirectPort=nn.getHttpAddress().getPort();
  }
  String addr=NameNode.getHostPortString(nn.getNameNodeAddress());
  String fqdn=InetAddress.getByName(nodeToRedirect).getCanonicalHostName();
  redirectLocation="http://" + fqdn + ":"+ redirectPort+ "/browseDirectory.jsp?namenodeInfoPort="+ nn.getHttpAddress().getPort()+ "&dir=/"+ (tokenString == null ? "" : JspHelper.getDelegationTokenUrlParam(tokenString))+ JspHelper.getUrlParam(JspHelper.NAMENODE_ADDRESS,addr);
  resp.sendRedirect(redirectLocation);
}
