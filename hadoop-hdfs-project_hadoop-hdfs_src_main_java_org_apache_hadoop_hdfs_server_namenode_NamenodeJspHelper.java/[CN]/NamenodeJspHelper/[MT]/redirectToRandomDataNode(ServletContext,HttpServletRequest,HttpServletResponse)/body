{
  final NameNode nn=NameNodeHttpServer.getNameNodeFromContext(context);
  final Configuration conf=(Configuration)context.getAttribute(JspHelper.CURRENT_CONF);
  FSNamesystem fsn=nn.getNamesystem();
  if (fsn == null || fsn.getNumLiveDataNodes() < 1) {
    throw new IOException("Can't browse the DFS since there are no " + "live nodes available to redirect to.");
  }
  final DatanodeID datanode=getRandomDatanode(nn);
  ;
  UserGroupInformation ugi=JspHelper.getUGI(context,request,conf);
  String tokenString=getDelegationToken(nn.getRpcServer(),request,conf,ugi);
  final String redirectLocation;
  final String nodeToRedirect;
  int redirectPort;
  if (datanode != null) {
    nodeToRedirect=datanode.getIpAddr();
    redirectPort=datanode.getInfoPort();
  }
 else {
    nodeToRedirect=nn.getHttpAddress().getHostName();
    redirectPort=nn.getHttpAddress().getPort();
  }
  InetSocketAddress rpcAddr=nn.getNameNodeAddress();
  String rpcHost=rpcAddr.getAddress().isAnyLocalAddress() ? URI.create(request.getRequestURL().toString()).getHost() : rpcAddr.getAddress().getHostAddress();
  String addr=rpcHost + ":" + rpcAddr.getPort();
  String fqdn=InetAddress.getByName(nodeToRedirect).getCanonicalHostName();
  redirectLocation=HttpConfig.getSchemePrefix() + fqdn + ":"+ redirectPort+ "/browseDirectory.jsp?namenodeInfoPort="+ nn.getHttpAddress().getPort()+ "&dir=/"+ (tokenString == null ? "" : JspHelper.getDelegationTokenUrlParam(tokenString))+ JspHelper.getUrlParam(JspHelper.NAMENODE_ADDRESS,addr);
  resp.sendRedirect(redirectLocation);
}
