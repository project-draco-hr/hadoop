{
  if (factory != null) {
    ZKDatabase zkDb=factory.getZooKeeperServer().getZKDatabase();
    factory.shutdown();
    try {
      zkDb.close();
    }
 catch (    IOException ie) {
    }
    final int PORT=Integer.parseInt(hostPort.split(":")[1]);
    Assert.assertTrue("waiting for server down",waitForServerDown("127.0.0.1:" + PORT,CONNECTION_TIMEOUT));
  }
}
