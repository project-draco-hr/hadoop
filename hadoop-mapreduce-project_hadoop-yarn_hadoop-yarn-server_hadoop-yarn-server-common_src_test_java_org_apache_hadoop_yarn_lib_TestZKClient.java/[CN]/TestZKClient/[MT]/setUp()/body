{
  System.setProperty("zookeeper.preAllocSize","100");
  FileTxnLog.setPreallocSize(100 * 1024);
  if (!BASETEST.exists()) {
    BASETEST.mkdirs();
  }
  File dataDir=createTmpDir(BASETEST);
  ZooKeeperServer zks=new ZooKeeperServer(dataDir,dataDir,3000);
  final int PORT=Integer.parseInt(hostPort.split(":")[1]);
  if (factory == null) {
    factory=new NIOServerCnxn.Factory(new InetSocketAddress(PORT),maxCnxns);
  }
  factory.startup(zks);
  Assert.assertTrue("waiting for server up",waitForServerUp("127.0.0.1:" + PORT,CONNECTION_TIMEOUT));
}
