{
  LOG.info("Construct a shard writer");
  this.fs=fs;
  localFs=FileSystem.getLocal(iconf.getConfiguration());
  perm=new Path(shard.getDirectory());
  temp=new Path(tempDir);
  long initGeneration=shard.getGeneration();
  if (!fs.exists(perm)) {
    assert(initGeneration < 0);
    fs.mkdirs(perm);
  }
 else {
    restoreGeneration(fs,perm,initGeneration);
  }
  dir=new MixedDirectory(fs,perm,localFs,fs.startLocalOutput(perm,temp),iconf.getConfiguration());
  writer=new IndexWriter(dir,false,null,initGeneration < 0 ? new KeepOnlyLastCommitDeletionPolicy() : new MixedDeletionPolicy());
  setParameters(iconf);
}
