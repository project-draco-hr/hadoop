{
  try {
    FileStatus[] fileStatus=localFs.listStatus(temp,LuceneIndexFileNameFilter.getFilter());
    Path segmentsPath=null;
    Path segmentsGenPath=null;
    for (int i=0; i < fileStatus.length; i++) {
      Path path=fileStatus[i].getPath();
      String name=path.getName();
      if (LuceneUtil.isSegmentsGenFile(name)) {
        assert(segmentsGenPath == null);
        segmentsGenPath=path;
      }
 else       if (LuceneUtil.isSegmentsFile(name)) {
        assert(segmentsPath == null);
        segmentsPath=path;
      }
 else {
        fs.completeLocalOutput(new Path(perm,name),path);
      }
    }
    if (segmentsPath != null) {
      fs.completeLocalOutput(new Path(perm,segmentsPath.getName()),segmentsPath);
    }
    if (segmentsGenPath != null) {
      fs.completeLocalOutput(new Path(perm,segmentsGenPath.getName()),segmentsGenPath);
    }
  }
  finally {
    localFs.delete(temp,true);
  }
}
