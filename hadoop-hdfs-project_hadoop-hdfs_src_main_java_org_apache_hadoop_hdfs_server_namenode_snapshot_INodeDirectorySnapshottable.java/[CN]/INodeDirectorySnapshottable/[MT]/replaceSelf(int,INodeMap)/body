{
  if (latestSnapshotId == Snapshot.CURRENT_STATE_ID) {
    Preconditions.checkState(getDirectoryWithSnapshotFeature().getLastSnapshotId() == Snapshot.CURRENT_STATE_ID,"this=%s",this);
  }
  INodeDirectory dir=replaceSelf4INodeDirectory(inodeMap);
  if (latestSnapshotId != Snapshot.CURRENT_STATE_ID) {
    dir.recordModification(latestSnapshotId);
  }
  return dir;
}
