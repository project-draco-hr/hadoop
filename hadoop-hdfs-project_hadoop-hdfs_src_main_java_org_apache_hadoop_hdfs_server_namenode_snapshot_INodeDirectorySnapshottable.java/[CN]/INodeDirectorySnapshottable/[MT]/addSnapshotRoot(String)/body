{
  if (snapshots.size() + 1 > snapshotQuota) {
    throw new SnapshotException("Failed to add snapshot: there are already " + snapshots.size() + " snapshot(s) and the snapshot quota is "+ snapshotQuota);
  }
  final INodeDirectorySnapshotRoot r=new INodeDirectorySnapshotRoot(name,this);
  snapshots.add(r);
  final long timestamp=Time.now();
  r.setModificationTime(timestamp);
  setModificationTime(timestamp);
  return r;
}
