{
  INode inode=wn.getReferredINode();
  final LinkedList<byte[]> ancestors=Lists.newLinkedList();
  while (inode != null) {
    if (inode == this) {
      return ancestors.toArray(new byte[ancestors.size()][]);
    }
    if (inode instanceof INodeReference.WithCount) {
      inode=((WithCount)inode).getParentRef(snapshotId);
    }
 else {
      INode parent=inode.getParentReference() != null ? inode.getParentReference() : inode.getParent();
      if (parent != null && parent instanceof INodeDirectory) {
        int sid=parent.asDirectory().searchChild(inode);
        if (sid < snapshotId) {
          return null;
        }
      }
      if (!(parent instanceof WithCount)) {
        ancestors.addFirst(inode.getLocalNameBytes());
      }
      inode=parent;
    }
  }
  return null;
}
