{
  Set<URI> ret=new HashSet<URI>();
  Set<URI> nonPreferredUris=new HashSet<URI>();
  for (  String nsId : DFSUtilClient.getNameServiceIds(conf)) {
    if (HAUtil.isHAEnabled(conf,nsId)) {
      try {
        ret.add(new URI(HdfsConstants.HDFS_URI_SCHEME + "://" + nsId));
      }
 catch (      URISyntaxException ue) {
        throw new IllegalArgumentException(ue);
      }
    }
 else {
      boolean uriFound=false;
      for (      String key : keys) {
        String addr=conf.get(DFSUtilClient.concatSuffixes(key,nsId));
        if (addr != null) {
          URI uri=createUri(HdfsConstants.HDFS_URI_SCHEME,NetUtils.createSocketAddr(addr));
          if (!uriFound) {
            uriFound=true;
            ret.add(uri);
          }
 else {
            nonPreferredUris.add(uri);
          }
        }
      }
    }
  }
  boolean uriFound=false;
  for (  String key : keys) {
    String addr=conf.get(key);
    if (addr != null) {
      URI uri=createUri("hdfs",NetUtils.createSocketAddr(addr));
      if (!uriFound) {
        uriFound=true;
        ret.add(uri);
      }
 else {
        nonPreferredUris.add(uri);
      }
    }
  }
  if (!uriFound) {
    URI defaultUri=FileSystem.getDefaultUri(conf);
    if (defaultUri != null && (defaultUri.getPort() != -1)) {
      defaultUri=createUri(defaultUri.getScheme(),NetUtils.createSocketAddr(defaultUri.getHost(),defaultUri.getPort()));
    }
    if (defaultUri != null && HdfsConstants.HDFS_URI_SCHEME.equals(defaultUri.getScheme()) && !nonPreferredUris.contains(defaultUri)) {
      ret.add(defaultUri);
    }
  }
  return ret;
}
