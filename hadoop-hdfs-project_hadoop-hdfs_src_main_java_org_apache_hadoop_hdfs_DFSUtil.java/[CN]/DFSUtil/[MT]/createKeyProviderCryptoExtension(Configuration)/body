{
  final String providerUriStr=conf.get(DFSConfigKeys.DFS_ENCRYPTION_KEY_PROVIDER_URI,null);
  if (providerUriStr == null) {
    return null;
  }
  final URI providerUri;
  try {
    providerUri=new URI(providerUriStr);
  }
 catch (  URISyntaxException e) {
    throw new IOException(e);
  }
  KeyProvider keyProvider=KeyProviderFactory.get(providerUri,conf);
  if (keyProvider == null) {
    throw new IOException("Could not instantiate KeyProvider from " + DFSConfigKeys.DFS_ENCRYPTION_KEY_PROVIDER_URI + " setting of '"+ providerUriStr+ "'");
  }
  if (keyProvider.isTransient()) {
    throw new IOException("KeyProvider " + keyProvider.toString() + " was found but it is a transient provider.");
  }
  KeyProviderCryptoExtension cryptoProvider=KeyProviderCryptoExtension.createKeyProviderCryptoExtension(keyProvider);
  return cryptoProvider;
}
