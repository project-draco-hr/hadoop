{
  conf.setBoolean(YarnConfiguration.NM_RECOVERY_ENABLED,false);
  TrafficController trafficController=new TrafficController(conf,privilegedOperationExecutorMock);
  try {
    trafficController.bootstrap(DEVICE,ROOT_BANDWIDTH_MBIT,YARN_BANDWIDTH_MBIT);
    int classId=trafficController.getNextClassId();
    Assert.assertTrue(classId >= MIN_CONTAINER_CLASS_ID);
    Assert.assertEquals(String.format(FORMAT_CONTAINER_CLASS_STR,classId),trafficController.getStringForNetClsClassId(classId));
    TrafficController.BatchBuilder builder=trafficController.new BatchBuilder(PrivilegedOperation.OperationType.TC_MODIFY_STATE).addContainerClass(classId,CONTAINER_BANDWIDTH_MBIT,false);
    PrivilegedOperation addClassOp=builder.commitBatchToTempFile();
    String expectedAddClassCmd=String.format(FORMAT_ADD_CONTAINER_CLASS_TO_DEVICE,classId,YARN_BANDWIDTH_MBIT);
    verifyTrafficControlOperation(addClassOp,PrivilegedOperation.OperationType.TC_MODIFY_STATE,Arrays.asList(expectedAddClassCmd));
    TrafficController.BatchBuilder strictModeBuilder=trafficController.new BatchBuilder(PrivilegedOperation.OperationType.TC_MODIFY_STATE).addContainerClass(classId,CONTAINER_BANDWIDTH_MBIT,true);
    PrivilegedOperation addClassStrictModeOp=strictModeBuilder.commitBatchToTempFile();
    String expectedAddClassStrictModeCmd=String.format(FORMAT_ADD_CONTAINER_CLASS_TO_DEVICE,classId,CONTAINER_BANDWIDTH_MBIT);
    verifyTrafficControlOperation(addClassStrictModeOp,PrivilegedOperation.OperationType.TC_MODIFY_STATE,Arrays.asList(expectedAddClassStrictModeCmd));
    TrafficController.BatchBuilder deleteBuilder=trafficController.new BatchBuilder(PrivilegedOperation.OperationType.TC_MODIFY_STATE).deleteContainerClass(classId);
    PrivilegedOperation deleteClassOp=deleteBuilder.commitBatchToTempFile();
    String expectedDeleteClassCmd=String.format(FORAMT_DELETE_CONTAINER_CLASS_FROM_DEVICE,classId);
    verifyTrafficControlOperation(deleteClassOp,PrivilegedOperation.OperationType.TC_MODIFY_STATE,Arrays.asList(expectedDeleteClassCmd));
  }
 catch (  ResourceHandlerException|IOException e) {
    LOG.error("Unexpected exception: " + e);
    Assert.fail("Caught unexpected exception: " + e.getClass().getSimpleName());
  }
}
