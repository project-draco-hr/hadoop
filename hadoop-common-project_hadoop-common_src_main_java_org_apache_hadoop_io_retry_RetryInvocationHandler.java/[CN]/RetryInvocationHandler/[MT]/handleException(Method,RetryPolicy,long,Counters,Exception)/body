{
  final RetryInfo retryInfo=RetryInfo.newRetryInfo(policy,ex,counters,proxyDescriptor.idempotentOrAtMostOnce(method));
  counters.retries++;
  if (retryInfo.fail != null) {
    if (retryInfo.fail.reason != null) {
      LOG.warn("Exception while invoking " + proxyDescriptor.getProxyInfo().getString(method.getName()) + ". Not retrying because "+ retryInfo.fail.reason,ex);
    }
    throw ex;
  }
  final boolean isFailover=retryInfo.failover != null;
  log(method,isFailover,counters.failovers,retryInfo.delay,ex);
  if (retryInfo.delay > 0) {
    try {
      Thread.sleep(retryInfo.delay);
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      LOG.warn("Interrupted while waiting to retry",e);
      InterruptedIOException intIOE=new InterruptedIOException("Retry interrupted");
      intIOE.initCause(e);
      throw intIOE;
    }
  }
  if (isFailover) {
    proxyDescriptor.failover(expectedFailoverCount,method);
    counters.failovers++;
  }
}
