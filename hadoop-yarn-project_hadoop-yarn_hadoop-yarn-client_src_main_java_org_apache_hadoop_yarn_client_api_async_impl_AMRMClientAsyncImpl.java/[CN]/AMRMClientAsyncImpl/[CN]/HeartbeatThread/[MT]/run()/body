{
  while (true) {
    AllocateResponse response=null;
synchronized (unregisterHeartbeatLock) {
      if (!keepRunning) {
        return;
      }
      try {
        response=client.allocate(progress);
      }
 catch (      ApplicationAttemptNotFoundException e) {
        handler.onShutdownRequest();
        LOG.info("Shutdown requested. Stopping callback.");
        return;
      }
catch (      Throwable ex) {
        LOG.error("Exception on heartbeat",ex);
        savedException=ex;
        handlerThread.interrupt();
        return;
      }
      if (response != null) {
        while (true) {
          try {
            responseQueue.put(response);
            break;
          }
 catch (          InterruptedException ex) {
            LOG.debug("Interrupted while waiting to put on response queue",ex);
          }
        }
      }
    }
    try {
      Thread.sleep(heartbeatIntervalMs.get());
    }
 catch (    InterruptedException ex) {
      LOG.debug("Heartbeater interrupted",ex);
    }
  }
}
