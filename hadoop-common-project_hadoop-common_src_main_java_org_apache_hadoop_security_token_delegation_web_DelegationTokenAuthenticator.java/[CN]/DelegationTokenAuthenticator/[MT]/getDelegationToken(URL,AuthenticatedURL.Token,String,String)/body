{
  Map json=doDelegationTokenOperation(url,token,DelegationTokenOperation.GETDELEGATIONTOKEN,renewer,null,true,doAsUser);
  json=(Map)json.get(DELEGATION_TOKEN_JSON);
  String tokenStr=(String)json.get(DELEGATION_TOKEN_URL_STRING_JSON);
  Token<AbstractDelegationTokenIdentifier> dToken=new Token<AbstractDelegationTokenIdentifier>();
  dToken.decodeFromUrlString(tokenStr);
  InetSocketAddress service=new InetSocketAddress(url.getHost(),url.getPort());
  SecurityUtil.setTokenService(dToken,service);
  return dToken;
}
