{
  MockitoAnnotations.initMocks(this);
  DirContext ctx=getContext();
  doReturn(ctx).when(groupsMapping).getDirContext();
  when(ctx.search(Mockito.anyString(),Mockito.anyString(),Mockito.any(Object[].class),Mockito.any(SearchControls.class))).thenReturn(userNames);
  when(userNames.hasMoreElements()).thenReturn(true);
  SearchResult groupSearchResult=mock(SearchResult.class);
  when(groupNames.hasMoreElements()).thenReturn(true,true,false);
  when(groupNames.nextElement()).thenReturn(groupSearchResult);
  Attribute group1Attr=new BasicAttribute("cn");
  group1Attr.add(testGroups[0]);
  Attributes group1Attrs=new BasicAttributes();
  group1Attrs.put(group1Attr);
  Attribute group2Attr=new BasicAttribute("cn");
  group2Attr.add(testGroups[1]);
  Attributes group2Attrs=new BasicAttributes();
  group2Attrs.put(group2Attr);
  when(groupSearchResult.getAttributes()).thenReturn(group1Attrs,group2Attrs);
  when(getUserNames().nextElement()).thenReturn(getUserSearchResult());
  when(getUserSearchResult().getAttributes()).thenReturn(getAttributes());
}
