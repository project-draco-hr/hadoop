{
  LeafQueue lq=mock(LeafQueue.class);
  List<ApplicationAttemptId> appAttemptIdList=new ArrayList<ApplicationAttemptId>();
  when(lq.getTotalResourcePending()).thenReturn(Resource.newInstance(pending[i],0));
  ResourceUsage ru=new ResourceUsage();
  ru.setPending(Resource.newInstance(pending[i],0));
  when(lq.getQueueResourceUsage()).thenReturn(ru);
  final NavigableSet<FiCaSchedulerApp> qApps=new TreeSet<FiCaSchedulerApp>(new Comparator<FiCaSchedulerApp>(){
    @Override public int compare(    FiCaSchedulerApp a1,    FiCaSchedulerApp a2){
      return a1.getApplicationAttemptId().compareTo(a2.getApplicationAttemptId());
    }
  }
);
  if (apps[i] != 0) {
    int aUsed=used[i] / apps[i];
    int aPending=pending[i] / apps[i];
    int aReserve=reserved[i] / apps[i];
    for (int a=0; a < apps[i]; ++a) {
      FiCaSchedulerApp mockFiCaApp=mockApp(i,appAlloc,aUsed,aPending,aReserve,gran[i]);
      qApps.add(mockFiCaApp);
      ++appAlloc;
      appAttemptIdList.add(mockFiCaApp.getApplicationAttemptId());
    }
    when(mCS.getAppsInQueue("queue" + (char)('A' + i - 1))).thenReturn(appAttemptIdList);
  }
  when(lq.getApplications()).thenReturn(qApps);
  @SuppressWarnings("unchecked") OrderingPolicy<FiCaSchedulerApp> so=mock(OrderingPolicy.class);
  when(so.getPreemptionIterator()).thenAnswer(new Answer(){
    public Object answer(    InvocationOnMock invocation){
      return qApps.descendingIterator();
    }
  }
);
  when(lq.getOrderingPolicy()).thenReturn(so);
  if (setAMResourcePercent != 0.0f) {
    when(lq.getMaxAMResourcePerQueuePercent()).thenReturn(setAMResourcePercent);
  }
  p.getChildQueues().add(lq);
  return lq;
}
