{
  if (reservedContainer != null) {
    application.unreserve(schedulerKey,node,reservedContainer);
  }
  RMContainer allocatedContainer=application.allocate(allocationResult.containerNodeType,node,schedulerKey,lastResourceRequest,container);
  if (allocatedContainer == null) {
    ContainerAllocation ret=new ContainerAllocation(allocationResult.containerToBeUnreserved,null,AllocationState.APP_SKIPPED);
    ActivitiesLogger.APP.recordAppActivityWithoutAllocation(activitiesManager,node,application,schedulerKey.getPriority(),ActivityDiagnosticConstant.FAIL_TO_ALLOCATE,ActivityState.REJECTED);
    return ret;
  }
  node.allocateContainer(allocatedContainer);
  application.incNumAllocatedContainers(allocationResult.containerNodeType,allocationResult.requestNodeType);
  return allocationResult;
}
