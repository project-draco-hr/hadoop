{
  if (UserGroupInformation.isSecurityEnabled()) {
    if (!hasReceivedTimelineDelegtionToken && getTimelineDelegtionTokenAttempts < MAX_GET_TIMELINE_DELEGATION_TOKEN_ATTEMPTS) {
      try {
        Token<TimelineDelegationTokenIdentifier> token=client.getDelegationToken(UserGroupInformation.getCurrentUser().getUserName());
        UserGroupInformation.getCurrentUser().addToken(token);
        hasReceivedTimelineDelegtionToken=true;
      }
 catch (      Exception e) {
        LOG.error("Error happens when getting timeline delegation token",e);
      }
 finally {
        ++getTimelineDelegtionTokenAttempts;
        if (!hasReceivedTimelineDelegtionToken && getTimelineDelegtionTokenAttempts == MAX_GET_TIMELINE_DELEGATION_TOKEN_ATTEMPTS) {
          LOG.error("Run out of the attempts to get timeline delegation token. " + "Use kerberos authentication only.");
        }
      }
    }
  }
  try {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Publishing the entity " + entity.getEntityId() + ", JSON-style content: "+ TimelineUtils.dumpTimelineRecordtoJSON(entity));
    }
    client.putEntities(entity);
  }
 catch (  Exception e) {
    LOG.error("Error when publishing entity [" + entity.getEntityType() + ","+ entity.getEntityId()+ "]",e);
  }
}
