{
  auxService=createCollectorAndAddApplication();
  assertTrue(auxService.hasApplication(appAttemptId.getApplicationId()));
  ContainerId containerId=getAMContainerId();
  ContainerTerminationContext context=mock(ContainerTerminationContext.class);
  when(context.getContainerId()).thenReturn(containerId);
  when(context.getContainerType()).thenReturn(ContainerType.APPLICATION_MASTER);
  auxService.stopContainer(context);
  assertTrue(auxService.hasApplication(appAttemptId.getApplicationId()));
  for (int i=0; i < 4; i++) {
    Thread.sleep(500L);
    if (!auxService.hasApplication(appAttemptId.getApplicationId())) {
      break;
    }
  }
  assertFalse(auxService.hasApplication(appAttemptId.getApplicationId()));
  auxService.close();
}
