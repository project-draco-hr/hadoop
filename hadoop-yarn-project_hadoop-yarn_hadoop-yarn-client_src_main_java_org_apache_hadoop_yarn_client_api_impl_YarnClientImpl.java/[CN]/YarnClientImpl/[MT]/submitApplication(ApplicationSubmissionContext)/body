{
  ApplicationId applicationId=appContext.getApplicationId();
  if (applicationId == null) {
    throw new ApplicationIdNotProvidedException("ApplicationId is not provided in ApplicationSubmissionContext");
  }
  SubmitApplicationRequest request=Records.newRecord(SubmitApplicationRequest.class);
  request.setApplicationSubmissionContext(appContext);
  if (isSecurityEnabled() && timelineServiceEnabled) {
    addTimelineDelegationToken(appContext.getAMContainerSpec());
  }
  rmClient.submitApplication(request);
  int pollCount=0;
  long startTime=System.currentTimeMillis();
  EnumSet<YarnApplicationState> waitingStates=EnumSet.of(YarnApplicationState.NEW,YarnApplicationState.NEW_SAVING,YarnApplicationState.SUBMITTED);
  EnumSet<YarnApplicationState> failToSubmitStates=EnumSet.of(YarnApplicationState.FAILED,YarnApplicationState.KILLED);
  while (true) {
    try {
      ApplicationReport appReport=getApplicationReport(applicationId);
      YarnApplicationState state=appReport.getYarnApplicationState();
      if (!waitingStates.contains(state)) {
        if (failToSubmitStates.contains(state)) {
          throw new YarnException("Failed to submit " + applicationId + " to YARN : "+ appReport.getDiagnostics());
        }
        LOG.info("Submitted application " + applicationId);
        break;
      }
      long elapsedMillis=System.currentTimeMillis() - startTime;
      if (enforceAsyncAPITimeout() && elapsedMillis >= asyncApiPollTimeoutMillis) {
        throw new YarnException("Timed out while waiting for application " + applicationId + " to be submitted successfully");
      }
      if (++pollCount % 10 == 0) {
        LOG.info("Application submission is not finished, " + "submitted application " + applicationId + " is still in "+ state);
      }
      try {
        Thread.sleep(submitPollIntervalMillis);
      }
 catch (      InterruptedException ie) {
        String msg="Interrupted while waiting for application " + applicationId + " to be successfully submitted.";
        LOG.error(msg);
        throw new YarnException(msg,ie);
      }
    }
 catch (    ApplicationNotFoundException ex) {
      LOG.info("Re-submit application " + applicationId + "with the "+ "same ApplicationSubmissionContext");
      rmClient.submitApplication(request);
    }
  }
  return applicationId;
}
