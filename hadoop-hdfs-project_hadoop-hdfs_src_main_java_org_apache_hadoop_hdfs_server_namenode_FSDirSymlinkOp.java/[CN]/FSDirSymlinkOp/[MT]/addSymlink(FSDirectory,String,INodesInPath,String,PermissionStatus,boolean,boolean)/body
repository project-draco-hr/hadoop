{
  final long mtime=now();
  final byte[] localName=iip.getLastLocalName();
  if (createParent) {
    Map.Entry<INodesInPath,String> e=FSDirMkdirOp.createAncestorDirectories(fsd,iip,dirPerms);
    if (e == null) {
      return null;
    }
    iip=INodesInPath.append(e.getKey(),null,localName);
  }
  final String userName=dirPerms.getUserName();
  long id=fsd.allocateNewInodeId();
  PermissionStatus perm=new PermissionStatus(userName,null,FsPermission.getDefault());
  INodeSymlink newNode=unprotectedAddSymlink(fsd,iip.getExistingINodes(),localName,id,target,mtime,mtime,perm);
  if (newNode == null) {
    NameNode.stateChangeLog.info("addSymlink: failed to add " + path);
    return null;
  }
  fsd.getEditLog().logSymlink(path,target,mtime,mtime,newNode,logRetryCache);
  if (NameNode.stateChangeLog.isDebugEnabled()) {
    NameNode.stateChangeLog.debug("addSymlink: " + path + " is added");
  }
  return newNode;
}
