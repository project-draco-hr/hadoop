{
  waitForDiskHealthCheck();
  List<String> list=localORLogDirs ? dirsHandler.getLocalDirs() : dirsHandler.getLogDirs();
  String seenDirs=StringUtils.join(",",list);
  LOG.info("ExpectedDirs=" + expectedDirs);
  LOG.info("SeenDirs=" + seenDirs);
  Assert.assertTrue("NodeManager could not identify disk failure.",expectedDirs.equals(seenDirs));
  Assert.assertEquals("Node's health in terms of disks is wrong",isHealthy,dirsHandler.areDisksHealthy());
  for (int i=0; i < 10; i++) {
    Iterator<RMNode> iter=yarnCluster.getResourceManager().getRMContext().getRMNodes().values().iterator();
    if ((iter.next().getState() != NodeState.UNHEALTHY) == isHealthy) {
      break;
    }
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      LOG.error("Interrupted while waiting for NM->RM heartbeat.");
    }
  }
  Iterator<RMNode> iter=yarnCluster.getResourceManager().getRMContext().getRMNodes().values().iterator();
  Assert.assertEquals("RM is not updated with the health status of a node",isHealthy,iter.next().getState() != NodeState.UNHEALTHY);
}
