{
  if (nodeLocalityThreshold > 1.0) {
    nodeLocalityThreshold=1.0;
  }
  if (rackLocalityThreshold > 1.0) {
    rackLocalityThreshold=1.0;
  }
  if (nodeLocalityThreshold < 0.0 || rackLocalityThreshold < 0.0) {
    return NodeType.OFF_SWITCH;
  }
  if (!allowedLocalityLevel.containsKey(priority)) {
    allowedLocalityLevel.put(priority,NodeType.NODE_LOCAL);
    return NodeType.NODE_LOCAL;
  }
  NodeType allowed=allowedLocalityLevel.get(priority);
  if (allowed.equals(NodeType.OFF_SWITCH))   return NodeType.OFF_SWITCH;
  double threshold=allowed.equals(NodeType.NODE_LOCAL) ? nodeLocalityThreshold : rackLocalityThreshold;
  if (this.getSchedulingOpportunities(priority) > (numNodes * threshold)) {
    if (allowed.equals(NodeType.NODE_LOCAL)) {
      allowedLocalityLevel.put(priority,NodeType.RACK_LOCAL);
      this.resetSchedulingOpportunities(priority);
    }
 else     if (allowed.equals(NodeType.RACK_LOCAL)) {
      allowedLocalityLevel.put(priority,NodeType.OFF_SWITCH);
      this.resetSchedulingOpportunities(priority);
    }
  }
  return allowedLocalityLevel.get(priority);
}
