{
  String cluster="cluster2";
  String user="user2";
  String flow="flow_name2";
  TimelineEntities te=new TimelineEntities();
  TimelineEntity entityApp1=TestFlowDataGenerator.getEntityMetricsApp1(System.currentTimeMillis());
  entityApp1.setCreatedTime(1425016501000L);
  te.addEntity(entityApp1);
  HBaseTimelineWriterImpl hbi=null;
  Configuration c1=util.getConfiguration();
  try {
    hbi=new HBaseTimelineWriterImpl(c1);
    hbi.init(c1);
    hbi.write(cluster,user,flow,"CF7022C10F1354",1002345678919L,"application_11111111111111_1111",te);
    te=new TimelineEntities();
    TimelineEntity entityApp2=TestFlowDataGenerator.getEntityMetricsApp2(System.currentTimeMillis());
    entityApp2.setCreatedTime(1425016502000L);
    te.addEntity(entityApp2);
    hbi.write(cluster,user,flow,"CF7022C10F1354",1002345678918L,"application_11111111111111_2222",te);
    hbi.flush();
  }
  finally {
    if (hbi != null) {
      hbi.close();
    }
  }
  HBaseTimelineReaderImpl hbr=null;
  try {
    hbr=new HBaseTimelineReaderImpl();
    hbr.init(c1);
    hbr.start();
    Set<TimelineEntity> entities=hbr.getEntities(new TimelineReaderContext(cluster,user,flow,null,null,TimelineEntityType.YARN_FLOW_RUN.toString(),null),new TimelineEntityFilters(null,1425016501000L,1425016502001L,null,null,null,null,null,null),new TimelineDataToRetrieve());
    assertEquals(2,entities.size());
    for (    TimelineEntity entity : entities) {
      if (!entity.getId().equals("user2@flow_name2/1002345678918") && !entity.getId().equals("user2@flow_name2/1002345678919")) {
        fail("Entities with flow runs 1002345678918 and 1002345678919" + "should be present.");
      }
    }
    entities=hbr.getEntities(new TimelineReaderContext(cluster,user,flow,null,null,TimelineEntityType.YARN_FLOW_RUN.toString(),null),new TimelineEntityFilters(null,1425016501050L,null,null,null,null,null,null,null),new TimelineDataToRetrieve());
    assertEquals(1,entities.size());
    for (    TimelineEntity entity : entities) {
      if (!entity.getId().equals("user2@flow_name2/1002345678918")) {
        fail("Entity with flow run 1002345678918 should be present.");
      }
    }
    entities=hbr.getEntities(new TimelineReaderContext(cluster,user,flow,null,null,TimelineEntityType.YARN_FLOW_RUN.toString(),null),new TimelineEntityFilters(null,null,1425016501050L,null,null,null,null,null,null),new TimelineDataToRetrieve());
    assertEquals(1,entities.size());
    for (    TimelineEntity entity : entities) {
      if (!entity.getId().equals("user2@flow_name2/1002345678919")) {
        fail("Entity with flow run 1002345678919 should be present.");
      }
    }
  }
  finally {
    if (hbr != null) {
      hbr.close();
    }
  }
}
