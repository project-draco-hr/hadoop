{
  Scan s=new Scan();
  s.addFamily(FlowRunColumnFamily.INFO.getBytes());
  byte[] startRow=new FlowRunRowKey(cluster,user,flow,runid).getRowKey();
  s.setStartRow(startRow);
  int batchLimit=2;
  s.setBatch(batchLimit);
  String clusterStop=cluster + "1";
  byte[] stopRow=new FlowRunRowKey(clusterStop,user,flow,runid).getRowKey();
  s.setStopRow(stopRow);
  Connection conn=ConnectionFactory.createConnection(c1);
  Table table1=conn.getTable(TableName.valueOf(FlowRunTable.DEFAULT_TABLE_NAME));
  ResultScanner scanner=table1.getScanner(s);
  int loopCount=0;
  for (  Result result : scanner) {
    assertNotNull(result);
    assertTrue(!result.isEmpty());
    assertTrue(result.rawCells().length <= batchLimit);
    Map<byte[],byte[]> values=result.getFamilyMap(FlowRunColumnFamily.INFO.getBytes());
    assertNotNull(values);
    assertTrue(values.size() <= batchLimit);
    loopCount++;
  }
  assertTrue(loopCount > 0);
  s=new Scan();
  s.addFamily(FlowRunColumnFamily.INFO.getBytes());
  s.setStartRow(startRow);
  batchLimit=1;
  s.setBatch(batchLimit);
  s.setMaxResultsPerColumnFamily(2);
  s.setStopRow(stopRow);
  scanner=table1.getScanner(s);
  loopCount=0;
  for (  Result result : scanner) {
    assertNotNull(result);
    assertTrue(!result.isEmpty());
    assertEquals(batchLimit,result.rawCells().length);
    Map<byte[],byte[]> values=result.getFamilyMap(FlowRunColumnFamily.INFO.getBytes());
    assertNotNull(values);
    assertEquals(batchLimit,values.size());
    loopCount++;
  }
  assertTrue(loopCount > 0);
  s=new Scan();
  s.addFamily(FlowRunColumnFamily.INFO.getBytes());
  s.setStartRow(startRow);
  batchLimit=100;
  s.setBatch(batchLimit);
  s.setStopRow(stopRow);
  scanner=table1.getScanner(s);
  loopCount=0;
  for (  Result result : scanner) {
    assertNotNull(result);
    assertTrue(!result.isEmpty());
    assertTrue(result.rawCells().length <= batchLimit);
    Map<byte[],byte[]> values=result.getFamilyMap(FlowRunColumnFamily.INFO.getBytes());
    assertNotNull(values);
    assertTrue(values.size() <= batchLimit);
    assertTrue(values.size() == 3);
    loopCount++;
  }
  assertTrue(loopCount == 1);
  s=new Scan();
  s.addFamily(FlowRunColumnFamily.INFO.getBytes());
  s.setStartRow(startRow);
  batchLimit=-671;
  s.setBatch(batchLimit);
  s.setStopRow(stopRow);
  scanner=table1.getScanner(s);
  loopCount=0;
  for (  Result result : scanner) {
    assertNotNull(result);
    assertTrue(!result.isEmpty());
    assertEquals(3,result.rawCells().length);
    Map<byte[],byte[]> values=result.getFamilyMap(FlowRunColumnFamily.INFO.getBytes());
    assertNotNull(values);
    assertEquals(3,values.size());
    loopCount++;
  }
  assertEquals(1,loopCount);
  s=new Scan();
  s.addFamily(FlowRunColumnFamily.INFO.getBytes());
  s.setStartRow(startRow);
  batchLimit=0;
  s.setBatch(batchLimit);
  s.setStopRow(stopRow);
  scanner=table1.getScanner(s);
  loopCount=0;
  for (  Result result : scanner) {
    assertNotNull(result);
    assertTrue(!result.isEmpty());
    assertEquals(3,result.rawCells().length);
    Map<byte[],byte[]> values=result.getFamilyMap(FlowRunColumnFamily.INFO.getBytes());
    assertNotNull(values);
    assertEquals(3,values.size());
    loopCount++;
  }
  assertEquals(1,loopCount);
}
