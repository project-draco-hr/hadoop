{
  long base=getBaseWebResponses();
  assertEquals(0,AzureMetricsTestUtil.getCurrentBytesWritten(getInstrumentation()));
  Path filePath=new Path("/metricsTest_webResponses");
  final int FILE_SIZE=100 * 1024 * 1024;
  getBandwidthGaugeUpdater().suppressAutoUpdate();
  OutputStream outputStream=fs.create(filePath);
  outputStream.write(new byte[FILE_SIZE]);
  outputStream.close();
  logOpResponseCount("Creating a 100 MB file",base);
  base=assertWebResponsesInRange(base,20,50);
  getBandwidthGaugeUpdater().triggerUpdate(true);
  long totalBytesWritten=AzureMetricsTestUtil.getCurrentTotalBytesWritten(getInstrumentation());
  assertTrue("The total bytes written  " + totalBytesWritten + " is pretty far from the expected range of around "+ FILE_SIZE+ " bytes plus a little overhead.",totalBytesWritten >= FILE_SIZE && totalBytesWritten < (FILE_SIZE * 2));
  long uploadRate=AzureMetricsTestUtil.getLongGaugeValue(getInstrumentation(),WASB_UPLOAD_RATE);
  System.out.println("Upload rate: " + uploadRate + " bytes/second.");
  long uploadLatency=AzureMetricsTestUtil.getLongGaugeValue(getInstrumentation(),WASB_UPLOAD_LATENCY);
  System.out.println("Upload latency: " + uploadLatency);
  assertTrue("The upload latency " + uploadLatency + " should be greater than zero now that I've just uploaded a file.",uploadLatency > 0);
  InputStream inputStream=fs.open(filePath);
  int count=0;
  while (inputStream.read() >= 0) {
    count++;
  }
  inputStream.close();
  assertEquals(FILE_SIZE,count);
  logOpResponseCount("Reading a 100 MB file",base);
  base=assertWebResponsesInRange(base,20,40);
  getBandwidthGaugeUpdater().triggerUpdate(false);
  long totalBytesRead=AzureMetricsTestUtil.getCurrentTotalBytesRead(getInstrumentation());
  assertEquals(FILE_SIZE,totalBytesRead);
  long downloadRate=AzureMetricsTestUtil.getLongGaugeValue(getInstrumentation(),WASB_DOWNLOAD_RATE);
  System.out.println("Download rate: " + downloadRate + " bytes/second.");
  long downloadLatency=AzureMetricsTestUtil.getLongGaugeValue(getInstrumentation(),WASB_DOWNLOAD_LATENCY);
  System.out.println("Download latency: " + downloadLatency);
  assertTrue("The download latency " + downloadLatency + " should be greater than zero now that I've just downloaded a file.",downloadLatency > 0);
}
