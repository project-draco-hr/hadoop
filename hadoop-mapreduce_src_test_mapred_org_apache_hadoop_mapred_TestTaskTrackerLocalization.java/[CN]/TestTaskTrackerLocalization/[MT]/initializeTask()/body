{
  tip.setJobConf(localizedJobConf);
  tip.localizeTask(task);
  for (  String dir : trackerFConf.getStrings(MRConfig.LOCAL_DIR)) {
    File attemptDir=new File(dir,TaskTracker.getLocalTaskDir(task.getUser(),jobId.toString(),taskId.toString(),task.isTaskCleanupTask()));
    assertTrue("attempt-dir " + attemptDir + " in localDir "+ dir+ " is not created!!",attemptDir.exists());
  }
  attemptWorkDir=lDirAlloc.getLocalPathToRead(TaskTracker.getTaskWorkDir(task.getUser(),task.getJobID().toString(),task.getTaskID().toString(),task.isTaskCleanupTask()),trackerFConf);
  assertTrue("atttempt work dir for " + taskId.toString() + " is not created in any of the configured dirs!!",attemptWorkDir != null);
  TaskRunner runner=new MapTaskRunner(tip,tracker,tip.getJobConf());
  tip.setTaskRunner(runner);
  runner.setupChildTaskConfiguration(lDirAlloc);
  TaskRunner.createChildTmpDir(new File(attemptWorkDir.toUri().getPath()),localizedJobConf);
  attemptLogFiles=runner.prepareLogFiles(task.getTaskID(),task.isTaskCleanupTask());
  Path localTaskFile=lDirAlloc.getLocalPathToRead(TaskTracker.getTaskConfFile(task.getUser(),task.getJobID().toString(),task.getTaskID().toString(),task.isTaskCleanupTask()),trackerFConf);
  assertTrue("Task conf file " + localTaskFile.toString() + " is not created!!",new File(localTaskFile.toUri().getPath()).exists());
  localizedTaskConf=new JobConf(localTaskFile);
  TaskRunner.setupChildMapredLocalDirs(task,localizedTaskConf);
  TaskControllerContext taskContext=new TaskController.TaskControllerContext();
  taskContext.env=new JvmEnv(null,null,null,null,-1,new File(localizedJobConf.get(TaskTracker.JOB_LOCAL_DIR)),null,localizedJobConf);
  taskContext.task=task;
  taskController.initializeTask(taskContext);
}
