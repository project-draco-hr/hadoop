{
  try {
    LOG.info("Initiating file filtering for " + dir.path.getPath());
    for (    FileStatus f : dir.elements) {
      if (!f.isFile()) {
        continue;
      }
      if (filter.check(f)) {
synchronized (filtered) {
          filtered.add(f);
        }
      }
    }
  }
 catch (  Exception e) {
    LOG.error("Error in directory traversal: " + StringUtils.stringifyException(e));
  }
 finally {
    slots.release();
  }
}
