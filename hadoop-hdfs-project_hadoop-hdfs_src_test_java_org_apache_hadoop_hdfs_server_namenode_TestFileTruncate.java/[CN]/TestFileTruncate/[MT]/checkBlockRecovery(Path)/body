{
  boolean success=false;
  for (int i=0; i < SUCCESS_ATTEMPTS; i++) {
    LocatedBlocks blocks=getLocatedBlocks(p);
    boolean noLastBlock=blocks.getLastLocatedBlock() == null;
    if (!blocks.isUnderConstruction() && (noLastBlock || blocks.isLastBlockComplete())) {
      success=true;
      break;
    }
    try {
      Thread.sleep(SLEEP);
    }
 catch (    InterruptedException ignored) {
    }
  }
  assertThat("inode should complete in ~" + SLEEP * SUCCESS_ATTEMPTS + " ms.",success,is(true));
}
