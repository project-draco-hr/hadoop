{
  final Path srcECDir=new Path("/srcEC");
  final Path dstECDir=new Path("/dstEC");
  fs.mkdir(srcECDir,FsPermission.getDirDefault());
  fs.mkdir(dstECDir,FsPermission.getDirDefault());
  fs.getClient().createErasureCodingZone(srcECDir.toString(),null);
  fs.getClient().createErasureCodingZone(dstECDir.toString(),null);
  final Path srcFile=new Path(srcECDir,"foo");
  fs.create(srcFile);
  final Path newDir=new Path("/srcEC_new");
  fs.rename(srcECDir,newDir);
  fs.rename(newDir,srcECDir);
  fs.rename(srcECDir,dstECDir);
  fs.rename(new Path("/dstEC/srcEC"),srcECDir);
  fs.rename(srcFile,dstECDir);
  fs.rename(new Path(dstECDir,"foo"),srcECDir);
  final Path nonECDir=new Path("/nonEC");
  fs.mkdir(nonECDir,FsPermission.getDirDefault());
  try {
    fs.rename(srcFile,nonECDir);
    fail("A file shouldn't be able to move from a non-EC dir to an EC zone");
  }
 catch (  IOException e) {
    assertExceptionContains("can't be moved because the source and " + "destination have different erasure coding policies",e);
  }
  final Path nonECFile=new Path(nonECDir,"nonECFile");
  fs.create(nonECFile);
  try {
    fs.rename(nonECFile,dstECDir);
  }
 catch (  IOException e) {
    assertExceptionContains("can't be moved because the source and " + "destination have different erasure coding policies",e);
  }
}
