{
  HashMap<DatanodeInfo,NodeRecord> map=new HashMap<DatanodeInfo,NodeRecord>();
  for (  LocatedBlock block : blks.getLocatedBlocks()) {
    DatanodeInfo[] nodes=block.getLocations();
    for (    DatanodeInfo node : nodes) {
      NodeRecord record=map.get(node);
      if (record == null) {
        map.put(node,new NodeRecord(node,1));
      }
 else {
        record.frequency++;
      }
    }
  }
  NodeRecord[] nodes=map.values().toArray(new NodeRecord[map.size()]);
  Arrays.sort(nodes,new NodeRecordComparator());
  return bestNode(nodes,false);
}
