{
  if (isUnlinked()) {
    return false;
  }
  File file=getBlockFile();
  if (file == null || getVolume() == null) {
    throw new IOException("detachBlock:Block not found. " + this);
  }
  File meta=getMetaFile();
  if (meta == null) {
    throw new IOException("Meta file not found for block " + this);
  }
  if (HardLink.getLinkCount(file) > numLinks) {
    DataNode.LOG.info("CopyOnWrite for block " + this);
    unlinkFile(file,this);
  }
  if (HardLink.getLinkCount(meta) > numLinks) {
    unlinkFile(meta,this);
  }
  setUnlinked();
  return true;
}
