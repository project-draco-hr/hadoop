{
  assertNotSame(storageType,StorageType.DEFAULT);
  NameNode nn=cluster.getNameNode();
  DataNode dn=cluster.getDataNodes().get(0);
  DatanodeProtocolClientSideTranslatorPB nnSpy=DataNodeTestUtils.spyOnBposToNN(dn,nn);
  DataNodeTestUtils.triggerHeartbeat(dn);
  ArgumentCaptor<StorageReport[]> captor=ArgumentCaptor.forClass(StorageReport[].class);
  Mockito.verify(nnSpy).sendHeartbeat(any(DatanodeRegistration.class),captor.capture(),anyLong(),anyLong(),anyInt(),anyInt(),anyInt(),Mockito.any(VolumeFailureSummary.class));
  StorageReport[] reports=captor.getValue();
  for (  StorageReport report : reports) {
    assertThat(report.getStorage().getStorageType(),is(storageType));
    assertThat(report.getStorage().getState(),is(DatanodeStorage.State.NORMAL));
  }
}
