{
  Map<String,String> conf=new HashMap<String,String>();
  conf.put(CrossOriginFilter.ALLOWED_ORIGINS,"example.com");
  FilterConfig filterConfig=new FilterConfigTest(conf);
  HttpServletRequest mockReq=mock(HttpServletRequest.class);
  when(mockReq.getHeader(CrossOriginFilter.ORIGIN)).thenReturn("example.com");
  when(mockReq.getHeader(CrossOriginFilter.ACCESS_CONTROL_REQUEST_METHOD)).thenReturn("GET");
  when(mockReq.getHeader(CrossOriginFilter.ACCESS_CONTROL_REQUEST_HEADERS)).thenReturn("X-Requested-With");
  HttpServletResponse mockRes=mock(HttpServletResponse.class);
  FilterChain mockChain=mock(FilterChain.class);
  CrossOriginFilter filter=new CrossOriginFilter();
  filter.init(filterConfig);
  filter.doFilter(mockReq,mockRes,mockChain);
  verify(mockRes).setHeader(CrossOriginFilter.ACCESS_CONTROL_ALLOW_ORIGIN,"example.com");
  verify(mockRes).setHeader(CrossOriginFilter.ACCESS_CONTROL_ALLOW_CREDENTIALS,Boolean.TRUE.toString());
  verify(mockRes).setHeader(CrossOriginFilter.ACCESS_CONTROL_ALLOW_METHODS,filter.getAllowedMethodsHeader());
  verify(mockRes).setHeader(CrossOriginFilter.ACCESS_CONTROL_ALLOW_HEADERS,filter.getAllowedHeadersHeader());
  verify(mockChain).doFilter(mockReq,mockRes);
}
