{
  final PrintWriter out=response.getWriter();
  final String path=ServletUtil.getDecodedPath(request,"/getFileChecksum");
  final XMLOutputter xml=new XMLOutputter(out,"UTF-8");
  xml.declaration();
  final ServletContext context=getServletContext();
  final DataNode datanode=(DataNode)context.getAttribute("datanode");
  final Configuration conf=new HdfsConfiguration(datanode.getConf());
  final int socketTimeout=conf.getInt(DFSConfigKeys.DFS_CLIENT_SOCKET_TIMEOUT_KEY,HdfsServerConstants.READ_TIMEOUT);
  final SocketFactory socketFactory=NetUtils.getSocketFactory(conf,ClientProtocol.class);
  try {
    final DFSClient dfs=DatanodeJspHelper.getDFSClient(request,datanode,conf,getUGI(request,conf));
    final ClientProtocol nnproxy=dfs.getNamenode();
    final MD5MD5CRC32FileChecksum checksum=DFSClient.getFileChecksum(path,nnproxy,socketFactory,socketTimeout);
    MD5MD5CRC32FileChecksum.write(xml,checksum);
  }
 catch (  IOException ioe) {
    writeXml(ioe,path,xml);
  }
catch (  InterruptedException e) {
    writeXml(e,path,xml);
  }
  xml.endDocument();
}
