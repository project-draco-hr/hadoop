{
  final String hostname=host instanceof DatanodeInfo ? host.getHostName() : host.getIpAddr();
  final String scheme=request.getScheme();
  int port=host.getInfoPort();
  if ("https".equals(scheme)) {
    final Integer portObject=(Integer)getServletContext().getAttribute(DFSConfigKeys.DFS_DATANODE_HTTPS_PORT_KEY);
    if (portObject != null) {
      port=portObject;
    }
  }
  final String encodedPath=ServletUtil.getRawPath(request,"/fileChecksum");
  String dtParam="";
  if (UserGroupInformation.isSecurityEnabled()) {
    String tokenString=ugi.getTokens().iterator().next().encodeToUrlString();
    dtParam=JspHelper.getDelegationTokenUrlParam(tokenString);
  }
  String addr=nn.getNameNodeAddressHostPortString();
  String addrParam=JspHelper.getUrlParam(JspHelper.NAMENODE_ADDRESS,addr);
  return new URL(scheme,hostname,port,"/getFileChecksum" + encodedPath + '?'+ "ugi="+ ServletUtil.encodeQueryValue(ugi.getShortUserName())+ dtParam+ addrParam);
}
