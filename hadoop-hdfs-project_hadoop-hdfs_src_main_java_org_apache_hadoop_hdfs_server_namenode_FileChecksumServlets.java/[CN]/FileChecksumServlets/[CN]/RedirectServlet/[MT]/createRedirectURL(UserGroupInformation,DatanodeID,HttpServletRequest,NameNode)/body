{
  final String hostname=host instanceof DatanodeInfo ? ((DatanodeInfo)host).getHostName() : host.getIpAddr();
  final String scheme=request.getScheme();
  final int port="https".equals(scheme) ? (Integer)getServletContext().getAttribute("datanode.https.port") : host.getInfoPort();
  final String encodedPath=ServletUtil.getRawPath(request,"/fileChecksum");
  String dtParam="";
  if (UserGroupInformation.isSecurityEnabled()) {
    String tokenString=ugi.getTokens().iterator().next().encodeToUrlString();
    dtParam=JspHelper.getDelegationTokenUrlParam(tokenString);
  }
  String addr=NetUtils.getHostPortString(nn.getNameNodeAddress());
  String addrParam=JspHelper.getUrlParam(JspHelper.NAMENODE_ADDRESS,addr);
  return new URL(scheme,hostname,port,"/getFileChecksum" + encodedPath + '?'+ "ugi="+ ServletUtil.encodeQueryValue(ugi.getShortUserName())+ dtParam+ addrParam);
}
