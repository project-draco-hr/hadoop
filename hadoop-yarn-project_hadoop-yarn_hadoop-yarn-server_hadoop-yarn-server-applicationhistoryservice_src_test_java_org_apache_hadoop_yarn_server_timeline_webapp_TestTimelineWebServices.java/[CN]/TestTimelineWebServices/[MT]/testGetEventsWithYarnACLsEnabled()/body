{
  AdminACLsManager oldAdminACLsManager=timelineACLsManager.setAdminACLsManager(adminACLsManager);
  remoteUser="tester";
  try {
    TimelineEntities entities=new TimelineEntities();
    TimelineEntity entity=new TimelineEntity();
    entity.setEntityId("test id 5");
    entity.setEntityType("test type 5");
    entity.setStartTime(System.currentTimeMillis());
    TimelineEvent event=new TimelineEvent();
    event.setEventType("event type 1");
    event.setTimestamp(System.currentTimeMillis());
    entity.addEvent(event);
    entities.addEntity(entity);
    WebResource r=resource();
    ClientResponse response=r.path("ws").path("v1").path("timeline").accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON).post(ClientResponse.class,entities);
    remoteUser="other";
    entities=new TimelineEntities();
    entity=new TimelineEntity();
    entity.setEntityId("test id 6");
    entity.setEntityType("test type 5");
    entity.setStartTime(System.currentTimeMillis());
    event=new TimelineEvent();
    event.setEventType("event type 2");
    event.setTimestamp(System.currentTimeMillis());
    entity.addEvent(event);
    entities.addEntity(entity);
    r=resource();
    response=r.path("ws").path("v1").path("timeline").accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON).post(ClientResponse.class,entities);
    response=r.path("ws").path("v1").path("timeline").path("test type 5").path("events").queryParam("entityId","test id 5,test id 6").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    TimelineEvents events=response.getEntity(TimelineEvents.class);
    assertEquals(1,events.getAllEvents().size());
    assertEquals("test id 6",events.getAllEvents().get(0).getEntityId());
  }
  finally {
    timelineACLsManager.setAdminACLsManager(oldAdminACLsManager);
    remoteUser=null;
  }
}
