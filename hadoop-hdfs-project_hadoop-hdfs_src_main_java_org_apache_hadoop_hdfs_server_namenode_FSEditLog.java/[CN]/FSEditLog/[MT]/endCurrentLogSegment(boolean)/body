{
  LOG.info("Ending log segment " + curSegmentTxId);
  Preconditions.checkState(state == State.IN_SEGMENT,"Bad state: %s",state);
  if (writeEndTxn) {
    logEdit(LogSegmentOp.getInstance(FSEditLogOpCodes.OP_END_LOG_SEGMENT));
    logSync();
  }
  printStatistics(true);
  final long lastTxId=getLastWrittenTxId();
  try {
    journalSet.finalizeLogSegment(curSegmentTxId,lastTxId);
    editLogStream=null;
  }
 catch (  IOException e) {
  }
  state=State.BETWEEN_LOG_SEGMENTS;
}
