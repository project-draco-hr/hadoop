{
  if (target.exists && (target.stat.isDirectory() || !overwrite)) {
    throw new PathExistsException(target.toString());
  }
  TargetFileSystem targetFs=new TargetFileSystem(target.fs);
  try {
    PathData tempTarget=target.suffix("._COPYING_");
    targetFs.setWriteChecksum(writeChecksum);
    targetFs.writeStreamToFile(in,tempTarget);
    targetFs.rename(tempTarget,target);
  }
  finally {
    targetFs.close();
  }
}
