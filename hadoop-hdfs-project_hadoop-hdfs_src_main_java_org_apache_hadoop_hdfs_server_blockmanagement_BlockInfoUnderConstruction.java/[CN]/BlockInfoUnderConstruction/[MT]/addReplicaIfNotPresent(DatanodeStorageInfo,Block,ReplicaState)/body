{
  Iterator<ReplicaUnderConstruction> it=replicas.iterator();
  while (it.hasNext()) {
    ReplicaUnderConstruction r=it.next();
    if (r.getExpectedStorageLocation() == storage) {
      r.setGenerationStamp(block.getGenerationStamp());
      return;
    }
 else     if (r.getExpectedStorageLocation().getDatanodeDescriptor() == storage.getDatanodeDescriptor()) {
      it.remove();
      break;
    }
  }
  replicas.add(new ReplicaUnderConstruction(block,storage,rState));
}
