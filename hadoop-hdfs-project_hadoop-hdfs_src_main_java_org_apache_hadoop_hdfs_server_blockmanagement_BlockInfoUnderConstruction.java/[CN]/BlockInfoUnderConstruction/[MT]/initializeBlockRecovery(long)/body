{
  setBlockUCState(BlockUCState.UNDER_RECOVERY);
  blockRecoveryId=recoveryId;
  if (replicas.size() == 0) {
    NameNode.blockStateChangeLog.warn("BLOCK*" + " BlockInfoUnderConstruction.initLeaseRecovery:" + " No blocks found, lease removed.");
  }
  boolean allLiveReplicasTriedAsPrimary=true;
  for (int i=0; i < replicas.size(); i++) {
    if (replicas.get(i).isAlive()) {
      allLiveReplicasTriedAsPrimary=(allLiveReplicasTriedAsPrimary && replicas.get(i).getChosenAsPrimary());
    }
  }
  if (allLiveReplicasTriedAsPrimary) {
    for (int i=0; i < replicas.size(); i++) {
      replicas.get(i).setChosenAsPrimary(false);
    }
  }
  long mostRecentLastUpdate=0;
  ReplicaUnderConstruction primary=null;
  primaryNodeIndex=-1;
  for (int i=0; i < replicas.size(); i++) {
    if (!(replicas.get(i).isAlive() && !replicas.get(i).getChosenAsPrimary())) {
      continue;
    }
    if (replicas.get(i).getExpectedLocation().getLastUpdate() > mostRecentLastUpdate) {
      primary=replicas.get(i);
      primaryNodeIndex=i;
      mostRecentLastUpdate=primary.getExpectedLocation().getLastUpdate();
    }
  }
  if (primary != null) {
    primary.getExpectedLocation().addBlockToBeRecovered(this);
    primary.setChosenAsPrimary(true);
    NameNode.blockStateChangeLog.info("BLOCK* " + this + " recovery started, primary="+ primary);
  }
}
