{
  DFSClient client=getDfsClient(cluster.getNameNode(nnIndex),conf);
  DatanodeInfo[] info=client.datanodeReport(DatanodeReportType.LIVE);
  int index=0;
  boolean found=false;
  while (!found) {
    index=myrand.nextInt(info.length);
    if (!info[index].isDecommissioned()) {
      found=true;
    }
  }
  String nodename=info[index].getName();
  LOG.info("Decommissioning node: " + nodename);
  ArrayList<String> nodes=new ArrayList<String>();
  if (decommissionedNodes != null) {
    for (    DatanodeInfo dn : decommissionedNodes) {
      nodes.add(dn.getName());
    }
  }
  nodes.add(nodename);
  writeConfigFile(excludeFile,nodes);
  cluster.getNamesystem(nnIndex).refreshNodes(conf);
  DatanodeInfo ret=NameNodeAdapter.getDatanode(cluster.getNameNode(nnIndex),info[index]);
  waitNodeState(ret,waitForState);
  return ret;
}
