{
  File inProgressFile=new File(testDir,NNStorage.getInProgressEditsFileName(1));
  FSEditLog fsel=null, spyLog=null;
  try {
    fsel=FSImageTestUtil.createStandaloneEditLog(testDir);
    spyLog=spy(fsel);
    doNothing().when(spyLog).endCurrentLogSegment(true);
    spyLog.openForWrite();
    assertTrue("should exist: " + inProgressFile,inProgressFile.exists());
    for (int i=0; i < numTx; i++) {
      long trueOffset=getNonTrailerLength(inProgressFile);
      long thisTxId=spyLog.getLastWrittenTxId() + 1;
      offsetToTxId.put(trueOffset,thisTxId);
      System.err.println("txid " + thisTxId + " at offset "+ trueOffset);
      spyLog.logDelete("path" + i,i);
      spyLog.logSync();
    }
  }
  finally {
    if (spyLog != null) {
      spyLog.close();
    }
 else     if (fsel != null) {
      fsel.close();
    }
  }
  return inProgressFile;
}
