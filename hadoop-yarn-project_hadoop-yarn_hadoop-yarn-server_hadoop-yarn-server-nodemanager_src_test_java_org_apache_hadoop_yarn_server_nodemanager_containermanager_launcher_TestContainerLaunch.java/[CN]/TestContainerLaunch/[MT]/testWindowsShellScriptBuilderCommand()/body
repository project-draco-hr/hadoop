{
  String callCmd="@call ";
  Assume.assumeTrue(Shell.WINDOWS);
  assertEquals(8191,Shell.WINDOWS_MAX_SHELL_LENGTH);
  ShellScriptBuilder builder=ShellScriptBuilder.create();
  builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("A",1024)));
  builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("E",Shell.WINDOWS_MAX_SHELL_LENGTH - callCmd.length())));
  try {
    builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("X",Shell.WINDOWS_MAX_SHELL_LENGTH - callCmd.length() + 1)));
    fail("longCommand was expected to throw");
  }
 catch (  IOException e) {
    assertThat(e.getMessage(),containsString(expectedMessage));
  }
  builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("A",1024),org.apache.commons.lang.StringUtils.repeat("A",1024),org.apache.commons.lang.StringUtils.repeat("A",1024)));
  builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("E",4095),org.apache.commons.lang.StringUtils.repeat("E",2047),org.apache.commons.lang.StringUtils.repeat("E",2047 - callCmd.length())));
  try {
    builder.command(Arrays.asList(org.apache.commons.lang.StringUtils.repeat("X",4095),org.apache.commons.lang.StringUtils.repeat("X",2047),org.apache.commons.lang.StringUtils.repeat("X",2048 - callCmd.length())));
    fail("long commands was expected to throw");
  }
 catch (  IOException e) {
    assertThat(e.getMessage(),containsString(expectedMessage));
  }
}
