{
  String mkDirCmd="@if not exist \"\" mkdir \"\"";
  assumeWindows();
  assertEquals(8191,Shell.WINDOWS_MAX_SHELL_LENGTH);
  ShellScriptBuilder builder=ShellScriptBuilder.create();
  builder.mkdir(new Path(org.apache.commons.lang.StringUtils.repeat("A",1024)));
  builder.mkdir(new Path(org.apache.commons.lang.StringUtils.repeat("E",(Shell.WINDOWS_MAX_SHELL_LENGTH - mkDirCmd.length()) / 2)));
  try {
    builder.mkdir(new Path(org.apache.commons.lang.StringUtils.repeat("X",(Shell.WINDOWS_MAX_SHELL_LENGTH - mkDirCmd.length()) / 2 + 1)));
    fail("long mkdir was expected to throw");
  }
 catch (  IOException e) {
    assertThat(e.getMessage(),CoreMatchers.containsString(expectedMessage));
  }
}
