{
  Assume.assumeTrue(Shell.WINDOWS);
  assertEquals(8191,Shell.WINDOWS_MAX_SHELL_LENGTH);
  ShellScriptBuilder builder=ShellScriptBuilder.create();
  builder.env("somekey",org.apache.commons.lang.StringUtils.repeat("A",1024));
  builder.env("somekey",org.apache.commons.lang.StringUtils.repeat("A",Shell.WINDOWS_MAX_SHELL_LENGTH - ("@set somekey=").length()));
  try {
    builder.env("somekey",org.apache.commons.lang.StringUtils.repeat("A",Shell.WINDOWS_MAX_SHELL_LENGTH - ("@set somekey=").length()) + 1);
    fail("long env was expected to throw");
  }
 catch (  IOException e) {
    assertThat(e.getMessage(),CoreMatchers.containsString(expectedMessage));
  }
}
