{
  Queue queue;
  String[] childQueueNames=conf.getQueues((parent == null) ? queueName : (parent.getQueuePath() + "." + queueName));
  if (childQueueNames == null || childQueueNames.length == 0) {
    if (null == parent) {
      throw new IllegalStateException("Queue configuration missing child queue names for " + queueName);
    }
    queue=new LeafQueue(csContext,queueName,parent,applicationComparator,oldQueues.get(queueName));
    queue=hook.hook(queue);
  }
 else {
    ParentQueue parentQueue=new ParentQueue(csContext,queueName,queueComparator,parent,oldQueues.get(queueName));
    queue=hook.hook(parentQueue);
    List<Queue> childQueues=new ArrayList<Queue>();
    for (    String childQueueName : childQueueNames) {
      Queue childQueue=parseQueue(csContext,conf,queue,childQueueName,queues,oldQueues,queueComparator,applicationComparator,hook);
      childQueues.add(childQueue);
    }
    parentQueue.setChildQueues(childQueues);
  }
  queues.put(queueName,queue);
  LOG.info("Initialized queue: " + queue);
  return queue;
}
