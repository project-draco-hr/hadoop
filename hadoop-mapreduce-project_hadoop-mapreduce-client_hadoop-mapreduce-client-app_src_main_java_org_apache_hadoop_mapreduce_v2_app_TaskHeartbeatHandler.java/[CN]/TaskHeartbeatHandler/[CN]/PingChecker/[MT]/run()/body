{
  while (!stopped && !Thread.currentThread().isInterrupted()) {
    Iterator<Map.Entry<TaskAttemptId,Long>> iterator=runningAttempts.entrySet().iterator();
    long currentTime=clock.getTime();
    while (iterator.hasNext()) {
      Map.Entry<TaskAttemptId,Long> entry=iterator.next();
      if (currentTime > entry.getValue() + taskTimeOut) {
        Long taskTime=runningAttempts.get(entry.getKey());
        if (taskTime != null && currentTime > taskTime + taskTimeOut) {
          iterator.remove();
          eventHandler.handle(new TaskAttemptDiagnosticsUpdateEvent(entry.getKey(),"AttemptID:" + entry.getKey().toString() + " Timed out after "+ taskTimeOut / 1000 + " secs"));
          eventHandler.handle(new TaskAttemptEvent(entry.getKey(),TaskAttemptEventType.TA_TIMED_OUT));
        }
      }
    }
    try {
      Thread.sleep(taskTimeOutCheckInterval);
    }
 catch (    InterruptedException e) {
      LOG.info("TaskHeartbeatHandler thread interrupted");
      break;
    }
  }
}
