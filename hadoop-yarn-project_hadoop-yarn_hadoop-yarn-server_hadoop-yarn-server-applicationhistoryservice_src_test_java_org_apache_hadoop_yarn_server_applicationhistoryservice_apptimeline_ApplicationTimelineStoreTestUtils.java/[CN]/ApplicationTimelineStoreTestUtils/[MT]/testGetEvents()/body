{
  SortedSet<String> sortedSet=new TreeSet<String>();
  sortedSet.add(entity1);
  List<ATSEventsOfOneEntity> timelines=store.getEntityTimelines(entityType1,sortedSet,null,null,null,null).getAllEvents();
  assertEquals(1,timelines.size());
  verifyEntityTimeline(timelines.get(0),entity1,entityType1,ev2,ev1);
  sortedSet.add(entity1b);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,null,null,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entity1,entityType1,ev2,ev1);
  verifyEntityTimeline(timelines.get(1),entity1b,entityType1,ev2,ev1);
  timelines=store.getEntityTimelines(entityType1,sortedSet,1l,null,null,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entity1,entityType1,ev2);
  verifyEntityTimeline(timelines.get(1),entity1b,entityType1,ev2);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,345l,null,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entity1,entityType1,ev2);
  verifyEntityTimeline(timelines.get(1),entity1b,entityType1,ev2);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,123l,null,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entity1,entityType1,ev2);
  verifyEntityTimeline(timelines.get(1),entity1b,entityType1,ev2);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,null,345l,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entity1,entityType1,ev1);
  verifyEntityTimeline(timelines.get(1),entity1b,entityType1,ev1);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,null,123l,null).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entity1,entityType1,ev1);
  verifyEntityTimeline(timelines.get(1),entity1b,entityType1,ev1);
  timelines=store.getEntityTimelines(entityType1,sortedSet,null,null,null,Collections.singleton("end_event")).getAllEvents();
  assertEquals(2,timelines.size());
  verifyEntityTimeline(timelines.get(0),entity1,entityType1,ev2);
  verifyEntityTimeline(timelines.get(1),entity1b,entityType1,ev2);
  sortedSet.add(entity2);
  timelines=store.getEntityTimelines(entityType2,sortedSet,null,null,null,null).getAllEvents();
  assertEquals(1,timelines.size());
  verifyEntityTimeline(timelines.get(0),entity2,entityType2,ev3,ev4);
}
