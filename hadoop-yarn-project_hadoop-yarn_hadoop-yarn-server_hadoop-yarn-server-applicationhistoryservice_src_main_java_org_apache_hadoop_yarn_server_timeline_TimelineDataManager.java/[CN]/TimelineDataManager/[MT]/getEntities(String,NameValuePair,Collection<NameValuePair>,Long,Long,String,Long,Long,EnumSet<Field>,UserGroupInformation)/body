{
  TimelineEntities entities=null;
  boolean modified=extendFields(fields);
  entities=store.getEntities(entityType,limit,windowStart,windowEnd,fromId,fromTs,primaryFilter,secondaryFilter,fields);
  if (entities != null) {
    Iterator<TimelineEntity> entitiesItr=entities.getEntities().iterator();
    while (entitiesItr.hasNext()) {
      TimelineEntity entity=entitiesItr.next();
      try {
        if (!timelineACLsManager.checkAccess(callerUGI,entity)) {
          entitiesItr.remove();
        }
 else {
          if (modified) {
            entity.setPrimaryFilters(null);
          }
 else {
            cleanupOwnerInfo(entity);
          }
        }
      }
 catch (      YarnException e) {
        LOG.error("Error when verifying access for user " + callerUGI + " on the events of the timeline entity "+ new EntityIdentifier(entity.getEntityId(),entity.getEntityType()),e);
        entitiesItr.remove();
      }
    }
  }
  if (entities == null) {
    return new TimelineEntities();
  }
  return entities;
}
