{
  freeDataBufIfExists();
  freeChecksumBufIfExists();
  int total=0;
  while (buf.hasRemaining()) {
    int nRead=dataIn.read(buf,dataPos);
    if (nRead <= 0)     break;
    dataPos+=nRead;
    total+=nRead;
  }
  return (total == 0 && (dataPos == dataIn.size())) ? -1 : total;
}
