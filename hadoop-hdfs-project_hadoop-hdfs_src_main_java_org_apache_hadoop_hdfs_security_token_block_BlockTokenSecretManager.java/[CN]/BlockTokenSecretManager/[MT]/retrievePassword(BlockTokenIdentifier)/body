{
  if (isExpired(identifier.getExpiryDate())) {
    throw new InvalidToken("Block token with " + identifier.toString() + " is expired.");
  }
  BlockKey key=null;
synchronized (this) {
    key=allKeys.get(identifier.getKeyId());
  }
  if (key == null) {
    throw new InvalidToken("Can't re-compute password for " + identifier.toString() + ", since the required block key (keyID="+ identifier.getKeyId()+ ") doesn't exist.");
  }
  return createPassword(identifier.getBytes(),key.getKey());
}
