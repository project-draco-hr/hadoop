{
  BlockKey key=null;
synchronized (this) {
    key=currentKey;
  }
  if (key == null)   throw new IllegalStateException("currentKey hasn't been initialized.");
  identifier.setExpiryDate(Time.now() + tokenLifetime);
  identifier.setKeyId(key.getKeyId());
  if (LOG.isDebugEnabled()) {
    LOG.debug("Generating block token for " + identifier.toString());
  }
  return createPassword(identifier.getBytes(),key.getKey());
}
