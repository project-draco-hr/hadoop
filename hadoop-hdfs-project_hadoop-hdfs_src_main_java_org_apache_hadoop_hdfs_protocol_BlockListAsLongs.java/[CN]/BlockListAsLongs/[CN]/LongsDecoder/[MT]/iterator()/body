{
  return new Iterator<BlockReportReplica>(){
    private final BlockReportReplica block=new BlockReportReplica();
    final Iterator<Long> iter=values.iterator();
    private int currentBlockIndex=0;
    @Override public boolean hasNext(){
      return currentBlockIndex < numBlocks;
    }
    @Override public BlockReportReplica next(){
      if (currentBlockIndex == finalizedBlocks) {
        readBlock();
        Preconditions.checkArgument(block.getBlockId() == -1 && block.getNumBytes() == -1 && block.getGenerationStamp() == -1,"Invalid delimiter block");
      }
      readBlock();
      if (currentBlockIndex++ < finalizedBlocks) {
        block.setState(ReplicaState.FINALIZED);
      }
 else {
        block.setState(ReplicaState.getState(iter.next().intValue()));
      }
      return block;
    }
    private void readBlock(){
      block.setBlockId(iter.next());
      block.setNumBytes(iter.next());
      block.setGenerationStamp(iter.next());
    }
    @Override public void remove(){
      throw new UnsupportedOperationException();
    }
  }
;
}
