{
  long bytesRead=0;
  if (!finished) {
    if (totalBytesRead > splitLength) {
      finished=true;
    }
    bytesRead=totalBytesRead;
    int bytesConsumed=super.readLine(str,maxLineLength,maxBytesToConsume);
    bytesRead=totalBytesRead - bytesRead;
    if (bytesConsumed == 0 && bytesRead == 0) {
      return 0;
    }
    int bufferSize=getBufferSize();
    if (lastBytesRead <= 0) {
      bytesRead+=bufferSize;
    }
 else     if (bytesRead > 0) {
      bytesRead+=bufferSize - lastBytesRead;
    }
    bytesRead+=unusedBytes;
    unusedBytes=bufferSize - getBufferPosn();
    bytesRead-=unusedBytes;
  }
  return (int)bytesRead;
}
