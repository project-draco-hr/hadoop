{
  OutputStream out=getOutputStream(smallBufferSize);
  try {
    int bytesWritten=dataLen / 3;
    out.write(data,0,bytesWritten);
    ((Syncable)out).hflush();
    InputStream in=getInputStream(defaultBufferSize);
    verify(in,bytesWritten,data);
    in.close();
    out.write(data,bytesWritten,dataLen - bytesWritten);
    ((Syncable)out).hsync();
    in=getInputStream(defaultBufferSize);
    verify(in,dataLen,data);
    in.close();
  }
  finally {
    out.close();
  }
}
