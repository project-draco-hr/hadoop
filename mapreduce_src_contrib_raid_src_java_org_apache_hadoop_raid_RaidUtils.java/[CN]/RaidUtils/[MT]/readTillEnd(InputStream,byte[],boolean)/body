{
  int toRead=buf.length;
  int numRead=0;
  while (numRead < toRead) {
    int nread=in.read(buf,numRead,toRead - numRead);
    if (nread < 0) {
      if (eofOK) {
        Arrays.fill(buf,numRead,toRead,(byte)0);
        numRead=toRead;
      }
 else {
        throw new IOException("Premature EOF");
      }
    }
 else {
      numRead+=nread;
    }
  }
}
