{
  String user="somebody";
  ApplicationId appId=ApplicationId.newInstance(1,1);
  Path appRsrcPath=new Path("hdfs://some/app/resource");
  LocalResourcePBImpl rsrcPb=(LocalResourcePBImpl)LocalResource.newInstance(ConverterUtils.getYarnUrlFromPath(appRsrcPath),LocalResourceType.ARCHIVE,LocalResourceVisibility.APPLICATION,123L,456L);
  LocalResourceProto appRsrcProto=rsrcPb.getProto();
  Path appRsrcLocalPath=new Path("/some/local/dir/for/apprsrc");
  stateStore.startResourceLocalization(user,appId,appRsrcProto,appRsrcLocalPath);
  LocalizedResourceProto appLocalizedProto=LocalizedResourceProto.newBuilder().setResource(appRsrcProto).setLocalPath(appRsrcLocalPath.toString()).setSize(1234567L).build();
  stateStore.finishResourceLocalization(user,appId,appLocalizedProto);
  restartStateStore();
  RecoveredLocalizationState state=stateStore.loadLocalizationState();
  LocalResourceTrackerState pubts=state.getPublicTrackerState();
  assertTrue(pubts.getLocalizedResources().isEmpty());
  assertTrue(pubts.getInProgressResources().isEmpty());
  Map<String,RecoveredUserResources> userResources=state.getUserResources();
  assertEquals(1,userResources.size());
  RecoveredUserResources rur=userResources.get(user);
  LocalResourceTrackerState privts=rur.getPrivateTrackerState();
  assertNotNull(privts);
  assertTrue(privts.getLocalizedResources().isEmpty());
  assertTrue(privts.getInProgressResources().isEmpty());
  assertEquals(1,rur.getAppTrackerStates().size());
  LocalResourceTrackerState appts=rur.getAppTrackerStates().get(appId);
  assertNotNull(appts);
  assertTrue(appts.getInProgressResources().isEmpty());
  assertEquals(1,appts.getLocalizedResources().size());
  assertEquals(appLocalizedProto,appts.getLocalizedResources().iterator().next());
  Path pubRsrcPath1=new Path("hdfs://some/public/resource1");
  rsrcPb=(LocalResourcePBImpl)LocalResource.newInstance(ConverterUtils.getYarnUrlFromPath(pubRsrcPath1),LocalResourceType.FILE,LocalResourceVisibility.PUBLIC,789L,135L);
  LocalResourceProto pubRsrcProto1=rsrcPb.getProto();
  Path pubRsrcLocalPath1=new Path("/some/local/dir/for/pubrsrc1");
  stateStore.startResourceLocalization(null,null,pubRsrcProto1,pubRsrcLocalPath1);
  Path pubRsrcPath2=new Path("hdfs://some/public/resource2");
  rsrcPb=(LocalResourcePBImpl)LocalResource.newInstance(ConverterUtils.getYarnUrlFromPath(pubRsrcPath2),LocalResourceType.FILE,LocalResourceVisibility.PUBLIC,789L,135L);
  LocalResourceProto pubRsrcProto2=rsrcPb.getProto();
  Path pubRsrcLocalPath2=new Path("/some/local/dir/for/pubrsrc2");
  stateStore.startResourceLocalization(null,null,pubRsrcProto2,pubRsrcLocalPath2);
  Path privRsrcPath=new Path("hdfs://some/private/resource");
  rsrcPb=(LocalResourcePBImpl)LocalResource.newInstance(ConverterUtils.getYarnUrlFromPath(privRsrcPath),LocalResourceType.PATTERN,LocalResourceVisibility.PRIVATE,789L,680L,"*pattern*");
  LocalResourceProto privRsrcProto=rsrcPb.getProto();
  Path privRsrcLocalPath=new Path("/some/local/dir/for/privrsrc");
  stateStore.startResourceLocalization(user,null,privRsrcProto,privRsrcLocalPath);
  LocalizedResourceProto pubLocalizedProto1=LocalizedResourceProto.newBuilder().setResource(pubRsrcProto1).setLocalPath(pubRsrcLocalPath1.toString()).setSize(pubRsrcProto1.getSize()).build();
  stateStore.finishResourceLocalization(null,null,pubLocalizedProto1);
  LocalizedResourceProto privLocalizedProto=LocalizedResourceProto.newBuilder().setResource(privRsrcProto).setLocalPath(privRsrcLocalPath.toString()).setSize(privRsrcProto.getSize()).build();
  stateStore.finishResourceLocalization(user,null,privLocalizedProto);
  restartStateStore();
  state=stateStore.loadLocalizationState();
  pubts=state.getPublicTrackerState();
  assertEquals(1,pubts.getLocalizedResources().size());
  assertEquals(pubLocalizedProto1,pubts.getLocalizedResources().iterator().next());
  assertEquals(1,pubts.getInProgressResources().size());
  assertEquals(pubRsrcLocalPath2,pubts.getInProgressResources().get(pubRsrcProto2));
  userResources=state.getUserResources();
  assertEquals(1,userResources.size());
  rur=userResources.get(user);
  privts=rur.getPrivateTrackerState();
  assertNotNull(privts);
  assertEquals(1,privts.getLocalizedResources().size());
  assertEquals(privLocalizedProto,privts.getLocalizedResources().iterator().next());
  assertTrue(privts.getInProgressResources().isEmpty());
  assertEquals(1,rur.getAppTrackerStates().size());
  appts=rur.getAppTrackerStates().get(appId);
  assertNotNull(appts);
  assertTrue(appts.getInProgressResources().isEmpty());
  assertEquals(1,appts.getLocalizedResources().size());
  assertEquals(appLocalizedProto,appts.getLocalizedResources().iterator().next());
}
