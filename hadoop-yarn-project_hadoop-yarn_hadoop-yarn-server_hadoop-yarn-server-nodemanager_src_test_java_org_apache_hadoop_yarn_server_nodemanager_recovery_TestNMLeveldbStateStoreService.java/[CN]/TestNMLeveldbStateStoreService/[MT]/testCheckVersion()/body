{
  NMDBSchemaVersion defaultVersion=stateStore.getCurrentVersion();
  Assert.assertEquals(defaultVersion,stateStore.loadVersion());
  NMDBSchemaVersion compatibleVersion=NMDBSchemaVersion.newInstance(defaultVersion.getMajorVersion(),defaultVersion.getMinorVersion() + 2);
  stateStore.storeVersion(compatibleVersion);
  Assert.assertEquals(compatibleVersion,stateStore.loadVersion());
  restartStateStore();
  Assert.assertEquals(defaultVersion,stateStore.loadVersion());
  NMDBSchemaVersion incompatibleVersion=NMDBSchemaVersion.newInstance(defaultVersion.getMajorVersion() + 1,defaultVersion.getMinorVersion());
  stateStore.storeVersion(incompatibleVersion);
  try {
    restartStateStore();
    Assert.fail("Incompatible version, should expect fail here.");
  }
 catch (  ServiceStateException e) {
    Assert.assertTrue("Exception message mismatch",e.getMessage().contains("Incompatible version for NM state:"));
  }
}
