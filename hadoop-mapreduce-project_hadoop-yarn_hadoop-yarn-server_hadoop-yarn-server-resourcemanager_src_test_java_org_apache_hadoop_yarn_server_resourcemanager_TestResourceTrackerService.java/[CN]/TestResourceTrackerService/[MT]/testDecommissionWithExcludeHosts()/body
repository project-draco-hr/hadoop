{
  Configuration conf=new Configuration();
  conf.set("yarn.resourcemanager.nodes.exclude-path",hostFile.getAbsolutePath());
  writeToHostsFile("");
  rm=new MockRM(conf);
  rm.start();
  MockNM nm1=rm.registerNode("host1:1234",5120);
  MockNM nm2=rm.registerNode("host2:5678",10240);
  int initialMetricCount=ClusterMetrics.getMetrics().getNumDecommisionedNMs();
  HeartbeatResponse nodeHeartbeat=nm1.nodeHeartbeat(true);
  Assert.assertTrue(NodeAction.NORMAL.equals(nodeHeartbeat.getNodeAction()));
  nodeHeartbeat=nm2.nodeHeartbeat(true);
  Assert.assertTrue(NodeAction.NORMAL.equals(nodeHeartbeat.getNodeAction()));
  writeToHostsFile("host2");
  rm.getNodesListManager().refreshNodes();
  nodeHeartbeat=nm1.nodeHeartbeat(true);
  Assert.assertTrue(NodeAction.NORMAL.equals(nodeHeartbeat.getNodeAction()));
  nodeHeartbeat=nm2.nodeHeartbeat(true);
  Assert.assertTrue("The decommisioned metrics are not updated",NodeAction.SHUTDOWN.equals(nodeHeartbeat.getNodeAction()));
  checkDecommissionedNMCount(rm,++initialMetricCount);
}
