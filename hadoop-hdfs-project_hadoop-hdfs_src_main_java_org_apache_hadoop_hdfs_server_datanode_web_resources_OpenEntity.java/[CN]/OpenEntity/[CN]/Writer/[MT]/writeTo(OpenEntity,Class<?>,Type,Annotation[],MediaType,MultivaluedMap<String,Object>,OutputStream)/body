{
  try {
    byte[] buf=new byte[e.outBufferSize];
    long remaining=e.length;
    while (remaining > 0) {
      int read=e.in.read(buf,0,(int)Math.min(buf.length,remaining));
      if (read == -1) {
        break;
      }
      out.write(buf,0,read);
      out.flush();
      remaining-=read;
    }
  }
  finally {
    IOUtils.cleanup(DatanodeWebHdfsMethods.LOG,e.in);
    IOUtils.cleanup(DatanodeWebHdfsMethods.LOG,e.dfsclient);
  }
}
