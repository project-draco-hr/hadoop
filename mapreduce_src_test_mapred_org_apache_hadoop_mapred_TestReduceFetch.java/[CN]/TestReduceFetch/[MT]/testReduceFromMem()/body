{
  final int MAP_TASKS=3;
  JobConf job=mrCluster.createJobConf();
  job.set(JobContext.REDUCE_INPUT_BUFFER_PERCENT,"1.0");
  job.set(JobContext.SHUFFLE_INPUT_BUFFER_PERCENT,"1.0");
  job.setLong(JobContext.REDUCE_MEMORY_TOTAL_BYTES,128 << 20);
  job.setNumMapTasks(MAP_TASKS);
  Counters c=runJob(job);
  final long spill=c.findCounter(TaskCounter.SPILLED_RECORDS).getCounter();
  final long out=c.findCounter(TaskCounter.MAP_OUTPUT_RECORDS).getCounter();
  assertEquals("Spilled records: " + spill,out,spill);
}
