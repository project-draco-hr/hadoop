{
  int stoppedDN=0;
  for (  Map.Entry<ExtendedBlock,DataNode> target : corruptTargets.entrySet()) {
    if (stoppedDN == 0 || type != ReconstructionType.DataOnly || random.nextBoolean()) {
      LOG.info("Note: stop DataNode " + target.getValue().getDisplayName() + " with internal block "+ target.getKey());
      shutdownDataNode(target.getValue());
      stoppedDN++;
    }
 else {
      LOG.info("Note: corrupt data on " + target.getValue().getDisplayName() + " with internal block "+ target.getKey());
      cluster.corruptReplica(target.getValue(),target.getKey());
    }
  }
  return stoppedDN;
}
