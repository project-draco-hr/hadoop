{
  Configuration conf=new Configuration();
  MiniDFSCluster cluster=null;
  String pathName="/snapshot";
  Path path=new Path(pathName);
  try {
    cluster=new MiniDFSCluster.Builder(conf).build();
    cluster.waitActive();
    SnapshotManager sm=cluster.getNamesystem().getSnapshotManager();
    DistributedFileSystem dfs=(DistributedFileSystem)cluster.getFileSystem();
    dfs.mkdirs(path);
    dfs.allowSnapshot(path);
    dfs.createSnapshot(path);
    MBeanServer mbs=ManagementFactory.getPlatformMBeanServer();
    ObjectName mxbeanName=new ObjectName("Hadoop:service=NameNode,name=SnapshotInfo");
    CompositeData[] directories=(CompositeData[])mbs.getAttribute(mxbeanName,"SnapshottableDirectories");
    int numDirectories=Array.getLength(directories);
    assertEquals(sm.getNumSnapshottableDirs(),numDirectories);
    CompositeData[] snapshots=(CompositeData[])mbs.getAttribute(mxbeanName,"Snapshots");
    int numSnapshots=Array.getLength(snapshots);
    assertEquals(sm.getNumSnapshots(),numSnapshots);
    CompositeData d=(CompositeData)Array.get(directories,0);
    CompositeData s=(CompositeData)Array.get(snapshots,0);
    assertTrue(((String)d.get("path")).contains(pathName));
    assertTrue(((String)s.get("snapshotDirectory")).contains(pathName));
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
