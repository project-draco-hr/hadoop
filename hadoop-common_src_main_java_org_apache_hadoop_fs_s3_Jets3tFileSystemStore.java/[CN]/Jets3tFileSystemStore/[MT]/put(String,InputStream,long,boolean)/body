{
  try {
    S3Object object=new S3Object(key);
    object.setDataInputStream(in);
    object.setContentType("binary/octet-stream");
    object.setContentLength(length);
    if (storeMetadata) {
      object.addAllMetadata(METADATA);
    }
    s3Service.putObject(bucket,object);
  }
 catch (  S3ServiceException e) {
    if (e.getCause() instanceof IOException) {
      throw (IOException)e.getCause();
    }
    throw new S3Exception(e);
  }
}
