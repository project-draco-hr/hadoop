{
  final TimelineCollectorManager collectorManager=spy(new TimelineCollectorManager());
  doReturn(new Configuration()).when(collectorManager).getConfig();
  CollectorNodemanagerProtocol nmCollectorService=mock(CollectorNodemanagerProtocol.class);
  GetTimelineCollectorContextResponse response=GetTimelineCollectorContextResponse.newInstance(null,null,null);
  try {
    when(nmCollectorService.getTimelineCollectorContext(any(GetTimelineCollectorContextRequest.class))).thenReturn(response);
  }
 catch (  YarnException|IOException e) {
    fail();
  }
  doReturn(nmCollectorService).when(collectorManager).getNMCollectorService();
  return collectorManager;
}
