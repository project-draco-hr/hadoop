{
  JournalListener listener=Mockito.mock(JournalListener.class);
  JournalService service=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    cluster.waitActive(0);
    service=startJournalService(listener);
    verifyRollLogsCallback(service,listener);
    verifyJournalCallback(service,listener);
    verifyFence(service,cluster.getNameNode(0));
  }
  finally {
    if (service != null) {
      service.stop();
    }
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
