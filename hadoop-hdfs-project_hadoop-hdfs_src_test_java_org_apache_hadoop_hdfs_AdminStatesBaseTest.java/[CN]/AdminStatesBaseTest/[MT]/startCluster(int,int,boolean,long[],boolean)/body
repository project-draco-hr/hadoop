{
  MiniDFSCluster.Builder builder=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleFederatedTopology(numNameNodes)).numDataNodes(numDatanodes);
  if (setupHostsFile) {
    builder.setupHostsFile(setupHostsFile);
  }
  if (nodesCapacity != null) {
    builder.simulatedCapacities(nodesCapacity);
  }
  if (checkDataNodeHostConfig) {
    builder.checkDataNodeHostConfig(checkDataNodeHostConfig);
  }
  cluster=builder.build();
  cluster.waitActive();
  for (int i=0; i < numNameNodes; i++) {
    DFSClient client=getDfsClient(i);
    validateCluster(client,numDatanodes);
  }
}
