{
  CapacityScheduler cs=new CapacityScheduler();
  cs.setConf(new YarnConfiguration());
  cs.setRMContext(resourceManager.getRMContext());
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(conf);
  setMaxAllocMb(conf,YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_MB);
  setMaxAllocVcores(conf,YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_VCORES);
  setMaxAllocMb(conf,A1,4096);
  setMaxAllocVcores(conf,A1,2);
  cs.init(conf);
  cs.start();
  cs.reinitialize(conf,mockContext);
  checkQueueCapacities(cs,A_CAPACITY,B_CAPACITY);
  assertEquals("max capability MB in CS",YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_MB,cs.getMaximumResourceCapability().getMemory());
  assertEquals("max capability vcores in CS",YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_VCORES,cs.getMaximumResourceCapability().getVirtualCores());
  assertEquals("max allocation MB A1",4096,conf.getMaximumAllocationPerQueue(A1).getMemory());
  assertEquals("max allocation vcores A1",2,conf.getMaximumAllocationPerQueue(A1).getVirtualCores());
  assertEquals("cluster max allocation MB",YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_MB,conf.getMaximumAllocation().getMemory());
  assertEquals("cluster max allocation vcores",YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_VCORES,conf.getMaximumAllocation().getVirtualCores());
  CSQueue rootQueue=cs.getRootQueue();
  CSQueue queueA=findQueue(rootQueue,A);
  CSQueue queueA1=findQueue(queueA,A1);
  assertEquals("queue max allocation",((LeafQueue)queueA1).getMaximumAllocation().getMemory(),4096);
  setMaxAllocMb(conf,A1,6144);
  setMaxAllocVcores(conf,A1,3);
  cs.reinitialize(conf,null);
  assertEquals("max allocation MB A1",6144,conf.getMaximumAllocationPerQueue(A1).getMemory());
  assertEquals("max allocation vcores A1",3,conf.getMaximumAllocationPerQueue(A1).getVirtualCores());
  assertEquals("max allocation MB cluster",YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_MB,conf.getMaximumAllocation().getMemory());
  assertEquals("max allocation vcores cluster",YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_VCORES,conf.getMaximumAllocation().getVirtualCores());
  assertEquals("queue max allocation MB",6144,((LeafQueue)queueA1).getMaximumAllocation().getMemory());
  assertEquals("queue max allocation vcores",3,((LeafQueue)queueA1).getMaximumAllocation().getVirtualCores());
  assertEquals("max capability MB cluster",YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_MB,cs.getMaximumResourceCapability().getMemory());
  assertEquals("cluster max capability vcores",YarnConfiguration.DEFAULT_RM_SCHEDULER_MAXIMUM_ALLOCATION_VCORES,cs.getMaximumResourceCapability().getVirtualCores());
}
