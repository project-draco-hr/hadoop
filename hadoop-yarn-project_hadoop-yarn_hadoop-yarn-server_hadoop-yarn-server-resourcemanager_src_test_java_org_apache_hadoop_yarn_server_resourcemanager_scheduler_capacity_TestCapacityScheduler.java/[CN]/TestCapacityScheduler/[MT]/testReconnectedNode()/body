{
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(csConf);
  CapacityScheduler cs=new CapacityScheduler();
  cs.setConf(new YarnConfiguration());
  cs.reinitialize(csConf,new RMContextImpl(null,null,null,null,null,null,new RMContainerTokenSecretManager(csConf),new NMTokenSecretManagerInRM(csConf),new ClientToAMTokenSecretManagerInRM(),null));
  RMNode n1=MockNodes.newNodeInfo(0,MockNodes.newResource(4 * GB),1);
  RMNode n2=MockNodes.newNodeInfo(0,MockNodes.newResource(2 * GB),2);
  cs.handle(new NodeAddedSchedulerEvent(n1));
  cs.handle(new NodeAddedSchedulerEvent(n2));
  Assert.assertEquals(6 * GB,cs.getClusterResource().getMemory());
  n1=MockNodes.newNodeInfo(0,MockNodes.newResource(2 * GB),1);
  cs.handle(new NodeRemovedSchedulerEvent(n1));
  cs.handle(new NodeAddedSchedulerEvent(n1));
  Assert.assertEquals(4 * GB,cs.getClusterResource().getMemory());
}
