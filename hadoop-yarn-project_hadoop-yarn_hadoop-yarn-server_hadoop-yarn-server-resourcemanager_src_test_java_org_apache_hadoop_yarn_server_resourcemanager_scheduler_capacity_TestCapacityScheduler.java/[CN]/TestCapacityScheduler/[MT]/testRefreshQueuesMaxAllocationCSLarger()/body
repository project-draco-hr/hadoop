{
  CapacityScheduler cs=new CapacityScheduler();
  cs.setConf(new YarnConfiguration());
  cs.setRMContext(resourceManager.getRMContext());
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  setupQueueConfiguration(conf);
  setMaxAllocMb(conf,10240);
  setMaxAllocVcores(conf,10);
  setMaxAllocMb(conf,A1,4096);
  setMaxAllocVcores(conf,A1,4);
  cs.init(conf);
  cs.start();
  cs.reinitialize(conf,mockContext);
  checkQueueCapacities(cs,A_CAPACITY,B_CAPACITY);
  assertEquals("max allocation MB in CS",10240,cs.getMaximumResourceCapability().getMemory());
  assertEquals("max allocation vcores in CS",10,cs.getMaximumResourceCapability().getVirtualCores());
  CSQueue rootQueue=cs.getRootQueue();
  CSQueue queueA=findQueue(rootQueue,A);
  CSQueue queueB=findQueue(rootQueue,B);
  CSQueue queueA1=findQueue(queueA,A1);
  CSQueue queueA2=findQueue(queueA,A2);
  CSQueue queueB2=findQueue(queueB,B2);
  assertEquals("queue A1 max allocation MB",4096,((LeafQueue)queueA1).getMaximumAllocation().getMemory());
  assertEquals("queue A1 max allocation vcores",4,((LeafQueue)queueA1).getMaximumAllocation().getVirtualCores());
  assertEquals("queue A2 max allocation MB",10240,((LeafQueue)queueA2).getMaximumAllocation().getMemory());
  assertEquals("queue A2 max allocation vcores",10,((LeafQueue)queueA2).getMaximumAllocation().getVirtualCores());
  assertEquals("queue B2 max allocation MB",10240,((LeafQueue)queueB2).getMaximumAllocation().getMemory());
  assertEquals("queue B2 max allocation vcores",10,((LeafQueue)queueB2).getMaximumAllocation().getVirtualCores());
  setMaxAllocMb(conf,12288);
  setMaxAllocVcores(conf,12);
  cs.reinitialize(conf,null);
  assertEquals("max allocation MB in CS",12288,cs.getMaximumResourceCapability().getMemory());
  assertEquals("max allocation vcores in CS",12,cs.getMaximumResourceCapability().getVirtualCores());
  assertEquals("queue A1 max MB allocation",4096,((LeafQueue)queueA1).getMaximumAllocation().getMemory());
  assertEquals("queue A1 max vcores allocation",4,((LeafQueue)queueA1).getMaximumAllocation().getVirtualCores());
  assertEquals("queue A2 max MB allocation",12288,((LeafQueue)queueA2).getMaximumAllocation().getMemory());
  assertEquals("queue A2 max vcores allocation",12,((LeafQueue)queueA2).getMaximumAllocation().getVirtualCores());
  assertEquals("queue B2 max MB allocation",12288,((LeafQueue)queueB2).getMaximumAllocation().getMemory());
  assertEquals("queue B2 max vcores allocation",12,((LeafQueue)queueB2).getMaximumAllocation().getVirtualCores());
}
