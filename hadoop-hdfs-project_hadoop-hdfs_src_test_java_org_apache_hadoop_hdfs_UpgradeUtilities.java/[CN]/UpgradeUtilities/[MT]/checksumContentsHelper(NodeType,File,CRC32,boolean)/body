{
  if (!dir.isDirectory()) {
    throw new IllegalArgumentException("Given argument is not a directory:" + dir);
  }
  File[] list=dir.listFiles();
  Arrays.sort(list);
  for (int i=0; i < list.length; i++) {
    if (!list[i].isFile()) {
      if (recursive) {
        checksumContentsHelper(nodeType,list[i],checksum,recursive);
      }
      continue;
    }
    if (nodeType == DATA_NODE && (list[i].getName().equals("VERSION") || list[i].getName().equals("dfsUsed"))) {
      continue;
    }
    FileInputStream fis=null;
    try {
      fis=new FileInputStream(list[i]);
      byte[] buffer=new byte[1024];
      int bytesRead;
      while ((bytesRead=fis.read(buffer)) != -1) {
        checksum.update(buffer,0,bytesRead);
      }
    }
  finally {
      if (fis != null) {
        fis.close();
      }
    }
  }
}
