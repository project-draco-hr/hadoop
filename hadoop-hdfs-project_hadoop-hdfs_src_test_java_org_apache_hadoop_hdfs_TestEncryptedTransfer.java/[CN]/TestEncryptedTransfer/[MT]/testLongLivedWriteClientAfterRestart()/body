{
  setEncryptionConfigKeys();
  cluster=new MiniDFSCluster.Builder(conf).build();
  fs=getFileSystem(conf);
  writeTestDataToFile(fs);
  assertEquals(PLAIN_TEXT,DFSTestUtil.readFile(fs,TEST_PATH));
  cluster.restartNameNode();
  assertTrue(cluster.restartDataNodes());
  cluster.waitActive();
  writeTestDataToFile(fs);
  assertEquals(PLAIN_TEXT + PLAIN_TEXT,DFSTestUtil.readFile(fs,TEST_PATH));
}
