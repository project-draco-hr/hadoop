{
  if (replicas.length == 0) {
    replicas=new ReplicaUnderConstruction[1];
    replicas[0]=new ReplicaUnderConstruction(reportedBlock,storage,rState);
  }
 else {
    for (int i=0; i < replicas.length; i++) {
      DatanodeStorageInfo expected=replicas[i].getExpectedStorageLocation();
      if (expected == storage) {
        replicas[i].setGenerationStamp(reportedBlock.getGenerationStamp());
        return;
      }
 else       if (expected != null && expected.getDatanodeDescriptor() == storage.getDatanodeDescriptor()) {
        replicas[i]=new ReplicaUnderConstruction(reportedBlock,storage,rState);
        return;
      }
    }
    ReplicaUnderConstruction[] newReplicas=new ReplicaUnderConstruction[replicas.length + 1];
    System.arraycopy(replicas,0,newReplicas,0,replicas.length);
    newReplicas[newReplicas.length - 1]=new ReplicaUnderConstruction(reportedBlock,storage,rState);
    replicas=newReplicas;
  }
}
