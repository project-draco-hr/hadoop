{
  Preconditions.checkState(asyncStatus,"openFileCtx has false asyncStatus, fileId:" + latestAttr.getFileId());
  final long startOffset=asyncWriteBackStartOffset;
  try {
    while (activeState) {
      WriteCtx toWrite=offerNextToWrite();
      if (toWrite != null) {
        doSingleWrite(toWrite);
        updateLastAccessTime();
      }
 else {
        break;
      }
    }
    if (!activeState && LOG.isDebugEnabled()) {
      LOG.debug("The openFileCtx is not active anymore, fileId: " + latestAttr.getFileId());
    }
  }
  finally {
synchronized (this) {
      if (startOffset == asyncWriteBackStartOffset) {
        asyncStatus=false;
      }
 else {
        LOG.info("Another asyn task is already started before this one" + " is finalized. fileId:" + latestAttr.getFileId() + " asyncStatus:"+ asyncStatus+ " original startOffset:"+ startOffset+ " new startOffset:"+ asyncWriteBackStartOffset+ ". Won't change asyncStatus here.");
      }
    }
  }
}
