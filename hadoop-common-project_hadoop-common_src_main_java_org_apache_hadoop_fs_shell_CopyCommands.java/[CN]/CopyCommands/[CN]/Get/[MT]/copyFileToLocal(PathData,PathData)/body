{
  File targetFile=target.toFile();
  File tmpFile=FileUtil.createLocalTempFile(targetFile,COPYTOLOCAL_PREFIX,true);
  if (!FileUtil.copy(src.fs,src.path,tmpFile,false,getConf())) {
    PathIOException e=new PathIOException(src.toString());
    e.setOperation("copy");
    e.setTargetPath(tmpFile.toString());
    throw e;
  }
  if (!tmpFile.renameTo(targetFile)) {
    PathIOException e=new PathIOException(tmpFile.toString());
    e.setOperation("rename");
    e.setTargetPath(targetFile.toString());
    throw e;
  }
}
