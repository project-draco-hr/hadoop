{
  TimelineDelegationTokenOperation op=TimelineDelegationTokenOperation.GETDELEGATIONTOKEN;
  Map<String,String> params=new HashMap<String,String>();
  params.put(TimelineAuthenticationConsts.OP_PARAM,op.toString());
  params.put(TimelineAuthenticationConsts.RENEWER_PARAM,renewer);
  url=appendParams(url,params);
  AuthenticatedURL aUrl=new AuthenticatedURL(new TimelineAuthenticator());
  try {
    HttpURLConnection conn=aUrl.openConnection(url,token);
    conn.setRequestMethod(op.getHttpMethod());
    TimelineDelegationTokenResponse dtRes=validateAndParseResponse(conn);
    if (!dtRes.getType().equals(TimelineAuthenticationConsts.DELEGATION_TOKEN_URL)) {
      throw new IOException("The response content is not expected: " + dtRes.getContent());
    }
    String tokenStr=dtRes.getContent().toString();
    Token<TimelineDelegationTokenIdentifier> dToken=new Token<TimelineDelegationTokenIdentifier>();
    dToken.decodeFromUrlString(tokenStr);
    return dToken;
  }
 catch (  AuthenticationException ex) {
    throw new IOException(ex.toString(),ex);
  }
}
