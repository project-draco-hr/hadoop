{
  writeSegment(qjm,1,3,true);
  waitForAllPendingCalls(qjm.getLoggerSetForTests());
  cluster.getJournalNode(0).stopAndJoin(0);
  writeSegment(qjm,4,3,true);
  waitForAllPendingCalls(qjm.getLoggerSetForTests());
  cluster.restartJournalNode(0);
  writeSegment(qjm,7,3,true);
  waitForAllPendingCalls(qjm.getLoggerSetForTests());
  cluster.getJournalNode(1).stopAndJoin(0);
  QuorumJournalManager readerQjm=createSpyingQJM();
  List<EditLogInputStream> streams=Lists.newArrayList();
  try {
    readerQjm.selectInputStreams(streams,1,false);
    verifyEdits(streams,1,9);
  }
  finally {
    IOUtils.cleanup(LOG,streams.toArray(new Closeable[0]));
    readerQjm.close();
  }
}
