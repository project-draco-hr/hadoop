{
  if (statistics.get(name) != null) {
    throw new RuntimeException("Stat with name " + name + " is already defined");
  }
  Map<TimeWindow,TimeStat> timeStats=new LinkedHashMap<TimeWindow,TimeStat>();
  for (  TimeWindow window : windows) {
    StatUpdater collector=updaters.get(window);
    if (collector == null) {
      if (SINCE_START.equals(window)) {
        collector=new StatUpdater();
      }
 else {
        collector=new TimeWindowStatUpdater(window,period);
      }
      updaters.put(window,collector);
    }
    TimeStat timeStat=new TimeStat();
    collector.addTimeStat(name,timeStat);
    timeStats.put(window,timeStat);
  }
  Stat stat=new Stat(name,timeStats);
  statistics.put(name,stat);
  return stat;
}
