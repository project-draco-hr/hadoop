{
  if (jmxPortNumber != -1)   return jmxPortNumber;
  String jmxPortString="-Dcom.sun.management.jmxremote.port";
  String hadoopOpts=getProcessInfo().getEnv().get(envivar);
  int portNumber=-1;
  boolean found=false;
  String[] options=hadoopOpts.split(" ");
  for (  String option : options) {
    if (option.startsWith(jmxPortString)) {
      found=true;
      try {
        portNumber=Integer.parseInt(option.split("=")[1]);
      }
 catch (      NumberFormatException e) {
        throw new IllegalArgumentException("JMX port number isn't integer");
      }
      break;
    }
  }
  if (!found)   throw new IllegalArgumentException("Can't detect JMX port number");
  jmxPortNumber=portNumber;
  return jmxPortNumber;
}
