{
  int cellSize=ecSchema.getChunkSize();
  int dataBlkNum=ecSchema.getNumDataUnits();
  int done=0;
  for (int i=firstCellIdxInBG; i <= lastCellIdxInBG; i++) {
    StripingCell cell=new StripingCell(ecSchema,i);
    long cellStart=i == firstCellIdxInBG ? firstCellOffsetInBlk : cell.idxInInternalBlk * cellSize;
    int cellLen;
    if (i == firstCellIdxInBG) {
      cellLen=firstCellSize;
    }
 else     if (i == lastCellIdxInBG) {
      cellLen=lastCellSize;
    }
 else {
      cellLen=cellSize;
    }
    long cellEnd=cellStart + cellLen - 1;
    for (    AlignedStripe s : stripes) {
      long stripeEnd=s.getOffsetInBlock() + s.getSpanInBlock() - 1;
      long overlapStart=Math.max(cellStart,s.getOffsetInBlock());
      long overlapEnd=Math.min(cellEnd,stripeEnd);
      int overLapLen=(int)(overlapEnd - overlapStart + 1);
      if (overLapLen <= 0) {
        continue;
      }
      if (s.chunks[cell.idxInStripe] == null) {
        s.chunks[cell.idxInStripe]=new StripingChunk(buf);
      }
      s.chunks[cell.idxInStripe].offsetsInBuf.add((int)(offsetInBuf + done + overlapStart - cellStart));
      s.chunks[cell.idxInStripe].lengthsInBuf.add(overLapLen);
    }
    done+=cellLen;
  }
}
