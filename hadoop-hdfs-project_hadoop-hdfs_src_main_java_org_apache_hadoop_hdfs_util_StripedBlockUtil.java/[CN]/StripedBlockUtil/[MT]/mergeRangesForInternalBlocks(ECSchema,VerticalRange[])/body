{
  int dataBlkNum=ecSchema.getNumDataUnits();
  int parityBlkNum=ecSchema.getNumParityUnits();
  List<AlignedStripe> stripes=new ArrayList<>();
  SortedSet<Long> stripePoints=new TreeSet<>();
  for (  VerticalRange r : ranges) {
    if (r != null) {
      stripePoints.add(r.offsetInBlock);
      stripePoints.add(r.offsetInBlock + r.spanInBlock);
    }
  }
  long prev=-1;
  for (  long point : stripePoints) {
    if (prev >= 0) {
      stripes.add(new AlignedStripe(prev,point - prev,dataBlkNum + parityBlkNum));
    }
    prev=point;
  }
  return stripes.toArray(new AlignedStripe[stripes.size()]);
}
