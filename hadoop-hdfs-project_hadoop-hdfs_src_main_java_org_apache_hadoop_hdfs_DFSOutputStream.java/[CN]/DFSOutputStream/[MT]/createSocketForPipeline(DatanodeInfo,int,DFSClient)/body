{
  final String dnAddr=first.getXferAddr(client.getConf().connectToDnViaHostname);
  if (DFSClient.LOG.isDebugEnabled()) {
    DFSClient.LOG.debug("Connecting to datanode " + dnAddr);
  }
  final InetSocketAddress isa=NetUtils.createSocketAddr(dnAddr);
  final Socket sock=client.socketFactory.createSocket();
  final int timeout=client.getDatanodeReadTimeout(length);
  NetUtils.connect(sock,isa,client.getRandomLocalInterfaceAddr(),client.getConf().socketTimeout);
  sock.setSoTimeout(timeout);
  sock.setSendBufferSize(HdfsConstants.DEFAULT_DATA_SOCKET_SIZE);
  if (DFSClient.LOG.isDebugEnabled()) {
    DFSClient.LOG.debug("Send buf size " + sock.getSendBufferSize());
  }
  return sock;
}
