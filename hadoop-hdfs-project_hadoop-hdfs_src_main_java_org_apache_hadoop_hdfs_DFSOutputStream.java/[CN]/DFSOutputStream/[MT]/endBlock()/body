{
  if (getStreamer().getBytesCurBlock() == blockSize) {
    currentPacket=createPacket(0,0,getStreamer().getBytesCurBlock(),getStreamer().getAndIncCurrentSeqno(),true);
    currentPacket.setSyncBlock(shouldSyncBlock);
    getStreamer().waitAndQueuePacket(currentPacket);
    currentPacket=null;
    getStreamer().setBytesCurBlock(0);
    lastFlushOffset=0;
  }
}
