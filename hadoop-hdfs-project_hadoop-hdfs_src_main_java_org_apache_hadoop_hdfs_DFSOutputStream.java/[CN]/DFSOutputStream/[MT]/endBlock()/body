{
  if (streamer.getBytesCurBlock() == blockSize) {
    currentPacket=createPacket(0,0,streamer.getBytesCurBlock(),streamer.getAndIncCurrentSeqno(),true);
    currentPacket.setSyncBlock(shouldSyncBlock);
    streamer.waitAndQueuePacket(currentPacket);
    currentPacket=null;
    streamer.setBytesCurBlock(0);
    lastFlushOffset=0;
  }
}
