{
  this(dfsClient,src,progress,stat,checksum);
  initialFileSize=stat.getLen();
  Span traceSpan=null;
  if (Trace.isTracing()) {
    traceSpan=Trace.startSpan(this.getClass().getSimpleName()).detach();
  }
  if (!toNewBlock && lastBlock != null) {
    bytesCurBlock=lastBlock.getBlockSize();
    streamer=new DataStreamer(lastBlock,stat,bytesPerChecksum,traceSpan);
  }
 else {
    computePacketChunkSize(dfsClient.getConf().writePacketSize,bytesPerChecksum);
    streamer=new DataStreamer(stat,lastBlock != null ? lastBlock.getBlock() : null,traceSpan);
  }
  this.fileEncryptionInfo=stat.getFileEncryptionInfo();
}
