{
  HdfsBlocksMetadata metadata=null;
  ClientDatanodeProtocol cdp=null;
  TraceScope scope=Trace.startSpan("getHdfsBlocksMetadata",parentSpan);
  try {
    cdp=DFSUtil.createClientDatanodeProtocolProxy(datanode,configuration,timeout,connectToDnViaHostname);
    metadata=cdp.getHdfsBlocksMetadata(poolId,blockIds,dnTokens);
  }
 catch (  IOException e) {
    throw e;
  }
 finally {
    scope.close();
    if (cdp != null) {
      RPC.stopProxy(cdp);
    }
  }
  return metadata;
}
