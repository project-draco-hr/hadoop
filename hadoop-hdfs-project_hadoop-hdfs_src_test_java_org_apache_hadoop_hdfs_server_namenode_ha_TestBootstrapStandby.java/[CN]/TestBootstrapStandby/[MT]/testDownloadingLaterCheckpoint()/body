{
  nn0.getRpcServer().rollEditLog();
  nn0.getRpcServer().rollEditLog();
  NameNodeAdapter.enterSafeMode(nn0,false);
  NameNodeAdapter.saveNamespace(nn0);
  NameNodeAdapter.leaveSafeMode(nn0);
  long expectedCheckpointTxId=NameNodeAdapter.getNamesystem(nn0).getFSImage().getMostRecentCheckpointTxId();
  assertEquals(6,expectedCheckpointTxId);
  cluster.getFileSystem(0).create(new Path("/test_txid"),(short)1).close();
  URI editsUri=cluster.getSharedEditsDir(0,maxNNCount - 1);
  long seen_txid_shared=FSImageTestUtil.getStorageTxId(nn0,editsUri);
  for (int i=1; i < maxNNCount; i++) {
    assertEquals(0,forceBootstrap(i));
    LOG.info("Checking namenode: " + i);
    FSImageTestUtil.assertNNHasCheckpoints(cluster,i,ImmutableList.of((int)expectedCheckpointTxId));
  }
  FSImageTestUtil.assertNNFilesMatch(cluster);
  assertEquals(seen_txid_shared,FSImageTestUtil.getStorageTxId(nn0,editsUri));
  restartNameNodesFromIndex(1);
}
