{
  nn0.getRpcServer().rollEditLog();
  nn0.getRpcServer().rollEditLog();
  NameNodeAdapter.enterSafeMode(nn0,false);
  NameNodeAdapter.saveNamespace(nn0);
  NameNodeAdapter.leaveSafeMode(nn0);
  long expectedCheckpointTxId=NameNodeAdapter.getNamesystem(nn0).getFSImage().getMostRecentCheckpointTxId();
  assertEquals(6,expectedCheckpointTxId);
  int rc=BootstrapStandby.run(new String[]{"-force"},cluster.getConfiguration(1));
  assertEquals(0,rc);
  FSImageTestUtil.assertNNHasCheckpoints(cluster,1,ImmutableList.of((int)expectedCheckpointTxId));
  FSImageTestUtil.assertNNFilesMatch(cluster);
  cluster.restartNameNode(1);
}
