{
  if (first.isEmpty()) {
    return second;
  }
  Map<String,List<DatanodeDescriptor>> nodeGroupMap=new HashMap<String,List<DatanodeDescriptor>>();
  for (  DatanodeDescriptor node : first) {
    final String nodeGroupName=NetworkTopology.getLastHalf(node.getNetworkLocation());
    List<DatanodeDescriptor> datanodeList=nodeGroupMap.get(nodeGroupName);
    if (datanodeList == null) {
      datanodeList=new ArrayList<DatanodeDescriptor>();
      nodeGroupMap.put(nodeGroupName,datanodeList);
    }
    datanodeList.add(node);
  }
  final List<DatanodeDescriptor> moreThanOne=new ArrayList<DatanodeDescriptor>();
  final List<DatanodeDescriptor> exactlyOne=new ArrayList<DatanodeDescriptor>();
  for (  List<DatanodeDescriptor> datanodeList : nodeGroupMap.values()) {
    if (datanodeList.size() == 1) {
      exactlyOne.add(datanodeList.get(0));
    }
 else {
      moreThanOne.addAll(datanodeList);
    }
  }
  return moreThanOne.isEmpty() ? exactlyOne : moreThanOne;
}
