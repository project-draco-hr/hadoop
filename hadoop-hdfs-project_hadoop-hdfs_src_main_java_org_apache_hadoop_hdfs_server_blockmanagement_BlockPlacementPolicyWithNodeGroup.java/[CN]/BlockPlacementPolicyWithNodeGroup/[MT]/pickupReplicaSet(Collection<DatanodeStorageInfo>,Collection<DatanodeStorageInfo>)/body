{
  if (first.isEmpty()) {
    return second;
  }
  Map<String,List<DatanodeStorageInfo>> nodeGroupMap=new HashMap<>();
  for (  DatanodeStorageInfo storage : first) {
    final String nodeGroupName=NetworkTopology.getLastHalf(storage.getDatanodeDescriptor().getNetworkLocation());
    List<DatanodeStorageInfo> storageList=nodeGroupMap.get(nodeGroupName);
    if (storageList == null) {
      storageList=new ArrayList<>();
      nodeGroupMap.put(nodeGroupName,storageList);
    }
    storageList.add(storage);
  }
  final List<DatanodeStorageInfo> moreThanOne=new ArrayList<>();
  final List<DatanodeStorageInfo> exactlyOne=new ArrayList<>();
  for (  List<DatanodeStorageInfo> datanodeList : nodeGroupMap.values()) {
    if (datanodeList.size() == 1) {
      exactlyOne.add(datanodeList.get(0));
    }
 else {
      moreThanOne.addAll(datanodeList);
    }
  }
  return moreThanOne.isEmpty() ? exactlyOne : moreThanOne;
}
