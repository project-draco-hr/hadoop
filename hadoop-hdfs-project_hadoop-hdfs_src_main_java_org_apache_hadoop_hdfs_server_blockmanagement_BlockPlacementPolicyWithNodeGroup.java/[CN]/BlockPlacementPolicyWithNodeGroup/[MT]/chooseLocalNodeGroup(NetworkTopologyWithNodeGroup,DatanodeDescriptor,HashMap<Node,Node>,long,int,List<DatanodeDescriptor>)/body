{
  if (localMachine == null) {
    return chooseRandom(NodeBase.ROOT,excludedNodes,blocksize,maxNodesPerRack,results);
  }
  try {
    return chooseRandom(clusterMap.getNodeGroup(localMachine.getNetworkLocation()),excludedNodes,blocksize,maxNodesPerRack,results);
  }
 catch (  NotEnoughReplicasException e1) {
    DatanodeDescriptor newLocal=null;
    for (Iterator<DatanodeDescriptor> iter=results.iterator(); iter.hasNext(); ) {
      DatanodeDescriptor nextNode=iter.next();
      if (nextNode != localMachine) {
        newLocal=nextNode;
        break;
      }
    }
    if (newLocal != null) {
      try {
        return chooseRandom(clusterMap.getNodeGroup(newLocal.getNetworkLocation()),excludedNodes,blocksize,maxNodesPerRack,results);
      }
 catch (      NotEnoughReplicasException e2) {
        return chooseRandom(NodeBase.ROOT,excludedNodes,blocksize,maxNodesPerRack,results);
      }
    }
 else {
      return chooseRandom(NodeBase.ROOT,excludedNodes,blocksize,maxNodesPerRack,results);
    }
  }
}
