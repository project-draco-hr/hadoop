{
  conf=new HdfsConfiguration();
  fsHelper=new FileSystemTestHelper();
  String testRoot=fsHelper.getTestRootDir();
  File testRootDir=new File(testRoot).getAbsoluteFile();
  final Path jksPath=new Path(testRootDir.toString(),"test.jks");
  conf.set(DFSConfigKeys.DFS_ENCRYPTION_KEY_PROVIDER_URI,JavaKeyStoreProvider.SCHEME_NAME + "://file" + jksPath.toUri());
  cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  Logger.getLogger(EncryptionZoneManager.class).setLevel(Level.TRACE);
  fs=cluster.getFileSystem();
  fsWrapper=new FileSystemTestWrapper(cluster.getFileSystem());
  fcWrapper=new FileContextTestWrapper(FileContext.getFileContext(cluster.getURI(),conf));
  dfsAdmin=new HdfsAdmin(cluster.getURI(),conf);
  fs.getClient().setKeyProvider(cluster.getNameNode().getNamesystem().getProvider());
  DFSTestUtil.createKey(TEST_KEY,cluster,conf);
}
