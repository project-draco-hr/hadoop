{
  Map<String,List<DatanodeStorageInfo>> upgradeDomainMap=new HashMap<>();
  for (  DatanodeStorageInfo storage : storageInfos) {
    String upgradeDomain=getUpgradeDomainWithDefaultValue(storage.getDatanodeDescriptor());
    List<DatanodeStorageInfo> storages=upgradeDomainMap.get(upgradeDomain);
    if (storages == null) {
      storages=new ArrayList<>();
      upgradeDomainMap.put(upgradeDomain,storages);
    }
    storages.add(storage);
  }
  return upgradeDomainMap;
}
