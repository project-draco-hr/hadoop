{
  List<DatanodeStorageInfo> all=new ArrayList<>();
  if (moreThanOne != null) {
    all.addAll(moreThanOne);
  }
  if (exactlyOne != null) {
    all.addAll(exactlyOne);
  }
  Map<String,List<DatanodeStorageInfo>> upgradeDomains=getUpgradeDomainMap(all.toArray(new DatanodeStorageInfo[all.size()]));
  List<DatanodeStorageInfo> shareUDSet=getShareUDSet(upgradeDomains);
  List<DatanodeStorageInfo> shareRackAndUDSet=new ArrayList<>();
  if (shareUDSet.size() == 0) {
    return super.pickupReplicaSet(moreThanOne,exactlyOne);
  }
 else   if (moreThanOne != null) {
    for (    DatanodeStorageInfo storage : shareUDSet) {
      if (moreThanOne.contains(storage)) {
        shareRackAndUDSet.add(storage);
      }
    }
  }
  return (shareRackAndUDSet.size() > 0) ? shareRackAndUDSet : shareUDSet;
}
