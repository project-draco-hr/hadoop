{
  Collection<DatanodeStorageInfo> all=combine(moreThanOne,exactlyOne);
  List<DatanodeStorageInfo> shareUDSet=getShareUDSet(getUpgradeDomainMap(all));
  List<DatanodeStorageInfo> shareRackAndUDSet=new ArrayList<>();
  if (shareUDSet.size() == 0) {
    return super.pickupReplicaSet(moreThanOne,exactlyOne,rackMap);
  }
 else   if (moreThanOne != null) {
    for (    DatanodeStorageInfo storage : shareUDSet) {
      if (moreThanOne.contains(storage)) {
        shareRackAndUDSet.add(storage);
      }
    }
  }
  return (shareRackAndUDSet.size() > 0) ? shareRackAndUDSet : shareUDSet;
}
