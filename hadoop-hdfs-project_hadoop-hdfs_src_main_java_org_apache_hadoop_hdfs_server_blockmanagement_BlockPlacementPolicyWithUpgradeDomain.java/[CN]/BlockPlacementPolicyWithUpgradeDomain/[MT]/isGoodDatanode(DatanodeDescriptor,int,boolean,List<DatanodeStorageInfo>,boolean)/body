{
  boolean isGoodTarget=super.isGoodDatanode(node,maxTargetPerRack,considerLoad,results,avoidStaleNodes);
  if (isGoodTarget) {
    if (results.size() > 0 && results.size() < upgradeDomainFactor) {
      Set<String> upgradeDomains=getUpgradeDomains(results);
      if (upgradeDomains.contains(node.getUpgradeDomain())) {
        isGoodTarget=false;
      }
    }
  }
  return isGoodTarget;
}
