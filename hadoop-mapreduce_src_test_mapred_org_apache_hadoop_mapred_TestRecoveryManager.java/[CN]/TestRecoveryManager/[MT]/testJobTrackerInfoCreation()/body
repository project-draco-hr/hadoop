{
  LOG.info("Testing jobtracker.info file");
  MiniDFSCluster dfs=new MiniDFSCluster(new Configuration(),1,true,null);
  String namenode=(dfs.getFileSystem()).getUri().getHost() + ":" + (dfs.getFileSystem()).getUri().getPort();
  dfs.shutdownDataNodes();
  JobConf conf=new JobConf();
  FileSystem.setDefaultUri(conf,namenode);
  conf.set(JTConfig.JT_IPC_ADDRESS,"localhost:0");
  conf.set(JTConfig.JT_HTTP_ADDRESS,"127.0.0.1:0");
  JobTracker jobtracker=new JobTracker(conf);
  boolean failed=false;
  try {
    jobtracker.recoveryManager.updateRestartCount();
  }
 catch (  IOException ioe) {
    failed=true;
  }
  assertTrue("JobTracker created info files without datanodes!!!",failed);
  Path restartFile=jobtracker.recoveryManager.getRestartCountFile();
  Path tmpRestartFile=jobtracker.recoveryManager.getTempRestartCountFile();
  FileSystem fs=dfs.getFileSystem();
  assertFalse("Info file exists after update failure",fs.exists(restartFile));
  assertFalse("Temporary restart-file exists after update failure",fs.exists(restartFile));
  dfs.startDataNodes(conf,1,true,null,null,null,null);
  dfs.waitActive();
  failed=false;
  try {
    jobtracker.recoveryManager.updateRestartCount();
  }
 catch (  IOException ioe) {
    failed=true;
  }
  assertFalse("JobTracker failed to create info files with datanodes!!!",failed);
}
