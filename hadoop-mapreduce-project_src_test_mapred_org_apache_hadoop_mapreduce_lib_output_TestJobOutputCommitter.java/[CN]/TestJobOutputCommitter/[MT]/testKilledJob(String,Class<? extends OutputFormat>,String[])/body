{
  Path outDir=getNewOutputDir();
  Job job=MapReduceTestUtil.createKillJob(conf,outDir,inDir);
  job.setOutputFormatClass(output);
  job.submit();
  while (job.setupProgress() != 1.0f) {
    UtilsForTests.waitFor(100);
  }
  job.killJob();
  assertFalse("Job did not get kill",job.waitForCompletion(true));
  if (fileName != null) {
    Path testFile=new Path(outDir,fileName);
    assertTrue("File " + testFile + " missing for job "+ job.getJobID(),fs.exists(testFile));
  }
  for (  String ex : exclude) {
    Path file=new Path(outDir,ex);
    assertFalse("File " + file + " should not be present for killed job "+ job.getJobID(),fs.exists(file));
  }
}
