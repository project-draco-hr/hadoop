{
  if (closed) {
    throw new IOException("Stream closed");
  }
  if (bytesWrittenToBlock + pos >= blockSize) {
    flushData((int)blockSize - bytesWrittenToBlock);
  }
  if (bytesWrittenToBlock == blockSize) {
    endBlock();
  }
  flushData(pos);
}
