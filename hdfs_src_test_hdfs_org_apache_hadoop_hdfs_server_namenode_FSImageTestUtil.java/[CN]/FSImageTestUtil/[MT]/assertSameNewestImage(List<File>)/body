{
  if (dirs.size() < 2)   return;
  long imageTxId=-1;
  List<File> imageFiles=new ArrayList<File>();
  for (  File dir : dirs) {
    FSImageTransactionalStorageInspector inspector=inspectStorageDirectory(dir,NameNodeDirType.IMAGE);
    FSImageFile latestImage=inspector.getLatestImage();
    assertNotNull("No image in " + dir,latestImage);
    long thisTxId=latestImage.getCheckpointTxId();
    if (imageTxId != -1 && thisTxId != imageTxId) {
      fail("Storage directory " + dir + " does not have the same "+ "last image index "+ imageTxId+ " as another");
    }
    imageTxId=thisTxId;
    imageFiles.add(inspector.getLatestImage().getFile());
  }
  assertFileContentsSame(imageFiles.toArray(new File[0]));
}
