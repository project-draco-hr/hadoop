{
  byte[] actual=new byte[FILE_SIZE];
  int size=AppendTestUtil.nextInt(FILE_SIZE);
  Path filepath=createFile("/immediateRecoverLease-shortlease",size,true);
  cluster.setLeasePeriod(SHORT_LEASE_PERIOD,LONG_LEASE_PERIOD);
  recoverLeaseUsingCreate(filepath);
  verifyFile(dfs,filepath,actual,size);
  cluster.setLeasePeriod(LONG_LEASE_PERIOD,LONG_LEASE_PERIOD);
  size=AppendTestUtil.nextInt(FILE_SIZE);
  filepath=createFile("/immediateRecoverLease-longlease",size,false);
  recoverLease(filepath,null);
  verifyFile(dfs,filepath,actual,size);
  size=AppendTestUtil.nextInt(FILE_SIZE);
  filepath=createFile("/immediateRecoverLease-sameclient",size,false);
  Path filepath1=new Path(filepath.toString() + AppendTestUtil.nextInt());
  FSDataOutputStream stm=dfs.create(filepath1,true,BUF_SIZE,REPLICATION_NUM,BLOCK_SIZE);
  recoverLease(filepath,dfs);
  verifyFile(dfs,filepath,actual,size);
  stm.write(buffer,0,size);
  stm.close();
  verifyFile(dfs,filepath1,actual,size);
}
