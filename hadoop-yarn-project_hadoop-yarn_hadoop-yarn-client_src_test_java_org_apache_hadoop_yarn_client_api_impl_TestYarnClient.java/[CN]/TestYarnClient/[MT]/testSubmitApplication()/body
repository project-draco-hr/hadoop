{
  Configuration conf=new Configuration();
  conf.setLong(YarnConfiguration.YARN_CLIENT_APP_SUBMISSION_POLL_INTERVAL_MS,100);
  final YarnClient client=new MockYarnClient();
  client.init(conf);
  client.start();
  YarnApplicationState[] exitStates=new YarnApplicationState[]{YarnApplicationState.SUBMITTED,YarnApplicationState.ACCEPTED,YarnApplicationState.RUNNING,YarnApplicationState.FINISHED,YarnApplicationState.FAILED,YarnApplicationState.KILLED};
  ApplicationSubmissionContext contextWithoutApplicationId=mock(ApplicationSubmissionContext.class);
  try {
    client.submitApplication(contextWithoutApplicationId);
    Assert.fail("Should throw the ApplicationIdNotProvidedException");
  }
 catch (  YarnException e) {
    Assert.assertTrue(e instanceof ApplicationIdNotProvidedException);
    Assert.assertTrue(e.getMessage().contains("ApplicationId is not provided in ApplicationSubmissionContext"));
  }
catch (  IOException e) {
    Assert.fail("IOException is not expected.");
  }
  for (int i=0; i < exitStates.length; ++i) {
    ApplicationSubmissionContext context=mock(ApplicationSubmissionContext.class);
    ApplicationId applicationId=ApplicationId.newInstance(System.currentTimeMillis(),i);
    when(context.getApplicationId()).thenReturn(applicationId);
    ((MockYarnClient)client).setYarnApplicationState(exitStates[i]);
    try {
      client.submitApplication(context);
    }
 catch (    YarnException e) {
      Assert.fail("Exception is not expected.");
    }
catch (    IOException e) {
      Assert.fail("Exception is not expected.");
    }
    verify(((MockYarnClient)client).mockReport,times(4 * i + 4)).getYarnApplicationState();
  }
  client.stop();
}
