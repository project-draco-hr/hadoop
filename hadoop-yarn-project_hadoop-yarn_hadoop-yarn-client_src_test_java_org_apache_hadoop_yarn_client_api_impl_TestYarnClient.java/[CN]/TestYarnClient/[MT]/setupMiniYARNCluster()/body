{
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  ReservationSystemTestUtil.setupQueueConfiguration(conf);
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  conf.setBoolean(YarnConfiguration.RM_RESERVATION_SYSTEM_ENABLE,true);
  MiniYARNCluster cluster=new MiniYARNCluster("testReservationAPIs",2,1,1);
  cluster.init(conf);
  cluster.start();
  int attempts;
  for (attempts=10; attempts > 0; attempts--) {
    if (cluster.getResourceManager().getRMContext().getReservationSystem().getPlan(ReservationSystemTestUtil.reservationQ).getTotalCapacity().getMemorySize() > 6000) {
      break;
    }
    try {
      Thread.sleep(100);
    }
 catch (    InterruptedException e) {
      e.printStackTrace();
    }
  }
  if (attempts <= 0) {
    Assert.fail("Exhausted attempts in checking if node capacity was " + "added to the plan");
  }
  return cluster;
}
