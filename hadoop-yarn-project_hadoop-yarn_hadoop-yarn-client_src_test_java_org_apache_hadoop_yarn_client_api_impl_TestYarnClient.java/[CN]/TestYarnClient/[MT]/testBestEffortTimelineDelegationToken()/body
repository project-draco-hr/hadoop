{
  Configuration conf=new YarnConfiguration();
  conf.setBoolean(YarnConfiguration.TIMELINE_SERVICE_ENABLED,true);
  SecurityUtil.setAuthenticationMethod(AuthenticationMethod.KERBEROS,conf);
  YarnClientImpl client=spy(new YarnClientImpl(){
    @Override TimelineClient createTimelineClient() throws IOException, YarnException {
      timelineClient=mock(TimelineClient.class);
      when(timelineClient.getDelegationToken(any(String.class))).thenThrow(new IOException("Best effort test exception"));
      return timelineClient;
    }
  }
);
  client.init(conf);
  try {
    conf.setBoolean(YarnConfiguration.TIMELINE_SERVICE_CLIENT_BEST_EFFORT,true);
    client.serviceInit(conf);
    client.getTimelineDelegationToken();
  }
 catch (  Exception e) {
    Assert.fail("Should not have thrown an exception");
  }
  try {
    conf.setBoolean(YarnConfiguration.TIMELINE_SERVICE_CLIENT_BEST_EFFORT,false);
    client.serviceInit(conf);
    client.getTimelineDelegationToken();
    Assert.fail("Get delegation token should have thrown an exception");
  }
 catch (  Exception e) {
  }
}
