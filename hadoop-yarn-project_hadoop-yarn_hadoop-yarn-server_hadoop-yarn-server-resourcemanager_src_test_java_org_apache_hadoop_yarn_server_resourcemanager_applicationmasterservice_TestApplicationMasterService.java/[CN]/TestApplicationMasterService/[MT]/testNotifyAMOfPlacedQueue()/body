{
  conf.setClass(YarnConfiguration.RM_SCHEDULER,FairScheduler.class,ResourceScheduler.class);
  MockRM rm=new MockRM(conf);
  try {
    rm.start();
    MockNM nm1=rm.registerNode("127.0.0.1:1234",6 * GB);
    RMApp app1=rm.submitApp(1024,"somename","user1");
    nm1.nodeHeartbeat(true);
    RMAppAttempt attempt1=app1.getCurrentAppAttempt();
    MockAM am1=rm.sendAMLaunched(attempt1.getAppAttemptId());
    RegisterApplicationMasterResponse response=am1.registerAppAttempt();
    Assert.assertEquals("root.user1",response.getQueue());
  }
  finally {
    if (rm != null) {
      rm.stop();
    }
  }
}
