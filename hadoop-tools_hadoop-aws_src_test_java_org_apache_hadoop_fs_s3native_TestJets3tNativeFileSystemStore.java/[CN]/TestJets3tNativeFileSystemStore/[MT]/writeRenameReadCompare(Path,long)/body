{
  MessageDigest digest=MessageDigest.getInstance("MD5");
  OutputStream out=new BufferedOutputStream(new DigestOutputStream(fs.create(path,false),digest));
  for (long i=0; i < len; i++) {
    out.write('Q');
  }
  out.flush();
  out.close();
  assertTrue("Exists",fs.exists(path));
  Path copyPath=path.suffix(".copy");
  fs.rename(path,copyPath);
  assertTrue("Copy exists",fs.exists(copyPath));
  MessageDigest digest2=MessageDigest.getInstance("MD5");
  InputStream in=new BufferedInputStream(new DigestInputStream(fs.open(copyPath),digest2));
  long copyLen=0;
  while (in.read() != -1) {
    copyLen++;
  }
  in.close();
  assertEquals("Copy length matches original",len,copyLen);
  assertArrayEquals("Digests match",digest.digest(),digest2.digest());
}
