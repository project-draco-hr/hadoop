{
  final Set<String> rackSet=new HashSet<String>(0);
  final Collection<DatanodeDescriptor> corruptNodes=getCorruptReplicas(blockManager).getNodes(b);
  for (Iterator<DatanodeDescriptor> it=blockManager.blocksMap.nodeIterator(b); it.hasNext(); ) {
    DatanodeDescriptor cur=it.next();
    if (!cur.isDecommissionInProgress() && !cur.isDecommissioned()) {
      if ((corruptNodes == null) || !corruptNodes.contains(cur)) {
        String rackName=cur.getNetworkLocation();
        if (!rackSet.contains(rackName)) {
          rackSet.add(rackName);
        }
      }
    }
  }
  return rackSet.size();
}
