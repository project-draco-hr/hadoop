{
  if (Thread.currentThread() == handlerThread) {
    throw new YarnRuntimeException("Cannot call stop from callback handler thread!");
  }
  keepRunning=false;
  try {
    heartbeatThread.join();
  }
 catch (  InterruptedException ex) {
    LOG.error("Error joining with heartbeat thread",ex);
  }
  client.stop();
  try {
    handlerThread.interrupt();
    handlerThread.join();
  }
 catch (  InterruptedException ex) {
    LOG.error("Error joining with hander thread",ex);
  }
  super.stop();
}
