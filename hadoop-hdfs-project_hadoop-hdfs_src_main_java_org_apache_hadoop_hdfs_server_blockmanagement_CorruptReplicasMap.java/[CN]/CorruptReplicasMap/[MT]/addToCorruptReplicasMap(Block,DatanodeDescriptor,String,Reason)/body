{
  Map<DatanodeDescriptor,Reason> nodes=corruptReplicasMap.get(blk);
  if (nodes == null) {
    nodes=new HashMap<DatanodeDescriptor,Reason>();
    corruptReplicasMap.put(blk,nodes);
  }
  String reasonText;
  if (reason != null) {
    reasonText=" because " + reason;
  }
 else {
    reasonText="";
  }
  if (!nodes.keySet().contains(dn)) {
    NameNode.blockStateChangeLog.info("BLOCK NameSystem.addToCorruptReplicasMap: " + blk.getBlockName() + " added as corrupt on "+ dn+ " by "+ Server.getRemoteIp()+ reasonText);
  }
 else {
    NameNode.blockStateChangeLog.info("BLOCK NameSystem.addToCorruptReplicasMap: " + "duplicate requested for " + blk.getBlockName() + " to add as corrupt "+ "on "+ dn+ " by "+ Server.getRemoteIp()+ reasonText);
  }
  nodes.put(dn,reasonCode);
}
