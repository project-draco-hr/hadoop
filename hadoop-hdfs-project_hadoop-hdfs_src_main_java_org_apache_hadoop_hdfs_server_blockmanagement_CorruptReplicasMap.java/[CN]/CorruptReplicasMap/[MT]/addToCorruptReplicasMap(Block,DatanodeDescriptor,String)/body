{
  Collection<DatanodeDescriptor> nodes=getNodes(blk);
  if (nodes == null) {
    nodes=new TreeSet<DatanodeDescriptor>();
    corruptReplicasMap.put(blk,nodes);
  }
  String reasonText;
  if (reason != null) {
    reasonText=" because " + reason;
  }
 else {
    reasonText="";
  }
  if (!nodes.contains(dn)) {
    nodes.add(dn);
    NameNode.stateChangeLog.info("BLOCK NameSystem.addToCorruptReplicasMap: " + blk.getBlockName() + " added as corrupt on "+ dn+ " by "+ Server.getRemoteIp()+ reasonText);
  }
 else {
    NameNode.stateChangeLog.info("BLOCK NameSystem.addToCorruptReplicasMap: " + "duplicate requested for " + blk.getBlockName() + " to add as corrupt "+ "on "+ dn+ " by "+ Server.getRemoteIp()+ reasonText);
  }
}
