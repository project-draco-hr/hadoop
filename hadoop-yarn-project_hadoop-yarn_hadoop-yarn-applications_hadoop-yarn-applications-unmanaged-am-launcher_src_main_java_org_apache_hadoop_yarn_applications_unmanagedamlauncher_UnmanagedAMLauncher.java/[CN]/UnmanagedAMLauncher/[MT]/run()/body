{
  LOG.info("Starting Client");
  rmClient.start();
  try {
    LOG.info("Setting up application submission context for ASM");
    ApplicationSubmissionContext appContext=rmClient.createApplication().getApplicationSubmissionContext();
    ApplicationId appId=appContext.getApplicationId();
    appContext.setApplicationName(appName);
    Priority pri=Records.newRecord(Priority.class);
    pri.setPriority(amPriority);
    appContext.setPriority(pri);
    appContext.setQueue(amQueue);
    ContainerLaunchContext amContainer=Records.newRecord(ContainerLaunchContext.class);
    appContext.setAMContainerSpec(amContainer);
    appContext.setUnmanagedAM(true);
    LOG.info("Setting unmanaged AM");
    LOG.info("Submitting application to ASM");
    rmClient.submitApplication(appContext);
    ApplicationReport appReport=monitorApplication(appId,EnumSet.of(YarnApplicationState.ACCEPTED,YarnApplicationState.KILLED,YarnApplicationState.FAILED,YarnApplicationState.FINISHED));
    if (appReport.getYarnApplicationState() == YarnApplicationState.ACCEPTED) {
      ApplicationAttemptReport attemptReport=monitorCurrentAppAttempt(appId,YarnApplicationAttemptState.LAUNCHED);
      ApplicationAttemptId attemptId=attemptReport.getApplicationAttemptId();
      LOG.info("Launching AM with application attempt id " + attemptId);
      launchAM(attemptId);
      appReport=monitorApplication(appId,EnumSet.of(YarnApplicationState.KILLED,YarnApplicationState.FAILED,YarnApplicationState.FINISHED));
    }
    YarnApplicationState appState=appReport.getYarnApplicationState();
    FinalApplicationStatus appStatus=appReport.getFinalApplicationStatus();
    LOG.info("App ended with state: " + appReport.getYarnApplicationState() + " and status: "+ appStatus);
    boolean success;
    if (YarnApplicationState.FINISHED == appState && FinalApplicationStatus.SUCCEEDED == appStatus) {
      LOG.info("Application has completed successfully.");
      success=true;
    }
 else {
      LOG.info("Application did finished unsuccessfully." + " YarnState=" + appState.toString() + ", FinalStatus="+ appStatus.toString());
      success=false;
    }
    return success;
  }
  finally {
    rmClient.stop();
  }
}
