{
  long startTime=System.currentTimeMillis();
  ApplicationAttemptId attemptId=null;
  while (true) {
    if (attemptId == null) {
      attemptId=rmClient.getApplicationReport(appId).getCurrentApplicationAttemptId();
    }
    ApplicationAttemptReport attemptReport=null;
    if (attemptId != null) {
      attemptReport=rmClient.getApplicationAttemptReport(attemptId);
      if (attemptState.equals(attemptReport.getYarnApplicationAttemptState())) {
        return attemptReport;
      }
    }
    LOG.info("Current attempt state of " + appId + " is "+ (attemptReport == null ? " N/A " : attemptReport.getYarnApplicationAttemptState())+ ", waiting for current attempt to reach "+ attemptState);
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException e) {
      LOG.warn("Interrupted while waiting for current attempt of " + appId + " to reach "+ attemptState);
    }
    if (System.currentTimeMillis() - startTime > AM_STATE_WAIT_TIMEOUT_MS) {
      String errmsg="Timeout for waiting current attempt of " + appId + " to reach "+ attemptState;
      LOG.error(errmsg);
      throw new RuntimeException(errmsg);
    }
  }
}
