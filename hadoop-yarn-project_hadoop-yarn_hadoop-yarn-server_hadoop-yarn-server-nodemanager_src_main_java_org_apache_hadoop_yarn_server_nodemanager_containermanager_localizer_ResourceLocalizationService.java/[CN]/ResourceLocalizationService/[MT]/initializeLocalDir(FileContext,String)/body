{
  Map<Path,FsPermission> pathPermissionMap=getLocalDirsPathPermissionsMap(localDir);
  for (  Map.Entry<Path,FsPermission> entry : pathPermissionMap.entrySet()) {
    FileStatus status;
    try {
      status=lfs.getFileStatus(entry.getKey());
    }
 catch (    FileNotFoundException fs) {
      status=null;
    }
catch (    IOException ie) {
      String msg="Could not get file status for local dir " + entry.getKey();
      LOG.warn(msg,ie);
      throw new YarnRuntimeException(msg,ie);
    }
    if (status == null) {
      try {
        lfs.mkdir(entry.getKey(),entry.getValue(),true);
        status=lfs.getFileStatus(entry.getKey());
      }
 catch (      IOException e) {
        String msg="Could not initialize local dir " + entry.getKey();
        LOG.warn(msg,e);
        throw new YarnRuntimeException(msg,e);
      }
    }
    FsPermission perms=status.getPermission();
    if (!perms.equals(entry.getValue())) {
      try {
        lfs.setPermission(entry.getKey(),entry.getValue());
      }
 catch (      IOException ie) {
        String msg="Could not set permissions for local dir " + entry.getKey();
        LOG.warn(msg,ie);
        throw new YarnRuntimeException(msg,ie);
      }
    }
  }
}
