{
  DataOutputStream tokenOut=null;
  try {
    Credentials credentials=context.getCredentials();
    FileContext lfs=getLocalFileContext(getConfig());
    tokenOut=lfs.create(nmPrivateCTokensPath,EnumSet.of(CREATE,OVERWRITE));
    LOG.info("Writing credentials to the nmPrivate file " + nmPrivateCTokensPath.toString() + ". Credentials list: ");
    if (LOG.isDebugEnabled()) {
      for (      Token<? extends TokenIdentifier> tk : credentials.getAllTokens()) {
        LOG.debug(tk.getService() + " : " + tk.encodeToUrlString());
      }
    }
    if (UserGroupInformation.isSecurityEnabled()) {
      LocalizerTokenIdentifier id=secretManager.createIdentifier();
      Token<LocalizerTokenIdentifier> localizerToken=new Token<LocalizerTokenIdentifier>(id,secretManager);
      credentials.addToken(id.getKind(),localizerToken);
    }
    credentials.writeTokenStorageToStream(tokenOut);
  }
  finally {
    if (tokenOut != null) {
      tokenOut.close();
    }
  }
}
