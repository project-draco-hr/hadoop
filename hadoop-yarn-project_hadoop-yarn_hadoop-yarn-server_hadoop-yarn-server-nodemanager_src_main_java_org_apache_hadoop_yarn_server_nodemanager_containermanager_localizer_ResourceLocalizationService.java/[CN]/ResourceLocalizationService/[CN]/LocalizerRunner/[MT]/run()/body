{
  Path nmPrivateCTokensPath=null;
  Throwable exception=null;
  try {
    nmPrivateCTokensPath=dirsHandler.getLocalPathForWrite(NM_PRIVATE_DIR + Path.SEPARATOR + String.format(ContainerLocalizer.TOKEN_FILE_NAME_FMT,localizerId));
    writeCredentials(nmPrivateCTokensPath);
    if (dirsHandler.areDisksHealthy()) {
      exec.startLocalizer(new LocalizerStartContext.Builder().setNmPrivateContainerTokens(nmPrivateCTokensPath).setNmAddr(localizationServerAddress).setUser(context.getUser()).setAppId(context.getContainerId().getApplicationAttemptId().getApplicationId().toString()).setLocId(localizerId).setDirsHandler(dirsHandler).build());
    }
 else {
      throw new IOException("All disks failed. " + dirsHandler.getDisksHealthReport(false));
    }
  }
 catch (  FSError fe) {
    exception=fe;
  }
catch (  Exception e) {
    exception=e;
  }
 finally {
    if (exception != null) {
      LOG.info("Localizer failed",exception);
      ContainerId cId=context.getContainerId();
      dispatcher.getEventHandler().handle(new ContainerResourceFailedEvent(cId,null,exception.getMessage()));
    }
    List<Path> paths=new ArrayList<Path>();
    for (    LocalizerResourceRequestEvent event : scheduled.values()) {
      Path locRsrcPath=event.getResource().getLocalPath();
      if (locRsrcPath != null) {
        Path locRsrcDirPath=locRsrcPath.getParent();
        paths.add(locRsrcDirPath);
        paths.add(new Path(locRsrcDirPath + "_tmp"));
      }
      event.getResource().unlock();
    }
    if (!paths.isEmpty()) {
      delService.delete(context.getUser(),null,paths.toArray(new Path[paths.size()]));
    }
    delService.delete(null,nmPrivateCTokensPath,new Path[]{});
  }
}
