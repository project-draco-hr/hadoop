{
  File testTGZ=new File(testWorkDir,"test.tgz");
  FileOutputStream out=new FileOutputStream(testTGZ);
  out.write(0);
  out.close();
  Job job=Job.getInstance();
  Configuration conf=job.getConfiguration();
  conf.set(MRJobConfig.CLASSPATH_ARCHIVES,"file://" + testTGZ.getAbsolutePath());
  conf.set(MRJobConfig.CACHE_ARCHIVES,"file://" + testTGZ.getAbsolutePath() + "#testTGZ");
  Map<String,String> environment=new HashMap<String,String>();
  MRApps.setClasspath(environment,conf);
  assertTrue(environment.get("CLASSPATH").startsWith("$PWD:"));
  String confClasspath=job.getConfiguration().get(YarnConfiguration.YARN_APPLICATION_CLASSPATH);
  if (confClasspath != null) {
    confClasspath=confClasspath.replaceAll(",\\s*",":").trim();
  }
  assertTrue(environment.get("CLASSPATH").contains(confClasspath));
  assertTrue(environment.get("CLASSPATH").contains("testTGZ"));
}
