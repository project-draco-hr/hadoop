{
  LOG.info("Starting reconfiguration task.");
  final Configuration oldConf=parent.getConf();
  final Configuration newConf=parent.getNewConf();
  final Collection<PropertyChange> changes=parent.getChangedProperties(newConf,oldConf);
  Map<PropertyChange,Optional<String>> results=Maps.newHashMap();
  ConfigRedactor oldRedactor=new ConfigRedactor(oldConf);
  ConfigRedactor newRedactor=new ConfigRedactor(newConf);
  for (  PropertyChange change : changes) {
    String errorMessage=null;
    String oldValRedacted=oldRedactor.redact(change.prop,change.oldVal);
    String newValRedacted=newRedactor.redact(change.prop,change.newVal);
    if (!parent.isPropertyReconfigurable(change.prop)) {
      LOG.info(String.format("Property %s is not configurable: old value: %s, new value: %s",change.prop,oldValRedacted,newValRedacted));
      continue;
    }
    LOG.info("Change property: " + change.prop + " from \""+ ((change.oldVal == null) ? "<default>" : oldValRedacted)+ "\" to \""+ ((change.newVal == null) ? "<default>" : newValRedacted)+ "\".");
    try {
      String effectiveValue=parent.reconfigurePropertyImpl(change.prop,change.newVal);
      if (change.newVal != null) {
        oldConf.set(change.prop,effectiveValue);
      }
 else {
        oldConf.unset(change.prop);
      }
    }
 catch (    ReconfigurationException e) {
      errorMessage=e.getCause().getMessage();
    }
    results.put(change,Optional.fromNullable(errorMessage));
  }
synchronized (parent.reconfigLock) {
    parent.endTime=Time.now();
    parent.status=Collections.unmodifiableMap(results);
    parent.reconfigThread=null;
  }
}
