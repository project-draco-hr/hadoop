{
  Configuration conf=new Configuration();
  MRApp app=new MRAppWithHistory(2,1,true,this.getClass().getName(),true,"assignedQueue");
  app.submit(conf);
  Job job=app.getContext().getAllJobs().values().iterator().next();
  JobId jobId=job.getID();
  LOG.info("JOBID is " + TypeConverter.fromYarn(jobId).toString());
  app.waitForState(job,JobState.SUCCEEDED);
  app.waitForState(Service.STATE.STOPPED);
  HistoryContext context=new JobHistory();
  ((JobHistory)context).init(conf);
  ((JobHistory)context).start();
  Assert.assertTrue(context.getStartTime() > 0);
  Assert.assertEquals(((JobHistory)context).getServiceState(),Service.STATE.STARTED);
  Job parsedJob=context.getJob(jobId);
  ((JobHistory)context).stop();
  Assert.assertEquals(((JobHistory)context).getServiceState(),Service.STATE.STOPPED);
  Assert.assertEquals("QueueName not correct","assignedQueue",parsedJob.getQueueName());
}
