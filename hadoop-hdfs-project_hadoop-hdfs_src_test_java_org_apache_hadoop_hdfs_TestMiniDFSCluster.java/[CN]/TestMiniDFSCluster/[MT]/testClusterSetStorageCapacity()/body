{
  final Configuration conf=new HdfsConfiguration();
  final int numDatanodes=1;
  final int defaultBlockSize=1024;
  final int blocks=100;
  final int blocksSize=1024;
  final int fileLen=blocks * blocksSize;
  final long capcacity=defaultBlockSize * 2 * fileLen;
  final long[] capacities=new long[]{capcacity,2 * capcacity};
  final MiniDFSCluster cluster=newCluster(conf,numDatanodes,capacities,defaultBlockSize,fileLen);
  verifyStorageCapacity(cluster,capacities);
  cluster.restartDataNodes();
  cluster.waitActive();
  verifyStorageCapacity(cluster,capacities);
  cluster.restartNameNodes();
  cluster.waitActive();
  verifyStorageCapacity(cluster,capacities);
  cluster.restartNameNodes();
  cluster.restartDataNodes();
  cluster.waitActive();
  verifyStorageCapacity(cluster,capacities);
  cluster.restartDataNodes();
  cluster.restartNameNodes();
  cluster.waitActive();
  verifyStorageCapacity(cluster,capacities);
}
