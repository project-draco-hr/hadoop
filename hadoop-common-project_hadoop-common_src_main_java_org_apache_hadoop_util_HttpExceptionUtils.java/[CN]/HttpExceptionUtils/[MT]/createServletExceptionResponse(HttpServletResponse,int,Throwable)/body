{
  response.setStatus(status);
  response.setContentType(APPLICATION_JSON_MIME);
  Map<String,Object> json=new LinkedHashMap<String,Object>();
  json.put(ERROR_MESSAGE_JSON,getOneLineMessage(ex));
  json.put(ERROR_EXCEPTION_JSON,ex.getClass().getSimpleName());
  json.put(ERROR_CLASSNAME_JSON,ex.getClass().getName());
  Map<String,Object> jsonResponse=new LinkedHashMap<String,Object>();
  jsonResponse.put(ERROR_JSON,json);
  ObjectMapper jsonMapper=new ObjectMapper();
  Writer writer=response.getWriter();
  jsonMapper.writerWithDefaultPrettyPrinter().writeValue(writer,jsonResponse);
  writer.flush();
}
