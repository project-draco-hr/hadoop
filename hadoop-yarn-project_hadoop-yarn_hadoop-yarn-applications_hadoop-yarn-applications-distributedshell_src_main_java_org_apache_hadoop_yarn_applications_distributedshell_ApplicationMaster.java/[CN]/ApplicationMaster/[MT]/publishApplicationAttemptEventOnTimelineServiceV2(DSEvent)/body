{
  final org.apache.hadoop.yarn.api.records.timelineservice.TimelineEntity entity=new org.apache.hadoop.yarn.api.records.timelineservice.TimelineEntity();
  entity.setId(appAttemptID.toString());
  entity.setType(DSEntity.DS_APP_ATTEMPT.toString());
  long ts=System.currentTimeMillis();
  if (appEvent == DSEvent.DS_APP_ATTEMPT_START) {
    entity.setCreatedTime(ts);
  }
  entity.addInfo("user",appSubmitterUgi.getShortUserName());
  org.apache.hadoop.yarn.api.records.timelineservice.TimelineEvent event=new org.apache.hadoop.yarn.api.records.timelineservice.TimelineEvent();
  event.setId(appEvent.toString());
  event.setTimestamp(ts);
  entity.addEvent(event);
  try {
    appSubmitterUgi.doAs(new PrivilegedExceptionAction<Object>(){
      @Override public TimelinePutResponse run() throws Exception {
        timelineClient.putEntitiesAsync(entity);
        return null;
      }
    }
);
  }
 catch (  Exception e) {
    LOG.error("App Attempt " + (appEvent.equals(DSEvent.DS_APP_ATTEMPT_START) ? "start" : "end") + " event could not be published for "+ appAttemptID,e instanceof UndeclaredThrowableException ? e.getCause() : e);
  }
}
