{
  for (  Thread launchThread : launchThreads) {
    try {
      launchThread.join(10000);
    }
 catch (    InterruptedException e) {
      LOG.info("Exception thrown in thread join: " + e.getMessage());
      e.printStackTrace();
    }
  }
  LOG.info("Application completed. Stopping running containers");
  nmClientAsync.stop();
  LOG.info("Application completed. Signalling finish to RM");
  FinalApplicationStatus appStatus;
  String appMessage=null;
  success=true;
  if (numFailedContainers.get() == 0 && numCompletedContainers.get() == numTotalContainers) {
    appStatus=FinalApplicationStatus.SUCCEEDED;
  }
 else {
    appStatus=FinalApplicationStatus.FAILED;
    appMessage="Diagnostics." + ", total=" + numTotalContainers + ", completed="+ numCompletedContainers.get()+ ", allocated="+ numAllocatedContainers.get()+ ", failed="+ numFailedContainers.get();
    success=false;
  }
  try {
    amRMClient.unregisterApplicationMaster(appStatus,appMessage,null);
  }
 catch (  YarnException ex) {
    LOG.error("Failed to unregister application",ex);
  }
catch (  IOException e) {
    LOG.error("Failed to unregister application",e);
  }
  done=true;
  amRMClient.stop();
}
