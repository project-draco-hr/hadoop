{
  try {
    appSubmitterUgi.doAs(new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        if (YarnConfiguration.timelineServiceEnabled(conf)) {
          if (timelineServiceV2) {
            timelineClient=TimelineClient.createTimelineClient(appAttemptID.getApplicationId());
            LOG.info("Timeline service V2 client is enabled");
          }
 else {
            timelineClient=TimelineClient.createTimelineClient();
            LOG.info("Timeline service V1 client is enabled");
          }
          timelineClient.init(conf);
          timelineClient.start();
        }
 else {
          timelineClient=null;
          LOG.warn("Timeline service is not enabled");
        }
        return null;
      }
    }
);
  }
 catch (  UndeclaredThrowableException e) {
    throw new YarnException(e.getCause());
  }
}
