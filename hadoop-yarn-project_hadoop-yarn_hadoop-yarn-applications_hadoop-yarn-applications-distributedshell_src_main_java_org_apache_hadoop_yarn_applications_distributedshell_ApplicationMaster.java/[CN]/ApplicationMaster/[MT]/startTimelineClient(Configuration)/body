{
  try {
    appSubmitterUgi.doAs(new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        if (conf.getBoolean(YarnConfiguration.TIMELINE_SERVICE_ENABLED,YarnConfiguration.DEFAULT_TIMELINE_SERVICE_ENABLED)) {
          if (newTimelineService) {
            timelineClient=TimelineClient.createTimelineClient(appAttemptID.getApplicationId());
          }
 else {
            timelineClient=TimelineClient.createTimelineClient();
          }
          timelineClient.init(conf);
          timelineClient.start();
        }
 else {
          timelineClient=null;
          LOG.warn("Timeline service is not enabled");
        }
        return null;
      }
    }
);
  }
 catch (  UndeclaredThrowableException e) {
    throw new YarnException(e.getCause());
  }
}
