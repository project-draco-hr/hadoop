{
  EncryptionZoneInt ezi;
  readLock();
  try {
    ezi=getEncryptionZoneForPath(iip);
  }
  finally {
    readUnlock();
  }
  if (ezi == null) {
    throw new IOException("Cannot update KeyVersion since iip is not within" + " an encryption zone");
  }
  KeyVersion version=provider.getCurrentKey(ezi.getKeyId());
  writeLock();
  try {
    ezi.addKeyVersion(version);
    return version;
  }
  finally {
    writeUnlock();
  }
}
