{
  LOG.info("--starting mini cluster");
  MiniDFSCluster cluster=null;
  SecondaryNameNode sn=null;
  try {
    cluster=new MiniDFSCluster.Builder(config).manageDataDfsDirs(false).manageNameDfsDirs(false).build();
    cluster.waitActive();
    LOG.info("--starting Secondary Node");
    sn=new SecondaryNameNode(config);
    assertNotNull(sn);
    FileSystem fileSys=cluster.getFileSystem();
    Path file1=new Path("t1");
    this.writeFile(fileSys,file1,1);
    LOG.info("--doing checkpoint");
    sn.doCheckpoint();
    LOG.info("--done checkpoint");
  }
 catch (  IOException e) {
    fail(StringUtils.stringifyException(e));
    System.err.println("checkpoint failed");
    throw e;
  }
 finally {
    if (sn != null)     sn.shutdown();
    if (cluster != null)     cluster.shutdown();
    LOG.info("--file t1 created, cluster shutdown");
  }
}
