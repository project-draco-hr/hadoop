{
  if (buf.readableBytes() < 4) {
    if (LOG.isTraceEnabled()) {
      LOG.trace("Length field is not received yet");
    }
    return null;
  }
  buf.markReaderIndex();
  ChannelBuffer fragmentHeader=buf.readBytes(4);
  int length=XDR.fragmentSize(fragmentHeader.array());
  boolean isLast=XDR.isLastFragment(fragmentHeader.array());
  if (buf.readableBytes() < length) {
    if (LOG.isTraceEnabled()) {
      LOG.trace(length + " bytes are not received yet");
    }
    buf.resetReaderIndex();
    return null;
  }
  if (frame == null) {
    frame=buf.readBytes(length);
  }
 else {
    ChannelBuffer tmp=ChannelBuffers.copiedBuffer(frame.array(),buf.readBytes(length).array());
    frame=tmp;
  }
  if (isLast) {
    ChannelBuffer completeFrame=frame;
    frame=null;
    return completeFrame;
  }
 else {
    LOG.info("Wait for the next frame. This rarely happens.");
    return null;
  }
}
