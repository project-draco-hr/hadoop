{
  mgr.activateNode(NodeId.newInstance("n1",1),Resource.newInstance(10,0));
  Assert.assertTrue(mgr.getLabelsToNodes().isEmpty());
  assertLabelsToNodesEquals(mgr.getLabelsToNodes(),transposeNodeToLabels(mgr.getNodeLabels()));
  mgr.addToCluserNodeLabelsWithDefaultExclusivity(toSet("p1"));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1"),toSet("p1")));
  Assert.assertEquals(2,mgr.getLabelsToNodes().get("p1").size());
  assertLabelsToNodesEquals(mgr.getLabelsToNodes(),transposeNodeToLabels(mgr.getNodeLabels()));
  mgr.activateNode(NodeId.newInstance("n1",2),Resource.newInstance(10,0));
  Assert.assertEquals(3,mgr.getLabelsToNodes().get("p1").size());
  assertLabelsToNodesEquals(mgr.getLabelsToNodes(),transposeNodeToLabels(mgr.getNodeLabels()));
  mgr.deactivateNode(NodeId.newInstance("n1",1));
  Assert.assertEquals(2,mgr.getLabelsToNodes().get("p1").size());
  assertLabelsToNodesEquals(mgr.getLabelsToNodes(),transposeNodeToLabels(mgr.getNodeLabels()));
}
