{
  mgr.addToCluserNodeLabels(toSet("p1","p2","p3"));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1"),toSet("p1"),toNodeId("n2"),toSet("p2"),toNodeId("n3"),toSet("p3")));
  Assert.assertEquals(mgr.getResourceByLabel("p1",null),EMPTY_RESOURCE);
  Assert.assertEquals(mgr.getResourceByLabel("p2",null),EMPTY_RESOURCE);
  Assert.assertEquals(mgr.getResourceByLabel("p3",null),EMPTY_RESOURCE);
  Assert.assertEquals(mgr.getResourceByLabel(RMNodeLabelsManager.NO_LABEL,null),EMPTY_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n1",1),SMALL_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n1",2),LARGE_NODE);
  Assert.assertEquals(mgr.getResourceByLabel("p1",null),Resources.add(SMALL_RESOURCE,LARGE_NODE));
  mgr.addToCluserNodeLabels(toSet("p1","p4"));
  Assert.assertEquals(mgr.getResourceByLabel("p1",null),Resources.add(SMALL_RESOURCE,LARGE_NODE));
  Assert.assertEquals(mgr.getResourceByLabel("p4",null),EMPTY_RESOURCE);
  mgr.updateNodeResource(NodeId.newInstance("n1",2),SMALL_RESOURCE);
  Assert.assertEquals(mgr.getResourceByLabel("p1",null),Resources.multiply(SMALL_RESOURCE,2));
  mgr.deactivateNode(NodeId.newInstance("n1",1));
  Assert.assertEquals(mgr.getResourceByLabel("p1",null),SMALL_RESOURCE);
  mgr.deactivateNode(NodeId.newInstance("n1",2));
  Assert.assertEquals(mgr.getResourceByLabel("p1",null),EMPTY_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n1",1),SMALL_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n1",2),LARGE_NODE);
  mgr.removeFromClusterNodeLabels(ImmutableSet.of("p1"));
  Assert.assertEquals(mgr.getResourceByLabel(RMNodeLabelsManager.NO_LABEL,null),Resources.add(SMALL_RESOURCE,LARGE_NODE));
}
