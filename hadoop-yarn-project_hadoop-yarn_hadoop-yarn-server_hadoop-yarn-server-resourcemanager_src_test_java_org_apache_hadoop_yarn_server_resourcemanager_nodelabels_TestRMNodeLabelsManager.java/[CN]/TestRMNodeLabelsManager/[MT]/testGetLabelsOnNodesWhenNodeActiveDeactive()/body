{
  mgr.addToCluserNodeLabelsWithDefaultExclusivity(toSet("p1","p2","p3"));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1"),toSet("p2")));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1:1"),toSet("p1")));
  mgr.activateNode(toNodeId("n1:1"),SMALL_RESOURCE);
  assertCollectionEquals(toSet("p1"),mgr.getNodeLabels().get(toNodeId("n1:1")));
  mgr.deactivateNode(toNodeId("n1:1"));
  assertCollectionEquals(toSet("p1"),mgr.getNodeLabels().get(toNodeId("n1:1")));
  assertCollectionEquals(toSet("p2"),mgr.getNodeLabels().get(toNodeId("n1")));
  mgr.activateNode(toNodeId("n1:2"),SMALL_RESOURCE);
  assertCollectionEquals(toSet("p2"),mgr.getNodeLabels().get(toNodeId("n1:2")));
  mgr.deactivateNode(toNodeId("n1:2"));
  Assert.assertNull(mgr.getNodeLabels().get(toNodeId("n1:2")));
  assertCollectionEquals(toSet("p2"),mgr.getNodeLabels().get(toNodeId("n1")));
  mgr.activateNode(toNodeId("n1:2"),SMALL_RESOURCE);
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1"),toSet("p3")));
  assertCollectionEquals(toSet("p3"),mgr.getNodeLabels().get(toNodeId("n1:2")));
  mgr.deactivateNode(toNodeId("n1:2"));
  Assert.assertNull(mgr.getNodeLabels().get(toNodeId("n1:2")));
  assertCollectionEquals(toSet("p3"),mgr.getNodeLabels().get(toNodeId("n1")));
}
