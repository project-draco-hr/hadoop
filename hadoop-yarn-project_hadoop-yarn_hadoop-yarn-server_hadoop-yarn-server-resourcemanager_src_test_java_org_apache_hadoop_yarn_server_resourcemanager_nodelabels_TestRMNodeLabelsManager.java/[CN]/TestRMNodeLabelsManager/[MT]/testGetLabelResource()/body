{
  mgr.addToCluserNodeLabels(toSet("p1","p2","p3"));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1"),toSet("p1"),toNodeId("n2"),toSet("p2"),toNodeId("n3"),toSet("p3")));
  mgr.activateNode(NodeId.newInstance("n1",1),SMALL_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n2",1),SMALL_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n3",1),SMALL_RESOURCE);
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1"),toSet("p2")));
  Assert.assertEquals(mgr.getResourceByLabel("p1",null),EMPTY_RESOURCE);
  Assert.assertEquals(mgr.getResourceByLabel("p2",null),Resources.multiply(SMALL_RESOURCE,2));
  Assert.assertEquals(mgr.getResourceByLabel("p3",null),SMALL_RESOURCE);
  mgr.addToCluserNodeLabels(toSet("p4","p5","p6"));
  mgr.replaceLabelsOnNode((Map)ImmutableMap.of(toNodeId("n4"),toSet("p1"),toNodeId("n5"),toSet("p2"),toNodeId("n6"),toSet("p3"),toNodeId("n7"),toSet("p4"),toNodeId("n8"),toSet("p5")));
  mgr.activateNode(NodeId.newInstance("n4",1),SMALL_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n5",1),SMALL_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n6",1),SMALL_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n7",1),SMALL_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n8",1),SMALL_RESOURCE);
  mgr.activateNode(NodeId.newInstance("n9",1),SMALL_RESOURCE);
  Assert.assertEquals(mgr.getResourceByLabel("p1",null),SMALL_RESOURCE);
  Assert.assertEquals(mgr.getResourceByLabel("p2",null),Resources.multiply(SMALL_RESOURCE,3));
  Assert.assertEquals(mgr.getResourceByLabel("p3",null),Resources.multiply(SMALL_RESOURCE,2));
  Assert.assertEquals(mgr.getResourceByLabel("p4",null),Resources.multiply(SMALL_RESOURCE,1));
  Assert.assertEquals(mgr.getResourceByLabel("p5",null),Resources.multiply(SMALL_RESOURCE,1));
  Assert.assertEquals(mgr.getResourceByLabel(RMNodeLabelsManager.NO_LABEL,null),Resources.multiply(SMALL_RESOURCE,1));
  mgr.replaceLabelsOnNode((Map)ImmutableMap.of(toNodeId("n4"),toSet("p2"),toNodeId("n7"),RMNodeLabelsManager.EMPTY_STRING_SET,toNodeId("n5"),toSet("p1"),toNodeId("n8"),RMNodeLabelsManager.EMPTY_STRING_SET,toNodeId("n9"),toSet("p1")));
  Assert.assertEquals(mgr.getResourceByLabel("p1",null),Resources.multiply(SMALL_RESOURCE,2));
  Assert.assertEquals(mgr.getResourceByLabel("p2",null),Resources.multiply(SMALL_RESOURCE,3));
  Assert.assertEquals(mgr.getResourceByLabel("p3",null),Resources.multiply(SMALL_RESOURCE,2));
  Assert.assertEquals(mgr.getResourceByLabel("p4",null),Resources.multiply(SMALL_RESOURCE,0));
  Assert.assertEquals(mgr.getResourceByLabel("p5",null),Resources.multiply(SMALL_RESOURCE,0));
  Assert.assertEquals(mgr.getResourceByLabel("",null),Resources.multiply(SMALL_RESOURCE,2));
}
