{
  FileStatus status;
  try {
    status=getFileStatus(f);
  }
 catch (  FileNotFoundException e) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Delete called for '" + f + "' but file does not exist, so returning false");
    }
    return false;
  }
  Path absolutePath=makeAbsolute(f);
  String key=pathToKey(absolutePath);
  if (status.isDirectory()) {
    if (!recurse && listStatus(f).length > 0) {
      throw new IOException("Can not delete " + f + " as is a not empty directory and recurse option is false");
    }
    createParent(f);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Deleting directory '" + f + "'");
    }
    String priorLastKey=null;
    do {
      PartialListing listing=store.list(key,S3_MAX_LISTING_LENGTH,priorLastKey,true);
      for (      FileMetadata file : listing.getFiles()) {
        store.delete(file.getKey());
      }
      priorLastKey=listing.getPriorLastKey();
    }
 while (priorLastKey != null);
    try {
      store.delete(key + FOLDER_SUFFIX);
    }
 catch (    FileNotFoundException e) {
    }
  }
 else {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Deleting file '" + f + "'");
    }
    createParent(f);
    store.delete(key);
  }
  return true;
}
