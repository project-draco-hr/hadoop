{
  Quota.Counts counts=Quota.Counts.newInstance();
  List<INodeReference> refNodes=new ArrayList<INodeReference>();
  counts.add(diff.destroyDeletedList(collectedBlocks,removedINodes,refNodes));
  for (  INodeReference ref : refNodes) {
    if (ref instanceof INodeReference.DstReference) {
      destroyDstSnapshot(ref,snapshot,null,collectedBlocks,removedINodes);
    }
 else     if (ref instanceof INodeReference.WithName) {
      try {
        ref.cleanSubtree(snapshot,null,collectedBlocks,removedINodes);
      }
 catch (      QuotaExceededException e) {
        LOG.error("Error: should not throw QuotaExceededException",e);
      }
    }
  }
  return counts;
}
