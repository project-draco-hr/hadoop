{
  if (!oldinode.equals(newinode)) {
    throw new AssertionError("The names do not match: oldinode=" + oldinode + ", newinode="+ newinode);
  }
  final int c=search(created,newinode);
  INode previous=null;
  Integer d=null;
  if (c >= 0) {
    previous=created.set(c,newinode);
    if (updateCircularList && newinode instanceof FileWithSnapshot) {
      FileWithSnapshot newNodeWithLink=(FileWithSnapshot)newinode;
      FileWithSnapshot oldNodeWithLink=(FileWithSnapshot)oldinode;
      newNodeWithLink.setNext(oldNodeWithLink.getNext());
      oldNodeWithLink.setNext(null);
    }
    previous=oldinode;
  }
 else {
    d=search(deleted,oldinode);
    if (d < 0) {
      insertCreated(newinode,c);
      insertDeleted(oldinode,d);
    }
  }
  return new Triple<Integer,INode,Integer>(c,previous,d);
}
