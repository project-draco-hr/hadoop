{
  int n=destroySubtreeAndCollectBlocksRecursively(snapshot,collectedBlocks);
  if (snapshot != null) {
    final DirectoryDiff removed=getDiffs().deleteSnapshotDiff(snapshot,this,collectedBlocks);
    if (removed != null) {
      n++;
    }
  }
  return n;
}
