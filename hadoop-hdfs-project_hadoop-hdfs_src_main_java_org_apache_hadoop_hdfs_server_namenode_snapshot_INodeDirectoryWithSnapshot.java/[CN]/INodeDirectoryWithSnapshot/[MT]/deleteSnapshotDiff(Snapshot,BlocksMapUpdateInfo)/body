{
  int snapshotIndex=Collections.binarySearch(diffs,snapshot);
  if (snapshotIndex == -1) {
    return null;
  }
 else {
    SnapshotDiff diffToRemove=null;
    diffToRemove=diffs.remove(snapshotIndex);
    if (snapshotIndex > 0) {
      SnapshotDiff previousDiff=diffs.get(snapshotIndex - 1);
      previousDiff.diff.combinePostDiff(diffToRemove.diff,new Processor(){
        /** 
 * Collect blocks for deleted files. 
 */
        @Override public void process(        INode inode){
          if (inode != null && inode instanceof INodeFile) {
            ((INodeFile)inode).collectSubtreeBlocksAndClear(collectedBlocks);
          }
        }
      }
);
      previousDiff.posteriorDiff=diffToRemove.posteriorDiff;
      diffToRemove.posteriorDiff=null;
    }
    return diffToRemove;
  }
}
