{
  if ((useCache && isQuotaSet()) || lastSnapshotId == Snapshot.INVALID_ID) {
    return super.computeQuotaUsage(counts,useCache,lastSnapshotId);
  }
  final int diffNum=0;
  Snapshot lastSnapshot=null;
  Snapshot lastInDiff=diffs.getLastSnapshot();
  if (lastInDiff != null && lastInDiff.getId() >= lastSnapshotId) {
    lastSnapshot=diffs.searchSnapshotById(lastSnapshotId);
  }
  ReadOnlyList<INode> childrenList=getChildrenList(lastSnapshot);
  for (  INode child : childrenList) {
    child.computeQuotaUsage(counts,useCache,lastSnapshotId);
  }
  counts.add(Quota.NAMESPACE,diffNum + 1);
  return counts;
}
