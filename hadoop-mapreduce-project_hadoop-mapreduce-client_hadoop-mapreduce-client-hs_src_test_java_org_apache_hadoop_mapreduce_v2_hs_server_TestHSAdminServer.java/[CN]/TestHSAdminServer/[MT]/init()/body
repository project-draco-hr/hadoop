{
  conf=new JobConf();
  conf.set(JHAdminConfig.JHS_ADMIN_ADDRESS,"0.0.0.0:0");
  conf.setClass("hadoop.security.group.mapping",MockUnixGroupsMapping.class,GroupMappingServiceProvider.class);
  conf.setLong("hadoop.security.groups.cache.secs",groupRefreshTimeoutSec);
  Groups.getUserToGroupsMappingService(conf);
  jobHistoryService=mock(JobHistory.class);
  alds=mock(AggregatedLogDeletionService.class);
  hsAdminServer=new HSAdminServer(alds,jobHistoryService){
    @Override protected Configuration createConf(){
      return conf;
    }
  }
;
  hsAdminServer.init(conf);
  hsAdminServer.start();
  conf.setSocketAddr(JHAdminConfig.JHS_ADMIN_ADDRESS,hsAdminServer.clientRpcServer.getListenerAddress());
  hsAdminClient=new HSAdmin(conf);
}
