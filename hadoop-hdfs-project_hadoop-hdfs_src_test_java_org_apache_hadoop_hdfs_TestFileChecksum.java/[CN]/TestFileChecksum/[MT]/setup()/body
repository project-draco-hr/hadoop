{
  int numDNs=dataBlocks + parityBlocks + 2;
  conf=new Configuration();
  conf.setLong(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,blockSize);
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_REPLICATION_CONSIDERLOAD_KEY,false);
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_REPLICATION_MAX_STREAMS_KEY,0);
  cluster=new MiniDFSCluster.Builder(conf).numDataNodes(numDNs).build();
  Path ecPath=new Path(ecDir);
  cluster.getFileSystem().mkdir(ecPath,FsPermission.getDirDefault());
  cluster.getFileSystem().getClient().setErasureCodingPolicy(ecDir,null);
  fs=cluster.getFileSystem();
  client=fs.getClient();
  bytesPerCRC=conf.getInt(HdfsClientConfigKeys.DFS_BYTES_PER_CHECKSUM_KEY,HdfsClientConfigKeys.DFS_BYTES_PER_CHECKSUM_DEFAULT);
}
