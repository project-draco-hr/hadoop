{
  Path absF=fixRelativePart(f);
  FileSystem fsOfAbsF=getFSofPath(absF);
  FsPermission permission=null;
  if (opts != null) {
    for (int i=0; i < opts.length; ++i) {
      if (opts[i] instanceof CreateOpts.Perms) {
        if (permission != null)         throw new IllegalArgumentException("multiple permissions varargs");
        permission=((CreateOpts.Perms)opts[i]).getValue();
        opts[i]=CreateOpts.perms(permission.applyUMask(umask));
      }
    }
  }
  CreateOpts[] theOpts=opts;
  if (permission == null) {
    CreateOpts[] newOpts=new CreateOpts[opts.length + 1];
    System.arraycopy(opts,0,newOpts,0,opts.length);
    newOpts[opts.length]=CreateOpts.perms(FsPermission.getDefault().applyUMask(umask));
    theOpts=newOpts;
  }
  return fsOfAbsF.primitiveCreate(absF,createFlag,theOpts);
}
