{
  Path absF=fixRelativePart(f);
  AbstractFileSystem fsOfAbsF=getFSofPath(absF);
  CreateOpts.Perms permOpt=(CreateOpts.Perms)CreateOpts.getOpt(CreateOpts.Perms.class,opts);
  FsPermission permission=(permOpt != null) ? permOpt.getValue() : FsPermission.getDefault();
  permission=permission.applyUMask(umask);
  CreateOpts[] updatedOpts=CreateOpts.setOpt(CreateOpts.perms(permission),opts);
  return fsOfAbsF.create(absF,createFlag,updatedOpts);
}
