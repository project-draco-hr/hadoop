{
  BlockPoolTokenSecretManager bpMgr=new BlockPoolTokenSecretManager();
  for (int i=0; i < 10; i++) {
    String bpid=Integer.toString(i);
    BlockTokenSecretManager masterHandler=new BlockTokenSecretManager(blockKeyUpdateInterval,blockTokenLifetime,0,1,"fake-pool",null);
    BlockTokenSecretManager slaveHandler=new BlockTokenSecretManager(blockKeyUpdateInterval,blockTokenLifetime,"fake-pool",null);
    bpMgr.addBlockPool(bpid,slaveHandler);
    ExportedBlockKeys keys=masterHandler.exportKeys();
    bpMgr.addKeys(bpid,keys);
    tokenGenerationAndVerification(masterHandler,bpMgr.get(bpid));
    masterHandler.updateKeys();
    tokenGenerationAndVerification(masterHandler,bpMgr.get(bpid));
    keys=masterHandler.exportKeys();
    bpMgr.addKeys(bpid,keys);
    tokenGenerationAndVerification(masterHandler,bpMgr.get(bpid));
  }
}
