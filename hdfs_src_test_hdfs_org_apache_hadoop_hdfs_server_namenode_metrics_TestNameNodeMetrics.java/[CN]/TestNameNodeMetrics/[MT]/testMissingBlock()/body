{
  Path file=getTestPath("testMissingBlocks");
  createFile(file,100,(short)1);
  LocatedBlock block=NameNodeAdapter.getBlockLocations(cluster.getNameNode(),file.toString(),0,1).get(0);
  namesystem.markBlockAsCorrupt(block.getBlock(),block.getLocations()[0]);
  updateMetrics();
  MetricsRecordBuilder rb=getMetrics(NS_METRICS);
  assertGauge("UnderReplicatedBlocks",1L,rb);
  assertGauge("MissingBlocks",1L,rb);
  fs.delete(file,true);
  updateMetrics();
  assertGauge("UnderReplicatedBlocks",0L,getMetrics(NS_METRICS));
}
