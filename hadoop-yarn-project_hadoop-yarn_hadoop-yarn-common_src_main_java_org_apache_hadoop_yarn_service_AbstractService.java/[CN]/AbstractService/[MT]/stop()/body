{
  if (isInState(STATE.STOPPED)) {
    return;
  }
synchronized (stateChangeLock) {
    if (enterState(STATE.STOPPED) != STATE.STOPPED) {
      try {
        serviceStop();
      }
 catch (      Exception e) {
        noteFailure(e);
        throw ServiceStateException.convert(e);
      }
 finally {
        terminationNotification.set(true);
synchronized (terminationNotification) {
          terminationNotification.notifyAll();
        }
        notifyListeners();
      }
    }
 else {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Ignoring re-entrant call to stop()");
      }
    }
  }
}
