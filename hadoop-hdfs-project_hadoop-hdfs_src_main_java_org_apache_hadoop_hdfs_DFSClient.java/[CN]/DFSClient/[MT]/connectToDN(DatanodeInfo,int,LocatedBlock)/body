{
  boolean success=false;
  Socket sock=null;
  try {
    sock=socketFactory.createSocket();
    String dnAddr=dn.getXferAddr(getConf().connectToDnViaHostname);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Connecting to datanode " + dnAddr);
    }
    NetUtils.connect(sock,NetUtils.createSocketAddr(dnAddr),timeout);
    sock.setSoTimeout(timeout);
    OutputStream unbufOut=NetUtils.getOutputStream(sock);
    InputStream unbufIn=NetUtils.getInputStream(sock);
    IOStreamPair ret=saslClient.newSocketSend(sock,unbufOut,unbufIn,this,lb.getBlockToken(),dn);
    success=true;
    return ret;
  }
  finally {
    if (!success) {
      IOUtils.closeSocket(sock);
    }
  }
}
