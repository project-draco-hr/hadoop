{
  checkOpen();
  if (permission == null) {
    permission=FsPermission.getFileDefault();
  }
  FsPermission masked=permission.applyUMask(dfsClientConf.uMask);
  if (LOG.isDebugEnabled()) {
    LOG.debug(src + ": masked=" + masked);
  }
  final DFSOutputStream result=DFSOutputStream.newStreamForCreate(this,src,masked,flag,createParent,replication,blockSize,progress,buffersize,dfsClientConf.createChecksum(checksumOpt),getFavoredNodesStr(favoredNodes));
  beginFileLease(result.getFileId(),result);
  return result;
}
