{
  checkOpen();
  if (permission == null) {
    permission=FsPermission.getFileDefault();
  }
  FsPermission masked=permission.applyUMask(dfsClientConf.uMask);
  if (LOG.isDebugEnabled()) {
    LOG.debug(src + ": masked=" + masked);
  }
  String[] favoredNodeStrs=null;
  if (favoredNodes != null) {
    favoredNodeStrs=new String[favoredNodes.length];
    for (int i=0; i < favoredNodes.length; i++) {
      favoredNodeStrs[i]=favoredNodes[i].getHostName() + ":" + favoredNodes[i].getPort();
    }
  }
  final DFSOutputStream result=DFSOutputStream.newStreamForCreate(this,src,masked,flag,createParent,replication,blockSize,progress,buffersize,dfsClientConf.createChecksum(checksumOpt),favoredNodeStrs);
  beginFileLease(result.getFileId(),result);
  return result;
}
