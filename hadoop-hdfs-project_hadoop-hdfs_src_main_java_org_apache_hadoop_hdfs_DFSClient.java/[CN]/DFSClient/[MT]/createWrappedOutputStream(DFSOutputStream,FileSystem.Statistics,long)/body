{
  final FileEncryptionInfo feInfo=dfsos.getFileEncryptionInfo();
  if (feInfo != null) {
    getCryptoProtocolVersion(feInfo);
    final CryptoCodec codec=getCryptoCodec(conf,feInfo);
    KeyVersion decrypted=decryptEncryptedDataEncryptionKey(feInfo);
    final CryptoOutputStream cryptoOut=new CryptoOutputStream(dfsos,codec,decrypted.getMaterial(),feInfo.getIV(),startPos);
    return new HdfsDataOutputStream(cryptoOut,statistics,startPos);
  }
 else {
    return new HdfsDataOutputStream(dfsos,statistics,startPos);
  }
}
