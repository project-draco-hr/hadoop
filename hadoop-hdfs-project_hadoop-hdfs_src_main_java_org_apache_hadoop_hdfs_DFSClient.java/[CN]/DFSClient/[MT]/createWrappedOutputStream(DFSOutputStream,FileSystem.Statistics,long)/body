{
  final FileEncryptionInfo feInfo=dfsos.getFileEncryptionInfo();
  if (feInfo != null) {
    Preconditions.checkNotNull(codec == null,"No crypto codec classes with cipher suite configured.");
    KeyVersion decrypted=decryptEncryptedDataEncryptionKey(feInfo);
    final CryptoOutputStream cryptoOut=new CryptoOutputStream(dfsos,codec,decrypted.getMaterial(),feInfo.getIV(),startPos);
    return new HdfsDataOutputStream(cryptoOut,statistics,startPos);
  }
 else {
    return new HdfsDataOutputStream(dfsos,statistics,startPos);
  }
}
