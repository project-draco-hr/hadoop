{
  final FileEncryptionInfo feInfo=dfsos.getFileEncryptionInfo();
  if (feInfo != null) {
    if (codec == null) {
      throw new IOException("No configuration found for the cipher suite " + HADOOP_SECURITY_CRYPTO_CIPHER_SUITE_KEY + " value prefixed with "+ HADOOP_SECURITY_CRYPTO_CODEC_CLASSES_KEY_PREFIX+ ". Please see the example configuration "+ "hadoop.security.crypto.codec.classes.EXAMPLECIPHERSUITE "+ "at core-default.xml for details.");
    }
    KeyVersion decrypted=decryptEncryptedDataEncryptionKey(feInfo);
    final CryptoOutputStream cryptoOut=new CryptoOutputStream(dfsos,codec,decrypted.getMaterial(),feInfo.getIV(),startPos);
    return new HdfsDataOutputStream(cryptoOut,statistics,startPos);
  }
 else {
    return new HdfsDataOutputStream(dfsos,statistics,startPos);
  }
}
