{
  IOStreamPair pair=connectToDN(dn,dfsClientConf.getSocketTimeout(),lb);
  try {
    DataOutputStream out=new DataOutputStream(new BufferedOutputStream(pair.out,smallBufferSize));
    DataInputStream in=new DataInputStream(pair.in);
    new Sender(out).readBlock(lb.getBlock(),lb.getBlockToken(),clientName,0,1,true,CachingStrategy.newDefaultStrategy());
    final BlockOpResponseProto reply=BlockOpResponseProto.parseFrom(PBHelper.vintPrefixed(in));
    String logInfo="trying to read " + lb.getBlock() + " from datanode "+ dn;
    DataTransferProtoUtil.checkBlockOpStatus(reply,logInfo);
    return PBHelper.convert(reply.getReadOpChecksumInfo().getChecksum().getType());
  }
  finally {
    IOUtils.cleanup(null,pair.in,pair.out);
  }
}
