{
  String numStr=bucket.getName().substring(TOKEN_BUCKET_DIR_PREFIX.length());
  final int bucketId=Integer.parseInt(numStr);
  int numTokens=0;
  FileStatus[] tokenStats=fs.listStatus(bucket);
  for (  FileStatus stat : tokenStats) {
    String name=stat.getPath().getName();
    if (name.startsWith(TOKEN_FILE_PREFIX)) {
      MRDelegationTokenIdentifier token=loadToken(state,stat.getPath(),stat.getLen());
      int tokenBucketId=getBucketId(token);
      if (tokenBucketId != bucketId) {
        throw new IOException("Token " + stat.getPath() + " should be in bucket "+ tokenBucketId+ ", found in bucket "+ bucketId);
      }
      ++numTokens;
    }
 else {
      LOG.warn("Skipping unexpected file in history server token bucket: " + stat.getPath());
    }
  }
  return numTokens;
}
