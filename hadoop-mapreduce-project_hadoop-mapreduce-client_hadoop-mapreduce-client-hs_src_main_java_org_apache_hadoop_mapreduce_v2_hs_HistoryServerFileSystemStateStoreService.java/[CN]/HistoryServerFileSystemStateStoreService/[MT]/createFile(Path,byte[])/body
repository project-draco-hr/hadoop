{
  final int WRITE_BUFFER_SIZE=4096;
  Path tmp=new Path(file.getParent(),TMP_FILE_PREFIX + file.getName());
  FSDataOutputStream out=fs.create(tmp,FILE_PERMISSIONS,true,WRITE_BUFFER_SIZE,fs.getDefaultReplication(tmp),fs.getDefaultBlockSize(tmp),null);
  try {
    try {
      out.write(data);
    }
  finally {
      IOUtils.cleanup(LOG,out);
    }
    if (!fs.rename(tmp,file)) {
      throw new IOException("Could not rename " + tmp + " to "+ file);
    }
  }
 catch (  IOException e) {
    fs.delete(tmp,false);
    throw e;
  }
}
