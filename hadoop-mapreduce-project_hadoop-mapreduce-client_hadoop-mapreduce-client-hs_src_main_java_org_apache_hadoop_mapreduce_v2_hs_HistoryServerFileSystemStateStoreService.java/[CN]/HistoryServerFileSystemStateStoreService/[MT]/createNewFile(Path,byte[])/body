{
  Path tmp=new Path(file.getParent(),TMP_FILE_PREFIX + file.getName());
  writeFile(tmp,data);
  try {
    if (!fs.rename(tmp,file)) {
      throw new IOException("Could not rename " + tmp + " to "+ file);
    }
  }
 catch (  IOException e) {
    fs.delete(tmp,false);
    throw e;
  }
}
