{
  final Set<FileSystem> closed=Collections.synchronizedSet(new HashSet<FileSystem>());
  Configuration conf=new Configuration();
  Configuration confNoAuto=new Configuration();
  conf.setClass("fs.test.impl",TestShutdownFileSystem.class,FileSystem.class);
  confNoAuto.setClass("fs.test.impl",TestShutdownFileSystem.class,FileSystem.class);
  confNoAuto.setBoolean("fs.automatic.close",false);
  TestShutdownFileSystem fsWithAuto=(TestShutdownFileSystem)(new Path("test://a/").getFileSystem(conf));
  TestShutdownFileSystem fsWithoutAuto=(TestShutdownFileSystem)(new Path("test://b/").getFileSystem(confNoAuto));
  fsWithAuto.setClosedSet(closed);
  fsWithoutAuto.setClosedSet(closed);
  assertNotSame(fsWithAuto,fsWithoutAuto);
  FileSystem.CACHE.closeAll(true);
  assertEquals(1,closed.size());
  assertTrue(closed.contains(fsWithAuto));
  closed.clear();
  FileSystem.closeAll();
  assertEquals(1,closed.size());
  assertTrue(closed.contains(fsWithoutAuto));
}
