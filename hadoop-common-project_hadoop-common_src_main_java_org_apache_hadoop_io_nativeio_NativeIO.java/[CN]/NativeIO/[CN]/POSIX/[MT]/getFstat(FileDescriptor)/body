{
  Stat stat=null;
  if (!Shell.WINDOWS) {
    stat=fstat(fd);
    stat.owner=getName(IdCache.USER,stat.ownerId);
    stat.group=getName(IdCache.GROUP,stat.groupId);
  }
 else {
    try {
      stat=fstat(fd);
    }
 catch (    NativeIOException nioe) {
      if (nioe.getErrorCode() == 6) {
        throw new NativeIOException("The handle is invalid.",Errno.EBADF);
      }
 else {
        LOG.warn(String.format("NativeIO.getFstat error (%d): %s",nioe.getErrorCode(),nioe.getMessage()));
        throw new NativeIOException("Unknown error",Errno.UNKNOWN);
      }
    }
  }
  return stat;
}
