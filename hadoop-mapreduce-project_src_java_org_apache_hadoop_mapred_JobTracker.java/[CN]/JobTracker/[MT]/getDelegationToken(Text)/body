{
  if (!isAllowedDelegationTokenOp()) {
    throw new IOException("Delegation Token can be issued only with kerberos authentication");
  }
  UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  Text owner=new Text(ugi.getUserName());
  Text realUser=null;
  if (ugi.getRealUser() != null) {
    realUser=new Text(ugi.getRealUser().getUserName());
  }
  DelegationTokenIdentifier ident=new DelegationTokenIdentifier(owner,renewer,realUser);
  return new Token<DelegationTokenIdentifier>(ident,secretManager);
}
