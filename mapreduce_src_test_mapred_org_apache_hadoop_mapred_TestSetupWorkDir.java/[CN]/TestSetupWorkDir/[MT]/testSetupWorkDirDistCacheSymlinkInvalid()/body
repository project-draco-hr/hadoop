{
  JobConf jConf=new JobConf();
  FileSystem fs=FileSystem.getLocal(jConf);
  Path rootDir=new Path(System.getProperty("test.build.data","/tmp"),"testSetupWorkDirSymlinkFailure");
  Path myTargetDir=new Path(rootDir,"./tmp");
  createEmptyDir(fs,myTargetDir);
  createFile(fs,myTargetDir,"cacheFile.txt");
  TrackerDistributedCacheManager.setLocalFiles(jConf,(myTargetDir.toString() + Path.SEPARATOR + "cacheFile.txt"));
  assertTrue("Did not create cache file in " + myTargetDir,(fs.listStatus(myTargetDir).length == 1));
  jConf.set(MRJobConfig.CACHE_SYMLINK,"yes");
  Path myWorkDir=new Path(rootDir,"./work");
  createEmptyDir(fs,myWorkDir);
  DistributedCache.addCacheFile(new URI(myWorkDir.toString() + Path.SEPARATOR + "file.txt#invalid/abc"),jConf);
  try {
    TaskRunner.setupWorkDir(jConf,new File(myWorkDir.toUri().getPath()));
    assertFalse("TaskRunner.setupWorkDir() did not throw exception when" + " given invalid cache file",true);
  }
 catch (  IOException e) {
    assertTrue(myWorkDir + " does not have cache symlink.",fs.exists(myWorkDir) && (fs.listStatus(myWorkDir).length == 0));
  }
  fs.delete(rootDir,true);
}
