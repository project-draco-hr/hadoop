{
  final HftpFileSystem fs=weakFs.get();
  if (fs != null) {
synchronized (fs) {
      fs.ugi.reloginFromKeytab();
      fs.ugi.doAs(new PrivilegedExceptionAction<Void>(){
        @Override public Void run() throws Exception {
          try {
            DelegationTokenFetcher.renewDelegationToken(fs.nnHttpUrl,fs.delegationToken);
          }
 catch (          IOException ie) {
            try {
              fs.delegationToken=(Token<DelegationTokenIdentifier>)fs.getDelegationToken(null);
            }
 catch (            IOException ie2) {
              throw new IOException("Can't renew or get new delegation token ",ie);
            }
          }
          return null;
        }
      }
);
    }
  }
  return fs != null;
}
