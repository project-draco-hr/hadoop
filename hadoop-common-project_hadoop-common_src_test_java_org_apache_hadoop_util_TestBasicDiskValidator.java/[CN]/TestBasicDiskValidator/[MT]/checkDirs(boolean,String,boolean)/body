{
  File localDir=isDir ? createTempDir() : createTempFile();
  try {
    Shell.execCommand(Shell.getSetPermissionCommand(perm,false,localDir.getAbsolutePath()));
    DiskValidatorFactory.getInstance(BasicDiskValidator.NAME).checkStatus(localDir);
    assertTrue("call to checkDir() succeeded.",success);
  }
 catch (  DiskErrorException e) {
    if (success) {
      throw e;
    }
  }
 finally {
    localDir.delete();
  }
}
