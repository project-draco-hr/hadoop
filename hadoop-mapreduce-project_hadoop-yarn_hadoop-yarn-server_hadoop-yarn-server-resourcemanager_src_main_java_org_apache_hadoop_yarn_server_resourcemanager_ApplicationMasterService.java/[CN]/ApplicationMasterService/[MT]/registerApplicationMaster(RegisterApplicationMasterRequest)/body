{
  ApplicationAttemptId applicationAttemptId=request.getApplicationAttemptId();
  AMResponse lastResponse=responseMap.get(applicationAttemptId);
  if (lastResponse == null) {
    String message="Application doesn't exist in cache " + applicationAttemptId;
    LOG.error(message);
    throw RPCUtil.getRemoteException(message);
  }
synchronized (lastResponse) {
    LOG.info("AM registration " + applicationAttemptId);
    this.amLivelinessMonitor.receivedPing(applicationAttemptId);
    this.rmContext.getDispatcher().getEventHandler().handle(new RMAppAttemptRegistrationEvent(applicationAttemptId,request.getHost(),request.getRpcPort(),request.getTrackingUrl()));
    RegisterApplicationMasterResponse response=recordFactory.newRecordInstance(RegisterApplicationMasterResponse.class);
    response.setMinimumResourceCapability(rScheduler.getMinimumResourceCapability());
    response.setMaximumResourceCapability(rScheduler.getMaximumResourceCapability());
    return response;
  }
}
