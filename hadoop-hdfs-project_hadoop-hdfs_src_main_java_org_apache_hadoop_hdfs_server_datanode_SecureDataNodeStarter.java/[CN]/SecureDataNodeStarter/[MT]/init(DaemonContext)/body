{
  System.err.println("Initializing secure datanode resources");
  Configuration conf=new Configuration();
  if (!conf.get(HADOOP_SECURITY_AUTHENTICATION).equals("kerberos"))   throw new RuntimeException("Cannot start secure datanode in unsecure cluster");
  args=context.getArguments();
  InetSocketAddress socAddr=DataNode.getStreamingAddr(conf);
  int socketWriteTimeout=conf.getInt(DFSConfigKeys.DFS_DATANODE_SOCKET_WRITE_TIMEOUT_KEY,HdfsConstants.WRITE_TIMEOUT);
  ServerSocket ss=(socketWriteTimeout > 0) ? ServerSocketChannel.open().socket() : new ServerSocket();
  ss.bind(socAddr,0);
  if (ss.getLocalPort() != socAddr.getPort())   throw new RuntimeException("Unable to bind on specified streaming port in secure " + "context. Needed " + socAddr.getPort() + ", got "+ ss.getLocalPort());
  SelectChannelConnector listener=(SelectChannelConnector)HttpServer.createDefaultChannelConnector();
  InetSocketAddress infoSocAddr=DataNode.getInfoAddr(conf);
  listener.setHost(infoSocAddr.getHostName());
  listener.setPort(infoSocAddr.getPort());
  listener.open();
  if (listener.getPort() != infoSocAddr.getPort())   throw new RuntimeException("Unable to bind on specified info port in secure " + "context. Needed " + socAddr.getPort() + ", got "+ ss.getLocalPort());
  System.err.println("Successfully obtained privileged resources (streaming port = " + ss + " ) (http listener port = "+ listener.getConnection()+ ")");
  if (ss.getLocalPort() >= 1023 || listener.getPort() >= 1023)   throw new RuntimeException("Cannot start secure datanode with unprivileged ports");
  resources=new SecureResources(ss,listener);
}
