{
  handleOpts(args);
  Integer exitCode=1;
  UserGroupInformation loginUser=UserGroupInformation.getLoginUser();
  if (!proxy || loginUser.getShortUserName().equals(user)) {
    LOG.info("Running as " + user);
    exitCode=runInternal();
  }
 else {
    LOG.info("Running as " + loginUser.getShortUserName() + " but will "+ "impersonate "+ user);
    UserGroupInformation proxyUser=UserGroupInformation.createProxyUser(user,loginUser);
    exitCode=proxyUser.doAs(new PrivilegedExceptionAction<Integer>(){
      @Override public Integer run() throws Exception {
        return runInternal();
      }
    }
);
  }
  return exitCode;
}
