{
  Credentials credentials=new Credentials();
  TokenCache.obtainTokensForNamenodesInternal(credentials,new Path[]{p1,p2},jConf);
  String fs_addr=SecurityUtil.buildDTServiceName(p1.toUri(),NameNode.DEFAULT_PORT);
  Token<DelegationTokenIdentifier> nnt=TokenCache.getDelegationToken(credentials,fs_addr);
  System.out.println("dt for " + p1 + "("+ fs_addr+ ")"+ " = "+ nnt);
  assertNotNull("Token for nn is null",nnt);
  Collection<Token<? extends TokenIdentifier>> tns=credentials.getAllTokens();
  assertEquals("number of tokens is not 1",1,tns.size());
  boolean found=false;
  for (  Token<? extends TokenIdentifier> t : tns) {
    if (t.getKind().equals(DelegationTokenIdentifier.HDFS_DELEGATION_KIND) && t.getService().equals(new Text(fs_addr))) {
      found=true;
    }
    assertTrue("didn't find token for " + p1,found);
  }
}
