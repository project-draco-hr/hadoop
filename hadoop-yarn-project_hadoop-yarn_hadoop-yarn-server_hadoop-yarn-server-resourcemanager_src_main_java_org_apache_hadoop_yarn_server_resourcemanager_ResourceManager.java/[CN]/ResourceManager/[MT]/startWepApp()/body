{
  Builder<ApplicationMasterService> builder=WebApps.$for("cluster",ApplicationMasterService.class,masterService,"ws").with(conf).withHttpSpnegoPrincipalKey(YarnConfiguration.RM_WEBAPP_SPNEGO_USER_NAME_KEY).withHttpSpnegoKeytabKey(YarnConfiguration.RM_WEBAPP_SPNEGO_KEYTAB_FILE_KEY).at(webAppAddress);
  String proxyHostAndPort=WebAppUtils.getProxyHostAndPort(conf);
  if (WebAppUtils.getResolvedRMWebAppURLWithoutScheme(conf).equals(proxyHostAndPort)) {
    if (HAUtil.isHAEnabled(conf)) {
      fetcher=new AppReportFetcher(conf);
    }
 else {
      fetcher=new AppReportFetcher(conf,getClientRMService());
    }
    builder.withServlet(ProxyUriUtils.PROXY_SERVLET_NAME,ProxyUriUtils.PROXY_PATH_SPEC,WebAppProxyServlet.class);
    builder.withAttribute(WebAppProxy.FETCHER_ATTRIBUTE,fetcher);
    String[] proxyParts=proxyHostAndPort.split(":");
    builder.withAttribute(WebAppProxy.PROXY_HOST_ATTRIBUTE,proxyParts[0]);
  }
  webApp=builder.start(new RMWebApp(this));
}
