{
  if (this.rmContext.getYarnConfiguration().getBoolean(YarnConfiguration.DIST_SCHEDULING_ENABLED,YarnConfiguration.DIST_SCHEDULING_ENABLED_DEFAULT)) {
    DistributedSchedulingAMService distributedSchedulingService=new DistributedSchedulingAMService(this.rmContext,scheduler);
    EventDispatcher distSchedulerEventDispatcher=new EventDispatcher(distributedSchedulingService,DistributedSchedulingAMService.class.getName());
    addService(distSchedulerEventDispatcher);
    rmDispatcher.register(SchedulerEventType.class,distSchedulerEventDispatcher);
    this.rmContext.setContainerQueueLimitCalculator(distributedSchedulingService.getNodeManagerQueueLimitCalculator());
    return distributedSchedulingService;
  }
  return new ApplicationMasterService(this.rmContext,scheduler);
}
