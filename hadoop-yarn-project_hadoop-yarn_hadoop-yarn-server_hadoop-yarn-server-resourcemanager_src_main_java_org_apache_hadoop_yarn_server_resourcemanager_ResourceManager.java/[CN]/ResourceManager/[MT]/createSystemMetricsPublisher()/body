{
  boolean timelineServiceEnabled=conf.getBoolean(YarnConfiguration.TIMELINE_SERVICE_ENABLED,YarnConfiguration.DEFAULT_TIMELINE_SERVICE_ENABLED);
  SystemMetricsPublisher publisher=null;
  if (timelineServiceEnabled) {
    if (conf.getBoolean(YarnConfiguration.RM_SYSTEM_METRICS_PUBLISHER_ENABLED,YarnConfiguration.DEFAULT_RM_SYSTEM_METRICS_PUBLISHER_ENABLED)) {
      LOG.info("TimelineService V1 is configured");
      publisher=new TimelineServiceV1Publisher();
    }
 else {
      LOG.info("TimelineService V2 is configured");
      publisher=new TimelineServiceV2Publisher(rmContext);
    }
  }
 else {
    LOG.info("TimelineServicePublisher is not configured");
    publisher=new NoOpSystemMetricPublisher();
  }
  return publisher;
}
