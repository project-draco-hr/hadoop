{
  Configuration conf=new Configuration(loadHadoopDefaults);
  String confDir=System.getProperty(KMS_CONFIG_DIR);
  if (confDir != null) {
    try {
      if (!confDir.startsWith("/")) {
        throw new RuntimeException("System property '" + KMS_CONFIG_DIR + "' must be an absolute path: "+ confDir);
      }
      if (!confDir.endsWith("/")) {
        confDir+="/";
      }
      for (      String resource : resources) {
        conf.addResource(new URL("file://" + confDir + resource));
      }
    }
 catch (    MalformedURLException ex) {
      throw new RuntimeException(ex);
    }
  }
 else {
    for (    String resource : resources) {
      conf.addResource(resource);
    }
  }
  return conf;
}
