{
  Preconditions.checkNotNull(configuration);
  Preconditions.checkState(length >= 0,"Length must be set to a non-negative value");
  BlockReader reader=tryToCreateExternalBlockReader();
  if (reader != null) {
    return reader;
  }
  final ShortCircuitConf scConf=conf.getShortCircuitConf();
  if (scConf.isShortCircuitLocalReads() && allowShortCircuitLocalReads) {
    if (clientContext.getUseLegacyBlockReaderLocal()) {
      reader=getLegacyBlockReaderLocal();
      if (reader != null) {
        LOG.trace("{}: returning new legacy block reader local.",this);
        return reader;
      }
    }
 else {
      reader=getBlockReaderLocal();
      if (reader != null) {
        LOG.trace("{}: returning new block reader local.",this);
        return reader;
      }
    }
  }
  if (scConf.isDomainSocketDataTraffic()) {
    reader=getRemoteBlockReaderFromDomain();
    if (reader != null) {
      LOG.trace("{}: returning new remote block reader using UNIX domain " + "socket on {}",this,pathInfo.getPath());
      return reader;
    }
  }
  Preconditions.checkState(!DFSInputStream.tcpReadsDisabledForTesting,"TCP reads were disabled for testing, but we failed to " + "do a non-TCP read.");
  return getRemoteBlockReaderFromTcp();
}
