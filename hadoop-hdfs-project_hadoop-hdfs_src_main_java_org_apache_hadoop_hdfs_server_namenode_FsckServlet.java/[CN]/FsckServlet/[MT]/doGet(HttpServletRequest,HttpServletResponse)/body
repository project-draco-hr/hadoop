{
  @SuppressWarnings("unchecked") final Map<String,String[]> pmap=request.getParameterMap();
  final PrintWriter out=response.getWriter();
  final InetAddress remoteAddress=InetAddress.getByName(request.getRemoteAddr());
  final ServletContext context=getServletContext();
  final Configuration conf=NameNodeHttpServer.getConfFromContext(context);
  final UserGroupInformation ugi=getUGI(request,conf);
  try {
    ugi.doAs(new PrivilegedExceptionAction<Object>(){
      @Override public Object run() throws Exception {
        NameNode nn=NameNodeHttpServer.getNameNodeFromContext(context);
        final FSNamesystem namesystem=nn.getNamesystem();
        final BlockManager bm=namesystem.getBlockManager();
        final int totalDatanodes=namesystem.getNumberOfDatanodes(DatanodeReportType.LIVE);
        new NamenodeFsck(conf,nn,bm.getDatanodeManager().getNetworkTopology(),pmap,out,totalDatanodes,remoteAddress).fsck();
        return null;
      }
    }
);
  }
 catch (  InterruptedException e) {
    response.sendError(400,e.getMessage());
  }
}
