{
  int dropped=0;
  for (  MetricsSinkAdapter sa : sinks.values()) {
    long startTime=Time.now();
    boolean result;
    if (immediate) {
      result=sa.putMetricsImmediate(buffer);
    }
 else {
      result=sa.putMetrics(buffer,logicalTime);
    }
    dropped+=result ? 0 : 1;
    publishStat.add(Time.now() - startTime);
  }
  droppedPubAll.incr(dropped);
}
