{
  ClusterStatus cs=new ClusterStatus();
  Configuration conf=new Configuration();
  List<ConfiguredNNAddress> nns=null;
  try {
    nns=DFSUtil.flattenAddressMap(DFSUtil.getNNServiceRpcAddresses(conf));
  }
 catch (  Exception e) {
    cs.setError(e);
    return cs;
  }
  for (  ConfiguredNNAddress cnn : nns) {
    InetSocketAddress isa=cnn.getAddress();
    NamenodeMXBeanHelper nnHelper=null;
    try {
      nnHelper=new NamenodeMXBeanHelper(isa,conf);
      String mbeanProps=queryMbean(nnHelper.httpAddress,conf);
      NamenodeStatus nn=nnHelper.getNamenodeStatus(mbeanProps);
      if (cs.clusterid.isEmpty() || cs.clusterid.equals("")) {
        cs.clusterid=nnHelper.getClusterId(mbeanProps);
      }
      cs.addNamenodeStatus(nn);
    }
 catch (    Exception e) {
      cs.addException(isa.getHostName(),e);
      continue;
    }
  }
  return cs;
}
