{
  try {
    if (!HttpServer.hasAdministratorAccess(getServletContext(),request,response)) {
      return;
    }
    response.setContentType("application/json; charset=utf8");
    PrintWriter writer=response.getWriter();
    JsonFactory jsonFactory=new JsonFactory();
    JsonGenerator jg=jsonFactory.createJsonGenerator(writer);
    jg.useDefaultPrettyPrinter();
    jg.writeStartObject();
    if (mBeanServer == null) {
      jg.writeStringField("result","ERROR");
      jg.writeStringField("message","No MBeanServer could be found");
      jg.close();
      return;
    }
    String qry=request.getParameter("qry");
    if (qry == null) {
      qry="*:*";
    }
    listBeans(jg,new ObjectName(qry));
    jg.close();
  }
 catch (  IOException e) {
    LOG.error("Caught an exception while processing JMX request",e);
    response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
  }
catch (  MalformedObjectNameException e) {
    LOG.error("Caught an exception while processing JMX request",e);
    response.setStatus(HttpServletResponse.SC_BAD_REQUEST);
  }
}
