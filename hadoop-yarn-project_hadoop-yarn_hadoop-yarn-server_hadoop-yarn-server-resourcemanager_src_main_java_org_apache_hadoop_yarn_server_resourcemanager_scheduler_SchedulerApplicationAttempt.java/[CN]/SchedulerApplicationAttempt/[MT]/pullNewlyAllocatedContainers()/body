{
  try {
    writeLock.lock();
    List<Container> returnContainerList=new ArrayList<Container>(newlyAllocatedContainers.size());
    Iterator<RMContainer> i=newlyAllocatedContainers.iterator();
    while (i.hasNext()) {
      RMContainer rmContainer=i.next();
      Container updatedContainer=updateContainerAndNMToken(rmContainer,true,false);
      if (updatedContainer != null) {
        returnContainerList.add(updatedContainer);
        i.remove();
      }
    }
    return returnContainerList;
  }
  finally {
    writeLock.unlock();
  }
}
