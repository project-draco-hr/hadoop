{
  try {
    writeLock.lock();
    QueueMetrics oldMetrics=queue.getMetrics();
    QueueMetrics newMetrics=newQueue.getMetrics();
    String newQueueName=newQueue.getQueueName();
    String user=getUser();
    for (    RMContainer liveContainer : liveContainers.values()) {
      Resource resource=liveContainer.getContainer().getResource();
      ((RMContainerImpl)liveContainer).setQueueName(newQueueName);
      oldMetrics.releaseResources(user,1,resource);
      newMetrics.allocateResources(user,1,resource,false);
    }
    for (    Map<NodeId,RMContainer> map : reservedContainers.values()) {
      for (      RMContainer reservedContainer : map.values()) {
        ((RMContainerImpl)reservedContainer).setQueueName(newQueueName);
        Resource resource=reservedContainer.getReservedResource();
        oldMetrics.unreserveResource(user,resource);
        newMetrics.reserveResource(user,resource);
      }
    }
    appSchedulingInfo.move(newQueue);
    this.queue=newQueue;
  }
  finally {
    writeLock.unlock();
  }
}
