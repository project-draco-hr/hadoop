{
  if (wrappedStream != null) {
    String reason=null;
    boolean shouldAbort=length - pos > CLOSE_THRESHOLD;
    if (!shouldAbort) {
      try {
        reason="Closed stream";
        wrappedStream.close();
      }
 catch (      IOException e) {
        LOG.debug("When closing stream",e);
        shouldAbort=true;
      }
    }
    if (shouldAbort) {
      wrappedStream.abort();
      reason="Closed stream with abort";
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug(reason + "; streamPos=" + pos+ ", nextReadPos="+ nextReadPos+ ", contentLength="+ length);
    }
    wrappedStream=null;
  }
}
