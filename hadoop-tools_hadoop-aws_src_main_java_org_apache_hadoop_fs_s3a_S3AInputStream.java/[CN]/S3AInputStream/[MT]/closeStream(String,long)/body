{
  if (wrappedStream != null) {
    boolean shouldAbort=length - pos > CLOSE_THRESHOLD;
    if (!shouldAbort) {
      try {
        wrappedStream.close();
        streamStatistics.streamClose(false);
      }
 catch (      IOException e) {
        LOG.debug("When closing {} stream for {}",uri,reason,e);
        shouldAbort=true;
      }
    }
    if (shouldAbort) {
      wrappedStream.abort();
      streamStatistics.streamClose(true);
    }
    LOG.debug("Stream {} {}: {}; streamPos={}, nextReadPos={}," + " length={}",uri,(shouldAbort ? "aborted" : "closed"),reason,pos,nextReadPos,length);
    wrappedStream=null;
  }
}
