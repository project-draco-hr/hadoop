{
  String queue=getQueue(job);
  QueueQuota quota=queueQuota.get(queue);
  if (quota == null) {
    LOG.error("Queue " + queue + " not configured properly");
    return false;
  }
  if (quota.quota < 1 && !fill) {
    return false;
  }
  Task t=null;
  if (map) {
    t=job.obtainNewLocalMapTask(taskTracker,numTrackers,taskTrackerManager.getNumberOfUniqueHosts());
    if (t != null) {
      if (debug) {
        LOG.debug("assigned local task for job " + job.getProfile().getJobID() + " "+ taskType(map));
      }
      assignedTasks.add(t);
      if (map) {
        quota.map_used++;
      }
 else {
        quota.reduce_used++;
      }
      quota.quota--;
      return true;
    }
    t=job.obtainNewNonLocalMapTask(taskTracker,numTrackers,taskTrackerManager.getNumberOfUniqueHosts());
  }
 else {
    t=job.obtainNewReduceTask(taskTracker,numTrackers,taskTrackerManager.getNumberOfUniqueHosts());
  }
  if (t != null) {
    if (debug) {
      LOG.debug("assigned remote task for job " + job.getProfile().getJobID() + " "+ taskType(map));
    }
    assignedTasks.add(t);
    if (map) {
      quota.map_used++;
    }
 else {
      quota.reduce_used++;
    }
    quota.quota--;
    return true;
  }
  return false;
}
