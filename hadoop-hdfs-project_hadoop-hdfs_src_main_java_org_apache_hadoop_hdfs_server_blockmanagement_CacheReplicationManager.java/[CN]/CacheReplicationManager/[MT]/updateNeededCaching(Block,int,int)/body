{
  namesystem.writeLock();
  try {
    if (!namesystem.isPopulatingReplQueues()) {
      return;
    }
    final int numCached=getNumCached(block);
    final int curExpectedReplicas=getCacheReplication(block);
    if (numCached < curExpectedReplicas) {
      neededCacheBlocks.add(block);
    }
 else {
synchronized (neededCacheBlocks) {
        neededCacheBlocks.remove(block);
      }
    }
  }
  finally {
    namesystem.writeUnlock();
  }
}
