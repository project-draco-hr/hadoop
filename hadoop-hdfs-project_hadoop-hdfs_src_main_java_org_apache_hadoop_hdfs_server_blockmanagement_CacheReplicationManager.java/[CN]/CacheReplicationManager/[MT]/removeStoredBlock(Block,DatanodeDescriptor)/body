{
  blockLogDebug("#removeStoredBlock: " + block + " from "+ node);
  assert(namesystem.hasWriteLock());
{
    if (!cachedBlocksMap.removeNode(block,node)) {
      blockLogDebug("#removeStoredBlock: " + block + " has already been removed from node "+ node);
      return;
    }
    if (cachedBlocksMap.getStoredBlock(block).numNodes() == 0) {
      cachedBlocksMap.removeBlock(block);
    }
    BlockCollection bc=blockManager.blocksMap.getBlockCollection(block);
    if (bc != null) {
      updateNeededCaching(block,-1,0);
    }
  }
}
