{
  String namenode=null;
  MiniDFSCluster cluster=null;
  try {
    Configuration conf=new Configuration();
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
    final FileSystem hdfs=cluster.getFileSystem();
    namenode=FileSystem.getDefaultUri(conf).toString();
    if (namenode.startsWith("hdfs://")) {
      MyFile[] files=createFiles(URI.create(namenode),"/basedir/middle/srcdat");
      ToolRunner.run(new DistCpV1(conf),new String[]{"-basedir","/basedir",namenode + "/basedir/middle/srcdat",namenode + "/destdat"});
      assertTrue("Source and destination directories do not match.",checkFiles(hdfs,"/destdat/middle/srcdat",files));
      deldir(hdfs,"/destdat");
      deldir(hdfs,"/basedir");
      deldir(hdfs,"/logs");
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
