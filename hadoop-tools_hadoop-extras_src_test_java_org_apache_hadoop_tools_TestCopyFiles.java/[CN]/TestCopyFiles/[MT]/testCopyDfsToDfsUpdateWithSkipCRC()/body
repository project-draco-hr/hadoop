{
  MiniDFSCluster cluster=null;
  try {
    Configuration conf=new Configuration();
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
    final FileSystem hdfs=cluster.getFileSystem();
    final String namenode=hdfs.getUri().toString();
    FileSystem fs=FileSystem.get(URI.create(namenode),new Configuration());
    final String testfilename="test";
    final String srcData="act act act";
    final String destData="cat cat cat";
    if (namenode.startsWith("hdfs://")) {
      deldir(hdfs,"/logs");
      Path srcPath=new Path("/srcdat",testfilename);
      Path destPath=new Path("/destdat",testfilename);
      FSDataOutputStream out=fs.create(srcPath,true);
      out.writeUTF(srcData);
      out.close();
      out=fs.create(destPath,true);
      out.writeUTF(destData);
      out.close();
      ToolRunner.run(new DistCpV1(conf),new String[]{"-p","-update","-skipcrccheck","-log",namenode + "/logs",namenode + "/srcdat",namenode + "/destdat"});
      FSDataInputStream in=hdfs.open(destPath);
      String s=in.readUTF();
      System.out.println("Dest had: " + s);
      assertTrue("Dest got over written even with skip crc",s.equalsIgnoreCase(destData));
      in.close();
      deldir(hdfs,"/logs");
      ToolRunner.run(new DistCpV1(conf),new String[]{"-p","-update","-log",namenode + "/logs",namenode + "/srcdat",namenode + "/destdat"});
      in=hdfs.open(destPath);
      s=in.readUTF();
      System.out.println("Dest had: " + s);
      assertTrue("Dest did not get overwritten without skip crc",s.equalsIgnoreCase(srcData));
      in.close();
      deldir(hdfs,"/destdat");
      deldir(hdfs,"/srcdat");
      deldir(hdfs,"/logs");
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
