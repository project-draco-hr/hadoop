{
  FileSystem fs=FileSystem.get(LOCAL_FS,new Configuration());
  Path root=new Path(TEST_ROOT_DIR + "/srcdat");
  try {
    MyFile[] files={createFile(root,fs)};
    ToolRunner.run(new DistCpV1(new Configuration()),new String[]{"file:///" + TEST_ROOT_DIR + "/srcdat","file:///" + TEST_ROOT_DIR + "/destdat"});
    assertTrue("Source and destination directories do not match.",checkFiles(fs,TEST_ROOT_DIR + "/destdat",files));
    String fname=files[0].getName();
    Path p=new Path(root,fname);
    FileSystem.LOG.info("fname=" + fname + ", exists? "+ fs.exists(p));
    ToolRunner.run(new DistCpV1(new Configuration()),new String[]{"file:///" + TEST_ROOT_DIR + "/srcdat/"+ fname,"file:///" + TEST_ROOT_DIR + "/dest2/"+ fname});
    assertTrue("Source and destination directories do not match.",checkFiles(fs,TEST_ROOT_DIR + "/dest2",files));
    String[] args={"-update","file:///" + TEST_ROOT_DIR + "/srcdat/"+ fname,"file:///" + TEST_ROOT_DIR + "/dest2/"+ fname};
    Configuration conf=new Configuration();
    JobConf job=new JobConf(conf,DistCpV1.class);
    DistCpV1.Arguments distcpArgs=DistCpV1.Arguments.valueOf(args,conf);
    assertFalse("Single file update failed to skip copying even though the " + "file exists at destination.",DistCpV1.setup(conf,job,distcpArgs));
    deldir(fs,TEST_ROOT_DIR + "/dest2");
    fs.mkdirs(new Path(TEST_ROOT_DIR + "/dest2"));
    MyFile[] files2={createFile(root,fs,0)};
    String sname=files2[0].getName();
    ToolRunner.run(new DistCpV1(new Configuration()),new String[]{"-update","file:///" + TEST_ROOT_DIR + "/srcdat/"+ sname,"file:///" + TEST_ROOT_DIR + "/dest2/"});
    assertTrue("Source and destination directories do not match.",checkFiles(fs,TEST_ROOT_DIR + "/dest2",files2));
    updateFiles(fs,TEST_ROOT_DIR + "/srcdat",files2,1);
    ToolRunner.run(new DistCpV1(new Configuration()),new String[]{"-update","file:///" + TEST_ROOT_DIR + "/srcdat/"+ sname,"file:///" + TEST_ROOT_DIR + "/dest2/"});
    assertTrue("Source and destination directories do not match.",checkFiles(fs,TEST_ROOT_DIR + "/dest2",files2));
  }
  finally {
    deldir(fs,TEST_ROOT_DIR + "/destdat");
    deldir(fs,TEST_ROOT_DIR + "/dest2");
    deldir(fs,TEST_ROOT_DIR + "/srcdat");
  }
}
