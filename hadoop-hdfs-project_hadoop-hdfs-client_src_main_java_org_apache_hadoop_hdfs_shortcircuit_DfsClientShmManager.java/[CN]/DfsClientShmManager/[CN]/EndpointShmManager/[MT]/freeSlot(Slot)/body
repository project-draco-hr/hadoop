{
  DfsClientShm shm=(DfsClientShm)slot.getShm();
  shm.unregisterSlot(slot.getSlotIdx());
  if (shm.isDisconnected()) {
    Preconditions.checkState(!full.containsKey(shm.getShmId()));
    Preconditions.checkState(!notFull.containsKey(shm.getShmId()));
    if (shm.isEmpty()) {
      LOG.trace("{}: freeing empty stale {}",this,shm);
      shm.free();
    }
  }
 else {
    ShmId shmId=shm.getShmId();
    full.remove(shmId);
    if (shm.isEmpty()) {
      notFull.remove(shmId);
      LOG.trace("{}: shutting down UNIX domain socket for empty {}",this,shm);
      shutdown(shm);
    }
 else {
      notFull.put(shmId,shm);
    }
  }
}
