{
  if (notFull.isEmpty()) {
    return null;
  }
  Entry<ShmId,DfsClientShm> entry=notFull.firstEntry();
  DfsClientShm shm=entry.getValue();
  ShmId shmId=shm.getShmId();
  Slot slot=shm.allocAndRegisterSlot(blockId);
  if (shm.isFull()) {
    LOG.trace("{}: pulled the last slot {} out of {}",this,slot.getSlotIdx(),shm);
    DfsClientShm removedShm=notFull.remove(shmId);
    Preconditions.checkState(removedShm == shm);
    full.put(shmId,shm);
  }
 else {
    LOG.trace("{}: pulled slot {} out of {}",this,slot.getSlotIdx(),shm);
  }
  return slot;
}
