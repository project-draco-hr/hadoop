{
  if (notFull.isEmpty()) {
    return null;
  }
  Entry<ShmId,DfsClientShm> entry=notFull.firstEntry();
  DfsClientShm shm=entry.getValue();
  ShmId shmId=shm.getShmId();
  Slot slot=shm.allocAndRegisterSlot(blockId);
  if (shm.isFull()) {
    if (LOG.isTraceEnabled()) {
      LOG.trace(this + ": pulled the last slot " + slot.getSlotIdx()+ " out of "+ shm);
    }
    DfsClientShm removedShm=notFull.remove(shmId);
    Preconditions.checkState(removedShm == shm);
    full.put(shmId,shm);
  }
 else {
    if (LOG.isTraceEnabled()) {
      LOG.trace(this + ": pulled slot " + slot.getSlotIdx()+ " out of "+ shm);
    }
  }
  return slot;
}
