{
  String parentPath=FSImageSerialization.readString(in);
  FSDirectory fsDir=namesystem.dir;
  INode parent=fsDir.rootDir.getNode(parentPath,true);
  if (parent == null || !parent.isDirectory()) {
    throw new IOException("Path " + parentPath + "is not a directory.");
  }
  int numChildren=in.readInt();
  for (int i=0; i < numChildren; i++) {
    byte[] localName=new byte[in.readShort()];
    in.readFully(localName);
    INode newNode=loadINode(in);
    namesystem.dir.addToParent(localName,(INodeDirectory)parent,newNode,false);
  }
  return numChildren;
}
