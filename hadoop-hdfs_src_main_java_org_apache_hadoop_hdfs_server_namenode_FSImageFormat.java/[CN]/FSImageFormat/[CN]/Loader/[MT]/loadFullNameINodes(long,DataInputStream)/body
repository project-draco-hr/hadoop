{
  byte[][] pathComponents;
  byte[][] parentPath={{}};
  FSDirectory fsDir=namesystem.dir;
  INodeDirectory parentINode=fsDir.rootDir;
  for (long i=0; i < numFiles; i++) {
    pathComponents=FSImageSerialization.readPathComponents(in);
    INode newNode=loadINode(in);
    if (isRoot(pathComponents)) {
      updateRootAttr(newNode);
      continue;
    }
    if (!isParent(pathComponents,parentPath)) {
      parentINode=fsDir.getParent(pathComponents);
      parentPath=getParent(pathComponents);
    }
    parentINode=fsDir.addToParent(pathComponents[pathComponents.length - 1],parentINode,newNode,false);
  }
}
