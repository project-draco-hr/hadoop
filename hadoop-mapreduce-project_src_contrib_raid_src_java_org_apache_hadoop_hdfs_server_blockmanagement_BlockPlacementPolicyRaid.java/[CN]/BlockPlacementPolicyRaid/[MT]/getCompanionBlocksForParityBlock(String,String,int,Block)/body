{
  int blockIndex=getBlockIndex(parity,block);
  List<LocatedBlock> result=new ArrayList<LocatedBlock>();
  List<LocatedBlock> parityBlocks=cachedLocatedBlocks.get(parity);
  int stripeIndex=blockIndex / parityLength;
synchronized (parityBlocks) {
    int parityStart=stripeIndex * parityLength;
    int parityEnd=Math.min(parityStart + parityLength,parityBlocks.size());
    if (parityStart < parityBlocks.size()) {
      result.addAll(parityBlocks.subList(parityStart,parityEnd));
    }
  }
  if (src == null) {
    return result;
  }
  List<LocatedBlock> sourceBlocks=cachedLocatedBlocks.get(src);
synchronized (sourceBlocks) {
    int sourceStart=stripeIndex * stripeLength;
    int sourceEnd=Math.min(sourceStart + stripeLength,sourceBlocks.size());
    if (sourceStart < sourceBlocks.size()) {
      result.addAll(sourceBlocks.subList(sourceStart,sourceEnd));
    }
  }
  return result;
}
