{
  SnapshotDiffReport diffs;
  final FSPermissionChecker pc=fsd.getPermissionChecker();
  fsd.readLock();
  try {
    if (fsd.isPermissionEnabled()) {
      checkSubtreeReadPermission(fsd,pc,path,fromSnapshot);
      checkSubtreeReadPermission(fsd,pc,path,toSnapshot);
    }
    INodesInPath iip=fsd.getINodesInPath(path,true);
    diffs=snapshotManager.diff(iip,path,fromSnapshot,toSnapshot);
  }
  finally {
    fsd.readUnlock();
  }
  return diffs;
}
