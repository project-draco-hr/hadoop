{
  final FSPermissionChecker pc=fsd.getPermissionChecker();
  INode.BlocksMapUpdateInfo collectedBlocks=new INode.BlocksMapUpdateInfo();
  if (fsd.isPermissionEnabled()) {
    fsd.checkOwner(pc,snapshotRoot);
  }
  ChunkedArrayList<INode> removedINodes=new ChunkedArrayList<INode>();
  fsd.writeLock();
  try {
    snapshotManager.deleteSnapshot(snapshotRoot,snapshotName,collectedBlocks,removedINodes);
    fsd.removeFromInodeMap(removedINodes);
  }
  finally {
    fsd.writeUnlock();
  }
  removedINodes.clear();
  fsd.getEditLog().logDeleteSnapshot(snapshotRoot,snapshotName,logRetryCache);
  return collectedBlocks;
}
