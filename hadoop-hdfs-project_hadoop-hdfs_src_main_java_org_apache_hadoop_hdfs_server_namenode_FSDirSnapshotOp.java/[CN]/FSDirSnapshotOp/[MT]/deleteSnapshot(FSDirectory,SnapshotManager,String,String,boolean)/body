{
  final INodesInPath iip=fsd.getINodesInPath4Write(snapshotRoot);
  if (fsd.isPermissionEnabled()) {
    FSPermissionChecker pc=fsd.getPermissionChecker();
    fsd.checkOwner(pc,iip);
  }
  INode.BlocksMapUpdateInfo collectedBlocks=new INode.BlocksMapUpdateInfo();
  ChunkedArrayList<INode> removedINodes=new ChunkedArrayList<INode>();
  fsd.writeLock();
  try {
    snapshotManager.deleteSnapshot(iip,snapshotName,collectedBlocks,removedINodes);
    fsd.removeFromInodeMap(removedINodes);
  }
  finally {
    fsd.writeUnlock();
  }
  removedINodes.clear();
  fsd.getEditLog().logDeleteSnapshot(snapshotRoot,snapshotName,logRetryCache);
  return collectedBlocks;
}
