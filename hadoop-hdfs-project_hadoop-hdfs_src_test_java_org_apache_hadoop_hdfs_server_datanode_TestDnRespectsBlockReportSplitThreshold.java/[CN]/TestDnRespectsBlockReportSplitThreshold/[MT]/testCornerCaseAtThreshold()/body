{
  startUpCluster(BLOCKS_IN_FILE);
  NameNode nn=cluster.getNameNode();
  DataNode dn=cluster.getDataNodes().get(0);
  createFile(GenericTestUtils.getMethodName(),BLOCKS_IN_FILE);
  DatanodeProtocolClientSideTranslatorPB nnSpy=InternalDataNodeTestUtils.spyOnBposToNN(dn,nn);
  DataNodeTestUtils.triggerBlockReport(dn);
  ArgumentCaptor<StorageBlockReport[]> captor=ArgumentCaptor.forClass(StorageBlockReport[].class);
  Mockito.verify(nnSpy,times(cluster.getStoragesPerDatanode())).blockReport(any(DatanodeRegistration.class),anyString(),captor.capture(),Mockito.<BlockReportContext>anyObject());
  verifyCapturedArguments(captor,1,BLOCKS_IN_FILE);
}
