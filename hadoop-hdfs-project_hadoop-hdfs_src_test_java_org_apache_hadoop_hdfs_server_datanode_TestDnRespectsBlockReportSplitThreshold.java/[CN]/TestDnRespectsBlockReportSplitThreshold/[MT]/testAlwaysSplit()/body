{
  startUpCluster(0);
  NameNode nn=cluster.getNameNode();
  DataNode dn=cluster.getDataNodes().get(0);
  createFile(GenericTestUtils.getMethodName(),BLOCKS_IN_FILE);
  DatanodeProtocolClientSideTranslatorPB nnSpy=DataNodeTestUtils.spyOnBposToNN(dn,nn);
  DataNodeTestUtils.triggerBlockReport(dn);
  ArgumentCaptor<StorageBlockReport[]> captor=ArgumentCaptor.forClass(StorageBlockReport[].class);
  Mockito.verify(nnSpy,times(MiniDFSCluster.DIRS_PER_DATANODE)).blockReport(any(DatanodeRegistration.class),anyString(),captor.capture());
  verifyCapturedArguments(captor,1,BLOCKS_IN_FILE);
}
