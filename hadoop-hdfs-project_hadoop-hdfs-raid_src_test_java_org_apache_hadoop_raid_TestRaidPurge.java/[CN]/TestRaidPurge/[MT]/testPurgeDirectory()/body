{
  long stripeLength=5;
  long blockSize=8192;
  long targetReplication=1;
  long metaReplication=1;
  int numBlock=9;
  createClusters(true);
  mySetup(targetReplication,metaReplication,stripeLength);
  Path dir=new Path("/user/dhruba/raidtest/");
  Path file1=new Path(dir + "/file1");
  RaidNode cnode=null;
  try {
    TestRaidNode.createOldFile(fileSys,file1,1,numBlock,blockSize);
    Configuration localConf=new Configuration(conf);
    localConf.set(RaidNode.RAID_LOCATION_KEY,"/destraid");
    cnode=RaidNode.createRaidNode(null,localConf);
    Path destPath=new Path("/destraid/user/dhruba/raidtest");
    TestRaidDfs.waitForFileRaided(LOG,fileSys,file1,destPath);
    assertTrue("Unable to delete original directory " + file1,fileSys.delete(file1.getParent(),true));
    LOG.info("deleted file " + file1);
    long start=Time.now();
    while (fileSys.exists(destPath) && Time.now() - start < 120000) {
      LOG.info("testPurgeDirectory waiting for parity files to be removed.");
      Thread.sleep(1000);
    }
    assertFalse(fileSys.exists(destPath));
  }
 catch (  Exception e) {
    LOG.info("testPurgeDirectory Exception " + e + StringUtils.stringifyException(e));
    throw e;
  }
 finally {
    if (cnode != null) {
      cnode.stop();
      cnode.join();
    }
    LOG.info("testPurgeDirectory delete file " + file1);
    fileSys.delete(file1,true);
    stopClusters();
  }
}
