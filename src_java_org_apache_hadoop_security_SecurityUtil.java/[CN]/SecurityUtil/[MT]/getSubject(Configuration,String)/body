{
  if (userName == null) {
    return null;
  }
  Set<Principal> principals=new HashSet<Principal>();
  User userPrincipal=new User(userName);
  principals.add(userPrincipal);
  List<String> groups=getUserToGroupsMappingService(conf).getGroups(userName);
  StringBuffer sb=new StringBuffer("Groups for '" + userName + "': <");
  for (  String group : groups) {
    Group groupPrincipal=new Group(group);
    principals.add(groupPrincipal);
    sb.append(group + " ");
  }
  sb.append(">");
  LOG.info(sb);
  UserGroupInformation ugi=new UnixUserGroupInformation(userName,groups.toArray(new String[groups.size()]));
  principals.add(ugi);
  Subject user=new Subject(false,principals,new HashSet<Object>(),new HashSet<Object>());
  return user;
}
