{
  if (principalConfig == null)   return null;
  String[] components=principalConfig.split("[/@]");
  if (components.length != 3) {
    throw new IOException("Kerberos service principal name isn't configured properly " + "(should have 3 parts): " + principalConfig);
  }
  if (components[1].equals(HOSTNAME_PATTERN)) {
    String fqdn=hostname;
    if (fqdn == null || fqdn.equals("") || fqdn.equals("0.0.0.0")) {
      fqdn=getLocalHostName();
    }
    return components[0] + "/" + fqdn+ "@"+ components[2];
  }
 else {
    return principalConfig;
  }
}
