{
  String fileName="testReadTraceHooks.dat";
  writeTestFile(fileName);
  long startTime=System.currentTimeMillis();
  TraceScope ts=Trace.startSpan("testReadTraceHooks",Sampler.ALWAYS);
  readTestFile(fileName);
  ts.close();
  long endTime=System.currentTimeMillis();
  String[] expectedSpanNames={"testReadTraceHooks","ClientProtocol#getBlockLocations","ClientNamenodeProtocol#getBlockLocations","OpReadBlockProto"};
  SetSpanReceiver.assertSpanNamesFound(expectedSpanNames);
  Map<String,List<Span>> map=SetSpanReceiver.getMap();
  Span s=map.get("testReadTraceHooks").get(0);
  Assert.assertNotNull(s);
  long spanStart=s.getStartTimeMillis();
  long spanEnd=s.getStopTimeMillis();
  Assert.assertTrue(spanStart - startTime < 100);
  Assert.assertTrue(spanEnd - endTime < 100);
  for (  Span span : SetSpanReceiver.getSpans()) {
    Assert.assertEquals(ts.getSpan().getTraceId(),span.getTraceId());
  }
  SetSpanReceiver.clear();
}
