{
  this.conf=builder.conf;
  journalCluster=new MiniJournalCluster.Builder(conf).format(true).build();
  URI journalURI=journalCluster.getQuorumJournalURI(NAMESERVICE);
  MiniDFSNNTopology topology=createDefaultTopology();
  initHAConf(journalURI,builder.conf);
  cluster=builder.dfsBuilder.nnTopology(topology).manageNameDfsSharedDirs(false).build();
  cluster.waitActive();
  cluster.shutdown();
  Configuration confNN0=cluster.getConfiguration(0);
  NameNode.initializeSharedEdits(confNN0,true);
  cluster.getNameNodeInfos()[0].setStartOpt(builder.startOpt);
  cluster.getNameNodeInfos()[1].setStartOpt(builder.startOpt);
  cluster.restartNameNodes();
}
