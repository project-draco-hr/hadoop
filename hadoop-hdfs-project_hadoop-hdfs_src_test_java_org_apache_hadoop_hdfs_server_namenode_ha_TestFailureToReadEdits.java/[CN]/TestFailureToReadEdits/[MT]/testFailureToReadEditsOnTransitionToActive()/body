{
  assertTrue(fs.mkdirs(new Path(TEST_DIR1)));
  HATestUtil.waitForStandbyToCatchUp(nn0,nn1);
  HATestUtil.waitForCheckpoint(cluster,0,ImmutableList.of(0,3));
  causeFailureOnEditLogRead();
  assertTrue(fs.mkdirs(new Path(TEST_DIR2)));
  assertTrue(fs.mkdirs(new Path(TEST_DIR3)));
  try {
    HATestUtil.waitForStandbyToCatchUp(nn0,nn1);
    fail("Standby fully caught up, but should not have been able to");
  }
 catch (  HATestUtil.CouldNotCatchUpException e) {
  }
  cluster.shutdownNameNode(0);
  try {
    cluster.transitionToActive(1);
    fail("Standby transitioned to active, but should not have been able to");
  }
 catch (  ExitException ee) {
    GenericTestUtils.assertExceptionContains("Error replaying edit log",ee);
  }
}
