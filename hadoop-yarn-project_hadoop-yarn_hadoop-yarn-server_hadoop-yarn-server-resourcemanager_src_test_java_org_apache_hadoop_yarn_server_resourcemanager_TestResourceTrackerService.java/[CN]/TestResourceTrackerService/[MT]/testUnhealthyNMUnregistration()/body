{
  Configuration conf=new Configuration();
  rm=new MockRM(conf);
  rm.start();
  ResourceTrackerService resourceTrackerService=rm.getResourceTrackerService();
  MockNM nm1=rm.registerNode("host1:1234",5120);
  Assert.assertEquals(0,ClusterMetrics.getMetrics().getUnhealthyNMs());
  nm1.nodeHeartbeat(true);
  int shutdownNMsCount=ClusterMetrics.getMetrics().getNumShutdownNMs();
  nm1.nodeHeartbeat(false);
  checkUnhealthyNMCount(rm,nm1,true,1);
  UnRegisterNodeManagerRequest request=Records.newRecord(UnRegisterNodeManagerRequest.class);
  request.setNodeId(nm1.getNodeId());
  resourceTrackerService.unRegisterNodeManager(request);
  checkShutdownNMCount(rm,++shutdownNMsCount);
}
