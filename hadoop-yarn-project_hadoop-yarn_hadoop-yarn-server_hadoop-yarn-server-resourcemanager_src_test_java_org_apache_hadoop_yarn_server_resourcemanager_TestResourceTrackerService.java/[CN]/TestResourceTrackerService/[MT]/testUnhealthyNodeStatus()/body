{
  Configuration conf=new Configuration();
  conf.set(YarnConfiguration.RM_NODES_EXCLUDE_FILE_PATH,hostFile.getAbsolutePath());
  rm=new MockRM(conf);
  rm.start();
  MockNM nm1=rm.registerNode("host1:1234",5120);
  Assert.assertEquals(0,ClusterMetrics.getMetrics().getUnhealthyNMs());
  nm1.nodeHeartbeat(true);
  nm1.nodeHeartbeat(false);
  checkUnealthyNMCount(rm,nm1,true,1);
  nm1.nodeHeartbeat(true);
  checkUnealthyNMCount(rm,nm1,false,0);
}
