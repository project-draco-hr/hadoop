{
  Configuration conf=new Configuration();
  rm=new MockRM(conf);
  rm.start();
  ResourceTrackerService resourceTrackerService=rm.getResourceTrackerService();
  MockNM nm1=rm.registerNode("host1:1234",5120);
  int shutdownNMsCount=ClusterMetrics.getMetrics().getNumShutdownNMs();
  NodeHeartbeatResponse nodeHeartbeat=nm1.nodeHeartbeat(true);
  Assert.assertTrue(NodeAction.NORMAL.equals(nodeHeartbeat.getNodeAction()));
  UnRegisterNodeManagerRequest request=Records.newRecord(UnRegisterNodeManagerRequest.class);
  request.setNodeId(nm1.getNodeId());
  resourceTrackerService.unRegisterNodeManager(request);
  checkShutdownNMCount(rm,++shutdownNMsCount);
  nodeHeartbeat=nm1.nodeHeartbeat(true);
  Assert.assertTrue(NodeAction.RESYNC.equals(nodeHeartbeat.getNodeAction()));
}
