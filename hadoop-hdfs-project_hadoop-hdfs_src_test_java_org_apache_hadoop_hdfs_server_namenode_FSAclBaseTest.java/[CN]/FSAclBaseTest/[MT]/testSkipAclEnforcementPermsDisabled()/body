{
  Path bruceDir=new Path(path,"bruce");
  Path bruceFile=new Path(bruceDir,"file");
  fs.mkdirs(bruceDir);
  fs.setOwner(bruceDir,"bruce",null);
  fsAsBruce.create(bruceFile).close();
  fsAsBruce.modifyAclEntries(bruceFile,Lists.newArrayList(aclEntry(ACCESS,USER,"diana",NONE)));
  assertFilePermissionDenied(fsAsDiana,DIANA,bruceFile);
  try {
    conf.setBoolean(DFSConfigKeys.DFS_PERMISSIONS_ENABLED_KEY,false);
    destroyFileSystems();
    restartCluster();
    initFileSystems();
    assertFilePermissionGranted(fsAsDiana,DIANA,bruceFile);
  }
  finally {
    conf.setBoolean(DFSConfigKeys.DFS_PERMISSIONS_ENABLED_KEY,true);
    restartCluster();
  }
}
