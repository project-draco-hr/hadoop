{
  try {
    ugi.reloginFromKeytab();
    return ugi.doAs(new PrivilegedExceptionAction<Token<?>>(){
      public Token<?> run() throws IOException {
        final String nnHttpUrl=nnSecureUri.toString();
        Credentials c;
        try {
          c=DelegationTokenFetcher.getDTfromRemote(nnHttpUrl,renewer);
        }
 catch (        Exception e) {
          LOG.info("Couldn't get a delegation token from " + nnHttpUrl + " using http.");
          if (LOG.isDebugEnabled()) {
            LOG.debug("error was ",e);
          }
          return null;
        }
        for (        Token<? extends TokenIdentifier> t : c.getAllTokens()) {
          if (LOG.isDebugEnabled()) {
            LOG.debug("Got dt for " + getUri() + ";t.service="+ t.getService());
          }
          return t;
        }
        return null;
      }
    }
);
  }
 catch (  InterruptedException e) {
    throw new RuntimeException(e);
  }
}
