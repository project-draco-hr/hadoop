{
  final List<StorageReceivedDeletedBlocks> reports=new ArrayList<>(pendingIBRs.size());
  for (  Map.Entry<DatanodeStorage,PerStorageIBR> entry : pendingIBRs.entrySet()) {
    final PerStorageIBR perStorage=entry.getValue();
    final ReceivedDeletedBlockInfo[] rdbi=perStorage.removeAll();
    if (rdbi != null) {
      reports.add(new StorageReceivedDeletedBlocks(entry.getKey(),rdbi));
    }
  }
  readyToSend=false;
  return reports.toArray(new StorageReceivedDeletedBlocks[reports.size()]);
}
