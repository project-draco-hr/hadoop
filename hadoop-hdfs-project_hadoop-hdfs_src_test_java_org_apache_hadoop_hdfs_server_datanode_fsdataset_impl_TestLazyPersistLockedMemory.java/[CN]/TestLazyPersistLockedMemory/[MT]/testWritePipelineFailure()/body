{
  getClusterBuilder().setNumDatanodes(1).build();
  final String METHOD_NAME=GenericTestUtils.getMethodName();
  final FsDatasetSpi<?> fsd=cluster.getDataNodes().get(0).getFSDataset();
  Path path=new Path("/" + METHOD_NAME + ".dat");
  EnumSet<CreateFlag> createFlags=EnumSet.of(CREATE,LAZY_PERSIST);
  final FSDataOutputStream fos=fs.create(path,FsPermission.getFileDefault(),createFlags,BUFFER_LENGTH,REPL_FACTOR,BLOCK_SIZE,null);
  fos.write(new byte[1]);
  fos.hsync();
  DFSTestUtil.abortStream((DFSOutputStream)fos.getWrappedStream());
  waitForLockedBytesUsed(fsd,osPageSize);
  fs.delete(path,false);
  DataNodeTestUtils.triggerBlockReport(cluster.getDataNodes().get(0));
  waitForLockedBytesUsed(fsd,0);
}
