{
  getClusterBuilder().setNumDatanodes(1).setMaxLockedMemory(BLOCK_SIZE).setRamDiskReplicaCapacity(BLOCK_SIZE * 2 - 1).build();
  final String METHOD_NAME=GenericTestUtils.getMethodName();
  final FsDatasetImpl fsd=(FsDatasetImpl)cluster.getDataNodes().get(0).getFSDataset();
  Path path1=new Path("/" + METHOD_NAME + ".01.dat");
  makeTestFile(path1,BLOCK_SIZE,true);
  assertThat(fsd.getCacheUsed(),is((long)BLOCK_SIZE));
  waitForMetric("RamDiskBlocksLazyPersisted",1);
  fsd.evictLazyPersistBlocks(Long.MAX_VALUE);
  verifyRamDiskJMXMetric("RamDiskBlocksEvicted",1);
  waitForLockedBytesUsed(fsd,0);
}
