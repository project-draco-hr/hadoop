{
  LocalDatanodeInfo localDatanodeInfo=getLocalDatanodeInfo(node.getIpcPort());
  BlockLocalPathInfo pathinfo=null;
  ClientDatanodeProtocol proxy=localDatanodeInfo.getDatanodeProxy(ugi,node,conf,timeout,connectToDnViaHostname);
  try {
    pathinfo=proxy.getBlockLocalPathInfo(blk,token);
    if (pathinfo != null && !storageType.isTransient()) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Cached location of block " + blk + " as "+ pathinfo);
      }
      localDatanodeInfo.setBlockLocalPathInfo(blk,pathinfo);
    }
  }
 catch (  IOException e) {
    localDatanodeInfo.resetDatanodeProxy();
    throw e;
  }
  return pathinfo;
}
