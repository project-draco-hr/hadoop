{
  try {
    FileType type=getFileType(srcPath);
    if (type == FileType.NOT_RAID) {
      return defaultPolicy.chooseTarget(srcPath,numOfReplicas,writer,chosenNodes,blocksize);
    }
    if (excludedNodes == null) {
      excludedNodes=new HashMap<Node,Node>();
    }
    addExcludedNodes(srcPath,type,excludedNodes);
    DatanodeDescriptor[] result=defaultPolicy.chooseTarget(numOfReplicas,writer,chosenNodes,returnChosenNodes,excludedNodes,blocksize);
    cachedLocatedBlocks.get(srcPath).add(new LocatedBlock(new ExtendedBlock(),result));
    return result;
  }
 catch (  Exception e) {
    LOG.debug("Error happend when choosing datanode to write:" + StringUtils.stringifyException(e));
    return defaultPolicy.chooseTarget(srcPath,numOfReplicas,writer,chosenNodes,blocksize);
  }
}
