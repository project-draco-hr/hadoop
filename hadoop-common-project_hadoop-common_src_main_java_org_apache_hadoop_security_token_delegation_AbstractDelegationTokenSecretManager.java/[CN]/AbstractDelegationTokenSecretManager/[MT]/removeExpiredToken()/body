{
  long now=Time.now();
  Set<TokenIdent> expiredTokens=new HashSet<TokenIdent>();
synchronized (this) {
    Iterator<Map.Entry<TokenIdent,DelegationTokenInformation>> i=currentTokens.entrySet().iterator();
    while (i.hasNext()) {
      Map.Entry<TokenIdent,DelegationTokenInformation> entry=i.next();
      long renewDate=entry.getValue().getRenewDate();
      if (renewDate < now) {
        expiredTokens.add(entry.getKey());
        i.remove();
      }
    }
  }
  for (  TokenIdent ident : expiredTokens) {
    logExpireToken(ident);
  }
}
