{
  if (running) {
    throw new IOException("Can't add persisted delegation token to a running SecretManager.");
  }
  int keyId=identifier.getMasterKeyId();
  DelegationKey dKey=getDelegationKey(keyId);
  if (dKey == null) {
    LOG.warn("No KEY found for persisted identifier " + identifier.toString());
    return;
  }
  byte[] password=createPassword(identifier.getBytes(),dKey.getKey());
  int delegationTokenSeqNum=getDelegationTokenSeqNum();
  if (identifier.getSequenceNumber() > delegationTokenSeqNum) {
    setDelegationTokenSeqNum(identifier.getSequenceNumber());
  }
  if (getTokenInfo(identifier) == null) {
    storeToken(identifier,new DelegationTokenInformation(renewDate,password,getTrackingIdIfEnabled(identifier)));
  }
 else {
    throw new IOException("Same delegation token being added twice.");
  }
}
