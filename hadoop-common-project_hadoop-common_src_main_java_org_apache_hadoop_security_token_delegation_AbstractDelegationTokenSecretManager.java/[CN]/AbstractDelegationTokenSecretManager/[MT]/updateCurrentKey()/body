{
  LOG.info("Updating the current master key for generating delegation tokens");
  int newCurrentId;
synchronized (this) {
    newCurrentId=currentId + 1;
  }
  DelegationKey newKey=new DelegationKey(newCurrentId,System.currentTimeMillis() + keyUpdateInterval + tokenMaxLifetime,generateSecret());
  logUpdateMasterKey(newKey);
  storeNewMasterKey(newKey);
synchronized (this) {
    currentId=newKey.getKeyId();
    currentKey=newKey;
    allKeys.put(currentKey.getKeyId(),currentKey);
  }
}
