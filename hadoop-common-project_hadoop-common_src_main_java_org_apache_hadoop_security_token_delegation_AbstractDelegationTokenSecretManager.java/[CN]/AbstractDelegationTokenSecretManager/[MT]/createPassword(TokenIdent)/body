{
  int sequenceNum;
  long now=Time.now();
  sequenceNum=++delegationTokenSequenceNumber;
  identifier.setIssueDate(now);
  identifier.setMaxDate(now + tokenMaxLifetime);
  identifier.setMasterKeyId(currentId);
  identifier.setSequenceNumber(sequenceNum);
  LOG.info("Creating password for identifier: " + identifier);
  byte[] password=createPassword(identifier.getBytes(),currentKey.getKey());
  storeNewToken(identifier,now + tokenRenewInterval);
  currentTokens.put(identifier,new DelegationTokenInformation(now + tokenRenewInterval,password,getTrackingIdIfEnabled(identifier)));
  return password;
}
