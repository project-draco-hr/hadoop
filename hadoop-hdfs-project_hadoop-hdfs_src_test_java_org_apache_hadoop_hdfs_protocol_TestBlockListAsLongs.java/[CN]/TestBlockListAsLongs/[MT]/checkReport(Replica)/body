{
  Map<Long,Replica> expectedReplicas=new HashMap<>();
  for (  Replica replica : replicas) {
    expectedReplicas.put(replica.getBlockId(),replica);
  }
  expectedReplicas=Collections.unmodifiableMap(expectedReplicas);
  BlockListAsLongs blocks=BlockListAsLongs.encode(expectedReplicas.values());
  List<ByteString> buffers=blocks.getBlocksBuffers();
  List<Long> longs=new ArrayList<Long>();
  for (  long value : blocks.getBlockListAsLongs()) {
    longs.add(value);
  }
  BlockListAsLongs decodedBlocks=BlockListAsLongs.decodeBuffers(expectedReplicas.size(),buffers);
  checkReplicas(expectedReplicas,decodedBlocks);
  BlockListAsLongs decodedList=BlockListAsLongs.decodeLongs(longs);
  checkReplicas(expectedReplicas,decodedList);
  return blocks;
}
