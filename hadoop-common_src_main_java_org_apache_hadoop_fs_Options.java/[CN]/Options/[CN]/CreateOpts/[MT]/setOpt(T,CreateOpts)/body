{
  boolean alreadyInOpts=false;
  if (opts != null) {
    for (int i=0; i < opts.length; ++i) {
      if (opts[i].getClass() == newValue.getClass()) {
        if (alreadyInOpts)         throw new IllegalArgumentException("multiple opts varargs");
        alreadyInOpts=true;
        opts[i]=newValue;
      }
    }
  }
  CreateOpts[] resultOpt=opts;
  if (!alreadyInOpts) {
    CreateOpts[] newOpts=new CreateOpts[opts.length + 1];
    System.arraycopy(opts,0,newOpts,0,opts.length);
    newOpts[opts.length]=newValue;
    resultOpt=newOpts;
  }
  return resultOpt;
}
