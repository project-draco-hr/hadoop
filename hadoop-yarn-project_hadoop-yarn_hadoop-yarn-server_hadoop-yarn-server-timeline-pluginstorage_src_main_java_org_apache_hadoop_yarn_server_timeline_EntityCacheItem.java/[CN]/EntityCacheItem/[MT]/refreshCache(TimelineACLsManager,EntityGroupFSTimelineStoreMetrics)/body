{
  if (needRefresh()) {
    long startTime=Time.monotonicNow();
    if (!appLogs.isDone()) {
      appLogs.parseSummaryLogs();
    }
 else     if (appLogs.getDetailLogs().isEmpty()) {
      appLogs.scanForLogs();
    }
    if (!appLogs.getDetailLogs().isEmpty()) {
      if (store == null) {
        activeStores.getAndIncrement();
        store=new LevelDBCacheTimelineStore(groupId.toString(),"LeveldbCache." + groupId);
        store.init(config);
        store.start();
      }
 else {
        metrics.incrCacheStaleRefreshes();
      }
      try (TimelineDataManager tdm=new TimelineDataManager(store,aclManager)){
        tdm.init(config);
        tdm.start();
        appLogs.loadDetailLog(tdm,groupId);
      }
     }
    updateRefreshTimeToNow();
    metrics.addCacheRefreshTime(Time.monotonicNow() - startTime);
  }
 else {
    LOG.debug("Cache new enough, skip refreshing");
    metrics.incrNoRefreshCacheRead();
  }
  return store;
}
