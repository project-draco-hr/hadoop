{
  try {
    File dir=File.createTempFile("locations","new",baseDir);
    dir.delete();
    dir.mkdirs();
    for (    HadoopServer server : servers.values()) {
      server.storeSettingsToFile(new File(dir,server.getLocationName() + ".xml"));
    }
    FilenameFilter XMLFilter=new FilenameFilter(){
      public boolean accept(      File dir,      String name){
        String lower=name.toLowerCase();
        return lower.endsWith(".xml");
      }
    }
;
    File backup=new File(baseDir,"locations.backup");
    if (backup.exists()) {
      for (      File file : backup.listFiles(XMLFilter))       if (!file.delete())       throw new IOException("Unable to delete backup location file: " + file);
      if (!backup.delete())       throw new IOException("Unable to delete backup location directory: " + backup);
    }
    saveDir.renameTo(backup);
    dir.renameTo(saveDir);
  }
 catch (  IOException ioe) {
    ioe.printStackTrace();
    MessageDialog.openError(null,"Saving configuration of Hadoop locations failed",ioe.toString());
  }
}
