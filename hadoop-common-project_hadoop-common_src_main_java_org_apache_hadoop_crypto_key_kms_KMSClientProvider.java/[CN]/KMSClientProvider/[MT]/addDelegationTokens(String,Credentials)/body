{
  Token<?>[] tokens=null;
  Text dtService=getDelegationTokenService();
  Token<?> token=credentials.getToken(dtService);
  if (token == null) {
    URL url=createURL(null,null,null,null);
    DelegationTokenAuthenticatedURL authUrl=new DelegationTokenAuthenticatedURL(configurator);
    try {
      token=authUrl.getDelegationToken(url,authToken,renewer);
      if (token != null) {
        credentials.addToken(token.getService(),token);
        tokens=new Token<?>[]{token};
      }
 else {
        throw new IOException("Got NULL as delegation token");
      }
    }
 catch (    AuthenticationException ex) {
      throw new IOException(ex);
    }
  }
  return tokens;
}
