{
  long started=Time.now();
  long mustEnd=Time.now() + (long)(getWaitForRatio() * timeout);
  long lastEcho=0;
  try {
    long waiting=mustEnd - Time.now();
    System.out.println(MessageFormat.format("Waiting up to [{0}] msec",waiting));
    boolean eval;
    while (!(eval=predicate.evaluate()) && Time.now() < mustEnd) {
      if ((Time.now() - lastEcho) > 5000) {
        waiting=mustEnd - Time.now();
        System.out.println(MessageFormat.format("Waiting up to [{0}] msec",waiting));
        lastEcho=Time.now();
      }
      Thread.sleep(100);
    }
    if (!eval) {
      if (failIfTimeout) {
        Assert.fail(MessageFormat.format("Waiting timed out after [{0}] msec",timeout));
      }
 else {
        System.out.println(MessageFormat.format("Waiting timed out after [{0}] msec",timeout));
      }
    }
    return (eval) ? Time.now() - started : -1;
  }
 catch (  Exception ex) {
    throw new RuntimeException(ex);
  }
}
