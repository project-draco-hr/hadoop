{
  checkRequest(reqInfo);
  checkFormatted();
  if (startTxId == curSegmentTxId) {
    if (curSegment != null) {
      curSegment.close();
      curSegment=null;
    }
  }
  FileJournalManager.EditLogFile elf=fjm.getLogFile(startTxId);
  if (elf.isInProgress()) {
    LOG.info("Validating log about to be finalized: " + elf);
    elf.validateLog();
    Preconditions.checkState(elf.getLastTxId() == endTxId,"Trying to finalize log %s-%s, but current state of log" + "is %s",startTxId,endTxId,elf);
    fjm.finalizeLogSegment(startTxId,endTxId);
  }
 else {
    Preconditions.checkArgument(endTxId == elf.getLastTxId(),"Trying to re-finalize already finalized log " + elf + " with different endTxId "+ endTxId);
  }
}
