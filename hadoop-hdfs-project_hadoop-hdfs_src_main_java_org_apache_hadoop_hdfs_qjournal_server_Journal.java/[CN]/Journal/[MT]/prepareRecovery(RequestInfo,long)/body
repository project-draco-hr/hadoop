{
  checkRequest(reqInfo);
  PrepareRecoveryResponseProto.Builder builder=PrepareRecoveryResponseProto.newBuilder();
  PersistedRecoveryPaxosData previouslyAccepted=getPersistedPaxosData(segmentTxId);
  if (previouslyAccepted != null) {
    builder.setAcceptedInEpoch(previouslyAccepted.getAcceptedInEpoch()).setSegmentState(previouslyAccepted.getSegmentState());
  }
 else {
    SegmentStateProto segInfo=getSegmentInfo(segmentTxId);
    if (segInfo != null) {
      builder.setSegmentState(segInfo);
    }
  }
  PrepareRecoveryResponseProto resp=builder.build();
  LOG.info("Prepared recovery for segment " + segmentTxId + ": "+ TextFormat.shortDebugString(resp));
  return resp;
}
