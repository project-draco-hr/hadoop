{
  checkFormatted();
  storage.checkConsistentNamespace(nsInfo);
  if (epoch <= getLastPromisedEpoch()) {
    throw new IOException("Proposed epoch " + epoch + " <= last promise "+ getLastPromisedEpoch());
  }
  lastPromisedEpoch.set(epoch);
  abortCurSegment();
  NewEpochResponseProto.Builder builder=NewEpochResponseProto.newBuilder();
  EditLogFile latestFile=scanStorageForLatestEdits();
  if (latestFile != null) {
    builder.setLastSegmentTxId(latestFile.getFirstTxId());
  }
  return builder.build();
}
