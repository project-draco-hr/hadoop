{
  long oldCTime=storage.getCTime();
  storage.cTime=sInfo.cTime;
  int oldLV=storage.getLayoutVersion();
  storage.layoutVersion=sInfo.layoutVersion;
  LOG.info("Starting upgrade of edits directory: " + ".\n   old LV = " + oldLV + "; old CTime = "+ oldCTime+ ".\n   new LV = "+ storage.getLayoutVersion()+ "; new CTime = "+ storage.getCTime());
  storage.getJournalManager().doUpgrade(storage);
  storage.createPaxosDir();
  File currentDir=storage.getSingularStorageDir().getCurrentDir();
  File previousDir=storage.getSingularStorageDir().getPreviousDir();
  PersistentLongFile prevLastPromisedEpoch=new PersistentLongFile(new File(previousDir,LAST_PROMISED_FILENAME),0);
  PersistentLongFile prevLastWriterEpoch=new PersistentLongFile(new File(previousDir,LAST_WRITER_EPOCH),0);
  lastPromisedEpoch=new PersistentLongFile(new File(currentDir,LAST_PROMISED_FILENAME),0);
  lastWriterEpoch=new PersistentLongFile(new File(currentDir,LAST_WRITER_EPOCH),0);
  lastPromisedEpoch.set(prevLastPromisedEpoch.get());
  lastWriterEpoch.set(prevLastWriterEpoch.get());
}
