{
  checkFormatted();
  checkWriteRequest(reqInfo);
  Preconditions.checkState(curSegment != null,"Can't write, no segment open");
  if (curSegmentTxId != segmentTxId) {
    curSegment.abort();
    curSegment=null;
    throw new IllegalStateException("Writer out of sync: it thinks it is writing segment " + segmentTxId + " but current segment is "+ curSegmentTxId);
  }
  Preconditions.checkState(nextTxId == firstTxnId,"Can't write txid " + firstTxnId + " expecting nextTxId="+ nextTxId);
  if (LOG.isTraceEnabled()) {
    LOG.trace("Writing txid " + firstTxnId + "-"+ (firstTxnId + numTxns - 1));
  }
  curSegment.writeRaw(records,0,records.length);
  curSegment.setReadyToFlush();
  curSegment.flush();
  nextTxId+=numTxns;
}
