{
  conf=createConfiguration();
  ReservationSystemTestUtil.setupFSAllocationFile(ALLOC_FILE);
  ReservationSystemTestUtil testUtil=new ReservationSystemTestUtil();
  rmContext=TestUtils.getMockRMContext();
  spyRMContext=spy(rmContext);
  fs=ReservationSystemTestUtil.setupFairScheduler(testUtil,spyRMContext,conf,125);
  scheduler=fs;
  ConcurrentMap<ApplicationId,RMApp> spyApps=spy(new ConcurrentHashMap<ApplicationId,RMApp>());
  RMApp rmApp=mock(RMApp.class);
  when(rmApp.getRMAppAttempt((ApplicationAttemptId)Matchers.any())).thenReturn(null);
  Mockito.doReturn(rmApp).when(spyApps).get((ApplicationId)Matchers.any());
  when(spyRMContext.getRMApps()).thenReturn(spyApps);
  ReservationSystemTestUtil.setupFSAllocationFile(ALLOC_FILE);
  setupPlanFollower();
}
