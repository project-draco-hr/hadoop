{
  this.rmProxy=rmProxy;
  this.protocol=protocol;
  this.rmProxy.checkAllowedProtocols(this.protocol);
  this.conf=new YarnConfiguration(configuration);
  Collection<String> rmIds=HAUtil.getRMHAIds(conf);
  this.rmServiceIds=rmIds.toArray(new String[rmIds.size()]);
  conf.set(YarnConfiguration.RM_HA_ID,rmServiceIds[currentProxyIndex]);
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECT_MAX_RETRIES_KEY,conf.getInt(YarnConfiguration.CLIENT_FAILOVER_RETRIES,YarnConfiguration.DEFAULT_CLIENT_FAILOVER_RETRIES));
  conf.setInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECT_MAX_RETRIES_ON_SOCKET_TIMEOUTS_KEY,conf.getInt(YarnConfiguration.CLIENT_FAILOVER_RETRIES_ON_SOCKET_TIMEOUTS,YarnConfiguration.DEFAULT_CLIENT_FAILOVER_RETRIES_ON_SOCKET_TIMEOUTS));
}
