{
  GetClusterNodesResponse response=recordFactory.newRecordInstance(GetClusterNodesResponse.class);
  EnumSet<NodeState> nodeStates=request.getNodeStates();
  if (nodeStates == null || nodeStates.isEmpty()) {
    nodeStates=EnumSet.allOf(NodeState.class);
  }
  Collection<RMNode> nodes=RMServerUtils.queryRMNodes(rmContext,nodeStates);
  List<NodeReport> nodeReports=new ArrayList<NodeReport>(nodes.size());
  for (  RMNode nodeInfo : nodes) {
    nodeReports.add(createNodeReports(nodeInfo));
  }
  response.setNodeReports(nodeReports);
  return response;
}
