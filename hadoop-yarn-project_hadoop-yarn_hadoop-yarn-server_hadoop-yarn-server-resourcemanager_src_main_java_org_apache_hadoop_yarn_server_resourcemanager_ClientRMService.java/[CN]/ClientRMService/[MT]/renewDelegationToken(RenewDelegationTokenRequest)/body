{
  try {
    if (!isAllowedDelegationTokenOp()) {
      throw new IOException("Delegation Token can be renewed only with kerberos authentication");
    }
    DelegationToken protoToken=request.getDelegationToken();
    Token<RMDelegationTokenIdentifier> token=new Token<RMDelegationTokenIdentifier>(protoToken.getIdentifier().array(),protoToken.getPassword().array(),new Text(protoToken.getKind()),new Text(protoToken.getService()));
    String user=UserGroupInformation.getCurrentUser().getShortUserName();
    long nextExpTime=rmDTSecretManager.renewToken(token,user);
    RenewDelegationTokenResponse renewResponse=Records.newRecord(RenewDelegationTokenResponse.class);
    renewResponse.setNextExpirationTime(nextExpTime);
    return renewResponse;
  }
 catch (  IOException e) {
    throw RPCUtil.getRemoteException(e);
  }
}
