{
  CapacitySchedulerConfiguration conf=new CapacitySchedulerConfiguration();
  ReservationSystemTestUtil.setupQueueConfiguration(conf);
  conf.setClass(YarnConfiguration.RM_SCHEDULER,CapacityScheduler.class,ResourceScheduler.class);
  conf.setBoolean(YarnConfiguration.RM_SCHEDULER_ENABLE_MONITORS,true);
  conf.set(YarnConfiguration.RM_SCHEDULER_MONITOR_POLICIES,"org.apache.hadoop.yarn.server.resourcemanager.monitor.capacity." + "ProportionalCapacityPreemptionPolicy");
  conf.setBoolean(YarnConfiguration.RM_SCHEDULER_ENABLE_MONITORS,true);
  conf.setBoolean("yarn.scheduler.capacity.root.a.a1.disable_preemption",true);
  MiniYARNCluster cluster=new MiniYARNCluster("testReservationAPIs",2,1,1);
  YarnClient yarnClient=null;
  try {
    cluster.init(conf);
    cluster.start();
    final Configuration yarnConf=cluster.getConfig();
    yarnClient=YarnClient.createYarnClient();
    yarnClient.init(yarnConf);
    yarnClient.start();
    QueueCLI cli=new QueueCLI();
    cli.setClient(yarnClient);
    cli.setSysOutPrintStream(sysOut);
    cli.setSysErrPrintStream(sysErr);
    sysOutStream.reset();
    int result=cli.run(new String[]{"-status","a1"});
    assertEquals(0,result);
    Assert.assertTrue(sysOutStream.toString().contains("Preemption : disabled"));
  }
  finally {
    if (yarnClient != null) {
      yarnClient.stop();
    }
    cluster.stop();
    cluster.close();
  }
}
