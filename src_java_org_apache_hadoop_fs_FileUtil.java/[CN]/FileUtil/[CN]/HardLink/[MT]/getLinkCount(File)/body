{
  if (!fileName.exists()) {
    throw new FileNotFoundException(fileName + " not found.");
  }
  int len=getLinkCountCommand.length;
  String[] cmd=new String[len + 1];
  for (int i=0; i < len; i++) {
    cmd[i]=getLinkCountCommand[i];
  }
  cmd[len]=fileName.toString();
  String inpMsg=null;
  String errMsg=null;
  int exitValue=-1;
  BufferedReader in=null;
  BufferedReader err=null;
  Process process=Runtime.getRuntime().exec(cmd);
  try {
    exitValue=process.waitFor();
    in=new BufferedReader(new InputStreamReader(process.getInputStream()));
    inpMsg=in.readLine();
    err=new BufferedReader(new InputStreamReader(process.getErrorStream()));
    errMsg=err.readLine();
    if (inpMsg == null || exitValue != 0) {
      throw createIOException(fileName,inpMsg,errMsg,exitValue,null);
    }
    if (getOSType() == OSType.OS_TYPE_SOLARIS) {
      String[] result=inpMsg.split("\\s+");
      return Integer.parseInt(result[1]);
    }
 else {
      return Integer.parseInt(inpMsg);
    }
  }
 catch (  NumberFormatException e) {
    throw createIOException(fileName,inpMsg,errMsg,exitValue,e);
  }
catch (  InterruptedException e) {
    throw createIOException(fileName,inpMsg,errMsg,exitValue,e);
  }
 finally {
    process.destroy();
    if (in != null)     in.close();
    if (err != null)     err.close();
  }
}
