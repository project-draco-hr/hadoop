{
  int len=hardLinkCommand.length;
  if (osType == OSType.OS_TYPE_WINXP) {
    hardLinkCommand[len - 1]=target.getCanonicalPath();
    hardLinkCommand[len - 2]=linkName.getCanonicalPath();
  }
 else {
    hardLinkCommand[len - 2]=makeShellPath(target,true);
    hardLinkCommand[len - 1]=makeShellPath(linkName,true);
  }
  Process process=Runtime.getRuntime().exec(hardLinkCommand);
  try {
    if (process.waitFor() != 0) {
      String errMsg=new BufferedReader(new InputStreamReader(process.getInputStream())).readLine();
      if (errMsg == null)       errMsg="";
      String inpMsg=new BufferedReader(new InputStreamReader(process.getErrorStream())).readLine();
      if (inpMsg == null)       inpMsg="";
      throw new IOException(errMsg + inpMsg);
    }
  }
 catch (  InterruptedException e) {
    throw new IOException(StringUtils.stringifyException(e));
  }
 finally {
    process.destroy();
  }
}
