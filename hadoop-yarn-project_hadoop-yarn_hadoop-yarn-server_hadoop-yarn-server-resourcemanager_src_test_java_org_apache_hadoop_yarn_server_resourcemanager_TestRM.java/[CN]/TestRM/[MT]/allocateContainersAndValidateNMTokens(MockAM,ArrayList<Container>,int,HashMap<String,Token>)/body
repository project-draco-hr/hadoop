{
  ArrayList<ContainerId> releaseContainerList=new ArrayList<ContainerId>();
  AllocateResponse response;
  ArrayList<ResourceRequest> resourceRequest=new ArrayList<ResourceRequest>();
  while (containersReceived.size() < totalContainerRequested) {
    LOG.info("requesting containers..");
    response=am.allocate(resourceRequest,releaseContainerList);
    containersReceived.addAll(response.getAllocatedContainers());
    if (!response.getNMTokens().isEmpty()) {
      for (      NMToken nmToken : response.getNMTokens()) {
        String nodeId=nmToken.getNodeId().toString();
        if (nmTokens.containsKey(nodeId)) {
          Assert.fail("Duplicate NMToken received for : " + nodeId);
        }
        nmTokens.put(nodeId,nmToken.getToken());
      }
    }
    LOG.info("Got " + containersReceived.size() + " containers. Waiting to get "+ totalContainerRequested);
    Thread.sleep(500);
  }
}
