{
  YarnConfiguration conf=new YarnConfiguration();
  MockRM rm1=new MockRM(conf);
  rm1.start();
  RMApp app1=rm1.submitApp(200);
  RMApp app2=rm1.submitApp(200);
  RMAppAttempt attempt1=app1.getCurrentAppAttempt();
  ApplicationAttemptId attemptId1=attempt1.getAppAttemptId();
  rm1.waitForState(attemptId1,RMAppAttemptState.SCHEDULED);
  RMAppAttempt attempt2=app2.getCurrentAppAttempt();
  ApplicationAttemptId attemptId2=attempt2.getAppAttemptId();
  rm1.waitForState(attemptId2,RMAppAttemptState.SCHEDULED);
  MockNM nm1=new MockNM("h1:1234",15120,rm1.getResourceTrackerService());
  MockNM nm2=new MockNM("h2:5678",15120,rm1.getResourceTrackerService());
  nm1.registerNode();
  nm2.registerNode();
  nm1.nodeHeartbeat(true);
  rm1.waitForState(attemptId1,RMAppAttemptState.ALLOCATED);
  rm1.waitForState(attemptId2,RMAppAttemptState.SCHEDULED);
  nm2.nodeHeartbeat(true);
  rm1.waitForState(attemptId1,RMAppAttemptState.ALLOCATED);
  rm1.waitForState(attemptId2,RMAppAttemptState.ALLOCATED);
  rm1.stop();
}
