{
  BlockManager bm0=nn.getNamesystem().getBlockManager();
  BlockInfo storedBlock=bm0.getStoredBlock(blk.getLocalBlock());
  assertTrue("Block " + blk + " should be under construction, "+ "got: "+ storedBlock,storedBlock instanceof BlockInfoUnderConstruction);
  BlockInfoUnderConstruction ucBlock=(BlockInfoUnderConstruction)storedBlock;
  DatanodeDescriptor[] datanodes=ucBlock.getExpectedLocations();
  DatanodeDescriptor expectedPrimary=datanodes[0];
  long mostRecentLastUpdate=expectedPrimary.getLastUpdate();
  for (int i=1; i < datanodes.length; i++) {
    if (datanodes[i].getLastUpdate() > mostRecentLastUpdate) {
      expectedPrimary=datanodes[i];
      mostRecentLastUpdate=expectedPrimary.getLastUpdate();
    }
  }
  return expectedPrimary;
}
