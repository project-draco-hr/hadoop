{
  HAStressTestHarness harness=new HAStressTestHarness();
  harness.conf.setBoolean(DFSConfigKeys.DFS_PERMISSIONS_ENABLED_KEY,false);
  harness.conf.setInt(DFSConfigKeys.DFS_CLIENT_FAILOVER_SLEEPTIME_MAX_KEY,1000);
  final MiniDFSCluster cluster=harness.startCluster();
  try {
    cluster.waitActive();
    cluster.transitionToActive(0);
    FileSystem fs=harness.getFailoverFs();
    DistributedFileSystem fsAsOtherUser=createFsAsOtherUser(cluster,harness.conf);
    TestContext testers=new TestContext();
    for (int i=0; i < STRESS_NUM_THREADS; i++) {
      Path p=new Path("/test-" + i);
      testers.addThread(new PipelineTestThread(testers,fs,fsAsOtherUser,p));
    }
    harness.addReplicationTriggerThread(500);
    harness.addFailoverThread(5000);
    harness.startThreads();
    testers.startThreads();
    testers.waitFor(STRESS_RUNTIME);
    testers.stop();
    harness.stopThreads();
  }
  finally {
    System.err.println("===========================\n\n\n\n");
    harness.shutdown();
  }
}
