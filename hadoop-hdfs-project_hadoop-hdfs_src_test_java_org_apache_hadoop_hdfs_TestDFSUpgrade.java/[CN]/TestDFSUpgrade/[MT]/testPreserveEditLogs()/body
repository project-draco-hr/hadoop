{
  conf=new HdfsConfiguration();
  conf=UpgradeUtilities.initializeStorageStateConf(1,conf);
  String[] nameNodeDirs=conf.getStrings(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY);
  conf.setBoolean(DFSConfigKeys.DFS_DATANODE_DUPLICATE_REPLICA_DELETION,false);
  log("Normal NameNode upgrade",1);
  File[] created=UpgradeUtilities.createNameNodeStorageDirs(nameNodeDirs,"current");
  List<String> beforeUpgrade=new LinkedList<>();
  for (  final File createdDir : created) {
    List<String> fileNameList=IOUtils.listDirectory(createdDir,EditLogsFilter.INSTANCE);
    beforeUpgrade.addAll(fileNameList);
  }
  cluster=createCluster();
  List<String> afterUpgrade=new LinkedList<>();
  for (  final File createdDir : created) {
    List<String> fileNameList=IOUtils.listDirectory(createdDir,EditLogsFilter.INSTANCE);
    afterUpgrade.addAll(fileNameList);
  }
  for (  String s : beforeUpgrade) {
    assertTrue(afterUpgrade.contains(s));
  }
  cluster.shutdown();
  UpgradeUtilities.createEmptyDirs(nameNodeDirs);
}
