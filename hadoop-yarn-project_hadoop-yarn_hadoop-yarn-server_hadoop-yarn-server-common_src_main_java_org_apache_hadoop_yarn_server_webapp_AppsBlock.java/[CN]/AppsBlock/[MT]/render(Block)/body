{
  setTitle("Applications");
  TBODY<TABLE<Hamlet>> tbody=html.table("#apps").thead().tr().th(".id","ID").th(".user","User").th(".name","Name").th(".type","Application Type").th(".queue","Queue").th(".starttime","StartTime").th(".finishtime","FinishTime").th(".state","State").th(".finalstatus","FinalStatus").th(".progress","Progress").th(".ui","Tracking UI")._()._().tbody();
  EnumSet<YarnApplicationState> reqAppStates=EnumSet.noneOf(YarnApplicationState.class);
  String reqStateString=$(APP_STATE);
  if (reqStateString != null && !reqStateString.isEmpty()) {
    String[] appStateStrings=reqStateString.split(",");
    for (    String stateString : appStateStrings) {
      reqAppStates.add(YarnApplicationState.valueOf(stateString.trim()));
    }
  }
  UserGroupInformation callerUGI=getCallerUGI();
  Collection<ApplicationReport> appReports=null;
  try {
    final GetApplicationsRequest request=GetApplicationsRequest.newInstance(reqAppStates);
    if (callerUGI == null) {
      appReports=appBaseProt.getApplications(request).getApplicationList();
    }
 else {
      appReports=callerUGI.doAs(new PrivilegedExceptionAction<Collection<ApplicationReport>>(){
        @Override public Collection<ApplicationReport> run() throws Exception {
          return appBaseProt.getApplications(request).getApplicationList();
        }
      }
);
    }
  }
 catch (  Exception e) {
    String message="Failed to read the applications.";
    LOG.error(message,e);
    html.p()._(message)._();
    return;
  }
  StringBuilder appsTableData=new StringBuilder("[\n");
  for (  ApplicationReport appReport : appReports) {
    if (!reqAppStates.isEmpty() && !reqAppStates.contains(appReport.getYarnApplicationState())) {
      continue;
    }
    AppInfo app=new AppInfo(appReport);
    String percent=String.format("%.1f",app.getProgress());
    appsTableData.append("[\"<a href='").append(url("app",app.getAppId())).append("'>").append(app.getAppId()).append("</a>\",\"").append(StringEscapeUtils.escapeJavaScript(StringEscapeUtils.escapeHtml(app.getUser()))).append("\",\"").append(StringEscapeUtils.escapeJavaScript(StringEscapeUtils.escapeHtml(app.getName()))).append("\",\"").append(StringEscapeUtils.escapeJavaScript(StringEscapeUtils.escapeHtml(app.getType()))).append("\",\"").append(StringEscapeUtils.escapeJavaScript(StringEscapeUtils.escapeHtml(app.getQueue()))).append("\",\"").append(app.getStartedTime()).append("\",\"").append(app.getFinishedTime()).append("\",\"").append(app.getAppState() == null ? UNAVAILABLE : app.getAppState()).append("\",\"").append(app.getFinalAppStatus()).append("\",\"").append("<br title='").append(percent).append("'> <div class='").append(C_PROGRESSBAR).append("' title='").append(join(percent,'%')).append("'> ").append("<div class='").append(C_PROGRESSBAR_VALUE).append("' style='").append(join("width:",percent,'%')).append("'> </div> </div>").append("\",\"<a ");
    String trackingURL=app.getTrackingUrl() == null || app.getTrackingUrl() == UNAVAILABLE ? null : app.getTrackingUrl();
    String trackingUI=app.getTrackingUrl() == null || app.getTrackingUrl() == UNAVAILABLE ? "Unassigned" : app.getAppState() == YarnApplicationState.FINISHED || app.getAppState() == YarnApplicationState.FAILED || app.getAppState() == YarnApplicationState.KILLED ? "History" : "ApplicationMaster";
    appsTableData.append(trackingURL == null ? "#" : "href='" + trackingURL).append("'>").append(trackingUI).append("</a>\"],\n");
  }
  if (appsTableData.charAt(appsTableData.length() - 2) == ',') {
    appsTableData.delete(appsTableData.length() - 2,appsTableData.length() - 1);
  }
  appsTableData.append("]");
  html.script().$type("text/javascript")._("var appsTableData=" + appsTableData)._();
  tbody._()._();
}
