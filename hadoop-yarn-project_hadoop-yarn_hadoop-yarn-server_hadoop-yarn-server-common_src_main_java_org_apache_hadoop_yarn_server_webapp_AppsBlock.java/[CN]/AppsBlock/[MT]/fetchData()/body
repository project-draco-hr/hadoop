{
  reqAppStates=EnumSet.noneOf(YarnApplicationState.class);
  String reqStateString=$(APP_STATE);
  if (reqStateString != null && !reqStateString.isEmpty()) {
    String[] appStateStrings=reqStateString.split(",");
    for (    String stateString : appStateStrings) {
      reqAppStates.add(YarnApplicationState.valueOf(stateString.trim()));
    }
  }
  callerUGI=getCallerUGI();
  final GetApplicationsRequest request=GetApplicationsRequest.newInstance(reqAppStates);
  String appsNumStr=$(APPS_NUM);
  if (appsNumStr != null && !appsNumStr.isEmpty()) {
    long appsNum=Long.parseLong(appsNumStr);
    request.setLimit(appsNum);
  }
  if (callerUGI == null) {
    appReports=appBaseProt.getApplications(request).getApplicationList();
  }
 else {
    appReports=callerUGI.doAs(new PrivilegedExceptionAction<Collection<ApplicationReport>>(){
      @Override public Collection<ApplicationReport> run() throws Exception {
        return appBaseProt.getApplications(request).getApplicationList();
      }
    }
);
  }
}
