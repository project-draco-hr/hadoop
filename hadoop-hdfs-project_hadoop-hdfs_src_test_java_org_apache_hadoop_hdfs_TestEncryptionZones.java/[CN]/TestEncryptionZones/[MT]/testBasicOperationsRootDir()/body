{
  int numZones=0;
  final Path rootDir=new Path("/");
  final Path zone1=new Path(rootDir,"zone1");
  dfsAdmin.createEncryptionZone(rootDir,TEST_KEY);
  assertNumZones(++numZones);
  assertZonePresent(null,rootDir.toString());
  fsWrapper.mkdir(zone1,FsPermission.getDirDefault(),true);
  try {
    dfsAdmin.createEncryptionZone(zone1,TEST_KEY);
    fail("EZ over an EZ");
  }
 catch (  IOException e) {
    assertExceptionContains("already in an encryption zone",e);
  }
  fs.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
  fs.saveNamespace();
  fs.setSafeMode(SafeModeAction.SAFEMODE_LEAVE);
  cluster.restartNameNode(true);
  assertNumZones(numZones);
  assertZonePresent(null,rootDir.toString());
  try {
    dfsAdmin.createEncryptionZone(zone1,TEST_KEY);
    fail("EZ over an EZ");
  }
 catch (  IOException e) {
    assertExceptionContains("already in an encryption zone",e);
  }
}
