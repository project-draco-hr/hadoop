{
  conf=new HdfsConfiguration();
  fsHelper=new FileSystemTestHelper();
  String testRoot=fsHelper.getTestRootDir();
  testRootDir=new File(testRoot).getAbsoluteFile();
  final Path jksPath=new Path(testRootDir.toString(),"test.jks");
  conf.set(KeyProviderFactory.KEY_PROVIDER_PATH,JavaKeyStoreProvider.SCHEME_NAME + "://file" + jksPath.toUri());
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_DELEGATION_TOKEN_ALWAYS_USE_KEY,true);
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_LIST_ENCRYPTION_ZONES_NUM_RESPONSES,2);
  cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  Logger.getLogger(EncryptionZoneManager.class).setLevel(Level.TRACE);
  fs=cluster.getFileSystem();
  fsWrapper=new FileSystemTestWrapper(fs);
  fcWrapper=new FileContextTestWrapper(FileContext.getFileContext(cluster.getURI(),conf));
  dfsAdmin=new HdfsAdmin(cluster.getURI(),conf);
  fs.getClient().provider=cluster.getNameNode().getNamesystem().getProvider();
  DFSTestUtil.createKey(TEST_KEY,cluster,conf);
}
