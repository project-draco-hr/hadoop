{
  while (true) {
    try {
      return getBlockReader(targetBlock,offsetInBlock,length,targetAddr,storageType,datanode);
    }
 catch (    IOException e) {
      if (e instanceof InvalidEncryptionKeyException && retry.shouldRefetchEncryptionKey()) {
        DFSClient.LOG.info("Will fetch a new encryption key and retry, " + "encryption key was invalid when connecting to " + targetAddr + " : "+ e);
        dfsClient.clearDataEncryptionKey();
        retry.refetchEncryptionKey();
      }
 else       if (retry.shouldRefetchToken() && tokenRefetchNeeded(e,targetAddr)) {
        fetchBlockAt(offsetInFile);
        retry.refetchToken();
      }
 else {
        DFSClient.LOG.warn("Failed to connect to " + targetAddr + " for block"+ ", add to deadNodes and continue.",e);
        addToDeadNodes(datanode);
        return null;
      }
    }
  }
}
