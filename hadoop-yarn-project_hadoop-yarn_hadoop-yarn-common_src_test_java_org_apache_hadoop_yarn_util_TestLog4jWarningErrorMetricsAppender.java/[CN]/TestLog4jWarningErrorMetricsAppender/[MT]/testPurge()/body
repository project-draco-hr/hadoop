{
  setupAppender(2,1,1);
  logMessages(Level.ERROR,"test message 1",1);
  cutoff.clear();
  cutoff.add(0L);
  Assert.assertEquals(1,appender.getErrorCounts(cutoff).size());
  Assert.assertEquals(1,appender.getErrorCounts(cutoff).get(0).longValue());
  Assert.assertEquals(1,appender.getErrorMessagesAndCounts(cutoff).get(0).size());
  Thread.sleep(2000);
  Assert.assertEquals(1,appender.getErrorCounts(cutoff).size());
  Assert.assertEquals(0,appender.getErrorCounts(cutoff).get(0).longValue());
  Assert.assertEquals(0,appender.getErrorMessagesAndCounts(cutoff).get(0).size());
  setupAppender(2,1000,2);
  logMessages(Level.ERROR,"test message 1",3);
  logMessages(Level.ERROR,"test message 2",2);
  Assert.assertEquals(1,appender.getErrorCounts(cutoff).size());
  Assert.assertEquals(5,appender.getErrorCounts(cutoff).get(0).longValue());
  Assert.assertEquals(2,appender.getErrorMessagesAndCounts(cutoff).get(0).size());
  logMessages(Level.ERROR,"test message 3",3);
  Thread.sleep(2000);
  Assert.assertEquals(8,appender.getErrorCounts(cutoff).get(0).longValue());
  Assert.assertEquals(2,appender.getErrorMessagesAndCounts(cutoff).get(0).size());
}
