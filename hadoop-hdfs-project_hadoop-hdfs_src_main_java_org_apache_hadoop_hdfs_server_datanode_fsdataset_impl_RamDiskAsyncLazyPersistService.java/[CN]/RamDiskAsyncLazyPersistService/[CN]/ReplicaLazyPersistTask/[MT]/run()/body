{
  boolean succeeded=false;
  final FsDatasetImpl dataset=(FsDatasetImpl)datanode.getFSDataset();
  try (FsVolumeReference ref=this.targetVolume){
    int smallBufferSize=DFSUtil.getSmallBufferSize(EMPTY_HDFS_CONF);
    File targetFiles[]=FsDatasetImpl.copyBlockFiles(blockId,genStamp,metaFile,blockFile,lazyPersistDir,true,smallBufferSize);
    dataset.onCompleteLazyPersist(bpId,blockId,creationTime,targetFiles,(FsVolumeImpl)ref.getVolume());
    succeeded=true;
  }
 catch (  Exception e) {
    FsDatasetImpl.LOG.warn("LazyWriter failed to async persist RamDisk block pool id: " + bpId + "block Id: "+ blockId,e);
  }
 finally {
    if (!succeeded) {
      dataset.onFailLazyPersist(bpId,blockId);
    }
  }
}
