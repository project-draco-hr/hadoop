{
  ApplicationAttemptId attemptId=ConverterUtils.toApplicationAttemptId(attemptIdStr);
  Credentials credentials=null;
  if (attemptStateData.getAppAttemptTokens() != null) {
    DataInputByteBuffer dibb=new DataInputByteBuffer();
    credentials=new Credentials();
    dibb.reset(attemptStateData.getAppAttemptTokens());
    credentials.readTokenStorageStream(dibb);
  }
  ApplicationAttemptState updatedAttemptState=new ApplicationAttemptState(attemptId,attemptStateData.getMasterContainer(),credentials,attemptStateData.getStartTime(),attemptStateData.getState(),attemptStateData.getFinalTrackingUrl(),attemptStateData.getDiagnostics(),attemptStateData.getFinalApplicationStatus());
  ApplicationState appState=state.getApplicationState().get(updatedAttemptState.getAttemptId().getApplicationId());
  if (appState == null) {
    throw new YarnRuntimeException("Application doesn't exist");
  }
  LOG.info("Updating final state " + updatedAttemptState.getState() + " for attempt: "+ updatedAttemptState.getAttemptId());
  appState.attempts.put(updatedAttemptState.getAttemptId(),updatedAttemptState);
}
