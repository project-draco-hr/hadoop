{
  String dir=TestDirHelper.getTestDir().getAbsolutePath();
  String hadoopConfDir=new File(dir,"confx").getAbsolutePath();
  new File(hadoopConfDir).mkdirs();
  String services=StringUtils.join(",",Arrays.asList(InstrumentationService.class.getName(),SchedulerService.class.getName(),FileSystemAccessService.class.getName()));
  Configuration conf=new Configuration(false);
  conf.set("server.services",services);
  conf.set("server.hadoop.config.dir",hadoopConfDir);
  File hdfsSite=new File(hadoopConfDir,"hdfs-site.xml");
  OutputStream os=new FileOutputStream(hdfsSite);
  Configuration hadoopConf=new Configuration(false);
  hadoopConf.set("foo","BAR");
  hadoopConf.writeXml(os);
  os.close();
  Server server=new Server("server",dir,dir,dir,dir,conf);
  server.init();
  FileSystemAccessService fsAccess=(FileSystemAccessService)server.get(FileSystemAccess.class);
  Assert.assertEquals(fsAccess.serviceHadoopConf.get("foo"),"BAR");
  server.destroy();
}
