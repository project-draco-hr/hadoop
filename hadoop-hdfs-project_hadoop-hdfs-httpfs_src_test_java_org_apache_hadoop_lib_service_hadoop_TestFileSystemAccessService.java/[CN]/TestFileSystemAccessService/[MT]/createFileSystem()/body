{
  String dir=TestDirHelper.getTestDir().getAbsolutePath();
  String services=StringUtils.join(",",Arrays.asList(InstrumentationService.class.getName(),FileSystemAccessService.class.getName()));
  Configuration conf=new Configuration(false);
  conf.set("server.services",services);
  Server server=new Server("server",dir,dir,dir,dir,conf);
  server.init();
  FileSystemAccess hadoop=server.get(FileSystemAccess.class);
  FileSystem fs=hadoop.createFileSystem("u",TestHdfsHelper.getHdfsConf());
  Assert.assertNotNull(fs);
  fs.mkdirs(new Path("/tmp/foo"));
  hadoop.releaseFileSystem(fs);
  try {
    fs.mkdirs(new Path("/tmp/foo"));
    Assert.fail();
  }
 catch (  IOException ex) {
  }
catch (  Exception ex) {
    Assert.fail();
  }
  server.destroy();
}
