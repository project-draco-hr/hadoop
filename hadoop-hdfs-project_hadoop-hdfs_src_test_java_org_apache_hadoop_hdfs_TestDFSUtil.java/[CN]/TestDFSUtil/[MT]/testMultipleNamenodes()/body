{
  HdfsConfiguration conf=new HdfsConfiguration();
  conf.set(DFS_FEDERATION_NAMESERVICES,"nn1,nn2");
  final String NN1_ADDRESS="localhost:9000";
  final String NN2_ADDRESS="localhost:9001";
  final String NN3_ADDRESS="localhost:9002";
  conf.set(DFSUtil.addKeySuffixes(DFS_NAMENODE_RPC_ADDRESS_KEY,"nn1"),NN1_ADDRESS);
  conf.set(DFSUtil.addKeySuffixes(DFS_NAMENODE_RPC_ADDRESS_KEY,"nn2"),NN2_ADDRESS);
  Map<String,Map<String,InetSocketAddress>> nnMap=DFSUtil.getNNServiceRpcAddresses(conf);
  assertEquals(2,nnMap.size());
  Map<String,InetSocketAddress> nn1Map=nnMap.get("nn1");
  assertEquals(1,nn1Map.size());
  InetSocketAddress addr=nn1Map.get(null);
  assertEquals("localhost",addr.getHostName());
  assertEquals(9000,addr.getPort());
  Map<String,InetSocketAddress> nn2Map=nnMap.get("nn2");
  assertEquals(1,nn2Map.size());
  addr=nn2Map.get(null);
  assertEquals("localhost",addr.getHostName());
  assertEquals(9001,addr.getPort());
  checkNameServiceId(conf,NN1_ADDRESS,"nn1");
  checkNameServiceId(conf,NN2_ADDRESS,"nn2");
  checkNameServiceId(conf,NN3_ADDRESS,null);
  assertFalse(HAUtil.isHAEnabled(conf,"nn1"));
  assertFalse(HAUtil.isHAEnabled(conf,"nn2"));
}
