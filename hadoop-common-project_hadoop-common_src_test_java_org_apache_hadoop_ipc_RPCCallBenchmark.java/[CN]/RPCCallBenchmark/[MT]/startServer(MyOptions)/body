{
  if (opts.serverThreads <= 0) {
    return null;
  }
  conf.setInt(CommonConfigurationKeys.IPC_SERVER_RPC_READ_THREADS_KEY,opts.serverReaderThreads);
  RPC.Server server;
  if (opts.rpcEngine == ProtobufRpcEngine.class) {
    PBServerImpl serverImpl=new PBServerImpl();
    BlockingService service=TestProtobufRpcProto.newReflectiveBlockingService(serverImpl);
    server=new RPC.Builder(conf).setProtocol(TestRpcService.class).setInstance(service).setBindAddress(opts.host).setPort(opts.port).setNumHandlers(opts.serverThreads).setVerbose(false).build();
  }
 else   if (opts.rpcEngine == WritableRpcEngine.class) {
    server=new RPC.Builder(conf).setProtocol(TestProtocol.class).setInstance(new TestRPC.TestImpl()).setBindAddress(opts.host).setPort(opts.port).setNumHandlers(opts.serverThreads).setVerbose(false).build();
  }
 else {
    throw new RuntimeException("Bad engine: " + opts.rpcEngine);
  }
  server.start();
  return server;
}
