{
  JobConf conf=new JobConf();
  conf.setNumMapTasks(1);
  conf.setNumReduceTasks(1);
  conf.setSpeculativeExecution(false);
  conf.setBoolean(JobContext.SETUP_CLEANUP_NEEDED,false);
  TaskTracker tt1=jobTracker.getTaskTracker(trackers[0]);
  TaskTracker tt2=jobTracker.getTaskTracker(trackers[1]);
  TaskTracker tt3=jobTracker.getTaskTracker(trackers[2]);
  TaskTrackerStatus status1=new TaskTrackerStatus(trackers[0],JobInProgress.convertTrackerNameToHostName(trackers[0]),0,new ArrayList<TaskStatus>(),0,2,2);
  TaskTrackerStatus status2=new TaskTrackerStatus(trackers[1],JobInProgress.convertTrackerNameToHostName(trackers[1]),0,new ArrayList<TaskStatus>(),0,2,2);
  TaskTrackerStatus status3=new TaskTrackerStatus(trackers[1],JobInProgress.convertTrackerNameToHostName(trackers[1]),0,new ArrayList<TaskStatus>(),0,2,2);
  tt1.setStatus(status1);
  tt2.setStatus(status2);
  tt3.setStatus(status3);
  FakeJobInProgress fjob=new FakeJobInProgress(conf,jobTracker);
  fjob.setClusterSize(3);
  fjob.initTasks();
  tt1.reserveSlots(TaskType.MAP,fjob,2);
  tt1.reserveSlots(TaskType.REDUCE,fjob,2);
  tt3.reserveSlots(TaskType.MAP,fjob,2);
  tt3.reserveSlots(TaskType.REDUCE,fjob,2);
  assertEquals("Trackers not reserved for the job : maps",2,fjob.getNumReservedTaskTrackersForMaps());
  assertEquals("Trackers not reserved for the job : reduces",2,fjob.getNumReservedTaskTrackersForReduces());
  ClusterMetrics metrics=jobTracker.getClusterMetrics();
  assertEquals("reserved map slots do not match",4,metrics.getReservedMapSlots());
  assertEquals("reserved reduce slots do not match",4,metrics.getReservedReduceSlots());
  TaskAttemptID mTid=fjob.findMapTask(trackers[1]);
  TaskAttemptID rTid=fjob.findReduceTask(trackers[1]);
  fjob.finishTask(mTid);
  fjob.finishTask(rTid);
  assertEquals("Job didnt complete successfully complete",fjob.getStatus().getRunState(),JobStatus.SUCCEEDED);
  assertEquals("Reservation for the job not released: Maps",0,fjob.getNumReservedTaskTrackersForMaps());
  assertEquals("Reservation for the job not released : Reduces",0,fjob.getNumReservedTaskTrackersForReduces());
  metrics=jobTracker.getClusterMetrics();
  assertEquals("reserved map slots do not match",0,metrics.getReservedMapSlots());
  assertEquals("reserved reduce slots do not match",0,metrics.getReservedReduceSlots());
}
