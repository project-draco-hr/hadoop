{
  boolean failed=false;
  List<String> localDirectories=null;
  this.readLock.lock();
  try {
    localDirectories=new ArrayList<>(localDirs);
  }
  finally {
    this.readLock.unlock();
  }
  for (  final String dir : localDirectories) {
    try {
      createDir(localFs,new Path(dir),perm);
    }
 catch (    IOException e) {
      LOG.warn("Unable to create directory " + dir + " error "+ e.getMessage()+ ", removing from the list of valid directories.");
      this.writeLock.lock();
      try {
        localDirs.remove(dir);
        errorDirs.add(dir);
        numFailures++;
      }
  finally {
        this.writeLock.unlock();
      }
      failed=true;
    }
  }
  return !failed;
}
