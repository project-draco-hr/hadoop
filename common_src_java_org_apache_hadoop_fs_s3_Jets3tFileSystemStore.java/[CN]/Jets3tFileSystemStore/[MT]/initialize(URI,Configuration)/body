{
  this.conf=conf;
  S3Credentials s3Credentials=new S3Credentials();
  s3Credentials.initialize(uri,conf);
  try {
    AWSCredentials awsCredentials=new AWSCredentials(s3Credentials.getAccessKey(),s3Credentials.getSecretAccessKey());
    this.s3Service=new RestS3Service(awsCredentials);
  }
 catch (  S3ServiceException e) {
    if (e.getCause() instanceof IOException) {
      throw (IOException)e.getCause();
    }
    throw new S3Exception(e);
  }
  bucket=new S3Bucket(uri.getHost());
  this.bufferSize=conf.getInt(S3FileSystemConfigKeys.S3_STREAM_BUFFER_SIZE_KEY,S3FileSystemConfigKeys.S3_STREAM_BUFFER_SIZE_DEFAULT);
}
