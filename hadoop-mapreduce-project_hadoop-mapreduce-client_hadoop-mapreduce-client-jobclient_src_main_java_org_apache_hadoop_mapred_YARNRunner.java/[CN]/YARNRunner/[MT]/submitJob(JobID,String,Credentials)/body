{
  addHistoryToken(ts);
  ApplicationSubmissionContext appContext=createApplicationSubmissionContext(conf,jobSubmitDir,ts);
  try {
    ApplicationId applicationId=resMgrDelegate.submitApplication(appContext);
    ApplicationReport appMaster=resMgrDelegate.getApplicationReport(applicationId);
    String diagnostics=(appMaster == null ? "application report is null" : appMaster.getDiagnostics());
    if (appMaster == null || appMaster.getYarnApplicationState() == YarnApplicationState.FAILED || appMaster.getYarnApplicationState() == YarnApplicationState.KILLED) {
      throw new IOException("Failed to run job : " + diagnostics);
    }
    return clientCache.getClient(jobId).getJobStatus(jobId);
  }
 catch (  YarnException e) {
    throw new IOException(e);
  }
}
