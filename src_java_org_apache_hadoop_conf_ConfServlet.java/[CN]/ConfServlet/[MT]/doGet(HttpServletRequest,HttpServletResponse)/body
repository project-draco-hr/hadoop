{
  String format=request.getParameter(FORMAT_PARAM);
  if (null == format) {
    format=FORMAT_XML;
  }
  if (FORMAT_XML.equals(format)) {
    response.setContentType("text/xml");
  }
 else   if (FORMAT_JSON.equals(format)) {
    response.setContentType("text/javascript");
  }
  OutputStreamWriter out=new OutputStreamWriter(response.getOutputStream());
  try {
    writeResponse(getConfFromContext(),out,format);
  }
 catch (  BadFormatException bfe) {
    response.sendError(HttpServletResponse.SC_BAD_REQUEST,bfe.getMessage());
  }
  out.close();
}
