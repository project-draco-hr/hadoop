{
  try {
    lock.lock();
    checkNotClosed();
    Entry entry=new Entry(sock,handler);
    try {
      sock.refCount.reference();
    }
 catch (    ClosedChannelException e) {
      Preconditions.checkArgument(false,"tried to add a closed DomainSocket to " + this);
    }
    toAdd.add(entry);
    kick();
    while (true) {
      try {
        processedCond.await();
      }
 catch (      InterruptedException e) {
        this.interrupt();
      }
      if (!toAdd.contains(entry)) {
        break;
      }
      checkNotClosed();
    }
  }
  finally {
    lock.unlock();
  }
}
