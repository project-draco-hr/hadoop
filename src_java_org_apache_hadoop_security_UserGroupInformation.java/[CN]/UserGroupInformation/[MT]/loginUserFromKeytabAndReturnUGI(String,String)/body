{
  if (!isSecurityEnabled())   return UserGroupInformation.getCurrentUser();
  String oldKeytabFile=null;
  String oldKeytabPrincipal=null;
  try {
    oldKeytabFile=keytabFile;
    oldKeytabPrincipal=keytabPrincipal;
    keytabFile=path;
    keytabPrincipal=user;
    Subject subject=new Subject();
    LoginContext login=new LoginContext(HadoopConfiguration.KEYTAB_KERBEROS_CONFIG_NAME,subject);
    login.login();
    UserGroupInformation newLoginUser=new UserGroupInformation(subject);
    newLoginUser.setLogin(login);
    return newLoginUser;
  }
 catch (  LoginException le) {
    throw new IOException("Login failure for " + user + " from keytab "+ path,le);
  }
 finally {
    if (oldKeytabFile != null)     keytabFile=oldKeytabFile;
    if (oldKeytabPrincipal != null)     keytabPrincipal=oldKeytabPrincipal;
  }
}
