{
  String queueName="single";
  String user="alice";
  QueueMetrics metrics=QueueMetrics.forQueue(ms,queueName,null,false,new Configuration());
  MetricsSource queueSource=queueSource(ms,queueName);
  AppSchedulingInfo app=mockApp(user);
  metrics.submitApp(user);
  MetricsSource userSource=userSource(ms,queueName,user);
  checkApps(queueSource,1,0,0,0,0,0,true);
  metrics.submitAppAttempt(user);
  checkApps(queueSource,1,1,0,0,0,0,true);
  metrics.runAppAttempt(app.getApplicationId(),user);
  checkApps(queueSource,1,0,1,0,0,0,true);
  metrics.finishAppAttempt(app.getApplicationId(),app.isPending(),app.getUser());
  checkApps(queueSource,1,0,0,0,0,0,true);
  metrics.submitAppAttempt(user);
  checkApps(queueSource,1,1,0,0,0,0,true);
  metrics.runAppAttempt(app.getApplicationId(),user);
  checkApps(queueSource,1,0,1,0,0,0,true);
  metrics.finishAppAttempt(app.getApplicationId(),app.isPending(),app.getUser());
  checkApps(queueSource,1,0,0,0,0,0,true);
  metrics.submitAppAttempt(user);
  checkApps(queueSource,1,1,0,0,0,0,true);
  metrics.runAppAttempt(app.getApplicationId(),user);
  checkApps(queueSource,1,0,1,0,0,0,true);
  metrics.finishAppAttempt(app.getApplicationId(),app.isPending(),app.getUser());
  checkApps(queueSource,1,0,0,0,0,0,true);
  metrics.finishApp(user,RMAppState.FAILED);
  checkApps(queueSource,1,0,0,0,1,0,true);
  assertNull(userSource);
}
