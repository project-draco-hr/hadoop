{
  boolean deletionHookAdded=false;
  File lockF=new File(root,STORAGE_FILE_LOCK);
  if (!lockF.exists()) {
    lockF.deleteOnExit();
    deletionHookAdded=true;
  }
  RandomAccessFile file=new RandomAccessFile(lockF,"rws");
  String jvmName=ManagementFactory.getRuntimeMXBean().getName();
  FileLock res=null;
  try {
    res=file.getChannel().tryLock();
    file.write(jvmName.getBytes());
    LOG.info("Lock on " + lockF + " acquired by nodename "+ jvmName);
  }
 catch (  OverlappingFileLockException oe) {
    LOG.error("It appears that another namenode " + file.readLine() + " has already locked the storage directory");
    file.close();
    return null;
  }
catch (  IOException e) {
    LOG.error("Failed to acquire lock on " + lockF + ". If this storage directory is mounted via NFS, "+ "ensure that the appropriate nfs lock services are running.",e);
    file.close();
    throw e;
  }
  if (res != null && !deletionHookAdded) {
    lockF.deleteOnExit();
  }
  return res;
}
