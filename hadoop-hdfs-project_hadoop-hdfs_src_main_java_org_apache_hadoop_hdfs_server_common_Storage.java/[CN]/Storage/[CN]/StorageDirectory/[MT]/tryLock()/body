{
  boolean deletionHookAdded=false;
  File lockF=new File(root,STORAGE_FILE_LOCK);
  if (!lockF.exists()) {
    lockF.deleteOnExit();
    deletionHookAdded=true;
  }
  RandomAccessFile file=new RandomAccessFile(lockF,"rws");
  FileLock res=null;
  try {
    res=file.getChannel().tryLock();
  }
 catch (  OverlappingFileLockException oe) {
    file.close();
    return null;
  }
catch (  IOException e) {
    LOG.error("Cannot create lock on " + lockF,e);
    file.close();
    throw e;
  }
  if (res != null && !deletionHookAdded) {
    lockF.deleteOnExit();
  }
  return res;
}
