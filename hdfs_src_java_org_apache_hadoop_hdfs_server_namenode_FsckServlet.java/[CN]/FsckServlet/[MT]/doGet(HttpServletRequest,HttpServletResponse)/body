{
  @SuppressWarnings("unchecked") final Map<String,String[]> pmap=request.getParameterMap();
  final PrintWriter out=response.getWriter();
  final InetAddress remoteAddress=InetAddress.getByName(request.getRemoteAddr());
  final Configuration conf=(Configuration)getServletContext().getAttribute(JspHelper.CURRENT_CONF);
  final UserGroupInformation ugi=getUGI(request,conf);
  try {
    ugi.doAs(new PrivilegedExceptionAction<Object>(){
      @Override public Object run() throws Exception {
        final ServletContext context=getServletContext();
        NameNode nn=(NameNode)context.getAttribute("name.node");
        final FSNamesystem namesystem=nn.getNamesystem();
        final int totalDatanodes=namesystem.getNumberOfDatanodes(DatanodeReportType.LIVE);
        final short minReplication=namesystem.getMinReplication();
        new NamenodeFsck(conf,nn,NamenodeJspHelper.getNetworkTopology(nn),pmap,out,totalDatanodes,minReplication,remoteAddress).fsck();
        return null;
      }
    }
);
  }
 catch (  InterruptedException e) {
    response.sendError(400,e.getMessage());
  }
}
