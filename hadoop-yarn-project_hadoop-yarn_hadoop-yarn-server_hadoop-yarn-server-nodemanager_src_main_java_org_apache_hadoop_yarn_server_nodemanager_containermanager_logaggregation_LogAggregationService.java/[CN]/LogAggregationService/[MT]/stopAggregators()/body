{
  threadPool.shutdown();
  boolean supervised=getConfig().getBoolean(YarnConfiguration.NM_RECOVERY_SUPERVISED,YarnConfiguration.DEFAULT_NM_RECOVERY_SUPERVISED);
  boolean shouldAbort=context.getNMStateStore().canRecover() && !context.getDecommissioned() && supervised;
  for (  AppLogAggregator aggregator : appLogAggregators.values()) {
    if (shouldAbort) {
      aggregator.abortLogAggregation();
    }
 else {
      aggregator.finishLogAggregation();
    }
  }
  while (!threadPool.isTerminated()) {
    for (    ApplicationId appId : appLogAggregators.keySet()) {
      LOG.info("Waiting for aggregation to complete for " + appId);
    }
    try {
      if (!threadPool.awaitTermination(30,TimeUnit.SECONDS)) {
        threadPool.shutdownNow();
      }
    }
 catch (    InterruptedException e) {
      LOG.warn("Aggregation stop interrupted!");
      break;
    }
  }
  for (  ApplicationId appId : appLogAggregators.keySet()) {
    LOG.warn("Some logs may not have been aggregated for " + appId);
  }
}
