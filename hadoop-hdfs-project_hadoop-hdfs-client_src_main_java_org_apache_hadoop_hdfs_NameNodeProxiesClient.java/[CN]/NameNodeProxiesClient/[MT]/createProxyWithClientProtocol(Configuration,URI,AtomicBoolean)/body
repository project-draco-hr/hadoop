{
  AbstractNNFailoverProxyProvider<ClientProtocol> failoverProxyProvider=createFailoverProxyProvider(conf,nameNodeUri,ClientProtocol.class,true,fallbackToSimpleAuth);
  if (failoverProxyProvider == null) {
    InetSocketAddress nnAddr=DFSUtilClient.getNNAddress(nameNodeUri);
    Text dtService=SecurityUtil.buildTokenService(nnAddr);
    ClientProtocol proxy=createNonHAProxyWithClientProtocol(nnAddr,conf,UserGroupInformation.getCurrentUser(),true,fallbackToSimpleAuth);
    return new ProxyAndInfo<>(proxy,dtService,nnAddr);
  }
 else {
    return createHAProxy(conf,nameNodeUri,ClientProtocol.class,failoverProxyProvider);
  }
}
