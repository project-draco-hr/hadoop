{
  String namenode=null;
  MiniDFSCluster cluster=null;
  try {
    Configuration conf=new Configuration();
    cluster=new MiniDFSCluster(conf,2,true,null);
    final FileSystem hdfs=cluster.getFileSystem();
    namenode=FileSystem.getDefaultUri(conf).toString();
    if (namenode.startsWith("hdfs://")) {
      FileSystem fs=FileSystem.get(URI.create(namenode),new Configuration());
      fs.mkdirs(new Path("/empty"));
      ToolRunner.run(new DistCp(conf),new String[]{"-log",namenode + "/logs",namenode + "/empty",namenode + "/dest"});
      fs=FileSystem.get(URI.create(namenode + "/destdat"),conf);
      assertTrue("Destination directory does not exist.",fs.exists(new Path(namenode + "/dest")));
      deldir(hdfs,"/dest");
      deldir(hdfs,"/empty");
      deldir(hdfs,"/logs");
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
