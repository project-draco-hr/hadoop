{
  Path absolutePath=makeAbsolute(p);
  String key=pathToKey(absolutePath);
  FileMetadata metadata=store.retrieveMetadata(key);
  if (metadata == null) {
    throw new FileNotFoundException("File doesn't exist: " + p);
  }
  PermissionStatus newPermissionStatus=new PermissionStatus(username == null ? metadata.getPermissionStatus().getUserName() : username,groupname == null ? metadata.getPermissionStatus().getGroupName() : groupname,metadata.getPermissionStatus().getPermission());
  if (metadata.getBlobMaterialization() == BlobMaterialization.Implicit) {
    store.storeEmptyFolder(key,newPermissionStatus);
  }
 else {
    store.changePermissionStatus(key,newPermissionStatus);
  }
}
