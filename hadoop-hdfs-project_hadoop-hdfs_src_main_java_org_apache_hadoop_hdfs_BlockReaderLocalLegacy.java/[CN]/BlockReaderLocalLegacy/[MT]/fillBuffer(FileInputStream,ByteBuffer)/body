{
  TraceScope scope=Trace.startSpan("BlockReaderLocalLegacy#fillBuffer(" + blockId + ")",Sampler.NEVER);
  try {
    int bytesRead=stream.getChannel().read(buf);
    if (bytesRead < 0) {
      return bytesRead;
    }
    while (buf.remaining() > 0) {
      int n=stream.getChannel().read(buf);
      if (n < 0) {
        return bytesRead;
      }
      bytesRead+=n;
    }
    return bytesRead;
  }
  finally {
    scope.close();
  }
}
