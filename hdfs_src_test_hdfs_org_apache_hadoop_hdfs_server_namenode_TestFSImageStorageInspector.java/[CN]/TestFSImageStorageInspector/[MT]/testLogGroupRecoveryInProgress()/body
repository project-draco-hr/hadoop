{
  String paths[]=new String[]{"/foo1/current/" + getInProgressEditsFileName(123),"/foo2/current/" + getInProgressEditsFileName(123),"/foo3/current/" + getInProgressEditsFileName(123)};
  FSImageTransactionalStorageInspector inspector=new FSImageTransactionalStorageInspector();
  inspector.inspectDirectory(mockDirectoryWithEditLogs(paths[0]));
  inspector.inspectDirectory(mockDirectoryWithEditLogs(paths[1]));
  inspector.inspectDirectory(mockDirectoryWithEditLogs(paths[2]));
  mockLogValidation(inspector,paths[0],2000);
  mockLogValidation(inspector,paths[1],2000);
  mockLogValidation(inspector,paths[2],1000);
  LogGroup lg=inspector.logGroups.get(123L);
  assertEquals(3,lg.logs.size());
  lg.planRecovery();
  assertFalse(lg.logs.get(0).isCorrupt());
  assertFalse(lg.logs.get(1).isCorrupt());
  assertTrue(lg.logs.get(2).isCorrupt());
  FoundEditLog badLog=lg.logs.get(2);
  Mockito.doNothing().when(badLog).moveAsideCorruptFile();
  Mockito.doNothing().when(lg.logs.get(0)).finalizeLog();
  Mockito.doNothing().when(lg.logs.get(1)).finalizeLog();
  lg.recover();
  Mockito.verify(badLog).moveAsideCorruptFile();
  Mockito.verify(lg.logs.get(0)).finalizeLog();
  Mockito.verify(lg.logs.get(1)).finalizeLog();
}
