{
  final ApplicationUserInfo ugi=getApplicationUserInfo(appId);
  return ugi.getUser().doAs(new PrivilegedExceptionAction<FinishApplicationMasterResponse>(){
    @Override public FinishApplicationMasterResponse run() throws Exception {
      final FinishApplicationMasterRequest req=Records.newRecord(FinishApplicationMasterRequest.class);
      req.setDiagnostics("");
      req.setTrackingUrl("");
      req.setFinalApplicationStatus(status);
      FinishApplicationMasterResponse response=getAMRMProxyService().finishApplicationMaster(req);
      getAMRMProxyService().stopApp(ugi.getAppAttemptId().getApplicationId());
      return response;
    }
  }
);
}
