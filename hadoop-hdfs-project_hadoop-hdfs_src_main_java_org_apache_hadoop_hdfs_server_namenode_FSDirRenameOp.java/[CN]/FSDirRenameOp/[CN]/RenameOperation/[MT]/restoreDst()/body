{
  Preconditions.checkState(oldDstChild != null);
  final INodeDirectory dstParent=dstParentIIP.getLastINode().asDirectory();
  if (dstParent.isWithSnapshot()) {
    dstParent.undoRename4DstParent(oldDstChild,dstIIP.getLatestSnapshotId());
  }
 else {
    fsd.addLastINodeNoQuotaCheck(dstParentIIP,oldDstChild);
  }
  if (oldDstChild != null && oldDstChild.isReference()) {
    final INodeReference removedDstRef=oldDstChild.asReference();
    final INodeReference.WithCount wc=(INodeReference.WithCount)removedDstRef.getReferredINode().asReference();
    wc.addReference(removedDstRef);
  }
}
