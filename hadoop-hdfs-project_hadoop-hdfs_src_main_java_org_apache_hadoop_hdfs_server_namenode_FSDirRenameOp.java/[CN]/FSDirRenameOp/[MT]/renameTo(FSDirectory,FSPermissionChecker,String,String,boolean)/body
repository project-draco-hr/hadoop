{
  final INodesInPath srcIIP=fsd.getINodesInPath4Write(src,false);
  final String actualDst=fsd.isDir(dst) ? dst + Path.SEPARATOR + new Path(src).getName() : dst;
  final INodesInPath dstIIP=fsd.getINodesInPath4Write(actualDst,false);
  if (fsd.isPermissionEnabled()) {
    fsd.checkPermission(pc,srcIIP,false,null,FsAction.WRITE,null,null,false);
    fsd.checkPermission(pc,dstIIP,false,FsAction.WRITE,null,null,null,false);
  }
  if (NameNode.stateChangeLog.isDebugEnabled()) {
    NameNode.stateChangeLog.debug("DIR* FSDirectory.renameTo: " + src + " to "+ dst);
  }
  final long mtime=Time.now();
  boolean stat=false;
  fsd.writeLock();
  try {
    stat=unprotectedRenameTo(fsd,src,actualDst,srcIIP,dstIIP,mtime);
  }
  finally {
    fsd.writeUnlock();
  }
  if (stat) {
    fsd.getEditLog().logRename(src,dst,mtime,logRetryCache);
    return true;
  }
  return false;
}
