{
  if (UserGroupInformation.isSecurityEnabled()) {
    DelegationTokenIdentifier dtId=new DelegationTokenIdentifier(new Text(ugi.getUserName()),null,null);
    FSNamesystem namesystem=mock(FSNamesystem.class);
    DelegationTokenSecretManager dtSecretManager=new DelegationTokenSecretManager(86400000,86400000,86400000,86400000,namesystem);
    dtSecretManager.startThreads();
    Token<DelegationTokenIdentifier> token1=new Token<DelegationTokenIdentifier>(dtId,dtSecretManager);
    Token<DelegationTokenIdentifier> token2=new Token<DelegationTokenIdentifier>(dtId,dtSecretManager);
    SecurityUtil.setTokenService(token1,NetUtils.createSocketAddr(uri.getAuthority()));
    SecurityUtil.setTokenService(token2,NetUtils.createSocketAddr(uri.getAuthority()));
    token1.setKind(WebHdfsConstants.WEBHDFS_TOKEN_KIND);
    token2.setKind(WebHdfsConstants.WEBHDFS_TOKEN_KIND);
    tokens.add(token1);
    tokens.add(token2);
    ugi.addToken(token1);
    ugi.addToken(token2);
  }
  return (WebHdfsFileSystem)FileSystem.get(uri,conf);
}
