{
  String group1="group1";
  String group2="group2";
  String user1="user1";
  UserGroupInformation ugi1;
  Map<String,String[]> u2gMap=new HashMap<String,String[]>(1);
  u2gMap.put(user1,new String[]{group1,group2});
  DFSTestUtil.updateConfWithFakeGroupMapping(conf,u2gMap);
  ugi1=UserGroupInformation.createUserForTesting(user1,new String[]{group1,group2});
  final Path parent=new Path("/test/async_api_exception/");
  final Path aclDir=new Path(parent,"aclDir");
  fs.mkdirs(aclDir,FsPermission.createImmutable((short)0770));
  AsyncDistributedFileSystem adfs=ugi1.doAs(new PrivilegedExceptionAction<AsyncDistributedFileSystem>(){
    @Override public AsyncDistributedFileSystem run() throws Exception {
      return cluster.getFileSystem().getAsyncDistributedFileSystem();
    }
  }
);
  Future<Void> retFuture;
  try {
    retFuture=adfs.setAcl(aclDir,Lists.newArrayList(aclEntry(ACCESS,USER,ALL)));
    retFuture.get();
    fail("setAcl should fail with permission denied");
  }
 catch (  ExecutionException e) {
    checkPermissionDenied(e,aclDir,user1);
  }
  try {
    Future<AclStatus> aclRetFuture=adfs.getAclStatus(aclDir);
    aclRetFuture.get();
    fail("getAclStatus should fail with permission denied");
  }
 catch (  ExecutionException e) {
    checkPermissionDenied(e,aclDir,user1);
  }
}
