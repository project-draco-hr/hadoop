{
  List<ApplicationId> appIds=new ArrayList<ApplicationId>();
  for (int i=0; i < 10; ++i) {
    Random rand=new Random(i);
    ApplicationId appId=ApplicationId.newInstance(0,rand.nextInt());
    appIds.add(appId);
    RMApp app=createRMApp(appId);
    writer.applicationStarted(app);
    for (int j=1; j <= 10; ++j) {
      ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,j);
      RMAppAttempt appAttempt=createRMAppAttempt(appAttemptId);
      writer.applicationAttemptStarted(appAttempt);
      for (int k=1; k <= 10; ++k) {
        ContainerId containerId=ContainerId.newInstance(appAttemptId,k);
        RMContainer container=createRMContainer(containerId);
        writer.containerStarted(container);
        writer.containerFinished(container);
      }
      writer.applicationAttemptFinished(appAttempt);
    }
    writer.applicationFinished(app);
  }
  for (int i=0; i < MAX_RETRIES; ++i) {
    if (allEventsHandled(20 * 10 * 10 + 20 * 10 + 20)) {
      break;
    }
 else {
      Thread.sleep(500);
    }
  }
  Assert.assertTrue(allEventsHandled(20 * 10 * 10 + 20 * 10 + 20));
  for (  ApplicationId appId : appIds) {
    Assert.assertTrue(handledByOne(appId));
  }
}
