{
  int timeoutSecs=0;
  QueueMetrics metrics=rm.getResourceScheduler().getRootQueueMetrics();
  ClusterMetrics clusterMetrics=ClusterMetrics.getMetrics();
  boolean isAllMetricAssertionDone=false;
  String message=null;
  while (timeoutSecs++ < 5) {
    try {
      assertMetric("appsSubmitted",appsSubmitted,metrics.getAppsSubmitted());
      assertMetric("appsPending",appsPending,metrics.getAppsPending());
      assertMetric("containersPending",containersPending,metrics.getPendingContainers());
      assertMetric("availableMB",availableMB,metrics.getAvailableMB());
      assertMetric("activeApplications",activeApplications,metrics.getActiveApps());
      assertMetric("activeNodes",activeNodes,clusterMetrics.getNumActiveNMs());
      isAllMetricAssertionDone=true;
      break;
    }
 catch (    AssertionError e) {
      message=e.getMessage();
      System.out.println("Waiting for metrics assertion to complete");
      Thread.sleep(1000);
    }
  }
  assertTrue(message,isAllMetricAssertionDone);
}
