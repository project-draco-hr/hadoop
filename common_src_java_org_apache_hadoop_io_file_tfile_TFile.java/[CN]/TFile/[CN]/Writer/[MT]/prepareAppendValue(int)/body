{
  if (state != State.END_KEY) {
    throw new IllegalStateException("Incorrect state to start a new value: " + state.name());
  }
  DataOutputStream ret;
  if (length < 0) {
    if (valueBuffer == null) {
      valueBuffer=new byte[getChunkBufferSize(conf)];
    }
    ret=new ValueRegister(new ChunkEncoder(blkAppender,valueBuffer));
  }
 else {
    ret=new ValueRegister(new Chunk.SingleChunkEncoder(blkAppender,length));
  }
  state=State.IN_VALUE;
  return ret;
}
