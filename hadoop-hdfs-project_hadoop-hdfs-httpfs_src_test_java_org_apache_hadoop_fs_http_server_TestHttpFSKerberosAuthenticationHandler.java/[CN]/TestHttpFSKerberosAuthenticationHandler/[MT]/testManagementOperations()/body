{
  String dir=TestDirHelper.getTestDir().getAbsolutePath();
  Configuration httpfsConf=new Configuration(false);
  HttpFSServerWebApp server=new HttpFSServerWebApp(dir,dir,dir,dir,httpfsConf);
  server.setAuthority(new InetSocketAddress(InetAddress.getLocalHost(),14000));
  AuthenticationHandler handler=new HttpFSKerberosAuthenticationHandlerForTesting();
  try {
    server.init();
    handler.init(null);
    testNonManagementOperation(handler);
    testManagementOperationErrors(handler);
    testGetToken(handler,false,null);
    testGetToken(handler,true,null);
    testGetToken(handler,false,"foo");
    testGetToken(handler,true,"foo");
    testCancelToken(handler);
    testRenewToken(handler);
  }
  finally {
    if (handler != null) {
      handler.destroy();
    }
    server.destroy();
  }
}
