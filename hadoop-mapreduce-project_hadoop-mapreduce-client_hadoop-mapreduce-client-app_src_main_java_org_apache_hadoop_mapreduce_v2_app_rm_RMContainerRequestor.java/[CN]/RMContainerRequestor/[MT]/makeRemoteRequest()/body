{
  AllocateRequest allocateRequest=BuilderUtils.newAllocateRequest(applicationAttemptId,lastResponseID,super.getApplicationProgress(),new ArrayList<ResourceRequest>(ask),new ArrayList<ContainerId>(release));
  AllocateResponse allocateResponse=scheduler.allocate(allocateRequest);
  AMResponse response=allocateResponse.getAMResponse();
  lastResponseID=response.getResponseId();
  availableResources=response.getAvailableResources();
  lastClusterNmCount=clusterNmCount;
  clusterNmCount=allocateResponse.getNumClusterNodes();
  if (ask.size() > 0 || release.size() > 0) {
    LOG.info("getResources() for " + applicationId + ":"+ " ask="+ ask.size()+ " release= "+ release.size()+ " newContainers="+ response.getAllocatedContainers().size()+ " finishedContainers="+ response.getCompletedContainersStatuses().size()+ " resourcelimit="+ availableResources+ " knownNMs="+ clusterNmCount);
  }
  ask.clear();
  release.clear();
  return response;
}
