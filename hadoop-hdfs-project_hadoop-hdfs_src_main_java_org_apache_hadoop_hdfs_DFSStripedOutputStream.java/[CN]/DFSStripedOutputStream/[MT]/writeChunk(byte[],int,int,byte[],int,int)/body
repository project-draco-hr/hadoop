{
  final int index=getCurrentIndex();
  final StripedDataStreamer current=getCurrentStreamer();
  final int pos=cellBuffers.addTo(index,bytes,offset,len);
  final boolean cellFull=pos == cellSize;
  final long oldBytes=current.getBytesCurBlock();
  if (!current.isFailed()) {
    try {
      super.writeChunk(bytes,offset,len,checksum,ckoff,cklen);
      if (cellFull && currentPacket != null) {
        enqueueCurrentPacketFull();
      }
    }
 catch (    Exception e) {
      handleStreamerFailure("offset=" + offset + ", length="+ len,e);
    }
  }
  if (current.isFailed()) {
    final long newBytes=oldBytes + len;
    coordinator.setBytesEndBlock(index,newBytes,current.getBlock());
    current.setBytesCurBlock(newBytes);
  }
  if (cellFull) {
    int next=index + 1;
    if (next == numDataBlocks) {
      cellBuffers.flipDataBuffers();
      writeParityCells();
      next=0;
    }
    setCurrentStreamer(next);
  }
}
