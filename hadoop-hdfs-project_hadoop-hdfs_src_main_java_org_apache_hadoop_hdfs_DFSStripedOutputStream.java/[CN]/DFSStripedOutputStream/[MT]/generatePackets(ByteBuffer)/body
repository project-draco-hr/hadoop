{
  List<DFSPacket> packets=new ArrayList<>();
  while (byteBuffer.remaining() > 0) {
    DFSPacket p=createPacket(packetSize,chunksPerPacket,streamer.getBytesCurBlock(),streamer.getAndIncCurrentSeqno(),false);
    int maxBytesToPacket=p.getMaxChunks() * bytesPerChecksum;
    int toWrite=byteBuffer.remaining() > maxBytesToPacket ? maxBytesToPacket : byteBuffer.remaining();
    p.writeData(byteBuffer,toWrite);
    streamer.incBytesCurBlock(toWrite);
    packets.add(p);
  }
  return packets;
}
