{
  bmSafeMode.activate(BLOCK_TOTAL);
  when(bm.getBytesInFuture()).thenReturn(1L);
  setBlockSafe(BLOCK_THRESHOLD);
  bmSafeMode.checkSafeMode();
  try {
    waitForExtensionPeriod();
    fail("Safe mode should not leave extension period with orphan blocks!");
  }
 catch (  TimeoutException e) {
    assertEquals(BMSafeModeStatus.EXTENSION,getSafeModeStatus());
  }
}
