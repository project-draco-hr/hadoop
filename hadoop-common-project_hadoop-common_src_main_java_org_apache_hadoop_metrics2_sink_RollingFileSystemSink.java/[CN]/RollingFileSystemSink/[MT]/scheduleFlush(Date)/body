{
  final PrintStream toClose=currentOutStream;
  Calendar next=Calendar.getInstance();
  next.setTime(now);
  if (isTest) {
    next.add(Calendar.MILLISECOND,400);
  }
 else {
    next.set(Calendar.SECOND,0);
    next.set(Calendar.MINUTE,0);
    next.add(Calendar.HOUR,1);
  }
  flushTimer.schedule(new TimerTask(){
    @Override public void run(){
synchronized (lock) {
        toClose.close();
      }
      hasFlushed=true;
    }
  }
,next.getTime());
}
