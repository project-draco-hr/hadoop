{
  Date now=new Date();
  String currentDir=DATE_FORMAT.format(now);
  Path path=new Path(basePath,currentDir);
  if ((currentOutStream == null) || !path.equals(currentDirPath)) {
    if (!initialized) {
      initialized=initFs();
    }
    if (initialized) {
      if (currentOutStream != null) {
        currentOutStream.close();
      }
      currentDirPath=path;
      try {
        rollLogDir();
      }
 catch (      IOException ex) {
        throwMetricsException("Failed to create new log file",ex);
      }
      scheduleFlush(now);
    }
  }
}
