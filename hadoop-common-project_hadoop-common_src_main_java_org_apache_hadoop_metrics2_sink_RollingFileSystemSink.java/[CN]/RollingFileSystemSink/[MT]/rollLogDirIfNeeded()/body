{
  Date now=new Date();
  if ((currentOutStream == null) || now.after(nextFlush.getTime())) {
    if (!initialized) {
      initialized=initFs();
    }
    if (initialized) {
      if (currentOutStream != null) {
        currentOutStream.close();
      }
      currentDirPath=findCurrentDirectory(now);
      try {
        rollLogDir();
      }
 catch (      IOException ex) {
        throwMetricsException("Failed to create new log file",ex);
      }
      updateFlushTime(now);
      scheduleFlush(nextFlush.getTime());
    }
  }
 else   if (forceFlush) {
    scheduleFlush(new Date());
  }
}
