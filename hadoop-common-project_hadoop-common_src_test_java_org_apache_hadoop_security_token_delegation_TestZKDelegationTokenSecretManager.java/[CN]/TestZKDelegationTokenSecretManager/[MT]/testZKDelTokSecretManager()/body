{
  TestingServer zkServer=new TestingServer();
  DelegationTokenManager tm1, tm2=null;
  zkServer.start();
  try {
    String connectString=zkServer.getConnectString();
    Configuration conf=new Configuration();
    conf.setBoolean(DelegationTokenManager.ENABLE_ZK_KEY,true);
    conf.set(ZKDelegationTokenSecretManager.ZK_DTSM_ZK_CONNECTION_STRING,connectString);
    conf.set(ZKDelegationTokenSecretManager.ZK_DTSM_ZNODE_WORKING_PATH,"testPath");
    conf.set(ZKDelegationTokenSecretManager.ZK_DTSM_ZK_AUTH_TYPE,"none");
    conf.setLong(DelegationTokenManager.UPDATE_INTERVAL,DAY_IN_SECS);
    conf.setLong(DelegationTokenManager.MAX_LIFETIME,DAY_IN_SECS);
    conf.setLong(DelegationTokenManager.RENEW_INTERVAL,DAY_IN_SECS);
    conf.setLong(DelegationTokenManager.REMOVAL_SCAN_INTERVAL,DAY_IN_SECS);
    tm1=new DelegationTokenManager(conf,new Text("foo"));
    tm1.init();
    tm2=new DelegationTokenManager(conf,new Text("foo"));
    tm2.init();
    Token<DelegationTokenIdentifier> token=(Token<DelegationTokenIdentifier>)tm1.createToken(UserGroupInformation.getCurrentUser(),"foo");
    Assert.assertNotNull(token);
    tm2.verifyToken(token);
    token=(Token<DelegationTokenIdentifier>)tm2.createToken(UserGroupInformation.getCurrentUser(),"bar");
    Assert.assertNotNull(token);
    tm1.verifyToken(token);
  }
  finally {
    zkServer.close();
  }
}
