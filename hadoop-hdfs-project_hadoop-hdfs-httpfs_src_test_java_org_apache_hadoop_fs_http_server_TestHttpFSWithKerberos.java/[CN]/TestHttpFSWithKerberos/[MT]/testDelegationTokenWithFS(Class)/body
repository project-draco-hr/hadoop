{
  createHttpFSServer();
  Configuration conf=new Configuration();
  conf.set("fs.webhdfs.impl",fileSystemClass.getName());
  conf.set("fs.hdfs.impl.disable.cache","true");
  URI uri=new URI("webhdfs://" + TestJettyHelper.getJettyURL().toURI().getAuthority());
  FileSystem fs=FileSystem.get(uri,conf);
  Token<?> tokens[]=fs.addDelegationTokens("foo",null);
  fs.close();
  Assert.assertEquals(1,tokens.length);
  fs=FileSystem.get(uri,conf);
  ((DelegationTokenRenewer.Renewable)fs).setDelegationToken(tokens[0]);
  fs.listStatus(new Path("/"));
  fs.close();
}
