{
  INodeDirectory ids=mock(INodeDirectory.class);
  FSDirectory fsdir=mock(FSDirectory.class);
  INodesInPath iip=mock(INodesInPath.class);
  SnapshotManager sm=spy(new SnapshotManager(fsdir));
  doReturn(ids).when(sm).getSnapshottableRoot((INodesInPath)anyObject());
  doReturn(testMaxSnapshotLimit).when(sm).getMaxSnapshotID();
  for (Integer i=0; i < testMaxSnapshotLimit; ++i) {
    sm.createSnapshot(iip,"dummy",i.toString());
  }
  try {
    sm.createSnapshot(iip,"dummy","shouldFailSnapshot");
    Assert.fail("Expected SnapshotException not thrown");
  }
 catch (  SnapshotException se) {
    Assert.assertTrue(se.getMessage().toLowerCase(Locale.ENGLISH).contains("rollover"));
  }
  sm.deleteSnapshot(iip,"",mock(INode.BlocksMapUpdateInfo.class),new ArrayList<INode>());
  try {
    sm.createSnapshot(iip,"dummy","shouldFailSnapshot2");
    Assert.fail("Expected SnapshotException not thrown");
  }
 catch (  SnapshotException se) {
    Assert.assertTrue(se.getMessage().toLowerCase(Locale.ENGLISH).contains("rollover"));
  }
}
