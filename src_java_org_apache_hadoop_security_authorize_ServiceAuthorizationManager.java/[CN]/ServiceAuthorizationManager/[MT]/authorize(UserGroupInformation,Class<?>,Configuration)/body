{
  AccessControlList acl=protocolToAcl.get(protocol);
  if (acl == null) {
    throw new AuthorizationException("Protocol " + protocol + " is not known.");
  }
  KerberosInfo krbInfo=protocol.getAnnotation(KerberosInfo.class);
  String clientPrincipal=null;
  if (krbInfo != null) {
    String clientKey=krbInfo.clientPrincipal();
    if (clientKey != null && !clientKey.equals("")) {
      clientPrincipal=conf.get(clientKey);
    }
  }
  String shortName=clientPrincipal;
  if (clientPrincipal != null) {
    try {
      shortName=new KerberosName(clientPrincipal).getShortName();
    }
 catch (    IOException e) {
      LOG.warn("couldn't get short name from " + clientPrincipal,e);
    }
  }
  LOG.debug("for protocol authorization compare (" + clientPrincipal + "): "+ shortName+ " with "+ user.getShortUserName());
  if ((shortName != null && !shortName.equals(user.getShortUserName())) || !acl.isUserAllowed(user)) {
    AUDITLOG.warn(AUTHZ_FAILED_FOR + user + " for protocol="+ protocol);
    throw new AuthorizationException("User " + user + " is not authorized for protocol "+ protocol);
  }
  AUDITLOG.info(AUTHZ_SUCCESSFULL_FOR + user + " for protocol="+ protocol);
}
