{
  try {
    Subject.doAs(user,new PrivilegedExceptionAction<Void>(){
      @Override public Void run() throws Exception {
        try {
          for (          Permission permission : permissions) {
            AccessController.checkPermission(permission);
          }
        }
 catch (        AccessControlException ace) {
          LOG.info("Authorization failed for " + UserGroupInformation.getCurrentUGI(),ace);
          throw new AuthorizationException(ace);
        }
        return null;
      }
    }
);
  }
 catch (  PrivilegedActionException e) {
    throw new AuthorizationException(e.getException());
  }
}
