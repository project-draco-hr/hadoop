{
  long st=System.nanoTime();
  long waitUntil=st + TimeUnit.NANOSECONDS.convert(timeoutMillis,TimeUnit.MILLISECONDS);
  do {
synchronized (this) {
      if (lastHealthState != State.SERVICE_HEALTHY) {
        return null;
      }
    }
synchronized (activeAttemptRecordLock) {
      if ((lastActiveAttemptRecord != null && lastActiveAttemptRecord.nanoTime >= st)) {
        return lastActiveAttemptRecord;
      }
      activeAttemptRecordLock.wait(1000);
    }
  }
 while (System.nanoTime() < waitUntil);
  LOG.warn(timeoutMillis + "ms timeout elapsed waiting for an attempt " + "to become active");
  return null;
}
