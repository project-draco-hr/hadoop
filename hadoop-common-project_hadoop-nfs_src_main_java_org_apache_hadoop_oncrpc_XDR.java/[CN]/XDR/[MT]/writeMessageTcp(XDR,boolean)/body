{
  Preconditions.checkState(request.state == XDR.State.WRITING);
  ByteBuffer b=request.buf.duplicate();
  b.flip();
  byte[] fragmentHeader=XDR.recordMark(b.limit(),last);
  ByteBuffer headerBuf=ByteBuffer.wrap(fragmentHeader);
  return ChannelBuffers.copiedBuffer(headerBuf,b);
}
