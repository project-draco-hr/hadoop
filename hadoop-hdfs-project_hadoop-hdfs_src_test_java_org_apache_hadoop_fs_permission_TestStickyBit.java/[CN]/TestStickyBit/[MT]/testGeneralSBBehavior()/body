{
  MiniDFSCluster cluster=null;
  try {
    Configuration conf=new HdfsConfiguration();
    conf.setBoolean(DFSConfigKeys.DFS_PERMISSIONS_ENABLED_KEY,true);
    conf.setBoolean(DFSConfigKeys.DFS_SUPPORT_APPEND_KEY,true);
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(4).build();
    FileSystem hdfs=cluster.getFileSystem();
    assertTrue(hdfs instanceof DistributedFileSystem);
    Path baseDir=new Path("/mcgann");
    hdfs.mkdirs(baseDir);
    confirmCanAppend(conf,hdfs,baseDir);
    baseDir=new Path("/eccleston");
    hdfs.mkdirs(baseDir);
    confirmSettingAndGetting(hdfs,baseDir);
    baseDir=new Path("/tennant");
    hdfs.mkdirs(baseDir);
    confirmDeletingFiles(conf,hdfs,baseDir);
    baseDir=new Path("/smith");
    hdfs.mkdirs(baseDir);
    confirmStickyBitDoesntPropagate(hdfs,baseDir);
  }
  finally {
    if (cluster != null)     cluster.shutdown();
  }
}
