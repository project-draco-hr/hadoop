{
  DrainDispatcher dispatcher=new DrainDispatcher();
  dispatcher.init(null);
  try {
    dispatcher.start();
    LocalResource apiRsrc=createMockResource();
    LocalResourceRequest rsrcA=new LocalResourceRequest(apiRsrc);
    LocalizedResource local=new LocalizedResource(rsrcA,dispatcher);
    Path p=new Path("file:///cache/rsrcA");
    local.handle(new ResourceLocalizedEvent(rsrcA,p,10));
    dispatcher.await();
    assertEquals(ResourceState.LOCALIZED,local.getState());
  }
  finally {
    dispatcher.stop();
  }
}
