{
  String user=HadoopUsersConfTestHelper.getHadoopUsers()[0];
  if (filename.charAt(0) == '/') {
    filename=filename.substring(1);
  }
  String pathOps=MessageFormat.format("/webhdfs/v1/{0}?user.name={1}{2}{3}&op={4}",filename,user,(params == null) ? "" : "&",(params == null) ? "" : params,command);
  URL url=new URL(TestJettyHelper.getJettyURL(),pathOps);
  HttpURLConnection conn=(HttpURLConnection)url.openConnection();
  conn.setRequestMethod("PUT");
  conn.connect();
  int resp=conn.getResponseCode();
  if (expectOK) {
    Assert.assertEquals(HttpURLConnection.HTTP_OK,resp);
  }
 else {
    Assert.assertEquals(HttpURLConnection.HTTP_INTERNAL_ERROR,resp);
    BufferedReader reader;
    reader=new BufferedReader(new InputStreamReader(conn.getErrorStream()));
    String err=reader.readLine();
    Assert.assertTrue(err.contains("RemoteException"));
    Assert.assertTrue(err.contains("ACL"));
    Assert.assertTrue(err.contains("rejected"));
  }
}
