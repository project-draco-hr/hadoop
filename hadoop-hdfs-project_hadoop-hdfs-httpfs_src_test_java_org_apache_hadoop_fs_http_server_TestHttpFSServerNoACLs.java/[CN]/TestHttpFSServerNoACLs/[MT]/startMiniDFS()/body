{
  File testDirRoot=TestDirHelper.getTestDir();
  if (System.getProperty("hadoop.log.dir") == null) {
    System.setProperty("hadoop.log.dir",new File(testDirRoot,"hadoop-log").getAbsolutePath());
  }
  if (System.getProperty("test.build.data") == null) {
    System.setProperty("test.build.data",new File(testDirRoot,"hadoop-data").getAbsolutePath());
  }
  Configuration conf=HadoopUsersConfTestHelper.getBaseConf();
  HadoopUsersConfTestHelper.addUserConf(conf);
  conf.set("fs.hdfs.impl.disable.cache","true");
  conf.set("dfs.block.access.token.enable","false");
  conf.set("dfs.permissions","true");
  conf.set("hadoop.security.authentication","simple");
  conf.setBoolean(DFSConfigKeys.DFS_NAMENODE_ACLS_ENABLED_KEY,false);
  MiniDFSCluster.Builder builder=new MiniDFSCluster.Builder(conf);
  builder.numDataNodes(2);
  miniDfs=builder.build();
  nnConf=miniDfs.getConfiguration(0);
}
