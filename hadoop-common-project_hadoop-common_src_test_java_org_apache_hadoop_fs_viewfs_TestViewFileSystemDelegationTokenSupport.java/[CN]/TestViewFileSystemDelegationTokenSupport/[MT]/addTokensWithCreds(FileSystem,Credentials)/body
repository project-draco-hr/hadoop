{
  Credentials savedCreds;
  savedCreds=new Credentials(creds);
  Token<?> tokens[]=fs.addDelegationTokens("me",creds);
  assertEquals(1,tokens.length);
  assertEquals(fs.getCanonicalServiceName(),tokens[0].getService().toString());
  assertTrue(creds.getAllTokens().contains(tokens[0]));
  assertTrue(creds.getAllTokens().containsAll(savedCreds.getAllTokens()));
  assertEquals(savedCreds.numberOfTokens() + 1,creds.numberOfTokens());
  savedCreds=new Credentials(creds);
  Token<?> tokenRefetch[]=fs.addDelegationTokens("me",creds);
  assertEquals(0,tokenRefetch.length);
  assertTrue(creds.getAllTokens().containsAll(savedCreds.getAllTokens()));
  assertEquals(savedCreds.numberOfTokens(),creds.numberOfTokens());
  return tokens;
}
