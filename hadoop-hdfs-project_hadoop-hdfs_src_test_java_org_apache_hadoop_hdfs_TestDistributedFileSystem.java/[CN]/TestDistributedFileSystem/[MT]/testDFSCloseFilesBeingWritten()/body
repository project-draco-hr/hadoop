{
  Configuration conf=getTestConfiguration();
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
    DistributedFileSystem fileSys=cluster.getFileSystem();
    fileSys.create(new Path("/test/dfsclose/file-0"));
    fileSys.delete(new Path("/test/dfsclose/file-0"),true);
    DFSClient dfsClient=fileSys.getClient();
    DFSClient newDfsClient=new DFSClient(cluster.getFileSystem(0).getUri(),conf);
    LeaseRenewer leaseRenewer=newDfsClient.getLeaseRenewer();
    dfsClient.closeAllFilesBeingWritten(false);
    leaseRenewer.closeClient(newDfsClient);
    assertEquals(true,leaseRenewer.isEmpty());
    assertEquals(true,dfsClient.isFilesBeingWrittenEmpty());
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
