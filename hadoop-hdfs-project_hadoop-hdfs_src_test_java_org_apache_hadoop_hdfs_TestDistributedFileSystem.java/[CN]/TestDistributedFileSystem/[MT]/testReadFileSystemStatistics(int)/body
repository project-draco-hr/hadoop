{
  MiniDFSCluster cluster=null;
  final Configuration conf=getTestConfiguration();
  if (expectedDistance == 0) {
    cluster=new MiniDFSCluster.Builder(conf).hosts(new String[]{NetUtils.getLocalHostname()}).build();
  }
 else   if (expectedDistance == 2) {
    cluster=new MiniDFSCluster.Builder(conf).hosts(new String[]{"hostFoo"}).build();
  }
 else   if (expectedDistance == 4) {
    cluster=new MiniDFSCluster.Builder(conf).racks(new String[]{"/rackFoo"}).build();
  }
  try {
    final FileSystem fs=cluster.getFileSystem();
    DFSTestUtil.getStatistics(fs).reset();
    Path dir=new Path("/test");
    Path file=new Path(dir,"file");
    String input="hello world";
    DFSTestUtil.writeFile(fs,file,input);
    FSDataInputStream stm=fs.open(file);
    byte[] actual=new byte[4096];
    stm.read(actual);
    checkReadStatistics(fs,expectedDistance,input.length());
  }
  finally {
    if (cluster != null)     cluster.shutdown();
  }
}
