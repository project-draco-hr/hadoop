{
  Configuration conf=getTestConfiguration();
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(2).build();
    FileSystem fileSys=cluster.getFileSystem();
    fileSys.create(new Path("/test/dfsclose/file-0"));
    fileSys.create(new Path("/test/dfsclose/file-1"));
    Path p=new Path("/non-empty-file");
    DFSTestUtil.createFile(fileSys,p,1L,(short)1,0L);
    DFSTestUtil.readFile(fileSys,p);
    DFSClient client=((DistributedFileSystem)fileSys).dfs;
    SocketCache cache=client.socketCache;
    assertEquals(1,cache.size());
    fileSys.close();
    assertEquals(0,cache.size());
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
