{
  HdfsConfiguration conf;
  if (noXmlDefaults) {
    conf=new HdfsConfiguration(false);
    String namenodeDir=new File(MiniDFSCluster.getBaseDirectory(),"name").getAbsolutePath();
    conf.set(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY,namenodeDir);
    conf.set(DFSConfigKeys.DFS_NAMENODE_EDITS_DIR_KEY,namenodeDir);
  }
 else {
    conf=new HdfsConfiguration();
  }
  if (dualPortTesting) {
    conf.set(DFSConfigKeys.DFS_NAMENODE_SERVICE_RPC_ADDRESS_KEY,"localhost:0");
  }
  conf.setLong(DFSConfigKeys.DFS_NAMENODE_MIN_BLOCK_SIZE_KEY,0);
  return conf;
}
