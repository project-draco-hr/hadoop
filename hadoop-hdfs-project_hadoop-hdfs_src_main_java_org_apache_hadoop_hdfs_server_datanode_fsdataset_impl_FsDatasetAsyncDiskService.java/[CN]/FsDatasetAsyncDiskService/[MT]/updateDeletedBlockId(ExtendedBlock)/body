{
  Set<Long> blockIds=deletedBlockIds.get(block.getBlockPoolId());
  if (blockIds == null) {
    blockIds=new HashSet<Long>();
    deletedBlockIds.put(block.getBlockPoolId(),blockIds);
  }
  blockIds.add(block.getBlockId());
  numDeletedBlocks++;
  if (numDeletedBlocks == MAX_DELETED_BLOCKS) {
    for (    Entry<String,Set<Long>> e : deletedBlockIds.entrySet()) {
      String bpid=e.getKey();
      Set<Long> bs=e.getValue();
      fsdatasetImpl.removeDeletedBlocks(bpid,bs);
      bs.clear();
    }
    numDeletedBlocks=0;
  }
}
