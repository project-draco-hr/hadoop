{
  for (int i=b.numNodes() - 1; i >= 0; i--) {
    final DatanodeStorageInfo storage=b.getStorageInfo(i);
    final boolean removed=storage.removeBlock(b);
    Preconditions.checkState(removed,"currentBlock not found.");
    final DatanodeStorageInfo.AddBlockResult result=storage.addBlock(newBlock);
    Preconditions.checkState(result == DatanodeStorageInfo.AddBlockResult.ADDED,"newBlock already exists.");
  }
}
