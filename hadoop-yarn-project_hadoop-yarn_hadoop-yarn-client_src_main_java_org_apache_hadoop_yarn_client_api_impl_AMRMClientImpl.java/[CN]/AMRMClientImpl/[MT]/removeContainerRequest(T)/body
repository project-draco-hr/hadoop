{
  Preconditions.checkArgument(req != null,"Resource request can not be null.");
  Set<String> allRacks=new HashSet<String>();
  if (req.getRacks() != null) {
    allRacks.addAll(req.getRacks());
  }
  allRacks.addAll(resolveRacks(req.getNodes()));
  if (req.getNodes() != null) {
    for (    String node : new HashSet<String>(req.getNodes())) {
      decResourceRequest(req.getPriority(),node,req.getCapability(),req);
    }
  }
  for (  String rack : allRacks) {
    decResourceRequest(req.getPriority(),rack,req.getCapability(),req);
  }
  decResourceRequest(req.getPriority(),ResourceRequest.ANY,req.getCapability(),req);
}
