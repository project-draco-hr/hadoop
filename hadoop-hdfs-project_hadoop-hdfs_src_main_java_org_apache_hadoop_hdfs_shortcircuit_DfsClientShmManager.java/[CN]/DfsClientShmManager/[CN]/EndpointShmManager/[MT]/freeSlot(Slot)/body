{
  DfsClientShm shm=(DfsClientShm)slot.getShm();
  shm.unregisterSlot(slot.getSlotIdx());
  if (shm.isStale()) {
    Preconditions.checkState(!full.containsKey(shm.getShmId()));
    Preconditions.checkState(!notFull.containsKey(shm.getShmId()));
    if (shm.isEmpty()) {
      if (LOG.isTraceEnabled()) {
        LOG.trace(this + ": freeing empty stale " + shm);
      }
      shm.free();
    }
  }
 else {
    ShmId shmId=shm.getShmId();
    full.remove(shmId);
    if (shm.isEmpty()) {
      notFull.remove(shmId);
      if (LOG.isTraceEnabled()) {
        LOG.trace(this + ": shutting down UNIX domain socket for " + "empty "+ shm);
      }
      shutdown(shm);
    }
 else {
      notFull.put(shmId,shm);
    }
  }
}
