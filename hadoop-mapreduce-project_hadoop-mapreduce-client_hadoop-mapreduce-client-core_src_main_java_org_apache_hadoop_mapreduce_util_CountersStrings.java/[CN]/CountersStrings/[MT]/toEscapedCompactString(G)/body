{
  List<String> escapedStrs=Lists.newArrayList();
  int length;
  String escapedName, escapedDispName;
synchronized (group) {
    escapedName=escape(group.getName());
    escapedDispName=escape(group.getDisplayName());
    int i=0;
    length=escapedName.length() + escapedDispName.length();
    for (    Counter counter : group) {
      String escapedStr=toEscapedCompactString(counter);
      escapedStrs.add(escapedStr);
      length+=escapedStr.length();
    }
  }
  length+=6;
  StringBuilder builder=new StringBuilder(length);
  builder.append(GROUP_OPEN);
  builder.append(UNIT_OPEN);
  builder.append(escapedName);
  builder.append(UNIT_CLOSE);
  builder.append(UNIT_OPEN);
  builder.append(escapedDispName);
  builder.append(UNIT_CLOSE);
  for (  String escaped : escapedStrs) {
    builder.append(escaped);
  }
  builder.append(GROUP_CLOSE);
  return builder.toString();
}
