{
  Resource maxResource;
  ReentrantReadWriteLock.ReadLock readLock=maximumAllocationLock.readLock();
  readLock.lock();
  try {
    if (useConfiguredMaximumAllocationOnly) {
      if (System.currentTimeMillis() - ResourceManager.getClusterTimeStamp() > configuredMaximumAllocationWaitTime) {
        useConfiguredMaximumAllocationOnly=false;
      }
      maxResource=Resources.clone(configuredMaximumAllocation);
    }
 else {
      maxResource=Resources.clone(maximumAllocation);
    }
  }
  finally {
    readLock.unlock();
  }
  return maxResource;
}
