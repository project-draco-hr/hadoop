{
  boolean overwrite=flag.contains(CreateFlag.OVERWRITE);
  boolean create=flag.contains(CreateFlag.CREATE);
  boolean append=flag.contains(CreateFlag.APPEND);
  if (exists(file)) {
    if (overwrite) {
      delete(file,true);
    }
 else     if (append) {
      return append(file,bufferSize,progress);
    }
 else {
      throw new IOException("File already exists: " + file);
    }
  }
 else {
    if (append && !create)     throw new FileNotFoundException("File does not exist: " + file);
  }
  Path parent=file.getParent();
  if (parent != null && !mkdirs(parent)) {
    throw new IOException("Mkdirs failed to create " + parent);
  }
  Path absolute=makeAbsolute(file);
  String srep=absolute.toUri().getPath();
  return kfsImpl.create(srep,replication,bufferSize,progress);
}
