{
  String nsId=DFSUtil.getNamenodeNameServiceId(conf);
  String namenodeId=HAUtil.getNameNodeId(conf,nsId);
  initializeGenericKeys(conf,nsId,namenodeId);
  if (!conf.getBoolean(DFS_NAMENODE_SUPPORT_ALLOW_FORMAT_KEY,DFS_NAMENODE_SUPPORT_ALLOW_FORMAT_DEFAULT)) {
    throw new IOException("The option " + DFS_NAMENODE_SUPPORT_ALLOW_FORMAT_KEY + " is set to false for this filesystem, so it "+ "cannot be formatted. You will need to set "+ DFS_NAMENODE_SUPPORT_ALLOW_FORMAT_KEY+ " parameter "+ "to true in order to format this filesystem");
  }
  Collection<URI> dirsToFormat=FSNamesystem.getNamespaceDirs(conf);
  List<URI> editDirsToFormat=FSNamesystem.getNamespaceEditsDirs(conf);
  for (Iterator<URI> it=dirsToFormat.iterator(); it.hasNext(); ) {
    File curDir=new File(it.next().getPath());
    if (!curDir.exists() || (curDir.isDirectory() && FileUtil.listFiles(curDir).length == 0))     continue;
    if (isConfirmationNeeded) {
      if (!confirmPrompt("Re-format filesystem in " + curDir + " ?")) {
        System.err.println("Format aborted in " + curDir);
        return true;
      }
    }
  }
  String clusterId=StartupOption.FORMAT.getClusterId();
  if (clusterId == null || clusterId.equals("")) {
    clusterId=NNStorage.newClusterID();
  }
  System.out.println("Formatting using clusterid: " + clusterId);
  FSImage fsImage=new FSImage(conf,dirsToFormat,editDirsToFormat);
  FSNamesystem fsn=new FSNamesystem(conf,fsImage);
  fsImage.format(fsn,clusterId);
  return false;
}
