{
synchronized (this) {
    if (stopRequested)     return;
    stopRequested=true;
  }
  try {
    if (state != null) {
      state.exitState(haContext);
    }
  }
 catch (  ServiceFailedException e) {
    LOG.warn("Encountered exception while exiting state ",e);
  }
 finally {
    stopCommonServices();
    if (metrics != null) {
      metrics.shutdown();
    }
    if (namesystem != null) {
      namesystem.shutdown();
    }
    if (nameNodeStatusBeanName != null) {
      MBeans.unregister(nameNodeStatusBeanName);
      nameNodeStatusBeanName=null;
    }
  }
}
