{
synchronized (this) {
    if (stopRequested)     return;
    stopRequested=true;
  }
  if (plugins != null) {
    for (    ServicePlugin p : plugins) {
      try {
        p.stop();
      }
 catch (      Throwable t) {
        LOG.warn("ServicePlugin " + p + " could not be stopped",t);
      }
    }
  }
  try {
    if (httpServer != null)     httpServer.stop();
  }
 catch (  Exception e) {
    LOG.error("Exception while stopping httpserver",e);
  }
  if (namesystem != null)   namesystem.close();
  if (emptier != null)   emptier.interrupt();
  if (rpcServer != null)   rpcServer.stop();
  if (metrics != null) {
    metrics.shutdown();
  }
  if (namesystem != null) {
    namesystem.shutdown();
  }
}
