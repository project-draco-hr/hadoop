{
synchronized (this) {
    if (stopRequested)     return;
    stopRequested=true;
  }
  try {
    state.exitState(haContext);
  }
 catch (  ServiceFailedException e) {
    LOG.warn("Encountered exception while exiting state ",e);
  }
  stopCommonServices();
  if (metrics != null) {
    metrics.shutdown();
  }
  if (namesystem != null) {
    namesystem.shutdown();
  }
}
