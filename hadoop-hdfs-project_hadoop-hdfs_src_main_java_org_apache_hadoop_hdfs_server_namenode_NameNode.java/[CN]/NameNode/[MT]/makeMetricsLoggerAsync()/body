{
  if (!(MetricsLog instanceof Log4JLogger)) {
    LOG.warn("Metrics logging will not be async since the logger is not log4j");
    return;
  }
  org.apache.log4j.Logger logger=((Log4JLogger)MetricsLog).getLogger();
  logger.setAdditivity(false);
  @SuppressWarnings("unchecked") List<Appender> appenders=Collections.list(logger.getAllAppenders());
  if (!appenders.isEmpty() && !(appenders.get(0) instanceof AsyncAppender)) {
    AsyncAppender asyncAppender=new AsyncAppender();
    for (    Appender appender : appenders) {
      logger.removeAppender(appender);
      asyncAppender.addAppender(appender);
    }
    logger.addAppender(asyncAppender);
  }
}
