{
  String nsId=DFSUtil.getNamenodeNameServiceId(conf);
  String namenodeId=HAUtil.getNameNodeId(conf,nsId);
  initializeGenericKeys(conf,nsId,namenodeId);
  FSNamesystem nsys=new FSNamesystem(conf,new FSImage(conf));
  System.err.print("\"finalize\" will remove the previous state of the files system.\n" + "Recent upgrade will become permanent.\n" + "Rollback option will not be available anymore.\n");
  if (isConfirmationNeeded) {
    if (!confirmPrompt("Finalize filesystem state?")) {
      System.err.println("Finalize aborted.");
      return true;
    }
  }
  nsys.dir.fsImage.finalizeUpgrade();
  return false;
}
