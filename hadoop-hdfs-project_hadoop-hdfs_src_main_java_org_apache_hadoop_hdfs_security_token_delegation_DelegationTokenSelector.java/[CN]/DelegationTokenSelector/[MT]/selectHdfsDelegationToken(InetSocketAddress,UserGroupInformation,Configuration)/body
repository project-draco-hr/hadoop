{
  final String key=SERVICE_NAME_KEY + SecurityUtil.buildTokenService(nnAddr);
  final String nnServiceName=conf.get(key);
  int nnRpcPort=NameNode.DEFAULT_PORT;
  if (nnServiceName != null) {
    nnRpcPort=NetUtils.createSocketAddr(nnServiceName,nnRpcPort).getPort();
  }
  final Text serviceName=SecurityUtil.buildTokenService(new InetSocketAddress(nnAddr.getHostName(),nnRpcPort));
  return INSTANCE.selectToken(serviceName,ugi.getTokens());
}
