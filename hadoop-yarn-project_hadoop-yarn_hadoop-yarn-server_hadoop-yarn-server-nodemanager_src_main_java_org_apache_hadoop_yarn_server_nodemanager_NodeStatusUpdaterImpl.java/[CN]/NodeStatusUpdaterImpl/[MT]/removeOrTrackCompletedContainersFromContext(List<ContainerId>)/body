{
  Set<ContainerId> removedContainers=new HashSet<ContainerId>();
  Set<ContainerId> removedNullContainers=new HashSet<ContainerId>();
  pendingContainersToRemove.addAll(containerIds);
  Iterator<ContainerId> iter=pendingContainersToRemove.iterator();
  while (iter.hasNext()) {
    ContainerId containerId=iter.next();
    Container nmContainer=context.getContainers().get(containerId);
    if (nmContainer == null) {
      iter.remove();
      removedNullContainers.add(containerId);
    }
 else     if (nmContainer.getContainerState().equals(org.apache.hadoop.yarn.server.nodemanager.containermanager.container.ContainerState.DONE)) {
      context.getContainers().remove(containerId);
      removedContainers.add(containerId);
      iter.remove();
    }
  }
  Iterator<ContainerTokenIdentifier> killedQueuedContIter=context.getQueuingContext().getKilledQueuedContainers().keySet().iterator();
  while (killedQueuedContIter.hasNext()) {
    if (removedNullContainers.contains(killedQueuedContIter.next().getContainerID())) {
      killedQueuedContIter.remove();
    }
  }
  if (!removedContainers.isEmpty()) {
    LOG.info("Removed completed containers from NM context: " + removedContainers);
  }
  pendingCompletedContainers.clear();
}
