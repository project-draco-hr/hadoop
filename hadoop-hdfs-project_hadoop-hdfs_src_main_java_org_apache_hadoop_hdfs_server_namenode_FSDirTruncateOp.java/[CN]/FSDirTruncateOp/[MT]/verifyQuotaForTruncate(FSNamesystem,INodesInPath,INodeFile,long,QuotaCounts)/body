{
  FSDirectory fsd=fsn.getFSDirectory();
  if (!fsn.isImageLoaded() || fsd.shouldSkipQuotaChecks()) {
    return;
  }
  final BlockStoragePolicy policy=fsd.getBlockStoragePolicySuite().getPolicy(file.getStoragePolicyID());
  file.computeQuotaDeltaForTruncate(newLength,policy,delta);
  fsd.readLock();
  try {
    FSDirectory.verifyQuota(iip,iip.length() - 1,delta,null);
  }
  finally {
    fsd.readUnlock();
  }
}
