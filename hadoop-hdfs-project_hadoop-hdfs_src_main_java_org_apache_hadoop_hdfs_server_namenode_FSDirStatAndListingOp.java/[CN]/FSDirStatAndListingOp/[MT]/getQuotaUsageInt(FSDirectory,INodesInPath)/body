{
  fsd.readLock();
  try {
    INode targetNode=iip.getLastINode();
    QuotaUsage usage=null;
    if (targetNode.isDirectory()) {
      DirectoryWithQuotaFeature feature=targetNode.asDirectory().getDirectoryWithQuotaFeature();
      if (feature != null) {
        QuotaCounts counts=feature.getSpaceConsumed();
        QuotaCounts quotas=feature.getQuota();
        usage=new QuotaUsage.Builder().fileAndDirectoryCount(counts.getNameSpace()).quota(quotas.getNameSpace()).spaceConsumed(counts.getStorageSpace()).spaceQuota(quotas.getStorageSpace()).typeConsumed(counts.getTypeSpaces().asArray()).typeQuota(quotas.getTypeSpaces().asArray()).build();
      }
    }
    return usage;
  }
  finally {
    fsd.readUnlock();
  }
}
