{
  Preconditions.checkState(fsd.hasReadLock());
  Preconditions.checkArgument(iip.isDotSnapshotDir(),"%s does not end with %s",iip.getPath(),HdfsConstants.SEPARATOR_DOT_SNAPSHOT_DIR);
  iip=iip.getParentINodesInPath();
  final String dirPath=iip.getPath();
  final INode node=iip.getLastINode();
  final INodeDirectory dirNode=INodeDirectory.valueOf(node,dirPath);
  final DirectorySnapshottableFeature sf=dirNode.getDirectorySnapshottableFeature();
  if (sf == null) {
    throw new SnapshotException("Directory is not a snapshottable directory: " + dirPath);
  }
  final ReadOnlyList<Snapshot> snapshots=sf.getSnapshotList();
  int skipSize=ReadOnlyList.Util.binarySearch(snapshots,startAfter);
  skipSize=skipSize < 0 ? -skipSize - 1 : skipSize + 1;
  int numOfListing=Math.min(snapshots.size() - skipSize,fsd.getLsLimit());
  final HdfsFileStatus listing[]=new HdfsFileStatus[numOfListing];
  for (int i=0; i < numOfListing; i++) {
    Snapshot.Root sRoot=snapshots.get(i + skipSize).getRoot();
    listing[i]=createFileStatus(fsd,iip,sRoot,HdfsConstants.BLOCK_STORAGE_POLICY_ID_UNSPECIFIED,false);
  }
  return new DirectoryListing(listing,snapshots.size() - skipSize - numOfListing);
}
