{
  LOG.info("testDistributedSchedulingE2E - Register");
  RegisterApplicationMasterResponse responseRegister=client.registerApplicationMaster(RegisterApplicationMasterRequest.newInstance(NetUtils.getHostname(),1024,""));
  Assert.assertNotNull(responseRegister);
  Assert.assertNotNull(responseRegister.getQueue());
  Assert.assertNotNull(responseRegister.getApplicationACLs());
  Assert.assertNotNull(responseRegister.getClientToAMTokenMasterKey());
  Assert.assertNotNull(responseRegister.getContainersFromPreviousAttempts());
  Assert.assertNotNull(responseRegister.getSchedulerResourceTypes());
  Assert.assertNotNull(responseRegister.getMaximumResourceCapability());
  Map<ApplicationId,RMApp> rmApps=cluster.getResourceManager().getRMContext().getRMApps();
  boolean rmUpdated=false;
  for (int i=0; i < 10 && !rmUpdated; i++) {
    sleep(100);
    RMApp rmApp=rmApps.get(appId);
    if (rmApp.getState() == RMAppState.RUNNING) {
      rmUpdated=true;
    }
  }
  RMApp rmApp=rmApps.get(appId);
  Assert.assertEquals(RMAppState.RUNNING,rmApp.getState());
  LOG.info("testDistributedSchedulingE2E - Allocate");
  AllocateRequest request=createAllocateRequest(rmClient.getNodeReports(NodeState.RUNNING));
  List<ResourceRequest> newAskList=new ArrayList<>();
  for (  ResourceRequest rr : request.getAskList()) {
    if (ResourceRequest.ANY.equals(rr.getResourceName())) {
      ResourceRequest newRR=ResourceRequest.newInstance(rr.getPriority(),rr.getResourceName(),rr.getCapability(),rr.getNumContainers(),rr.getRelaxLocality(),rr.getNodeLabelExpression(),ExecutionTypeRequest.newInstance(ExecutionType.OPPORTUNISTIC,true));
      newAskList.add(newRR);
    }
  }
  request.setAskList(newAskList);
  AllocateResponse allocResponse=client.allocate(request);
  Assert.assertNotNull(allocResponse);
  Assert.assertEquals(2,allocResponse.getAllocatedContainers().size());
  for (  Container allocatedContainer : allocResponse.getAllocatedContainers()) {
    ContainerTokenIdentifier containerTokenIdentifier=BuilderUtils.newContainerTokenIdentifier(allocatedContainer.getContainerToken());
    Assert.assertEquals(ExecutionType.OPPORTUNISTIC,containerTokenIdentifier.getExecutionType());
  }
  ResourceScheduler scheduler=cluster.getResourceManager().getResourceScheduler();
  for (  Container allocatedContainer : allocResponse.getAllocatedContainers()) {
    ContainerId containerId=allocatedContainer.getId();
    RMContainer rmContainer=scheduler.getRMContainer(containerId);
    Assert.assertEquals(ExecutionType.OPPORTUNISTIC,rmContainer.getExecutionType());
  }
  LOG.info("testDistributedSchedulingE2E - Finish");
}
