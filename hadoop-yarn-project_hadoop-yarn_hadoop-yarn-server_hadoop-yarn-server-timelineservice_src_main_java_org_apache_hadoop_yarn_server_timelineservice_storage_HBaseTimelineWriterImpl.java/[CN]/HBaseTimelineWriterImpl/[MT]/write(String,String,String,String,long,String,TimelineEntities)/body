{
  TimelineWriteResponse putStatus=new TimelineWriteResponse();
  for (  TimelineEntity te : data.getEntities()) {
    if (te == null) {
      continue;
    }
    boolean isApplication=TimelineStorageUtils.isApplicationEntity(te);
    byte[] rowKey=isApplication ? ApplicationRowKey.getRowKey(clusterId,userId,flowName,flowRunId,appId) : EntityRowKey.getRowKey(clusterId,userId,flowName,flowRunId,appId,te.getType(),te.getId());
    storeInfo(rowKey,te,flowVersion,isApplication);
    storeEvents(rowKey,te.getEvents(),isApplication);
    storeConfig(rowKey,te.getConfigs(),isApplication);
    storeMetrics(rowKey,te.getMetrics(),isApplication);
    storeRelations(rowKey,te,isApplication);
    if (isApplication) {
      TimelineEvent event=TimelineStorageUtils.getApplicationEvent(te,ApplicationMetricsConstants.CREATED_EVENT_TYPE);
      if (event != null) {
        onApplicationCreated(clusterId,userId,flowName,flowVersion,flowRunId,appId,te,event.getTimestamp());
      }
      storeFlowMetricsAppRunning(clusterId,userId,flowName,flowRunId,appId,te);
      event=TimelineStorageUtils.getApplicationEvent(te,ApplicationMetricsConstants.FINISHED_EVENT_TYPE);
      if (event != null) {
        onApplicationFinished(clusterId,userId,flowName,flowVersion,flowRunId,appId,te,event.getTimestamp());
      }
    }
  }
  return putStatus;
}
