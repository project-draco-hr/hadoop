{
  Configuration clientConf=new Configuration(conf);
  clientConf.set(DFS_CLIENT_CONTEXT,"testManyClosedSocketsInCache");
  DistributedFileSystem fs=(DistributedFileSystem)FileSystem.get(cluster.getURI(),clientConf);
  PeerCache peerCache=ClientContext.getFromConf(clientConf).getPeerCache();
  DFSTestUtil.createFile(fs,TEST_FILE,1L,(short)1,0L);
  InputStream[] stms=new InputStream[5];
  try {
    for (int i=0; i < stms.length; i++) {
      stms[i]=fs.open(TEST_FILE);
    }
    for (    InputStream stm : stms) {
      IOUtils.copyBytes(stm,new NullOutputStream(),1024);
    }
  }
  finally {
    IOUtils.cleanup(null,stms);
  }
  assertEquals(5,peerCache.size());
  Thread.sleep(1500);
  assertXceiverCount(0);
  assertEquals(5,peerCache.size());
  DFSTestUtil.readFile(fs,TEST_FILE);
}
