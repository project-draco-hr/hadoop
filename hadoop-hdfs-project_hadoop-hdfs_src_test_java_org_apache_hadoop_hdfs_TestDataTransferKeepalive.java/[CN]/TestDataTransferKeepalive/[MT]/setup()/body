{
  conf.setInt(DFS_DATANODE_SOCKET_REUSE_KEEPALIVE_KEY,KEEPALIVE_TIMEOUT);
  conf.setInt(DFS_CLIENT_MAX_BLOCK_ACQUIRE_FAILURES_KEY,0);
  cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  fs=cluster.getFileSystem();
  dfsClient=((DistributedFileSystem)fs).dfs;
  dfsClient.peerCache.clear();
  String poolId=cluster.getNamesystem().getBlockPoolId();
  dn=cluster.getDataNodes().get(0);
  DatanodeRegistration dnReg=DataNodeTestUtils.getDNRegistrationForBP(dn,poolId);
  dnAddr=NetUtils.createSocketAddr(dnReg.getXferAddr());
}
