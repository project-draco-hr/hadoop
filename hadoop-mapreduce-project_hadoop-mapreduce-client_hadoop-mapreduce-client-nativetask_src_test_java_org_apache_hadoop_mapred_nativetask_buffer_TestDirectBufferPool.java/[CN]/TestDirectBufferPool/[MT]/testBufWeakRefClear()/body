{
  final DirectBufferPool bufferPool=DirectBufferPool.getInstance();
  int numOfBufs=100;
  int capacity=100;
  ByteBuffer[] list=new ByteBuffer[capacity];
  for (int i=0; i < numOfBufs; i++) {
    list[i]=bufferPool.borrowBuffer(capacity);
  }
  for (int i=0; i < numOfBufs; i++) {
    bufferPool.returnBuffer(list[i]);
    list[i]=null;
  }
  assertEquals(numOfBufs,bufferPool.getBufCountsForCapacity(capacity));
  for (int i=0; i < 3; i++) {
    System.gc();
  }
  ByteBuffer b=bufferPool.borrowBuffer(capacity);
  assertEquals(0,bufferPool.getBufCountsForCapacity(capacity));
}
