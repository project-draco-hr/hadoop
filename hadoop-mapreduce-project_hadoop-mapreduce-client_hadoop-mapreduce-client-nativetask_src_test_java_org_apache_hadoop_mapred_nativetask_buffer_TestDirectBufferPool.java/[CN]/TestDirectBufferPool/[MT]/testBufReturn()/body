{
  final DirectBufferPool bufferPool=DirectBufferPool.getInstance();
  int numOfBufs=100;
  int capacity=100;
  final ByteBuffer[] bufs=new ByteBuffer[numOfBufs];
  for (int i=0; i < numOfBufs; i++) {
    bufs[i]=bufferPool.borrowBuffer(capacity);
  }
  assertEquals(0,bufferPool.getBufCountsForCapacity(capacity));
  int numOfThreads=numOfBufs;
  Thread[] list=new Thread[numOfThreads];
  for (int i=0; i < numOfThreads; i++) {
    Thread t=retBufThread(bufferPool,bufs,i);
    t.start();
    list[i]=t;
  }
  for (int i=0; i < numOfThreads; i++) {
    try {
      list[i].join(10000);
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
  }
  assertEquals(numOfBufs,bufferPool.getBufCountsForCapacity(capacity));
}
