{
  Configuration conf=new Configuration();
  RPC.setProtocolEngine(conf,AvroSpecificTestProtocol.class,AvroSpecificRpcEngine.class);
  Server server=RPC.getServer(AvroSpecificTestProtocol.class,new AvroSpecificTestProtocolImpl(),ADDRESS,0,conf);
  AvroSpecificTestProtocol proxy=null;
  try {
    server.start();
    InetSocketAddress addr=NetUtils.getConnectAddress(server);
    proxy=(AvroSpecificTestProtocol)RPC.getProxy(AvroSpecificTestProtocol.class,0,addr,conf);
    Utf8 echo=proxy.echo(new Utf8("hello world"));
    assertEquals("hello world",echo.toString());
    int intResult=proxy.add(1,2);
    assertEquals(3,intResult);
  }
  finally {
    server.stop();
  }
}
