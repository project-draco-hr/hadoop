{
  MiniDFSNNTopology top=new MiniDFSNNTopology().addNameservice(new MiniDFSNNTopology.NSConf("ns1").addNN(new MiniDFSNNTopology.NNConf("nn0")).addNN(new MiniDFSNNTopology.NNConf("nn1"))).addNameservice(new MiniDFSNNTopology.NSConf("ns2").addNN(new MiniDFSNNTopology.NNConf("nn2").setClusterId("bad-cid")).addNN(new MiniDFSNNTopology.NNConf("nn3").setClusterId("bad-cid")));
  top.setFederation(true);
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).nnTopology(top).numDataNodes(0).build();
  try {
    cluster.startDataNodes(conf,1,true,null,null);
    Thread.sleep(10000);
    DataNode dn=cluster.getDataNodes().get(0);
    assertTrue("Datanode should be running",dn.isDatanodeUp());
    assertEquals("Only one BPOfferService should be running",1,dn.getAllBpOs().length);
  }
  finally {
    cluster.shutdown();
  }
}
