{
  RecoveredApplicationsState state=new RecoveredApplicationsState();
  state.applications=new ArrayList<ContainerManagerApplicationProto>();
  String keyPrefix=APPLICATIONS_KEY_PREFIX;
  LeveldbIterator iter=null;
  try {
    iter=new LeveldbIterator(db);
    iter.seek(bytes(keyPrefix));
    while (iter.hasNext()) {
      Entry<byte[],byte[]> entry=iter.next();
      String key=asString(entry.getKey());
      if (!key.startsWith(keyPrefix)) {
        break;
      }
      state.applications.add(ContainerManagerApplicationProto.parseFrom(entry.getValue()));
    }
    state.finishedApplications=new ArrayList<ApplicationId>();
    keyPrefix=FINISHED_APPS_KEY_PREFIX;
    iter.seek(bytes(keyPrefix));
    while (iter.hasNext()) {
      Entry<byte[],byte[]> entry=iter.next();
      String key=asString(entry.getKey());
      if (!key.startsWith(keyPrefix)) {
        break;
      }
      ApplicationId appId=ConverterUtils.toApplicationId(key.substring(keyPrefix.length()));
      state.finishedApplications.add(appId);
    }
  }
 catch (  DBException e) {
    throw new IOException(e);
  }
 finally {
    if (iter != null) {
      iter.close();
    }
  }
  return state;
}
