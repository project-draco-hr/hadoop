{
  FileSystem sourceFS=sourcePathRoot.getFileSystem(getConf());
  Stack<FileStatus> pathStack=new Stack<FileStatus>();
  pathStack.push(sourceStatus);
  while (!pathStack.isEmpty()) {
    for (    FileStatus child : getChildren(sourceFS,pathStack.pop())) {
      if (LOG.isDebugEnabled())       LOG.debug("Recording source-path: " + sourceStatus.getPath() + " for copy.");
      CopyListingFileStatus childCopyListingStatus=DistCpUtils.toCopyListingFileStatus(sourceFS,child,options.shouldPreserve(FileAttribute.ACL) && child.isDirectory(),options.shouldPreserve(FileAttribute.XATTR) && child.isDirectory());
      writeToFileListing(fileListWriter,childCopyListingStatus,sourcePathRoot,options);
      if (isDirectoryAndNotEmpty(sourceFS,child)) {
        if (LOG.isDebugEnabled())         LOG.debug("Traversing non-empty source dir: " + sourceStatus.getPath());
        pathStack.push(child);
      }
    }
  }
}
