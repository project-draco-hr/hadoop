{
  final boolean preserveAcls=options.shouldPreserve(FileAttribute.ACL);
  final boolean preserveXAttrs=options.shouldPreserve(FileAttribute.XATTR);
  final boolean preserveRawXattrs=options.shouldPreserveRawXattrs();
  Stack<FileStatus> pathStack=new Stack<FileStatus>();
  pathStack.push(sourceStatus);
  while (!pathStack.isEmpty()) {
    for (    FileStatus child : getChildren(sourceFS,pathStack.pop())) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Recording source-path: " + child.getPath() + " for copy.");
      }
      CopyListingFileStatus childCopyListingStatus=DistCpUtils.toCopyListingFileStatus(sourceFS,child,preserveAcls && child.isDirectory(),preserveXAttrs && child.isDirectory(),preserveRawXattrs && child.isDirectory());
      writeToFileListing(fileListWriter,childCopyListingStatus,sourcePathRoot,options);
      if (child.isDirectory()) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Traversing into source dir: " + child.getPath());
        }
        pathStack.push(child);
      }
    }
  }
}
