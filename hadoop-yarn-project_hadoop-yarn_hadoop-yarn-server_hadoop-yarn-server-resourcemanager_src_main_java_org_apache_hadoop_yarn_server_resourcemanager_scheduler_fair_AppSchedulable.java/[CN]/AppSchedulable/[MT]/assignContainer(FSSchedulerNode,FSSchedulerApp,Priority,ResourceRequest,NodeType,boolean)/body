{
  Resource capability=request.getCapability();
  Resource available=node.getAvailableResource();
  Container container=null;
  if (reserved) {
    container=node.getReservedContainer().getContainer();
  }
 else {
    container=createContainer(application,node,capability,priority);
  }
  int availableContainers=available.getMemory() / capability.getMemory();
  if (availableContainers > 0) {
    RMContainer allocatedContainer=application.allocate(type,node,priority,request,container);
    if (allocatedContainer == null) {
      return Resources.none();
    }
 else {
      getMetrics().setAvailableResourcesToQueue(scheduler.getClusterCapacity());
    }
    if (reserved) {
      unreserve(application,priority,node);
    }
    node.allocateContainer(application.getApplicationId(),allocatedContainer);
    return container.getResource();
  }
 else {
    reserve(application,priority,node,container,reserved);
    return Resources.none();
  }
}
