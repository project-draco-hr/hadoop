{
  GraphiteSink sink=new GraphiteSink();
  List<MetricsTag> tags=new ArrayList<MetricsTag>();
  tags.add(new MetricsTag(MsInfo.Context,"all"));
  tags.add(new MetricsTag(MsInfo.Hostname,"host"));
  Set<AbstractMetric> metrics=new HashSet<AbstractMetric>();
  metrics.add(makeMetric("foo1",1.25));
  metrics.add(makeMetric("foo2",2.25));
  MetricsRecord record=new MetricsRecordImpl(MsInfo.Context,(long)10000,tags,metrics);
  OutputStreamWriter writer=mock(OutputStreamWriter.class);
  Whitebox.setInternalState(sink,"writer",writer);
  sink.close();
  sink.putMetrics(record);
}
