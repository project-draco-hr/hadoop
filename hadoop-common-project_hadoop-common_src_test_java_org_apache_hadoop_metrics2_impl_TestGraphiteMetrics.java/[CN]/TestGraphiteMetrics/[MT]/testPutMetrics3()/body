{
  GraphiteSink sink=new GraphiteSink();
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  Whitebox.setInternalState(sink,"writer",new OutputStreamWriter(out));
  List<MetricsTag> tags=Collections.emptyList();
  Set<AbstractMetric> metrics=new HashSet<AbstractMetric>();
  metrics.add(makeMetric("foo1",1));
  MetricsRecord record1=new MetricsRecordImpl(MsInfo.Context,1000000000000L,tags,metrics);
  MetricsRecord record2=new MetricsRecordImpl(MsInfo.Context,1000000001000L,tags,metrics);
  sink.putMetrics(record1);
  sink.putMetrics(record2);
  sink.flush();
  try {
    sink.close();
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
  String expectedOutput="null.default.Context.foo1 1 1000000000\n" + "null.default.Context.foo1 1 1000000001\n";
  assertEquals(expectedOutput,out.toString());
}
