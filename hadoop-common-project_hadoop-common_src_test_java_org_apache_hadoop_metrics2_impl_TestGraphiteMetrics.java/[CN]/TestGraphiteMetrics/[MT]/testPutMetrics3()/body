{
  GraphiteSink sink=new GraphiteSink();
  final GraphiteSink.Graphite mockGraphite=makeGraphite();
  Whitebox.setInternalState(sink,"graphite",mockGraphite);
  List<MetricsTag> tags=Collections.emptyList();
  Set<AbstractMetric> metrics=new HashSet<AbstractMetric>();
  metrics.add(makeMetric("foo1",1));
  MetricsRecord record1=new MetricsRecordImpl(MsInfo.Context,1000000000000L,tags,metrics);
  MetricsRecord record2=new MetricsRecordImpl(MsInfo.Context,1000000001000L,tags,metrics);
  sink.putMetrics(record1);
  sink.putMetrics(record2);
  sink.flush();
  try {
    sink.close();
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
  try {
    verify(mockGraphite).write(eq("null.default.Context.foo1 1 1000000000\n"));
    verify(mockGraphite).write(eq("null.default.Context.foo1 1 1000000001\n"));
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
}
