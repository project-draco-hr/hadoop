{
  Map<Object,Integer> nextCache=new HashMap<Object,Integer>();
  for (  Map.Entry<Object,AtomicLong> entry : callCounts.entrySet()) {
    Object id=entry.getKey();
    AtomicLong value=entry.getValue();
    long snapshot=value.get();
    int computedLevel=computePriorityLevel(snapshot);
    nextCache.put(id,computedLevel);
  }
  scheduleCacheRef.set(Collections.unmodifiableMap(nextCache));
}
