{
  try {
    long total=0;
    Iterator<Map.Entry<Object,AtomicLong>> it=callCounts.entrySet().iterator();
    while (it.hasNext()) {
      Map.Entry<Object,AtomicLong> entry=it.next();
      AtomicLong count=entry.getValue();
      long currentValue=count.get();
      long nextValue=(long)(currentValue * decayFactor);
      total+=nextValue;
      count.set(nextValue);
      if (nextValue == 0) {
        it.remove();
      }
    }
    totalCalls.set(total);
    recomputeScheduleCache();
    updateAverageResponseTime(true);
  }
 catch (  Exception ex) {
    LOG.error("decayCurrentCounts exception: " + ExceptionUtils.getFullStackTrace(ex));
    throw ex;
  }
}
