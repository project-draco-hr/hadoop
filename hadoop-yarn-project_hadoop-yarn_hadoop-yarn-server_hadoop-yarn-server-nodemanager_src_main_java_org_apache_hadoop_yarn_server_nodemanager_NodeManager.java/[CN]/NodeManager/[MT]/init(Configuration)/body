{
  conf.setBoolean(Dispatcher.DISPATCHER_EXIT_ON_ERROR_KEY,true);
  NMContainerTokenSecretManager containerTokenSecretManager=null;
  if (UserGroupInformation.isSecurityEnabled()) {
    LOG.info("Security is enabled on NodeManager. " + "Creating ContainerTokenSecretManager");
    containerTokenSecretManager=new NMContainerTokenSecretManager(conf);
  }
  Context context=new NMContext(containerTokenSecretManager);
  this.aclsManager=new ApplicationACLsManager(conf);
  ContainerExecutor exec=ReflectionUtils.newInstance(conf.getClass(YarnConfiguration.NM_CONTAINER_EXECUTOR,DefaultContainerExecutor.class,ContainerExecutor.class),conf);
  try {
    exec.init();
  }
 catch (  IOException e) {
    throw new YarnException("Failed to initialize container executor",e);
  }
  DeletionService del=new DeletionService(exec);
  addService(del);
  AsyncDispatcher dispatcher=new AsyncDispatcher();
  nodeHealthChecker=new NodeHealthCheckerService();
  addService(nodeHealthChecker);
  dirsHandler=nodeHealthChecker.getDiskHandler();
  NodeStatusUpdater nodeStatusUpdater=createNodeStatusUpdater(context,dispatcher,nodeHealthChecker);
  nodeStatusUpdater.register(this);
  NodeResourceMonitor nodeResourceMonitor=createNodeResourceMonitor();
  addService(nodeResourceMonitor);
  ContainerManagerImpl containerManager=createContainerManager(context,exec,del,nodeStatusUpdater,this.aclsManager,dirsHandler);
  addService(containerManager);
  Service webServer=createWebServer(context,containerManager.getContainersMonitor(),this.aclsManager,dirsHandler);
  addService(webServer);
  dispatcher.register(ContainerManagerEventType.class,containerManager);
  addService(dispatcher);
  DefaultMetricsSystem.initialize("NodeManager");
  addService(nodeStatusUpdater);
  super.init(conf);
}
