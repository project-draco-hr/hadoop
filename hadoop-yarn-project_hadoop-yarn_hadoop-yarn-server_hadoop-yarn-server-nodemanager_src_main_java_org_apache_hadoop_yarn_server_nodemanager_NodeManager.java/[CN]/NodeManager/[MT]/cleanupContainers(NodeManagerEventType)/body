{
  Map<ContainerId,Container> containers=context.getContainers();
  if (containers.isEmpty()) {
    return;
  }
  LOG.info("Containers still running on " + eventType + " : "+ containers.keySet());
  List<ContainerId> containerIds=new ArrayList<ContainerId>(containers.keySet());
  dispatcher.getEventHandler().handle(new CMgrCompletedContainersEvent(containerIds,CMgrCompletedContainersEvent.Reason.ON_SHUTDOWN));
  LOG.info("Waiting for containers to be killed");
switch (eventType) {
case SHUTDOWN:
    long waitStartTime=System.currentTimeMillis();
  while (!containers.isEmpty() && System.currentTimeMillis() - waitStartTime < waitForContainersOnShutdownMillis) {
    try {
      nodeStatusUpdater.getNodeStatusAndUpdateContainersInContext();
      Thread.sleep(1000);
    }
 catch (    InterruptedException ex) {
      LOG.warn("Interrupted while sleeping on container kill on shutdown",ex);
    }
  }
break;
case RESYNC:
while (!containers.isEmpty()) {
try {
  Thread.sleep(1000);
  nodeStatusUpdater.getNodeStatusAndUpdateContainersInContext();
}
 catch (InterruptedException ex) {
  LOG.warn("Interrupted while sleeping on container kill on resync",ex);
}
}
break;
default :
LOG.warn("Invalid eventType: " + eventType);
}
if (containers.isEmpty()) {
LOG.info("All containers in DONE state");
}
 else {
LOG.info("Done waiting for containers to be killed. Still alive: " + containers.keySet());
}
}
