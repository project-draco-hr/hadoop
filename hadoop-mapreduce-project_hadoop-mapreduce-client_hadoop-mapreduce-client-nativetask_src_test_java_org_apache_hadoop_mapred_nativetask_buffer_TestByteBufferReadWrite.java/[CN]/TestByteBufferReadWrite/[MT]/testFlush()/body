{
  byte[] buff=new byte[10];
  final Counter flushCount=new Counter();
  final Flag finishFlag=new Flag();
  MockDataTarget target=new MockDataTarget(buff){
    @Override public void sendData() throws IOException {
      flushCount.increase();
    }
    @Override public void finishSendData() throws IOException {
      finishFlag.set(true);
    }
  }
;
  ByteBufferDataWriter writer=new ByteBufferDataWriter(target);
  Assert.assertEquals(false,writer.hasUnFlushedData());
  writer.write(1);
  writer.write(new byte[100]);
  Assert.assertEquals(true,writer.hasUnFlushedData());
  writer.close();
  Assert.assertEquals(11,flushCount.get());
  Assert.assertEquals(true,finishFlag.get());
}
