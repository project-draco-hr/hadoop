{
  final int configuredMaxVCores=20;
  final int configuredMaxMemory=10 * 1024;
  Resource configuredMaximumResource=Resource.newInstance(configuredMaxMemory,configuredMaxVCores);
  YarnConfiguration conf=getConf();
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MAXIMUM_ALLOCATION_VCORES,configuredMaxVCores);
  conf.setInt(YarnConfiguration.RM_SCHEDULER_MAXIMUM_ALLOCATION_MB,configuredMaxMemory);
  conf.setLong(YarnConfiguration.RM_WORK_PRESERVING_RECOVERY_SCHEDULING_WAIT_MS,0);
  MockRM rm=new MockRM(conf);
  try {
    rm.start();
    AbstractYarnScheduler scheduler=(AbstractYarnScheduler)rm.getResourceScheduler();
    Resource emptyResource=Resource.newInstance(0,0);
    Resource fullResource1=Resource.newInstance(1024,5);
    Resource fullResource2=Resource.newInstance(2048,10);
    SchedulerNode mockNode1=mock(SchedulerNode.class);
    when(mockNode1.getNodeID()).thenReturn(NodeId.newInstance("foo",8080));
    when(mockNode1.getUnallocatedResource()).thenReturn(emptyResource);
    when(mockNode1.getTotalResource()).thenReturn(fullResource1);
    SchedulerNode mockNode2=mock(SchedulerNode.class);
    when(mockNode1.getNodeID()).thenReturn(NodeId.newInstance("bar",8081));
    when(mockNode2.getUnallocatedResource()).thenReturn(emptyResource);
    when(mockNode2.getTotalResource()).thenReturn(fullResource2);
    verifyMaximumResourceCapability(configuredMaximumResource,scheduler);
    scheduler.nodeTracker.addNode(mockNode1);
    verifyMaximumResourceCapability(fullResource1,scheduler);
    scheduler.nodeTracker.addNode(mockNode2);
    verifyMaximumResourceCapability(fullResource2,scheduler);
    scheduler.nodeTracker.removeNode(mockNode2.getNodeID());
    verifyMaximumResourceCapability(fullResource1,scheduler);
    scheduler.nodeTracker.removeNode(mockNode1.getNodeID());
    verifyMaximumResourceCapability(configuredMaximumResource,scheduler);
  }
  finally {
    rm.stop();
  }
}
