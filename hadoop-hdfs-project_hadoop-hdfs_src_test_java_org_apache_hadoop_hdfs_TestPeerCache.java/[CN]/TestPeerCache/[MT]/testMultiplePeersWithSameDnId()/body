{
  DatanodeID dnId=new DatanodeID("192.168.0.1","fakehostname","fake_storage_id",100,101,102);
  HashSet<FakePeer> peers=new HashSet<FakePeer>(CAPACITY);
  for (int i=0; i < CAPACITY; ++i) {
    FakePeer peer=new FakePeer(dnId);
    peers.add(peer);
    cache.put(dnId,peer);
  }
  assertEquals(CAPACITY,cache.size());
  while (!peers.isEmpty()) {
    Peer peer=cache.get(dnId);
    assertTrue(peer != null);
    assertTrue(!peer.isClosed());
    peers.remove(peer);
  }
  assertEquals(0,cache.size());
  cache.clear();
}
