{
  if (codec != null) {
    Class<T> codecClass=ReflectionUtils.getClass(codec);
    Set<T> codecSet;
synchronized (pool) {
      codecSet=pool.get(codecClass);
      if (codecSet == null) {
        codecSet=new HashSet<T>();
        pool.put(codecClass,codecSet);
      }
    }
synchronized (codecSet) {
      return codecSet.add(codec);
    }
  }
  return false;
}
