{
  setUpCluster(2,2,true);
  scheduler.assignMultiple=true;
  JobInProgress job1=submitJob(JobStatus.RUNNING,8,0,"pool1",new String[][]{{"rack2.node2"},{"rack2.node2"},{"rack2.node2"},{"rack2.node2"},{"rack2.node2"},{"rack2.node2"},{"rack2.node2"},{"rack2.node2"}},true);
  JobInfo info1=scheduler.infos.get(job1);
  advanceTime(100);
  assertNull(scheduler.assignTasks(tracker("tt1")));
  assertNull(scheduler.assignTasks(tracker("tt2")));
  assertNull(scheduler.assignTasks(tracker("tt3")));
  advanceTime(6000);
  assertNull(scheduler.assignTasks(tracker("tt1")));
  assertNull(scheduler.assignTasks(tracker("tt2")));
  advanceTime(100);
  assertNull(scheduler.assignTasks(tracker("tt1")));
  assertNull(scheduler.assignTasks(tracker("tt2")));
  advanceTime(100);
  assertNull(scheduler.assignTasks(tracker("tt1")));
  assertNull(scheduler.assignTasks(tracker("tt2")));
  assertEquals(info1.lastMapLocalityLevel,LocalityLevel.NODE);
  assertEquals(info1.timeWaitedForLocalMap,6200);
  assertEquals(info1.skippedAtLastHeartbeat,true);
  advanceTime(11000);
  checkAssignment("tt1","attempt_test_0001_m_000000_0 on tt1","attempt_test_0001_m_000001_0 on tt1");
  checkAssignment("tt2","attempt_test_0001_m_000002_0 on tt2","attempt_test_0001_m_000003_0 on tt2");
  assertEquals(info1.lastMapLocalityLevel,LocalityLevel.ANY);
  assertEquals(info1.timeWaitedForLocalMap,0);
  assertEquals(info1.skippedAtLastHeartbeat,false);
  checkAssignment("tt3","attempt_test_0001_m_000004_0 on tt3","attempt_test_0001_m_000005_0 on tt3");
  assertEquals(info1.lastMapLocalityLevel,LocalityLevel.RACK);
  assertEquals(info1.timeWaitedForLocalMap,0);
  assertEquals(info1.skippedAtLastHeartbeat,false);
  taskTrackerManager.finishTask("tt1","attempt_test_0001_m_000001_0");
  taskTrackerManager.finishTask("tt2","attempt_test_0001_m_000003_0");
  advanceTime(100);
  assertNull(scheduler.assignTasks(tracker("tt1")));
  assertNull(scheduler.assignTasks(tracker("tt2")));
  taskTrackerManager.finishTask("tt3","attempt_test_0001_m_000004_0");
  advanceTime(100);
  checkAssignment("tt3","attempt_test_0001_m_000006_0 on tt3");
  checkAssignment("tt4","attempt_test_0001_m_000007_0 on tt4");
  assertEquals(info1.lastMapLocalityLevel,LocalityLevel.NODE);
  assertEquals(info1.timeWaitedForLocalMap,0);
  assertEquals(info1.skippedAtLastHeartbeat,false);
}
