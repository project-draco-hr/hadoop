{
  String name=StringUtils.popFirstNonOption(args);
  final boolean printStats=StringUtils.popOption("-stats",args);
  if (!args.isEmpty()) {
    System.err.print("Can't understand arguments: " + Joiner.on(" ").join(args) + "\n");
    System.err.println("Usage is " + getShortUsage());
    return 1;
  }
  DistributedFileSystem dfs=getDFS(conf);
  TableListing.Builder builder=new TableListing.Builder().addField("NAME",Justification.LEFT).addField("OWNER",Justification.LEFT).addField("GROUP",Justification.LEFT).addField("MODE",Justification.LEFT).addField("LIMIT",Justification.RIGHT).addField("MAXTTL",Justification.RIGHT);
  if (printStats) {
    builder.addField("BYTES_NEEDED",Justification.RIGHT).addField("BYTES_CACHED",Justification.RIGHT).addField("BYTES_OVERLIMIT",Justification.RIGHT).addField("FILES_NEEDED",Justification.RIGHT).addField("FILES_CACHED",Justification.RIGHT);
  }
  TableListing listing=builder.build();
  int numResults=0;
  try {
    RemoteIterator<CachePoolEntry> iter=dfs.listCachePools();
    while (iter.hasNext()) {
      CachePoolEntry entry=iter.next();
      CachePoolInfo info=entry.getInfo();
      LinkedList<String> row=new LinkedList<String>();
      if (name == null || info.getPoolName().equals(name)) {
        row.add(info.getPoolName());
        row.add(info.getOwnerName());
        row.add(info.getGroupName());
        row.add(info.getMode() != null ? info.getMode().toString() : null);
        Long limit=info.getLimit();
        String limitString;
        if (limit != null && limit.equals(CachePoolInfo.LIMIT_UNLIMITED)) {
          limitString="unlimited";
        }
 else {
          limitString="" + limit;
        }
        row.add(limitString);
        Long maxTtl=info.getMaxRelativeExpiryMs();
        String maxTtlString=null;
        if (maxTtl != null) {
          if (maxTtl.longValue() == CachePoolInfo.RELATIVE_EXPIRY_NEVER) {
            maxTtlString="never";
          }
 else {
            maxTtlString=DFSUtil.durationToString(maxTtl);
          }
        }
        row.add(maxTtlString);
        if (printStats) {
          CachePoolStats stats=entry.getStats();
          row.add(Long.toString(stats.getBytesNeeded()));
          row.add(Long.toString(stats.getBytesCached()));
          row.add(Long.toString(stats.getBytesOverlimit()));
          row.add(Long.toString(stats.getFilesNeeded()));
          row.add(Long.toString(stats.getFilesCached()));
        }
        listing.addRow(row.toArray(new String[]{}));
        ++numResults;
        if (name != null) {
          break;
        }
      }
    }
  }
 catch (  IOException e) {
    System.err.println(prettifyException(e));
    return 2;
  }
  System.out.print(String.format("Found %d result%s.%n",numResults,(numResults == 1 ? "" : "s")));
  if (numResults > 0) {
    System.out.print(listing);
  }
  return 0;
}
