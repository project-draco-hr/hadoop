{
  bm.verifyReplication(src,replication,null);
  final boolean isFile;
  FSPermissionChecker pc=fsd.getPermissionChecker();
  byte[][] pathComponents=FSDirectory.getPathComponentsForReservedPath(src);
  fsd.writeLock();
  try {
    src=fsd.resolvePath(pc,src,pathComponents);
    final INodesInPath iip=fsd.getINodesInPath4Write(src);
    if (fsd.isPermissionEnabled()) {
      fsd.checkPathAccess(pc,iip,FsAction.WRITE);
    }
    final short[] blockRepls=new short[2];
    final BlockInfo[] blocks=unprotectedSetReplication(fsd,src,replication,blockRepls);
    isFile=blocks != null;
    if (isFile) {
      fsd.getEditLog().logSetReplication(src,replication);
      bm.setReplication(blockRepls[0],blockRepls[1],src,blocks);
    }
  }
  finally {
    fsd.writeUnlock();
  }
  return isFile;
}
