{
  if (fsd.isPermissionEnabled()) {
    FSPermissionChecker pc=fsd.getPermissionChecker();
    pc.checkSuperuserPrivilege();
  }
  fsd.writeLock();
  try {
    INodeDirectory changed=unprotectedSetQuota(fsd,src,nsQuota,dsQuota,type);
    if (changed != null) {
      final QuotaCounts q=changed.getQuotaCounts();
      if (type == null) {
        fsd.getEditLog().logSetQuota(src,q.getNameSpace(),q.getDiskSpace());
      }
 else {
        fsd.getEditLog().logSetQuotaByStorageType(src,q.getTypeSpaces().get(type),type);
      }
    }
  }
  finally {
    fsd.writeUnlock();
  }
}
