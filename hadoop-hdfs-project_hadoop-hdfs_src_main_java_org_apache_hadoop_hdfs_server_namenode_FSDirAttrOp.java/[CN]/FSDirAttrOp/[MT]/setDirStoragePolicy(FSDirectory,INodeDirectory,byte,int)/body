{
  List<XAttr> existingXAttrs=XAttrStorage.readINodeXAttrs(inode);
  XAttr xAttr=BlockStoragePolicySuite.buildXAttr(policyId);
  List<XAttr> newXAttrs=null;
  if (policyId == HdfsConstants.BLOCK_STORAGE_POLICY_ID_UNSPECIFIED) {
    List<XAttr> toRemove=Lists.newArrayList();
    toRemove.add(xAttr);
    List<XAttr> removed=Lists.newArrayList();
    newXAttrs=FSDirXAttrOp.filterINodeXAttrs(existingXAttrs,toRemove,removed);
  }
 else {
    newXAttrs=FSDirXAttrOp.setINodeXAttrs(fsd,existingXAttrs,Arrays.asList(xAttr),EnumSet.of(XAttrSetFlag.CREATE,XAttrSetFlag.REPLACE));
  }
  XAttrStorage.updateINodeXAttrs(inode,newXAttrs,latestSnapshotId);
}
