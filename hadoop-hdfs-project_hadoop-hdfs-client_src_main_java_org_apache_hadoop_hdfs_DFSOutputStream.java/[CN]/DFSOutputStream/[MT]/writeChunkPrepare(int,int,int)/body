{
  dfsClient.checkOpen();
  checkClosed();
  if (buflen > bytesPerChecksum) {
    throw new IOException("writeChunk() buffer size is " + buflen + " is larger than supported  bytesPerChecksum "+ bytesPerChecksum);
  }
  if (cklen != 0 && cklen != getChecksumSize()) {
    throw new IOException("writeChunk() checksum size is supposed to be " + getChecksumSize() + " but found to be "+ cklen);
  }
  if (currentPacket == null) {
    currentPacket=createPacket(packetSize,chunksPerPacket,getStreamer().getBytesCurBlock(),getStreamer().getAndIncCurrentSeqno(),false);
    DFSClient.LOG.debug("WriteChunk allocating new packet seqno={}," + " src={}, packetSize={}, chunksPerPacket={}, bytesCurBlock={}",currentPacket.getSeqno(),src,packetSize,chunksPerPacket,getStreamer().getBytesCurBlock() + ", " + this);
  }
}
