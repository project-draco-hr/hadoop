{
  checkBlockPool(bpid);
  checkBlock(block);
synchronized (mutex) {
    LightWeightResizableGSet<Block,ReplicaInfo> m=map.get(bpid);
    if (m != null) {
      ReplicaInfo replicaInfo=m.get(block);
      if (replicaInfo != null && block.getGenerationStamp() == replicaInfo.getGenerationStamp()) {
        return m.remove(block);
      }
    }
  }
  return null;
}
