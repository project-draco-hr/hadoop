{
  checkBlockPool(bpid);
  checkBlock(replicaInfo);
synchronized (mutex) {
    FoldedTreeSet<ReplicaInfo> set=map.get(bpid);
    if (set == null) {
      set=new FoldedTreeSet<>();
      map.put(bpid,set);
    }
    return set.addOrReplace(replicaInfo);
  }
}
