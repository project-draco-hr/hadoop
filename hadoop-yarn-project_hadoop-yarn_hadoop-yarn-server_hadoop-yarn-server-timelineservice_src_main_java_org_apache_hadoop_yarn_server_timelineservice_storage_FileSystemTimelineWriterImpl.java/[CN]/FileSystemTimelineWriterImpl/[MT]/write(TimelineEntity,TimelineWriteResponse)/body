{
  PrintWriter out=null;
  try {
    File outputDir=new File(outputRoot + entity.getType());
    String fileName=outputDir + "/" + entity.getId()+ TIMELINE_SERVICE_STORAGE_EXTENSION;
    if (!outputDir.exists()) {
      if (!outputDir.mkdirs()) {
        throw new IOException("Could not create directories for " + fileName);
      }
    }
    out=new PrintWriter(new BufferedWriter(new FileWriter(fileName,true)));
    out.println(TimelineUtils.dumpTimelineRecordtoJSON(entity));
    out.write("\n");
  }
 catch (  IOException ioe) {
    TimelineWriteError error=new TimelineWriteError();
    error.setEntityId(entity.getId());
    error.setEntityType(entity.getType());
    response.addError(error);
  }
 finally {
    if (out != null) {
      out.close();
    }
  }
}
