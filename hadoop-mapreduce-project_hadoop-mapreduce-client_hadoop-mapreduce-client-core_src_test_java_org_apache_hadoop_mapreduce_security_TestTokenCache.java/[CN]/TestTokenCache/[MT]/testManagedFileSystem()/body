{
  Credentials credentials=new Credentials();
  Configuration conf=new Configuration();
  conf.set(YarnConfiguration.RM_PRINCIPAL,"mapred/host@REALM");
  String renewer=Master.getMasterPrincipal(conf);
  FileSystem singleFs=setupSingleFs();
  FileSystem multiFs=setupMultiFs(singleFs,renewer,credentials);
  TokenCache.obtainTokensForNamenodesInternal(singleFs,credentials,conf);
  assertEquals(1,credentials.getAllTokens().size());
  TokenCache.obtainTokensForNamenodesInternal(singleFs,credentials,conf);
  assertEquals(1,credentials.getAllTokens().size());
  TokenCache.obtainTokensForNamenodesInternal(multiFs,credentials,conf);
  assertEquals(2,credentials.getAllTokens().size());
  TokenCache.obtainTokensForNamenodesInternal(multiFs,credentials,conf);
  assertEquals(2,credentials.getAllTokens().size());
  verify(singleFs,times(1)).getDelegationTokens(renewer,credentials);
  verify(multiFs,times(2)).getDelegationTokens(renewer,credentials);
}
