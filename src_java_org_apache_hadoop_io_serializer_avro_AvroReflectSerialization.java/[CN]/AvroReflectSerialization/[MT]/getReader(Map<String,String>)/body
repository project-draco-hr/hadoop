{
  try {
    Class<SpecificRecord> clazz=(Class<SpecificRecord>)getClassFromMetadata(metadata);
    String prefix=((clazz.getEnclosingClass() == null || "null".equals(clazz.getEnclosingClass().getName())) ? clazz.getPackage().getName() + "." : (clazz.getEnclosingClass().getName() + "$"));
    return new ReflectDatumReader(ReflectData.get().getSchema(clazz),prefix);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
