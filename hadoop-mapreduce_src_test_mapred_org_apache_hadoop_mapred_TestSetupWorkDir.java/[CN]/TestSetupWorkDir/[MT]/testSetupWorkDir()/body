{
  Path rootDir=new Path(System.getProperty("test.build.data","/tmp"),"testSetupWorkDir");
  Path myWorkDir=new Path(rootDir,"./work");
  Path myTargetDir=new Path(rootDir,"./tmp");
  JobConf jConf=new JobConf();
  FileSystem fs=FileSystem.getLocal(jConf);
  createEmptyDir(fs,myWorkDir);
  createEmptyDir(fs,myTargetDir);
  createSubDirsAndSymLinks(jConf,myWorkDir,myTargetDir);
  assertTrue("Did not create symlinks/files/dirs properly. Check " + myWorkDir + " and "+ myTargetDir,(fs.listStatus(myWorkDir).length == 4) && (fs.listStatus(myTargetDir).length == 2));
  jConf.set(MRJobConfig.CACHE_SYMLINK,"no");
  TaskRunner.setupWorkDir(jConf,new File(myWorkDir.toUri().getPath()));
  assertTrue(myWorkDir + " is not cleaned up properly.",fs.exists(myWorkDir) && (fs.listStatus(myWorkDir).length == 1));
  assertTrue(fs.listStatus(myWorkDir)[0].getPath().toUri().getPath().toString().equals(myWorkDir.toString() + "/tmp"));
  assertTrue("Dir " + myTargetDir + " seem to be modified.",fs.exists(myTargetDir) && (fs.listStatus(myTargetDir).length == 2));
  fs.delete(rootDir,true);
}
