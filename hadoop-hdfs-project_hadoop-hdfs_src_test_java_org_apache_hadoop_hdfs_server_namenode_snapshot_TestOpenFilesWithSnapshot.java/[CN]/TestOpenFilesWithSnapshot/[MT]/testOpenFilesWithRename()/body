{
  Path path=new Path("/test");
  doWriteAndAbort(fs,path);
  Path fileWithEmptyBlock=new Path("/test/test/test4");
  fs.create(fileWithEmptyBlock);
  NamenodeProtocols nameNodeRpc=cluster.getNameNodeRpc();
  String clientName=fs.getClient().getClientName();
  nameNodeRpc.addBlock(fileWithEmptyBlock.toString(),clientName,null,null,INodeId.GRANDFATHER_INODE_ID,null);
  fs.createSnapshot(path,"s2");
  fs.rename(new Path("/test/test"),new Path("/test/test-renamed"));
  fs.delete(new Path("/test/test-renamed"),true);
  NameNode nameNode=cluster.getNameNode();
  NameNodeAdapter.enterSafeMode(nameNode,false);
  NameNodeAdapter.saveNamespace(nameNode);
  NameNodeAdapter.leaveSafeMode(nameNode);
  cluster.restartNameNode(true);
}
