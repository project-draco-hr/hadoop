{
  if (manageNameDfsDirs) {
    conf.set(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY,fileAsURI(new File(base_dir,"name" + (2 * nnIndex + 1))) + "," + fileAsURI(new File(base_dir,"name" + (2 * nnIndex + 2))));
    conf.set(DFSConfigKeys.DFS_NAMENODE_CHECKPOINT_DIR_KEY,fileAsURI(new File(base_dir,"namesecondary" + (2 * nnIndex + 1))) + "," + fileAsURI(new File(base_dir,"namesecondary" + (2 * nnIndex + 2))));
  }
  if (format) {
    DFSTestUtil.formatNameNode(conf);
  }
  if (operation == StartupOption.UPGRADE) {
    operation.setClusterId(clusterId);
  }
  String[] args=(operation == null || operation == StartupOption.FORMAT || operation == StartupOption.REGULAR) ? new String[]{} : new String[]{operation.getName()};
  return NameNode.createNameNode(args,conf);
}
