{
  if (!federation)   throw new IOException("cannot add namenode to non-federated cluster");
  int nnIndex=nameNodes.length;
  int numNameNodes=nameNodes.length + 1;
  NameNodeInfo[] newlist=new NameNodeInfo[numNameNodes];
  System.arraycopy(nameNodes,0,newlist,0,nameNodes.length);
  nameNodes=newlist;
  String nameserviceId=NAMESERVICE_ID_PREFIX + (nnIndex + 1);
  String nameserviceIds=conf.get(DFSConfigKeys.DFS_FEDERATION_NAMESERVICES);
  nameserviceIds+="," + nameserviceId;
  conf.set(DFSConfigKeys.DFS_FEDERATION_NAMESERVICES,nameserviceIds);
  initFederatedNamenodeAddress(conf,nameserviceId,namenodePort);
  createFederatedNameNode(nnIndex,conf,numDataNodes,true,true,null,null,nameserviceId);
  for (  DataNodeProperties dn : dataNodes) {
    DataNode datanode=dn.datanode;
    datanode.refreshNamenodes(conf);
  }
  waitActive(nnIndex);
  return nameNodes[nnIndex].nameNode;
}
