{
  StaticMapping.resetMap();
  Configuration conf=new HdfsConfiguration();
  conf.setLong(DFSConfigKeys.DFS_BLOCK_SIZE_KEY,DEFAULT_BLOCK_SIZE);
  conf.setInt(DFSConfigKeys.DFS_BYTES_PER_CHECKSUM_KEY,DEFAULT_BLOCK_SIZE / 2);
  conf.setClass(DFSConfigKeys.DFS_BLOCK_REPLICATOR_CLASSNAME_KEY,BlockPlacementPolicyWithUpgradeDomain.class,BlockPlacementPolicy.class);
  conf.setClass(DFSConfigKeys.DFS_NAMENODE_HOSTS_PROVIDER_CLASSNAME_KEY,CombinedHostFileManager.class,HostConfigManager.class);
  HostsFileWriter hostsFileWriter=new HostsFileWriter();
  hostsFileWriter.initialize(conf,"temp/upgradedomainpolicy");
  cluster=new MiniDFSCluster.Builder(conf).numDataNodes(6).racks(racks).hosts(hosts).build();
  cluster.waitActive();
  nameNodeRpc=cluster.getNameNodeRpc();
  namesystem=cluster.getNamesystem();
  perm=new PermissionStatus("TestDefaultBlockPlacementPolicy",null,FsPermission.getDefault());
  refreshDatanodeAdminProperties(hostsFileWriter);
  hostsFileWriter.cleanup();
}
