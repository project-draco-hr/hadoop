{
  Check.notEmpty(user,"user");
  Check.notNull(conf,"conf");
  if (!conf.getBoolean(FILE_SYSTEM_SERVICE_CREATED,false)) {
    throw new FileSystemAccessException(FileSystemAccessException.ERROR.H04);
  }
  try {
    validateNamenode(new URI(conf.get(CommonConfigurationKeysPublic.FS_DEFAULT_NAME_KEY)).getAuthority());
    UserGroupInformation ugi=getUGI(user);
    return ugi.doAs(new PrivilegedExceptionAction<FileSystem>(){
      public FileSystem run() throws Exception {
        return createFileSystem(conf);
      }
    }
);
  }
 catch (  IOException ex) {
    throw ex;
  }
catch (  FileSystemAccessException ex) {
    throw ex;
  }
catch (  Exception ex) {
    throw new FileSystemAccessException(FileSystemAccessException.ERROR.H08,ex.getMessage(),ex);
  }
}
