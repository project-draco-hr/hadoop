{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Generating access token for user=" + userID + ", blockID="+ blockID+ ", access modes="+ modes+ ", keyID="+ currentKey.getKeyID());
  }
  if (modes == null || modes.isEmpty())   throw new IOException("access modes can't be null or empty");
  ByteArrayOutputStream buf=new ByteArrayOutputStream(4096);
  DataOutputStream out=new DataOutputStream(buf);
  WritableUtils.writeVLong(out,System.currentTimeMillis() + tokenLifetime);
  WritableUtils.writeVLong(out,currentKey.getKeyID());
  WritableUtils.writeString(out,userID);
  WritableUtils.writeVLong(out,blockID);
  WritableUtils.writeVInt(out,modes.size());
  for (  AccessMode aMode : modes) {
    WritableUtils.writeEnum(out,aMode);
  }
  Text tokenID=new Text(buf.toByteArray());
  return new AccessToken(tokenID,new Text(currentKey.getMac().doFinal(tokenID.getBytes())));
}
