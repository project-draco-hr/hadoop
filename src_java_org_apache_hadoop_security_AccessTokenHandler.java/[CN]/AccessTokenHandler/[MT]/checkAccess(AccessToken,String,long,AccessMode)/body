{
  long oExpiry=0;
  long oKeyID=0;
  String oUserID=null;
  long oBlockID=0;
  EnumSet<AccessMode> oModes=EnumSet.noneOf(AccessMode.class);
  try {
    ByteArrayInputStream buf=new ByteArrayInputStream(token.getTokenID().getBytes());
    DataInputStream in=new DataInputStream(buf);
    oExpiry=WritableUtils.readVLong(in);
    oKeyID=WritableUtils.readVLong(in);
    oUserID=WritableUtils.readString(in);
    oBlockID=WritableUtils.readVLong(in);
    int length=WritableUtils.readVInt(in);
    for (int i=0; i < length; ++i) {
      oModes.add(WritableUtils.readEnum(in,AccessMode.class));
    }
  }
 catch (  IOException e) {
    throw (IOException)new IOException("Unable to parse access token for user=" + userID + ", blockID="+ blockID+ ", access mode="+ mode).initCause(e);
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("Verifying access token for user=" + userID + ", blockID="+ blockID+ ", access mode="+ mode+ ", keyID="+ oKeyID);
  }
  return (userID == null || userID.equals(oUserID)) && oBlockID == blockID && System.currentTimeMillis() < oExpiry && oModes.contains(mode) && verifyToken(oKeyID,token);
}
