{
  demand=0;
  if (isRunnable()) {
    if (taskType == TaskType.REDUCE && !job.scheduleReduces())     return;
    TaskInProgress[] tips=(taskType == TaskType.MAP ? job.getTasks(TaskType.MAP) : job.getTasks(TaskType.REDUCE));
    boolean speculationEnabled=(taskType == TaskType.MAP ? job.hasSpeculativeMaps() : job.hasSpeculativeReduces());
    long time=scheduler.getClock().getTime();
    for (    TaskInProgress tip : tips) {
      if (!tip.isComplete()) {
        if (tip.isRunning()) {
          demand+=tip.getActiveTasks().size();
          if (speculationEnabled && tip.canBeSpeculated(time))           demand+=1;
        }
 else {
          demand+=1;
        }
      }
    }
  }
}
