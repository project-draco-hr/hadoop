{
  if (isRunnable()) {
    visited.add(job);
    TaskTrackerManager ttm=scheduler.taskTrackerManager;
    ClusterStatus clusterStatus=ttm.getClusterStatus();
    int numTaskTrackers=clusterStatus.getTaskTrackers();
    LoadManager loadMgr=scheduler.getLoadManager();
    if (!loadMgr.canLaunchTask(tts,job,taskType)) {
      return null;
    }
    if (taskType == TaskType.MAP) {
      LocalityLevel localityLevel=scheduler.getAllowedLocalityLevel(job,currentTime);
      scheduler.getEventLog().log("ALLOWED_LOC_LEVEL",job.getJobID(),localityLevel);
      return job.obtainNewMapTask(tts,numTaskTrackers,ttm.getNumberOfUniqueHosts(),localityLevel.toCacheLevelCap());
    }
 else {
      return job.obtainNewReduceTask(tts,numTaskTrackers,ttm.getNumberOfUniqueHosts());
    }
  }
 else {
    return null;
  }
}
