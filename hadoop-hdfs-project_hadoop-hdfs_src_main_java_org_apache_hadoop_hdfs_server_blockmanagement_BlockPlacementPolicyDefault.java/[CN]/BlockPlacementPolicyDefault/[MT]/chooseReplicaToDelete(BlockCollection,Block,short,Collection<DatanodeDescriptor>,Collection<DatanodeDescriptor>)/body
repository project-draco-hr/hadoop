{
  long oldestHeartbeat=now() - heartbeatInterval * tolerateHeartbeatMultiplier;
  DatanodeDescriptor oldestHeartbeatNode=null;
  long minSpace=Long.MAX_VALUE;
  DatanodeDescriptor minSpaceNode=null;
  Iterator<DatanodeDescriptor> iter=first.isEmpty() ? second.iterator() : first.iterator();
  while (iter.hasNext()) {
    DatanodeDescriptor node=iter.next();
    long free=node.getRemaining();
    long lastHeartbeat=node.getLastUpdate();
    if (lastHeartbeat < oldestHeartbeat) {
      oldestHeartbeat=lastHeartbeat;
      oldestHeartbeatNode=node;
    }
    if (minSpace > free) {
      minSpace=free;
      minSpaceNode=node;
    }
  }
  return oldestHeartbeatNode != null ? oldestHeartbeatNode : minSpaceNode;
}
