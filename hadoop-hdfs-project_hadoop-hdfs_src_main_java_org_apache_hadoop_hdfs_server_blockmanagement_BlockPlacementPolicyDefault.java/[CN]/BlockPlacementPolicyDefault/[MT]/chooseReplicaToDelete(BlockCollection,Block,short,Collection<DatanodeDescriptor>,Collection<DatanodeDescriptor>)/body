{
  long oldestHeartbeat=now() - heartbeatInterval * tolerateHeartbeatMultiplier;
  DatanodeDescriptor oldestHeartbeatNode=null;
  long minSpace=Long.MAX_VALUE;
  DatanodeDescriptor minSpaceNode=null;
  for (  DatanodeDescriptor node : pickupReplicaSet(first,second)) {
    long free=node.getRemaining();
    long lastHeartbeat=node.getLastUpdate();
    if (lastHeartbeat < oldestHeartbeat) {
      oldestHeartbeat=lastHeartbeat;
      oldestHeartbeatNode=node;
    }
    if (minSpace > free) {
      minSpace=free;
      minSpaceNode=node;
    }
  }
  return oldestHeartbeatNode != null ? oldestHeartbeatNode : minSpaceNode;
}
