{
  if (localMachine == null)   return chooseRandom(NodeBase.ROOT,excludedNodes,blocksize,maxNodesPerRack,results,avoidStaleNodes);
  if (preferLocalNode) {
    Node oldNode=excludedNodes.put(localMachine,localMachine);
    if (oldNode == null) {
      if (addIfIsGoodTarget(localMachine,excludedNodes,blocksize,maxNodesPerRack,false,results,avoidStaleNodes) >= 0) {
        return localMachine;
      }
    }
  }
  return chooseLocalRack(localMachine,excludedNodes,blocksize,maxNodesPerRack,results,avoidStaleNodes);
}
