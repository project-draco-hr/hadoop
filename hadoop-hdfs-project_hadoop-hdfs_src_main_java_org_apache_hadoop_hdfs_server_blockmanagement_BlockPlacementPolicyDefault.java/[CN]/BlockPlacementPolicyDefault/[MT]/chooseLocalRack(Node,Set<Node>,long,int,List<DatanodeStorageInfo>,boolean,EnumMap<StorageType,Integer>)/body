{
  if (localMachine == null) {
    return chooseRandom(NodeBase.ROOT,excludedNodes,blocksize,maxNodesPerRack,results,avoidStaleNodes,storageTypes);
  }
  try {
    return chooseRandom(localMachine.getNetworkLocation(),excludedNodes,blocksize,maxNodesPerRack,results,avoidStaleNodes,storageTypes);
  }
 catch (  NotEnoughReplicasException e1) {
    DatanodeDescriptor newLocal=null;
    for (    DatanodeStorageInfo resultStorage : results) {
      DatanodeDescriptor nextNode=resultStorage.getDatanodeDescriptor();
      if (nextNode != localMachine) {
        newLocal=nextNode;
        break;
      }
    }
    if (newLocal != null) {
      try {
        return chooseRandom(newLocal.getNetworkLocation(),excludedNodes,blocksize,maxNodesPerRack,results,avoidStaleNodes,storageTypes);
      }
 catch (      NotEnoughReplicasException e2) {
        return chooseRandom(NodeBase.ROOT,excludedNodes,blocksize,maxNodesPerRack,results,avoidStaleNodes,storageTypes);
      }
    }
 else {
      return chooseRandom(NodeBase.ROOT,excludedNodes,blocksize,maxNodesPerRack,results,avoidStaleNodes,storageTypes);
    }
  }
}
