{
  TimelineEvent event=new TimelineEvent();
  event.setId("foo_event_id");
  event.setTimestamp(System.currentTimeMillis());
  event.addInfo("foo_event","test");
  final TimelineEntity entity=new TimelineEntity();
  entity.setId("attempt_1329348432655_0001_m_000008_18");
  entity.setType("FOO_ATTEMPT");
  TimelineEntities entities=new TimelineEntities();
  entities.addEntity(entity);
  HBaseTimelineWriterImpl hbi=null;
  try {
    Configuration c1=util.getConfiguration();
    hbi=new HBaseTimelineWriterImpl(c1);
    hbi.init(c1);
    String cluster="cluster2";
    String user="user2";
    String flow="other_flow_name";
    String flowVersion="1111F01C2287BA";
    long runid=1009876543218L;
    String appName="some app name";
    hbi.write(cluster,user,flow,flowVersion,runid,appName,entities);
    hbi.stop();
    Scan s=new Scan();
    byte[] startRow=EntityRowKey.getRowKeyPrefix(cluster,user,flow,runid,appName);
    s.setStartRow(startRow);
    s.setMaxVersions(Integer.MAX_VALUE);
    Connection conn=ConnectionFactory.createConnection(c1);
    ResultScanner scanner=new EntityTable().getResultScanner(c1,conn,s);
    int rowCount=0;
    for (    Result result : scanner) {
      if (result != null && !result.isEmpty()) {
        rowCount++;
      }
    }
    assertEquals(1,rowCount);
  }
  finally {
    hbi.stop();
    hbi.close();
  }
}
