{
  if (numOfBytes <= 0) {
    return;
  }
  curReserve-=numOfBytes;
  bytesAlreadyUsed+=numOfBytes;
  while (curReserve <= 0) {
    long now=System.currentTimeMillis();
    long curPeriodEnd=curPeriodStart + period;
    if (now < curPeriodEnd) {
      try {
        wait(curPeriodEnd - now);
      }
 catch (      InterruptedException ignored) {
      }
    }
 else     if (now < (curPeriodStart + periodExtension)) {
      curPeriodStart=curPeriodEnd;
      curReserve+=bytesPerPeriod;
    }
 else {
      curPeriodStart=now;
      curReserve=bytesPerPeriod - bytesAlreadyUsed;
    }
  }
  bytesAlreadyUsed-=numOfBytes;
}
