{
  DummyService svc1=new DummyService(HAServiceState.ACTIVE);
  DummyService svc2=new DummyService(HAServiceState.STANDBY){
    @Override public HAServiceStatus getServiceStatus() throws IOException {
      HAServiceStatus ret=new HAServiceStatus(HAServiceState.STANDBY);
      ret.setNotReadyToBecomeActive("injected not ready");
      return ret;
    }
  }
;
  NodeFencer fencer=setupFencer(AlwaysSucceedFencer.class.getName());
  try {
    FailoverController.failover(svc1,svc1Addr,svc2,svc2Addr,fencer,false,false);
    fail("Can't failover to a service that's not ready");
  }
 catch (  FailoverFailedException ffe) {
    if (!ffe.getMessage().contains("injected not ready")) {
      throw ffe;
    }
  }
  assertEquals(HAServiceState.ACTIVE,svc1.getServiceState());
  assertEquals(HAServiceState.STANDBY,svc2.getServiceState());
  FailoverController.failover(svc1,svc1Addr,svc2,svc2Addr,fencer,false,true);
  assertEquals(HAServiceState.STANDBY,svc1.getServiceState());
  assertEquals(HAServiceState.ACTIVE,svc2.getServiceState());
}
