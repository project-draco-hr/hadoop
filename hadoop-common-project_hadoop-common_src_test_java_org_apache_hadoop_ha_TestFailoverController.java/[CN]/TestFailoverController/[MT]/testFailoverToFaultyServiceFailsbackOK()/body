{
  DummyService svc1=spy(new DummyService(HAServiceState.ACTIVE));
  DummyService svc2=new DummyService(HAServiceState.STANDBY){
    @Override public void transitionToActive() throws ServiceFailedException {
      throw new ServiceFailedException("Failed!");
    }
  }
;
  try {
    FailoverController.failover(svc1,"svc1",svc2,"svc2");
    fail("Failover to already active service");
  }
 catch (  FailoverFailedException ffe) {
  }
  verify(svc1).transitionToStandby();
  verify(svc1).transitionToActive();
  assertEquals(HAServiceState.ACTIVE,svc1.getServiceState());
  assertEquals(HAServiceState.STANDBY,svc2.getServiceState());
}
