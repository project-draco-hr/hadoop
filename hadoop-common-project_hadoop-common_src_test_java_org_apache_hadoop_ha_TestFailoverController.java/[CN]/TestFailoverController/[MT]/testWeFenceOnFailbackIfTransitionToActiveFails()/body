{
  DummyService svc1=new DummyService(HAServiceState.ACTIVE);
  DummyService svc2=new DummyService(HAServiceState.STANDBY){
    @Override public void transitionToActive() throws ServiceFailedException, IOException {
      throw new IOException("Failed!");
    }
  }
;
  NodeFencer fencer=setupFencer(AlwaysSucceedFencer.class.getName());
  AlwaysSucceedFencer.fenceCalled=0;
  try {
    FailoverController.failover(svc1,svc1Addr,svc2,svc2Addr,fencer,false);
    fail("Failed over to service that won't transition to active");
  }
 catch (  FailoverFailedException ffe) {
  }
  assertEquals(HAServiceState.ACTIVE,svc1.getServiceState());
  assertEquals(1,AlwaysSucceedFencer.fenceCalled);
  assertEquals("svc2:5678",AlwaysSucceedFencer.fencedSvc);
}
