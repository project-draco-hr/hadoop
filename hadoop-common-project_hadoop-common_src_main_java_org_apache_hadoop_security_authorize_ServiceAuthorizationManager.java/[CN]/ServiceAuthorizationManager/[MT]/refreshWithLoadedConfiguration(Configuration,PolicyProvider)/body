{
  final Map<Class<?>,AccessControlList[]> newAcls=new IdentityHashMap<Class<?>,AccessControlList[]>();
  final Map<Class<?>,MachineList[]> newMachineLists=new IdentityHashMap<Class<?>,MachineList[]>();
  String defaultAcl=conf.get(CommonConfigurationKeys.HADOOP_SECURITY_SERVICE_AUTHORIZATION_DEFAULT_ACL,AccessControlList.WILDCARD_ACL_VALUE);
  String defaultBlockedAcl=conf.get(CommonConfigurationKeys.HADOOP_SECURITY_SERVICE_AUTHORIZATION_DEFAULT_BLOCKED_ACL,"");
  String defaultServiceHostsKey=getHostKey(CommonConfigurationKeys.HADOOP_SECURITY_SERVICE_AUTHORIZATION_DEFAULT_ACL);
  String defaultMachineList=conf.get(defaultServiceHostsKey,MachineList.WILDCARD_VALUE);
  String defaultBlockedMachineList=conf.get(defaultServiceHostsKey + BLOCKED,"");
  Service[] services=provider.getServices();
  if (services != null) {
    for (    Service service : services) {
      AccessControlList acl=new AccessControlList(conf.get(service.getServiceKey(),defaultAcl));
      AccessControlList blockedAcl=new AccessControlList(conf.get(service.getServiceKey() + BLOCKED,defaultBlockedAcl));
      newAcls.put(service.getProtocol(),new AccessControlList[]{acl,blockedAcl});
      String serviceHostsKey=getHostKey(service.getServiceKey());
      MachineList machineList=new MachineList(conf.get(serviceHostsKey,defaultMachineList));
      MachineList blockedMachineList=new MachineList(conf.get(serviceHostsKey + BLOCKED,defaultBlockedMachineList));
      newMachineLists.put(service.getProtocol(),new MachineList[]{machineList,blockedMachineList});
    }
  }
  protocolToAcls=newAcls;
  protocolToMachineLists=newMachineLists;
}
