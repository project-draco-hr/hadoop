{
  Path targetOfTests=FileSystemTestHelper.getTestRootPath(fsTarget);
  fsTarget.delete(targetOfTests,true);
  fsTarget.mkdirs(targetOfTests);
  String testDir=FileSystemTestHelper.getTestRootPath(fsTarget).toUri().getPath();
  int indexOf2ndSlash=testDir.indexOf('/',1);
  String testDirFirstComponent=testDir.substring(0,indexOf2ndSlash);
  ConfigUtil.addLink(conf,testDirFirstComponent,fsTarget.makeQualified(new Path(testDirFirstComponent)).toUri());
  String homeDirRoot=fsTarget.getHomeDirectory().getParent().toUri().getPath();
  ConfigUtil.addLink(conf,homeDirRoot,fsTarget.makeQualified(new Path(homeDirRoot)).toUri());
  ConfigUtil.setHomeDirConf(conf,homeDirRoot);
  Log.info("Home dir base " + homeDirRoot);
  FileSystem fsView=FileSystem.get(FsConstants.VIEWFS_URI,conf);
  return fsView;
}
