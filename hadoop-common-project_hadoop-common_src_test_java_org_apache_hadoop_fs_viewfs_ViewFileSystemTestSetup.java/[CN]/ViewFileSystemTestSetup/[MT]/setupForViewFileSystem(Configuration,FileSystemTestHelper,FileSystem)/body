{
  Path targetOfTests=fileSystemTestHelper.getTestRootPath(fsTarget);
  fsTarget.delete(targetOfTests,true);
  fsTarget.mkdirs(targetOfTests);
  String testDir=fileSystemTestHelper.getTestRootPath(fsTarget).toUri().getPath();
  linkUpFirstComponents(conf,testDir,fsTarget,"test dir");
  setUpHomeDir(conf,fsTarget);
  String wdDir=fsTarget.getWorkingDirectory().toUri().getPath();
  linkUpFirstComponents(conf,wdDir,fsTarget,"working dir");
  FileSystem fsView=FileSystem.get(FsConstants.VIEWFS_URI,conf);
  fsView.setWorkingDirectory(new Path(wdDir));
  Log.info("Working dir is: " + fsView.getWorkingDirectory());
  return fsView;
}
