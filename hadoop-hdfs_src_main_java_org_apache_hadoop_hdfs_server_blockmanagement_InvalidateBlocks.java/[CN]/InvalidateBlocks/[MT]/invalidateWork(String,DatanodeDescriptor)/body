{
  final Collection<Block> set=node2blocks.get(storageId);
  if (set == null) {
    return null;
  }
  final int limit=datanodeManager.blockInvalidateLimit;
  final List<Block> toInvalidate=new ArrayList<Block>(limit);
  final Iterator<Block> it=set.iterator();
  for (int count=0; count < limit && it.hasNext(); count++) {
    toInvalidate.add(it.next());
    it.remove();
  }
  if (!it.hasNext()) {
    remove(storageId);
  }
  dn.addBlocksToBeInvalidated(toInvalidate);
  numBlocks-=toInvalidate.size();
  return toInvalidate;
}
