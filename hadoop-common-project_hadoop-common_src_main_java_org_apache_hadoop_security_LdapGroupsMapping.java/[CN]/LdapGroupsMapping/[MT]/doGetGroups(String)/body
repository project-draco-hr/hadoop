{
  List<String> groups=new ArrayList<String>();
  DirContext ctx=getDirContext();
  NamingEnumeration<SearchResult> results=ctx.search(baseDN,userSearchFilter,new Object[]{user},SEARCH_CONTROLS);
  if (results.hasMoreElements()) {
    SearchResult result=results.nextElement();
    String userDn=result.getNameInNamespace();
    NamingEnumeration<SearchResult> groupResults=null;
    if (isPosix) {
      String gidNumber=null;
      String uidNumber=null;
      Attribute gidAttribute=result.getAttributes().get(posixGidAttr);
      Attribute uidAttribute=result.getAttributes().get(posixUidAttr);
      if (gidAttribute != null) {
        gidNumber=gidAttribute.get().toString();
      }
      if (uidAttribute != null) {
        uidNumber=uidAttribute.get().toString();
      }
      if (uidNumber != null && gidNumber != null) {
        groupResults=ctx.search(baseDN,"(&" + groupSearchFilter + "(|("+ posixGidAttr+ "={0})"+ "("+ groupMemberAttr+ "={1})))",new Object[]{gidNumber,uidNumber},SEARCH_CONTROLS);
      }
    }
 else {
      groupResults=ctx.search(baseDN,"(&" + groupSearchFilter + "("+ groupMemberAttr+ "={0}))",new Object[]{userDn},SEARCH_CONTROLS);
    }
    if (groupResults != null) {
      while (groupResults.hasMoreElements()) {
        SearchResult groupResult=groupResults.nextElement();
        Attribute groupName=groupResult.getAttributes().get(groupNameAttr);
        groups.add(groupName.get().toString());
      }
    }
  }
  return groups;
}
