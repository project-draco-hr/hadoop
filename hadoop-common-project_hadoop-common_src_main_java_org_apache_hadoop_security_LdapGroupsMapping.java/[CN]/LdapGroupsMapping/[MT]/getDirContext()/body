{
  if (ctx == null) {
    Hashtable<String,String> env=new Hashtable<String,String>();
    env.put(Context.INITIAL_CONTEXT_FACTORY,com.sun.jndi.ldap.LdapCtxFactory.class.getName());
    env.put(Context.PROVIDER_URL,ldapUrl);
    env.put(Context.SECURITY_AUTHENTICATION,"simple");
    if (useSsl) {
      env.put(Context.SECURITY_PROTOCOL,"ssl");
      System.setProperty("javax.net.ssl.keyStore",keystore);
      System.setProperty("javax.net.ssl.keyStorePassword",keystorePass);
    }
    env.put(Context.SECURITY_PRINCIPAL,bindUser);
    env.put(Context.SECURITY_CREDENTIALS,bindPassword);
    ctx=new InitialDirContext(env);
  }
  return ctx;
}
