{
  List<String> groups=new ArrayList<String>();
  try {
    DirContext ctx=getDirContext();
    NamingEnumeration<SearchResult> results=ctx.search(baseDN,userSearchFilter,new Object[]{user},SEARCH_CONTROLS);
    if (results.hasMoreElements()) {
      SearchResult result=results.nextElement();
      String userDn=result.getNameInNamespace();
      NamingEnumeration<SearchResult> groupResults=ctx.search(baseDN,"(&" + groupSearchFilter + "("+ groupMemberAttr+ "={0}))",new Object[]{userDn},SEARCH_CONTROLS);
      while (groupResults.hasMoreElements()) {
        SearchResult groupResult=groupResults.nextElement();
        Attribute groupName=groupResult.getAttributes().get(groupNameAttr);
        groups.add(groupName.get().toString());
      }
    }
  }
 catch (  NamingException e) {
    LOG.warn("Exception trying to get groups for user " + user,e);
    return new ArrayList<String>();
  }
  return groups;
}
