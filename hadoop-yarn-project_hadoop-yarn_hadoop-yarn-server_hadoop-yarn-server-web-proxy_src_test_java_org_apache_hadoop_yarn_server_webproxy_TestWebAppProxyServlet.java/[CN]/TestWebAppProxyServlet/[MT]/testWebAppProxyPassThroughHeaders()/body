{
  Configuration configuration=new Configuration();
  configuration.set(YarnConfiguration.PROXY_ADDRESS,"localhost:9091");
  configuration.setInt("hadoop.http.max.threads",5);
  WebAppProxyServerForTest proxy=new WebAppProxyServerForTest();
  proxy.init(configuration);
  proxy.start();
  int proxyPort=proxy.proxy.proxyServer.getConnectorAddress(0).getPort();
  try {
    URL url=new URL("http://localhost:" + proxyPort + "/proxy/application_00_1");
    HttpURLConnection proxyConn=(HttpURLConnection)url.openConnection();
    proxyConn.addRequestProperty("Origin","http://www.someurl.com");
    proxyConn.addRequestProperty("Access-Control-Request-Method","GET");
    proxyConn.addRequestProperty("Access-Control-Request-Headers","Authorization");
    proxyConn.addRequestProperty(UNKNOWN_HEADER,"unknown");
    assertEquals(proxyConn.getRequestProperties().size(),4);
    proxyConn.connect();
    assertEquals(HttpURLConnection.HTTP_OK,proxyConn.getResponseCode());
    assertEquals(numberOfHeaders,8);
    assertFalse(hasUnknownHeader);
  }
  finally {
    proxy.close();
  }
}
