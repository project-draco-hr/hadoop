{
  ExtendedBlock extendedBlock=new ExtendedBlock(bpid,newReplicaInfo);
  datanode.getShortCircuitRegistry().processBlockInvalidation(ExtendedBlockId.fromExtendedBlock(extendedBlock));
  datanode.notifyNamenodeReceivedBlock(extendedBlock,null,newReplicaInfo.getStorageUuid(),newReplicaInfo.isOnTransientStorage());
  if (replicaInfo.deleteBlockData() || !replicaInfo.blockDataExists()) {
    FsVolumeImpl volume=(FsVolumeImpl)replicaInfo.getVolume();
    volume.onBlockFileDeletion(bpid,replicaInfo.getBytesOnDisk());
    if (replicaInfo.deleteMetadata() || !replicaInfo.metadataExists()) {
      volume.onMetaFileDeletion(bpid,replicaInfo.getMetadataLength());
    }
  }
}
