{
  FsVolumeImpl targetVolume=(FsVolumeImpl)volumeRef.getVolume();
  File[] blockFiles=copyBlockFiles(block.getBlockId(),block.getGenerationStamp(),replicaInfo,targetVolume.getTmpDir(block.getBlockPoolId()),replicaInfo.isOnTransientStorage(),smallBufferSize,conf);
  ReplicaInfo newReplicaInfo=new ReplicaBuilder(ReplicaState.TEMPORARY).setBlockId(replicaInfo.getBlockId()).setGenerationStamp(replicaInfo.getGenerationStamp()).setFsVolume(targetVolume).setDirectoryToUse(blockFiles[0].getParentFile()).setBytesToReserve(0).build();
  newReplicaInfo.setNumBytes(blockFiles[1].length());
  newReplicaInfo=finalizeReplica(block.getBlockPoolId(),newReplicaInfo);
  try (AutoCloseableLock lock=datasetLock.acquire()){
    FsVolumeImpl volume=(FsVolumeImpl)newReplicaInfo.getVolume();
    volume.getBlockPoolSlice(block.getBlockPoolId()).incrNumBlocks();
  }
   removeOldReplica(replicaInfo,newReplicaInfo,block.getBlockPoolId());
  return newReplicaInfo;
}
