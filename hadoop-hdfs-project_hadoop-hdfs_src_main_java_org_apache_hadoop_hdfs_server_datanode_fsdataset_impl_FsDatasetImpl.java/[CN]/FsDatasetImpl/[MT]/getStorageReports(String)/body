{
  List<StorageReport> reports;
synchronized (statsLock) {
    List<FsVolumeImpl> curVolumes=volumes.getVolumes();
    reports=new ArrayList<>(curVolumes.size());
    for (    FsVolumeImpl volume : curVolumes) {
      try (FsVolumeReference ref=volume.obtainReference()){
        StorageReport sr=new StorageReport(volume.toDatanodeStorage(),false,volume.getCapacity(),volume.getDfsUsed(),volume.getAvailable(),volume.getBlockPoolUsed(bpid),volume.getNonDfsUsed());
        reports.add(sr);
      }
 catch (      ClosedChannelException e) {
        continue;
      }
    }
  }
  return reports.toArray(new StorageReport[reports.size()]);
}
