{
  final File destDir=DatanodeUtil.idToBlockDir(destRoot,blockId);
  final File dstFile=new File(destDir,srcFile.getName());
  final File dstMeta=FsDatasetUtil.getMetaFile(dstFile,genStamp);
  if (calculateChecksum) {
    computeChecksum(srcMeta,dstMeta,srcFile);
  }
 else {
    try {
      Storage.nativeCopyFileUnbuffered(srcMeta,dstMeta,true);
    }
 catch (    IOException e) {
      throw new IOException("Failed to copy " + srcMeta + " to "+ dstMeta,e);
    }
  }
  try {
    Storage.nativeCopyFileUnbuffered(srcFile,dstFile,true);
  }
 catch (  IOException e) {
    throw new IOException("Failed to copy " + srcFile + " to "+ dstFile,e);
  }
  if (LOG.isDebugEnabled()) {
    if (calculateChecksum) {
      LOG.debug("Copied " + srcMeta + " to "+ dstMeta+ " and calculated checksum");
    }
 else {
      LOG.debug("Copied " + srcFile + " to "+ dstFile);
    }
  }
  return new File[]{dstMeta,dstFile};
}
