{
  List<byte[]> blocksVolumeIds=new ArrayList<byte[]>(volumes.volumes.size());
  List<Integer> blocksVolumeIndexes=new ArrayList<Integer>(blockIds.length);
  for (int i=0; i < volumes.volumes.size(); i++) {
    blocksVolumeIds.add(ByteBuffer.allocate(4).putInt(i).array());
  }
  for (int i=0; i < blockIds.length; i++) {
    long blockId=blockIds[i];
    boolean isValid=false;
    ReplicaInfo info=volumeMap.get(poolId,blockId);
    int volumeIndex=0;
    if (info != null) {
      FsVolumeSpi blockVolume=info.getVolume();
      for (      FsVolumeImpl volume : volumes.volumes) {
        if (blockVolume == volume) {
          isValid=true;
          break;
        }
        volumeIndex++;
      }
    }
    if (!isValid) {
      volumeIndex=Integer.MAX_VALUE;
    }
    blocksVolumeIndexes.add(volumeIndex);
  }
  return new HdfsBlocksMetadata(poolId,blockIds,blocksVolumeIds,blocksVolumeIndexes);
}
