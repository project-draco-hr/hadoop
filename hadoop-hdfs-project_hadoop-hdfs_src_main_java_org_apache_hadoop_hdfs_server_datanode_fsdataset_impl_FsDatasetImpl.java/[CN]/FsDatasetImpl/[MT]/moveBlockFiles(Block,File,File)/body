{
  final File dstfile=new File(destdir,b.getBlockName());
  final File srcmeta=FsDatasetUtil.getMetaFile(srcfile,b.getGenerationStamp());
  final File dstmeta=FsDatasetUtil.getMetaFile(dstfile,b.getGenerationStamp());
  if (!srcmeta.renameTo(dstmeta)) {
    throw new IOException("Failed to move meta file for " + b + " from "+ srcmeta+ " to "+ dstmeta);
  }
  if (!srcfile.renameTo(dstfile)) {
    throw new IOException("Failed to move block file for " + b + " from "+ srcfile+ " to "+ dstfile.getAbsolutePath());
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("addBlock: Moved " + srcmeta + " to "+ dstmeta+ " and "+ srcfile+ " to "+ dstfile);
  }
  return dstfile;
}
