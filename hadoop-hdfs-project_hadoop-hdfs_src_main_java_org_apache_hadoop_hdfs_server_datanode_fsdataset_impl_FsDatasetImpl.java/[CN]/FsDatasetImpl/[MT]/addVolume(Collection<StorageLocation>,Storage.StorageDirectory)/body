{
  final File dir=sd.getCurrentDir();
  final StorageType storageType=getStorageTypeFromLocations(dataLocations,sd.getRoot());
  FsVolumeImpl fsVolume=FsVolumeImplAllocator.createVolume(this,sd.getStorageUuid(),dir,this.conf,storageType);
  ReplicaMap tempVolumeMap=new ReplicaMap(this);
  fsVolume.getVolumeMap(tempVolumeMap,lazyWriteReplicaTracker);
  volumeMap.addAll(tempVolumeMap);
  volumes.addVolume(fsVolume);
  storageMap.put(sd.getStorageUuid(),new DatanodeStorage(sd.getStorageUuid(),DatanodeStorage.State.NORMAL,storageType));
  asyncDiskService.addVolume(sd.getCurrentDir());
  LOG.info("Added volume - " + dir + ", StorageType: "+ storageType);
}
