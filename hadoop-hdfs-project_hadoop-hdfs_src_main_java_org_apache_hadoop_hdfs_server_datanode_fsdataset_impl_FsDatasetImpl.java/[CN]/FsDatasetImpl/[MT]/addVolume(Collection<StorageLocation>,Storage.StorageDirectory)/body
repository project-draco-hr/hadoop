{
  final File dir=sd.getCurrentDir();
  final StorageType storageType=getStorageTypeFromLocations(dataLocations,sd.getRoot());
  FsVolumeImpl fsVolume=new FsVolumeImpl(this,sd.getStorageUuid(),dir,this.conf,storageType);
  FsVolumeReference ref=fsVolume.obtainReference();
  ReplicaMap tempVolumeMap=new ReplicaMap(this);
  fsVolume.getVolumeMap(tempVolumeMap,ramDiskReplicaTracker);
synchronized (this) {
    volumeMap.addAll(tempVolumeMap);
    storageMap.put(sd.getStorageUuid(),new DatanodeStorage(sd.getStorageUuid(),DatanodeStorage.State.NORMAL,storageType));
    asyncDiskService.addVolume(sd.getCurrentDir());
    volumes.addVolume(ref);
  }
  LOG.info("Added volume - " + dir + ", StorageType: "+ storageType);
}
