{
  List<byte[]> blocksVolumeIds=new ArrayList<byte[]>(volumes.volumes.size());
  List<Integer> blocksVolumendexes=new ArrayList<Integer>(blocks.size());
  for (int i=0; i < volumes.volumes.size(); i++) {
    blocksVolumeIds.add(new byte[]{(byte)i});
  }
  for (int i=0; i < blocks.size(); i++) {
    ExtendedBlock block=blocks.get(i);
    FsVolumeSpi blockVolume=getReplicaInfo(block).getVolume();
    boolean isValid=false;
    int volumeIndex=0;
    for (    FsVolumeImpl volume : volumes.volumes) {
      if (blockVolume == volume) {
        isValid=true;
        break;
      }
      volumeIndex++;
    }
    if (!isValid) {
      volumeIndex=Integer.MAX_VALUE;
    }
    blocksVolumendexes.add(volumeIndex);
  }
  return new HdfsBlocksMetadata(blocks.toArray(new ExtendedBlock[]{}),blocksVolumeIds,blocksVolumendexes);
}
