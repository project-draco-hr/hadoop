{
  LOG.info("Recover failed close " + b);
  while (true) {
    try {
      try (AutoCloseableLock lock=datasetLock.acquire()){
        ReplicaInfo replicaInfo=recoverCheck(b,newGS,expectedBlockLen);
        replicaInfo.bumpReplicaGS(newGS);
        if (replicaInfo.getState() == ReplicaState.RBW) {
          finalizeReplica(b.getBlockPoolId(),replicaInfo);
        }
        return replicaInfo;
      }
     }
 catch (    MustStopExistingWriter e) {
      e.getReplicaInPipeline().stopWriter(datanode.getDnConf().getXceiverStopTimeout());
    }
  }
}
