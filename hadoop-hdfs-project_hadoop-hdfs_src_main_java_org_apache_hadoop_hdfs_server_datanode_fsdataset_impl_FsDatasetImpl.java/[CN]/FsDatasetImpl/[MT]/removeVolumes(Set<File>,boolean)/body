{
  for (  File vol : volumesToRemove) {
    Preconditions.checkArgument(vol.isAbsolute(),String.format("%s is not absolute path.",vol.getPath()));
  }
  for (int idx=0; idx < dataStorage.getNumStorageDirs(); idx++) {
    Storage.StorageDirectory sd=dataStorage.getStorageDir(idx);
    final File absRoot=sd.getRoot().getAbsoluteFile();
    if (volumesToRemove.contains(absRoot)) {
      LOG.info("Removing " + absRoot + " from FsDataset.");
      asyncDiskService.removeVolume(sd.getCurrentDir());
      volumes.removeVolume(absRoot,clearFailure);
      for (      String bpid : volumeMap.getBlockPoolList()) {
        for (Iterator<ReplicaInfo> it=volumeMap.replicas(bpid).iterator(); it.hasNext(); ) {
          ReplicaInfo block=it.next();
          final File absBasePath=new File(block.getVolume().getBasePath()).getAbsoluteFile();
          if (absBasePath.equals(absRoot)) {
            invalidate(bpid,block);
            it.remove();
          }
        }
      }
      storageMap.remove(sd.getStorageUuid());
    }
  }
  setupAsyncLazyPersistThreads();
}
