{
  RamDiskReplica block=null;
  FsVolumeImpl targetVolume;
  ReplicaInfo replicaInfo;
  boolean succeeded=false;
  try {
    block=ramDiskReplicaTracker.dequeueNextReplicaToPersist();
    if (block != null) {
synchronized (FsDatasetImpl.this) {
        replicaInfo=volumeMap.get(block.getBlockPoolId(),block.getBlockId());
        if (replicaInfo != null && replicaInfo.getVolume().isTransientStorage()) {
          targetVolume=volumes.getNextVolume(StorageType.DEFAULT,replicaInfo.getNumBytes());
          ramDiskReplicaTracker.recordStartLazyPersist(block.getBlockPoolId(),block.getBlockId(),targetVolume);
          if (LOG.isDebugEnabled()) {
            LOG.debug("LazyWriter: Start persisting RamDisk block:" + " block pool Id: " + block.getBlockPoolId() + " block id: "+ block.getBlockId()+ " on target volume "+ targetVolume);
          }
          asyncLazyPersistService.submitLazyPersistTask(block.getBlockPoolId(),block.getBlockId(),replicaInfo.getGenerationStamp(),block.getCreationTime(),replicaInfo.getMetaFile(),replicaInfo.getBlockFile(),targetVolume);
        }
      }
    }
    succeeded=true;
  }
 catch (  IOException ioe) {
    LOG.warn("Exception saving replica " + block,ioe);
  }
 finally {
    if (!succeeded && block != null) {
      LOG.warn("Failed to save replica " + block + ". re-enqueueing it.");
      onFailLazyPersist(block.getBlockPoolId(),block.getBlockId());
    }
  }
  return succeeded;
}
