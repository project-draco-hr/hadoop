{
  int nsUpgradeVersion=nsInfo.getDistributedUpgradeVersion();
  if (nsUpgradeVersion >= getVersion())   return false;
  String errorMsg="\n   Data-node missed a distributed upgrade and will shutdown." + "\n   " + getDescription() + "."+ " Name-node version = "+ nsInfo.getLayoutVersion()+ ".";
  DataNode.LOG.fatal(errorMsg);
  String bpid=nsInfo.getBlockPoolID();
  DatanodeProtocol nn=dataNode.getBPNamenode(bpid);
  try {
    nn.errorReport(dataNode.getDNRegistrationForBP(bpid),DatanodeProtocol.NOTIFY,errorMsg);
  }
 catch (  SocketTimeoutException e) {
    DataNode.LOG.info("Problem connecting to server: " + dataNode.getNameNodeAddr(nsInfo.getBlockPoolID()));
  }
  throw new IOException(errorMsg);
}
