{
  String key=pathToKey(dst);
  if (!overwrite && exists(dst)) {
    throw new FileAlreadyExistsException(dst + " already exists");
  }
  LOG.debug("Copying local file from {} to {}",src,dst);
  LocalFileSystem local=getLocal(getConf());
  File srcfile=local.pathToFile(src);
  final ObjectMetadata om=new ObjectMetadata();
  if (StringUtils.isNotBlank(serverSideEncryptionAlgorithm)) {
    om.setSSEAlgorithm(serverSideEncryptionAlgorithm);
  }
  PutObjectRequest putObjectRequest=new PutObjectRequest(bucket,key,srcfile);
  putObjectRequest.setCannedAcl(cannedACL);
  putObjectRequest.setMetadata(om);
  ProgressListener progressListener=new ProgressListener(){
    public void progressChanged(    ProgressEvent progressEvent){
switch (progressEvent.getEventType()) {
case TRANSFER_PART_COMPLETED_EVENT:
        statistics.incrementWriteOps(1);
      break;
default :
    break;
}
}
}
;
statistics.incrementWriteOps(1);
Upload up=transfers.upload(putObjectRequest);
up.addProgressListener(progressListener);
try {
up.waitForUploadResult();
}
 catch (InterruptedException e) {
throw new InterruptedIOException("Interrupted copying " + src + " to "+ dst+ ", cancelling");
}
finishedWrite(key);
if (delSrc) {
local.delete(src,false);
}
}
