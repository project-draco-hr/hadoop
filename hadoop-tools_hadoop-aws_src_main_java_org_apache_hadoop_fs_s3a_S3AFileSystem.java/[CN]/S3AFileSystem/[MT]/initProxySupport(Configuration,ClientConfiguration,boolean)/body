{
  String proxyHost=conf.getTrimmed(PROXY_HOST,"");
  int proxyPort=conf.getInt(PROXY_PORT,-1);
  if (!proxyHost.isEmpty()) {
    awsConf.setProxyHost(proxyHost);
    if (proxyPort >= 0) {
      awsConf.setProxyPort(proxyPort);
    }
 else {
      if (secureConnections) {
        LOG.warn("Proxy host set without port. Using HTTPS default 443");
        awsConf.setProxyPort(443);
      }
 else {
        LOG.warn("Proxy host set without port. Using HTTP default 80");
        awsConf.setProxyPort(80);
      }
    }
    String proxyUsername=conf.getTrimmed(PROXY_USERNAME);
    String proxyPassword=conf.getTrimmed(PROXY_PASSWORD);
    if ((proxyUsername == null) != (proxyPassword == null)) {
      String msg="Proxy error: " + PROXY_USERNAME + " or "+ PROXY_PASSWORD+ " set without the other.";
      LOG.error(msg);
      throw new IllegalArgumentException(msg);
    }
    awsConf.setProxyUsername(proxyUsername);
    awsConf.setProxyPassword(proxyPassword);
    awsConf.setProxyDomain(conf.getTrimmed(PROXY_DOMAIN));
    awsConf.setProxyWorkstation(conf.getTrimmed(PROXY_WORKSTATION));
    if (LOG.isDebugEnabled()) {
      LOG.debug("Using proxy server {}:{} as user {} with password {} on " + "domain {} as workstation {}",awsConf.getProxyHost(),awsConf.getProxyPort(),String.valueOf(awsConf.getProxyUsername()),awsConf.getProxyPassword(),awsConf.getProxyDomain(),awsConf.getProxyWorkstation());
    }
  }
 else   if (proxyPort >= 0) {
    String msg="Proxy error: " + PROXY_PORT + " set without "+ PROXY_HOST;
    LOG.error(msg);
    throw new IllegalArgumentException(msg);
  }
}
