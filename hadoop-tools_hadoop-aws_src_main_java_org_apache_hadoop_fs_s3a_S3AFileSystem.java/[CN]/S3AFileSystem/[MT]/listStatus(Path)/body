{
  String key=pathToKey(f);
  LOG.info("List status for path: " + f);
  final List<FileStatus> result=new ArrayList<FileStatus>();
  final FileStatus fileStatus=getFileStatus(f);
  if (fileStatus.isDirectory()) {
    if (!key.isEmpty()) {
      key=key + "/";
    }
    ListObjectsRequest request=new ListObjectsRequest();
    request.setBucketName(bucket);
    request.setPrefix(key);
    request.setDelimiter("/");
    request.setMaxKeys(maxKeys);
    if (LOG.isDebugEnabled()) {
      LOG.debug("listStatus: doing listObjects for directory " + key);
    }
    ObjectListing objects=s3.listObjects(request);
    statistics.incrementReadOps(1);
    while (true) {
      for (      S3ObjectSummary summary : objects.getObjectSummaries()) {
        Path keyPath=keyToPath(summary.getKey()).makeQualified(uri,workingDir);
        if (keyPath.equals(f) || summary.getKey().endsWith(S3N_FOLDER_SUFFIX)) {
          if (LOG.isDebugEnabled()) {
            LOG.debug("Ignoring: " + keyPath);
          }
          continue;
        }
        if (objectRepresentsDirectory(summary.getKey(),summary.getSize())) {
          result.add(new S3AFileStatus(true,true,keyPath));
          if (LOG.isDebugEnabled()) {
            LOG.debug("Adding: fd: " + keyPath);
          }
        }
 else {
          result.add(new S3AFileStatus(summary.getSize(),dateToLong(summary.getLastModified()),keyPath));
          if (LOG.isDebugEnabled()) {
            LOG.debug("Adding: fi: " + keyPath);
          }
        }
      }
      for (      String prefix : objects.getCommonPrefixes()) {
        Path keyPath=keyToPath(prefix).makeQualified(uri,workingDir);
        if (keyPath.equals(f)) {
          continue;
        }
        result.add(new S3AFileStatus(true,false,keyPath));
        if (LOG.isDebugEnabled()) {
          LOG.debug("Adding: rd: " + keyPath);
        }
      }
      if (objects.isTruncated()) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("listStatus: list truncated - getting next batch");
        }
        objects=s3.listNextBatchOfObjects(objects);
        statistics.incrementReadOps(1);
      }
 else {
        break;
      }
    }
  }
 else {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Adding: rd (not a dir): " + f);
    }
    result.add(fileStatus);
  }
  return result.toArray(new FileStatus[result.size()]);
}
