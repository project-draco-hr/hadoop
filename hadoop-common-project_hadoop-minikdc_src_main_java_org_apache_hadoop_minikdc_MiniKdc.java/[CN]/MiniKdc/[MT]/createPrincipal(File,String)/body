{
  String generatedPassword=UUID.randomUUID().toString();
  HackedKeytab keytab=new HackedKeytab();
  List<KeytabEntry> entries=new ArrayList<KeytabEntry>();
  for (  String principal : principals) {
    createPrincipal(principal,generatedPassword);
    principal=principal + "@" + getRealm();
    KerberosTime timestamp=new KerberosTime();
    for (    Map.Entry<EncryptionType,EncryptionKey> entry : KerberosKeyFactory.getKerberosKeys(principal,generatedPassword).entrySet()) {
      EncryptionKey ekey=entry.getValue();
      byte keyVersion=(byte)ekey.getKeyVersion();
      entries.add(new KeytabEntry(principal,1L,timestamp,keyVersion,ekey));
    }
  }
  keytab.setEntries(entries);
  keytab.write(keytabFile,principals.length);
}
