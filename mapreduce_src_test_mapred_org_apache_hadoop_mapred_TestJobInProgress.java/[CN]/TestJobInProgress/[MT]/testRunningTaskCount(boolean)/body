{
  LOG.info("Testing running jobs with speculation : " + speculation);
  JobConf conf=new JobConf();
  conf.setNumMapTasks(2);
  conf.setNumReduceTasks(2);
  conf.setSpeculativeExecution(speculation);
  MyFakeJobInProgress jip=new MyFakeJobInProgress(conf,jobTracker);
  jip.initTasks();
  TaskAttemptID[] tid=new TaskAttemptID[4];
  for (int i=0; i < 2; i++) {
    tid[i]=jip.findAndRunNewTask(true,trackers[i],hosts[i],clusterSize,numUniqueHosts);
  }
  Set<TaskInProgress> uniqueTasks=new HashSet<TaskInProgress>();
  for (  Map.Entry<Node,Set<TaskInProgress>> s : jip.getRunningMapCache().entrySet()) {
    uniqueTasks.addAll(s.getValue());
  }
  uniqueTasks.addAll(jip.getNonLocalRunningMaps());
  assertEquals("Running map count doesnt match for jobs with speculation " + speculation,jip.runningMaps(),uniqueTasks.size());
  for (int i=0; i < 2; i++) {
    tid[i]=jip.findAndRunNewTask(false,trackers[i],hosts[i],clusterSize,numUniqueHosts);
  }
  assertEquals("Running reducer count doesnt match for" + " jobs with speculation " + speculation,jip.runningReduces(),jip.getRunningReduces().size());
}
