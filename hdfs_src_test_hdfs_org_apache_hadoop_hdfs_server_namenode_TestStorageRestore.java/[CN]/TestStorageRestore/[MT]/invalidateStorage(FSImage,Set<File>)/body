{
  ArrayList<StorageDirectory> al=new ArrayList<StorageDirectory>(2);
  Iterator<StorageDirectory> it=fi.getStorage().dirIterator();
  while (it.hasNext()) {
    StorageDirectory sd=it.next();
    if (filesToInvalidate.contains(sd.getRoot())) {
      LOG.info("causing IO error on " + sd.getRoot());
      al.add(sd);
    }
  }
  fi.getStorage().reportErrorsOnDirectories(al);
  for (  FSEditLog.JournalAndStream j : fi.getEditLog().getJournals()) {
    if (j.getManager() instanceof FileJournalManager) {
      FileJournalManager fm=(FileJournalManager)j.getManager();
      if (fm.getStorageDirectory().getRoot().equals(path2) || fm.getStorageDirectory().getRoot().equals(path3)) {
        EditLogOutputStream mockStream=spy(j.getCurrentStream());
        j.setCurrentStreamForTests(mockStream);
        doThrow(new IOException("Injected fault: write")).when(mockStream).write(Mockito.<FSEditLogOp>anyObject());
      }
    }
  }
}
