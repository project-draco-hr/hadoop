{
  QuotaCounts quota=dir.getQuotaCounts();
  INodeSection.INodeDirectory.Builder b=INodeSection.INodeDirectory.newBuilder().setModificationTime(dir.getModificationTime()).setNsQuota(quota.getNameSpace()).setDsQuota(quota.getStorageSpace()).setPermission(buildPermissionStatus(dir,state.getStringMap()));
  if (quota.getTypeSpaces().anyGreaterOrEqual(0)) {
    b.setTypeQuotas(buildQuotaByStorageTypeEntries(quota));
  }
  AclFeature f=dir.getAclFeature();
  if (f != null) {
    b.setAcl(buildAclEntries(f,state.getStringMap()));
  }
  XAttrFeature xAttrFeature=dir.getXAttrFeature();
  if (xAttrFeature != null) {
    b.setXAttrs(buildXAttrs(xAttrFeature,state.getStringMap()));
  }
  return b;
}
