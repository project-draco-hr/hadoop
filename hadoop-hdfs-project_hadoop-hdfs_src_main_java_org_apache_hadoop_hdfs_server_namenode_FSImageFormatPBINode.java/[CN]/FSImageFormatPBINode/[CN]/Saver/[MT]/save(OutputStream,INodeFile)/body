{
  INodeSection.INodeFile.Builder b=buildINodeFile(n,parent.getSaverContext());
  if (n.getBlocks() != null) {
    for (    Block block : n.getBlocks()) {
      b.addBlocks(PBHelper.convert(block));
    }
  }
  FileWithStripedBlocksFeature sb=n.getStripedBlocksFeature();
  if (sb != null) {
    StripedBlocksFeature.Builder builder=StripedBlocksFeature.newBuilder();
    BlockInfoStriped[] sblocks=sb.getBlocks();
    if (sblocks != null) {
      for (      BlockInfoStriped sblk : sblocks) {
        builder.addBlocks(PBHelper.convert(sblk));
      }
    }
    b.setStripedBlocks(builder.build());
  }
  FileUnderConstructionFeature uc=n.getFileUnderConstructionFeature();
  if (uc != null) {
    INodeSection.FileUnderConstructionFeature f=INodeSection.FileUnderConstructionFeature.newBuilder().setClientName(uc.getClientName()).setClientMachine(uc.getClientMachine()).build();
    b.setFileUC(f);
  }
  INodeSection.INode r=buildINodeCommon(n).setType(INodeSection.INode.Type.FILE).setFile(b).build();
  r.writeDelimitedTo(out);
}
