{
  INodeMap inodesMap=fsn.dir.getINodeMap();
  INodeSection.Builder b=INodeSection.newBuilder().setLastInodeId(fsn.getLastInodeId()).setNumInodes(inodesMap.size());
  INodeSection s=b.build();
  s.writeDelimitedTo(out);
  int i=0;
  Iterator<INodeWithAdditionalFields> iter=inodesMap.getMapIterator();
  while (iter.hasNext()) {
    INodeWithAdditionalFields n=iter.next();
    save(out,n);
    ++i;
    if (i % FSImageFormatProtobuf.Saver.CHECK_CANCEL_INTERVAL == 0) {
      context.checkCancelled();
    }
  }
  parent.commitSection(summary,FSImageFormatProtobuf.SectionName.INODE);
}
