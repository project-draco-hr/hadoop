{
  RMApp app2=rm1.submitApp(200,logAggregationContext);
  MockAM am2=MockRM.launchAndRegisterAM(app2,rm1,nm1);
  nm1.nodeHeartbeat(true);
  am2.allocate("127.0.0.1",512,1,new ArrayList<ContainerId>());
  ContainerId containerId=ContainerId.newInstance(am2.getApplicationAttemptId(),2);
  rm1.waitForState(nm1,containerId,RMContainerState.ALLOCATED);
  List<Container> containers=am2.allocate(new ArrayList<ResourceRequest>(),new ArrayList<ContainerId>()).getAllocatedContainers();
  Assert.assertEquals(containerId,containers.get(0).getId());
  Assert.assertNotNull(containers.get(0).getContainerToken());
  ContainerTokenIdentifier token=BuilderUtils.newContainerTokenIdentifier(containers.get(0).getContainerToken());
  return token.getLogAggregationContext();
}
