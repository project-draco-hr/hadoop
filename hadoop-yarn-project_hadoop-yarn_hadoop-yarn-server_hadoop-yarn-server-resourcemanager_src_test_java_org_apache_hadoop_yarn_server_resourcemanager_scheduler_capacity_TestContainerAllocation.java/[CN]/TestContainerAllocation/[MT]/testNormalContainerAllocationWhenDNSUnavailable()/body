{
  MockRM rm1=new MockRM(conf);
  rm1.start();
  MockNM nm1=rm1.registerNode("unknownhost:1234",8000);
  RMApp app1=rm1.submitApp(200);
  MockAM am1=MockRM.launchAndRegisterAM(app1,rm1,nm1);
  am1.allocate("127.0.0.1",1024,1,new ArrayList<ContainerId>());
  ContainerId containerId2=ContainerId.newContainerId(am1.getApplicationAttemptId(),2);
  rm1.waitForState(nm1,containerId2,RMContainerState.ALLOCATED);
  SecurityUtilTestHelper.setTokenServiceUseIp(true);
  List<Container> containers=am1.allocate(new ArrayList<ResourceRequest>(),new ArrayList<ContainerId>()).getAllocatedContainers();
  Assert.assertEquals(0,containers.size());
  SecurityUtilTestHelper.setTokenServiceUseIp(false);
  containers=am1.allocate(new ArrayList<ResourceRequest>(),new ArrayList<ContainerId>()).getAllocatedContainers();
  Assert.assertEquals(1,containers.size());
}
