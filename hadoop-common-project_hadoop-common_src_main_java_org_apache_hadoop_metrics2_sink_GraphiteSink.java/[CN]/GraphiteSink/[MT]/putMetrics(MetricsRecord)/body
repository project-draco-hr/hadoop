{
  StringBuilder lines=new StringBuilder();
  StringBuilder metricsPathPrefix=new StringBuilder();
  metricsPathPrefix.append(metricsPrefix).append(".").append(record.context()).append(".").append(record.name());
  for (  MetricsTag tag : record.tags()) {
    if (tag.value() != null) {
      metricsPathPrefix.append(".");
      metricsPathPrefix.append(tag.name());
      metricsPathPrefix.append("=");
      metricsPathPrefix.append(tag.value());
    }
  }
  int timestamp=Math.round(record.timestamp() / 1000.0f);
  for (  AbstractMetric metric : record.metrics()) {
    lines.append(metricsPathPrefix.toString() + "." + metric.name().replace(' ','.')).append(" ").append(metric.value()).append(" ").append(timestamp).append("\n");
  }
  try {
    writer.write(lines.toString());
  }
 catch (  Exception e) {
    throw new MetricsException("Error sending metrics",e);
  }
}
