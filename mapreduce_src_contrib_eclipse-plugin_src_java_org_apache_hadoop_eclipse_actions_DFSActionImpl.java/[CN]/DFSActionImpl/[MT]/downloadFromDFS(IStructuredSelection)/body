{
  DirectoryDialog dialog=new DirectoryDialog(Display.getCurrent().getActiveShell());
  dialog.setText("Copy to local directory");
  dialog.setMessage("Copy the selected files and directories from the " + "distributed filesystem to a local directory");
  String directory=dialog.open();
  if (directory == null)   return;
  final File dir=new File(directory);
  if (!dir.exists())   dir.mkdirs();
  if (!dir.isDirectory()) {
    MessageDialog.openError(null,"Download to local file system","Invalid directory location: \"" + dir + "\"");
    return;
  }
  final List<DFSPath> paths=filterSelection(DFSPath.class,selection);
  PlatformUI.getWorkbench().getProgressService().busyCursorWhile(new IRunnableWithProgress(){
    public void run(    IProgressMonitor monitor) throws InvocationTargetException {
      int work=0;
      for (      DFSPath path : paths)       work+=path.computeDownloadWork();
      monitor.beginTask("Downloading files to local file system",work);
      for (      DFSPath path : paths) {
        if (monitor.isCanceled())         return;
        try {
          path.downloadToLocalDirectory(monitor,dir);
        }
 catch (        Exception e) {
          e.printStackTrace();
        }
      }
      monitor.done();
    }
  }
);
}
