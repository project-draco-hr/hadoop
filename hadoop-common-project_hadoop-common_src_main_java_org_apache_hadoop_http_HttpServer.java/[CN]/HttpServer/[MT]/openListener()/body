{
  if (listener.getLocalPort() != -1) {
    return;
  }
  if (listenerStartedExternally) {
    throw new Exception("Expected webserver's listener to be started " + "previously but wasn't");
  }
  int port=listener.getPort();
  while (true) {
    try {
      listener.close();
      listener.open();
      break;
    }
 catch (    BindException ex) {
      if (port == 0 || !findPort) {
        BindException be=new BindException("Port in use: " + listener.getHost() + ":"+ listener.getPort());
        be.initCause(ex);
        throw be;
      }
    }
    listener.setPort(++port);
    Thread.sleep(100);
  }
}
