{
  TestDFSUpgradeFromImage upgrade=new TestDFSUpgradeFromImage();
  upgrade.unpackStorage(testCaseName + ".tgz",testCaseName + ".txt");
  Configuration conf=new Configuration(TestDFSUpgradeFromImage.upgradeConf);
  initStorageDirs(conf,testCaseName);
  upgradeAndVerify(upgrade,conf,new ClusterVerifier(){
    @Override public void verifyClusterPostUpgrade(    MiniDFSCluster cluster) throws IOException {
      final String bpid=cluster.getNamesystem().getBlockPoolId();
      StorageReport[] reports=cluster.getDataNodes().get(0).getFSDataset().getStorageReports(bpid);
      assertThat(reports.length,is(1));
      final String storageID=reports[0].getStorage().getStorageID();
      assertTrue(DatanodeStorage.isValidStorageId(storageID));
      if (expectedStorageId != null) {
        assertThat(storageID,is(expectedStorageId));
      }
    }
  }
);
}
