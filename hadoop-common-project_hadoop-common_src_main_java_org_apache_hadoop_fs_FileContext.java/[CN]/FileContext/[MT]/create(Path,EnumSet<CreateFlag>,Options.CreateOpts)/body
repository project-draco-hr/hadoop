{
  Path absF=fixRelativePart(f);
  CreateOpts.Perms permOpt=(CreateOpts.Perms)CreateOpts.getOpt(CreateOpts.Perms.class,opts);
  FsPermission permission=(permOpt != null) ? permOpt.getValue() : FsPermission.getDefault();
  permission=permission.applyUMask(umask);
  final CreateOpts[] updatedOpts=CreateOpts.setOpt(CreateOpts.perms(permission),opts);
  return new FSLinkResolver<FSDataOutputStream>(){
    @Override public FSDataOutputStream next(    final AbstractFileSystem fs,    final Path p) throws IOException {
      return fs.create(p,createFlag,updatedOpts);
    }
  }
.resolve(this,absF);
}
