{
  final Path dir=new Path("/ec");
  final Path replicatedFile=new Path(dir,"replicatedFile");
  DFSTestUtil.createFile(fs,replicatedFile,0,(short)3,0L);
  fs.setErasureCodingPolicy(dir,null);
  final Path ecSubDir=new Path(dir,"ecSubDir");
  final Path ecFile=new Path(ecSubDir,"ecFile");
  DFSTestUtil.createFile(fs,ecFile,0,(short)1,0L);
  assertNull(fs.getClient().getFileInfo(replicatedFile.toString()).getErasureCodingPolicy());
  assertNotNull(fs.getClient().getFileInfo(ecFile.toString()).getErasureCodingPolicy());
  DirectoryListing listing=fs.getClient().listPaths(dir.toString(),new byte[0],false);
  HdfsFileStatus[] files=listing.getPartialListing();
  assertEquals(2,files.length);
  assertEquals(ecSubDir.getName(),files[0].getLocalName());
  assertNotNull(files[0].getErasureCodingPolicy());
  assertEquals(replicatedFile.getName(),files[1].getLocalName());
  assertNull(files[1].getErasureCodingPolicy());
  files=fs.getClient().listPaths(ecSubDir.toString(),new byte[0],false).getPartialListing();
  assertEquals(1,files.length);
  assertEquals(ecFile.getName(),files[0].getLocalName());
  assertNotNull(files[0].getErasureCodingPolicy());
  files=fs.getClient().listPaths("/",new byte[0],false).getPartialListing();
  assertEquals(1,files.length);
  assertEquals(dir.getName(),files[0].getLocalName());
  assertNotNull(files[0].getErasureCodingPolicy());
  assertTrue(fs.rename(ecFile,new Path("/ecFile")));
  files=fs.getClient().listPaths("/",new byte[0],false).getPartialListing();
  assertEquals(2,files.length);
  assertEquals(dir.getName(),files[0].getLocalName());
  assertNotNull(files[0].getErasureCodingPolicy());
  assertEquals(ecFile.getName(),files[1].getLocalName());
  assertNotNull(files[1].getErasureCodingPolicy());
}
