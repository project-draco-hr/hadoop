{
  ClientOperationHeaderProto header=DataTransferProtoUtil.buildClientHeader(blk,clientName,blockToken);
  ChecksumProto checksumProto=DataTransferProtoUtil.toProto(requestedChecksum);
  OpWriteBlockProto.Builder proto=OpWriteBlockProto.newBuilder().setHeader(header).setStorageType(PBHelper.convertStorageType(storageType)).addAllTargets(PBHelper.convert(targets,1)).addAllTargetStorageTypes(PBHelper.convertStorageTypes(targetStorageTypes,1)).setStage(toProto(stage)).setPipelineSize(pipelineSize).setMinBytesRcvd(minBytesRcvd).setMaxBytesRcvd(maxBytesRcvd).setLatestGenerationStamp(latestGenerationStamp).setRequestedChecksum(checksumProto).setCachingStrategy(getCachingStrategy(cachingStrategy));
  if (source != null) {
    proto.setSource(PBHelper.convertDatanodeInfo(source));
  }
  send(out,Op.WRITE_BLOCK,proto.build());
}
