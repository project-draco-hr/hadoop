{
  float effectiveUserLimit=Math.max(userLimit / 100.0f,1.0f / Math.max(getActiveUsersManager().getNumActiveUsers(),1));
  return Resources.multiplyAndNormalizeUp(resourceCalculator,absoluteCapacityResource,maxAMResourcePerQueuePercent * effectiveUserLimit * userLimitFactor,minimumAllocation);
}
