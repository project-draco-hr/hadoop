{
  if (lastRequestedHeartBeat != 0 && lastRequestedHeartBeat == request.getNodeStatus().getResponseId()) {
    LOG.info("GOT Duplicate heartbeatId " + request.getNodeStatus().getResponseId());
    gotDuplicateHeartBeatRequest=true;
  }
  lastRequestedHeartBeat=request.getNodeStatus().getResponseId();
  LOG.info("Got heartBeatId: [" + heartBeatID + "]");
  NodeStatus nodeStatus=request.getNodeStatus();
  nodeStatus.setResponseId(heartBeatID++);
  NodeHeartbeatResponse nhResponse=YarnServerBuilderUtils.newNodeHeartbeatResponse(heartBeatID,heartBeatNodeAction,null,null,null,null,1000L);
  if (heartBeatID == 5) {
    LOG.info("Sending FINISH_APP for application: [" + appId + "]");
    this.context.getApplications().put(appId,mock(Application.class));
    nhResponse.addAllApplicationsToCleanup(Collections.singletonList(appId));
  }
  if (heartBeatID == 6) {
    nhResponse.setResponseId(5);
    LOG.info("Sending FINISH_APP for application: [" + appId + "]");
    this.context.getApplications().put(appId,mock(Application.class));
    nhResponse.addAllApplicationsToCleanup(Collections.singletonList(appId));
  }
  return nhResponse;
}
