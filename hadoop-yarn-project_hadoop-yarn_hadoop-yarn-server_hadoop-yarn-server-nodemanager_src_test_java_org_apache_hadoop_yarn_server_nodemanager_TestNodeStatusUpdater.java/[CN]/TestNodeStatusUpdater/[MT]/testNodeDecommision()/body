{
  nm=getNodeManager(NodeAction.SHUTDOWN);
  YarnConfiguration conf=createNMConfig();
  nm.init(conf);
  Assert.assertEquals(STATE.INITED,nm.getServiceState());
  nm.start();
  int waitCount=0;
  while (heartBeatID < 1 && waitCount++ != 200) {
    Thread.sleep(500);
  }
  Assert.assertFalse(heartBeatID < 1);
  Assert.assertTrue(nm.getNMContext().getDecommissioned());
  waitCount=0;
  while (nm.getServiceState() != STATE.STOPPED && waitCount++ != 20) {
    LOG.info("Waiting for NM to stop..");
    Thread.sleep(1000);
  }
  Assert.assertEquals(STATE.STOPPED,nm.getServiceState());
}
