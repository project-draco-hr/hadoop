{
  MyNodeManager7 nm=new MyNodeManager7(){
    protected Dispatcher createDispatcher(){
      return new MyDispatcher7();
    }
  }
;
  try {
    YarnConfiguration conf=createNMConfig();
    conf.setLong(YarnConfiguration.RM_NM_EXPIRY_INTERVAL_MS,4000l);
    nm.init(conf);
    nm.start();
    MyResourceTracker7 rt=(MyResourceTracker7)nm.getNodeStatusUpdater().getRMClient();
    while (heartBeatID < 7) {
      Thread.sleep(1000l);
    }
    Assert.assertTrue(rt.isGotDuplicateHeartBeatRequest());
    MyDispatcher7 nmdispatcher=(MyDispatcher7)nm.getDispatcher();
    Assert.assertEquals(1,nmdispatcher.finishapp_event);
  }
  finally {
    if (nm.getServiceState() == STATE.STARTED)     nm.stop();
  }
}
