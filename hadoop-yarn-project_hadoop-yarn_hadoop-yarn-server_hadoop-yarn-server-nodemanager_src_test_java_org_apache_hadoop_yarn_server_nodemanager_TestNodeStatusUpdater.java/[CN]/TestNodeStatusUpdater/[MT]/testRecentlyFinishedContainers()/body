{
  NodeManager nm=new NodeManager();
  YarnConfiguration conf=new YarnConfiguration();
  conf.set(NodeStatusUpdaterImpl.YARN_NODEMANAGER_DURATION_TO_TRACK_STOPPED_CONTAINERS,"10000");
  nm.init(conf);
  NodeStatusUpdaterImpl nodeStatusUpdater=(NodeStatusUpdaterImpl)nm.getNodeStatusUpdater();
  ApplicationId appId=ApplicationId.newInstance(0,0);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,0);
  ContainerId cId=ContainerId.newContainerId(appAttemptId,0);
  nm.getNMContext().getApplications().putIfAbsent(appId,mock(Application.class));
  nm.getNMContext().getContainers().putIfAbsent(cId,mock(Container.class));
  nodeStatusUpdater.addCompletedContainer(cId);
  Assert.assertTrue(nodeStatusUpdater.isContainerRecentlyStopped(cId));
  nm.getNMContext().getContainers().remove(cId);
  long time1=System.currentTimeMillis();
  int waitInterval=15;
  while (waitInterval-- > 0 && nodeStatusUpdater.isContainerRecentlyStopped(cId)) {
    nodeStatusUpdater.removeVeryOldStoppedContainersFromCache();
    Thread.sleep(1000);
  }
  long time2=System.currentTimeMillis();
  Assert.assertFalse(nodeStatusUpdater.isContainerRecentlyStopped(cId));
  Assert.assertTrue((time2 - time1) >= 10000 && (time2 - time1) <= 250000);
}
