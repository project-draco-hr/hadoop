{
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(1).build();
  try {
    cluster.waitActive();
    DistributedFileSystem fs=(DistributedFileSystem)cluster.getFileSystem();
    Path testFile=new Path("/testFlushNanosMetric.txt");
    DFSTestUtil.createFile(fs,testFile,1,(short)1,new Random().nextLong());
    List<DataNode> datanodes=cluster.getDataNodes();
    DataNode datanode=datanodes.get(0);
    MetricsRecordBuilder dnMetrics=getMetrics(datanode.getMetrics().name());
    assertCounter("FlushNanosNumOps",2L,dnMetrics);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
