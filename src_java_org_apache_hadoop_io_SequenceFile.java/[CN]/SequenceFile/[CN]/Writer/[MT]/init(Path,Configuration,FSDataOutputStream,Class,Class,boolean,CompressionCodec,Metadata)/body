{
  this.conf=conf;
  this.out=out;
  this.keyClass=keyClass;
  this.valClass=valClass;
  this.compress=compress;
  this.codec=codec;
  this.metadata=metadata;
  SerializationFactory serializationFactory=new SerializationFactory(conf);
  this.keySerializer=getSerializer(serializationFactory,keyClass,metadata);
  this.keySerializer.open(buffer);
  this.uncompressedValSerializer=getSerializer(serializationFactory,valClass,metadata);
  this.uncompressedValSerializer.open(buffer);
  if (this.codec != null) {
    ReflectionUtils.setConf(this.codec,this.conf);
    this.compressor=CodecPool.getCompressor(this.codec);
    this.deflateFilter=this.codec.createOutputStream(buffer,compressor);
    this.deflateOut=new DataOutputStream(new BufferedOutputStream(deflateFilter));
    this.compressedValSerializer=getSerializer(serializationFactory,valClass,metadata);
    this.compressedValSerializer.open(deflateOut);
  }
}
