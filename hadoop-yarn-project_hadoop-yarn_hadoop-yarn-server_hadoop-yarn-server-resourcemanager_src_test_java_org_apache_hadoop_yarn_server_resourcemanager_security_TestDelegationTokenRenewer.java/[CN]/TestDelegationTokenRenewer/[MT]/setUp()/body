{
  counter=new AtomicInteger(0);
  conf.set(CommonConfigurationKeysPublic.HADOOP_SECURITY_AUTHENTICATION,"kerberos");
  UserGroupInformation.setConfiguration(conf);
  eventQueue=new LinkedBlockingQueue<Event>();
  dispatcher=new AsyncDispatcher(eventQueue);
  Renewer.reset();
  delegationTokenRenewer=createNewDelegationTokenRenewer(conf,counter);
  RMContext mockContext=mock(RMContext.class);
  ClientRMService mockClientRMService=mock(ClientRMService.class);
  when(mockContext.getSystemCredentialsForApps()).thenReturn(new ConcurrentHashMap<ApplicationId,ByteBuffer>());
  when(mockContext.getDelegationTokenRenewer()).thenReturn(delegationTokenRenewer);
  when(mockContext.getDispatcher()).thenReturn(dispatcher);
  when(mockContext.getClientRMService()).thenReturn(mockClientRMService);
  InetSocketAddress sockAddr=InetSocketAddress.createUnresolved("localhost",1234);
  when(mockClientRMService.getBindAddress()).thenReturn(sockAddr);
  delegationTokenRenewer.setRMContext(mockContext);
  delegationTokenRenewer.init(conf);
  delegationTokenRenewer.start();
}
