{
  HttpServletRequest request=Mockito.mock(HttpServletRequest.class);
  HttpServletResponse response=Mockito.mock(HttpServletResponse.class);
  Mockito.when(request.getQueryString()).thenReturn(DelegationTokenAuthenticator.DELEGATION_PARAM + "=invalid");
  StringWriter writer=new StringWriter();
  Mockito.when(response.getWriter()).thenReturn(new PrintWriter(writer));
  Assert.assertNull(handler.authenticate(request,response));
  Mockito.verify(response).setStatus(HttpServletResponse.SC_FORBIDDEN);
  Assert.assertTrue(writer.toString().contains("AuthenticationException"));
}
