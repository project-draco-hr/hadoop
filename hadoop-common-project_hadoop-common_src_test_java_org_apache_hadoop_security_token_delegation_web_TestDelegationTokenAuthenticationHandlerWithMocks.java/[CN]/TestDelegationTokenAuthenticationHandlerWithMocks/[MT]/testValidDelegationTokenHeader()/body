{
  HttpServletRequest request=Mockito.mock(HttpServletRequest.class);
  HttpServletResponse response=Mockito.mock(HttpServletResponse.class);
  Token<DelegationTokenIdentifier> dToken=handler.getTokenManager().createToken(UserGroupInformation.getCurrentUser(),"user");
  Mockito.when(request.getHeader(Mockito.eq(DelegationTokenAuthenticator.DELEGATION_TOKEN_HEADER))).thenReturn(dToken.encodeToUrlString());
  AuthenticationToken token=handler.authenticate(request,response);
  Assert.assertEquals(UserGroupInformation.getCurrentUser().getShortUserName(),token.getUserName());
  Assert.assertEquals(0,token.getExpires());
  Assert.assertEquals(handler.getType(),token.getType());
  Assert.assertTrue(token.isExpired());
}
