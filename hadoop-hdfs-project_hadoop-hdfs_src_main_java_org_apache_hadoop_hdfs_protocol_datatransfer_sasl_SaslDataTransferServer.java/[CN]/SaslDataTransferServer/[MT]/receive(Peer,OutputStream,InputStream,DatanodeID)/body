{
  if (dnConf.getEncryptDataTransfer()) {
    LOG.debug("SASL server doing encrypted handshake for peer = {}, datanodeId = {}",peer,datanodeId);
    return getEncryptedStreams(peer,underlyingOut,underlyingIn);
  }
 else   if (!UserGroupInformation.isSecurityEnabled()) {
    LOG.debug("SASL server skipping handshake in unsecured configuration for " + "peer = {}, datanodeId = {}",peer,datanodeId);
    return new IOStreamPair(underlyingIn,underlyingOut);
  }
 else   if (datanodeId.getXferPort() < 1024) {
    LOG.debug("SASL server skipping handshake in unsecured configuration for " + "peer = {}, datanodeId = {}",peer,datanodeId);
    return new IOStreamPair(underlyingIn,underlyingOut);
  }
 else {
    LOG.debug("SASL server doing general handshake for peer = {}, datanodeId = {}",peer,datanodeId);
    return getSaslStreams(peer,underlyingOut,underlyingIn,datanodeId);
  }
}
