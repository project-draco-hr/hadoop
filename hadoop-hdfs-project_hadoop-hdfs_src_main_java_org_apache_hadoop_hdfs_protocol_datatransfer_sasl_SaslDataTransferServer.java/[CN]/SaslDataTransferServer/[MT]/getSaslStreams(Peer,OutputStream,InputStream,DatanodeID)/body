{
  SaslPropertiesResolver saslPropsResolver=dnConf.getSaslPropsResolver();
  Map<String,String> saslProps=saslPropsResolver.getServerProperties(getPeerAddress(peer));
  CallbackHandler callbackHandler=new SaslServerCallbackHandler(new PasswordFunction(){
    @Override public char[] apply(    String userName) throws IOException {
      return buildServerPassword(userName);
    }
  }
);
  return doSaslHandshake(underlyingOut,underlyingIn,saslProps,callbackHandler);
}
