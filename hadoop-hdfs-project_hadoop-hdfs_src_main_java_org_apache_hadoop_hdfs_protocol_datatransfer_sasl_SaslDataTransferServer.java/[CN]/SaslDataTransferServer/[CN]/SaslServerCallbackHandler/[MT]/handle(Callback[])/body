{
  NameCallback nc=null;
  PasswordCallback pc=null;
  AuthorizeCallback ac=null;
  for (  Callback callback : callbacks) {
    if (callback instanceof AuthorizeCallback) {
      ac=(AuthorizeCallback)callback;
    }
 else     if (callback instanceof PasswordCallback) {
      pc=(PasswordCallback)callback;
    }
 else     if (callback instanceof NameCallback) {
      nc=(NameCallback)callback;
    }
 else     if (callback instanceof RealmCallback) {
      continue;
    }
 else {
      throw new UnsupportedCallbackException(callback,"Unrecognized SASL DIGEST-MD5 Callback: " + callback);
    }
  }
  if (pc != null) {
    pc.setPassword(passwordFunction.apply(nc.getDefaultName()));
  }
  if (ac != null) {
    ac.setAuthorized(true);
    ac.setAuthorizedID(ac.getAuthorizationID());
  }
}
