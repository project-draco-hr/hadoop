{
  Configuration conf=new Configuration(false);
  Cluster cluster=null;
  try {
    conf=new Configuration();
    conf.set(MRConfig.FRAMEWORK_NAME,MRConfig.YARN_FRAMEWORK_NAME);
    cluster=new Cluster(conf);
    YARNRunner yrunner=(YARNRunner)cluster.getClient();
    GetDelegationTokenResponse getDTResponse=recordFactory.newRecordInstance(GetDelegationTokenResponse.class);
    DelegationToken rmDTToken=recordFactory.newRecordInstance(DelegationToken.class);
    rmDTToken.setIdentifier(ByteBuffer.wrap(new byte[2]));
    rmDTToken.setKind("Testclusterkind");
    rmDTToken.setPassword(ByteBuffer.wrap("testcluster".getBytes()));
    rmDTToken.setService("0.0.0.0:8040");
    getDTResponse.setRMDelegationToken(rmDTToken);
    ClientRMProtocol cRMProtocol=mock(ClientRMProtocol.class);
    when(cRMProtocol.getDelegationToken(any(GetDelegationTokenRequest.class))).thenReturn(getDTResponse);
    ResourceMgrDelegate rmgrDelegate=new ResourceMgrDelegate(new YarnConfiguration(conf),cRMProtocol);
    yrunner.setResourceMgrDelegate(rmgrDelegate);
    Token t=cluster.getDelegationToken(new Text(" "));
    assertTrue("Testclusterkind".equals(t.getKind().toString()));
  }
  finally {
    if (cluster != null) {
      cluster.close();
    }
  }
}
