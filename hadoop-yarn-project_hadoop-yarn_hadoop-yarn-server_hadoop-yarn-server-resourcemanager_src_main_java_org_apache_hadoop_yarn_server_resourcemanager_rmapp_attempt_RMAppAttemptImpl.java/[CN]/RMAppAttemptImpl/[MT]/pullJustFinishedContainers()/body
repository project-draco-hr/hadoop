{
  this.writeLock.lock();
  try {
    List<ContainerStatus> returnList=new ArrayList<ContainerStatus>();
    sendFinishedContainersToNM();
    boolean keepContainersAcressAttempts=this.submissionContext.getKeepContainersAcrossApplicationAttempts();
    for (    NodeId nodeId : justFinishedContainers.keySet()) {
      List<ContainerStatus> finishedContainers=justFinishedContainers.put(nodeId,new ArrayList<ContainerStatus>());
      if (keepContainersAcressAttempts) {
        returnList.addAll(finishedContainers);
      }
 else {
        for (        ContainerStatus containerStatus : finishedContainers) {
          if (containerStatus.getContainerId().getApplicationAttemptId().equals(this.getAppAttemptId())) {
            returnList.add(containerStatus);
          }
        }
      }
      if (!finishedContainers.isEmpty()) {
        finishedContainersSentToAM.putIfAbsent(nodeId,new ArrayList<ContainerStatus>());
        finishedContainersSentToAM.get(nodeId).addAll(finishedContainers);
      }
    }
    return returnList;
  }
  finally {
    this.writeLock.unlock();
  }
}
