{
  if (appAttemptTokens == null || state == RMAppAttemptState.FAILED || state == RMAppAttemptState.FINISHED || state == RMAppAttemptState.KILLED) {
    return;
  }
  if (UserGroupInformation.isSecurityEnabled()) {
    byte[] clientTokenMasterKeyBytes=appAttemptTokens.getSecretKey(RMStateStore.AM_CLIENT_TOKEN_MASTER_KEY_NAME);
    if (clientTokenMasterKeyBytes != null) {
      clientTokenMasterKey=rmContext.getClientToAMTokenSecretManager().registerMasterKey(applicationAttemptId,clientTokenMasterKeyBytes);
    }
  }
  this.amrmToken=rmContext.getAMRMTokenSecretManager().createAndGetAMRMToken(applicationAttemptId);
}
