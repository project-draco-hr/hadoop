{
  appAttempt.startTime=System.currentTimeMillis();
  appAttempt.masterService.registerAppAttempt(appAttempt.applicationAttemptId);
  if (UserGroupInformation.isSecurityEnabled()) {
    appAttempt.rmContext.getClientToAMTokenSecretManager().registerApplication(appAttempt.applicationAttemptId);
    appAttempt.clientToken=new Token<ClientTokenIdentifier>(new ClientTokenIdentifier(appAttempt.applicationAttemptId),appAttempt.rmContext.getClientToAMTokenSecretManager());
    ApplicationTokenIdentifier id=new ApplicationTokenIdentifier(appAttempt.applicationAttemptId);
    Token<ApplicationTokenIdentifier> applicationToken=new Token<ApplicationTokenIdentifier>(id,appAttempt.rmContext.getApplicationTokenSecretManager());
    InetSocketAddress serviceAddr=appAttempt.conf.getSocketAddr(YarnConfiguration.RM_SCHEDULER_ADDRESS,YarnConfiguration.DEFAULT_RM_SCHEDULER_ADDRESS,YarnConfiguration.DEFAULT_RM_SCHEDULER_PORT);
    SecurityUtil.setTokenService(applicationToken,serviceAddr);
    appAttempt.applicationToken=applicationToken;
  }
  appAttempt.eventHandler.handle(new AppAddedSchedulerEvent(appAttempt.applicationAttemptId,appAttempt.submissionContext.getQueue(),appAttempt.user));
}
