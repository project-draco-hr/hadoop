{
  appAttempt.startTime=System.currentTimeMillis();
  appAttempt.masterService.registerAppAttempt(appAttempt.applicationAttemptId);
  if (UserGroupInformation.isSecurityEnabled()) {
    appAttempt.rmContext.getClientToAMTokenSecretManager().registerApplication(appAttempt.applicationAttemptId);
    appAttempt.clientToken=new Token<ClientTokenIdentifier>(new ClientTokenIdentifier(appAttempt.applicationAttemptId),appAttempt.rmContext.getClientToAMTokenSecretManager());
    AMRMTokenIdentifier id=new AMRMTokenIdentifier(appAttempt.applicationAttemptId);
    Token<AMRMTokenIdentifier> amRmToken=new Token<AMRMTokenIdentifier>(id,appAttempt.rmContext.getAMRMTokenSecretManager());
    InetSocketAddress serviceAddr=appAttempt.conf.getSocketAddr(YarnConfiguration.RM_SCHEDULER_ADDRESS,YarnConfiguration.DEFAULT_RM_SCHEDULER_ADDRESS,YarnConfiguration.DEFAULT_RM_SCHEDULER_PORT);
    SecurityUtil.setTokenService(amRmToken,serviceAddr);
    appAttempt.amrmToken=amRmToken;
  }
  appAttempt.eventHandler.handle(new AppAddedSchedulerEvent(appAttempt.applicationAttemptId,appAttempt.submissionContext.getQueue(),appAttempt.user));
}
