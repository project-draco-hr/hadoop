{
  appAttempt.startTime=System.currentTimeMillis();
  appAttempt.masterService.registerAppAttempt(appAttempt.applicationAttemptId);
  if (UserGroupInformation.isSecurityEnabled()) {
    appAttempt.rmContext.getClientToAMTokenSecretManager().registerApplication(appAttempt.applicationAttemptId);
    appAttempt.clientToAMToken=new Token<ClientToAMTokenIdentifier>(new ClientToAMTokenIdentifier(appAttempt.applicationAttemptId,appAttempt.user),appAttempt.rmContext.getClientToAMTokenSecretManager());
  }
  AMRMTokenIdentifier id=new AMRMTokenIdentifier(appAttempt.applicationAttemptId);
  appAttempt.amrmToken=new Token<AMRMTokenIdentifier>(id,appAttempt.rmContext.getAMRMTokenSecretManager());
  appAttempt.eventHandler.handle(new AppAddedSchedulerEvent(appAttempt.applicationAttemptId,appAttempt.submissionContext.getQueue(),appAttempt.user));
}
