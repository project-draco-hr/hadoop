{
  if (appAttempt.recoveredFinalState != null) {
    appAttempt.progress=1.0f;
    RMApp rmApp=appAttempt.rmContext.getRMApps().get(appAttempt.getAppAttemptId().getApplicationId());
    if (rmApp.getCurrentAppAttempt() == appAttempt && !RMAppImpl.isAppInFinalState(rmApp)) {
      appAttempt.scheduler.handle(new AppAttemptAddedSchedulerEvent(appAttempt.getAppAttemptId(),false,true));
      (new BaseFinalTransition(appAttempt.recoveredFinalState)).transition(appAttempt,event);
    }
    return appAttempt.recoveredFinalState;
  }
 else {
    if (appAttempt.rmContext.isWorkPreservingRecoveryEnabled()) {
      appAttempt.masterService.registerAppAttempt(appAttempt.applicationAttemptId);
      appAttempt.scheduler.handle(new AppAttemptAddedSchedulerEvent(appAttempt.getAppAttemptId(),false,true));
    }
    (new AMLaunchedTransition()).transition(appAttempt,event);
    return RMAppAttemptState.LAUNCHED;
  }
}
