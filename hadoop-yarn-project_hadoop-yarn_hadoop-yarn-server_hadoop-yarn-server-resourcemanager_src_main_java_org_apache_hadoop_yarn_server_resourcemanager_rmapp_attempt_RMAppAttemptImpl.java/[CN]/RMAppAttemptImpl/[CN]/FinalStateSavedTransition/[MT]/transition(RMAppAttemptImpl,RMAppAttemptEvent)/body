{
  RMAppAttemptUpdateSavedEvent storeEvent=(RMAppAttemptUpdateSavedEvent)event;
  if (storeEvent.getUpdatedException() != null) {
    LOG.error("Failed to update the final state of application attempt: " + storeEvent.getApplicationAttemptId(),storeEvent.getUpdatedException());
    ExitUtil.terminate(1,storeEvent.getUpdatedException());
  }
  RMAppAttemptEvent causeEvent=appAttempt.eventCausingFinalSaving;
  if (appAttempt.transitionTodo instanceof SingleArcTransition) {
    ((SingleArcTransition)appAttempt.transitionTodo).transition(appAttempt,causeEvent);
  }
 else   if (appAttempt.transitionTodo instanceof MultipleArcTransition) {
    ((MultipleArcTransition)appAttempt.transitionTodo).transition(appAttempt,causeEvent);
  }
  return appAttempt.targetedFinalState;
}
