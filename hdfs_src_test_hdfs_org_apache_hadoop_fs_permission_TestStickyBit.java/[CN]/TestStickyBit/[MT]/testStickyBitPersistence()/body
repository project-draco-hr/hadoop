{
  MiniDFSCluster cluster=null;
  try {
    Configuration conf=new HdfsConfiguration();
    conf.setBoolean(DFSConfigKeys.DFS_PERMISSIONS_ENABLED_KEY,true);
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(4).build();
    FileSystem hdfs=cluster.getFileSystem();
    assertTrue(hdfs instanceof DistributedFileSystem);
    Path sbSet=new Path("/Housemartins");
    Path sbNotSpecified=new Path("/INXS");
    Path sbSetOff=new Path("/Easyworld");
    for (    Path p : new Path[]{sbSet,sbNotSpecified,sbSetOff})     hdfs.mkdirs(p);
    hdfs.setPermission(sbSet,new FsPermission((short)01777));
    hdfs.setPermission(sbSetOff,new FsPermission((short)00777));
    cluster.shutdown();
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(4).format(false).build();
    hdfs=cluster.getFileSystem();
    assertTrue(hdfs.exists(sbSet));
    assertTrue(hdfs.getFileStatus(sbSet).getPermission().getStickyBit());
    assertTrue(hdfs.exists(sbNotSpecified));
    assertFalse(hdfs.getFileStatus(sbNotSpecified).getPermission().getStickyBit());
    assertTrue(hdfs.exists(sbSetOff));
    assertFalse(hdfs.getFileStatus(sbSetOff).getPermission().getStickyBit());
  }
  finally {
    if (cluster != null)     cluster.shutdown();
  }
}
