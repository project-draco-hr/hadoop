{
  String[] fullCommandArray=getPrivilegedOperationExecutionCommand(prefixCommands,operation);
  ShellCommandExecutor exec=new ShellCommandExecutor(fullCommandArray,workingDir,env);
  try {
    exec.execute();
    if (LOG.isDebugEnabled()) {
      LOG.debug("command array:");
      LOG.debug(Arrays.toString(fullCommandArray));
      LOG.debug("Privileged Execution Operation Output:");
      LOG.debug(exec.getOutput());
    }
  }
 catch (  ExitCodeException e) {
    StringBuilder logBuilder=new StringBuilder("Shell execution returned " + "exit code: ").append(exec.getExitCode()).append(". Privileged Execution Operation Output: ").append(System.lineSeparator()).append(exec.getOutput());
    logBuilder.append("Full command array for failed execution: ").append(System.lineSeparator());
    logBuilder.append(Arrays.toString(fullCommandArray));
    LOG.warn(logBuilder.toString());
    throw new PrivilegedOperationException(e,e.getExitCode(),exec.getOutput(),e.getMessage());
  }
catch (  IOException e) {
    LOG.warn("IOException executing command: ",e);
    throw new PrivilegedOperationException(e);
  }
  if (grabOutput) {
    return exec.getOutput();
  }
  return null;
}
