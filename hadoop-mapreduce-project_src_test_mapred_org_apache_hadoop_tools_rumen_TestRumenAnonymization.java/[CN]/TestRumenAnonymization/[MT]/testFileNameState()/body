{
  Configuration conf=new Configuration();
  FileSystem lfs=FileSystem.getLocal(conf);
  Path rootTempDir=new Path(System.getProperty("test.build.data","/tmp"));
  Path tempDir=new Path(rootTempDir,"testFileNameState");
  tempDir=lfs.makeQualified(tempDir);
  lfs.delete(tempDir,true);
  conf.set(StatePool.DIR_CONFIG,tempDir.toString());
  conf.setBoolean(StatePool.PERSIST_CONFIG,true);
  StatePool pool=new StatePool();
  FileNameState fState=new FileNameState();
  String testD1="test";
  String testD2="home";
  String testD3="tmp";
  WordList dirState=new WordList("dir");
  dirState.add(testD1);
  dirState.add(testD2);
  dirState.add(testD3);
  String testF1="part-00.bzip";
  String testF2="file1.txt";
  String testF3="tmp";
  WordList fileNameState=new WordList("files");
  fileNameState.add(testF1);
  fileNameState.add(testF2);
  fileNameState.add(testF3);
  fState.setFileNameState(fileNameState);
  fState.setDirectoryState(dirState);
  try {
    pool.initialize(conf);
    pool.addState(getClass(),fState);
    pool.persist();
    pool=new StatePool();
    conf.setBoolean(StatePool.RELOAD_CONFIG,true);
    pool.initialize(conf);
    State state=pool.getState(getClass());
    assertNotNull("Missing state!",state);
    assertEquals("Incorrect state class!",FileNameState.class,state.getClass());
    FileNameState newFState=(FileNameState)state;
    WordList newStateWordList=newFState.getFileNameState();
    assertTrue("File state failed on reload",newStateWordList.contains(testF1));
    assertEquals("File state indexing on reload failed",0,newStateWordList.indexOf(testF1));
    assertTrue("File state failed on reload",newStateWordList.contains(testF2));
    assertEquals("File state indexing on reload failed",1,newStateWordList.indexOf(testF2));
    assertTrue("File state failed on reload",newStateWordList.contains(testF3));
    assertEquals("File state indexing on reload failed",2,newStateWordList.indexOf(testF3));
    WordList newDirWordList=newFState.getDirectoryState();
    assertTrue("File state failed on reload",newDirWordList.contains(testD1));
    assertEquals("File state indexing on reload failed",0,newDirWordList.indexOf(testD1));
    assertTrue("File state failed on reload",newDirWordList.contains(testD2));
    assertEquals("File state indexing on reload failed",1,newDirWordList.indexOf(testD2));
    assertTrue("File state failed on reload",newDirWordList.contains(testD3));
    assertEquals("File state indexing on reload failed",2,newDirWordList.indexOf(testD3));
  }
  finally {
    lfs.delete(tempDir,true);
  }
}
