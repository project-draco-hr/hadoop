{
  if (allocatedSlots.get(slotIdx)) {
    throw new InvalidRequestException(this + ": slot " + slotIdx+ " is already in use.");
  }
  Slot slot=new Slot(calculateSlotAddress(slotIdx),blockId);
  if (!slot.isValid()) {
    throw new InvalidRequestException(this + ": slot " + slotIdx+ " has not been allocated.");
  }
  slots[slotIdx]=slot;
  allocatedSlots.set(slotIdx,true);
  if (LOG.isTraceEnabled()) {
    LOG.trace(this + ": registerSlot " + slotIdx+ ": allocatedSlots="+ allocatedSlots+ StringUtils.getStackTrace(Thread.currentThread()));
  }
  return slot;
}
