{
  DatanodeDescriptor dd=BlockManagerTestUtil.getLocalDatanodeDescriptor(true);
  assertEquals(0,dd.numBlocks());
  BlockInfoContiguous blk=new BlockInfoContiguous(new Block(1L),(short)1);
  BlockInfoContiguous blk1=new BlockInfoContiguous(new Block(2L),(short)2);
  DatanodeStorageInfo[] storages=dd.getStorageInfos();
  assertTrue(storages.length > 0);
  assertTrue(storages[0].addBlock(blk) == AddBlockResult.ADDED);
  assertEquals(1,dd.numBlocks());
  assertFalse(dd.removeBlock(blk1));
  assertEquals(1,dd.numBlocks());
  assertFalse(storages[0].addBlock(blk) == AddBlockResult.ADDED);
  assertEquals(1,dd.numBlocks());
  assertTrue(storages[0].addBlock(blk1) == AddBlockResult.ADDED);
  assertEquals(2,dd.numBlocks());
  assertTrue(dd.removeBlock(blk));
  assertEquals(1,dd.numBlocks());
  assertTrue(dd.removeBlock(blk1));
  assertEquals(0,dd.numBlocks());
}
