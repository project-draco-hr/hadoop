{
  DatanodeDescriptor dd=BlockManagerTestUtil.getLocalDatanodeDescriptor(true);
  assertEquals(0,dd.numBlocks());
  BlockInfo blk=new BlockInfo(new Block(1L),1);
  BlockInfo blk1=new BlockInfo(new Block(2L),2);
  Iterator<DatanodeStorageInfo> iterator=dd.getStorageInfos().iterator();
  assertTrue(iterator.hasNext());
  final String storageID=iterator.next().getStorageID();
  assertTrue(dd.addBlock(storageID,blk));
  assertEquals(1,dd.numBlocks());
  assertFalse(dd.removeBlock(blk1));
  assertEquals(1,dd.numBlocks());
  assertFalse(dd.addBlock(storageID,blk));
  assertEquals(1,dd.numBlocks());
  assertTrue(dd.addBlock(storageID,blk1));
  assertEquals(2,dd.numBlocks());
  assertTrue(dd.removeBlock(blk));
  assertEquals(1,dd.numBlocks());
  assertTrue(dd.removeBlock(blk1));
  assertEquals(0,dd.numBlocks());
}
