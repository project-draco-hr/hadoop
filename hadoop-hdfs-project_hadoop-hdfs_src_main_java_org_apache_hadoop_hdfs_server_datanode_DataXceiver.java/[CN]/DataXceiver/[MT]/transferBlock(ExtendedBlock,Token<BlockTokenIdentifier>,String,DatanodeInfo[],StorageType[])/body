{
  checkAccess(socketOut,true,blk,blockToken,Op.TRANSFER_BLOCK,BlockTokenSecretManager.AccessMode.COPY);
  previousOpClientName=clientName;
  updateCurrentThreadName(Op.TRANSFER_BLOCK + " " + blk);
  final DataOutputStream out=new DataOutputStream(getOutputStream());
  try {
    datanode.transferReplicaForPipelineRecovery(blk,targets,targetStorageTypes,clientName);
    writeResponse(Status.SUCCESS,null,out);
  }
 catch (  IOException ioe) {
    LOG.info("transferBlock " + blk + " received exception "+ ioe);
    datanode.metrics.incrDatanodeNetworkErrors();
    throw ioe;
  }
 finally {
    IOUtils.closeStream(out);
  }
}
