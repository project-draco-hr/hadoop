{
  new ConfigBuilder().add("*.period",8).add("test.sink.test.class",TestSink.class.getName()).save(TestMetricsConfig.getTestFilename("hadoop-metrics2-test"));
  MetricsSystemImpl ms=new MetricsSystemImpl("Test");
  ms.start();
  try {
    CountDownLatch collectingLatch=new CountDownLatch(1);
    MetricsSink sink=new TestClosableSink(collectingLatch);
    ms.registerSink("closeableSink","The sink will be used to test closeability",sink);
    ms.onTimerEvent();
    assertTrue(collectingLatch.await(1,TimeUnit.SECONDS));
  }
  finally {
    ms.stop();
  }
}
