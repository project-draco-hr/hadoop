{
  mockNN1=setupNNMock();
  mockNN2=setupNNMock();
  mockDn=Mockito.mock(DataNode.class);
  Mockito.doReturn(true).when(mockDn).shouldRun();
  Configuration conf=new Configuration();
  Mockito.doReturn(conf).when(mockDn).getConf();
  Mockito.doReturn(new DNConf(conf)).when(mockDn).getDnConf();
  Mockito.doReturn(DataNodeMetrics.create(conf,"fake dn")).when(mockDn).getMetrics();
  mockFSDataset=Mockito.spy(new SimulatedFSDataset(conf));
  mockFSDataset.addBlockPool(FAKE_BPID,conf);
  Mockito.doReturn(mockFSDataset).when(mockDn).getFSDataset();
}
