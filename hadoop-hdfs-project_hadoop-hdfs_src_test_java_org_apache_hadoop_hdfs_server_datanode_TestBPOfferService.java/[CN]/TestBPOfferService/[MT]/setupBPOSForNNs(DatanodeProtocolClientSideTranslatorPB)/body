{
  final Map<InetSocketAddress,DatanodeProtocolClientSideTranslatorPB> nnMap=Maps.newLinkedHashMap();
  for (int port=0; port < nns.length; port++) {
    nnMap.put(new InetSocketAddress(port),nns[port]);
  }
  return new BPOfferService(Lists.newArrayList(nnMap.keySet()),mockDn){
    @Override DatanodeProtocolClientSideTranslatorPB connectToNN(    InetSocketAddress nnAddr) throws IOException {
      DatanodeProtocolClientSideTranslatorPB nn=nnMap.get(nnAddr);
      if (nn == null) {
        throw new AssertionError("bad NN addr: " + nnAddr);
      }
      return nn;
    }
  }
;
}
