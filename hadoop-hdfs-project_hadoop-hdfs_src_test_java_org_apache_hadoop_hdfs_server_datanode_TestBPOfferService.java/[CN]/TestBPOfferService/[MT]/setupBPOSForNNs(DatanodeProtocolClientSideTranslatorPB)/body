{
  final Map<InetSocketAddress,DatanodeProtocolClientSideTranslatorPB> nnMap=Maps.newLinkedHashMap();
  for (int port=0; port < nns.length; port++) {
    nnMap.put(new InetSocketAddress(port),nns[port]);
    Mockito.doReturn(nns[port]).when(mockDn).connectToNN(Mockito.eq(new InetSocketAddress(port)));
  }
  return new BPOfferService(Lists.newArrayList(nnMap.keySet()),mockDn);
}
