{
  TaskTrackerHealthStatus healthStatus=new TaskTrackerHealthStatus();
  String errorScript="echo ERROR\n echo \"Tracker not healthy\"";
  String normalScript="echo \"I am all fine\"";
  String timeOutScript="sleep 4\n echo\"I am fine\"";
  Configuration conf=getConfForNodeHealthScript();
  conf.writeXml(new FileOutputStream(nodeHealthConfigFile));
  NodeHealthCheckerService nodeHealthChecker=new NodeHealthCheckerService(conf);
  TimerTask timer=nodeHealthChecker.getTimer();
  writeNodeHealthScriptFile(normalScript,true);
  timer.run();
  nodeHealthChecker.setHealthStatus(healthStatus);
  LOG.info("Checking initial healthy condition");
  assertTrue("Node health status reported unhealthy",healthStatus.isNodeHealthy());
  assertTrue("Node health status reported unhealthy",healthStatus.getHealthReport().isEmpty());
  writeNodeHealthScriptFile(errorScript,true);
  timer.run();
  nodeHealthChecker.setHealthStatus(healthStatus);
  LOG.info("Checking Healthy--->Unhealthy");
  assertFalse("Node health status reported healthy",healthStatus.isNodeHealthy());
  assertFalse("Node health status reported healthy",healthStatus.getHealthReport().isEmpty());
  writeNodeHealthScriptFile(normalScript,true);
  timer.run();
  nodeHealthChecker.setHealthStatus(healthStatus);
  LOG.info("Checking UnHealthy--->healthy");
  assertTrue("Node health status reported unhealthy",healthStatus.isNodeHealthy());
  assertTrue("Node health status reported unhealthy",healthStatus.getHealthReport().isEmpty());
  writeNodeHealthScriptFile(timeOutScript,true);
  timer.run();
  nodeHealthChecker.setHealthStatus(healthStatus);
  LOG.info("Checking Healthy--->timeout");
  assertFalse("Node health status reported healthy even after timeout",healthStatus.isNodeHealthy());
  assertEquals("Node time out message not propogated",healthStatus.getHealthReport(),NodeHealthCheckerService.NODE_HEALTH_SCRIPT_TIMED_OUT_MSG);
}
