{
  setBlockTotal();
  blockManager.activate(conf);
  this.hbthread=new Daemon(new HeartbeatMonitor());
  this.lmthread=new Daemon(leaseManager.new Monitor());
  this.replthread=new Daemon(new ReplicationMonitor());
  hbthread.start();
  lmthread.start();
  replthread.start();
  this.nnrmthread=new Daemon(new NameNodeResourceMonitor());
  nnrmthread.start();
  this.dnsToSwitchMapping=ReflectionUtils.newInstance(conf.getClass(DFSConfigKeys.NET_TOPOLOGY_NODE_SWITCH_MAPPING_IMPL_KEY,ScriptBasedMapping.class,DNSToSwitchMapping.class),conf);
  if (dnsToSwitchMapping instanceof CachedDNSToSwitchMapping) {
    dnsToSwitchMapping.resolve(new ArrayList<String>(hostsReader.getHosts()));
  }
  registerMXBean();
  DefaultMetricsSystem.instance().register(this);
}
