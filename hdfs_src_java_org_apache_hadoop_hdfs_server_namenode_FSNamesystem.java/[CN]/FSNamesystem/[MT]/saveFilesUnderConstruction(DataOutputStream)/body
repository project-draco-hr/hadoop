{
synchronized (leaseManager) {
    out.writeInt(leaseManager.countPath());
    for (    Lease lease : leaseManager.getSortedLeases()) {
      for (      String path : lease.getPaths()) {
        INode node;
        try {
          node=dir.getFileINode(path);
        }
 catch (        UnresolvedLinkException e) {
          throw new AssertionError("Lease files should reside on this FS");
        }
        if (node == null) {
          throw new IOException("saveLeases found path " + path + " but no matching entry in namespace.");
        }
        if (!node.isUnderConstruction()) {
          throw new IOException("saveLeases found path " + path + " but is not under construction.");
        }
        INodeFileUnderConstruction cons=(INodeFileUnderConstruction)node;
        FSImageSerialization.writeINodeUnderConstruction(out,cons,path);
      }
    }
  }
}
