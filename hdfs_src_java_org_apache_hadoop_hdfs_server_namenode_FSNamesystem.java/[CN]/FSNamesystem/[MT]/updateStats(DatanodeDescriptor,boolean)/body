{
  assert(Thread.holdsLock(heartbeats));
  if (isAdded) {
    capacityUsed+=node.getDfsUsed();
    blockPoolUsed+=node.getBlockPoolUsed();
    totalLoad+=node.getXceiverCount();
    if (!(node.isDecommissionInProgress() || node.isDecommissioned())) {
      capacityTotal+=node.getCapacity();
      capacityRemaining+=node.getRemaining();
    }
 else {
      capacityTotal+=node.getDfsUsed();
    }
  }
 else {
    capacityUsed-=node.getDfsUsed();
    blockPoolUsed-=node.getBlockPoolUsed();
    totalLoad-=node.getXceiverCount();
    if (!(node.isDecommissionInProgress() || node.isDecommissioned())) {
      capacityTotal-=node.getCapacity();
      capacityRemaining-=node.getRemaining();
    }
 else {
      capacityTotal-=node.getDfsUsed();
    }
  }
}
