{
  int numDead=0;
synchronized (datanodeMap) {
    for (Iterator<DatanodeDescriptor> it=datanodeMap.values().iterator(); it.hasNext(); ) {
      DatanodeDescriptor dn=it.next();
      if (isDatanodeDead(dn)) {
        numDead++;
      }
    }
  }
  return numDead;
}
