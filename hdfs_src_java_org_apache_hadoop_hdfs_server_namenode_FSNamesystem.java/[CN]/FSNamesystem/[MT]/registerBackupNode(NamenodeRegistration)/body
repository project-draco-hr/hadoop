{
  writeLock();
  try {
    if (getFSImage().getStorage().getNamespaceID() != registration.getNamespaceID())     throw new IOException("Incompatible namespaceIDs: " + " Namenode namespaceID = " + getFSImage().getStorage().getNamespaceID() + "; "+ registration.getRole()+ " node namespaceID = "+ registration.getNamespaceID());
    boolean regAllowed=getEditLog().checkBackupRegistration(registration);
    if (!regAllowed)     throw new IOException("Registration is not allowed. " + "Another node is registered as a backup.");
  }
  finally {
    writeUnlock();
  }
}
