{
  checkSuperuserPrivilege();
  if (conf == null)   conf=new HdfsConfiguration();
  hostsReader.updateFileNames(conf.get(DFSConfigKeys.DFS_HOSTS,""),conf.get(DFSConfigKeys.DFS_HOSTS_EXCLUDE,""));
  hostsReader.refresh();
  writeLock();
  try {
    for (Iterator<DatanodeDescriptor> it=datanodeMap.values().iterator(); it.hasNext(); ) {
      DatanodeDescriptor node=it.next();
      if (!inHostsList(node,null)) {
        node.setDisallowed(true);
      }
 else {
        if (inExcludedHostsList(node,null)) {
          startDecommission(node);
        }
 else {
          stopDecommission(node);
        }
      }
    }
  }
  finally {
    writeUnlock();
  }
}
