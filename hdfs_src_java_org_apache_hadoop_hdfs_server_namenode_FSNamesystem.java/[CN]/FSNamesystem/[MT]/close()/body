{
  fsRunning=false;
  try {
    if (blockManager != null)     blockManager.close();
    if (hbthread != null)     hbthread.interrupt();
    if (replthread != null)     replthread.interrupt();
    if (smmthread != null)     smmthread.interrupt();
    if (dtSecretManager != null)     dtSecretManager.stopThreads();
    if (nnrmthread != null)     nnrmthread.interrupt();
  }
 catch (  Exception e) {
    LOG.warn("Exception shutting down FSNamesystem",e);
  }
 finally {
    try {
      if (lmthread != null) {
        lmthread.interrupt();
        lmthread.join(3000);
      }
      if (dir != null) {
        dir.close();
      }
    }
 catch (    InterruptedException ie) {
    }
catch (    IOException ie) {
      LOG.error("Error closing FSDirectory",ie);
      IOUtils.cleanup(LOG,dir);
    }
  }
}
