{
  if (checkForUpgrades) {
    boolean needUpgrade=false;
    try {
      needUpgrade=startDistributedUpgradeIfNeeded();
    }
 catch (    IOException e) {
      FSNamesystem.LOG.error(StringUtils.stringifyException(e));
    }
    if (needUpgrade) {
      safeMode=new SafeModeInfo(false);
      return;
    }
  }
  if (!isPopulatingReplQueues()) {
    initializeReplQueues();
  }
  long timeInSafemode=now() - systemStart;
  NameNode.stateChangeLog.info("STATE* Leaving safe mode after " + timeInSafemode / 1000 + " secs.");
  NameNode.getNameNodeMetrics().setSafeModeTime((int)timeInSafemode);
  if (reached >= 0) {
    NameNode.stateChangeLog.info("STATE* Safe mode is OFF.");
  }
  reached=-1;
  safeMode=null;
  NameNode.stateChangeLog.info("STATE* Network topology has " + clusterMap.getNumOfRacks() + " racks and "+ clusterMap.getNumOfLeaves()+ " datanodes");
  NameNode.stateChangeLog.info("STATE* UnderReplicatedBlocks has " + blockManager.neededReplications.size() + " blocks");
}
