{
  boolean getAllMetrics=false;
synchronized (this) {
    if (Time.now() - jmxCacheTS >= jmxCacheTTL) {
      jmxCacheTS=Time.now() + jmxCacheTTL;
      if (lastRecsCleared) {
        getAllMetrics=true;
        lastRecsCleared=false;
      }
    }
 else {
      return;
    }
  }
  Iterable<MetricsRecordImpl> lastRecs=null;
  if (getAllMetrics) {
    lastRecs=getMetrics(new MetricsCollectorImpl(),true);
  }
synchronized (this) {
    if (lastRecs != null) {
      updateAttrCache(lastRecs);
      updateInfoCache(lastRecs);
    }
    jmxCacheTS=Time.now();
    lastRecsCleared=true;
  }
}
