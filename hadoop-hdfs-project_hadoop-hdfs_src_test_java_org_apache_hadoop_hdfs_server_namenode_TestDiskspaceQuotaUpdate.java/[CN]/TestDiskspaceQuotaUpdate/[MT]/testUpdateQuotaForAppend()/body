{
  final Path foo=new Path(getParent(GenericTestUtils.getMethodName()),"foo");
  final Path bar=new Path(foo,"bar");
  long currentFileLen=BLOCKSIZE;
  DFSTestUtil.createFile(getDFS(),bar,currentFileLen,REPLICATION,seed);
  getDFS().setQuota(foo,Long.MAX_VALUE - 1,Long.MAX_VALUE - 1);
  DFSTestUtil.appendFile(getDFS(),bar,BLOCKSIZE / 2);
  currentFileLen+=(BLOCKSIZE / 2);
  INodeDirectory fooNode=getFSDirectory().getINode4Write(foo.toString()).asDirectory();
  assertTrue(fooNode.isQuotaSet());
  QuotaCounts quota=fooNode.getDirectoryWithQuotaFeature().getSpaceConsumed();
  long ns=quota.getNameSpace();
  long ds=quota.getStorageSpace();
  assertEquals(2,ns);
  assertEquals(currentFileLen * REPLICATION,ds);
  ContentSummary c=getDFS().getContentSummary(foo);
  assertEquals(c.getSpaceConsumed(),ds);
  DFSTestUtil.appendFile(getDFS(),bar,BLOCKSIZE);
  currentFileLen+=BLOCKSIZE;
  quota=fooNode.getDirectoryWithQuotaFeature().getSpaceConsumed();
  ns=quota.getNameSpace();
  ds=quota.getStorageSpace();
  assertEquals(2,ns);
  assertEquals(currentFileLen * REPLICATION,ds);
  c=getDFS().getContentSummary(foo);
  assertEquals(c.getSpaceConsumed(),ds);
  DFSTestUtil.appendFile(getDFS(),bar,BLOCKSIZE * 3 + BLOCKSIZE / 8);
  currentFileLen+=(BLOCKSIZE * 3 + BLOCKSIZE / 8);
  quota=fooNode.getDirectoryWithQuotaFeature().getSpaceConsumed();
  ns=quota.getNameSpace();
  ds=quota.getStorageSpace();
  assertEquals(2,ns);
  assertEquals(currentFileLen * REPLICATION,ds);
  c=getDFS().getContentSummary(foo);
  assertEquals(c.getSpaceConsumed(),ds);
}
