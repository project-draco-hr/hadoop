{
  final Path foo=new Path("/foo");
  final Path bar=new Path(foo,"bar");
  DFSTestUtil.createFile(dfs,bar,BLOCKSIZE,REPLICATION,0L);
  dfs.setQuota(foo,Long.MAX_VALUE - 1,Long.MAX_VALUE - 1);
  DFSTestUtil.appendFile(dfs,bar,BLOCKSIZE / 2);
  INodeDirectory fooNode=fsdir.getINode4Write(foo.toString()).asDirectory();
  Quota.Counts quota=fooNode.getDirectoryWithQuotaFeature().getSpaceConsumed();
  long ns=quota.get(Quota.NAMESPACE);
  long ds=quota.get(Quota.DISKSPACE);
  assertEquals(2,ns);
  assertEquals((BLOCKSIZE + BLOCKSIZE / 2) * REPLICATION,ds);
  DFSTestUtil.appendFile(dfs,bar,BLOCKSIZE);
  quota=fooNode.getDirectoryWithQuotaFeature().getSpaceConsumed();
  ns=quota.get(Quota.NAMESPACE);
  ds=quota.get(Quota.DISKSPACE);
  assertEquals(2,ns);
  assertEquals((BLOCKSIZE * 2 + BLOCKSIZE / 2) * REPLICATION,ds);
}
