{
  final int size=500;
  Path testDir=new Path("/testDir");
  long expectedSize=3 * BLOCKSIZE + BLOCKSIZE / 2;
  dfs.mkdirs(testDir);
  dfs.setQuota(testDir,size * 4,expectedSize * size * 2);
  Path[] testDirs=new Path[size];
  for (int i=0; i < size; i++) {
    testDirs[i]=new Path(testDir,"sub" + i);
    dfs.mkdirs(testDirs[i]);
    dfs.setQuota(testDirs[i],100,1000000);
    DFSTestUtil.createFile(dfs,new Path(testDirs[i],"a"),expectedSize,(short)1,1L);
  }
  INodeDirectory root=fsdir.getRoot();
  HashMap<String,Long> nsMap=new HashMap<String,Long>();
  HashMap<String,Long> dsMap=new HashMap<String,Long>();
  scanDirsWithQuota(root,nsMap,dsMap,false);
  fsdir.updateCountForQuota(1);
  scanDirsWithQuota(root,nsMap,dsMap,true);
  fsdir.updateCountForQuota(2);
  scanDirsWithQuota(root,nsMap,dsMap,true);
  fsdir.updateCountForQuota(4);
  scanDirsWithQuota(root,nsMap,dsMap,true);
}
