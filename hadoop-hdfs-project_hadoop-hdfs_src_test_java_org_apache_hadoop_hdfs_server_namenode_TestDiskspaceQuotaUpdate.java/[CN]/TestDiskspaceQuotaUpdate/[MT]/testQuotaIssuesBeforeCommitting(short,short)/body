{
  final String logStmt="BUG: Inconsistent storagespace for directory";
  final Path dir=new Path(getParent(GenericTestUtils.getMethodName()),String.format("%d-%d",initialReplication,finalReplication));
  final Path file=new Path(dir,"testfile");
  LogCapturer logs=LogCapturer.captureLogs(NameNode.LOG);
  getDFS().mkdirs(dir);
  getDFS().setQuota(dir,Long.MAX_VALUE - 1,Long.MAX_VALUE - 1);
  FSDataOutputStream out=TestFileCreation.createFile(getDFS(),file,initialReplication);
  TestFileCreation.writeFile(out,BLOCKSIZE / 2);
  out.hflush();
  getDFS().getContentSummary(dir);
  if (finalReplication != initialReplication) {
    getDFS().setReplication(file,finalReplication);
  }
  out.close();
  getDFS().getContentSummary(dir);
  assertFalse(logs.getOutput().contains(logStmt));
}
