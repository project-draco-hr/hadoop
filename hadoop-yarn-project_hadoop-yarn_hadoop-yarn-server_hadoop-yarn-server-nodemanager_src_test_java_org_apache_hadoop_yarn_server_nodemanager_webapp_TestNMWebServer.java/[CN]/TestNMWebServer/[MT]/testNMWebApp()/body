{
  Context nmContext=new NodeManager.NMContext(null);
  ResourceView resourceView=new ResourceView(){
    @Override public long getVmemAllocatedForContainers(){
      return 0;
    }
    @Override public long getPmemAllocatedForContainers(){
      return 0;
    }
    @Override public boolean isVmemCheckEnabled(){
      return true;
    }
    @Override public boolean isPmemCheckEnabled(){
      return true;
    }
  }
;
  Configuration conf=new Configuration();
  conf.set(YarnConfiguration.NM_LOCAL_DIRS,testRootDir.getAbsolutePath());
  conf.set(YarnConfiguration.NM_LOG_DIRS,testLogDir.getAbsolutePath());
  NodeHealthCheckerService healthChecker=new NodeHealthCheckerService();
  healthChecker.init(conf);
  LocalDirsHandlerService dirsHandler=healthChecker.getDiskHandler();
  WebServer server=new WebServer(nmContext,resourceView,new ApplicationACLsManager(conf),dirsHandler);
  server.init(conf);
  server.start();
  RecordFactory recordFactory=RecordFactoryProvider.getRecordFactory(conf);
  Dispatcher dispatcher=new AsyncDispatcher();
  String user="nobody";
  long clusterTimeStamp=1234;
  ApplicationId appId=BuilderUtils.newApplicationId(recordFactory,clusterTimeStamp,1);
  Application app=mock(Application.class);
  when(app.getUser()).thenReturn(user);
  when(app.getAppId()).thenReturn(appId);
  nmContext.getApplications().put(appId,app);
  ApplicationAttemptId appAttemptId=BuilderUtils.newApplicationAttemptId(appId,1);
  ContainerId container1=BuilderUtils.newContainerId(recordFactory,appId,appAttemptId,0);
  ContainerId container2=BuilderUtils.newContainerId(recordFactory,appId,appAttemptId,1);
  NodeManagerMetrics metrics=mock(NodeManagerMetrics.class);
  for (  ContainerId containerId : new ContainerId[]{container1,container2}) {
    ContainerLaunchContext launchContext=recordFactory.newRecordInstance(ContainerLaunchContext.class);
    long currentTime=System.currentTimeMillis();
    ContainerToken containerToken=BuilderUtils.newContainerToken(containerId,"127.0.0.1",1234,user,BuilderUtils.newResource(1024,1),currentTime + 10000L,123,"password".getBytes(),currentTime);
    Container container=new ContainerImpl(conf,dispatcher,launchContext,null,metrics,BuilderUtils.newContainerTokenIdentifier(containerToken)){
      @Override public ContainerState getContainerState(){
        return ContainerState.RUNNING;
      }
    }
;
    nmContext.getContainers().put(containerId,container);
    ApplicationId applicationId=containerId.getApplicationAttemptId().getApplicationId();
    nmContext.getApplications().get(applicationId).getContainers().put(containerId,container);
    writeContainerLogs(nmContext,containerId,dirsHandler);
  }
}
