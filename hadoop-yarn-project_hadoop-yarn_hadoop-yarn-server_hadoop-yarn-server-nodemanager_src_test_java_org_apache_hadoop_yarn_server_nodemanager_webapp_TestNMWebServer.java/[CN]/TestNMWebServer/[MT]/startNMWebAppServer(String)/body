{
  Context nmContext=new NodeManager.NMContext();
  ResourceView resourceView=new ResourceView(){
    @Override public long getVmemAllocatedForContainers(){
      return 0;
    }
    @Override public long getPmemAllocatedForContainers(){
      return 0;
    }
  }
;
  Configuration conf=new Configuration();
  conf.set(YarnConfiguration.NM_LOCAL_DIRS,testRootDir.getAbsolutePath());
  conf.set(YarnConfiguration.NM_LOG_DIRS,testLogDir.getAbsolutePath());
  NodeHealthCheckerService healthChecker=new NodeHealthCheckerService();
  healthChecker.init(conf);
  LocalDirsHandlerService dirsHandler=healthChecker.getDiskHandler();
  conf.set(YarnConfiguration.NM_WEBAPP_ADDRESS,webAddr);
  WebServer server=new WebServer(nmContext,resourceView,new ApplicationACLsManager(conf),dirsHandler);
  server.init(conf);
  server.start();
  String webAppAddr=conf.get(YarnConfiguration.NM_WEBAPP_ADDRESS);
  return StringUtils.split(webAppAddr,':')[1];
}
