{
  tomcat=new Tomcat();
  File base=new File(System.getProperty("java.io.tmpdir"));
  org.apache.catalina.Context ctx=tomcat.addContext("/foo",base.getAbsolutePath());
  FilterDef fd=new FilterDef();
  fd.setFilterClass(TestFilter.class.getName());
  fd.setFilterName("TestFilter");
  FilterMap fm=new FilterMap();
  fm.setFilterName("TestFilter");
  fm.addURLPattern("/*");
  fm.addServletName("/bar");
  ctx.addFilterDef(fd);
  ctx.addFilterMap(fm);
  tomcat.addServlet(ctx,"/bar",TestServlet.class.getName());
  ctx.addServletMapping("/bar","/bar");
  host="localhost";
  port=getLocalPort();
  tomcat.setHostname(host);
  tomcat.setPort(port);
  tomcat.start();
}
