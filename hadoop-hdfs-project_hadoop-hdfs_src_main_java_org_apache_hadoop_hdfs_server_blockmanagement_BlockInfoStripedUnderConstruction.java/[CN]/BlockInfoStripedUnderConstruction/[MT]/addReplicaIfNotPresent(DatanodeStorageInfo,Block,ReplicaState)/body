{
  Iterator<ReplicaUnderConstruction> it=replicas.iterator();
  while (it.hasNext()) {
    ReplicaUnderConstruction r=it.next();
    DatanodeStorageInfo expectedLocation=r.getExpectedStorageLocation();
    if (expectedLocation == storage) {
      r.setGenerationStamp(block.getGenerationStamp());
      return;
    }
 else     if (expectedLocation != null && expectedLocation.getDatanodeDescriptor() == storage.getDatanodeDescriptor()) {
      it.remove();
      break;
    }
  }
  replicas.add(new ReplicaUnderConstruction(block,storage,rState));
}
