{
  if (isWindows)   return;
  String dir=buildBufferDir(ROOT,0);
  try {
    conf.set(CONTEXT,dir);
    assertTrue(localFs.mkdirs(new Path(dir)));
    File f1=dirAllocator.createTmpFileForWrite(FILENAME,SMALL_FILE_SIZE,conf);
    Path p1=dirAllocator.getLocalPathToRead(f1.getName(),conf);
    assertEquals(f1.getName(),p1.getName());
    assertEquals("file",p1.getFileSystem(conf).getUri().getScheme());
  }
  finally {
    Shell.execCommand(new String[]{"chmod","u+w",BUFFER_DIR_ROOT});
    rmBufferDirs();
  }
}
