{
  try {
    conf.set(CONTEXT,BUFFER_DIR[0] + "," + BUFFER_DIR[1]);
    assertTrue(localFs.mkdirs(BUFFER_PATH[1]));
    BUFFER_ROOT.setReadOnly();
    Path p1=dirAllocator.getLocalPathForWrite("p1/x",SMALL_FILE_SIZE,conf);
    assertTrue(localFs.getFileStatus(p1.getParent()).isDirectory());
    Path p2=dirAllocator.getLocalPathForWrite("p2/x",SMALL_FILE_SIZE,conf,false);
    try {
      localFs.getFileStatus(p2.getParent());
    }
 catch (    Exception e) {
      assertEquals(e.getClass(),FileNotFoundException.class);
    }
  }
  finally {
    Shell.execCommand(new String[]{"chmod","u+w",BUFFER_DIR_ROOT});
    rmBufferDirs();
  }
}
