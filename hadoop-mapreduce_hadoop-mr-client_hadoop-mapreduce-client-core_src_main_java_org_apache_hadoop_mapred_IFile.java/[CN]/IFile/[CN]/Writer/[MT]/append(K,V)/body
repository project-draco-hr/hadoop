{
  if (key.getClass() != keyClass)   throw new IOException("wrong key class: " + key.getClass() + " is not "+ keyClass);
  if (value.getClass() != valueClass)   throw new IOException("wrong value class: " + value.getClass() + " is not "+ valueClass);
  keySerializer.serialize(key);
  int keyLength=buffer.getLength();
  if (keyLength < 0) {
    throw new IOException("Negative key-length not allowed: " + keyLength + " for "+ key);
  }
  valueSerializer.serialize(value);
  int valueLength=buffer.getLength() - keyLength;
  if (valueLength < 0) {
    throw new IOException("Negative value-length not allowed: " + valueLength + " for "+ value);
  }
  WritableUtils.writeVInt(out,keyLength);
  WritableUtils.writeVInt(out,valueLength);
  out.write(buffer.getData(),0,buffer.getLength());
  buffer.reset();
  decompressedBytesWritten+=keyLength + valueLength + WritableUtils.getVIntSize(keyLength)+ WritableUtils.getVIntSize(valueLength);
  ++numRecordsWritten;
}
