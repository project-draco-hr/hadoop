{
  String[] baseDirs=conf.getStrings(DFSConfigKeys.DFS_DATANODE_DATA_DIR_KEY);
  UpgradeUtilities.createEmptyDirs(baseDirs);
  UpgradeUtilities.createDataNodeStorageDirs(baseDirs,"current");
  String[] bpDirs=UpgradeUtilities.createEmptyBPDirs(baseDirs,bpid);
  if (state[0])   UpgradeUtilities.createBlockPoolStorageDirs(baseDirs,"current",bpid);
  if (state[1])   UpgradeUtilities.createBlockPoolStorageDirs(baseDirs,"previous",bpid);
  if (state[2])   UpgradeUtilities.createBlockPoolStorageDirs(baseDirs,"previous.tmp",bpid);
  if (state[3])   UpgradeUtilities.createBlockPoolStorageDirs(baseDirs,"removed.tmp",bpid);
  if (state[4])   UpgradeUtilities.createBlockPoolStorageDirs(baseDirs,"lastcheckpoint.tmp",bpid);
  return bpDirs;
}
