{
  final Configuration conf=new Configuration();
  conf.set("fs.cachedfile.impl",FileSystem.getFileSystemClass("file",null).getName());
  UserGroupInformation ugiA=UserGroupInformation.createRemoteUser("foo");
  FileSystem fsA=ugiA.doAs(new PrivilegedExceptionAction<FileSystem>(){
    @Override public FileSystem run() throws Exception {
      return FileSystem.get(new URI("cachedfile://a"),conf);
    }
  }
);
  FileSystem fsA1=ugiA.doAs(new PrivilegedExceptionAction<FileSystem>(){
    @Override public FileSystem run() throws Exception {
      return FileSystem.get(new URI("cachedfile://a"),conf);
    }
  }
);
  assertSame(fsA,fsA1);
  FileSystem.closeAllForUGI(ugiA);
  fsA1=ugiA.doAs(new PrivilegedExceptionAction<FileSystem>(){
    @Override public FileSystem run() throws Exception {
      return FileSystem.get(new URI("cachedfile://a"),conf);
    }
  }
);
  assertNotSame(fsA,fsA1);
}
