{
  if (di == null) {
    return null;
  }
  DatanodeInfo dinfo=new DatanodeInfo(convert(di.getId()),di.hasLocation() ? di.getLocation() : null,di.getCapacity(),di.getDfsUsed(),di.getRemaining(),di.getBlockPoolUsed(),di.getCacheCapacity(),di.getCacheUsed(),di.getLastUpdate(),di.getLastUpdateMonotonic(),di.getXceiverCount(),convert(di.getAdminState()),di.hasUpgradeDomain() ? di.getUpgradeDomain() : null);
  if (di.hasNonDfsUsed()) {
    dinfo.setNonDfsUsed(di.getNonDfsUsed());
  }
 else {
    long nonDFSUsed=di.getCapacity() - di.getDfsUsed() - di.getRemaining();
    dinfo.setNonDfsUsed(nonDFSUsed < 0 ? 0 : nonDFSUsed);
  }
  return dinfo;
}
