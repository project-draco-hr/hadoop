{
  if (proto == null)   return null;
  List<DatanodeInfoProto> locs=proto.getLocsList();
  DatanodeInfo[] targets=new DatanodeInfo[locs.size()];
  for (int i=0; i < locs.size(); i++) {
    targets[i]=convert(locs.get(i));
  }
  final StorageType[] storageTypes=convertStorageTypes(proto.getStorageTypesList(),locs.size());
  final int storageIDsCount=proto.getStorageIDsCount();
  final String[] storageIDs;
  if (storageIDsCount == 0) {
    storageIDs=null;
  }
 else {
    Preconditions.checkState(storageIDsCount == locs.size());
    storageIDs=proto.getStorageIDsList().toArray(new String[storageIDsCount]);
  }
  List<DatanodeInfo> cachedLocs=new ArrayList<>(locs.size());
  List<Boolean> isCachedList=proto.getIsCachedList();
  for (int i=0; i < isCachedList.size(); i++) {
    if (isCachedList.get(i)) {
      cachedLocs.add(targets[i]);
    }
  }
  LocatedBlock lb=new LocatedBlock(convert(proto.getB()),targets,storageIDs,storageTypes,proto.getOffset(),proto.getCorrupt(),cachedLocs.toArray(new DatanodeInfo[0]));
  lb.setBlockToken(convert(proto.getBlockToken()));
  return lb;
}
