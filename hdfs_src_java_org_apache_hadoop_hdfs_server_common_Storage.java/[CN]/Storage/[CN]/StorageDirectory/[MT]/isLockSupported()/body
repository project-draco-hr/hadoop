{
  FileLock firstLock=null;
  FileLock secondLock=null;
  try {
    firstLock=lock;
    if (firstLock == null) {
      firstLock=tryLock();
      if (firstLock == null)       return true;
    }
    secondLock=tryLock();
    if (secondLock == null)     return true;
  }
  finally {
    if (firstLock != null && firstLock != lock) {
      firstLock.release();
      firstLock.channel().close();
    }
    if (secondLock != null) {
      secondLock.release();
      secondLock.channel().close();
    }
  }
  return false;
}
