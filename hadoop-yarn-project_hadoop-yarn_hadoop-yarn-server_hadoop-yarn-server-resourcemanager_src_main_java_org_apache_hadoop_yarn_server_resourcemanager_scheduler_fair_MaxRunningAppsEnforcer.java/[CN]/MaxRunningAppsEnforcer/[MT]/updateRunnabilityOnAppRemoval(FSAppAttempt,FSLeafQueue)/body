{
  AllocationConfiguration allocConf=scheduler.getAllocationConfiguration();
  FSQueue highestQueueWithAppsNowRunnable=(queue.getNumRunnableApps() == queue.getMaxRunningApps() - 1) ? queue : null;
  FSParentQueue parent=queue.getParent();
  while (parent != null) {
    if (parent.getNumRunnableApps() == parent.getMaxRunningApps() - 1) {
      highestQueueWithAppsNowRunnable=parent;
    }
    parent=parent.getParent();
  }
  List<List<FSAppAttempt>> appsNowMaybeRunnable=new ArrayList<List<FSAppAttempt>>();
  if (highestQueueWithAppsNowRunnable != null) {
    gatherPossiblyRunnableAppLists(highestQueueWithAppsNowRunnable,appsNowMaybeRunnable);
  }
  String user=app.getUser();
  Integer userNumRunning=usersNumRunnableApps.get(user);
  if (userNumRunning == null) {
    userNumRunning=0;
  }
  if (userNumRunning == allocConf.getUserMaxApps(user) - 1) {
    List<FSAppAttempt> userWaitingApps=usersNonRunnableApps.get(user);
    if (userWaitingApps != null) {
      appsNowMaybeRunnable.add(userWaitingApps);
    }
  }
  updateAppsRunnability(appsNowMaybeRunnable,appsNowMaybeRunnable.size());
}
