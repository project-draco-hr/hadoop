{
  List<List<LocatedBlock>> blockGroupList=new ArrayList<>();
  LocatedBlocks lbs=dfs.getClient().getLocatedBlocks(src,0L);
  final int expectedNumGroup=(length - 1) / BLOCK_GROUP_SIZE + 1;
  Assert.assertEquals(expectedNumGroup,lbs.getLocatedBlocks().size());
  for (  LocatedBlock firstBlock : lbs.getLocatedBlocks()) {
    Assert.assertTrue(firstBlock instanceof LocatedStripedBlock);
    final long gs=firstBlock.getBlock().getGenerationStamp();
    final String s="gs=" + gs + ", oldGS="+ oldGS;
    LOG.info(s);
    Assert.assertTrue(s,gs > oldGS);
    LocatedBlock[] blocks=StripedBlockUtil.parseStripedBlockGroup((LocatedStripedBlock)firstBlock,CELL_SIZE,NUM_DATA_BLOCKS,NUM_PARITY_BLOCKS);
    blockGroupList.add(Arrays.asList(blocks));
  }
  for (int group=0; group < blockGroupList.size(); group++) {
    final boolean isLastGroup=group == blockGroupList.size() - 1;
    final int groupSize=!isLastGroup ? BLOCK_GROUP_SIZE : length - (blockGroupList.size() - 1) * BLOCK_GROUP_SIZE;
    final int numCellInGroup=(groupSize - 1) / CELL_SIZE + 1;
    final int lastCellIndex=(numCellInGroup - 1) % NUM_DATA_BLOCKS;
    final int lastCellSize=groupSize - (numCellInGroup - 1) * CELL_SIZE;
    List<LocatedBlock> blockList=blockGroupList.get(group);
    byte[][] dataBlockBytes=new byte[NUM_DATA_BLOCKS][];
    byte[][] parityBlockBytes=new byte[NUM_PARITY_BLOCKS][];
    for (int i=0; i < blockList.size(); i++) {
      final int j=i >= NUM_DATA_BLOCKS ? 0 : i;
      final int numCellInBlock=(numCellInGroup - 1) / NUM_DATA_BLOCKS + (j <= lastCellIndex ? 1 : 0);
      final int blockSize=numCellInBlock * CELL_SIZE + (isLastGroup && i == lastCellIndex ? lastCellSize - CELL_SIZE : 0);
      final byte[] blockBytes=new byte[blockSize];
      if (i < NUM_DATA_BLOCKS) {
        dataBlockBytes[i]=blockBytes;
      }
 else {
        parityBlockBytes[i - NUM_DATA_BLOCKS]=blockBytes;
      }
      final LocatedBlock lb=blockList.get(i);
      LOG.info("XXX i=" + i + ", lb="+ lb);
      if (lb == null) {
        continue;
      }
      final ExtendedBlock block=lb.getBlock();
      Assert.assertEquals(blockSize,block.getNumBytes());
      if (block.getNumBytes() == 0) {
        continue;
      }
      if (i != killedDnIndex) {
        final BlockReader blockReader=BlockReaderTestUtil.getBlockReader(dfs,lb,0,block.getNumBytes());
        blockReader.readAll(blockBytes,0,(int)block.getNumBytes());
        blockReader.close();
      }
    }
    final int groupPosInFile=group * BLOCK_GROUP_SIZE;
    for (int i=0; i < dataBlockBytes.length; i++) {
      final byte[] actual=dataBlockBytes[i];
      for (int posInBlk=0; posInBlk < actual.length; posInBlk++) {
        final long posInFile=StripedBlockUtil.offsetInBlkToOffsetInBG(CELL_SIZE,NUM_DATA_BLOCKS,posInBlk,i) + groupPosInFile;
        Assert.assertTrue(posInFile < length);
        final byte expected=getByte(posInFile);
        if (i == killedDnIndex) {
          actual[posInBlk]=expected;
        }
 else {
          String s="expected=" + expected + " but actual="+ actual[posInBlk]+ ", posInFile="+ posInFile+ ", posInBlk="+ posInBlk+ ". group="+ group+ ", i="+ i;
          Assert.assertEquals(s,expected,actual[posInBlk]);
        }
      }
    }
    TestDFSStripedOutputStream.verifyParity(lbs.getLocatedBlocks().get(group).getBlockSize(),CELL_SIZE,dataBlockBytes,parityBlockBytes,killedDnIndex - dataBlockBytes.length);
  }
}
