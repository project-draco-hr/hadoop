{
  ArrayList<FSVolume> removedVols=null;
  final List<FSVolume> volumeList=new ArrayList<FSVolume>(volumes);
  for (Iterator<FSVolume> i=volumeList.iterator(); i.hasNext(); ) {
    final FSVolume fsv=i.next();
    try {
      fsv.checkDirs();
    }
 catch (    DiskErrorException e) {
      DataNode.LOG.warn("Removing failed volume " + fsv + ": ",e);
      if (removedVols == null) {
        removedVols=new ArrayList<FSVolume>(2);
      }
      removedVols.add(fsv);
      fsv.shutdown();
      i.remove();
      numFailedVolumes++;
    }
  }
  if (removedVols != null && removedVols.size() > 0) {
    volumes=Collections.unmodifiableList(volumeList);
    DataNode.LOG.info("Completed FSVolumeSet.checkDirs. Removed " + removedVols.size() + " volumes. List of current volumes: "+ this);
  }
  return removedVols;
}
