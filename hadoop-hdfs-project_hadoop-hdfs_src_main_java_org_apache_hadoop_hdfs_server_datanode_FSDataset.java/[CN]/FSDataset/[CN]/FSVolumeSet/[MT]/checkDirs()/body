{
  ArrayList<FSVolume> removedVols=null;
  final List<FSVolumeInterface> volumeList=new ArrayList<FSVolumeInterface>(volumes);
  for (int idx=0; idx < volumeList.size(); idx++) {
    FSVolume fsv=(FSVolume)volumeList.get(idx);
    try {
      fsv.checkDirs();
    }
 catch (    DiskErrorException e) {
      DataNode.LOG.warn("Removing failed volume " + fsv + ": ",e);
      if (removedVols == null) {
        removedVols=new ArrayList<FSVolume>(1);
      }
      removedVols.add(fsv);
      fsv.shutdown();
      volumeList.set(idx,null);
      numFailedVolumes++;
    }
  }
  if (removedVols != null && removedVols.size() > 0) {
    List<FSVolumeInterface> newVols=new ArrayList<FSVolumeInterface>();
    for (    FSVolumeInterface vol : volumeList) {
      if (vol != null) {
        newVols.add(vol);
      }
    }
    volumes=Collections.unmodifiableList(newVols);
    DataNode.LOG.info("Completed FSVolumeSet.checkDirs. Removed " + removedVols.size() + " volumes. List of current volumes: "+ this);
  }
  return removedVols;
}
