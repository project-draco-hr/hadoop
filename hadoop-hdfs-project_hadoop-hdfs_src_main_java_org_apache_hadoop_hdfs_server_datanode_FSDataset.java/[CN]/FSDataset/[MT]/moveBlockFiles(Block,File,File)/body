{
  final File dstfile=new File(destdir,b.getBlockName());
  final File srcmeta=DatanodeUtil.getMetaFile(srcfile,b.getGenerationStamp());
  final File dstmeta=DatanodeUtil.getMetaFile(dstfile,b.getGenerationStamp());
  if (!srcmeta.renameTo(dstmeta)) {
    throw new IOException("Failed to move meta file for " + b + " from "+ srcmeta+ " to "+ dstmeta);
  }
  if (!srcfile.renameTo(dstfile)) {
    throw new IOException("Failed to move block file for " + b + " from "+ srcfile+ " to "+ dstfile.getAbsolutePath());
  }
  if (DataNode.LOG.isDebugEnabled()) {
    DataNode.LOG.debug("addBlock: Moved " + srcmeta + " to "+ dstmeta);
    DataNode.LOG.debug("addBlock: Moved " + srcfile + " to "+ dstfile);
  }
  return dstfile;
}
