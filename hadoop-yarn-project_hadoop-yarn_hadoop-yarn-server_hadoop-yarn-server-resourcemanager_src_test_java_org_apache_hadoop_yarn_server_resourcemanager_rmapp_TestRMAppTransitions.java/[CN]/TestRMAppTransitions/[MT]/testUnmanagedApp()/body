{
  ApplicationSubmissionContext subContext=new ApplicationSubmissionContextPBImpl();
  subContext.setUnmanagedAM(true);
  LOG.info("--- START: testUnmanagedAppSuccessPath ---");
  final String diagMsg="some diagnostics";
  RMApp application=testCreateAppFinished(subContext,diagMsg);
  Assert.assertTrue("Finished app missing diagnostics",application.getDiagnostics().indexOf(diagMsg) != -1);
  reset(writer);
  LOG.info("--- START: testUnmanagedAppFailPath ---");
  application=testCreateAppRunning(subContext);
  RMAppEvent event=new RMAppFailedAttemptEvent(application.getApplicationId(),RMAppEventType.ATTEMPT_FAILED,"",false);
  application.handle(event);
  rmDispatcher.await();
  RMAppAttempt appAttempt=application.getCurrentAppAttempt();
  Assert.assertEquals(1,appAttempt.getAppAttemptId().getAttemptId());
  sendAppUpdateSavedEvent(application);
  assertFailed(application,".*Unmanaged application.*Failing the application.*");
  assertAppFinalStateSaved(application);
}
