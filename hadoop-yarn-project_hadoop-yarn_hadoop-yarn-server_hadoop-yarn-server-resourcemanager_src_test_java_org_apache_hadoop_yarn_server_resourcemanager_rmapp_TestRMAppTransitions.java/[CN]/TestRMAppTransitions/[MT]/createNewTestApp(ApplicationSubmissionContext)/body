{
  ApplicationId applicationId=MockApps.newAppID(appId++);
  String user=MockApps.newUserName();
  String name=MockApps.newAppName();
  String queue=MockApps.newQueue();
  conf.setInt(YarnConfiguration.RM_AM_MAX_ATTEMPTS,maxAppAttempts);
  YarnScheduler scheduler=mock(YarnScheduler.class);
  ApplicationMasterService masterService=new ApplicationMasterService(rmContext,scheduler);
  if (submissionContext == null) {
    submissionContext=new ApplicationSubmissionContextPBImpl();
  }
  submissionContext.setApplicationId(applicationId);
  RMApp application=new RMAppImpl(applicationId,rmContext,conf,name,user,queue,submissionContext,scheduler,masterService,System.currentTimeMillis(),"YARN");
  testAppStartState(applicationId,user,name,queue,application);
  this.rmContext.getRMApps().putIfAbsent(application.getApplicationId(),application);
  return application;
}
