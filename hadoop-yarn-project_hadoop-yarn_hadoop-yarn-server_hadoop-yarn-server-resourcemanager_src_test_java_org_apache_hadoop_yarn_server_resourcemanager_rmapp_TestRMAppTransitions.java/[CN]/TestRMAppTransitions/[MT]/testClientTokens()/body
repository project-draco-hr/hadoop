{
  assumeTrue(isSecurityEnabled);
  RMApp app=createNewTestApp(null);
  assertAppState(RMAppState.NEW,app);
  ApplicationReport report=app.createAndGetApplicationReport(null,true);
  Assert.assertNull(report.getClientToAMToken());
  report=app.createAndGetApplicationReport("clientuser",true);
  Assert.assertNull(report.getClientToAMToken());
  app=testCreateAppRunning(null);
  rmDispatcher.await();
  assertAppState(RMAppState.RUNNING,app);
  report=app.createAndGetApplicationReport("clientuser",true);
  Assert.assertNull(report.getClientToAMToken());
  moveCurrentAttemptToLaunchedState(app.getCurrentAppAttempt());
  report=app.createAndGetApplicationReport(null,true);
  Assert.assertNull(report.getClientToAMToken());
  report=app.createAndGetApplicationReport("clientuser",true);
  Assert.assertNotNull(report.getClientToAMToken());
  app.handle(new RMAppEvent(app.getApplicationId(),RMAppEventType.KILL));
  rmDispatcher.await();
  assertAppAndAttemptKilled(app);
  report=app.createAndGetApplicationReport(null,true);
  Assert.assertNull(report.getClientToAMToken());
  report=app.createAndGetApplicationReport("clientuser",true);
  Assert.assertNull(report.getClientToAMToken());
}
