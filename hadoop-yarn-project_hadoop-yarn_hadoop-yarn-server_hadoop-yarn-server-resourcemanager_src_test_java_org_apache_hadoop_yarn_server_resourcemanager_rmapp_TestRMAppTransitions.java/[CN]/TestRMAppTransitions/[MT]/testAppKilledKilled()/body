{
  LOG.info("--- START: testAppKilledKilled ---");
  RMApp application=testCreateAppRunning(null);
  UserGroupInformation fooUser=UserGroupInformation.createUserForTesting("fooTestAppKilledKill",new String[]{"foo_group"});
  RMAppEvent event=new RMAppKillByClientEvent(application.getApplicationId(),"Application killed by user.",fooUser,Server.getRemoteIp());
  application.handle(event);
  rmDispatcher.await();
  sendAttemptUpdateSavedEvent(application);
  sendAppUpdateSavedEvent(application);
  assertTimesAtFinish(application);
  assertAppState(RMAppState.KILLED,application);
  event=new RMAppEvent(application.getApplicationId(),RMAppEventType.ATTEMPT_FINISHED,"");
  application.handle(event);
  rmDispatcher.await();
  assertTimesAtFinish(application);
  assertAppState(RMAppState.KILLED,application);
  event=new RMAppFailedAttemptEvent(application.getApplicationId(),RMAppEventType.ATTEMPT_FAILED,"",false);
  application.handle(event);
  rmDispatcher.await();
  assertTimesAtFinish(application);
  assertAppState(RMAppState.KILLED,application);
  event=new RMAppEvent(application.getApplicationId(),RMAppEventType.KILL,"Application killed by user.");
  application.handle(event);
  rmDispatcher.await();
  assertTimesAtFinish(application);
  assertAppState(RMAppState.KILLED,application);
  verifyApplicationFinished(RMAppState.KILLED);
  assertTimesAtFinish(application);
  assertAppState(RMAppState.KILLED,application);
}
