{
  Configuration conf=new Configuration();
  rmDispatcher=new DrainDispatcher();
  ContainerAllocationExpirer containerAllocationExpirer=mock(ContainerAllocationExpirer.class);
  AMLivelinessMonitor amLivelinessMonitor=mock(AMLivelinessMonitor.class);
  AMLivelinessMonitor amFinishingMonitor=mock(AMLivelinessMonitor.class);
  RMStateStore store=mock(RMStateStore.class);
  this.rmContext=new RMContextImpl(rmDispatcher,store,containerAllocationExpirer,amLivelinessMonitor,amFinishingMonitor,null,new ApplicationTokenSecretManager(conf),new RMContainerTokenSecretManager(conf),new NMTokenSecretManagerInRM(conf),new ClientToAMTokenSecretManagerInRM());
  rmDispatcher.register(RMAppAttemptEventType.class,new TestApplicationAttemptEventDispatcher(this.rmContext));
  rmDispatcher.register(RMAppEventType.class,new TestApplicationEventDispatcher(rmContext));
  rmDispatcher.register(RMAppManagerEventType.class,new TestApplicationManagerEventDispatcher());
  rmDispatcher.register(SchedulerEventType.class,new TestSchedulerEventDispatcher());
  rmDispatcher.init(conf);
  rmDispatcher.start();
}
