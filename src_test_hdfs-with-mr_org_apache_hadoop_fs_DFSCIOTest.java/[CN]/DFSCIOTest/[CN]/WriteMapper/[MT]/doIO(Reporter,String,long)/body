{
  totalSize*=MEGA;
  FileSystem localFS=FileSystem.getLocal(fsConfig);
  try {
    Runtime runTime=Runtime.getRuntime();
synchronized (this) {
      localFS.delete(HDFS_TEST_DIR,true);
      if (!(localFS.mkdirs(HDFS_TEST_DIR))) {
        throw new IOException("Failed to create " + HDFS_TEST_DIR + " on local filesystem");
      }
    }
synchronized (this) {
      if (!localFS.exists(HDFS_SHLIB)) {
        FileUtil.copy(fs,HDFS_SHLIB,localFS,HDFS_SHLIB,false,fsConfig);
        String chmodCmd=new String(CHMOD + " a+x " + HDFS_SHLIB);
        Process process=runTime.exec(chmodCmd);
        int exitStatus=process.waitFor();
        if (exitStatus != 0) {
          throw new IOException(chmodCmd + ": Failed with exitStatus: " + exitStatus);
        }
      }
    }
synchronized (this) {
      if (!localFS.exists(HDFS_WRITE)) {
        FileUtil.copy(fs,HDFS_WRITE,localFS,HDFS_WRITE,false,fsConfig);
        String chmodCmd=new String(CHMOD + " a+x " + HDFS_WRITE);
        Process process=runTime.exec(chmodCmd);
        int exitStatus=process.waitFor();
        if (exitStatus != 0) {
          throw new IOException(chmodCmd + ": Failed with exitStatus: " + exitStatus);
        }
      }
    }
    Path outFile=new Path(DATA_DIR,name);
    String writeCmd=new String(HDFS_WRITE + " " + outFile+ " "+ totalSize+ " "+ bufferSize);
    Process process=runTime.exec(writeCmd,null,new File(HDFS_TEST_DIR.toString()));
    int exitStatus=process.waitFor();
    if (exitStatus != 0) {
      throw new IOException(writeCmd + ": Failed with exitStatus: " + exitStatus);
    }
  }
 catch (  InterruptedException interruptedException) {
    reporter.setStatus(interruptedException.toString());
  }
 finally {
    localFS.close();
  }
  return new Long(totalSize);
}
