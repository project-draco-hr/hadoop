{
  SecurityUtilTestHelper.setTokenServiceUseIp(true);
  Configuration conf=new Configuration();
  conf.setClass("fs.hsftp.impl",MyHsftpFileSystem.class,FileSystem.class);
  int httpPort=80;
  int httpsPort=443;
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_HTTP_PORT_KEY,httpPort);
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_HTTPS_PORT_KEY,httpsPort);
  URI fsUri=URI.create("hsftp://localhost");
  MyHsftpFileSystem fs=(MyHsftpFileSystem)FileSystem.newInstance(fsUri,conf);
  assertEquals(httpsPort,fs.getCanonicalUri().getPort());
  checkTokenSelection(fs,httpsPort,conf);
  fsUri=URI.create("hsftp://localhost:" + httpsPort);
  fs=(MyHsftpFileSystem)FileSystem.newInstance(fsUri,conf);
  assertEquals(httpsPort,fs.getCanonicalUri().getPort());
  checkTokenSelection(fs,httpsPort,conf);
  fsUri=URI.create("hsftp://localhost:" + (httpsPort + 1));
  fs=(MyHsftpFileSystem)FileSystem.newInstance(fsUri,conf);
  assertEquals(httpsPort + 1,fs.getCanonicalUri().getPort());
  checkTokenSelection(fs,httpsPort + 1,conf);
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_HTTPS_PORT_KEY,5);
}
