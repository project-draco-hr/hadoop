{
  cal.setTimeInMillis(now);
  cal.set(Calendar.SECOND,0);
  cal.set(Calendar.MILLISECOND,0);
  if (rollingPeriod == RollingPeriod.DAILY) {
    cal.set(Calendar.HOUR_OF_DAY,0);
    cal.set(Calendar.MINUTE,0);
    if (next) {
      cal.add(Calendar.DATE,1);
    }
  }
 else   if (rollingPeriod == RollingPeriod.HALF_DAILY) {
    int hour=(cal.get(Calendar.HOUR) / 12) * 12;
    cal.set(Calendar.HOUR,hour);
    cal.set(Calendar.MINUTE,0);
    if (next) {
      cal.add(Calendar.HOUR_OF_DAY,12);
    }
  }
 else   if (rollingPeriod == RollingPeriod.QUARTER_DAILY) {
    int hour=(cal.get(Calendar.HOUR) / 6) * 6;
    cal.set(Calendar.HOUR,hour);
    cal.set(Calendar.MINUTE,0);
    if (next) {
      cal.add(Calendar.HOUR_OF_DAY,6);
    }
  }
 else   if (rollingPeriod == RollingPeriod.HOURLY) {
    cal.set(Calendar.MINUTE,0);
    if (next) {
      cal.add(Calendar.HOUR_OF_DAY,1);
    }
  }
 else   if (rollingPeriod == RollingPeriod.MINUTELY) {
    int minute=(cal.get(Calendar.MINUTE) / 5) * 5;
    cal.set(Calendar.MINUTE,minute);
    if (next) {
      cal.add(Calendar.MINUTE,5);
    }
  }
  return cal.getTimeInMillis();
}
