{
  shutDownMiniCluster();
  Configuration conf=new HdfsConfiguration();
  String[] nameDirs=new String[4];
  for (int i=0; i < nameDirs.length; i++) {
    File nameDir=new File(System.getProperty("test.build.data"),"name-dir" + i);
    nameDir.mkdirs();
    nameDirs[i]=nameDir.getAbsolutePath();
  }
  conf.set(DFSConfigKeys.DFS_NAMENODE_NAME_DIR_KEY,StringUtils.join(nameDirs,","));
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_EDITS_DIR_MINIMUM_KEY,2);
  setUpMiniCluster(conf,false);
  assertTrue(doAnEdit());
  assertExitInvocations(0);
  invalidateEditsDirAtIndex(0,false,false);
  assertTrue(doAnEdit());
  assertExitInvocations(0);
  invalidateEditsDirAtIndex(1,false,false);
  assertTrue(doAnEdit());
  assertExitInvocations(0);
  invalidateEditsDirAtIndex(2,false,false);
  doAnEdit();
  assertExitInvocations(atLeast(1));
}
