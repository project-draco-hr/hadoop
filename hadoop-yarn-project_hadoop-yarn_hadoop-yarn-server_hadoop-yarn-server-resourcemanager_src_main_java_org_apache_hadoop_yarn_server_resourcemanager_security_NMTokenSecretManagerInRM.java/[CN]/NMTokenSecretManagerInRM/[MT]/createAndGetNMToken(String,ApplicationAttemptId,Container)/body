{
  try {
    this.readLock.lock();
    HashSet<NodeId> nodeSet=this.appAttemptToNodeKeyMap.get(appAttemptId);
    NMToken nmToken=null;
    if (nodeSet != null) {
      if (!nodeSet.contains(container.getNodeId())) {
        LOG.info("Sending NMToken for nodeId : " + container.getNodeId() + " for container : "+ container.getId());
        Token token=createNMToken(container.getId().getApplicationAttemptId(),container.getNodeId(),applicationSubmitter);
        nmToken=NMToken.newInstance(container.getNodeId(),token);
        nodeSet.add(container.getNodeId());
      }
    }
    return nmToken;
  }
  finally {
    this.readLock.unlock();
  }
}
