{
  try {
    this.readLock.lock();
    HashSet<NodeId> nodeSet=this.appAttemptToNodeKeyMap.get(appAttemptId);
    NMToken nmToken=null;
    if (nodeSet != null) {
      if (!nodeSet.contains(container.getNodeId())) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Sending NMToken for nodeId : " + container.getNodeId().toString() + " for application attempt : "+ appAttemptId.toString());
        }
        Token token=createNMToken(container.getId().getApplicationAttemptId(),container.getNodeId(),applicationSubmitter);
        nmToken=NMToken.newInstance(container.getNodeId(),token);
        if (container.getId().getId() != 1) {
          nodeSet.add(container.getNodeId());
        }
      }
    }
    return nmToken;
  }
  finally {
    this.readLock.unlock();
  }
}
