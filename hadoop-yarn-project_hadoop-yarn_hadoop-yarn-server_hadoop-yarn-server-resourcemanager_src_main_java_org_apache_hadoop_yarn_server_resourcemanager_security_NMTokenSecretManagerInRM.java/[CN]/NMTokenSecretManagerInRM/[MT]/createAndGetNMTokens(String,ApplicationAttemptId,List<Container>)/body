{
  try {
    this.readLock.lock();
    List<NMToken> nmTokens=new ArrayList<NMToken>();
    HashSet<NodeId> nodeSet=this.appAttemptToNodeKeyMap.get(appAttemptId);
    if (nodeSet != null) {
      for (      Container container : containers) {
        if (!nodeSet.contains(container.getNodeId())) {
          LOG.debug("Sending NMToken for nodeId : " + container.getNodeId().toString() + " for application attempt : "+ appAttemptId.toString());
          Token token=createNMToken(appAttemptId,container.getNodeId(),applicationSubmitter);
          NMToken nmToken=NMToken.newInstance(container.getNodeId(),token);
          nmTokens.add(nmToken);
          nodeSet.add(container.getNodeId());
        }
      }
    }
    return nmTokens;
  }
  finally {
    this.readLock.unlock();
  }
}
