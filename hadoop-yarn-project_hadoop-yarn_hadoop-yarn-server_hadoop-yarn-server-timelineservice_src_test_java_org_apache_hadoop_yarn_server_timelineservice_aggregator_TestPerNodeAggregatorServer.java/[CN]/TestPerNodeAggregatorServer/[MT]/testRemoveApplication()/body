{
  PerNodeAggregatorServer aggregator=createAggregatorAndAddApplication();
  String appIdStr=appAttemptId.getApplicationId().toString();
  assertTrue(aggregator.hasApplication(appIdStr));
  ContainerId containerId=getAMContainerId();
  ContainerTerminationContext context=mock(ContainerTerminationContext.class);
  when(context.getContainerId()).thenReturn(containerId);
  aggregator.stopContainer(context);
  assertFalse(aggregator.hasApplication(appIdStr));
  aggregator.close();
}
