{
  HeartbeatRequestProto req=HeartbeatRequestProto.newBuilder().setRegistration(PBHelper.convert(registration)).setCapacity(capacity).setDfsUsed(dfsUsed).setRemaining(remaining).setBlockPoolUsed(blockPoolUsed).setXmitsInProgress(xmitsInProgress).setXceiverCount(xceiverCount).setFailedVolumes(failedVolumes).build();
  HeartbeatResponseProto resp;
  try {
    resp=rpcProxy.sendHeartbeat(NULL_CONTROLLER,req);
  }
 catch (  ServiceException se) {
    throw ProtobufHelper.getRemoteException(se);
  }
  DatanodeCommand[] cmds=new DatanodeCommand[resp.getCmdsList().size()];
  int index=0;
  for (  DatanodeCommandProto p : resp.getCmdsList()) {
    cmds[index]=PBHelper.convert(p);
    index++;
  }
  return cmds;
}
