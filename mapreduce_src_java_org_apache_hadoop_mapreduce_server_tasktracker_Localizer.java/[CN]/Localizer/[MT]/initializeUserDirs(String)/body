{
  if (user == null) {
    throw new IOException("User is null. Cannot initialized user-directories.");
  }
  AtomicBoolean localizedUser;
synchronized (localizedUsers) {
    if (!localizedUsers.containsKey(user)) {
      localizedUsers.put(user,new AtomicBoolean(false));
    }
    localizedUser=localizedUsers.get(user);
  }
synchronized (localizedUser) {
    if (localizedUser.get()) {
      LOG.info("User-directories for the user " + user + " are already initialized on this TT. Not doing anything.");
      return;
    }
    LOG.info("Initializing user " + user + " on this TT.");
    boolean userDirStatus=false;
    boolean jobCacheDirStatus=false;
    boolean distributedCacheDirStatus=false;
    for (    String localDir : localDirs) {
      Path userDir=new Path(localDir,TaskTracker.getUserDir(user));
      if (fs.exists(userDir) || fs.mkdirs(userDir)) {
        fs.setPermission(userDir,new FsPermission((short)0700));
        userDirStatus=true;
        Path jobCacheDir=new Path(localDir,TaskTracker.getJobCacheSubdir(user));
        if (fs.exists(jobCacheDir) || fs.mkdirs(jobCacheDir)) {
          fs.setPermission(jobCacheDir,new FsPermission((short)0700));
          jobCacheDirStatus=true;
        }
 else {
          LOG.warn("Unable to create job cache directory : " + jobCacheDir);
        }
        Path distributedCacheDir=new Path(localDir,TaskTracker.getPrivateDistributedCacheDir(user));
        if (fs.exists(distributedCacheDir) || fs.mkdirs(distributedCacheDir)) {
          fs.setPermission(distributedCacheDir,new FsPermission((short)0700));
          distributedCacheDirStatus=true;
        }
 else {
          LOG.warn("Unable to create distributed-cache directory : " + distributedCacheDir);
        }
      }
 else {
        LOG.warn("Unable to create the user directory : " + userDir);
      }
    }
    if (!userDirStatus) {
      throw new IOException("Not able to initialize user directories " + "in any of the configured local directories for user " + user);
    }
    if (!jobCacheDirStatus) {
      throw new IOException("Not able to initialize job-cache directories " + "in any of the configured local directories for user " + user);
    }
    if (!distributedCacheDirStatus) {
      throw new IOException("Not able to initialize distributed-cache directories " + "in any of the configured local directories for user " + user);
    }
    InitializationContext context=new InitializationContext();
    context.user=user;
    context.workDir=null;
    taskController.initializeUser(context);
    localizedUser.set(true);
  }
}
