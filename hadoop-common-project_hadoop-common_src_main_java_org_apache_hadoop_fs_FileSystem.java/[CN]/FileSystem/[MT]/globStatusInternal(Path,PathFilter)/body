{
  Path[] parents=new Path[1];
  int level=0;
  String filename=pathPattern.toUri().getPath();
  if ("".equals(filename) || Path.SEPARATOR.equals(filename)) {
    return getFileStatus(new Path[]{pathPattern});
  }
  String[] components=filename.split(Path.SEPARATOR);
  if (pathPattern.isAbsolute()) {
    parents[0]=new Path(Path.SEPARATOR);
    level=1;
  }
 else {
    parents[0]=new Path(Path.CUR_DIR);
  }
  boolean[] hasGlob=new boolean[]{false};
  Path[] parentPaths=globPathsLevel(parents,components,level,hasGlob);
  FileStatus[] results;
  if (parentPaths == null || parentPaths.length == 0) {
    results=null;
  }
 else {
    GlobFilter fp=new GlobFilter(components[components.length - 1],filter);
    if (fp.hasPattern()) {
      results=listStatus(parentPaths,fp);
      hasGlob[0]=true;
    }
 else {
      String name=unquotePathComponent(components[components.length - 1]);
      ArrayList<Path> filteredPaths=new ArrayList<Path>(parentPaths.length);
      for (int i=0; i < parentPaths.length; i++) {
        parentPaths[i]=new Path(parentPaths[i],name);
        if (fp.accept(parentPaths[i])) {
          filteredPaths.add(parentPaths[i]);
        }
      }
      results=getFileStatus(filteredPaths.toArray(new Path[filteredPaths.size()]));
    }
  }
  if (results == null) {
    if (hasGlob[0]) {
      results=new FileStatus[0];
    }
  }
 else {
    if (results.length == 0) {
      if (!hasGlob[0]) {
        results=null;
      }
    }
 else {
      Arrays.sort(results);
    }
  }
  return results;
}
