{
  containerManager.start();
  ContainerLaunchContext containerLaunchContext=recordFactory.newRecordInstance(ContainerLaunchContext.class);
  ContainerId cId1=createContainerId();
  ContainerId cId2=createContainerId();
  containerLaunchContext.setLocalResources(new HashMap<String,LocalResource>());
  StartContainerRequest startRequest1=recordFactory.newRecordInstance(StartContainerRequest.class);
  startRequest1.setContainerLaunchContext(containerLaunchContext);
  startRequest1.setContainerToken(createContainerToken(cId1,ResourceManagerConstants.RM_INVALID_IDENTIFIER,context.getNodeId(),user,context.getContainerTokenSecretManager()));
  boolean catchException=false;
  try {
    containerManager.startContainer(startRequest1);
  }
 catch (  YarnException e) {
    catchException=true;
    Assert.assertTrue(e.getMessage().contains("Container " + cId1 + " rejected as it is allocated by a previous RM"));
    Assert.assertTrue(e.getClass().getName().equalsIgnoreCase(InvalidContainerException.class.getName()));
  }
  Assert.assertTrue(catchException);
  StartContainerRequest startRequest2=recordFactory.newRecordInstance(StartContainerRequest.class);
  startRequest2.setContainerLaunchContext(containerLaunchContext);
  startRequest2.setContainerToken(createContainerToken(cId2,DUMMY_RM_IDENTIFIER,context.getNodeId(),user,context.getContainerTokenSecretManager()));
  boolean noException=true;
  try {
    containerManager.startContainer(startRequest2);
  }
 catch (  YarnException e) {
    noException=false;
  }
  Assert.assertTrue(noException);
}
