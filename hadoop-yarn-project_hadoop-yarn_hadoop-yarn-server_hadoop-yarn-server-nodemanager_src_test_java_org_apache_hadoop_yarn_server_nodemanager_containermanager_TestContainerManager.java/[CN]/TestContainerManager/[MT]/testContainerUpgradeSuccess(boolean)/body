{
  containerManager.start();
  ContainerId cId=createContainerId(0);
  File oldStartFile=new File(tmpDir,"start_file_o.txt").getAbsoluteFile();
  String pid=prepareInitialContainer(cId,oldStartFile);
  File newStartFile=new File(tmpDir,"start_file_n.txt").getAbsoluteFile();
  prepareContainerUpgrade(autoCommit,false,false,cId,newStartFile);
  Assert.assertFalse("Process is still alive!",DefaultContainerExecutor.containerIsAlive(pid));
  BufferedReader reader=new BufferedReader(new FileReader(newStartFile));
  Assert.assertEquals("Upgrade World!",reader.readLine());
  String newPid=reader.readLine().trim();
  Assert.assertNotEquals("Old and New Pids must be different !",pid,newPid);
  Assert.assertEquals(null,reader.readLine());
  reader.close();
  reader=new BufferedReader(new FileReader(oldStartFile));
  Assert.assertEquals("Hello World!",reader.readLine());
  Assert.assertTrue("New Process is not alive!",DefaultContainerExecutor.containerIsAlive(newPid));
  return new String[]{pid,newPid};
}
