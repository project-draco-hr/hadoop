{
  theBlock=new Block(b);
  if (theBlock.getNumBytes() < 0) {
    theBlock.setNumBytes(0);
  }
  if (!storage.alloc(bpid,theBlock.getNumBytes())) {
    DataNode.LOG.warn("Lack of free storage on a block alloc");
    throw new IOException("Creating block, no free space available");
  }
  if (forWriting) {
    finalized=false;
    oStream=new SimulatedOutputStream();
  }
 else {
    finalized=true;
    oStream=null;
  }
}
