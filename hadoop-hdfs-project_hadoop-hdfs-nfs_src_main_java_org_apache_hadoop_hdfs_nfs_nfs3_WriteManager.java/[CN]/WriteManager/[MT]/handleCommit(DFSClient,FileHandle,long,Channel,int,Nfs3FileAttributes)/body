{
  int status;
  OpenFileCtx openFileCtx=fileContextCache.get(fileHandle);
  if (openFileCtx == null) {
    LOG.info("No opened stream for fileId:" + fileHandle.getFileId() + " commitOffset="+ commitOffset+ ". Return success in this case.");
    status=Nfs3Status.NFS3_OK;
  }
 else {
    COMMIT_STATUS ret=openFileCtx.checkCommit(dfsClient,commitOffset,channel,xid,preOpAttr);
switch (ret) {
case COMMIT_DO_SYNC:
case COMMIT_FINISHED:
case COMMIT_INACTIVE_CTX:
      status=Nfs3Status.NFS3_OK;
    break;
case COMMIT_INACTIVE_WITH_PENDING_WRITE:
case COMMIT_ERROR:
  status=Nfs3Status.NFS3ERR_IO;
break;
case COMMIT_WAIT:
return;
default :
throw new RuntimeException("Should not get commit return code:" + ret.name());
}
}
Nfs3FileAttributes postOpAttr=null;
try {
String fileIdPath=Nfs3Utils.getFileIdPath(preOpAttr.getFileid());
postOpAttr=Nfs3Utils.getFileAttr(dfsClient,fileIdPath,iug);
}
 catch (IOException e1) {
LOG.info("Can't get postOpAttr for fileId: " + preOpAttr.getFileid());
}
WccData fileWcc=new WccData(Nfs3Utils.getWccAttr(preOpAttr),postOpAttr);
COMMIT3Response response=new COMMIT3Response(status,fileWcc,Nfs3Constant.WRITE_COMMIT_VERF);
Nfs3Utils.writeChannelCommit(channel,response.writeHeaderAndResponse(new XDR(),xid,new VerifierNone()),xid);
}
