{
  @SuppressWarnings("resource") TimelineServiceV2Publisher publisher=new TimelineServiceV2Publisher(mock(RMContext.class));
  try {
    Configuration conf=getTimelineV2Conf();
    conf.setBoolean(YarnConfiguration.RM_PUBLISH_CONTAINER_EVENTS_ENABLED,YarnConfiguration.DEFAULT_RM_PUBLISH_CONTAINER_EVENTS_ENABLED);
    publisher.init(conf);
    assertFalse("Default configuration should not publish container events from RM",publisher.isPublishContainerEvents());
    publisher.stop();
    publisher=new TimelineServiceV2Publisher(mock(RMContext.class));
    conf=getTimelineV2Conf();
    publisher.init(conf);
    assertTrue("Expected to have registered event handlers and set ready to " + "publish events after init",publisher.isPublishContainerEvents());
    publisher.start();
    assertTrue("Expected to publish container events from RM",publisher.isPublishContainerEvents());
  }
  finally {
    publisher.stop();
  }
}
