{
  @SuppressWarnings("resource") TimelineServiceV2Publisher metricsPublisher=new TimelineServiceV2Publisher(mock(RMContext.class));
  try {
    Configuration conf=getTimelineV2Conf();
    conf.setBoolean(YarnConfiguration.RM_PUBLISH_CONTAINER_EVENTS_ENABLED,YarnConfiguration.DEFAULT_RM_PUBLISH_CONTAINER_EVENTS_ENABLED);
    metricsPublisher.init(conf);
    assertFalse("Default configuration should not publish container events from RM",metricsPublisher.isPublishContainerEvents());
    metricsPublisher.stop();
    metricsPublisher=new TimelineServiceV2Publisher(mock(RMContext.class));
    conf=getTimelineV2Conf();
    metricsPublisher.init(conf);
    assertTrue("Expected to have registered event handlers and set ready to " + "publish events after init",metricsPublisher.isPublishContainerEvents());
    metricsPublisher.start();
    assertTrue("Expected to publish container events from RM",metricsPublisher.isPublishContainerEvents());
  }
  finally {
    metricsPublisher.stop();
  }
}
