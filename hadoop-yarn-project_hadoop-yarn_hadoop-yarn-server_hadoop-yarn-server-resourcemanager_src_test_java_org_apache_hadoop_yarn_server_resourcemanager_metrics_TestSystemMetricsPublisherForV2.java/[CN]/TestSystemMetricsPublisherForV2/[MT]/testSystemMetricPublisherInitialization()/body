{
  @SuppressWarnings("resource") TimelineServiceV2Publisher metricsPublisher=new TimelineServiceV2Publisher(mock(RMContext.class));
  try {
    Configuration conf=getTimelineV2Conf();
    conf.setBoolean(YarnConfiguration.RM_PUBLISH_CONTAINER_METRICS_ENABLED,false);
    metricsPublisher.init(conf);
    assertFalse("Default configuration should not publish container Metrics from RM",metricsPublisher.isPublishContainerMetrics());
    metricsPublisher.stop();
    metricsPublisher=new TimelineServiceV2Publisher(mock(RMContext.class));
    conf=getTimelineV2Conf();
    metricsPublisher.init(conf);
    metricsPublisher.start();
    assertTrue("Expected to publish container Metrics from RM",metricsPublisher.isPublishContainerMetrics());
  }
  finally {
    metricsPublisher.stop();
  }
}
