{
  @SuppressWarnings("resource") SystemMetricsPublisher metricsPublisher=new SystemMetricsPublisher(mock(RMContext.class));
  try {
    Configuration conf=getTimelineV2Conf();
    conf.setBoolean(YarnConfiguration.RM_PUBLISH_CONTAINER_METRICS_ENABLED,false);
    metricsPublisher.init(conf);
    assertFalse("Default configuration should not publish container Metrics from RM",metricsPublisher.isPublishContainerMetrics());
    metricsPublisher.stop();
    metricsPublisher=new SystemMetricsPublisher(mock(RMContext.class));
    conf=getTimelineV2Conf();
    metricsPublisher.init(conf);
    assertTrue("Expected to publish container Metrics from RM",metricsPublisher.isPublishContainerMetrics());
    assertTrue("MultiThreadedDispatcher expected when container Metrics is not published",metricsPublisher.getDispatcher() instanceof MultiThreadedDispatcher);
  }
  finally {
    metricsPublisher.stop();
  }
}
