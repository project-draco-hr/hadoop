{
  startUpCluster(REPL_FACTOR,new StorageType[]{RAM_DISK,DEFAULT},(2 * BLOCK_SIZE - 1));
  final String METHOD_NAME=GenericTestUtils.getMethodName();
  Path path1=new Path("/" + METHOD_NAME + ".01.dat");
  Path path2=new Path("/" + METHOD_NAME + ".02.dat");
  makeTestFile(path1,BLOCK_SIZE,true);
  makeTestFile(path2,BLOCK_SIZE,false);
  ensureFileReplicasOnStorageType(path1,RAM_DISK);
  ensureFileReplicasOnStorageType(path2,DEFAULT);
  cluster.shutdownDataNodes();
  Thread.sleep(30000L);
  assertThat(cluster.getNamesystem().getNumDeadDataNodes(),is(1));
  Thread.sleep(2 * DFS_NAMENODE_REPLICATION_INTERVAL_DEFAULT * 1000);
  Thread.sleep(2 * LAZY_WRITE_FILE_SCRUBBER_INTERVAL_SEC * 1000);
  assert(!fs.exists(path1));
  assert(fs.exists(path2));
  assertThat(cluster.getNameNode().getNamesystem().getBlockManager().getUnderReplicatedBlocksCount(),is(1L));
}
