{
  int numPlaceholders=0;
  StringBuilder columnDefs=new StringBuilder(StringUtils.join(PHOENIX_STORAGE_PK_LIST,","));
  if (entity.getConfigs() != null) {
    Set<String> keySet=entity.getConfigs().keySet();
    appendColumnsSQL(columnDefs,new DynamicColumns<>(CONFIG_COLUMN_FAMILY,DynamicColumns.COLUMN_FAMILY_TYPE_STRING,keySet));
    numPlaceholders+=keySet.size();
  }
  if (entity.getInfo() != null) {
    Set<String> keySet=entity.getInfo().keySet();
    appendColumnsSQL(columnDefs,new DynamicColumns<>(INFO_COLUMN_FAMILY,DynamicColumns.COLUMN_FAMILY_TYPE_BYTES,keySet));
    numPlaceholders+=keySet.size();
  }
  if (entity.getIsRelatedToEntities() != null) {
    Set<String> keySet=entity.getIsRelatedToEntities().keySet();
    appendColumnsSQL(columnDefs,new DynamicColumns<>(IS_RELATED_TO_FAMILY,DynamicColumns.COLUMN_FAMILY_TYPE_STRING,keySet));
    numPlaceholders+=keySet.size();
  }
  if (entity.getRelatesToEntities() != null) {
    Set<String> keySet=entity.getRelatesToEntities().keySet();
    appendColumnsSQL(columnDefs,new DynamicColumns<>(RELATES_TO_FAMILY,DynamicColumns.COLUMN_FAMILY_TYPE_STRING,keySet));
    numPlaceholders+=keySet.size();
  }
  if (numPlaceholders == 0) {
    return;
  }
  StringBuilder placeholders=new StringBuilder();
  placeholders.append(StringUtils.repeat("?,",PHOENIX_STORAGE_PK_LIST.length));
  placeholders.append("?").append(StringUtils.repeat(",?",numPlaceholders - 1));
  String sqlVariableLengthFields=new StringBuilder("UPSERT INTO ").append(ENTITY_TABLE_NAME).append(" (").append(columnDefs).append(") VALUES(").append(placeholders).append(")").toString();
  if (LOG.isDebugEnabled()) {
    LOG.debug("SQL statement for variable length fields: " + sqlVariableLengthFields);
  }
  try (PreparedStatement psVariableLengthFields=conn.prepareStatement(sqlVariableLengthFields)){
    int idx=setStringsForPrimaryKey(psVariableLengthFields,context,entity,1);
    if (entity.getConfigs() != null) {
      idx=setStringsForColumnFamily(psVariableLengthFields,entity.getConfigs(),idx);
    }
    if (entity.getInfo() != null) {
      idx=setBytesForColumnFamily(psVariableLengthFields,entity.getInfo(),idx);
    }
    if (entity.getIsRelatedToEntities() != null) {
      idx=setStringsForColumnFamily(psVariableLengthFields,entity.getIsRelatedToEntities(),idx);
    }
    if (entity.getRelatesToEntities() != null) {
      idx=setStringsForColumnFamily(psVariableLengthFields,entity.getRelatesToEntities(),idx);
    }
    psVariableLengthFields.execute();
  }
 }
