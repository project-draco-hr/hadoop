{
  final String path="hdfs://" + cluster.getNameNode().getHostAndPort() + "/tmp";
  MetricsSystem ms=initMetricsSystem(path,false,false);
  new MyMetrics1().registerWith(ms);
  shutdownHdfs();
  MockSink.errored=false;
  ms.publishMetricsNow();
  assertTrue("No exception was generated while writing metrics " + "even though HDFS was unavailable",MockSink.errored);
  try {
    ms.stop();
  }
  finally {
    ms.shutdown();
  }
}
