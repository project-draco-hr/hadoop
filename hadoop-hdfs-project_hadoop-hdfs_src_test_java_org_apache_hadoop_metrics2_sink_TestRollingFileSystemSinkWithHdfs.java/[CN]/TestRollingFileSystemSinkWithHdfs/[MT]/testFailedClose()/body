{
  final String path="hdfs://" + cluster.getNameNode().getHostAndPort() + "/tmp";
  MetricsSystem ms=initMetricsSystem(path,false,false);
  new MyMetrics1().registerWith(ms);
  ms.publishMetricsNow();
  shutdownHdfs();
  MockSink.errored=false;
  ms.stop();
  assertTrue("No exception was generated while stopping sink " + "even though HDFS was unavailable",MockSink.errored);
  ms.shutdown();
}
