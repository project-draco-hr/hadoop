{
  if (bufCurrent != null) {
    int bufSize=bufCurrent.size();
    if (bufSize != 0) {
      throw new IOException("FSEditStream has " + bufSize + " bytes still to be flushed and cannot "+ "be closed.");
    }
    bufCurrent.close();
    bufCurrent=null;
  }
  if (bufReady != null) {
    bufReady.close();
    bufReady=null;
  }
  if (fc != null && fc.isOpen()) {
    fc.truncate(fc.position());
    fc.close();
  }
  if (fp != null) {
    fp.close();
  }
}
