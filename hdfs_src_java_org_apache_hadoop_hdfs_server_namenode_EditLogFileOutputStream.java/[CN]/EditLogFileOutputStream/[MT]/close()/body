{
  try {
    if (bufCurrent != null) {
      int bufSize=bufCurrent.size();
      if (bufSize != 0) {
        throw new IOException("FSEditStream has " + bufSize + " bytes still to be flushed and cannot "+ "be closed.");
      }
      bufCurrent.close();
      bufCurrent=null;
      writer=null;
    }
    if (bufReady != null) {
      bufReady.close();
      bufReady=null;
    }
    if (fc != null && fc.isOpen()) {
      fc.truncate(fc.position());
      fc.close();
      fc=null;
    }
    if (fp != null) {
      fp.close();
      fp=null;
    }
  }
  finally {
    IOUtils.cleanup(FSNamesystem.LOG,bufCurrent,bufReady,fc,fp);
    bufCurrent=bufReady=null;
    writer=null;
    fc=null;
    fp=null;
  }
}
