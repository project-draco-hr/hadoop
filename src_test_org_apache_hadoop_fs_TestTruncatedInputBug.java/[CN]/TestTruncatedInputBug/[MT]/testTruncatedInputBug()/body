{
  final int ioBufSize=512;
  final int fileSize=ioBufSize * 4;
  int filePos=0;
  Configuration conf=new Configuration();
  conf.setInt("io.file.buffer.size",ioBufSize);
  FileSystem fileSys=FileSystem.getLocal(conf);
  try {
    Path testFile=new Path(TEST_ROOT_DIR,"HADOOP-1489");
    writeFile(fileSys,testFile,fileSize);
    assertTrue(fileSys.exists(testFile));
    assertTrue(fileSys.getFileStatus(testFile).getLen() == fileSize);
    FSDataInputStream in=fileSys.open(testFile,ioBufSize);
    filePos+=ioBufSize * 2 + (ioBufSize - 10);
    in.seek(filePos);
    for (int i=0; i < 4; ++i) {
      if (in.read() == -1) {
        break;
      }
      ++filePos;
    }
    in.mark(1);
    System.out.println("MARKED");
    while (filePos < fileSize) {
      if (in.read() == -1) {
        break;
      }
      ++filePos;
    }
    in.close();
    System.out.println("Read " + filePos + " bytes."+ " file size="+ fileSize);
    assertTrue(filePos == fileSize);
  }
  finally {
    try {
      fileSys.close();
    }
 catch (    Exception e) {
    }
  }
}
