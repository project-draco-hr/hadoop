{
  FileDescriptor descriptors[]=new FileDescriptor[streams.length];
  boolean success=false;
  for (int i=0; i < streams.length; i++) {
    streams[i]=null;
  }
  refCount.reference();
  try {
    int ret=receiveFileDescriptors0(fd,descriptors,buf,offset,length);
    for (int i=0, j=0; i < descriptors.length; i++) {
      if (descriptors[i] != null) {
        streams[j++]=new FileInputStream(descriptors[i]);
        descriptors[i]=null;
      }
    }
    success=true;
    return ret;
  }
  finally {
    if (!success) {
      for (int i=0; i < descriptors.length; i++) {
        if (descriptors[i] != null) {
          try {
            closeFileDescriptor0(descriptors[i]);
          }
 catch (          Throwable t) {
            LOG.warn(t);
          }
        }
 else         if (streams[i] != null) {
          try {
            streams[i].close();
          }
 catch (          Throwable t) {
            LOG.warn(t);
          }
 finally {
            streams[i]=null;
          }
        }
      }
    }
    unreference(!success);
  }
}
