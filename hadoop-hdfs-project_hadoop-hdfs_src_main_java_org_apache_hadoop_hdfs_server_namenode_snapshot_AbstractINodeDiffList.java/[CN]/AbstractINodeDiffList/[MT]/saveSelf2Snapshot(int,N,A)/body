{
  D diff=null;
  if (latestSnapshotId != Snapshot.CURRENT_STATE_ID) {
    diff=checkAndAddLatestSnapshotDiff(latestSnapshotId,currentINode);
    if (diff.snapshotINode == null) {
      if (snapshotCopy == null) {
        snapshotCopy=createSnapshotCopy(currentINode);
      }
      diff.saveSnapshotCopy(snapshotCopy);
    }
  }
  return diff;
}
