{
  final D last=getLast();
  if (last != null && Snapshot.ID_INTEGER_COMPARATOR.compare(last.getSnapshotId(),latestSnapshotId) >= 0) {
    return last;
  }
 else {
    try {
      return addDiff(latestSnapshotId,currentINode);
    }
 catch (    NSQuotaExceededException e) {
      e.setMessagePrefix("Failed to record modification for snapshot");
      throw e;
    }
  }
}
