{
  if (inode == null) {
    return;
  }
  FsPermission mode=inode.getFsPermission(snapshotId);
  if (user.equals(inode.getUserName(snapshotId))) {
    if (mode.getUserAction().implies(access)) {
      return;
    }
  }
 else   if (groups.contains(inode.getGroupName(snapshotId))) {
    if (mode.getGroupAction().implies(access)) {
      return;
    }
  }
 else {
    if (mode.getOtherAction().implies(access)) {
      return;
    }
  }
  throw new AccessControlException("Permission denied: user=" + user + ", access="+ access+ ", inode="+ toAccessControlString(inode));
}
