{
  CacheManipulator prevCacheManipulator=NativeIO.POSIX.cacheManipulator;
  try {
    NativeIO.POSIX.cacheManipulator=new CacheManipulator(){
      private final Set<String> seenIdentifiers=new HashSet<String>();
      @Override public void mlock(      String identifier,      ByteBuffer mmap,      long length) throws IOException {
        if (seenIdentifiers.contains(identifier)) {
          LOG.info("mlocking " + identifier);
          return;
        }
        seenIdentifiers.add(identifier);
        throw new IOException("injecting IOException during mlock of " + identifier);
      }
    }
;
    testCacheAndUncacheBlock();
  }
  finally {
    NativeIO.POSIX.cacheManipulator=prevCacheManipulator;
  }
}
