{
  long lastPos=0;
  long firstTxId=HdfsConstants.INVALID_TXID;
  long lastTxId=HdfsConstants.INVALID_TXID;
  long numValid=0;
  try {
    FSEditLogOp op=null;
    while (true) {
      lastPos=in.getPosition();
      if ((op=in.readOp()) == null) {
        break;
      }
      if (firstTxId == HdfsConstants.INVALID_TXID) {
        firstTxId=op.getTransactionId();
      }
      if (lastTxId == HdfsConstants.INVALID_TXID || op.getTransactionId() == lastTxId + 1) {
        lastTxId=op.getTransactionId();
      }
 else {
        FSImage.LOG.error("Out of order txid found. Found " + op.getTransactionId() + ", expected "+ (lastTxId + 1));
        break;
      }
      numValid++;
    }
  }
 catch (  Throwable t) {
    FSImage.LOG.debug("Caught exception after reading " + numValid + " ops from "+ in+ " while determining its valid length.",t);
  }
  return new EditLogValidation(lastPos,firstTxId,lastTxId,false);
}
