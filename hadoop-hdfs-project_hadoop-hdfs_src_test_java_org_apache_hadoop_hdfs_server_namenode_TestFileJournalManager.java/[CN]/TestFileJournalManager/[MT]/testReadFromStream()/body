{
  File f=new File(TestEditLog.TEST_DIR + "/filejournaltest1");
  NNStorage storage=setupEdits(Collections.<URI>singletonList(f.toURI()),10,new AbortSpec(10,0));
  StorageDirectory sd=storage.dirIterator(NameNodeDirType.EDITS).next();
  FileJournalManager jm=new FileJournalManager(sd);
  long expectedTotalTxnCount=TXNS_PER_ROLL * 10 + TXNS_PER_FAIL;
  assertEquals(expectedTotalTxnCount,jm.getNumberOfTransactions(1));
  long skippedTxns=(3 * TXNS_PER_ROLL);
  long startingTxId=skippedTxns + 1;
  long numTransactionsToLoad=jm.getNumberOfTransactions(startingTxId);
  long numLoaded=0;
  while (numLoaded < numTransactionsToLoad) {
    EditLogInputStream editIn=jm.getInputStream(startingTxId);
    FSEditLogLoader.EditLogValidation val=FSEditLogLoader.validateEditLog(editIn);
    long count=val.getNumTransactions();
    editIn.close();
    startingTxId+=count;
    numLoaded+=count;
  }
  assertEquals(expectedTotalTxnCount - skippedTxns,numLoaded);
}
