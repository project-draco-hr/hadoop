{
  final int len=s.length();
  int remain=len;
  int offset=0;
  while (remain > 0) {
    int currentFlush=0;
    if (buffer.remaining() > 0) {
      currentFlush=Math.min(buffer.remaining(),remain);
      for (int i=0; i < currentFlush; i++) {
        buffer.put((byte)s.charAt(offset + i));
      }
      remain-=currentFlush;
      offset+=currentFlush;
    }
 else {
      flush();
    }
  }
}
