{
  final int NUM_EDIT_LOG_ROLLS=1000;
  Configuration conf=getConf();
  MiniDFSCluster cluster=null;
  FileSystem fileSys=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(NUM_DATA_NODES).build();
    cluster.waitActive();
    fileSys=cluster.getFileSystem();
    final FSNamesystem namesystem=cluster.getNamesystem();
    FSImage fsimage=namesystem.getFSImage();
    final FSEditLog editLog=fsimage.getEditLog();
    for (int i=0; i < NUM_EDIT_LOG_ROLLS; i++) {
      editLog.logSetReplication("fakefile" + i,(short)(i % 3));
      assertExistsInStorageDirs(cluster,NameNodeDirType.EDITS,NNStorage.getInProgressEditsFileName((i * 3) + 1));
      editLog.logSync();
      editLog.rollEditLog(NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
      assertExistsInStorageDirs(cluster,NameNodeDirType.EDITS,NNStorage.getFinalizedEditsFileName((i * 3) + 1,(i * 3) + 3));
    }
    editLog.close();
  }
  finally {
    if (fileSys != null)     fileSys.close();
    if (cluster != null)     cluster.shutdown();
  }
  long startTime=Time.now();
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(NUM_DATA_NODES).build();
    cluster.waitActive();
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
  long endTime=Time.now();
  double delta=((float)(endTime - startTime)) / 1000.0;
  LOG.info(String.format("loaded %d edit log segments in %.2f seconds",NUM_EDIT_LOG_ROLLS,delta));
}
