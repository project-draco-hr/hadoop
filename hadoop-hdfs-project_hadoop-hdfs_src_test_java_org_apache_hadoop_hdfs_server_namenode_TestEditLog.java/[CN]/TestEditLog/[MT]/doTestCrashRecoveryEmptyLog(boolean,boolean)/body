{
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=null;
  cluster=new MiniDFSCluster.Builder(conf).numDataNodes(NUM_DATA_NODES).build();
  cluster.shutdown();
  Collection<URI> editsDirs=cluster.getNameEditsDirs(0);
  for (  URI uri : editsDirs) {
    File dir=new File(uri.getPath());
    File currentDir=new File(dir,"current");
    GenericTestUtils.assertGlobEquals(currentDir,"edits_.*",NNStorage.getFinalizedEditsFileName(1,2));
    File log=new File(currentDir,NNStorage.getInProgressEditsFileName(3));
    NNStorage storage=new NNStorage(conf,Collections.<URI>emptyList(),Lists.newArrayList(uri));
    if (updateTransactionIdFile) {
      storage.writeTransactionIdFileToStorage(3);
    }
    storage.close();
    new EditLogFileOutputStream(log,1024).create();
    if (!inBothDirs) {
      break;
    }
  }
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(NUM_DATA_NODES).format(false).build();
    fail("Did not fail to start with all-corrupt logs");
  }
 catch (  IOException ioe) {
    GenericTestUtils.assertExceptionContains("No non-corrupt logs for txid 3",ioe);
  }
  cluster.shutdown();
}
