{
  StringBuilder buf=new StringBuilder();
  buf.append(nnAddr);
  buf.append(RenewDelegationTokenServlet.PATH_SPEC);
  buf.append("?");
  buf.append(RenewDelegationTokenServlet.TOKEN);
  buf.append("=");
  buf.append(tok.encodeToUrlString());
  BufferedReader in=null;
  HttpURLConnection connection=null;
  try {
    URL url=new URL(buf.toString());
    connection=(HttpURLConnection)SecurityUtil.openSecureHttpConnection(url);
    if (connection.getResponseCode() != HttpURLConnection.HTTP_OK) {
      throw new IOException("Error renewing token: " + connection.getResponseMessage());
    }
    in=new BufferedReader(new InputStreamReader(connection.getInputStream(),Charsets.UTF_8));
    long result=Long.parseLong(in.readLine());
    in.close();
    return result;
  }
 catch (  IOException ie) {
    LOG.info("error in renew over HTTP",ie);
    IOException e=getExceptionFromResponse(connection);
    IOUtils.cleanup(LOG,in);
    if (e != null) {
      LOG.info("rethrowing exception from HTTP request: " + e.getLocalizedMessage());
      throw e;
    }
    throw ie;
  }
}
