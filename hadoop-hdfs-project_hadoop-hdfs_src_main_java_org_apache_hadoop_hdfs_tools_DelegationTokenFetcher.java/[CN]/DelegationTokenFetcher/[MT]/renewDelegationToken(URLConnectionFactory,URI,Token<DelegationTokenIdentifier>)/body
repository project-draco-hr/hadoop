{
  StringBuilder buf=new StringBuilder(nnAddr.toString()).append(RenewDelegationTokenServlet.PATH_SPEC).append("?").append(RenewDelegationTokenServlet.TOKEN).append("=").append(tok.encodeToUrlString());
  HttpURLConnection connection=null;
  BufferedReader in=null;
  try {
    connection=run(factory,new URL(buf.toString()));
    in=new BufferedReader(new InputStreamReader(connection.getInputStream(),Charsets.UTF_8));
    long result=Long.parseLong(in.readLine());
    return result;
  }
 catch (  IOException ie) {
    LOG.info("error in renew over HTTP",ie);
    IOException e=getExceptionFromResponse(connection);
    if (e != null) {
      LOG.info("rethrowing exception from HTTP request: " + e.getLocalizedMessage());
      throw e;
    }
    throw ie;
  }
 finally {
    IOUtils.cleanup(LOG,in);
    if (connection != null) {
      connection.disconnect();
    }
  }
}
