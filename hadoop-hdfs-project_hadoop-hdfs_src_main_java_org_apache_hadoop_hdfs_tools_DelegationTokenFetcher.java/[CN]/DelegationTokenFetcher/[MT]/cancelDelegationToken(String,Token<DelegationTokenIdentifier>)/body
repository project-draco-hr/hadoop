{
  StringBuilder buf=new StringBuilder();
  buf.append(nnAddr);
  buf.append(CancelDelegationTokenServlet.PATH_SPEC);
  buf.append("?");
  buf.append(CancelDelegationTokenServlet.TOKEN);
  buf.append("=");
  buf.append(tok.encodeToUrlString());
  BufferedReader in=null;
  HttpURLConnection connection=null;
  try {
    URL url=new URL(buf.toString());
    SecurityUtil.fetchServiceTicket(url);
    connection=(HttpURLConnection)url.openConnection();
    if (connection.getResponseCode() != HttpURLConnection.HTTP_OK) {
      throw new IOException("Error cancelling token: " + connection.getResponseMessage());
    }
  }
 catch (  IOException ie) {
    LOG.info("error in cancel over HTTP",ie);
    IOException e=getExceptionFromResponse(connection);
    IOUtils.cleanup(LOG,in);
    if (e != null) {
      LOG.info("rethrowing exception from HTTP request: " + e.getLocalizedMessage());
      throw e;
    }
    throw ie;
  }
}
