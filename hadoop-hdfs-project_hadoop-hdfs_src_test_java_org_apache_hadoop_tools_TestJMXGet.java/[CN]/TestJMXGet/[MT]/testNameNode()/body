{
  int numDatanodes=2;
  cluster=new MiniDFSCluster.Builder(config).numDataNodes(numDatanodes).build();
  cluster.waitActive();
  writeFile(cluster.getFileSystem(),new Path("/test1"),2);
  JMXGet jmx=new JMXGet();
  jmx.init();
  assertEquals(numDatanodes,Integer.parseInt(jmx.getValue("NumLiveDataNodes")));
  assertGauge("CorruptBlocks",Long.parseLong(jmx.getValue("CorruptBlocks")),getMetrics("FSNamesystem"));
  assertEquals(numDatanodes,Integer.parseInt(jmx.getValue("NumOpenConnections")));
  cluster.shutdown();
}
