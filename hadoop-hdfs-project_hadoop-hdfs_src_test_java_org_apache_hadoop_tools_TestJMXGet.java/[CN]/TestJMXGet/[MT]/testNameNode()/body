{
  int numDatanodes=2;
  cluster=new MiniDFSCluster.Builder(config).numDataNodes(numDatanodes).build();
  cluster.waitActive();
  DFSTestUtil.createFile(cluster.getFileSystem(),new Path("/test1"),fileSize,fileSize,blockSize,(short)2,seed);
  JMXGet jmx=new JMXGet();
  jmx.init();
  assertTrue("error printAllValues",checkPrintAllValues(jmx));
  assertEquals(numDatanodes,Integer.parseInt(jmx.getValue("NumLiveDataNodes")));
  assertGauge("CorruptBlocks",Long.parseLong(jmx.getValue("CorruptBlocks")),getMetrics("FSNamesystem"));
  assertEquals(numDatanodes,Integer.parseInt(jmx.getValue("NumOpenConnections")));
  cluster.shutdown();
}
