{
  conf.setJobName("test-job-kill");
  conf.setMapperClass(KillMapper.class);
  conf.setReducerClass(IdentityReducer.class);
  RunningJob job=UtilsForTests.runJob(conf,inDir,outDir);
  long sleepCount=0;
  while (job.getJobState() != JobStatus.RUNNING) {
    try {
      if (sleepCount > 300) {
        throw new IOException("Job didn't finish in 30 seconds");
      }
      Thread.sleep(100);
      sleepCount++;
    }
 catch (    InterruptedException e) {
      break;
    }
  }
  job.killJob();
  sleepCount=0;
  while (job.cleanupProgress() == 0.0f) {
    try {
      if (sleepCount > 2000) {
        throw new IOException("Job cleanup didn't start in 20 seconds");
      }
      Thread.sleep(10);
      sleepCount++;
    }
 catch (    InterruptedException ie) {
      break;
    }
  }
  return job;
}
