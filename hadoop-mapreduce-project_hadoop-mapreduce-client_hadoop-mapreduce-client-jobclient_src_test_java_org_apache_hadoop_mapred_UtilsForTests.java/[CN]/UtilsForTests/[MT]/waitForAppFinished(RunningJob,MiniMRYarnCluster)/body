{
  ApplicationId appId=ApplicationId.newInstance(Long.parseLong(job.getID().getJtIdentifier()),job.getID().getId());
  ConcurrentMap<ApplicationId,RMApp> rmApps=cluster.getResourceManager().getRMContext().getRMApps();
  if (!rmApps.containsKey(appId)) {
    throw new IOException("Job not found");
  }
  final RMApp rmApp=rmApps.get(appId);
  try {
    GenericTestUtils.waitFor(new Supplier<Boolean>(){
      @Override public Boolean get(){
        return RMAppImpl.isAppInFinalState(rmApp);
      }
    }
,1000,1000 * 180);
  }
 catch (  TimeoutException|InterruptedException e1) {
    throw new IOException("Yarn application with " + appId + " didn't finish "+ "did not reach finale State",e1);
  }
}
