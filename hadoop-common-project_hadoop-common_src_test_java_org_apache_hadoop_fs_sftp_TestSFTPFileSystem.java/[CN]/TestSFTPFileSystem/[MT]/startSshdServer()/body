{
  sshd=SshServer.setUpDefaultServer();
  sshd.setPort(0);
  sshd.setKeyPairProvider(new SimpleGeneratorHostKeyProvider());
  List<NamedFactory<UserAuth>> userAuthFactories=new ArrayList<NamedFactory<UserAuth>>();
  userAuthFactories.add(new UserAuthPassword.Factory());
  sshd.setUserAuthFactories(userAuthFactories);
  sshd.setPasswordAuthenticator(new PasswordAuthenticator(){
    @Override public boolean authenticate(    String username,    String password,    ServerSession session){
      if (username.equals("user") && password.equals("password")) {
        return true;
      }
      return false;
    }
  }
);
  sshd.setSubsystemFactories(Arrays.<NamedFactory<Command>>asList(new SftpSubsystem.Factory()));
  sshd.start();
  port=sshd.getPort();
}
