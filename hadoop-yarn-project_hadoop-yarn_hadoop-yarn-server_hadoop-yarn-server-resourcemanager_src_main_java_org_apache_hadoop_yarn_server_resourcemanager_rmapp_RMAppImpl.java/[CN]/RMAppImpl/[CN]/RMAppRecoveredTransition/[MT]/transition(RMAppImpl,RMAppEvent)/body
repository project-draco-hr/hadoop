{
  RMAppRecoverEvent recoverEvent=(RMAppRecoverEvent)event;
  app.recover(recoverEvent.getRMState());
  if (app.recoveredFinalState != null) {
    app.recoverAppAttempts();
    new FinalTransition(app.recoveredFinalState).transition(app,event);
    return app.recoveredFinalState;
  }
  if (UserGroupInformation.isSecurityEnabled()) {
    try {
      app.rmContext.getDelegationTokenRenewer().addApplicationAsyncDuringRecovery(app.getApplicationId(),app.parseCredentials(),app.submissionContext.getCancelTokensWhenComplete(),app.getUser());
    }
 catch (    Exception e) {
      String msg="Failed to fetch user credentials from application:" + e.getMessage();
      app.diagnostics.append(msg);
      LOG.error(msg,e);
    }
  }
  long applicationLifetime=app.getApplicationLifetime(ApplicationTimeoutType.LIFETIME);
  if (applicationLifetime > 0) {
    app.rmContext.getRMAppLifetimeMonitor().registerApp(app.applicationId,ApplicationTimeoutType.LIFETIME,app.submitTime,applicationLifetime * 1000);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Application " + app.applicationId + " is registered for timeout monitor, type="+ ApplicationTimeoutType.LIFETIME+ " value="+ applicationLifetime+ " seconds");
    }
  }
  if (app.attempts.isEmpty()) {
    app.scheduler.handle(new AppAddedSchedulerEvent(app.user,app.submissionContext,false));
    return RMAppState.SUBMITTED;
  }
  app.scheduler.handle(new AppAddedSchedulerEvent(app.user,app.submissionContext,true));
  app.recoverAppAttempts();
  return RMAppState.ACCEPTED;
}
