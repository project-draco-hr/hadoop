{
  for (  RMAppAttempt attempt : app.getAppAttempts().values()) {
    attempt.handle(new RMAppAttemptEvent(attempt.getAppAttemptId(),RMAppAttemptEventType.RECOVER));
  }
  if (app.recoveredFinalState != null) {
    new FinalTransition(app.recoveredFinalState).transition(app,event);
    return app.recoveredFinalState;
  }
  if (app.currentAttempt != null && (app.currentAttempt.getState() == RMAppAttemptState.KILLED || app.currentAttempt.getState() == RMAppAttemptState.FINISHED || (app.currentAttempt.getState() == RMAppAttemptState.FAILED && app.attempts.size() == app.maxAppAttempts))) {
    return RMAppState.ACCEPTED;
  }
  new AddApplicationToSchedulerTransition().transition(app,event);
  if (app.attempts.isEmpty()) {
    return RMAppState.SUBMITTED;
  }
  return RMAppState.ACCEPTED;
}
