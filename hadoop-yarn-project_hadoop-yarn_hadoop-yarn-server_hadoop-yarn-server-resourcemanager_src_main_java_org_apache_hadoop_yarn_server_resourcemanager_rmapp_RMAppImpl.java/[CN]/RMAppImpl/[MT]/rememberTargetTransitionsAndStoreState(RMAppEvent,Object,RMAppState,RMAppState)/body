{
  rememberTargetTransitions(event,transitionToDo,targetFinalState);
  this.stateBeforeFinalSaving=getState();
  this.storedFinishTime=this.systemClock.getTime();
  LOG.info("Updating application " + this.applicationId + " with final state: "+ this.targetedFinalState);
  String diags=null;
switch (event.getType()) {
case APP_REJECTED:
    RMAppRejectedEvent rejectedEvent=(RMAppRejectedEvent)event;
  diags=rejectedEvent.getMessage();
break;
case ATTEMPT_FINISHED:
RMAppFinishedAttemptEvent finishedEvent=(RMAppFinishedAttemptEvent)event;
diags=finishedEvent.getDiagnostics();
break;
case ATTEMPT_FAILED:
RMAppFailedAttemptEvent failedEvent=(RMAppFailedAttemptEvent)event;
diags=getAppAttemptFailedDiagnostics(failedEvent);
break;
case ATTEMPT_KILLED:
diags=getAppKilledDiagnostics();
break;
default :
break;
}
ApplicationStateData appState=ApplicationStateData.newInstance(this.submitTime,this.startTime,this.user,this.submissionContext,stateToBeStored,diags,this.storedFinishTime);
this.rmContext.getStateStore().updateApplicationState(appState);
}
