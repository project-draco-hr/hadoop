{
  rememberTargetTransitions(event,transitionToDo,targetFinalState);
  this.stateBeforeFinalSaving=getState();
  this.storedFinishTime=this.systemClock.getTime();
  LOG.info("Updating application " + this.applicationId + " with final state: "+ this.targetedFinalState);
  String diags=null;
switch (event.getType()) {
case APP_REJECTED:
case ATTEMPT_FINISHED:
case ATTEMPT_KILLED:
    diags=event.getDiagnosticMsg();
  break;
case ATTEMPT_FAILED:
RMAppFailedAttemptEvent failedEvent=(RMAppFailedAttemptEvent)event;
diags=getAppAttemptFailedDiagnostics(failedEvent);
break;
default :
break;
}
ApplicationStateData appState=ApplicationStateData.newInstance(this.submitTime,this.startTime,this.user,this.submissionContext,stateToBeStored,diags,this.storedFinishTime,this.callerContext);
this.rmContext.getStateStore().updateApplicationState(appState);
}
