{
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(applicationId,nextAttemptId++);
  BlacklistManager currentAMBlacklist;
  if (currentAttempt != null) {
    currentAMBlacklist=currentAttempt.getAMBlacklist();
  }
 else {
    if (amBlacklistingEnabled) {
      currentAMBlacklist=new SimpleBlacklistManager(scheduler.getNumClusterNodes(),blacklistDisableThreshold);
    }
 else {
      currentAMBlacklist=new DisabledBlacklistManager();
    }
  }
  RMAppAttempt attempt=new RMAppAttemptImpl(appAttemptId,rmContext,scheduler,masterService,submissionContext,conf,maxAppAttempts == (getNumFailedAppAttempts() + 1),amReq,currentAMBlacklist);
  attempts.put(appAttemptId,attempt);
  currentAttempt=attempt;
}
