{
  JobID jobID=JobID.forName("job_1234567890000_0001");
  JobId jobId=TypeConverter.toYarn(jobID);
  final String diagMsg="some diagnostic message";
  final JobDiagnosticsUpdateEvent diagUpdateEvent=new JobDiagnosticsUpdateEvent(jobId,diagMsg);
  MRAppMetrics mrAppMetrics=MRAppMetrics.create();
  AppContext mockContext=mock(AppContext.class);
  when(mockContext.hasSuccessfullyUnregistered()).thenReturn(true);
  JobImpl job=new JobImpl(jobId,Records.newRecord(ApplicationAttemptId.class),new Configuration(),mock(EventHandler.class),null,mock(JobTokenSecretManager.class),null,new SystemClock(),null,mrAppMetrics,null,true,null,0,null,mockContext,null,null);
  job.handle(diagUpdateEvent);
  String diagnostics=job.getReport().getDiagnostics();
  Assert.assertNotNull(diagnostics);
  Assert.assertTrue(diagnostics.contains(diagMsg));
  job=new JobImpl(jobId,Records.newRecord(ApplicationAttemptId.class),new Configuration(),mock(EventHandler.class),null,mock(JobTokenSecretManager.class),null,new SystemClock(),null,mrAppMetrics,null,true,null,0,null,mockContext,null,null);
  job.handle(new JobEvent(jobId,JobEventType.JOB_KILL));
  job.handle(diagUpdateEvent);
  diagnostics=job.getReport().getDiagnostics();
  Assert.assertNotNull(diagnostics);
  Assert.assertTrue(diagnostics.contains(diagMsg));
}
