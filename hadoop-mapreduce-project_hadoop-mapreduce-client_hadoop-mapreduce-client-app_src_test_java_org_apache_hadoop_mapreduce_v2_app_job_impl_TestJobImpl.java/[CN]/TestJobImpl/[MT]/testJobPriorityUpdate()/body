{
  Configuration conf=new Configuration();
  AsyncDispatcher dispatcher=new AsyncDispatcher();
  Priority submittedPriority=Priority.newInstance(5);
  AppContext mockContext=mock(AppContext.class);
  when(mockContext.hasSuccessfullyUnregistered()).thenReturn(false);
  JobImpl job=createStubbedJob(conf,dispatcher,2,mockContext);
  JobId jobId=job.getID();
  job.handle(new JobEvent(jobId,JobEventType.JOB_INIT));
  assertJobState(job,JobStateInternal.INITED);
  job.handle(new JobStartEvent(jobId));
  assertJobState(job,JobStateInternal.SETUP);
  job.setJobPriority(submittedPriority);
  Assert.assertEquals(submittedPriority,job.getReport().getJobPriority());
  job.handle(new JobSetupCompletedEvent(jobId));
  assertJobState(job,JobStateInternal.RUNNING);
  Priority updatedPriority=Priority.newInstance(8);
  job.setJobPriority(updatedPriority);
  assertJobState(job,JobStateInternal.RUNNING);
  Priority jobPriority=job.getReport().getJobPriority();
  Assert.assertNotNull(jobPriority);
  Assert.assertEquals(updatedPriority,jobPriority);
}
