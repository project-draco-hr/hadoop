{
  List<FSDataOutputStream> stms=Lists.newArrayList();
  try {
    DFSTestUtil.createFile(fs,new Path("/junk-blocks"),BLOCK_SIZE * 4,(short)1,1L);
    for (int i=0; i < 10; i++) {
      FSDataOutputStream stm=fs.create(new Path("/append-" + i),true,BLOCK_SIZE,(short)1,BLOCK_SIZE);
      stms.add(stm);
      stm.write(1);
      stm.hflush();
    }
    cluster.restartNameNode();
    FSNamesystem ns=cluster.getNameNode(0).getNamesystem();
    BlockManagerTestUtil.updateState(ns.getBlockManager());
    assertEquals(0,ns.getPendingReplicationBlocks());
    assertEquals(0,ns.getCorruptReplicaBlocks());
    assertEquals(0,ns.getMissingBlocksCount());
  }
  finally {
    for (    FSDataOutputStream stm : stms) {
      IOUtils.closeStream(stm);
    }
    cluster.shutdown();
  }
}
