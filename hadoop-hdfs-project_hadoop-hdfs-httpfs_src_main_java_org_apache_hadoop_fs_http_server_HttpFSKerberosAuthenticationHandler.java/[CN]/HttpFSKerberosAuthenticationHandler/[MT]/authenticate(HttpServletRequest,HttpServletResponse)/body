{
  AuthenticationToken token;
  String delegationParam=request.getParameter(HttpFSKerberosAuthenticator.DELEGATION_PARAM);
  if (delegationParam != null) {
    try {
      Token<DelegationTokenIdentifier> dt=new Token<DelegationTokenIdentifier>();
      dt.decodeFromUrlString(delegationParam);
      DelegationTokenManager tokenManager=HttpFSServerWebApp.get().get(DelegationTokenManager.class);
      UserGroupInformation ugi=tokenManager.verifyToken(dt);
      final String shortName=ugi.getShortUserName();
      token=new AuthenticationToken(shortName,ugi.getUserName(),getType());
      token.setExpires(0);
    }
 catch (    Throwable ex) {
      throw new AuthenticationException("Could not verify DelegationToken, " + ex.toString(),ex);
    }
  }
 else {
    token=super.authenticate(request,response);
  }
  return token;
}
