{
  MiniDFSCluster cluster=null;
  SecondaryNameNode secondary=null;
  Configuration conf=new HdfsConfiguration();
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_NUM_EXTRA_EDITS_RETAINED_KEY,0);
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes(0).format(true).build();
    FileSystem fs=cluster.getFileSystem();
    fs.mkdirs(new Path("/foo"));
    secondary=startSecondaryNameNode(conf);
    for (int i=0; i < 5; i++) {
      secondary.doCheckpoint();
    }
    List<File> checkpointDirs=getCheckpointCurrentDirs(secondary);
    for (    File checkpointDir : checkpointDirs) {
      List<EditLogFile> editsFiles=FileJournalManager.matchEditLogs(checkpointDir);
      assertEquals("Edit log files were not purged from 2NN",1,editsFiles.size());
    }
  }
  finally {
    cleanup(secondary);
    secondary=null;
    cleanup(cluster);
    cluster=null;
  }
}
