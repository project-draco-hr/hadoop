{
  boolean anyResourcesUpdated=false;
  for (  ResourceRequest request : requests) {
    SchedulerRequestKey schedulerKey=SchedulerRequestKey.create(request);
    String resourceName=request.getResourceName();
    updateNodeLabels(request);
    Map<String,ResourceRequest> asks=this.resourceRequestMap.get(schedulerKey);
    if (asks == null) {
      asks=new ConcurrentHashMap<>();
      this.resourceRequestMap.put(schedulerKey,asks);
      this.schedulerKeys.add(schedulerKey);
    }
    ResourceRequest lastRequest=asks.get(resourceName);
    if (recoverPreemptedRequestForAContainer && lastRequest != null) {
      request.setNumContainers(lastRequest.getNumContainers() + 1);
    }
    asks.put(resourceName,request);
    if (resourceName.equals(ResourceRequest.ANY)) {
      requestedPartitions.add(request.getNodeLabelExpression() == null ? RMNodeLabelsManager.NO_LABEL : request.getNodeLabelExpression());
      anyResourcesUpdated=true;
      if (request.getNumContainers() > 0) {
        activeUsersManager.activateApplication(user,applicationId);
      }
      updatePendingResources(lastRequest,request,queue.getMetrics());
    }
  }
  return anyResourcesUpdated;
}
