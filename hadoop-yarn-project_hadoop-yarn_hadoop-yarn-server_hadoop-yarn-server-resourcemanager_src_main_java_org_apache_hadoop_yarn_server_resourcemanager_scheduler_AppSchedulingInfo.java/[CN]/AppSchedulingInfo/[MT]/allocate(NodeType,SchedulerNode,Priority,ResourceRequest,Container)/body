{
  List<ResourceRequest> resourceRequests=new ArrayList<ResourceRequest>();
  if (type == NodeType.NODE_LOCAL) {
    allocateNodeLocal(node,priority,request,container,resourceRequests);
  }
 else   if (type == NodeType.RACK_LOCAL) {
    allocateRackLocal(node,priority,request,container,resourceRequests);
  }
 else {
    allocateOffSwitch(node,priority,request,container,resourceRequests);
  }
  QueueMetrics metrics=queue.getMetrics();
  if (pending) {
    pending=false;
    metrics.runAppAttempt(applicationId,user);
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("allocate: applicationId=" + applicationId + " container="+ container.getId()+ " host="+ container.getNodeId().toString()+ " user="+ user+ " resource="+ request.getCapability());
  }
  metrics.allocateResources(user,1,request.getCapability(),true);
  return resourceRequests;
}
