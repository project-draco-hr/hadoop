{
  List<ResourceRequest> resourceRequests=new ArrayList<>();
  if (type == NodeType.NODE_LOCAL) {
    allocateNodeLocal(node,priority,request,resourceRequests);
  }
 else   if (type == NodeType.RACK_LOCAL) {
    allocateRackLocal(node,priority,request,resourceRequests);
  }
 else {
    allocateOffSwitch(request,resourceRequests);
  }
  QueueMetrics metrics=queue.getMetrics();
  if (pending) {
    pending=false;
    metrics.runAppAttempt(applicationId,user);
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("allocate: applicationId=" + applicationId + " container="+ containerAllocated.getId()+ " host="+ containerAllocated.getNodeId().toString()+ " user="+ user+ " resource="+ request.getCapability()+ " type="+ type);
  }
  metrics.allocateResources(user,1,request.getCapability(),true);
  metrics.incrNodeTypeAggregations(user,type);
  return resourceRequests;
}
