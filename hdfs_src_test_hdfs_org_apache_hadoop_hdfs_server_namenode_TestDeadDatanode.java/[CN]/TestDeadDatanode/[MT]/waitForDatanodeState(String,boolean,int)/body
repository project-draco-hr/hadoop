{
  long stopTime=System.currentTimeMillis() + waitTime;
  FSNamesystem namesystem=cluster.getNamesystem();
  String state=alive ? "alive" : "dead";
  while (System.currentTimeMillis() < stopTime) {
    namesystem.readLock();
    DatanodeDescriptor dd;
    try {
      dd=namesystem.getDatanode(nodeID);
    }
  finally {
      namesystem.readUnlock();
    }
    if (dd.isAlive == alive) {
      LOG.info("datanode " + nodeID + " is "+ state);
      return;
    }
    LOG.info("Waiting for datanode " + nodeID + " to become "+ state);
    Thread.sleep(1000);
  }
  throw new TimeoutException("Timedout waiting for datanode reach state " + state);
}
