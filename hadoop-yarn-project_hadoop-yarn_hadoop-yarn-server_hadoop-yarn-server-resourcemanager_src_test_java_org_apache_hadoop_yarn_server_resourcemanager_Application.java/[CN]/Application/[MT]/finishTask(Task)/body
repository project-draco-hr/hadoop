{
  Set<Task> tasks=this.tasks.get(task.getSchedulerKey());
  if (!tasks.remove(task)) {
    throw new IllegalStateException("Finishing unknown task " + task.getTaskId() + " from application "+ applicationId);
  }
  NodeManager nodeManager=task.getNodeManager();
  ContainerId containerId=task.getContainerId();
  task.stop();
  List<ContainerId> containerIds=new ArrayList<ContainerId>();
  containerIds.add(containerId);
  StopContainersRequest stopRequest=StopContainersRequest.newInstance(containerIds);
  nodeManager.stopContainers(stopRequest);
  Resources.subtractFrom(used,requestSpec.get(task.getSchedulerKey()));
  LOG.info("Finished task " + task.getTaskId() + " of application "+ applicationId+ " on node "+ nodeManager.getHostName()+ ", currently using "+ used+ " resources");
}
