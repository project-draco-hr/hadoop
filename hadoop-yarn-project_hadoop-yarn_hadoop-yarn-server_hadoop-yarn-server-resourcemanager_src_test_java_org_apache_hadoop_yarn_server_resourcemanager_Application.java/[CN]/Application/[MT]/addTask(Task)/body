{
  Priority priority=task.getPriority();
  Map<String,ResourceRequest> requests=this.requests.get(priority);
  if (requests == null) {
    requests=new HashMap<String,ResourceRequest>();
    this.requests.put(priority,requests);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Added priority=" + priority + " application="+ applicationId);
    }
  }
  final Resource capability=requestSpec.get(priority);
  Set<Task> tasks=this.tasks.get(priority);
  if (tasks == null) {
    tasks=new HashSet<Task>();
    this.tasks.put(priority,tasks);
  }
  tasks.add(task);
  LOG.info("Added task " + task.getTaskId() + " to application "+ applicationId+ " at priority "+ priority);
  if (LOG.isDebugEnabled()) {
    LOG.debug("addTask: application=" + applicationId + " #asks="+ ask.size());
  }
  for (  String host : task.getHosts()) {
    addResourceRequest(priority,requests,host,capability);
  }
  for (  String rack : task.getRacks()) {
    addResourceRequest(priority,requests,rack,capability);
  }
  addResourceRequest(priority,requests,ResourceRequest.ANY,capability);
}
