{
  ChannelFactory factory;
  if (workerCount == 0) {
    factory=new NioServerSocketChannelFactory(Executors.newCachedThreadPool(),Executors.newCachedThreadPool());
  }
 else {
    factory=new NioServerSocketChannelFactory(Executors.newCachedThreadPool(),Executors.newCachedThreadPool(),workerCount);
  }
  ServerBootstrap bootstrap=new ServerBootstrap(factory);
  bootstrap.setPipelineFactory(new ChannelPipelineFactory(){
    @Override public ChannelPipeline getPipeline() throws Exception {
      return Channels.pipeline(RpcUtil.constructRpcFrameDecoder(),RpcUtil.STAGE_RPC_MESSAGE_PARSER,rpcProgram,RpcUtil.STAGE_RPC_TCP_RESPONSE);
    }
  }
);
  bootstrap.setOption("child.tcpNoDelay",true);
  bootstrap.setOption("child.keepAlive",true);
  Channel ch=bootstrap.bind(new InetSocketAddress(port));
  InetSocketAddress socketAddr=(InetSocketAddress)ch.getLocalAddress();
  boundPort=socketAddr.getPort();
  LOG.info("Started listening to TCP requests at port " + boundPort + " for "+ rpcProgram+ " with workerCount "+ workerCount);
}
