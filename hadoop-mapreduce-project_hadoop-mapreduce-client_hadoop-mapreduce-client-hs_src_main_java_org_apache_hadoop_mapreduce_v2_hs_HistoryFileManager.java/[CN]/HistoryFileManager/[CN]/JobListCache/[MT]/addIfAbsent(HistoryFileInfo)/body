{
  JobId jobId=fileInfo.getJobId();
  if (LOG.isDebugEnabled()) {
    LOG.debug("Adding " + jobId + " to job list cache with "+ fileInfo.getJobIndexInfo());
  }
  HistoryFileInfo old=cache.putIfAbsent(jobId,fileInfo);
  if (cache.size() > maxSize) {
    Iterator<JobId> keys=cache.navigableKeySet().iterator();
    long cutoff=System.currentTimeMillis() - maxAge;
    JobId firstInIntermediateKey=null;
    int inIntermediateCount=0;
    JobId firstMoveFailedKey=null;
    int moveFailedCount=0;
    while (cache.size() > maxSize && keys.hasNext()) {
      JobId key=keys.next();
      HistoryFileInfo firstValue=cache.get(key);
      if (firstValue != null) {
synchronized (firstValue) {
          if (firstValue.isMovePending()) {
            if (firstValue.didMoveFail() && firstValue.jobIndexInfo.getFinishTime() <= cutoff) {
              cache.remove(key);
              try {
                firstValue.delete();
              }
 catch (              IOException e) {
                LOG.error("Error while trying to delete history files" + " that could not be moved to done.",e);
              }
            }
 else {
              if (firstValue.didMoveFail()) {
                if (moveFailedCount == 0) {
                  firstMoveFailedKey=key;
                }
                moveFailedCount+=1;
              }
 else {
                if (inIntermediateCount == 0) {
                  firstInIntermediateKey=key;
                }
                inIntermediateCount+=1;
              }
            }
          }
 else {
            cache.remove(key);
          }
        }
      }
    }
    if (inIntermediateCount > 0) {
      LOG.warn("Waiting to remove IN_INTERMEDIATE state histories " + "(e.g. " + firstInIntermediateKey + ") from JobListCache "+ "because it is not in done yet. Total count is "+ inIntermediateCount+ ".");
    }
    if (moveFailedCount > 0) {
      LOG.warn("Waiting to remove MOVE_FAILED state histories " + "(e.g. " + firstMoveFailedKey + ") from JobListCache "+ "because it is not in done yet. Total count is "+ moveFailedCount+ ".");
    }
  }
  return old;
}
