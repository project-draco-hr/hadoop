{
  this.conf=conf;
  int serialNumberLowDigits=3;
  serialNumberFormat=("%0" + (JobHistoryUtils.SERIAL_NUMBER_DIRECTORY_DIGITS + serialNumberLowDigits) + "d");
  String doneDirPrefix=null;
  doneDirPrefix=JobHistoryUtils.getConfiguredHistoryServerDoneDirPrefix(conf);
  try {
    doneDirPrefixPath=FileContext.getFileContext(conf).makeQualified(new Path(doneDirPrefix));
    doneDirFc=FileContext.getFileContext(doneDirPrefixPath.toUri(),conf);
    doneDirFc.setUMask(JobHistoryUtils.HISTORY_DONE_DIR_UMASK);
    mkdir(doneDirFc,doneDirPrefixPath,new FsPermission(JobHistoryUtils.HISTORY_DONE_DIR_PERMISSION));
  }
 catch (  IOException e) {
    throw new YarnRuntimeException("Error creating done directory: [" + doneDirPrefixPath + "]",e);
  }
  String intermediateDoneDirPrefix=null;
  intermediateDoneDirPrefix=JobHistoryUtils.getConfiguredHistoryIntermediateDoneDirPrefix(conf);
  try {
    intermediateDoneDirPath=FileContext.getFileContext(conf).makeQualified(new Path(intermediateDoneDirPrefix));
    intermediateDoneDirFc=FileContext.getFileContext(intermediateDoneDirPath.toUri(),conf);
    mkdir(intermediateDoneDirFc,intermediateDoneDirPath,new FsPermission(JobHistoryUtils.HISTORY_INTERMEDIATE_DONE_DIR_PERMISSIONS.toShort()));
  }
 catch (  IOException e) {
    LOG.info("error creating done directory on dfs " + e);
    throw new YarnRuntimeException("Error creating intermediate done directory: [" + intermediateDoneDirPath + "]",e);
  }
  this.aclsMgr=new JobACLsManager(conf);
  maxHistoryAge=conf.getLong(JHAdminConfig.MR_HISTORY_MAX_AGE_MS,JHAdminConfig.DEFAULT_MR_HISTORY_MAX_AGE);
  jobListCache=createJobListCache();
  serialNumberIndex=new SerialNumberIndex(conf.getInt(JHAdminConfig.MR_HISTORY_DATESTRING_CACHE_SIZE,JHAdminConfig.DEFAULT_MR_HISTORY_DATESTRING_CACHE_SIZE));
  int numMoveThreads=conf.getInt(JHAdminConfig.MR_HISTORY_MOVE_THREAD_COUNT,JHAdminConfig.DEFAULT_MR_HISTORY_MOVE_THREAD_COUNT);
  ThreadFactory tf=new ThreadFactoryBuilder().setNameFormat("MoveIntermediateToDone Thread #%d").build();
  moveToDoneExecutor=new ThreadPoolExecutor(numMoveThreads,numMoveThreads,1,TimeUnit.HOURS,new LinkedBlockingQueue<Runnable>(),tf);
  super.serviceInit(conf);
}
