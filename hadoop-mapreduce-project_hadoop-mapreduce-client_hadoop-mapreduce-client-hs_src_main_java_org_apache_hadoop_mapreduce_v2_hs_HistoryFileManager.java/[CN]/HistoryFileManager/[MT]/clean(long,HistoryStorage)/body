{
  boolean halted=false;
  List<FileStatus> serialDirList=findTimestampedDirectories();
  Collections.sort(serialDirList);
  for (  FileStatus serialDir : serialDirList) {
    List<FileStatus> historyFileList=scanDirectoryForHistoryFiles(serialDir.getPath(),doneDirFc);
    for (    FileStatus historyFile : historyFileList) {
      JobIndexInfo jobIndexInfo=FileNameIndexUtils.getIndexInfo(historyFile.getPath().getName());
      long effectiveTimestamp=getEffectiveTimestamp(jobIndexInfo.getFinishTime(),historyFile);
      if (effectiveTimestamp <= cutoff) {
        String confFileName=JobHistoryUtils.getIntermediateConfFileName(jobIndexInfo.getJobId());
        MetaInfo metaInfo=new MetaInfo(historyFile.getPath(),new Path(historyFile.getPath().getParent(),confFileName),null,jobIndexInfo);
        storage.jobRemovedFromHDFS(metaInfo.getJobId());
        deleteJobFromDone(metaInfo);
      }
 else {
        halted=true;
        break;
      }
    }
    if (!halted) {
      doneDirFc.delete(doneDirFc.makeQualified(serialDir.getPath()),true);
      removeDirectoryFromSerialNumberIndex(serialDir.getPath());
synchronized (existingDoneSubdirs) {
        existingDoneSubdirs.remove(serialDir.getPath());
      }
    }
 else {
      break;
    }
  }
}
