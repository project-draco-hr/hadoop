{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Scanning intermediate dir " + absPath);
  }
  List<FileStatus> fileStatusList=scanDirectoryForHistoryFiles(absPath,intermediateDoneDirFc);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Found " + fileStatusList.size() + " files");
  }
  for (  FileStatus fs : fileStatusList) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("scanning file: " + fs.getPath());
    }
    JobIndexInfo jobIndexInfo=FileNameIndexUtils.getIndexInfo(fs.getPath().getName());
    String confFileName=JobHistoryUtils.getIntermediateConfFileName(jobIndexInfo.getJobId());
    String summaryFileName=JobHistoryUtils.getIntermediateSummaryFileName(jobIndexInfo.getJobId());
    HistoryFileInfo fileInfo=createHistoryFileInfo(fs.getPath(),new Path(fs.getPath().getParent(),confFileName),new Path(fs.getPath().getParent(),summaryFileName),jobIndexInfo,false);
    final HistoryFileInfo old=jobListCache.addIfAbsent(fileInfo);
    if (old == null || old.didMoveFail()) {
      final HistoryFileInfo found=(old == null) ? fileInfo : old;
      long cutoff=System.currentTimeMillis() - maxHistoryAge;
      if (found.getJobIndexInfo().getFinishTime() <= cutoff) {
        try {
          found.delete();
        }
 catch (        IOException e) {
          LOG.warn("Error cleaning up a HistoryFile that is out of date.",e);
        }
      }
 else {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Scheduling move to done of " + found);
        }
        moveToDoneExecutor.execute(new Runnable(){
          @Override public void run(){
            try {
              found.moveToDone();
            }
 catch (            IOException e) {
              LOG.info("Failed to process fileInfo for job: " + found.getJobId(),e);
            }
          }
        }
);
      }
    }
 else     if (!old.isMovePending()) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("Duplicate: deleting");
      }
      fileInfo.delete();
    }
  }
}
