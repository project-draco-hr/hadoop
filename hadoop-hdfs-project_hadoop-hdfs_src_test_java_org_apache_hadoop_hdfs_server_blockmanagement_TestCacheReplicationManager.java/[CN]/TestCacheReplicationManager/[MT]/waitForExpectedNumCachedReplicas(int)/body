{
  BlocksMap cachedBlocksMap=cacheReplManager.cachedBlocksMap;
  int actual=0;
  while (expected != actual) {
    Thread.sleep(500);
    nn.getNamesystem().readLock();
    try {
      actual=0;
      for (      BlockInfo b : cachedBlocksMap.getBlocks()) {
        actual+=cachedBlocksMap.numNodes(b);
      }
    }
  finally {
      nn.getNamesystem().readUnlock();
    }
  }
}
