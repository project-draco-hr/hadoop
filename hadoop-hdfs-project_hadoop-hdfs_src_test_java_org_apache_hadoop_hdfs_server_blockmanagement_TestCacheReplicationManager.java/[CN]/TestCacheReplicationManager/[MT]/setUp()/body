{
  assumeTrue(NativeIO.isAvailable());
  conf=new HdfsConfiguration();
  conf.setLong(DFS_BLOCK_SIZE_KEY,BLOCK_SIZE);
  conf.setLong(DFS_DATANODE_MAX_LOCKED_MEMORY_KEY,CACHE_CAPACITY);
  conf.setLong(DFS_HEARTBEAT_INTERVAL_KEY,1);
  conf.setBoolean(DFS_NAMENODE_CACHING_ENABLED_KEY,true);
  conf.setLong(DFS_CACHEREPORT_INTERVAL_MSEC_KEY,1000);
  cluster=new MiniDFSCluster.Builder(conf).numDataNodes(NUM_DATANODES).build();
  cluster.waitActive();
  dfs=cluster.getFileSystem();
  nn=cluster.getNameNode();
  nnRpc=nn.getRpcServer();
  cacheReplManager=nn.getNamesystem().getCacheReplicationManager();
  rootDir=helper.getDefaultWorkingDirectory(dfs);
}
