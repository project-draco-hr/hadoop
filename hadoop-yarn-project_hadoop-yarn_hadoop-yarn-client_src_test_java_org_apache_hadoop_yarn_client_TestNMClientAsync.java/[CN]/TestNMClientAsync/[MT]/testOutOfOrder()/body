{
  CyclicBarrier barrierA=new CyclicBarrier(2);
  CyclicBarrier barrierB=new CyclicBarrier(2);
  CyclicBarrier barrierC=new CyclicBarrier(2);
  asyncClient=new MockNMClientAsync2(barrierA,barrierB,barrierC);
  asyncClient.init(new Configuration());
  asyncClient.start();
  final Container container=mockContainer(1);
  final ContainerLaunchContext clc=recordFactory.newRecordInstance(ContainerLaunchContext.class);
  Thread t=new Thread(){
    @Override public void run(){
      asyncClient.startContainer(container,clc);
    }
  }
;
  t.start();
  barrierA.await();
  asyncClient.stopContainer(container.getId(),container.getNodeId(),container.getContainerToken());
  barrierC.await();
  Assert.assertFalse("Starting and stopping should be out of order",((TestCallbackHandler2)asyncClient.callbackHandler).exceptionOccurred.get());
}
