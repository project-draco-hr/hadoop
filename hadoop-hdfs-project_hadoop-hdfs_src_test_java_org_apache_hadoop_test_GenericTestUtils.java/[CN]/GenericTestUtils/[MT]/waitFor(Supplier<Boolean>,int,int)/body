{
  long st=System.currentTimeMillis();
  do {
    boolean result=check.get();
    if (result) {
      return;
    }
    Thread.sleep(checkEveryMillis);
  }
 while (System.currentTimeMillis() - st < waitForMillis);
  throw new TimeoutException("Timed out waiting for condition");
}
