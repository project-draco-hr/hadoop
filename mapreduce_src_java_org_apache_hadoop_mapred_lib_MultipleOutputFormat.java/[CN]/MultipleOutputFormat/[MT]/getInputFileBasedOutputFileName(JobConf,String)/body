{
  String infilepath=job.get(MRJobConfig.MAP_INPUT_FILE);
  if (infilepath == null) {
    return name;
  }
  int numOfTrailingLegsToUse=job.getInt("mapred.outputformat.numOfTrailingLegs",0);
  if (numOfTrailingLegsToUse <= 0) {
    return name;
  }
  Path infile=new Path(infilepath);
  Path parent=infile.getParent();
  String midName=infile.getName();
  Path outPath=new Path(midName);
  for (int i=1; i < numOfTrailingLegsToUse; i++) {
    if (parent == null)     break;
    midName=parent.getName();
    if (midName.length() == 0)     break;
    parent=parent.getParent();
    outPath=new Path(midName,outPath);
  }
  return outPath.toString();
}
