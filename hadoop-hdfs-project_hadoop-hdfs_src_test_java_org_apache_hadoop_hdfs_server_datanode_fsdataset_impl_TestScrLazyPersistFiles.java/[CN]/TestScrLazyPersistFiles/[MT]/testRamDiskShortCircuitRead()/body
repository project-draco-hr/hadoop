{
  getClusterBuilder().setNumDatanodes(REPL_FACTOR).setStorageTypes(new StorageType[]{RAM_DISK,DEFAULT}).setRamDiskStorageLimit(2 * BLOCK_SIZE - 1).setUseScr(true).build();
  final String METHOD_NAME=GenericTestUtils.getMethodName();
  final int SEED=0xFADED;
  Path path=new Path("/" + METHOD_NAME + ".dat");
  makeRandomTestFile(path,BLOCK_SIZE,true,SEED);
  ensureFileReplicasOnStorageType(path,RAM_DISK);
  Thread.sleep(3 * LAZY_WRITER_INTERVAL_SEC * 1000);
  FSDataInputStream fis=fs.open(path);
  try {
    fis=fs.open(path);
    byte[] buf=new byte[BUFFER_LENGTH];
    fis.read(0,buf,0,BUFFER_LENGTH);
    HdfsDataInputStream dfsis=(HdfsDataInputStream)fis;
    Assert.assertEquals(BUFFER_LENGTH,dfsis.getReadStatistics().getTotalBytesRead());
    Assert.assertEquals(BUFFER_LENGTH,dfsis.getReadStatistics().getTotalShortCircuitBytesRead());
  }
  finally {
    fis.close();
    fis=null;
  }
}
