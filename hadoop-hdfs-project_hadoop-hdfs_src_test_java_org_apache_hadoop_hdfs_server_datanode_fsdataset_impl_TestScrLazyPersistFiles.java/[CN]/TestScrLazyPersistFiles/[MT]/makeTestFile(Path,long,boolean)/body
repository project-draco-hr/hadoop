{
  EnumSet<CreateFlag> createFlags=EnumSet.of(CREATE);
  if (isLazyPersist) {
    createFlags.add(LAZY_PERSIST);
  }
  FSDataOutputStream fos=null;
  try {
    fos=fs.create(path,FsPermission.getFileDefault(),createFlags,BUFFER_LENGTH,REPL_FACTOR,BLOCK_SIZE,null);
    byte[] buffer=new byte[BUFFER_LENGTH];
    for (int bytesWritten=0; bytesWritten < length; ) {
      fos.write(buffer,0,buffer.length);
      bytesWritten+=buffer.length;
    }
    if (length > 0) {
      fos.hsync();
    }
  }
  finally {
    IOUtils.closeQuietly(fos);
  }
}
