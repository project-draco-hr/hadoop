{
  int retries=MAX_RETRIES;
  while (true) {
    try {
      while (!umbilical.canCommit(taskId)) {
        try {
          Thread.sleep(1000);
        }
 catch (        InterruptedException ie) {
        }
        reporter.setProgressFlag();
      }
      break;
    }
 catch (    IOException ie) {
      LOG.warn("Failure asking whether task can commit: " + StringUtils.stringifyException(ie));
      if (--retries == 0) {
        discardOutput(taskContext);
        System.exit(68);
      }
    }
  }
  try {
    LOG.info("Task " + taskId + " is allowed to commit now");
    committer.commitTask(taskContext);
    return;
  }
 catch (  IOException iee) {
    LOG.warn("Failure committing: " + StringUtils.stringifyException(iee));
    discardOutput(taskContext);
    throw iee;
  }
}
