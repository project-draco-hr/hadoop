{
  if (!useWrap) {
    outStream.write(inBuf,off,len);
    return;
  }
  try {
    if (saslServer != null) {
      saslToken=saslServer.wrap(inBuf,off,len);
    }
 else {
      saslToken=saslClient.wrap(inBuf,off,len);
    }
  }
 catch (  SaslException se) {
    try {
      disposeSasl();
    }
 catch (    SaslException ignored) {
    }
    throw se;
  }
  if (saslToken != null) {
    ByteArrayOutputStream byteOut=new ByteArrayOutputStream();
    DataOutputStream dout=new DataOutputStream(byteOut);
    dout.writeInt(saslToken.length);
    outStream.write(byteOut.toByteArray());
    outStream.write(saslToken,0,saslToken.length);
    saslToken=null;
  }
}
