{
  String escapedName, escapedDispName;
  long currentValue;
synchronized (counter) {
    escapedName=escape(counter.getName());
    escapedDispName=escape(counter.getDisplayName());
    currentValue=counter.getValue();
  }
  int length=escapedName.length() + escapedDispName.length() + 4;
  length+=8;
  StringBuilder builder=new StringBuilder(length);
  builder.append(COUNTER_OPEN);
  builder.append(UNIT_OPEN);
  builder.append(escapedName);
  builder.append(UNIT_CLOSE);
  builder.append(UNIT_OPEN);
  builder.append(escapedDispName);
  builder.append(UNIT_CLOSE);
  builder.append(UNIT_OPEN);
  builder.append(currentValue);
  builder.append(UNIT_CLOSE);
  builder.append(COUNTER_CLOSE);
  return builder.toString();
}
