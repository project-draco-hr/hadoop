{
  Map<String,TreeMap<Resource,ResourceRequestInfo>> remoteRequests=this.remoteRequestsTable.get(priority);
  if (remoteRequests == null) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Not decrementing resource as priority " + priority + " is not present in request table");
    }
    return;
  }
  Map<Resource,ResourceRequestInfo> reqMap=remoteRequests.get(resourceName);
  if (reqMap == null) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Not decrementing resource as " + resourceName + " is not present in request table");
    }
    return;
  }
  ResourceRequestInfo resourceRequestInfo=reqMap.get(capability);
  if (LOG.isDebugEnabled()) {
    LOG.debug("BEFORE decResourceRequest:" + " applicationId=" + appAttemptId + " priority="+ priority.getPriority()+ " resourceName="+ resourceName+ " numContainers="+ resourceRequestInfo.remoteRequest.getNumContainers()+ " #asks="+ ask.size());
  }
  resourceRequestInfo.remoteRequest.setNumContainers(resourceRequestInfo.remoteRequest.getNumContainers() - containerCount);
  if (req instanceof StoredContainerRequest) {
    resourceRequestInfo.containerRequests.remove(req);
  }
  if (resourceRequestInfo.remoteRequest.getNumContainers() < 0) {
    resourceRequestInfo.remoteRequest.setNumContainers(0);
  }
  addResourceRequestToAsk(resourceRequestInfo.remoteRequest);
  if (resourceRequestInfo.remoteRequest.getNumContainers() == 0) {
    reqMap.remove(capability);
    if (reqMap.size() == 0) {
      remoteRequests.remove(resourceName);
    }
    if (remoteRequests.size() == 0) {
      remoteRequestsTable.remove(priority);
    }
  }
  if (LOG.isDebugEnabled()) {
    LOG.info("AFTER decResourceRequest:" + " applicationId=" + appAttemptId + " priority="+ priority.getPriority()+ " resourceName="+ resourceName+ " numContainers="+ resourceRequestInfo.remoteRequest.getNumContainers()+ " #asks="+ ask.size());
  }
}
