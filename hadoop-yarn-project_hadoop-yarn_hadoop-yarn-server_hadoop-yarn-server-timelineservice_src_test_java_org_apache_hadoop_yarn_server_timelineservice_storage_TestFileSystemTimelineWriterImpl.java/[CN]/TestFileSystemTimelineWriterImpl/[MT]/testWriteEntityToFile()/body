{
  TimelineEntities te=new TimelineEntities();
  TimelineEntity entity=new TimelineEntity();
  String id="hello";
  String type="world";
  entity.setId(id);
  entity.setType(type);
  entity.setCreatedTime(1425016501000L);
  te.addEntity(entity);
  FileSystemTimelineWriterImpl fsi=null;
  try {
    fsi=new FileSystemTimelineWriterImpl();
    fsi.init(new YarnConfiguration());
    fsi.start();
    fsi.write("cluster_id","user_id","flow_name","flow_version",12345678L,"app_id",te);
    String fileName=fsi.getOutputRoot() + "/entities/cluster_id/user_id/flow_name/flow_version/12345678/app_id/" + type+ "/"+ id+ FileSystemTimelineWriterImpl.TIMELINE_SERVICE_STORAGE_EXTENSION;
    Path path=Paths.get(fileName);
    File f=new File(fileName);
    assertTrue(f.exists() && !f.isDirectory());
    List<String> data=Files.readAllLines(path,StandardCharsets.UTF_8);
    assertTrue(data.size() == 2);
    String d=data.get(0);
    assertEquals(d,TimelineUtils.dumpTimelineRecordtoJSON(entity));
    File outputDir=new File(fsi.getOutputRoot());
    FileUtils.deleteDirectory(outputDir);
    assertTrue(!(f.exists()));
  }
  finally {
    if (fsi != null) {
      fsi.close();
      FileUtils.deleteDirectory(new File(fsi.getOutputRoot()));
    }
  }
}
