{
  rur.breakHardLinksIfNeeded();
  File[] copiedReplicaFiles=copyReplicaWithNewBlockIdAndGS(rur,bpid,newBlockId,recoveryId);
  File blockFile=copiedReplicaFiles[1];
  File metaFile=copiedReplicaFiles[0];
  LocalReplica.truncateBlock(blockFile,metaFile,rur.getNumBytes(),newlength);
  LocalReplicaInPipeline newReplicaInfo=new ReplicaBuilder(ReplicaState.RBW).setBlockId(newBlockId).setGenerationStamp(recoveryId).setFsVolume(this).setDirectoryToUse(blockFile.getParentFile()).setBytesToReserve(newlength).buildLocalReplicaInPipeline();
  return newReplicaInfo;
}
