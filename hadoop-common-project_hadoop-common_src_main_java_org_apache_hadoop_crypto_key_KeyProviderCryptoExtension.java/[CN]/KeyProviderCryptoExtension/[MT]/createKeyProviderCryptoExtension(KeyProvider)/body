{
  CryptoExtension cryptoExtension=null;
  if (keyProvider instanceof CryptoExtension) {
    cryptoExtension=(CryptoExtension)keyProvider;
  }
 else   if (keyProvider instanceof KeyProviderExtension && ((KeyProviderExtension)keyProvider).getKeyProvider() instanceof KeyProviderCryptoExtension.CryptoExtension) {
    KeyProviderExtension keyProviderExtension=(KeyProviderExtension)keyProvider;
    cryptoExtension=(CryptoExtension)keyProviderExtension.getKeyProvider();
  }
 else {
    cryptoExtension=new DefaultCryptoExtension(keyProvider);
  }
  return new KeyProviderCryptoExtension(keyProvider,cryptoExtension);
}
