{
  boolean groupNameInLegacyMap=true;
  String newGroupName=legacyMap.get(groupName);
  if (newGroupName == null) {
    groupNameInLegacyMap=false;
    newGroupName=Limits.filterGroupName(groupName);
  }
  boolean isFGroup=isFrameworkGroup(newGroupName);
  G group=isFGroup ? fgroups.get(newGroupName) : groups.get(newGroupName);
  if (group == null) {
    group=groupFactory.newGroup(newGroupName,limits);
    if (isFGroup) {
      fgroups.put(newGroupName,group);
    }
 else {
      limits.checkGroups(groups.size() + 1);
      groups.put(newGroupName,group);
    }
    if (groupNameInLegacyMap) {
      LOG.warn("Group " + groupName + " is deprecated. Use "+ newGroupName+ " instead");
    }
  }
  return group;
}
