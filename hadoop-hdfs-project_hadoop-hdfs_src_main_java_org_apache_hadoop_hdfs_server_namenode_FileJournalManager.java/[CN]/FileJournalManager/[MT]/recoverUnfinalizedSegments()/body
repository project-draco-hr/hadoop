{
  File currentDir=sd.getCurrentDir();
  LOG.info("Recovering unfinalized segments in " + currentDir);
  List<EditLogFile> allLogFiles=matchEditLogs(currentDir);
  for (  EditLogFile elf : allLogFiles) {
    if (elf.getFile().equals(currentInProgress)) {
      continue;
    }
    if (elf.isInProgress()) {
      if (elf.getFile().length() == 0) {
        LOG.info("Deleting zero-length edit log file " + elf);
        elf.getFile().delete();
        continue;
      }
      elf.validateLog();
      if (elf.hasCorruptHeader()) {
        elf.moveAsideCorruptFile();
        throw new CorruptionException("In-progress edit log file is corrupt: " + elf);
      }
      if (elf.getNumTransactions() == 0) {
        LOG.info("Deleting edit log file with zero transactions " + elf);
        elf.getFile().delete();
        continue;
      }
      finalizeLogSegment(elf.getFirstTxId(),elf.getLastTxId());
    }
  }
}
