{
  boolean considerSeenTxId=true;
  long seenTxId=NNStorage.readTransactionIdFile(sd);
  long maxSeenTransaction=0;
  for (  EditLogFile elf : getLogFiles(0)) {
    if (elf.isInProgress() && !inProgressOk) {
      if (elf.getFirstTxId() != HdfsConstants.INVALID_TXID && elf.getFirstTxId() <= seenTxId) {
        considerSeenTxId=false;
      }
      continue;
    }
    if (elf.isInProgress()) {
      maxSeenTransaction=Math.max(elf.getFirstTxId(),maxSeenTransaction);
      elf.validateLog();
    }
    maxSeenTransaction=Math.max(elf.getLastTxId(),maxSeenTransaction);
  }
  if (considerSeenTxId) {
    return Math.max(maxSeenTransaction,seenTxId);
  }
 else {
    return maxSeenTransaction;
  }
}
