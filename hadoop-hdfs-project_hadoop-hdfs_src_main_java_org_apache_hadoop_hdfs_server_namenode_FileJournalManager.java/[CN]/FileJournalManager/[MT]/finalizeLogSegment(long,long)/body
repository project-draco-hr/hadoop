{
  File inprogressFile=NNStorage.getInProgressEditsFile(sd,firstTxId);
  File dstFile=NNStorage.getFinalizedEditsFile(sd,firstTxId,lastTxId);
  LOG.info("Finalizing edits file " + inprogressFile + " -> "+ dstFile);
  Preconditions.checkState(!dstFile.exists(),"Can't finalize edits file " + inprogressFile + " since finalized file "+ "already exists");
  if (!inprogressFile.renameTo(dstFile)) {
    storage.reportErrorsOnDirectory(sd);
    throw new IllegalStateException("Unable to finalize edits file " + inprogressFile);
  }
  if (inprogressFile.equals(currentInProgress)) {
    currentInProgress=null;
  }
}
