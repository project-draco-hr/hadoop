{
  File inprogressFile=NNStorage.getInProgressEditsFile(sd,firstTxId);
  File dstFile=NNStorage.getFinalizedEditsFile(sd,firstTxId,lastTxId);
  LOG.info("Finalizing edits file " + inprogressFile + " -> "+ dstFile);
  Preconditions.checkState(!dstFile.exists(),"Can't finalize edits file " + inprogressFile + " since finalized file "+ "already exists");
  try {
    NativeIO.renameTo(inprogressFile,dstFile);
  }
 catch (  IOException e) {
    errorReporter.reportErrorOnFile(dstFile);
    throw new IllegalStateException("Unable to finalize edits file " + inprogressFile,e);
  }
  if (inprogressFile.equals(currentInProgress)) {
    currentInProgress=null;
  }
}
