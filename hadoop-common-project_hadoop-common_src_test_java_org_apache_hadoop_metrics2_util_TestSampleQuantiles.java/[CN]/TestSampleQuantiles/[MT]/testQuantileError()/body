{
  final int count=100000;
  Random r=new Random(0xDEADDEAD);
  Long[] values=new Long[count];
  for (int i=0; i < count; i++) {
    values[i]=(long)(i + 1);
  }
  for (int i=0; i < 10; i++) {
    System.out.println("Starting run " + i);
    Collections.shuffle(Arrays.asList(values),r);
    estimator.clear();
    for (int j=0; j < count; j++) {
      estimator.insert(values[j]);
    }
    Map<Quantile,Long> snapshot;
    snapshot=estimator.snapshot();
    for (    Quantile q : quantiles) {
      long actual=(long)(q.quantile * count);
      long error=(long)(q.error * count);
      long estimate=snapshot.get(q);
      System.out.println(String.format("Expected %d with error %d, estimated %d",actual,error,estimate));
      assertTrue(estimate <= actual + error);
      assertTrue(estimate >= actual - error);
    }
  }
}
