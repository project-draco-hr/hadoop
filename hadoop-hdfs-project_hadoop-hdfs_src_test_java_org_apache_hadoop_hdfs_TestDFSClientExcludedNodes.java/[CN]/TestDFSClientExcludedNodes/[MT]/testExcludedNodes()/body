{
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).numDataNodes(3).build();
  FileSystem fs=cluster.getFileSystem();
  Path filePath=new Path("/testExcludedNodes");
  cluster.stopDataNode(AppendTestUtil.nextInt(3));
  OutputStream out=fs.create(filePath,true,4096,(short)3,fs.getDefaultBlockSize(filePath));
  out.write(20);
  try {
    out.close();
  }
 catch (  Exception e) {
    fail("Single DN failure should not result in a block abort: \n" + e.getMessage());
  }
}
