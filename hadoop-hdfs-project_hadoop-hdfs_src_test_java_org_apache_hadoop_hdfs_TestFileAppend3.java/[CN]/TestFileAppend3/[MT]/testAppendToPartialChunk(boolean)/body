{
  final Path p=new Path("/partialChunk/foo" + (appendToNewBlock ? "0" : "1"));
  final int fileLen=513;
  System.out.println("p=" + p);
  byte[] fileContents=AppendTestUtil.initBuffer(fileLen);
  FSDataOutputStream stm=AppendTestUtil.createFile(fs,p,1);
  stm.write(fileContents,0,1);
  stm.close();
  System.out.println("Wrote 1 byte and closed the file " + p);
  stm=appendToNewBlock ? fs.append(p,EnumSet.of(CreateFlag.APPEND,CreateFlag.NEW_BLOCK),4096,null) : fs.append(p);
  stm.write(fileContents,1,1);
  stm.hflush();
  stm.close();
  System.out.println("Append 1 byte and closed the file " + p);
  stm=appendToNewBlock ? fs.append(p,EnumSet.of(CreateFlag.APPEND,CreateFlag.NEW_BLOCK),4096,null) : fs.append(p);
  assertEquals(2,stm.getPos());
  stm.write(fileContents,2,1);
  stm.hflush();
  System.out.println("Append and flush 1 byte");
  stm.write(fileContents,3,2);
  stm.hflush();
  System.out.println("Append and flush 2 byte");
  stm.write(fileContents,5,fileLen - 5);
  stm.close();
  System.out.println("Flush 508 byte and closed the file " + p);
  AppendTestUtil.checkFullFile(fs,p,fileLen,fileContents,"Failed to append to a partial chunk");
}
