{
  Server server;
  TestRpcService proxy=null;
  RPC.Builder builder=newServerBuilder(conf).setQueueSizePerHandler(1).setNumHandlers(1).setVerbose(true);
  server=setupTestServer(builder);
  conf.setInt(CommonConfigurationKeys.IPC_CLIENT_RPC_TIMEOUT_KEY,1000);
  try {
    proxy=getClient(addr,conf);
    proxy.sleep(null,newSleepRequest(3000));
    fail("RPC should time out.");
  }
 catch (  ServiceException e) {
    assertTrue(e.getCause() instanceof SocketTimeoutException);
    LOG.info("got expected timeout.",e);
  }
 finally {
    stop(server,proxy);
  }
}
