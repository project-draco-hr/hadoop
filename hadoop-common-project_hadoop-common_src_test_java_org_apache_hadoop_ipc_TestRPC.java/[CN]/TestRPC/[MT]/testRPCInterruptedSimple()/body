{
  Server server;
  TestRpcService proxy=null;
  RPC.Builder builder=newServerBuilder(conf).setNumHandlers(5).setVerbose(true).setSecretManager(null);
  server=setupTestServer(builder);
  try {
    proxy=getClient(addr,conf);
    proxy.ping(null,newEmptyRequest());
    Thread.currentThread().interrupt();
    try {
      proxy.ping(null,newEmptyRequest());
      fail("Interruption did not cause IPC to fail");
    }
 catch (    ServiceException se) {
      if (se.toString().contains("InterruptedException") || se.getCause() instanceof InterruptedIOException) {
        Thread.interrupted();
        return;
      }
      throw se;
    }
  }
  finally {
    stop(server,proxy);
  }
}
