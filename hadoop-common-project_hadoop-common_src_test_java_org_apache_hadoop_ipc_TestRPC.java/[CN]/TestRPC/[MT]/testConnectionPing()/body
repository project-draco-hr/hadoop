{
  Configuration conf=new Configuration();
  int pingInterval=50;
  conf.setBoolean(CommonConfigurationKeys.IPC_CLIENT_PING_KEY,true);
  conf.setInt(CommonConfigurationKeys.IPC_PING_INTERVAL_KEY,pingInterval);
  final Server server=new RPC.Builder(conf).setProtocol(TestProtocol.class).setInstance(new TestImpl()).setBindAddress(ADDRESS).setPort(0).setNumHandlers(5).setVerbose(true).build();
  server.start();
  final TestProtocol proxy=RPC.getProxy(TestProtocol.class,TestProtocol.versionID,server.getListenerAddress(),conf);
  try {
    proxy.sleep(pingInterval * 4);
  }
  finally {
    if (proxy != null)     RPC.stopProxy(proxy);
    server.stop();
  }
}
