{
  int threadsBefore=countThreads("Server$Listener$Reader");
  assertEquals("Expect no Reader threads running before test",0,threadsBefore);
  final Server server=new RPC.Builder(conf).setProtocol(TestProtocol.class).setInstance(new TestImpl()).setBindAddress(ADDRESS).setPort(0).setNumHandlers(5).setVerbose(true).build();
  server.start();
  try {
    int threadsRunning=countThreads("Server$Listener$Reader");
    assertTrue(threadsRunning > 0);
  }
  finally {
    server.stop();
  }
  int threadsAfter=countThreads("Server$Listener$Reader");
  assertEquals("Expect no Reader threads left running after test",0,threadsAfter);
}
