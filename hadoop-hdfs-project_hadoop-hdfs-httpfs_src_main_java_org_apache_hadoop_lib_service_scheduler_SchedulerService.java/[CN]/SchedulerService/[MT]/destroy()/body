{
  try {
    long limit=System.currentTimeMillis() + 30 * 1000;
    scheduler.shutdownNow();
    while (!scheduler.awaitTermination(1000,TimeUnit.MILLISECONDS)) {
      LOG.debug("Waiting for scheduler to shutdown");
      if (System.currentTimeMillis() > limit) {
        LOG.warn("Gave up waiting for scheduler to shutdown");
        break;
      }
    }
    if (scheduler.isTerminated()) {
      LOG.debug("Scheduler shutdown");
    }
  }
 catch (  InterruptedException ex) {
    LOG.warn(ex.getMessage(),ex);
  }
}
