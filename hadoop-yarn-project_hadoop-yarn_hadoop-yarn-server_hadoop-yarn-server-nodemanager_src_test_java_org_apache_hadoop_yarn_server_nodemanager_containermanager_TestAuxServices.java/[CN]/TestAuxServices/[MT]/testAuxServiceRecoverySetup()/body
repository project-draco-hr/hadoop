{
  Configuration conf=new YarnConfiguration();
  conf.setBoolean(YarnConfiguration.NM_RECOVERY_ENABLED,true);
  conf.set(YarnConfiguration.NM_RECOVERY_DIR,TEST_DIR.toString());
  conf.setStrings(YarnConfiguration.NM_AUX_SERVICES,new String[]{"Asrv","Bsrv"});
  conf.setClass(String.format(YarnConfiguration.NM_AUX_SERVICE_FMT,"Asrv"),RecoverableServiceA.class,Service.class);
  conf.setClass(String.format(YarnConfiguration.NM_AUX_SERVICE_FMT,"Bsrv"),RecoverableServiceB.class,Service.class);
  try {
    final AuxServices aux=new AuxServices();
    aux.init(conf);
    Assert.assertEquals(2,aux.getServices().size());
    File auxStorageDir=new File(TEST_DIR,AuxServices.STATE_STORE_ROOT_NAME);
    Assert.assertEquals(2,auxStorageDir.listFiles().length);
    aux.close();
  }
  finally {
    FileUtil.fullyDelete(TEST_DIR);
  }
}
