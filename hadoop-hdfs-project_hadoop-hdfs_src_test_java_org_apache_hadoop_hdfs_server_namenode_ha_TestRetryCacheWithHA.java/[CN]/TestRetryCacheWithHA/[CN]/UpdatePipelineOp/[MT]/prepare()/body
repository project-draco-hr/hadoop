{
  final Path filePath=new Path(file);
  DFSTestUtil.createFile(dfs,filePath,BlockSize,DataNodes,0);
  out=this.client.append(file,BlockSize,EnumSet.of(CreateFlag.APPEND),null,null);
  byte[] appendContent=new byte[100];
  new Random().nextBytes(appendContent);
  out.write(appendContent);
  ((HdfsDataOutputStream)out).hsync(EnumSet.of(SyncFlag.UPDATE_LENGTH));
  LocatedBlocks blks=dfs.getClient().getLocatedBlocks(file,BlockSize + 1);
  assertEquals(1,blks.getLocatedBlocks().size());
  nodes=blks.get(0).getLocations();
  oldBlock=blks.get(0).getBlock();
  LocatedBlock newLbk=client.getNamenode().updateBlockForPipeline(oldBlock,client.getClientName());
  newBlock=new ExtendedBlock(oldBlock.getBlockPoolId(),oldBlock.getBlockId(),oldBlock.getNumBytes(),newLbk.getBlock().getGenerationStamp());
}
