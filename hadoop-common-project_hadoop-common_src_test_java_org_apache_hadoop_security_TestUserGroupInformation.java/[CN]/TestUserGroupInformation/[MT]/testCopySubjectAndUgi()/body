{
  SecurityUtil.setAuthenticationMethod(AuthenticationMethod.SIMPLE,conf);
  UserGroupInformation.setConfiguration(conf);
  UserGroupInformation u1=UserGroupInformation.getLoginUser();
  assertNotNull(u1);
  @SuppressWarnings("unchecked") Token<? extends TokenIdentifier> tmpToken=mock(Token.class);
  u1.addToken(tmpToken);
  UserGroupInformation u2=u1.copySubjectAndUgi();
  assertEquals(u1.getAuthenticationMethod(),u2.getAuthenticationMethod());
  assertNotSame(u1.getSubject(),u2.getSubject());
  Credentials c1=u1.getCredentials(), c2=u2.getCredentials();
  List<Text> sc1=c1.getAllSecretKeys(), sc2=c2.getAllSecretKeys();
  assertArrayEquals(sc1.toArray(new Text[0]),sc2.toArray(new Text[0]));
  Collection<Token<? extends TokenIdentifier>> ts1=c1.getAllTokens(), ts2=c2.getAllTokens();
  assertArrayEquals(ts1.toArray(new Token[0]),ts2.toArray(new Token[0]));
  @SuppressWarnings("unchecked") Token<? extends TokenIdentifier> token=mock(Token.class);
  u2.addToken(token);
  assertTrue(u2.getCredentials().getAllTokens().contains(token));
  assertFalse(u1.getCredentials().getAllTokens().contains(token));
}
