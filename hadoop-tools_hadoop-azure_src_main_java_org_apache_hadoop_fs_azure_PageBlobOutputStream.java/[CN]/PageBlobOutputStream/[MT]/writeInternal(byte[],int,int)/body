{
  while (length > 0) {
    checkStreamState();
    final int availableBufferBytes=MAX_DATA_BYTES_PER_REQUEST - this.outBuffer.size();
    final int nextWrite=Math.min(availableBufferBytes,length);
    outBuffer.write(data,offset,nextWrite);
    offset+=nextWrite;
    length-=nextWrite;
    if (outBuffer.size() > MAX_DATA_BYTES_PER_REQUEST) {
      throw new RuntimeException("Internal error: maximum write size " + Integer.toString(MAX_DATA_BYTES_PER_REQUEST) + "exceeded.");
    }
    if (outBuffer.size() == MAX_DATA_BYTES_PER_REQUEST) {
      flushIOBuffers();
    }
  }
}
