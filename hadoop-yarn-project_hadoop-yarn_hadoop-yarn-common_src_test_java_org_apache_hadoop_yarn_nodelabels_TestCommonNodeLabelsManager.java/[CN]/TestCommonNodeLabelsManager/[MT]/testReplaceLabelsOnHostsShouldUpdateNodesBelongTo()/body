{
  mgr.addToCluserNodeLabels(toSet("p1","p2","p3"));
  mgr.addLabelsToNode(ImmutableMap.of(toNodeId("n1"),toSet("p1")));
  assertMapEquals(mgr.getNodeLabels(),ImmutableMap.of(toNodeId("n1"),toSet("p1")));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1:1"),toSet("p2"),toNodeId("n1:2"),toSet("p2")));
  assertMapEquals(mgr.getNodeLabels(),ImmutableMap.of(toNodeId("n1"),toSet("p1"),toNodeId("n1:1"),toSet("p2"),toNodeId("n1:2"),toSet("p2")));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1"),toSet("p1")));
  assertMapEquals(mgr.getNodeLabels(),ImmutableMap.of(toNodeId("n1"),toSet("p1"),toNodeId("n1:1"),toSet("p1"),toNodeId("n1:2"),toSet("p1")));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1:1"),toSet("p2")));
}
