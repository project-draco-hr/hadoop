{
  mgr.addToCluserNodeLabels(toSet("p1","p2","p3"));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n1"),toSet("p1")));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n2"),toSet("p2")));
  mgr.replaceLabelsOnNode(ImmutableMap.of(toNodeId("n3"),toSet("p3")));
  mgr.removeFromClusterNodeLabels(ImmutableSet.of("p1"));
  assertMapEquals(mgr.getNodeLabels(),ImmutableMap.of(toNodeId("n2"),toSet("p2"),toNodeId("n3"),toSet("p3")));
  assertCollectionEquals(mgr.lastRemovedlabels,Arrays.asList("p1"));
  mgr.removeFromClusterNodeLabels(ImmutableSet.of("p2","p3"));
  Assert.assertTrue(mgr.getNodeLabels().isEmpty());
  Assert.assertTrue(mgr.getClusterNodeLabels().isEmpty());
  assertCollectionEquals(mgr.lastRemovedlabels,Arrays.asList("p2","p3"));
}
