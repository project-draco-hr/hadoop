{
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  uploadDefaultConfiguration();
  YarnConfiguration yarnConf=new YarnConfiguration();
  yarnConf.set(YarnConfiguration.MAX_CLUSTER_LEVEL_APPLICATION_PRIORITY,"5");
  uploadConfiguration(yarnConf,"yarn-site.xml");
  rm=new MockRM(configuration);
  rm.init(configuration);
  rm.start();
  CapacityScheduler cs=(CapacityScheduler)rm.getRMContext().getScheduler();
  Assert.assertEquals(5,cs.getMaxClusterLevelAppPriority().getPriority());
  yarnConf=new YarnConfiguration();
  yarnConf.set(YarnConfiguration.MAX_CLUSTER_LEVEL_APPLICATION_PRIORITY,"10");
  uploadConfiguration(yarnConf,"yarn-site.xml");
  try {
    rm.adminService.refreshClusterMaxPriority(RefreshClusterMaxPriorityRequest.newInstance());
    Assert.assertEquals(10,cs.getMaxClusterLevelAppPriority().getPriority());
  }
 catch (  Exception ex) {
    fail("Could not refresh cluster max priority.");
  }
}
