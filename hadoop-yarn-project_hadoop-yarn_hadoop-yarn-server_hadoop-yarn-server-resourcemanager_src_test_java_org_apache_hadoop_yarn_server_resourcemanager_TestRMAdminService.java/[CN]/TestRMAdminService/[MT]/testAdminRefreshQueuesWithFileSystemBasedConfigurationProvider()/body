{
  configuration.set(YarnConfiguration.RM_CONFIGURATION_PROVIDER_CLASS,"org.apache.hadoop.yarn.FileSystemBasedConfigurationProvider");
  try {
    rm=new MockRM(configuration);
    rm.init(configuration);
    rm.start();
    fail("Should throw an exception");
  }
 catch (  Exception ex) {
  }
  uploadDefaultConfiguration();
  try {
    rm=new MockRM(configuration);
    rm.init(configuration);
    rm.start();
  }
 catch (  Exception ex) {
    fail("Should not get any exceptions");
  }
  CapacityScheduler cs=(CapacityScheduler)rm.getRMContext().getScheduler();
  int maxAppsBefore=cs.getConfiguration().getMaximumSystemApplications();
  CapacitySchedulerConfiguration csConf=new CapacitySchedulerConfiguration();
  csConf.set("yarn.scheduler.capacity.maximum-applications","5000");
  uploadConfiguration(csConf,"capacity-scheduler.xml");
  rm.adminService.refreshQueues(RefreshQueuesRequest.newInstance());
  int maxAppsAfter=cs.getConfiguration().getMaximumSystemApplications();
  Assert.assertEquals(maxAppsAfter,5000);
  Assert.assertTrue(maxAppsAfter != maxAppsBefore);
}
