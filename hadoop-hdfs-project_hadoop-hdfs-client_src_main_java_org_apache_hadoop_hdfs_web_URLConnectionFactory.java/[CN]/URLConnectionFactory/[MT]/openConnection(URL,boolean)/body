{
  if (isSpnego) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("open AuthenticatedURL connection" + url);
    }
    UserGroupInformation.getCurrentUser().checkTGTAndReloginFromKeytab();
    final AuthenticatedURL.Token authToken=new AuthenticatedURL.Token();
    return new AuthenticatedURL(new KerberosUgiAuthenticator(),connConfigurator).openConnection(url,authToken);
  }
 else {
    if (LOG.isDebugEnabled()) {
      LOG.debug("open URL connection");
    }
    URLConnection connection=url.openConnection();
    if (connection instanceof HttpURLConnection) {
      connConfigurator.configure((HttpURLConnection)connection);
    }
    return connection;
  }
}
