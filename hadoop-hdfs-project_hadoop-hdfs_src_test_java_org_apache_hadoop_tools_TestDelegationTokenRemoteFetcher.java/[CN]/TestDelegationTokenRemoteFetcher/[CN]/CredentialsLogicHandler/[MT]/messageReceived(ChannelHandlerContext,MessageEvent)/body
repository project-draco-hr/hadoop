{
  HttpRequest request=(HttpRequest)e.getMessage();
  if (request.getMethod() == HttpMethod.OPTIONS) {
    HttpResponse response=new DefaultHttpResponse(HTTP_1_1,HttpResponseStatus.OK);
    response.addHeader("Set-Cookie","hadoop-auth=1234");
    e.getChannel().write(response).addListener(ChannelFutureListener.CLOSE);
  }
 else   if (request.getMethod() != GET) {
    e.getChannel().close();
  }
  UnmodifiableIterator<Map.Entry<String,Handler>> iter=routes.entrySet().iterator();
  while (iter.hasNext()) {
    Map.Entry<String,Handler> entry=iter.next();
    if (request.getUri().contains(entry.getKey())) {
      Handler handler=entry.getValue();
      try {
        handler.handle(e.getChannel(),token,serviceUrl);
      }
 catch (      AssertionError ee) {
        TestDelegationTokenRemoteFetcher.this.assertionError=ee;
        HttpResponse response=new DefaultHttpResponse(HTTP_1_1,HttpResponseStatus.BAD_REQUEST);
        response.setContent(ChannelBuffers.copiedBuffer(ee.getMessage(),Charset.defaultCharset()));
        e.getChannel().write(response).addListener(ChannelFutureListener.CLOSE);
      }
      return;
    }
  }
}
