{
  bootstrap=startHttpServer(httpPort,testToken,serviceUrl);
  DelegationTokenFetcher.main(new String[]{"-webservice=" + serviceUrl,tokenFile});
  Path p=new Path(fileSys.getWorkingDirectory(),tokenFile);
  Credentials creds=Credentials.readTokenStorageFile(p,conf);
  Iterator<Token<?>> itr=creds.getAllTokens().iterator();
  assertTrue("token not exist error",itr.hasNext());
  Token<?> fetchedToken=itr.next();
  Assert.assertArrayEquals("token wrong identifier error",testToken.getIdentifier(),fetchedToken.getIdentifier());
  Assert.assertArrayEquals("token wrong password error",testToken.getPassword(),fetchedToken.getPassword());
  if (assertionError != null)   throw assertionError;
}
