{
  if (appAttemptId == null) {
    return putEntities(entities);
  }
  List<TimelineEntity> entitiesToDBStore=new ArrayList<TimelineEntity>();
  List<TimelineEntity> entitiesToSummaryCache=new ArrayList<TimelineEntity>();
  List<TimelineEntity> entitiesToEntityCache=new ArrayList<TimelineEntity>();
  Path attemptDir=createAttemptDir(appAttemptId);
  for (  TimelineEntity entity : entities) {
    if (summaryEntityTypes.contains(entity.getEntityType())) {
      entitiesToSummaryCache.add(entity);
    }
 else {
      if (groupId != null) {
        entitiesToEntityCache.add(entity);
      }
 else {
        entitiesToDBStore.add(entity);
      }
    }
  }
  if (!entitiesToSummaryCache.isEmpty()) {
    Path summaryLogPath=new Path(attemptDir,SUMMARY_LOG_PREFIX + appAttemptId.toString());
    if (LOG.isDebugEnabled()) {
      LOG.debug("Writing summary log for " + appAttemptId.toString() + " to "+ summaryLogPath);
    }
    this.logFDsCache.writeSummaryEntityLogs(fs,summaryLogPath,objMapper,appAttemptId,entitiesToSummaryCache,isAppendSupported);
  }
  if (!entitiesToEntityCache.isEmpty()) {
    Path entityLogPath=new Path(attemptDir,ENTITY_LOG_PREFIX + groupId.toString());
    if (LOG.isDebugEnabled()) {
      LOG.debug("Writing entity log for " + groupId.toString() + " to "+ entityLogPath);
    }
    this.logFDsCache.writeEntityLogs(fs,entityLogPath,objMapper,appAttemptId,groupId,entitiesToEntityCache,isAppendSupported);
  }
  if (!entitiesToDBStore.isEmpty()) {
    putEntities(entitiesToDBStore.toArray(new TimelineEntity[entitiesToDBStore.size()]));
  }
  return new TimelinePutResponse();
}
