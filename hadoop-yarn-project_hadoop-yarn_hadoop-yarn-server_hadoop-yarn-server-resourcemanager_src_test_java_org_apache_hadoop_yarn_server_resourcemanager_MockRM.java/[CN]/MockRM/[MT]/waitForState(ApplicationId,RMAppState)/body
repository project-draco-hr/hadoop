{
  RMApp app=getRMContext().getRMApps().get(appId);
  Assert.assertNotNull("app shouldn't be null",app);
  final int timeoutMsecs=80 * SECOND;
  int timeWaiting=0;
  while (!finalState.equals(app.getState())) {
    if (timeWaiting >= timeoutMsecs) {
      break;
    }
    LOG.info("App : " + appId + " State is : "+ app.getState()+ " Waiting for state : "+ finalState);
    Thread.sleep(WAIT_MS_PER_LOOP);
    timeWaiting+=WAIT_MS_PER_LOOP;
  }
  LOG.info("App State is : " + app.getState());
  Assert.assertEquals("App State is not correct (timeout).",finalState,app.getState());
}
