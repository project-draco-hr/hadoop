{
  ClientRMProtocol client=getClientRMService();
  GetNewApplicationResponse resp=client.getNewApplication(Records.newRecord(GetNewApplicationRequest.class));
  ApplicationId appId=resp.getApplicationId();
  SubmitApplicationRequest req=Records.newRecord(SubmitApplicationRequest.class);
  ApplicationSubmissionContext sub=Records.newRecord(ApplicationSubmissionContext.class);
  sub.setApplicationId(appId);
  sub.setApplicationName(name);
  sub.setUser(user);
  if (unmanaged) {
    sub.setUnmanagedAM(true);
  }
  ContainerLaunchContext clc=Records.newRecord(ContainerLaunchContext.class);
  Resource capability=Records.newRecord(Resource.class);
  capability.setMemory(masterMemory);
  clc.setResource(capability);
  clc.setApplicationACLs(acls);
  sub.setAMContainerSpec(clc);
  req.setApplicationSubmissionContext(sub);
  client.submitApplication(req);
  waitForState(appId,RMAppState.ACCEPTED);
  return getRMContext().getRMApps().get(appId);
}
