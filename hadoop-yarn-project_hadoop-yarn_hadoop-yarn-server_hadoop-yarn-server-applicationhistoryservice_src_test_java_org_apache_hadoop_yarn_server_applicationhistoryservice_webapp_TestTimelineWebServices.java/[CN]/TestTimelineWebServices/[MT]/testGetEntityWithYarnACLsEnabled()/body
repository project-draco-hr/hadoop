{
  timelineACLsManager.setACLsEnabled(true);
  remoteUser="tester";
  try {
    TimelineEntities entities=new TimelineEntities();
    TimelineEntity entity=new TimelineEntity();
    entity.setEntityId("test id 3");
    entity.setEntityType("test type 3");
    entity.setStartTime(System.currentTimeMillis());
    entities.addEntity(entity);
    WebResource r=resource();
    ClientResponse response=r.path("ws").path("v1").path("timeline").accept(MediaType.APPLICATION_JSON).type(MediaType.APPLICATION_JSON).post(ClientResponse.class,entities);
    response=r.path("ws").path("v1").path("timeline").path("test type 3").path("test id 3").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    entity=response.getEntity(TimelineEntity.class);
    Assert.assertNull(entity.getPrimaryFilters().get(TimelineStore.SystemFilter.ENTITY_OWNER.toString()));
    response=r.path("ws").path("v1").path("timeline").path("test type 3").path("test id 3").queryParam("fields","relatedentities").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    entity=response.getEntity(TimelineEntity.class);
    Assert.assertNull(entity.getPrimaryFilters().get(TimelineStore.SystemFilter.ENTITY_OWNER.toString()));
    response=r.path("ws").path("v1").path("timeline").path("test type 3").path("test id 3").queryParam("fields","primaryfilters").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    entity=response.getEntity(TimelineEntity.class);
    Assert.assertNull(entity.getPrimaryFilters().get(TimelineStore.SystemFilter.ENTITY_OWNER.toString()));
    remoteUser="other";
    response=r.path("ws").path("v1").path("timeline").path("test type 3").path("test id 3").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    assertEquals(ClientResponse.Status.NOT_FOUND,response.getClientResponseStatus());
  }
  finally {
    timelineACLsManager.setACLsEnabled(false);
    remoteUser=null;
  }
}
