{
  Preconditions.checkArgument(replication >= 0 && replication <= MAX_REDUNDANCY);
  long h=0;
  if (preferredBlockSize == 0) {
    preferredBlockSize=PREFERRED_BLOCK_SIZE.BITS.getMin();
  }
  h=PREFERRED_BLOCK_SIZE.BITS.combine(preferredBlockSize,h);
  long layoutRedundancy=0;
  if (isStriped) {
    layoutRedundancy|=1 << 11;
  }
  layoutRedundancy|=replication;
  h=BLOCK_LAYOUT_AND_REDUNDANCY.BITS.combine(layoutRedundancy,h);
  h=STORAGE_POLICY_ID.BITS.combine(storagePolicyID,h);
  return h;
}
