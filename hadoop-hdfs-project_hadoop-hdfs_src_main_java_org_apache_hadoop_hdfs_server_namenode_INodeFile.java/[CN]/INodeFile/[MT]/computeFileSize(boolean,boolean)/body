{
  if (blocks == null || blocks.length == 0) {
    return 0;
  }
  final int last=blocks.length - 1;
  BlockInfo lastBlk=blocks[last];
  long size=lastBlk.getNumBytes();
  if (lastBlk instanceof BlockInfoUnderConstruction) {
    if (!includesLastUcBlock) {
      size=0;
    }
 else     if (usePreferredBlockSize4LastUcBlock) {
      size=isStriped() ? getPreferredBlockSize() * ((BlockInfoStriped)lastBlk).getDataBlockNum() : getPreferredBlockSize();
    }
  }
  for (int i=0; i < last; i++) {
    size+=blocks[i].getNumBytes();
  }
  return size;
}
