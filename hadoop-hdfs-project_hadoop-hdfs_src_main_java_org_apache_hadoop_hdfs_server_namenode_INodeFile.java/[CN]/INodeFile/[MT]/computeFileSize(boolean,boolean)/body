{
  if (blocks == null || blocks.length == 0) {
    return 0;
  }
  final int last=blocks.length - 1;
  long size=blocks[last].getNumBytes();
  if (blocks[last] instanceof BlockInfoContiguousUnderConstruction) {
    if (!includesLastUcBlock) {
      size=0;
    }
 else     if (usePreferredBlockSize4LastUcBlock) {
      size=getPreferredBlockSize();
    }
  }
  for (int i=0; i < last; i++) {
    size+=blocks[i].getNumBytes();
  }
  return size;
}
