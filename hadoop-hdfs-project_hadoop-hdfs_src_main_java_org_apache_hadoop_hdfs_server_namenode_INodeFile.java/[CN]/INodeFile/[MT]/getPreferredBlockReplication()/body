{
  short max=getFileReplication(CURRENT_STATE_ID);
  FileWithSnapshotFeature sf=this.getFileWithSnapshotFeature();
  if (sf != null) {
    short maxInSnapshot=sf.getMaxBlockRepInDiffs(null);
    if (sf.isCurrentFileDeleted()) {
      return maxInSnapshot;
    }
    max=maxInSnapshot > max ? maxInSnapshot : max;
  }
  return isStriped() ? HdfsConstants.NUM_DATA_BLOCKS + HdfsConstants.NUM_PARITY_BLOCKS : max;
}
