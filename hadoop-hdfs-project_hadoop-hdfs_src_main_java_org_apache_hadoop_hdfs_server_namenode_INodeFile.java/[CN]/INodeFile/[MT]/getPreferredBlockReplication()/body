{
  short max=getFileReplication(CURRENT_STATE_ID);
  FileWithSnapshotFeature sf=this.getFileWithSnapshotFeature();
  if (sf != null) {
    short maxInSnapshot=sf.getMaxBlockRepInDiffs();
    if (sf.isCurrentFileDeleted()) {
      return maxInSnapshot;
    }
    max=maxInSnapshot > max ? maxInSnapshot : max;
  }
  return max;
}
