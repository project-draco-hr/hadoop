{
  Preconditions.checkState(isUnderConstruction(),"file is no longer under construction");
  if (numBlocks() == 0) {
    throw new IOException("Failed to set last block: File is empty.");
  }
  final BlockInfo ucBlock;
  if (isStriped()) {
    Preconditions.checkState(lastBlock.isStriped());
    ucBlock=((BlockInfoStriped)lastBlock).convertToBlockUnderConstruction(UNDER_CONSTRUCTION,locations);
  }
 else {
    Preconditions.checkState(!lastBlock.isStriped());
    ucBlock=((BlockInfoContiguous)lastBlock).convertToBlockUnderConstruction(UNDER_CONSTRUCTION,locations);
  }
  setBlock(numBlocks() - 1,ucBlock);
}
