{
  final Content.Counts counts=summary.getCounts();
  FileWithSnapshotFeature sf=getFileWithSnapshotFeature();
  if (sf == null) {
    counts.add(Content.LENGTH,computeFileSize());
    counts.add(Content.FILE,1);
  }
 else {
    final FileDiffList diffs=sf.getDiffs();
    final int n=diffs.asList().size();
    counts.add(Content.FILE,n);
    if (n > 0 && sf.isCurrentFileDeleted()) {
      counts.add(Content.LENGTH,diffs.getLast().getFileSize());
    }
 else {
      counts.add(Content.LENGTH,computeFileSize());
    }
  }
  counts.add(Content.DISKSPACE,diskspaceConsumed());
  return summary;
}
