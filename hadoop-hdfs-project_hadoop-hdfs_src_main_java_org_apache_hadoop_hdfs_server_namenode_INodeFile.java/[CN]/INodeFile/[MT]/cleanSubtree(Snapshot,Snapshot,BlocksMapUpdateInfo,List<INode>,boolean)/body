{
  FileWithSnapshotFeature sf=getFileWithSnapshotFeature();
  if (sf != null) {
    return sf.cleanFile(this,snapshot,prior,collectedBlocks,removedINodes,countDiffChange);
  }
  Quota.Counts counts=Quota.Counts.newInstance();
  if (snapshot == null && prior == null) {
    computeQuotaUsage(counts,false);
    destroyAndCollectBlocks(collectedBlocks,removedINodes);
  }
 else   if (snapshot == null && prior != null) {
    FileUnderConstructionFeature uc=getFileUnderConstructionFeature();
    if (uc != null) {
      uc.cleanZeroSizeBlock(this,collectedBlocks);
    }
  }
  return counts;
}
