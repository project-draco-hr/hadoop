{
  FileWithSnapshotFeature sf=getFileWithSnapshotFeature();
  if (sf != null) {
    return sf.cleanFile(this,snapshot,priorSnapshotId,collectedBlocks,removedINodes,countDiffChange);
  }
  Quota.Counts counts=Quota.Counts.newInstance();
  if (snapshot == CURRENT_STATE_ID) {
    if (priorSnapshotId == NO_SNAPSHOT_ID) {
      computeQuotaUsage(counts,false);
      destroyAndCollectBlocks(collectedBlocks,removedINodes);
    }
 else {
      FileUnderConstructionFeature uc=getFileUnderConstructionFeature();
      if (uc != null) {
        uc.cleanZeroSizeBlock(this,collectedBlocks);
      }
    }
  }
  return counts;
}
