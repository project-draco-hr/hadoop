{
  Preconditions.checkState(isUnderConstruction(),"file is no longer under construction");
  if (numBlocks() == 0) {
    throw new IOException("Failed to set last block: File is empty.");
  }
  BlockInfoUnderConstruction ucBlock=lastBlock.convertToBlockUnderConstruction(BlockUCState.UNDER_CONSTRUCTION,locations);
  ucBlock.setBlockCollection(this);
  setBlock(numBlocks() - 1,ucBlock);
  return ucBlock;
}
