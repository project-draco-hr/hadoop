{
  Configuration conf=new Configuration();
  conf.set(YarnConfiguration.SCM_STORE_CLASS,InMemorySCMStore.class.getName());
  conf.set(YarnConfiguration.SHARED_CACHE_ROOT,testDir.getPath());
  AppChecker appChecker=spy(new DummyAppChecker());
  store=new InMemorySCMStore(appChecker);
  store.init(conf);
  store.start();
  service=new SharedCacheUploaderService(store);
  service.init(conf);
  service.start();
  YarnRPC rpc=YarnRPC.create(new Configuration());
  InetSocketAddress scmAddress=conf.getSocketAddr(YarnConfiguration.SCM_UPLOADER_SERVER_ADDRESS,YarnConfiguration.DEFAULT_SCM_UPLOADER_SERVER_ADDRESS,YarnConfiguration.DEFAULT_SCM_UPLOADER_SERVER_PORT);
  proxy=(SCMUploaderProtocol)rpc.getProxy(SCMUploaderProtocol.class,scmAddress,conf);
}
