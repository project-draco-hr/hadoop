{
  if (!DataNodeLayoutVersion.supports(LayoutVersion.Feature.APPEND_RBW_DIR,layoutVersion) && detachDir.exists() && detachDir.isDirectory()) {
    if (FileUtil.list(detachDir).length != 0) {
      throw new IOException("Detached directory " + detachDir + " is not empty. Please manually move each file under this "+ "directory to the finalized directory if the finalized "+ "directory tree does not have the file.");
    }
 else     if (!detachDir.delete()) {
      throw new IOException("Cannot remove directory " + detachDir);
    }
  }
}
