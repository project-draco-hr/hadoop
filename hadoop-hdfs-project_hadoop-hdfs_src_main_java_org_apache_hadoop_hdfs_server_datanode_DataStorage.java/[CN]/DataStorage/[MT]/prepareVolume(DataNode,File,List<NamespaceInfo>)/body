{
  if (containsStorageDir(volume)) {
    final String errorMessage="Storage directory is in use";
    LOG.warn(errorMessage + ".");
    throw new IOException(errorMessage);
  }
  StorageDirectory sd=loadStorageDirectory(datanode,nsInfos.get(0),volume,StartupOption.HOTSWAP);
  VolumeBuilder builder=new VolumeBuilder(this,sd);
  for (  NamespaceInfo nsInfo : nsInfos) {
    List<File> bpDataDirs=Lists.newArrayList();
    bpDataDirs.add(BlockPoolSliceStorage.getBpRoot(nsInfo.getBlockPoolID(),new File(volume,STORAGE_DIR_CURRENT)));
    makeBlockPoolDataDir(bpDataDirs,null);
    final BlockPoolSliceStorage bpStorage=getBlockPoolSliceStorage(nsInfo);
    final List<StorageDirectory> dirs=bpStorage.loadBpStorageDirectories(nsInfo,bpDataDirs,StartupOption.HOTSWAP,datanode.getConf());
    builder.addBpStorageDirectories(nsInfo.getBlockPoolID(),dirs);
  }
  return builder;
}
