{
  if (locations.isEmpty()) {
    return;
  }
  Set<File> dataDirs=new HashSet<File>();
  for (  StorageLocation sl : locations) {
    dataDirs.add(sl.getFile());
  }
  for (  BlockPoolSliceStorage bpsStorage : this.bpStorageMap.values()) {
    bpsStorage.removeVolumes(dataDirs);
  }
  StringBuilder errorMsgBuilder=new StringBuilder();
  for (Iterator<StorageDirectory> it=this.storageDirs.iterator(); it.hasNext(); ) {
    StorageDirectory sd=it.next();
    if (dataDirs.contains(sd.getRoot())) {
      it.remove();
      try {
        sd.unlock();
      }
 catch (      IOException e) {
        LOG.warn(String.format("I/O error attempting to unlock storage directory %s.",sd.getRoot()),e);
        errorMsgBuilder.append(String.format("Failed to remove %s: %s%n",sd.getRoot(),e.getMessage()));
      }
    }
  }
  if (errorMsgBuilder.length() > 0) {
    throw new IOException(errorMsgBuilder.toString());
  }
}
