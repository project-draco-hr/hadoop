{
  final String bpid=nsInfo.getBlockPoolID();
  final BlockPoolSliceStorage bpStorage=getBlockPoolSliceStorage(nsInfo);
  final List<StorageDirectory> success=Lists.newArrayList();
  for (  StorageLocation dataDir : dataDirs) {
    final File curDir=new File(dataDir.getFile(),STORAGE_DIR_CURRENT);
    List<File> bpDataDirs=new ArrayList<File>();
    bpDataDirs.add(BlockPoolSliceStorage.getBpRoot(bpid,curDir));
    try {
      makeBlockPoolDataDir(bpDataDirs,null);
      final List<StorageDirectory> dirs=bpStorage.recoverTransitionRead(nsInfo,bpDataDirs,startOpt,datanode.getConf());
      for (      StorageDirectory sd : dirs) {
        success.add(sd);
      }
    }
 catch (    IOException e) {
      LOG.warn("Failed to add storage directory " + dataDir + " for block pool "+ bpid,e);
    }
  }
  return success;
}
