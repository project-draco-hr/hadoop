{
  HardLink hardLink=new HardLink();
  int diskLayoutVersion=this.getLayoutVersion();
  if (DataNodeLayoutVersion.supports(LayoutVersion.Feature.APPEND_RBW_DIR,diskLayoutVersion)) {
    linkBlocks(datanode,new File(fromDir,STORAGE_DIR_FINALIZED),new File(toDir,STORAGE_DIR_FINALIZED),diskLayoutVersion,hardLink);
    linkBlocks(datanode,new File(fromDir,STORAGE_DIR_RBW),new File(toDir,STORAGE_DIR_RBW),diskLayoutVersion,hardLink);
  }
 else {
    linkBlocks(datanode,fromDir,new File(toDir,STORAGE_DIR_FINALIZED),diskLayoutVersion,hardLink);
    if (fromBbwDir.exists()) {
      linkBlocks(datanode,fromBbwDir,new File(toDir,STORAGE_DIR_RBW),diskLayoutVersion,hardLink);
    }
  }
  LOG.info(hardLink.linkStats.report());
}
