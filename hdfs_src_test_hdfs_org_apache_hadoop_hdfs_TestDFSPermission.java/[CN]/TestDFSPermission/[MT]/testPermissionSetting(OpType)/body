{
  PermissionGenerator generator=new PermissionGenerator(r);
  for (short i=0; i < NUM_TEST_PERMISSIONS; i++) {
    createAndCheckPermission(op,FILE_DIR_PATH,generator.next(),new FsPermission(DEFAULT_PERMISSION),true);
  }
  createAndCheckPermission(op,FILE_DIR_PATH,DEFAULT_UMASK,new FsPermission((short)0643),true);
  createAndCheckPermission(op,FILE_DIR_PATH,(short)0222,new FsPermission((short)0643),false);
  fs.setPermission(FILE_DIR_PATH,new FsPermission((short)0111));
  short expectedPermission=(short)((op == OpType.CREATE) ? 0 : 0111);
  checkPermission(FILE_DIR_PATH,expectedPermission,true);
  assertFalse(fs.exists(NON_EXISTENT_PATH));
  createAndCheckPermission(op,NON_EXISTENT_PATH,DEFAULT_UMASK,new FsPermission(DEFAULT_PERMISSION),false);
  Path parent=NON_EXISTENT_PATH.getParent();
  checkPermission(parent,getPermission(parent.getParent()),true);
}
