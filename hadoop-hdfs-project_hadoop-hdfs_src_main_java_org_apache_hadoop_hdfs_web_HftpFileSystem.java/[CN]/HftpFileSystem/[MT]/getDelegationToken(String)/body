{
  try {
    ugi.checkTGTAndReloginFromKeytab();
    return ugi.doAs(new PrivilegedExceptionAction<Token<?>>(){
      @Override public Token<?> run() throws IOException {
        final String nnHttpUrl=nnUri.toString();
        Credentials c;
        try {
          c=DelegationTokenFetcher.getDTfromRemote(connectionFactory,nnUri,renewer);
        }
 catch (        IOException e) {
          if (e.getCause() instanceof ConnectException) {
            LOG.warn("Couldn't connect to " + nnHttpUrl + ", assuming security is disabled");
            return null;
          }
          if (LOG.isDebugEnabled()) {
            LOG.debug("Exception getting delegation token",e);
          }
          throw e;
        }
        for (        Token<? extends TokenIdentifier> t : c.getAllTokens()) {
          if (LOG.isDebugEnabled()) {
            LOG.debug("Got dt for " + getUri() + ";t.service="+ t.getService());
          }
          return t;
        }
        return null;
      }
    }
);
  }
 catch (  InterruptedException e) {
    throw new RuntimeException(e);
  }
}
