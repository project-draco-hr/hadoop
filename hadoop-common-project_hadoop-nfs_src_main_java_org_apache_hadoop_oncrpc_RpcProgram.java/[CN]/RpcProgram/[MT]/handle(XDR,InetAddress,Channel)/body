{
  XDR out=new XDR();
  RpcCall rpcCall=RpcCall.read(xdr);
  if (LOG.isDebugEnabled()) {
    LOG.debug(program + " procedure #" + rpcCall.getProcedure());
  }
  if (!checkProgram(rpcCall.getProgram())) {
    return programMismatch(out,rpcCall);
  }
  if (!checkProgramVersion(rpcCall.getVersion())) {
    return programVersionMismatch(out,rpcCall);
  }
  boolean idempotent=rpcCallCache != null && !isIdempotent(rpcCall);
  if (idempotent) {
    CacheEntry entry=rpcCallCache.checkOrAddToCache(client,rpcCall.getXid());
    if (entry != null) {
      if (entry.isCompleted()) {
        LOG.info("Sending the cached reply to retransmitted request " + rpcCall.getXid());
        return entry.getResponse();
      }
 else {
        LOG.info("Retransmitted request, transaction still in progress " + rpcCall.getXid());
      }
    }
  }
  XDR response=handleInternal(rpcCall,xdr,out,client,channel);
  if (response.size() == 0) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("No sync response, expect an async response for request XID=" + rpcCall.getXid());
    }
  }
  if (idempotent) {
    rpcCallCache.callCompleted(client,rpcCall.getXid(),response);
  }
  return response;
}
