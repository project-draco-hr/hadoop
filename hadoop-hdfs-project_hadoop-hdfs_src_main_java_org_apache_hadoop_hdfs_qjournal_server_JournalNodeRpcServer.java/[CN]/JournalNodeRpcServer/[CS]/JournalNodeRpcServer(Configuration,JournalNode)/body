{
  this.jn=jn;
  Configuration confCopy=new Configuration(conf);
  confCopy.setBoolean(CommonConfigurationKeysPublic.IPC_SERVER_TCPNODELAY_KEY,true);
  InetSocketAddress addr=getAddress(confCopy);
  RPC.setProtocolEngine(confCopy,QJournalProtocolPB.class,ProtobufRpcEngine.class);
  QJournalProtocolServerSideTranslatorPB translator=new QJournalProtocolServerSideTranslatorPB(this);
  BlockingService service=QJournalProtocolService.newReflectiveBlockingService(translator);
  this.server=new RPC.Builder(confCopy).setProtocol(QJournalProtocolPB.class).setInstance(service).setBindAddress(addr.getHostName()).setPort(addr.getPort()).setNumHandlers(HANDLER_COUNT).setVerbose(false).build();
  if (confCopy.getBoolean(CommonConfigurationKeys.HADOOP_SECURITY_AUTHORIZATION,false)) {
    server.refreshServiceAcl(confCopy,new HDFSPolicyProvider());
  }
}
