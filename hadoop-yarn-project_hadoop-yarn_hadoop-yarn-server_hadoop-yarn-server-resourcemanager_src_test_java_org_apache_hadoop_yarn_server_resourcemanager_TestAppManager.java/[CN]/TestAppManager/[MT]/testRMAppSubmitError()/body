{
  long now=System.currentTimeMillis();
  RMContext rmContext=mockRMContext(1,now - 10);
  ResourceScheduler scheduler=new CapacityScheduler();
  Configuration conf=new Configuration();
  ApplicationMasterService masterService=new ApplicationMasterService(rmContext,scheduler);
  TestRMAppManager appMonitor=new TestRMAppManager(rmContext,new ClientToAMTokenSecretManagerInRM(),scheduler,masterService,new ApplicationACLsManager(conf),conf);
  ApplicationId appID=MockApps.newAppID(0);
  RecordFactory recordFactory=RecordFactoryProvider.getRecordFactory(null);
  ApplicationSubmissionContext context=recordFactory.newRecordInstance(ApplicationSubmissionContext.class);
  context.setApplicationId(appID);
  context.setApplicationName("testApp1");
  context.setQueue("testQueue");
  setupDispatcher(rmContext,conf);
  RMApp appOrig=rmContext.getRMApps().get(appID);
  Assert.assertTrue("app name matches but shouldn't","testApp1" != appOrig.getName());
  ContainerLaunchContext clc=BuilderUtils.newContainerLaunchContext(null,null,null,null,null,null,null);
  context.setAMContainerSpec(clc);
  appMonitor.submitApplication(context);
  RMApp app=rmContext.getRMApps().get(appID);
  Assert.assertNotNull("app is null",app);
  Assert.assertEquals("app id doesn't match",appID,app.getApplicationId());
  Assert.assertEquals("app name doesn't matches",appOrig.getName(),app.getName());
  ((Service)rmContext.getDispatcher()).stop();
}
