{
  long now=System.currentTimeMillis();
  rmContext=mockRMContext(1,now - 10);
  ResourceScheduler scheduler=mockResourceScheduler();
  ((RMContextImpl)rmContext).setScheduler(scheduler);
  Configuration conf=new Configuration();
  ApplicationMasterService masterService=new ApplicationMasterService(rmContext,scheduler);
  appMonitor=new TestRMAppManager(rmContext,new ClientToAMTokenSecretManagerInRM(),scheduler,masterService,new ApplicationACLsManager(conf),conf);
  appId=MockApps.newAppID(1);
  RecordFactory recordFactory=RecordFactoryProvider.getRecordFactory(null);
  asContext=recordFactory.newRecordInstance(ApplicationSubmissionContext.class);
  asContext.setApplicationId(appId);
  asContext.setAMContainerSpec(mockContainerLaunchContext(recordFactory));
  asContext.setResource(mockResource());
  setupDispatcher(rmContext,conf);
}
