{
  PasswordReader c=getPasswordReader();
  if (c == null) {
    throw new IOException("No console available for prompting user.");
  }
  char[] cred=null;
  boolean noMatch;
  do {
    char[] newPassword1=c.readPassword("Enter password: ");
    char[] newPassword2=c.readPassword("Enter password again: ");
    noMatch=!Arrays.equals(newPassword1,newPassword2);
    if (noMatch) {
      if (newPassword1 != null)       Arrays.fill(newPassword1,' ');
      c.format("Passwords don't match. Try again.%n");
    }
 else {
      cred=newPassword1;
    }
    if (newPassword2 != null)     Arrays.fill(newPassword2,' ');
  }
 while (noMatch);
  return cred;
}
