{
  Logger rootLogger=LogManager.getRootLogger();
  rootLogger.setLevel(Level.DEBUG);
  YarnConfiguration conf=new YarnConfiguration();
  conf.setInt(YarnConfiguration.RM_NODE_IP_CACHE_EXPIRY_INTERVAL_SECS,30);
  MockRM rm=new MockRM(conf);
  rm.init(conf);
  NodesListManager nodesListManager=rm.getNodesListManager();
  nodesListManager.init(conf);
  nodesListManager.start();
  NodesListManager.CachedResolver resolver=(NodesListManager.CachedResolver)nodesListManager.getResolver();
  resolver.addToCache("testCachedResolverHost1","1.1.1.1");
  resolver.addToCache("testCachedResolverHost2","1.1.1.2");
  Assert.assertEquals("1.1.1.1",resolver.resolve("testCachedResolverHost1"));
  Assert.assertEquals("1.1.1.2",resolver.resolve("testCachedResolverHost2"));
  RMNode rmnode1=MockNodes.newNodeInfo(1,Resource.newInstance(28000,8),1,"testCachedResolverHost1",1234);
  RMNode rmnode2=MockNodes.newNodeInfo(1,Resource.newInstance(28000,8),1,"testCachedResolverHost2",1234);
  nodesListManager.handle(new NodesListManagerEvent(NodesListManagerEventType.NODE_USABLE,rmnode1));
  Assert.assertNotEquals("1.1.1.1",resolver.resolve("testCachedResolverHost1"));
  Assert.assertEquals("1.1.1.2",resolver.resolve("testCachedResolverHost2"));
  nodesListManager.handle(new NodesListManagerEvent(NodesListManagerEventType.NODE_USABLE,rmnode2));
  Assert.assertNotEquals("1.1.1.1",resolver.resolve("testCachedResolverHost1"));
  Assert.assertNotEquals("1.1.1.2",resolver.resolve("testCachedResolverHost2"));
}
