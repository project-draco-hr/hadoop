{
  FSImageLoader loader=FSImageLoader.load(fsimage);
  ChannelPipeline pipeline=Channels.pipeline();
  pipeline.addLast("channelTracker",new SimpleChannelUpstreamHandler(){
    @Override public void channelOpen(    ChannelHandlerContext ctx,    ChannelStateEvent e) throws Exception {
      allChannels.add(e.getChannel());
    }
  }
);
  pipeline.addLast("httpDecoder",new HttpRequestDecoder());
  pipeline.addLast("requestHandler",new FSImageHandler(loader));
  pipeline.addLast("stringEncoder",new StringEncoder());
  pipeline.addLast("httpEncoder",new HttpResponseEncoder());
  bootstrap.setPipeline(pipeline);
  channel=bootstrap.bind(address);
  allChannels.add(channel);
  address=(InetSocketAddress)channel.getLocalAddress();
  LOG.info("WebImageViewer started. Listening on " + address.toString() + ". Press Ctrl+C to stop the viewer.");
}
