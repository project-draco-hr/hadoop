{
  if (op == PostOpParam.Op.APPEND) {
    final HdfsFileStatus status=namenode.getRpcServer().getFileInfo(path);
    final long len=status.getLen();
    if (len > 0) {
      final LocatedBlocks locations=namenode.getRpcServer().getBlockLocations(path,len - 1,1);
      final int count=locations.locatedBlockCount();
      if (count > 0) {
        return JspHelper.bestNode(locations.get(count - 1));
      }
    }
  }
  return (DatanodeDescriptor)namenode.getNamesystem().getBlockManager().getDatanodeManager().getNetworkTopology().chooseRandom(NodeBase.ROOT);
}
