{
  if (LOG.isTraceEnabled()) {
    LOG.trace(op + ": " + path+ ", ugi="+ ugi+ Param.toSortedString(", ",bufferSize));
  }
  return ugi.doAs(new PrivilegedExceptionAction<Response>(){
    @Override public Response run() throws IOException, URISyntaxException {
      final String fullpath=path.getAbsolutePath();
      final NameNode namenode=(NameNode)context.getAttribute("name.node");
switch (op.getValue()) {
case APPEND:
{
          final URI uri=redirectURI(namenode,ugi,delegation,fullpath,op.getValue(),-1L,bufferSize);
          return Response.temporaryRedirect(uri).build();
        }
default :
      throw new UnsupportedOperationException(op + " is not supported");
  }
}
}
);
}
