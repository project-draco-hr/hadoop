{
  final DirectoryListing firstDirList=getDirectoryListing(np,p,HdfsFileStatus.EMPTY_NAME);
  final UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  return new StreamingOutput(){
    @Override public void write(    final OutputStream outstream) throws IOException {
      final PrintWriter out=new PrintWriter(new OutputStreamWriter(outstream,Charsets.UTF_8));
      out.println("{\"" + FileStatus.class.getSimpleName() + "es\":{\""+ FileStatus.class.getSimpleName()+ "\":[");
      try {
        ugi.doAs(new PrivilegedExceptionAction<Void>(){
          @Override public Void run() throws IOException {
            long n=0;
            for (DirectoryListing dirList=firstDirList; ; dirList=getDirectoryListing(np,p,dirList.getLastName())) {
              for (              HdfsFileStatus s : dirList.getPartialListing()) {
                if (n++ > 0) {
                  out.println(',');
                }
                out.print(JsonUtil.toJsonString(s,false));
              }
              if (!dirList.hasMore()) {
                break;
              }
            }
            return null;
          }
        }
);
      }
 catch (      InterruptedException e) {
        throw new IOException(e);
      }
      out.println();
      out.println("]}}");
      out.flush();
    }
  }
;
}
