{
  renewer=(renewer == null) ? ugi.getShortUserName() : renewer;
  String user=ugi.getUserName();
  Text owner=new Text(user);
  Text realUser=null;
  if (ugi.getRealUser() != null) {
    realUser=new Text(ugi.getRealUser().getUserName());
  }
  DelegationTokenIdentifier tokenIdentifier=new DelegationTokenIdentifier(tokenKind,owner,new Text(renewer),realUser);
  Token<DelegationTokenIdentifier> token=new Token<DelegationTokenIdentifier>(tokenIdentifier,secretManager);
  try {
    SecurityUtil.setTokenService(token,HttpFSServerWebApp.get().getAuthority());
  }
 catch (  ServerException ex) {
    throw new DelegationTokenManagerException(DelegationTokenManagerException.ERROR.DT04,ex.toString(),ex);
  }
  return token;
}
