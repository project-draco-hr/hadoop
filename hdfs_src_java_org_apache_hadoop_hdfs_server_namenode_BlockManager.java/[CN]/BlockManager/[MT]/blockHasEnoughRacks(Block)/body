{
  if (!this.shouldCheckForEnoughRacks) {
    return true;
  }
  boolean enoughRacks=false;
  ;
  Collection<DatanodeDescriptor> corruptNodes=corruptReplicas.getNodes(b);
  int numExpectedReplicas=getReplication(b);
  String rackName=null;
  for (Iterator<DatanodeDescriptor> it=blocksMap.nodeIterator(b); it.hasNext(); ) {
    DatanodeDescriptor cur=it.next();
    if (!cur.isDecommissionInProgress() && !cur.isDecommissioned()) {
      if ((corruptNodes == null) || !corruptNodes.contains(cur)) {
        if (numExpectedReplicas == 1) {
          enoughRacks=true;
          break;
        }
        String rackNameNew=cur.getNetworkLocation();
        if (rackName == null) {
          rackName=rackNameNew;
        }
 else         if (!rackName.equals(rackNameNew)) {
          enoughRacks=true;
          break;
        }
      }
    }
  }
  return enoughRacks;
}
