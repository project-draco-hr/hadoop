{
  assert(storedBlock != null && namesystem.hasWriteLock());
  if (!namesystem.isInStartupSafeMode() || namesystem.isPopulatingReplQueues()) {
    addStoredBlock(storedBlock,node,null,false);
    return;
  }
  node.addBlock(storedBlock);
  int numCurrentReplica=countLiveNodes(storedBlock);
  if (storedBlock.getBlockUCState() == BlockUCState.COMMITTED && numCurrentReplica >= minReplication)   storedBlock=completeBlock(storedBlock.getINode(),storedBlock);
  if (storedBlock.isComplete())   namesystem.incrementSafeBlockCount(numCurrentReplica);
}
