{
  NameNode.stateChangeLog.info("DIR* NameSystem.invalidateBlock: " + blk + " on "+ dn.getName());
  DatanodeDescriptor node=namesystem.getDatanode(dn);
  if (node == null) {
    throw new IOException("Cannot invalidate block " + blk + " because datanode "+ dn.getName()+ " does not exist.");
  }
  int count=countNodes(blk).liveReplicas();
  if (count > 1) {
    addToInvalidates(blk,dn);
    removeStoredBlock(blk,node);
    if (NameNode.stateChangeLog.isDebugEnabled()) {
      NameNode.stateChangeLog.debug("BLOCK* NameSystem.invalidateBlocks: " + blk + " on "+ dn.getName()+ " listed for deletion.");
    }
  }
 else {
    NameNode.stateChangeLog.info("BLOCK* NameSystem.invalidateBlocks: " + blk + " on "+ dn.getName()+ " is the only copy and was not deleted.");
  }
}
