{
  if (!namesystem.isInStartupSafeMode()) {
    return countNodes(b).liveReplicas();
  }
  int live=0;
  Iterator<DatanodeDescriptor> nodeIter=blocksMap.nodeIterator(b);
  Collection<DatanodeDescriptor> nodesCorrupt=corruptReplicas.getNodes(b);
  while (nodeIter.hasNext()) {
    DatanodeDescriptor node=nodeIter.next();
    if ((nodesCorrupt == null) || (!nodesCorrupt.contains(node)))     live++;
  }
  return live;
}
