{
  assertEquals(2,datanodes.length);
  final Socket s=DFSOutputStream.createSocketForPipeline(datanodes[0],datanodes.length,dfsClient);
  final long writeTimeout=dfsClient.getDatanodeWriteTimeout(datanodes.length);
  final DataOutputStream out=new DataOutputStream(new BufferedOutputStream(NetUtils.getOutputStream(s,writeTimeout),DataNode.SMALL_BUFFER_SIZE));
  final DataInputStream in=new DataInputStream(NetUtils.getInputStream(s));
  Sender.opTransferBlock(out,b,dfsClient.clientName,new DatanodeInfo[]{datanodes[1]},new Token<BlockTokenIdentifier>());
  out.flush();
  return BlockOpResponseProto.parseDelimitedFrom(in);
}
