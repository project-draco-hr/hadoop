{
  int curRacks=0;
  int curReplicas=0;
  int curNeededReplicas=0;
  int count=0;
  final int ATTEMPTS=20;
  do {
    Thread.sleep(1000);
    int[] r=NameNodeAdapter.getReplicaInfo(cluster.getNameNode(),b.getLocalBlock());
    curRacks=r[0];
    curReplicas=r[1];
    curNeededReplicas=r[2];
    count++;
  }
 while ((curRacks != racks || curReplicas != replicas || curNeededReplicas != neededReplicas) && count < ATTEMPTS);
  if (count == ATTEMPTS) {
    throw new TimeoutException("Timed out waiting for replication." + " Needed replicas = " + neededReplicas + " Cur needed replicas = "+ curNeededReplicas+ " Replicas = "+ replicas+ " Cur replicas = "+ curReplicas+ " Racks = "+ racks+ " Cur racks = "+ curRacks);
  }
}
