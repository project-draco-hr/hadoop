{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Processing " + event.getTaskAttemptID() + " of type "+ event.getType());
  }
  writeLock.lock();
  try {
    final TaskAttemptStateInternal oldState=getInternalState();
    try {
      stateMachine.doTransition(event.getType(),event);
    }
 catch (    InvalidStateTransitionException e) {
      LOG.error("Can't handle this event at current state for " + this.attemptId,e);
      eventHandler.handle(new JobDiagnosticsUpdateEvent(this.attemptId.getTaskId().getJobId(),"Invalid event " + event.getType() + " on TaskAttempt "+ this.attemptId));
      eventHandler.handle(new JobEvent(this.attemptId.getTaskId().getJobId(),JobEventType.INTERNAL_ERROR));
    }
    if (oldState != getInternalState()) {
      if (getInternalState() == TaskAttemptStateInternal.FAILED) {
        String nodeId=null == this.container ? "Not-assigned" : this.container.getNodeId().toString();
        LOG.info(attemptId + " transitioned from state " + oldState+ " to "+ getInternalState()+ ", event type is "+ event.getType()+ " and nodeId="+ nodeId);
      }
 else {
        LOG.info(attemptId + " TaskAttempt Transitioned from " + oldState+ " to "+ getInternalState());
      }
    }
  }
  finally {
    writeLock.unlock();
  }
}
