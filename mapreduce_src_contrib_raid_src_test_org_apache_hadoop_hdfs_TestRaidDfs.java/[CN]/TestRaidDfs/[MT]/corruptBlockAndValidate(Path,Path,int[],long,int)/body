{
  int repl=1;
  long crc=createTestFilePartialLastBlock(fileSys,srcFile,repl,numBlocks,blockSize);
  long length=fileSys.getFileStatus(srcFile).getLen();
  RaidNode.doRaid(conf,fileSys.getFileStatus(srcFile),destPath,code,new RaidNode.Statistics(),new RaidUtils.DummyProgressable(),false,repl,repl,stripeLength);
  for (  int blockNumToCorrupt : listBlockNumToCorrupt) {
    LOG.info("Corrupt block " + blockNumToCorrupt + " of file "+ srcFile);
    LocatedBlocks locations=getBlockLocations(srcFile);
    corruptBlock(dfs,srcFile,locations.get(blockNumToCorrupt).getBlock(),NUM_DATANODES,true);
  }
  DistributedRaidFileSystem raidfs=getRaidFS();
  assertTrue(validateFile(raidfs,srcFile,length,crc));
  validateLogFile(getRaidFS(),new Path(LOG_DIR));
}
