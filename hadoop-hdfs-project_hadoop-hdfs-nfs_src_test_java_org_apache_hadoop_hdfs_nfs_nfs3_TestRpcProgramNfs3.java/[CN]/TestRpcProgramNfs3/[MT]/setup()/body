{
  String currentUser=System.getProperty("user.name");
  config.set("fs.permissions.umask-mode","u=rwx,g=,o=");
  config.set(DefaultImpersonationProvider.getTestProvider().getProxySuperuserGroupConfKey(currentUser),"*");
  config.set(DefaultImpersonationProvider.getTestProvider().getProxySuperuserIpConfKey(currentUser),"*");
  ProxyUsers.refreshSuperUserGroupsConfiguration(config);
  cluster=new MiniDFSCluster.Builder(config).numDataNodes(1).build();
  cluster.waitActive();
  hdfs=cluster.getFileSystem();
  nn=cluster.getNameNode();
  config.setInt("nfs3.mountd.port",0);
  config.setInt("nfs3.server.port",0);
  config.set("dfs.nfs.exports.allowed.hosts","* rw");
  nfs=new Nfs3(config);
  nfs.startServiceInternal(false);
  nfsd=(RpcProgramNfs3)nfs.getRpcProgram();
  securityHandler=Mockito.mock(SecurityHandler.class);
  Mockito.when(securityHandler.getUser()).thenReturn(currentUser);
  securityHandlerUnpriviledged=Mockito.mock(SecurityHandler.class);
  Mockito.when(securityHandlerUnpriviledged.getUser()).thenReturn("harry");
}
