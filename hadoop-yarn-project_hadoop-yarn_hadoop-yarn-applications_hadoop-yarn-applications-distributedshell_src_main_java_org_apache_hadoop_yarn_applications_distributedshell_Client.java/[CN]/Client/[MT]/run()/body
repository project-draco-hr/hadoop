{
  LOG.info("Running Client");
  start();
  YarnClusterMetrics clusterMetrics=super.getYarnClusterMetrics();
  LOG.info("Got Cluster metric info from ASM" + ", numNodeManagers=" + clusterMetrics.getNumNodeManagers());
  List<NodeReport> clusterNodeReports=super.getNodeReports();
  LOG.info("Got Cluster node info from ASM");
  for (  NodeReport node : clusterNodeReports) {
    LOG.info("Got node report from ASM for" + ", nodeId=" + node.getNodeId() + ", nodeAddress"+ node.getHttpAddress()+ ", nodeRackName"+ node.getRackName()+ ", nodeNumContainers"+ node.getNumContainers());
  }
  QueueInfo queueInfo=super.getQueueInfo(this.amQueue);
  LOG.info("Queue info" + ", queueName=" + queueInfo.getQueueName() + ", queueCurrentCapacity="+ queueInfo.getCurrentCapacity()+ ", queueMaxCapacity="+ queueInfo.getMaximumCapacity()+ ", queueApplicationCount="+ queueInfo.getApplications().size()+ ", queueChildQueueCount="+ queueInfo.getChildQueues().size());
  List<QueueUserACLInfo> listAclInfo=super.getQueueAclsInfo();
  for (  QueueUserACLInfo aclInfo : listAclInfo) {
    for (    QueueACL userAcl : aclInfo.getUserAcls()) {
      LOG.info("User ACL Info for Queue" + ", queueName=" + aclInfo.getQueueName() + ", userAcl="+ userAcl.name());
    }
  }
  GetNewApplicationResponse newApp=super.getNewApplication();
  ApplicationId appId=newApp.getApplicationId();
  int minMem=newApp.getMinimumResourceCapability().getMemory();
  int maxMem=newApp.getMaximumResourceCapability().getMemory();
  LOG.info("Min mem capabililty of resources in this cluster " + minMem);
  LOG.info("Max mem capabililty of resources in this cluster " + maxMem);
  if (amMemory < minMem) {
    LOG.info("AM memory specified below min threshold of cluster. Using min value." + ", specified=" + amMemory + ", min="+ minMem);
    amMemory=minMem;
  }
 else   if (amMemory > maxMem) {
    LOG.info("AM memory specified above max threshold of cluster. Using max value." + ", specified=" + amMemory + ", max="+ maxMem);
    amMemory=maxMem;
  }
  LOG.info("Setting up application submission context for ASM");
  ApplicationSubmissionContext appContext=Records.newRecord(ApplicationSubmissionContext.class);
  appContext.setApplicationId(appId);
  appContext.setApplicationName(appName);
  ContainerLaunchContext amContainer=Records.newRecord(ContainerLaunchContext.class);
  Map<String,LocalResource> localResources=new HashMap<String,LocalResource>();
  LOG.info("Copy App Master jar from local filesystem and add to local environment");
  FileSystem fs=FileSystem.get(conf);
  Path src=new Path(appMasterJar);
  String pathSuffix=appName + "/" + appId.getId()+ "/AppMaster.jar";
  Path dst=new Path(fs.getHomeDirectory(),pathSuffix);
  fs.copyFromLocalFile(false,true,src,dst);
  FileStatus destStatus=fs.getFileStatus(dst);
  LocalResource amJarRsrc=Records.newRecord(LocalResource.class);
  amJarRsrc.setType(LocalResourceType.FILE);
  amJarRsrc.setVisibility(LocalResourceVisibility.APPLICATION);
  amJarRsrc.setResource(ConverterUtils.getYarnUrlFromPath(dst));
  amJarRsrc.setTimestamp(destStatus.getModificationTime());
  amJarRsrc.setSize(destStatus.getLen());
  localResources.put("AppMaster.jar",amJarRsrc);
  if (!log4jPropFile.isEmpty()) {
    Path log4jSrc=new Path(log4jPropFile);
    Path log4jDst=new Path(fs.getHomeDirectory(),"log4j.props");
    fs.copyFromLocalFile(false,true,log4jSrc,log4jDst);
    FileStatus log4jFileStatus=fs.getFileStatus(log4jDst);
    LocalResource log4jRsrc=Records.newRecord(LocalResource.class);
    log4jRsrc.setType(LocalResourceType.FILE);
    log4jRsrc.setVisibility(LocalResourceVisibility.APPLICATION);
    log4jRsrc.setResource(ConverterUtils.getYarnUrlFromURI(log4jDst.toUri()));
    log4jRsrc.setTimestamp(log4jFileStatus.getModificationTime());
    log4jRsrc.setSize(log4jFileStatus.getLen());
    localResources.put("log4j.properties",log4jRsrc);
  }
  String hdfsShellScriptLocation="";
  long hdfsShellScriptLen=0;
  long hdfsShellScriptTimestamp=0;
  if (!shellScriptPath.isEmpty()) {
    Path shellSrc=new Path(shellScriptPath);
    String shellPathSuffix=appName + "/" + appId.getId()+ "/ExecShellScript.sh";
    Path shellDst=new Path(fs.getHomeDirectory(),shellPathSuffix);
    fs.copyFromLocalFile(false,true,shellSrc,shellDst);
    hdfsShellScriptLocation=shellDst.toUri().toString();
    FileStatus shellFileStatus=fs.getFileStatus(shellDst);
    hdfsShellScriptLen=shellFileStatus.getLen();
    hdfsShellScriptTimestamp=shellFileStatus.getModificationTime();
  }
  amContainer.setLocalResources(localResources);
  LOG.info("Set the environment for the application master");
  Map<String,String> env=new HashMap<String,String>();
  env.put(DSConstants.DISTRIBUTEDSHELLSCRIPTLOCATION,hdfsShellScriptLocation);
  env.put(DSConstants.DISTRIBUTEDSHELLSCRIPTTIMESTAMP,Long.toString(hdfsShellScriptTimestamp));
  env.put(DSConstants.DISTRIBUTEDSHELLSCRIPTLEN,Long.toString(hdfsShellScriptLen));
  StringBuilder classPathEnv=new StringBuilder(Environment.CLASSPATH.$()).append(File.pathSeparatorChar).append("./*");
  for (  String c : conf.getStrings(YarnConfiguration.YARN_APPLICATION_CLASSPATH,YarnConfiguration.DEFAULT_YARN_APPLICATION_CLASSPATH)) {
    classPathEnv.append(File.pathSeparatorChar);
    classPathEnv.append(c.trim());
  }
  classPathEnv.append(File.pathSeparatorChar).append("./log4j.properties");
  if (conf.getBoolean(YarnConfiguration.IS_MINI_YARN_CLUSTER,false)) {
    classPathEnv.append(':');
    classPathEnv.append(System.getProperty("java.class.path"));
  }
  env.put("CLASSPATH",classPathEnv.toString());
  amContainer.setEnvironment(env);
  Vector<CharSequence> vargs=new Vector<CharSequence>(30);
  LOG.info("Setting up app master command");
  vargs.add(Environment.JAVA_HOME.$() + "/bin/java");
  vargs.add("-Xmx" + amMemory + "m");
  vargs.add(appMasterMainClass);
  vargs.add("--container_memory " + String.valueOf(containerMemory));
  vargs.add("--num_containers " + String.valueOf(numContainers));
  vargs.add("--priority " + String.valueOf(shellCmdPriority));
  if (!shellCommand.isEmpty()) {
    vargs.add("--shell_command " + shellCommand + "");
  }
  if (!shellArgs.isEmpty()) {
    vargs.add("--shell_args " + shellArgs + "");
  }
  for (  Map.Entry<String,String> entry : shellEnv.entrySet()) {
    vargs.add("--shell_env " + entry.getKey() + "="+ entry.getValue());
  }
  if (debugFlag) {
    vargs.add("--debug");
  }
  vargs.add("1>" + ApplicationConstants.LOG_DIR_EXPANSION_VAR + "/AppMaster.stdout");
  vargs.add("2>" + ApplicationConstants.LOG_DIR_EXPANSION_VAR + "/AppMaster.stderr");
  StringBuilder command=new StringBuilder();
  for (  CharSequence str : vargs) {
    command.append(str).append(" ");
  }
  LOG.info("Completed setting up app master command " + command.toString());
  List<String> commands=new ArrayList<String>();
  commands.add(command.toString());
  amContainer.setCommands(commands);
  Resource capability=Records.newRecord(Resource.class);
  capability.setMemory(amMemory);
  appContext.setResource(capability);
  appContext.setAMContainerSpec(amContainer);
  Priority pri=Records.newRecord(Priority.class);
  pri.setPriority(amPriority);
  appContext.setPriority(pri);
  appContext.setQueue(amQueue);
  LOG.info("Submitting application to ASM");
  super.submitApplication(appContext);
  return monitorApplication(appId);
}
