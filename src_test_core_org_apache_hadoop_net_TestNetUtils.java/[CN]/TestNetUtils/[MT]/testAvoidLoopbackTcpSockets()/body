{
  Configuration conf=new Configuration();
  Socket socket=NetUtils.getDefaultSocketFactory(conf).createSocket();
  socket.bind(new InetSocketAddress("127.0.0.1",0));
  System.err.println("local address: " + socket.getLocalAddress());
  System.err.println("local port: " + socket.getLocalPort());
  try {
    NetUtils.connect(socket,new InetSocketAddress(socket.getLocalAddress(),socket.getLocalPort()),20000);
    socket.close();
    fail("Should not have connected");
  }
 catch (  ConnectException ce) {
    System.err.println("Got exception: " + ce);
    assertTrue(ce.getMessage().contains("resulted in a loopback"));
  }
}
