{
  AuthenticationToken token;
  String userName=getUserName(request);
  if (userName == null) {
    if (getAcceptAnonymous()) {
      token=AuthenticationToken.ANONYMOUS;
    }
 else {
      response.setStatus(HttpServletResponse.SC_FORBIDDEN);
      response.setHeader(WWW_AUTHENTICATE,PSEUDO_AUTH);
      token=null;
    }
  }
 else {
    token=new AuthenticationToken(userName,userName,getType());
  }
  return token;
}
