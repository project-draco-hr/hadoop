{
  final String containerIdStr=containerId.toString();
  final ApplicationAttemptId appAttemptId=containerId.getApplicationAttemptId();
  final ApplicationId appId=appAttemptId.getApplicationId();
  final String appIdStr=appId.toString();
  final String filename="logfile1";
  final String logMessage="log message\n";
  nmContext.getApplications().put(appId,new ApplicationImpl(null,"user",null,null,appId,null,nmContext));
  MockContainer container=new MockContainer(appAttemptId,new AsyncDispatcher(),new Configuration(),"user",appId,1);
  container.setState(ContainerState.RUNNING);
  nmContext.getContainers().put(containerId,container);
  Path path=dirsHandler.getLogPathForWrite(ContainerLaunch.getRelativeContainerLogDir(appIdStr,containerIdStr) + "/" + filename,false);
  File logFile=new File(path.toUri().getPath());
  logFile.deleteOnExit();
  assertTrue("Failed to create log dir",logFile.getParentFile().mkdirs());
  PrintWriter pw=new PrintWriter(logFile);
  pw.print(logMessage);
  pw.close();
  ClientResponse response=r.path(filename).accept(MediaType.TEXT_PLAIN).get(ClientResponse.class);
  String responseText=response.getEntity(String.class);
  assertEquals(logMessage,responseText);
  int fullTextSize=responseText.getBytes().length;
  response=r.path(filename).queryParam("size","5").accept(MediaType.TEXT_PLAIN).get(ClientResponse.class);
  responseText=response.getEntity(String.class);
  assertEquals(5,responseText.getBytes().length);
  assertEquals(new String(logMessage.getBytes(),0,5),responseText);
  assertTrue(fullTextSize >= responseText.getBytes().length);
  response=r.path(filename).queryParam("size","10000").accept(MediaType.TEXT_PLAIN).get(ClientResponse.class);
  responseText=response.getEntity(String.class);
  assertEquals(fullTextSize,responseText.getBytes().length);
  assertEquals(logMessage,responseText);
  response=r.path(filename).queryParam("size","-5").accept(MediaType.TEXT_PLAIN).get(ClientResponse.class);
  responseText=response.getEntity(String.class);
  assertEquals(5,responseText.getBytes().length);
  assertEquals(new String(logMessage.getBytes(),logMessage.getBytes().length - 5,5),responseText);
  assertTrue(fullTextSize >= responseText.getBytes().length);
  response=r.path(filename).queryParam("size","-10000").accept(MediaType.TEXT_PLAIN).get(ClientResponse.class);
  responseText=response.getEntity(String.class);
  assertEquals("text/plain",response.getType().toString());
  assertEquals(fullTextSize,responseText.getBytes().length);
  assertEquals(logMessage,responseText);
  response=r.path(filename).queryParam("format","octet-stream").accept(MediaType.TEXT_PLAIN).get(ClientResponse.class);
  responseText=response.getEntity(String.class);
  assertEquals(logMessage,responseText);
  assertEquals(200,response.getStatus());
  assertEquals("application/octet-stream",response.getType().toString());
  response=r.path(filename).queryParam("format","123").accept(MediaType.TEXT_PLAIN).get(ClientResponse.class);
  responseText=response.getEntity(String.class);
  assertEquals("The valid values for the parameter : format are " + WebAppUtils.listSupportedLogContentType(),responseText);
  assertEquals(400,response.getStatus());
  response=r.path("uhhh").accept(MediaType.TEXT_PLAIN).get(ClientResponse.class);
  assertEquals(Status.NOT_FOUND.getStatusCode(),response.getStatus());
  responseText=response.getEntity(String.class);
  assertTrue(responseText.contains("Cannot find this log on the local disk."));
  WebResource r1=resource();
  response=r1.path("ws").path("v1").path("node").path("containers").path(containerIdStr).path("logs").accept(MediaType.APPLICATION_JSON).get(ClientResponse.class);
  assertEquals(200,response.getStatus());
  JSONObject json=response.getEntity(JSONObject.class);
  assertEquals(json.getJSONObject("containerLogInfo").getString("fileName"),filename);
  nmContext.getContainers().remove(containerId);
  Assert.assertNull(nmContext.getContainers().get(containerId));
  response=r.path(filename).accept(MediaType.TEXT_PLAIN).get(ClientResponse.class);
  responseText=response.getEntity(String.class);
  assertEquals(logMessage,responseText);
}
