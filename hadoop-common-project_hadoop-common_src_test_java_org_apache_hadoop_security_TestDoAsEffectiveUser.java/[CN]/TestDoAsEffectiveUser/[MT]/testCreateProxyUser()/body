{
  UserGroupInformation realUserUgi=UserGroupInformation.createRemoteUser(REAL_USER_NAME);
  UserGroupInformation proxyUserUgi=UserGroupInformation.createProxyUser(PROXY_USER_NAME,realUserUgi);
  UserGroupInformation curUGI=proxyUserUgi.doAs(new PrivilegedExceptionAction<UserGroupInformation>(){
    public UserGroupInformation run() throws IOException {
      return UserGroupInformation.getCurrentUser();
    }
  }
);
  Assert.assertTrue(curUGI.toString().equals(PROXY_USER_NAME + " via " + REAL_USER_NAME));
}
