{
  if (compressed == null) {
    ByteArrayOutputStream deflated=new ByteArrayOutputStream();
    Deflater deflater=new Deflater(Deflater.BEST_SPEED);
    DataOutputStream dout=new DataOutputStream(new DeflaterOutputStream(deflated,deflater));
    writeCompressed(dout);
    dout.close();
    deflater.end();
    compressed=deflated.toByteArray();
  }
  out.writeInt(compressed.length);
  out.write(compressed);
}
