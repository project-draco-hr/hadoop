{
  final DistributedFileSystem dfs=cluster.getFileSystem();
  final Credentials creds=new Credentials();
  final Token<?> tokens[]=dfs.addDelegationTokens("JobTracker",creds);
  Assert.assertEquals(1,tokens.length);
  @SuppressWarnings("unchecked") final Token<DelegationTokenIdentifier> token=(Token<DelegationTokenIdentifier>)tokens[0];
  final UserGroupInformation longUgi=UserGroupInformation.createRemoteUser("JobTracker/foo.com@FOO.COM");
  final UserGroupInformation shortUgi=UserGroupInformation.createRemoteUser("JobTracker");
  longUgi.doAs(new PrivilegedExceptionAction<Object>(){
    @Override public Object run() throws IOException {
      final DistributedFileSystem dfs=cluster.getFileSystem();
      try {
        dfs.renewDelegationToken(token);
      }
 catch (      IOException e) {
        Assert.fail("Could not renew delegation token for user " + longUgi);
      }
      return null;
    }
  }
);
  shortUgi.doAs(new PrivilegedExceptionAction<Object>(){
    @Override public Object run() throws IOException {
      final DistributedFileSystem dfs=cluster.getFileSystem();
      dfs.renewDelegationToken(token);
      return null;
    }
  }
);
  longUgi.doAs(new PrivilegedExceptionAction<Object>(){
    @Override public Object run() throws IOException {
      final DistributedFileSystem dfs=cluster.getFileSystem();
      try {
        dfs.cancelDelegationToken(token);
      }
 catch (      IOException e) {
        Assert.fail("Could not cancel delegation token for user " + longUgi);
      }
      return null;
    }
  }
);
}
