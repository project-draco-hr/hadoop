{
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).nnTopology(MiniDFSNNTopology.simpleHATopology()).numDataNodes(0).build();
    for (int i=0; i < 2; i++) {
      for (      URI uri : cluster.getNameDirs(i)) {
        File prevTmp=new File(new File(uri),Storage.STORAGE_TMP_PREVIOUS);
        LOG.info("creating previous tmp dir: " + prevTmp);
        assertTrue(prevTmp.mkdirs());
      }
    }
    cluster.restartNameNodes();
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
