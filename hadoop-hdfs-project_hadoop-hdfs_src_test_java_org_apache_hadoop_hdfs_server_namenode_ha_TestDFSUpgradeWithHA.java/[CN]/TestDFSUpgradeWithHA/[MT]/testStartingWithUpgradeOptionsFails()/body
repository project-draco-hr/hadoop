{
  for (  StartupOption startOpt : Lists.newArrayList(new StartupOption[]{StartupOption.UPGRADE,StartupOption.FINALIZE,StartupOption.ROLLBACK})) {
    MiniDFSCluster cluster=null;
    try {
      cluster=new MiniDFSCluster.Builder(new Configuration()).nnTopology(MiniDFSNNTopology.simpleHATopology()).startupOption(startOpt).numDataNodes(0).build();
      fail("Should not have been able to start an HA NN in upgrade mode");
    }
 catch (    IllegalArgumentException iae) {
      GenericTestUtils.assertExceptionContains("Cannot perform DFS upgrade with HA enabled.",iae);
      LOG.info("Got expected exception",iae);
    }
 finally {
      if (cluster != null) {
        cluster.shutdown();
      }
    }
  }
}
