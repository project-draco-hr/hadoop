{
  this.scheduler=cs;
  this.queueName=queueName;
  this.parent=parent;
  this.metrics=old != null ? old.getMetrics() : QueueMetrics.forQueue(getQueuePath(),parent,cs.getConfiguration().getEnableUserMetrics());
  this.activeUsersManager=new ActiveUsersManager(metrics);
  this.minimumAllocation=cs.getMinimumResourceCapability();
  this.maximumAllocation=cs.getMaximumResourceCapability();
  this.minimumAllocationFactor=(float)(maximumAllocation.getMemory() - minimumAllocation.getMemory()) / maximumAllocation.getMemory();
  this.containerTokenSecretManager=cs.getContainerTokenSecretManager();
  float capacity=(float)cs.getConfiguration().getCapacity(getQueuePath()) / 100;
  float absoluteCapacity=parent.getAbsoluteCapacity() * capacity;
  float maximumCapacity=(float)cs.getConfiguration().getMaximumCapacity(getQueuePath()) / 100;
  float absoluteMaxCapacity=CSQueueUtils.computeAbsoluteMaximumCapacity(maximumCapacity,parent);
  int userLimit=cs.getConfiguration().getUserLimit(getQueuePath());
  float userLimitFactor=cs.getConfiguration().getUserLimitFactor(getQueuePath());
  int maxSystemJobs=cs.getConfiguration().getMaximumSystemApplications();
  int maxApplications=(int)(maxSystemJobs * absoluteCapacity);
  int maxApplicationsPerUser=(int)(maxApplications * (userLimit / 100.0f) * userLimitFactor);
  this.maxAMResourcePercent=cs.getConfiguration().getMaximumApplicationMasterResourcePercent();
  int maxActiveApplications=CSQueueUtils.computeMaxActiveApplications(cs.getClusterResources(),this.minimumAllocation,maxAMResourcePercent,absoluteMaxCapacity);
  int maxActiveApplicationsPerUser=CSQueueUtils.computeMaxActiveApplicationsPerUser(maxActiveApplications,userLimit,userLimitFactor);
  this.queueInfo=recordFactory.newRecordInstance(QueueInfo.class);
  this.queueInfo.setQueueName(queueName);
  this.queueInfo.setChildQueues(new ArrayList<QueueInfo>());
  QueueState state=cs.getConfiguration().getState(getQueuePath());
  Map<QueueACL,AccessControlList> acls=cs.getConfiguration().getAcls(getQueuePath());
  setupQueueConfigs(capacity,absoluteCapacity,maximumCapacity,absoluteMaxCapacity,userLimit,userLimitFactor,maxApplications,maxApplicationsPerUser,maxActiveApplications,maxActiveApplicationsPerUser,state,acls);
  if (LOG.isDebugEnabled()) {
    LOG.debug("LeafQueue:" + " name=" + queueName + ", fullname="+ getQueuePath());
  }
  this.pendingApplications=new TreeSet<SchedulerApp>(applicationComparator);
  this.activeApplications=new TreeSet<SchedulerApp>(applicationComparator);
}
