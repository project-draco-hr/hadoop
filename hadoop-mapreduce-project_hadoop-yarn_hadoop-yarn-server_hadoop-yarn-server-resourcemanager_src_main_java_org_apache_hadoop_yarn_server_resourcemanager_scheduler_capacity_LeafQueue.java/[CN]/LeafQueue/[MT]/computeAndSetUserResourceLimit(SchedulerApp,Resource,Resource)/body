{
  String user=application.getUser();
  Resource limit=computeUserLimit(application,clusterResource,required);
  Resource headroom=Resources.subtract(limit,getUser(user).getConsumedResources());
  application.setHeadroom(headroom);
  metrics.setAvailableResourcesToUser(user,headroom);
  return limit;
}
