{
  String user=application.getUser();
  Resource userLimit=computeUserLimit(application,clusterResource,required);
  Resource queueMaxCap=Resources.createResource(roundDown((int)(absoluteMaxCapacity * clusterResource.getMemory())));
  Resource userConsumed=getUser(user).getConsumedResources();
  Resource headroom=Resources.subtract(Resources.min(userLimit,queueMaxCap),userConsumed);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Headroom calculation for user " + user + ": "+ " userLimit="+ userLimit+ " queueMaxCap="+ queueMaxCap+ " consumed="+ userConsumed+ " headroom="+ headroom);
  }
  application.setHeadroom(headroom);
  metrics.setAvailableResourcesToUser(user,headroom);
  return userLimit;
}
