{
  final Path foo=new Path("/foo");
  final Path bar1=new Path(foo,"bar1");
  final Path bar2=new Path(foo,"bar2");
  hdfs.mkdirs(bar1);
  hdfs.mkdirs(bar2);
  hdfs.allowSnapshot(bar1);
  hdfs.allowSnapshot(bar2);
  assertEquals(2,cluster.getNamesystem().getSnapshotManager().getNumSnapshottableDirs());
  assertEquals(2,cluster.getNamesystem().getSnapshotManager().getSnapshottableDirs().length);
  hdfs.delete(foo,true);
  cluster.restartNameNode(0);
  assertEquals(0,cluster.getNamesystem().getSnapshotManager().getNumSnapshottableDirs());
  assertEquals(0,cluster.getNamesystem().getSnapshotManager().getSnapshottableDirs().length);
  hdfs.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
  hdfs.saveNamespace();
  hdfs.setSafeMode(SafeModeAction.SAFEMODE_LEAVE);
  cluster.restartNameNode(0);
}
