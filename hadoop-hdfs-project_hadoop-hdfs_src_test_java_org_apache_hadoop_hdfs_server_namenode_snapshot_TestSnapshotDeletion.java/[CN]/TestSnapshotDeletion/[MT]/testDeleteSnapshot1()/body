{
  final Path root=new Path("/");
  Path dir=new Path("/dir1");
  Path file1=new Path(dir,"file1");
  DFSTestUtil.createFile(hdfs,file1,BLOCKSIZE,REPLICATION,seed);
  hdfs.allowSnapshot(root);
  hdfs.createSnapshot(root,"s1");
  Path file2=new Path(dir,"file2");
  DFSTestUtil.createFile(hdfs,file2,BLOCKSIZE,REPLICATION,seed);
  hdfs.createSnapshot(root,"s2");
  hdfs.delete(file1,true);
  hdfs.delete(file2,true);
  assertTrue(hdfs.delete(dir,false));
  hdfs.deleteSnapshot(root,"s2");
  NameNodeAdapter.enterSafeMode(cluster.getNameNode(),false);
  NameNodeAdapter.saveNamespace(cluster.getNameNode());
  cluster.restartNameNodes();
}
