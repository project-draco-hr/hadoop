{
  final Path st=new Path("/st");
  final Path nonst=new Path("/nonst");
  final Path stY=new Path(st,"y");
  final Path nonstTrash=new Path(nonst,"trash");
  hdfs.mkdirs(stY);
  hdfs.allowSnapshot(st);
  hdfs.createSnapshot(st,"s0");
  Path f=new Path(stY,"nn.log");
  hdfs.createNewFile(f);
  hdfs.createSnapshot(st,"s1");
  Path f2=new Path(stY,"nn2.log");
  hdfs.rename(f,f2);
  hdfs.createSnapshot(st,"s2");
  Path trashSt=new Path(nonstTrash,"st");
  hdfs.mkdirs(trashSt);
  hdfs.rename(stY,trashSt);
  hdfs.delete(nonstTrash,true);
  hdfs.deleteSnapshot(st,"s1");
  hdfs.deleteSnapshot(st,"s2");
  hdfs.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
  hdfs.saveNamespace();
  hdfs.setSafeMode(SafeModeAction.SAFEMODE_LEAVE);
  cluster.restartNameNodes();
}
