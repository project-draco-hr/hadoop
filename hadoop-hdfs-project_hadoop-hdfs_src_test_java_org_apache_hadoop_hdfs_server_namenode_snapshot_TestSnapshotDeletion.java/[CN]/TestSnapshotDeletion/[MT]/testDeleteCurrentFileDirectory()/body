{
  Path deleteDir=new Path(subsub,"deleteDir");
  Path deleteFile=new Path(deleteDir,"deleteFile");
  Path noChangeDirParent=new Path(sub,"noChangeDirParent");
  Path noChangeDir=new Path(noChangeDirParent,"noChangeDir");
  Path noChangeFile=new Path(noChangeDir,"noChangeFile");
  DFSTestUtil.createFile(hdfs,deleteFile,BLOCKSIZE,REPLICATION,seed);
  DFSTestUtil.createFile(hdfs,noChangeFile,BLOCKSIZE,REPLICATION,seed);
  Path metaChangeFile1=new Path(subsub,"metaChangeFile1");
  DFSTestUtil.createFile(hdfs,metaChangeFile1,BLOCKSIZE,REPLICATION,seed);
  Path metaChangeFile2=new Path(noChangeDir,"metaChangeFile2");
  DFSTestUtil.createFile(hdfs,metaChangeFile2,BLOCKSIZE,REPLICATION,seed);
  hdfs.delete(deleteDir,true);
  SnapshotTestHelper.createSnapshot(hdfs,dir,"s0");
  Path newFileAfterS0=new Path(subsub,"newFile");
  DFSTestUtil.createFile(hdfs,newFileAfterS0,BLOCKSIZE,REPLICATION,seed);
  hdfs.setReplication(metaChangeFile1,REPLICATION_1);
  hdfs.setReplication(metaChangeFile2,REPLICATION_1);
  SnapshotTestHelper.createSnapshot(hdfs,dir,"s1");
  Snapshot snapshot0=((INodeDirectorySnapshottable)fsdir.getINode(dir.toString())).getSnapshot(DFSUtil.string2Bytes("s0"));
  Snapshot snapshot1=((INodeDirectorySnapshottable)fsdir.getINode(dir.toString())).getSnapshot(DFSUtil.string2Bytes("s1"));
  hdfs.delete(noChangeDirParent,true);
  Path snapshotNoChangeDir=SnapshotTestHelper.getSnapshotPath(dir,"s1",sub.getName() + "/" + noChangeDirParent.getName()+ "/"+ noChangeDir.getName());
  INodeDirectory snapshotNode=(INodeDirectory)fsdir.getINode(snapshotNoChangeDir.toString());
  assertEquals(INodeDirectory.class,snapshotNode.getClass());
  ReadOnlyList<INode> children=snapshotNode.getChildrenList(null);
  assertEquals(2,children.size());
  INode noChangeFileSCopy=children.get(1);
  assertEquals(noChangeFile.getName(),noChangeFileSCopy.getLocalName());
  assertEquals(INodeFile.class,noChangeFileSCopy.getClass());
  INodeFileWithSnapshot metaChangeFile2SCopy=(INodeFileWithSnapshot)children.get(0);
  assertEquals(metaChangeFile2.getName(),metaChangeFile2SCopy.getLocalName());
  assertEquals(INodeFileWithSnapshot.class,metaChangeFile2SCopy.getClass());
  assertEquals(REPLICATION_1,metaChangeFile2SCopy.getFileReplication(null));
  assertEquals(REPLICATION_1,metaChangeFile2SCopy.getFileReplication(snapshot1));
  assertEquals(REPLICATION,metaChangeFile2SCopy.getFileReplication(snapshot0));
  Path newFile=new Path(sub,"newFile");
  DFSTestUtil.createFile(hdfs,newFile,BLOCKSIZE,REPLICATION,seed);
  hdfs.delete(sub,true);
  Path snapshotSub=SnapshotTestHelper.getSnapshotPath(dir,"s1",sub.getName());
  INodeDirectoryWithSnapshot snapshotNode4Sub=(INodeDirectoryWithSnapshot)fsdir.getINode(snapshotSub.toString());
  assertEquals(INodeDirectoryWithSnapshot.class,snapshotNode4Sub.getClass());
  assertEquals(1,snapshotNode4Sub.getChildrenList(null).size());
  assertEquals(2,snapshotNode4Sub.getChildrenList(snapshot1).size());
  INode snapshotNode4Subsub=snapshotNode4Sub.getChildrenList(null).get(0);
  assertEquals(INodeDirectoryWithSnapshot.class,snapshotNode4Subsub.getClass());
  assertTrue(snapshotNode4Sub == snapshotNode4Subsub.getParent());
  INodeDirectory snapshotSubsubDir=(INodeDirectory)snapshotNode4Subsub;
  children=snapshotSubsubDir.getChildrenList(null);
  assertEquals(2,children.size());
  assertEquals(children.get(0).getLocalName(),metaChangeFile1.getName());
  assertEquals(children.get(1).getLocalName(),newFileAfterS0.getName());
  children=snapshotSubsubDir.getChildrenList(snapshot0);
  assertEquals(1,children.size());
  INode child=children.get(0);
  assertEquals(child.getLocalName(),metaChangeFile1.getName());
  assertEquals(INodeFileWithSnapshot.class,child.getClass());
  INodeFileWithSnapshot metaChangeFile1SCopy=(INodeFileWithSnapshot)child;
  assertEquals(REPLICATION_1,metaChangeFile1SCopy.getFileReplication(null));
  assertEquals(REPLICATION_1,metaChangeFile1SCopy.getFileReplication(snapshot1));
  assertEquals(REPLICATION,metaChangeFile1SCopy.getFileReplication(snapshot0));
}
