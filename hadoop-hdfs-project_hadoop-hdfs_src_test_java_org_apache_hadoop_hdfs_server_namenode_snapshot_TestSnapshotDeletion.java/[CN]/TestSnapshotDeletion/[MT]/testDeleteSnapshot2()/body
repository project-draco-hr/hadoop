{
  final Path root=new Path("/");
  Path dir=new Path("/dir1");
  Path file1=new Path(dir,"file1");
  DFSTestUtil.createFile(hdfs,file1,BLOCKSIZE,REPLICATION,seed);
  hdfs.allowSnapshot(root);
  hdfs.createSnapshot(root,"s1");
  Path file2=new Path(dir,"file2");
  DFSTestUtil.createFile(hdfs,file2,BLOCKSIZE,REPLICATION,seed);
  INodeFile file2Node=fsdir.getINode(file2.toString()).asFile();
  long file2NodeId=file2Node.getId();
  hdfs.createSnapshot(root,"s2");
  assertTrue(hdfs.delete(dir,true));
  assertNotNull(fsdir.getInode(file2NodeId));
  hdfs.deleteSnapshot(root,"s2");
  assertTrue(fsdir.getInode(file2NodeId) == null);
  NameNodeAdapter.enterSafeMode(cluster.getNameNode(),false);
  NameNodeAdapter.saveNamespace(cluster.getNameNode());
  cluster.restartNameNodes();
}
