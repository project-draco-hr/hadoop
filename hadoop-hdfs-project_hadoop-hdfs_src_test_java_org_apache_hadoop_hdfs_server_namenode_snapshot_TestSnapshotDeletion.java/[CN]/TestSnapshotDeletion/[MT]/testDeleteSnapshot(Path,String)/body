{
  Path modDir=modDirStr.isEmpty() ? snapshotRoot : new Path(snapshotRoot,modDirStr);
  Path file10=new Path(modDir,"file10");
  Path file11=new Path(modDir,"file11");
  Path file12=new Path(modDir,"file12");
  Path file13=new Path(modDir,"file13");
  Path file14=new Path(modDir,"file14");
  Path file15=new Path(modDir,"file15");
  final short REP_1=REPLICATION - 1;
  DFSTestUtil.createFile(hdfs,file10,BLOCKSIZE,REP_1,seed);
  DFSTestUtil.createFile(hdfs,file11,BLOCKSIZE,REP_1,seed);
  DFSTestUtil.createFile(hdfs,file12,BLOCKSIZE,REP_1,seed);
  DFSTestUtil.createFile(hdfs,file13,BLOCKSIZE,REP_1,seed);
  hdfs.allowSnapshot(snapshotRoot.toString());
  hdfs.createSnapshot(snapshotRoot,"s1");
  hdfs.delete(file11,true);
  hdfs.setReplication(file12,REPLICATION);
  hdfs.setReplication(file13,REPLICATION);
  DFSTestUtil.createFile(hdfs,file14,BLOCKSIZE,REPLICATION,seed);
  DFSTestUtil.createFile(hdfs,file15,BLOCKSIZE,REPLICATION,seed);
  hdfs.createSnapshot(snapshotRoot,"s2");
  DFSTestUtil.createFile(hdfs,file11,BLOCKSIZE,REPLICATION,seed);
  hdfs.delete(file12,true);
  hdfs.setReplication(file13,(short)(REPLICATION - 2));
  hdfs.delete(file14,true);
  hdfs.setReplication(file15,REP_1);
  hdfs.createSnapshot(snapshotRoot,"s3");
  hdfs.setReplication(file10,REP_1);
  Path file10_s1=SnapshotTestHelper.getSnapshotPath(snapshotRoot,"s1",modDirStr + "file10");
  Path file11_s1=SnapshotTestHelper.getSnapshotPath(snapshotRoot,"s1",modDirStr + "file11");
  Path file12_s1=SnapshotTestHelper.getSnapshotPath(snapshotRoot,"s1",modDirStr + "file12");
  Path file13_s1=SnapshotTestHelper.getSnapshotPath(snapshotRoot,"s1",modDirStr + "file13");
  FileStatus statusBeforeDeletion10=hdfs.getFileStatus(file10_s1);
  FileStatus statusBeforeDeletion11=hdfs.getFileStatus(file11_s1);
  FileStatus statusBeforeDeletion12=hdfs.getFileStatus(file12_s1);
  FileStatus statusBeforeDeletion13=hdfs.getFileStatus(file13_s1);
  hdfs.deleteSnapshot(snapshotRoot,"s2");
  FileStatus statusAfterDeletion10=hdfs.getFileStatus(file10_s1);
  FileStatus statusAfterDeletion11=hdfs.getFileStatus(file11_s1);
  FileStatus statusAfterDeletion12=hdfs.getFileStatus(file12_s1);
  FileStatus statusAfterDeletion13=hdfs.getFileStatus(file13_s1);
  assertEquals(statusBeforeDeletion10.toString(),statusAfterDeletion10.toString());
  assertEquals(statusBeforeDeletion11.toString(),statusAfterDeletion11.toString());
  assertEquals(statusBeforeDeletion12.toString(),statusAfterDeletion12.toString());
  assertEquals(statusBeforeDeletion13.toString(),statusAfterDeletion13.toString());
  Path file14_s1=SnapshotTestHelper.getSnapshotPath(snapshotRoot,"s1",modDirStr + "file14");
  assertFalse(hdfs.exists(file14_s1));
  Path file15_s1=SnapshotTestHelper.getSnapshotPath(snapshotRoot,"s1",modDirStr + "file15");
  assertFalse(hdfs.exists(file15_s1));
  INodeFile nodeFile13=(INodeFile)fsdir.getINode(file13.toString());
  assertEquals(REP_1,nodeFile13.getBlockReplication());
  INodeFile nodeFile12=(INodeFile)fsdir.getINode(file12_s1.toString());
  assertEquals(REP_1,nodeFile12.getBlockReplication());
}
