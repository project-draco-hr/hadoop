{
  Configuration conf=new Configuration();
  Assert.assertFalse(conf.getBoolean(DistCpOptionSwitch.DIFF.getConfigLabel(),false));
  DistCpOptions options=OptionsParser.parse(new String[]{"-update","-diff","s1","s2","hdfs://localhost:9820/source/first","hdfs://localhost:9820/target/"});
  options.appendToConf(conf);
  Assert.assertTrue(conf.getBoolean(DistCpOptionSwitch.DIFF.getConfigLabel(),false));
  Assert.assertTrue(options.shouldUseDiff());
  Assert.assertEquals("s1",options.getFromSnapshot());
  Assert.assertEquals("s2",options.getToSnapshot());
  options=OptionsParser.parse(new String[]{"-diff","s1",".","-update","hdfs://localhost:9820/source/first","hdfs://localhost:9820/target/"});
  options.appendToConf(conf);
  Assert.assertTrue(conf.getBoolean(DistCpOptionSwitch.DIFF.getConfigLabel(),false));
  Assert.assertTrue(options.shouldUseDiff());
  Assert.assertEquals("s1",options.getFromSnapshot());
  Assert.assertEquals(".",options.getToSnapshot());
  try {
    OptionsParser.parse(new String[]{"-diff","s1","-update","hdfs://localhost:9820/source/first","hdfs://localhost:9820/target/"});
    fail("-diff should fail with only one snapshot name");
  }
 catch (  IllegalArgumentException e) {
    GenericTestUtils.assertExceptionContains("Must provide both the starting and ending snapshot names",e);
  }
  try {
    OptionsParser.parse(new String[]{"-diff","s1","s2","hdfs://localhost:9820/source/first","hdfs://localhost:9820/target/"});
    fail("-diff should fail if -update option is not specified");
  }
 catch (  IllegalArgumentException e) {
    GenericTestUtils.assertExceptionContains("Diff is valid only with update options",e);
  }
  try {
    OptionsParser.parse(new String[]{"-diff","s1","s2","-update","-delete","hdfs://localhost:9820/source/first","hdfs://localhost:9820/target/"});
    fail("-diff should fail if -delete option is specified");
  }
 catch (  IllegalArgumentException e) {
    GenericTestUtils.assertExceptionContains("Diff is valid only with update options",e);
  }
  try {
    OptionsParser.parse(new String[]{"-diff","s1","s2","-delete","-overwrite","hdfs://localhost:9820/source/first","hdfs://localhost:9820/target/"});
    fail("-diff should fail if -update option is not specified");
  }
 catch (  IllegalArgumentException e) {
    GenericTestUtils.assertExceptionContains("Diff is valid only with update options",e);
  }
}
