{
  int count=0;
  while (true) {
    FsImageProto.INodeDirectorySection.DirEntry e=FsImageProto.INodeDirectorySection.DirEntry.parseDelimitedFrom(in);
    if (e == null) {
      break;
    }
    count++;
    if (LOG.isDebugEnabled() && count % 10000 == 0) {
      LOG.debug("Scanned {} directories.",count);
    }
    long parentId=e.getParent();
    for (int i=0; i < e.getChildrenCount(); i++) {
      long childId=e.getChildren(i);
      metadataMap.putDirChild(parentId,childId);
    }
    Preconditions.checkState(e.getRefChildrenCount() == 0);
  }
  LOG.info("Scanned {} INode directories to build namespace.",count);
}
