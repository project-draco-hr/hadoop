{
  if (!isNativeCodeLoaded()) {
    throw new RuntimeException("native lz4 library not available");
  }
  int bufferSize=conf.getInt(CommonConfigurationKeys.IO_COMPRESSION_CODEC_LZ4_BUFFERSIZE_KEY,CommonConfigurationKeys.IO_COMPRESSION_CODEC_LZ4_BUFFERSIZE_DEFAULT);
  int compressionOverhead=Math.max((int)(bufferSize * 0.01),10);
  return new BlockCompressorStream(out,compressor,bufferSize,compressionOverhead);
}
