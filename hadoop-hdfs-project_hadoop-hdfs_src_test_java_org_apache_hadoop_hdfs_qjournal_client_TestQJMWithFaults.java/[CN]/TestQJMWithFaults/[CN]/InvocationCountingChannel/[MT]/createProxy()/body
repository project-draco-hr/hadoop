{
  final QJournalProtocol realProxy=super.createProxy();
  QJournalProtocol mock=Mockito.mock(QJournalProtocol.class,new Answer<Object>(){
    @Override public Object answer(    InvocationOnMock invocation) throws Throwable {
      rpcCount++;
      String callStr="[" + addr + "] "+ invocation.getMethod().getName()+ "("+ Joiner.on(", ").join(invocation.getArguments())+ ")";
      Callable<Void> inject=injections.get(rpcCount);
      if (inject != null) {
        LOG.info("Injecting code before IPC #" + rpcCount + ": "+ callStr);
        inject.call();
      }
 else {
        LOG.info("IPC call #" + rpcCount + ": "+ callStr);
      }
      return invocation.getMethod().invoke(realProxy,invocation.getArguments());
    }
  }
);
  return mock;
}
