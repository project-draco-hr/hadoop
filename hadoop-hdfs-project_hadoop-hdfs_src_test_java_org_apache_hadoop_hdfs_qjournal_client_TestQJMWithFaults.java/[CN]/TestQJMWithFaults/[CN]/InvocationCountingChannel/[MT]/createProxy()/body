{
  final QJournalProtocol realProxy=super.createProxy();
  QJournalProtocol mock=mockProxy(new WrapEveryCall<Object>(realProxy){
    void beforeCall(    InvocationOnMock invocation) throws Exception {
      rpcCount++;
      String callStr="[" + addr + "] "+ invocation.getMethod().getName()+ "("+ Joiner.on(", ").join(invocation.getArguments())+ ")";
      Callable<Void> inject=injections.get(rpcCount);
      if (inject != null) {
        LOG.info("Injecting code before IPC #" + rpcCount + ": "+ callStr);
        inject.call();
      }
 else {
        LOG.info("IPC call #" + rpcCount + ": "+ callStr);
      }
    }
  }
);
  return mock;
}
