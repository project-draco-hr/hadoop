{
  if (System.getProperty("compile.c++") == null) {
    LOG.info("compile.c++ is not defined, so skipping TestPipes");
    return;
  }
  MiniDFSCluster dfs=null;
  MiniMRCluster mr=null;
  Path inputPath=new Path("testing/in");
  Path outputPath=new Path("testing/out");
  try {
    final int numWorkers=2;
    Configuration conf=new Configuration();
    dfs=new MiniDFSCluster.Builder(conf).numDataNodes(numWorkers).build();
    mr=new MiniMRCluster(numWorkers,dfs.getFileSystem().getUri().toString(),1);
    writeInputFile(dfs.getFileSystem(),inputPath);
    runProgram(mr,dfs,wordCountSimple,inputPath,outputPath,3,2,twoSplitOutput,null);
    cleanup(dfs.getFileSystem(),outputPath);
    runProgram(mr,dfs,wordCountSimple,inputPath,outputPath,3,0,noSortOutput,null);
    cleanup(dfs.getFileSystem(),outputPath);
    runProgram(mr,dfs,wordCountPart,inputPath,outputPath,3,2,fixedPartitionOutput,null);
    runNonPipedProgram(mr,dfs,wordCountNoPipes,null);
    mr.waitUntilIdle();
  }
  finally {
    mr.shutdown();
    dfs.shutdown();
  }
}
