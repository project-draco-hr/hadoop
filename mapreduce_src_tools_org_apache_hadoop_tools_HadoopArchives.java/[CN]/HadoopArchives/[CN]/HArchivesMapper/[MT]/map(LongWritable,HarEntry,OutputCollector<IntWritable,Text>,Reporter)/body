{
  Path relPath=new Path(value.path);
  int hash=HarFileSystem.getHarHash(relPath);
  String towrite=null;
  Path srcPath=realPath(relPath,rootPath);
  long startPos=partStream.getPos();
  FileSystem srcFs=srcPath.getFileSystem(conf);
  FileStatus srcStatus=srcFs.getFileStatus(srcPath);
  String propStr=encodeProperties(srcStatus);
  if (value.isDir()) {
    towrite=encodeName(relPath.toString()) + " dir " + propStr+ " 0 0 ";
    StringBuffer sbuff=new StringBuffer();
    sbuff.append(towrite);
    for (    String child : value.children) {
      sbuff.append(encodeName(child) + " ");
    }
    towrite=sbuff.toString();
    reporter.progress();
  }
 else {
    FSDataInputStream input=srcFs.open(srcStatus.getPath());
    reporter.setStatus("Copying file " + srcStatus.getPath() + " to archive.");
    copyData(srcStatus.getPath(),input,partStream,reporter);
    towrite=encodeName(relPath.toString()) + " file " + partname+ " "+ startPos+ " "+ srcStatus.getLen()+ " "+ propStr+ " ";
  }
  out.collect(new IntWritable(hash),new Text(towrite));
}
