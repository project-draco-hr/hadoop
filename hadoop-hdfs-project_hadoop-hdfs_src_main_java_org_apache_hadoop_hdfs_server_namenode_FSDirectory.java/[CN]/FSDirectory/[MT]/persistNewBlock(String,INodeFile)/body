{
  Preconditions.checkArgument(file.isUnderConstruction());
  waitForReady();
  writeLock();
  try {
    fsImage.getEditLog().logAddBlock(path,file);
  }
  finally {
    writeUnlock();
  }
  if (NameNode.stateChangeLog.isDebugEnabled()) {
    NameNode.stateChangeLog.debug("DIR* FSDirectory.persistNewBlock: " + path + " with new block "+ file.getLastBlock().toString()+ ", current total block count is "+ file.getBlocks().length);
  }
}
