{
  writeLock();
  try {
    if (isNonEmptyDirectory(src)) {
      throw new IOException("Attempt to create an encryption zone for a non-empty directory.");
    }
    final XAttr keyIdXAttr=XAttrHelper.buildXAttr(CRYPTO_XATTR_KEY_ID,keyId.getBytes());
    List<XAttr> xattrs=Lists.newArrayListWithCapacity(1);
    xattrs.add(keyIdXAttr);
    unprotectedSetXAttrs(src,xattrs,EnumSet.of(XAttrSetFlag.CREATE));
    return keyIdXAttr;
  }
  finally {
    writeUnlock();
  }
}
