{
  Preconditions.checkState(hasWriteLock());
  INodeDirectory parent=oldnode.getParent();
  if (parent == null) {
    final String mess="FSDirectory.unprotectedReplaceINode: failed to remove " + path;
    NameNode.stateChangeLog.warn("DIR* " + mess);
    throw new IOException(mess);
  }
  final INode removed=parent.removeChild(oldnode,latest);
  Preconditions.checkState(removed == oldnode,"removed != oldnode=%s, removed=%s",oldnode,removed);
  parent=oldnode.getParent();
  oldnode.setParent(null);
  parent.addChild(newnode,true,latest);
}
