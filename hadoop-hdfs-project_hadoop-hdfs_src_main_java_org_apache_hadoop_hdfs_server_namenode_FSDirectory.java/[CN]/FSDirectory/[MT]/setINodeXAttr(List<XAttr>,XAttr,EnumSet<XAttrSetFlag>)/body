{
  List<XAttr> xAttrs=Lists.newArrayListWithCapacity(existingXAttrs != null ? existingXAttrs.size() + 1 : 1);
  boolean exist=false;
  if (existingXAttrs != null) {
    for (    XAttr a : existingXAttrs) {
      if ((a.getNameSpace() == xAttr.getNameSpace() && a.getName().equals(xAttr.getName()))) {
        exist=true;
      }
 else {
        xAttrs.add(a);
      }
    }
  }
  XAttrSetFlag.validate(xAttr.getName(),exist,flag);
  xAttrs.add(xAttr);
  if (xAttrs.size() > inodeXAttrsLimit) {
    throw new IOException("Cannot add additional XAttr to inode, " + "would exceed limit of " + inodeXAttrsLimit);
  }
  return xAttrs;
}
