{
  if (!getFSNamesystem().isImageLoaded() || shouldSkipQuotaChecks()) {
    return;
  }
  final long diff=file.computeQuotaDeltaForTruncate(newLength);
  final short repl=file.getBlockReplication();
  delta.addStorageSpace(diff * repl);
  final BlockStoragePolicy policy=getBlockStoragePolicySuite().getPolicy(file.getStoragePolicyID());
  List<StorageType> types=policy.chooseStorageTypes(repl);
  for (  StorageType t : types) {
    if (t.supportTypeQuota()) {
      delta.addTypeSpace(t,diff);
    }
  }
  if (diff > 0) {
    readLock();
    try {
      verifyQuota(iip,iip.length() - 1,delta,null);
    }
  finally {
      readUnlock();
    }
  }
}
