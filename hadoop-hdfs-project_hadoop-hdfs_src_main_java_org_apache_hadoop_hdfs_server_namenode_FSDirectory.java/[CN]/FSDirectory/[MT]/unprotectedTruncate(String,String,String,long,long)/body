{
  INodesInPath iip=getINodesInPath(src,true);
  BlocksMapUpdateInfo collectedBlocks=new BlocksMapUpdateInfo();
  boolean onBlockBoundary=unprotectedTruncate(iip,newLength,collectedBlocks,mtime);
  if (!onBlockBoundary) {
    getFSNamesystem().prepareFileForWrite(src,iip,clientName,clientMachine,false,false);
  }
  getFSNamesystem().removeBlocksAndUpdateSafemodeTotal(collectedBlocks);
}
