{
  EnumCounters<StorageType> typeSpaceDeltas=new EnumCounters<StorageType>(StorageType.class);
  if (storagePolicyID != BlockStoragePolicySuite.ID_UNSPECIFIED) {
    BlockStoragePolicy storagePolicy=getBlockManager().getStoragePolicy(storagePolicyID);
    if (oldRep != newRep) {
      List<StorageType> oldChosenStorageTypes=storagePolicy.chooseStorageTypes(oldRep);
      for (      StorageType t : oldChosenStorageTypes) {
        if (!t.supportTypeQuota()) {
          continue;
        }
        Preconditions.checkArgument(dsDelta > 0);
        typeSpaceDeltas.add(t,-dsDelta);
      }
    }
    List<StorageType> newChosenStorageTypes=storagePolicy.chooseStorageTypes(newRep);
    for (    StorageType t : newChosenStorageTypes) {
      if (!t.supportTypeQuota()) {
        continue;
      }
      typeSpaceDeltas.add(t,dsDelta);
    }
  }
  return typeSpaceDeltas;
}
