{
  waitForReady();
  writeLock();
  try {
    final INode[] inodes=inodesInPath.getINodes();
    final INodeFileUnderConstruction fileINode=INodeFileUnderConstruction.valueOf(inodes[inodes.length - 1],path);
    updateCount(inodesInPath,inodes.length - 1,0,fileINode.getPreferredBlockSize() * fileINode.getBlockReplication(),true);
    BlockInfoUnderConstruction blockInfo=new BlockInfoUnderConstruction(block,fileINode.getBlockReplication(),BlockUCState.UNDER_CONSTRUCTION,targets);
    getBlockManager().addBlockCollection(blockInfo,fileINode);
    fileINode.addBlock(blockInfo);
    if (NameNode.stateChangeLog.isDebugEnabled()) {
      NameNode.stateChangeLog.debug("DIR* FSDirectory.addBlock: " + path + " with "+ block+ " block is added to the in-memory "+ "file system");
    }
    return blockInfo;
  }
  finally {
    writeUnlock();
  }
}
