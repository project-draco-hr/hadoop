{
  waitForReady();
  final long modTime=now();
  if (createParent) {
    final String parent=new Path(path).getParent().toString();
    if (!mkdirs(parent,dirPerms,true,modTime)) {
      return null;
    }
  }
  final String userName=dirPerms.getUserName();
  INodeSymlink newNode=null;
  long id=namesystem.allocateNewInodeId();
  writeLock();
  try {
    newNode=unprotectedAddSymlink(id,path,target,modTime,modTime,new PermissionStatus(userName,null,FsPermission.getDefault()));
  }
  finally {
    writeUnlock();
  }
  if (newNode == null) {
    NameNode.stateChangeLog.info("DIR* addSymlink: failed to add " + path);
    return null;
  }
  fsImage.getEditLog().logSymlink(path,target,modTime,modTime,newNode,logRetryCache);
  if (NameNode.stateChangeLog.isDebugEnabled()) {
    NameNode.stateChangeLog.debug("DIR* addSymlink: " + path + " is added");
  }
  return newNode;
}
