{
  long modTime=now();
  INodeFile newNode=newINodeFile(allocateNewInodeId(),permissions,modTime,modTime,replication,preferredBlockSize);
  newNode.setLocalName(localName.getBytes(Charsets.UTF_8));
  newNode.toUnderConstruction(clientName,clientMachine);
  INodesInPath newiip;
  writeLock();
  try {
    newiip=addINode(existing,newNode);
  }
  finally {
    writeUnlock();
  }
  if (newiip == null) {
    NameNode.stateChangeLog.info("DIR* addFile: failed to add " + existing.getPath() + "/"+ localName);
    return null;
  }
  if (NameNode.stateChangeLog.isDebugEnabled()) {
    NameNode.stateChangeLog.debug("DIR* addFile: " + localName + " is added");
  }
  return newiip;
}
