{
  if (NameNode.stateChangeLog.isDebugEnabled()) {
    NameNode.stateChangeLog.debug("DIR* FSDirectory.delete: " + src);
  }
  final long filesRemoved;
  writeLock();
  try {
    final INodesInPath inodesInPath=getINodesInPath4Write(normalizePath(src),false);
    if (!deleteAllowed(inodesInPath,src)) {
      filesRemoved=-1;
    }
 else {
      List<INodeDirectory> snapshottableDirs=new ArrayList<INodeDirectory>();
      checkSnapshot(inodesInPath.getLastINode(),snapshottableDirs);
      filesRemoved=unprotectedDelete(inodesInPath,collectedBlocks,removedINodes,mtime);
      namesystem.removeSnapshottableDirs(snapshottableDirs);
    }
  }
  finally {
    writeUnlock();
  }
  return filesRemoved;
}
