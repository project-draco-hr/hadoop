{
  waitForReady();
  long modTime=now();
  Path parent=new Path(path).getParent();
  if (parent == null) {
    return null;
  }
  if (!mkdirs(parent.toString(),permissions,true,modTime)) {
    return null;
  }
  INodeFileUnderConstruction newNode=new INodeFileUnderConstruction(namesystem.allocateNewInodeId(),permissions,replication,preferredBlockSize,modTime,clientName,clientMachine,clientNode);
  boolean added=false;
  writeLock();
  try {
    added=addINode(path,newNode);
  }
  finally {
    writeUnlock();
  }
  if (!added) {
    NameNode.stateChangeLog.info("DIR* addFile: failed to add " + path);
    return null;
  }
  if (NameNode.stateChangeLog.isDebugEnabled()) {
    NameNode.stateChangeLog.debug("DIR* addFile: " + path + " is added");
  }
  return newNode;
}
