{
  if (checkQuota) {
    verifyFsLimits(pathComponents,pos,child);
  }
  INode.DirCounts counts=new INode.DirCounts();
  child.spaceConsumedInTree(counts);
  if (childDiskspace < 0) {
    childDiskspace=counts.getDsCount();
  }
  updateCount(pathComponents,pos,counts.getNsCount(),childDiskspace,checkQuota);
  if (pathComponents[pos - 1] == null) {
    throw new NullPointerException("Panic: parent does not exist");
  }
  T addedNode=((INodeDirectory)pathComponents[pos - 1]).addChild(child,true);
  if (addedNode == null) {
    updateCount(pathComponents,pos,-counts.getNsCount(),-childDiskspace,true);
  }
  return addedNode;
}
