{
  Preconditions.checkArgument(file.isUnderConstruction());
  waitForReady();
  writeLock();
  try {
    fsImage.getEditLog().logUpdateBlocks(path,file,logRetryCache);
    if (NameNode.stateChangeLog.isDebugEnabled()) {
      NameNode.stateChangeLog.debug("DIR* FSDirectory.persistBlocks: " + path + " with "+ file.getBlocks().length+ " blocks is persisted to the file system");
    }
  }
  finally {
    writeUnlock();
  }
}
