{
  if (pos == 1 && iip.getINode(0) == rootDir && isReservedName(child)) {
    throw new HadoopIllegalArgumentException("File name \"" + child.getLocalName() + "\" is reserved and cannot "+ "be created. If this is during upgrade change the name of the "+ "existing file or directory to another name before upgrading "+ "to the new release.");
  }
  final INodeDirectory parent=iip.getINode(pos - 1).asDirectory();
  if (checkQuota) {
    final String parentPath=iip.getPath(pos - 1);
    verifyMaxComponentLength(child.getLocalNameBytes(),parentPath);
    verifyMaxDirItems(parent,parentPath);
  }
  verifyINodeName(child.getLocalNameBytes());
  final Quota.Counts counts=child.computeQuotaUsage();
  updateCount(iip,pos,counts.get(Quota.NAMESPACE),counts.get(Quota.DISKSPACE),checkQuota);
  boolean isRename=(child.getParent() != null);
  boolean added;
  try {
    added=parent.addChild(child,true,iip.getLatestSnapshotId());
  }
 catch (  QuotaExceededException e) {
    updateCountNoQuotaCheck(iip,pos,-counts.get(Quota.NAMESPACE),-counts.get(Quota.DISKSPACE));
    throw e;
  }
  if (!added) {
    updateCountNoQuotaCheck(iip,pos,-counts.get(Quota.NAMESPACE),-counts.get(Quota.DISKSPACE));
  }
 else {
    if (!isRename) {
      AclStorage.copyINodeDefaultAcl(child);
    }
    addToInodeMap(child);
  }
  return added;
}
