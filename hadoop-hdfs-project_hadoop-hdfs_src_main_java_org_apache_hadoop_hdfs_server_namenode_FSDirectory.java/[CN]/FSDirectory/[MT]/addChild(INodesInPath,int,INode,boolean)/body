{
  final INode[] inodes=iip.getINodes();
  if (checkQuota) {
    verifyMaxComponentLength(child.getLocalNameBytes(),inodes,pos);
    verifyMaxDirItems(inodes,pos);
  }
  verifyINodeName(child.getLocalNameBytes());
  final Quota.Counts counts=child.computeQuotaUsage();
  updateCount(iip,pos,counts.get(Quota.NAMESPACE),counts.get(Quota.DISKSPACE),checkQuota);
  final INodeDirectory parent=inodes[pos - 1].asDirectory();
  final boolean added=parent.addChild(child,true,iip.getLatestSnapshot());
  if (!added) {
    updateCountNoQuotaCheck(iip,pos,-counts.get(Quota.NAMESPACE),-counts.get(Quota.DISKSPACE));
  }
 else {
    iip.setINode(pos - 1,child.getParent());
  }
  return added;
}
