{
  final INode[] inodes=iip.getINodes();
  if (pos == 1 && inodes[0] == rootDir && isReservedName(child)) {
    throw new HadoopIllegalArgumentException("File name \"" + child.getLocalName() + "\" is reserved and cannot "+ "be created. If this is during upgrade change the name of the "+ "existing file or directory to another name before upgrading "+ "to the new release.");
  }
  if (checkQuota) {
    verifyMaxComponentLength(child.getLocalNameBytes(),inodes,pos);
    verifyMaxDirItems(inodes,pos);
  }
  verifyINodeName(child.getLocalNameBytes());
  final Quota.Counts counts=child.computeQuotaUsage();
  updateCount(iip,pos,counts.get(Quota.NAMESPACE),counts.get(Quota.DISKSPACE),checkQuota);
  boolean isRename=(child.getParent() != null);
  final INodeDirectory parent=inodes[pos - 1].asDirectory();
  boolean added;
  try {
    added=parent.addChild(child,true,iip.getLatestSnapshotId());
  }
 catch (  QuotaExceededException e) {
    updateCountNoQuotaCheck(iip,pos,-counts.get(Quota.NAMESPACE),-counts.get(Quota.DISKSPACE));
    throw e;
  }
  if (!added) {
    updateCountNoQuotaCheck(iip,pos,-counts.get(Quota.NAMESPACE),-counts.get(Quota.DISKSPACE));
  }
 else {
    iip.setINode(pos - 1,child.getParent());
    if (!isRename) {
      AclStorage.copyINodeDefaultAcl(child);
    }
    addToInodeMap(child);
  }
  return added;
}
