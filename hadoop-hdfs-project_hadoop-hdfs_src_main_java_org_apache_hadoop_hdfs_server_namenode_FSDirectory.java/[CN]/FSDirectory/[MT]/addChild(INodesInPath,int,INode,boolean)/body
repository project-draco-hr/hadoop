{
  final INode[] inodes=iip.getINodes();
  if (checkQuota) {
    verifyFsLimits(inodes,pos,child);
  }
  final Quota.Counts counts=child.computeQuotaUsage();
  updateCount(iip,pos,counts.get(Quota.NAMESPACE),counts.get(Quota.DISKSPACE),checkQuota);
  final INodeDirectory parent=inodes[pos - 1].asDirectory();
  final boolean added=parent.addChild(child,true,iip.getLatestSnapshot());
  if (!added) {
    updateCountNoQuotaCheck(iip,pos,-counts.get(Quota.NAMESPACE),-counts.get(Quota.DISKSPACE));
  }
 else {
    iip.setINode(pos - 1,child.getParent());
  }
  return added;
}
