{
  final INode[] inodes=inodesInPath.getINodes();
  if (checkQuota) {
    verifyFsLimits(inodes,pos,child);
  }
  INode.DirCounts counts=new INode.DirCounts();
  child.spaceConsumedInTree(counts);
  updateCount(inodesInPath,pos,counts.getNsCount(),counts.getDsCount(),checkQuota);
  if (inodes[pos - 1] == null) {
    throw new NullPointerException("Panic: parent does not exist");
  }
  final boolean added=((INodeDirectory)inodes[pos - 1]).addChild(child,true);
  if (!added) {
    updateCount(inodesInPath,pos,-counts.getNsCount(),-counts.getDsCount(),true);
  }
  return added;
}
