{
  writeLock();
  try {
    if (!oldnode.removeNode()) {
      NameNode.stateChangeLog.warn("DIR* FSDirectory.replaceNode: " + "failed to remove " + path);
      throw new IOException("FSDirectory.replaceNode: " + "failed to remove " + path);
    }
    rootDir.addINode(path,newnode);
    int index=0;
    for (    BlockInfo b : newnode.getBlocks()) {
      BlockInfo info=getBlockManager().addBlockCollection(b,newnode);
      newnode.setBlock(index,info);
      index++;
    }
  }
  finally {
    writeUnlock();
  }
}
