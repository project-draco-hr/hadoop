{
  final Snapshot latestSnapshot=inodesInPath.getLatestSnapshot();
  final INode[] inodes=inodesInPath.getINodes();
  final int pos=inodes.length - 1;
  final boolean removed=((INodeDirectory)inodes[pos - 1]).removeChild(inodes[pos],latestSnapshot);
  if (removed && latestSnapshot == null) {
    inodesInPath.setINode(pos - 1,inodes[pos].getParent());
    final Quota.Counts counts=inodes[pos].computeQuotaUsage();
    updateCountNoQuotaCheck(inodesInPath,pos,-counts.get(Quota.NAMESPACE),-counts.get(Quota.DISKSPACE));
  }
  return removed ? inodes[pos] : null;
}
