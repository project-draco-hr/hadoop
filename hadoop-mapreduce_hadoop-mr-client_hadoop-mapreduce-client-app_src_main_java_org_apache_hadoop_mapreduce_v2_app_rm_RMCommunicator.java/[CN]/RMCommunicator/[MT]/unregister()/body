{
  try {
    String finalState="RUNNING";
    if (job.getState() == JobState.SUCCEEDED) {
      finalState="SUCCEEDED";
    }
 else     if (job.getState() == JobState.KILLED) {
      finalState="KILLED";
    }
 else     if (job.getState() == JobState.FAILED || job.getState() == JobState.ERROR) {
      finalState="FAILED";
    }
    StringBuffer sb=new StringBuffer();
    for (    String s : job.getDiagnostics()) {
      sb.append(s).append("\n");
    }
    LOG.info("Setting job diagnostics to " + sb.toString());
    String historyUrl=JobHistoryUtils.getHistoryUrl(getConfig(),context.getApplicationID());
    LOG.info("History url is " + historyUrl);
    FinishApplicationMasterRequest request=recordFactory.newRecordInstance(FinishApplicationMasterRequest.class);
    request.setAppAttemptId(this.applicationAttemptId);
    request.setFinalState(finalState.toString());
    request.setDiagnostics(sb.toString());
    request.setTrackingUrl(historyUrl);
    scheduler.finishApplicationMaster(request);
  }
 catch (  Exception are) {
    LOG.info("Exception while unregistering ",are);
  }
}
