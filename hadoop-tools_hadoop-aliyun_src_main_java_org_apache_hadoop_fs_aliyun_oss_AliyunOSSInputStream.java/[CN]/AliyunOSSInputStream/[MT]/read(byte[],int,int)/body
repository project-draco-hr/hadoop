{
  checkNotClosed();
  if (buf == null) {
    throw new NullPointerException();
  }
 else   if (off < 0 || len < 0 || len > buf.length - off) {
    throw new IndexOutOfBoundsException();
  }
 else   if (len == 0) {
    return 0;
  }
  int bytesRead=0;
  while (position < contentLength && bytesRead < len) {
    if (partRemaining == 0) {
      reopen(position);
    }
    int tries=MAX_RETRIES;
    boolean retry;
    int bytes=-1;
    do {
      retry=false;
      try {
        bytes=wrappedStream.read(buf,off + bytesRead,len - bytesRead);
      }
 catch (      Exception e) {
        handleReadException(e,--tries);
        retry=true;
      }
    }
 while (retry);
    if (bytes > 0) {
      bytesRead+=bytes;
      position+=bytes;
      partRemaining-=bytes;
    }
 else     if (partRemaining != 0) {
      throw new IOException("Failed to read from stream. Remaining:" + partRemaining);
    }
  }
  if (statistics != null && bytesRead > 0) {
    statistics.incrementBytesRead(bytesRead);
  }
  if (bytesRead == 0 && len > 0) {
    return -1;
  }
 else {
    return bytesRead;
  }
}
