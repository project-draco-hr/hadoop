{
  DatanodeDescriptor writerDesc=DFSTestUtil.getDatanodeDescriptor("7.7.7.7","/d2/r4");
  DatanodeDescriptor[] targets;
  targets=replicator.chooseTarget(filename,0,writerDesc,new ArrayList<DatanodeDescriptor>(),BLOCK_SIZE);
  assertEquals(targets.length,0);
  targets=replicator.chooseTarget(filename,1,writerDesc,new ArrayList<DatanodeDescriptor>(),BLOCK_SIZE);
  assertEquals(targets.length,1);
  targets=replicator.chooseTarget(filename,2,writerDesc,new ArrayList<DatanodeDescriptor>(),BLOCK_SIZE);
  assertEquals(targets.length,2);
  assertFalse(cluster.isOnSameRack(targets[0],targets[1]));
  targets=replicator.chooseTarget(filename,3,writerDesc,new ArrayList<DatanodeDescriptor>(),BLOCK_SIZE);
  assertEquals(targets.length,3);
  assertTrue(cluster.isOnSameRack(targets[1],targets[2]));
  assertFalse(cluster.isOnSameRack(targets[0],targets[1]));
}
