{
  Namesystem mockNS=mock(Namesystem.class);
  when(mockNS.hasReadLock()).thenReturn(true);
  BlockManager bm=new BlockManager(mockNS,false,new HdfsConfiguration());
  UnderReplicatedBlocks underReplicatedBlocks=bm.neededReplications;
  BlockInfo block1=genBlockInfo(ThreadLocalRandom.current().nextLong());
  BlockInfo block2=genBlockInfo(ThreadLocalRandom.current().nextLong());
  underReplicatedBlocks.add(block1,0,0,1,1);
  underReplicatedBlocks.add(block2,0,0,1,1);
  List<List<BlockInfo>> chosenBlocks;
  chosenBlocks=underReplicatedBlocks.chooseUnderReplicatedBlocks(1);
  assertTheChosenBlocks(chosenBlocks,1,0,0,0,0);
  bm.setReplication((short)0,(short)1,block1);
  chosenBlocks=underReplicatedBlocks.chooseUnderReplicatedBlocks(1);
  assertTheChosenBlocks(chosenBlocks,1,0,0,0,0);
}
