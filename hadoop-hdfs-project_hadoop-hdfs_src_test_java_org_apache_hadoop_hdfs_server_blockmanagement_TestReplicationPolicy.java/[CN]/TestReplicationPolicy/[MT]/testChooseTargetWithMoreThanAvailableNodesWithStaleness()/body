{
  try {
    namenode.getNamesystem().getBlockManager().getDatanodeManager().setNumStaleNodes(dataNodes.length);
    testChooseTargetWithMoreThanAvailableNodes();
  }
  finally {
    namenode.getNamesystem().getBlockManager().getDatanodeManager().setNumStaleNodes(0);
  }
}
