{
  try {
    namenode.getNamesystem().getBlockManager().getDatanodeManager().setNumStaleNodes(NUM_OF_DATANODES);
    testChooseTargetWithMoreThanAvailableNodes();
  }
  finally {
    namenode.getNamesystem().getBlockManager().getDatanodeManager().setNumStaleNodes(0);
  }
}
