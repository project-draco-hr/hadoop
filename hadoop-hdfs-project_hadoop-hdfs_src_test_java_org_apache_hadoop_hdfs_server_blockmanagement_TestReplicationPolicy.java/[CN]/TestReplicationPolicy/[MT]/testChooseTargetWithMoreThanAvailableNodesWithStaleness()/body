{
  try {
    namenode.getNamesystem().getBlockManager().getDatanodeManager().setAvoidStaleDataNodesForWrite(true);
    testChooseTargetWithMoreThanAvailableNodes();
  }
  finally {
    namenode.getNamesystem().getBlockManager().getDatanodeManager().setAvoidStaleDataNodesForWrite(false);
  }
}
