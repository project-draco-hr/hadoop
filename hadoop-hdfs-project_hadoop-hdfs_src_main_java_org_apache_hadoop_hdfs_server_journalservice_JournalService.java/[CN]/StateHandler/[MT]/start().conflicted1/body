{
  stateHandler.start();
  LOG.info("Starting rpc server");
  rpcServer.start();
  for (boolean registered=false, handshakeComplete=false; ; ) {
    try {
      if (!handshakeComplete) {
        handshake();
        handshakeComplete=true;
        LOG.info("handshake completed");
      }
      if (!registered) {
        registerWithNamenode();
        registered=true;
        LOG.info("Registration completed");
        break;
      }
    }
 catch (    IOException ioe) {
      LOG.warn("Encountered exception ",ioe);
    }
catch (    Exception e) {
      LOG.warn("Encountered exception ",e);
    }
    try {
      Thread.sleep(1000);
    }
 catch (    InterruptedException ie) {
      LOG.warn("Encountered exception ",ie);
    }
  }
  stateHandler.waitForRoll();
  try {
    namenode.rollEditLog();
  }
 catch (  IOException e) {
    LOG.warn("Encountered exception ",e);
  }
}
