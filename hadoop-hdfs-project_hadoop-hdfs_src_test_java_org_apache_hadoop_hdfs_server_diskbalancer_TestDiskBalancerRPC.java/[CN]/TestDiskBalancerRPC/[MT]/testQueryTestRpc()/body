{
  final int dnIndex=0;
  cluster.restartDataNode(dnIndex);
  cluster.waitActive();
  ClusterConnector nameNodeConnector=ConnectorFactory.getCluster(cluster.getFileSystem(0).getUri(),conf);
  DiskBalancerCluster diskBalancerCluster=new DiskBalancerCluster(nameNodeConnector);
  diskBalancerCluster.readClusterInfo();
  Assert.assertEquals(cluster.getDataNodes().size(),diskBalancerCluster.getNodes().size());
  diskBalancerCluster.setNodesToProcess(diskBalancerCluster.getNodes());
  DataNode dataNode=cluster.getDataNodes().get(dnIndex);
  DiskBalancerDataNode node=diskBalancerCluster.getNodeByUUID(dataNode.getDatanodeUuid());
  GreedyPlanner planner=new GreedyPlanner(10.0f,node);
  NodePlan plan=new NodePlan(node.getDataNodeName(),node.getDataNodePort());
  planner.balanceVolumeSet(node,node.getVolumeSets().get("DISK"),plan);
  final int planVersion=1;
  String planHash=DigestUtils.sha512Hex(plan.toJson());
  dataNode.submitDiskBalancerPlan(planHash,planVersion,10,plan.toJson());
  DiskBalancerWorkStatus status=dataNode.queryDiskBalancerPlan();
  Assert.assertTrue(status.getResult() == PLAN_UNDER_PROGRESS || status.getResult() == PLAN_DONE);
}
