{
  final int dnIndex=0;
  cluster.restartDataNode(dnIndex);
  cluster.waitActive();
  ClusterConnector nameNodeConnector=ConnectorFactory.getCluster(cluster.getFileSystem(0).getUri(),conf);
  DiskBalancerCluster diskBalancerCluster=new DiskBalancerCluster(nameNodeConnector);
  diskBalancerCluster.readClusterInfo();
  Assert.assertEquals(cluster.getDataNodes().size(),diskBalancerCluster.getNodes().size());
  diskBalancerCluster.setNodesToProcess(diskBalancerCluster.getNodes());
  DiskBalancerDataNode node=diskBalancerCluster.getNodes().get(0);
  GreedyPlanner planner=new GreedyPlanner(10.0f,node);
  NodePlan plan=new NodePlan(node.getDataNodeName(),node.getDataNodePort());
  planner.balanceVolumeSet(node,node.getVolumeSets().get("DISK"),plan);
  final int planVersion=0;
  DataNode dataNode=cluster.getDataNodes().get(dnIndex);
  String planHash=DigestUtils.sha512Hex(plan.toJson());
  try {
    dataNode.submitDiskBalancerPlan(planHash,planVersion,10,plan.toJson());
  }
 catch (  DiskbalancerException ex) {
  }
  thrown.expect(DiskbalancerException.class);
  dataNode.queryDiskBalancerPlan();
}
