{
  String namenode=null;
  MiniDFSCluster dfs=null;
  MiniMRCluster mr=null;
  FileSystem fileSys=null;
  try {
    final int taskTrackers=10;
    Configuration conf=new Configuration();
    JobConf mrConf=new JobConf();
    mrConf.set(TTConfig.TT_REDUCE_SLOTS,"1");
    dfs=new MiniDFSCluster(conf,1,true,null);
    fileSys=dfs.getFileSystem();
    namenode=fileSys.getUri().toString();
    mr=new MiniMRCluster(10,namenode,3,null,null,mrConf);
    mr.setInlineCleanupThreads();
    JobConf jobConf=mr.createJobConf();
    JobID jobid=runSleepJob(jobConf);
    verifyJobDirCleanup(mr,taskTrackers,jobid);
  }
  finally {
    if (fileSys != null) {
      fileSys.close();
    }
    if (dfs != null) {
      dfs.shutdown();
    }
    if (mr != null) {
      mr.shutdown();
    }
  }
}
