{
  if (UserGroupInformation.isSecurityEnabled()) {
    UserGroupInformation ugi=null;
    try {
      ugi=UserGroupInformation.getLoginUser();
    }
 catch (    IOException e) {
      LOG.error("Exception while getting login user",e);
      Runtime.getRuntime().exit(-1);
    }
    ugi.doAs(new PrivilegedAction<Object>(){
      @Override public Object run(){
        doWork();
        return null;
      }
    }
);
  }
 else {
    doWork();
  }
}
