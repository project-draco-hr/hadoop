{
  final Configuration conf=new Configuration();
  final FileSystem lfs=FileSystem.getLocal(conf);
  final Path rootInputDir=new Path(System.getProperty("test.tools.input.dir","")).makeQualified(lfs.getUri(),lfs.getWorkingDirectory());
  final Path rootInputPath=new Path(rootInputDir,"rumen/small-trace-test");
  final Path inputPath=new Path(rootInputPath,"v20-single-input-log.gz");
  RewindableInputStream ris=getRewindableInputStream(inputPath,conf);
  assertNotNull(ris);
  Hadoop20JHParser parser=null;
  try {
    assertEquals("Hadoop20JHParser can't parse the test file " + inputPath,true,Hadoop20JHParser.canParse(ris));
    ris.rewind();
    parser=new Hadoop20JHParser(ris);
    ArrayList<String> seenEvents=new ArrayList<String>(150);
    String jobId="job_200904211745_0002";
    JobBuilder builder=new JobBuilder(jobId);
    getHistoryEvents(parser,seenEvents,builder);
    validateSeenHistoryEvents(seenEvents,goldLines);
    ParsedJob parsedJob=builder.build();
    validateParsedJob(parsedJob,20,1,true);
  }
  finally {
    if (parser != null) {
      parser.close();
    }
    ris.close();
  }
}
