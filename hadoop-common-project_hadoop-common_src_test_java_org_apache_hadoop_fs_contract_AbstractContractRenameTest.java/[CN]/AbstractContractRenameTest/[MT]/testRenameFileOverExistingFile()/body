{
  describe("Verify renaming a file onto an existing file matches expectations");
  Path srcFile=path("source-256.txt");
  byte[] srcData=dataset(256,'a','z');
  writeDataset(getFileSystem(),srcFile,srcData,srcData.length,1024,false);
  Path destFile=path("dest-512.txt");
  byte[] destData=dataset(512,'A','Z');
  writeDataset(getFileSystem(),destFile,destData,destData.length,1024,false);
  assertIsFile(destFile);
  boolean renameOverwritesDest=isSupported(RENAME_OVERWRITES_DEST);
  boolean renameReturnsFalseOnRenameDestExists=!isSupported(RENAME_RETURNS_FALSE_IF_DEST_EXISTS);
  boolean destUnchanged=true;
  try {
    boolean renamed=rename(srcFile,destFile);
    if (renameOverwritesDest) {
      assertTrue("Rename returned false",renamed);
      destUnchanged=false;
    }
 else {
      if (renamed && !renameReturnsFalseOnRenameDestExists) {
        String destDirLS=generateAndLogErrorListing(srcFile,destFile);
        getLog().error("dest dir {}",destDirLS);
        fail("expected rename(" + srcFile + ", "+ destFile+ " ) to fail,"+ " but got success and destination of "+ destDirLS);
      }
    }
  }
 catch (  FileAlreadyExistsException e) {
    handleExpectedException(e);
  }
  ContractTestUtils.verifyFileContents(getFileSystem(),destFile,destUnchanged ? destData : srcData);
}
