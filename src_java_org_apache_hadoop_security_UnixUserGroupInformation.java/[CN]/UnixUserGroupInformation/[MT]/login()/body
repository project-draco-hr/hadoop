{
  try {
    String userName;
    try {
      userName=getUnixUserName();
    }
 catch (    Exception e) {
      LOG.warn("Couldn't get unix username, using " + DEFAULT_USERNAME,e);
      userName=DEFAULT_USERNAME;
    }
    UnixUserGroupInformation ugi=user2UGIMap.get(userName);
    if (ugi != null) {
      return ugi;
    }
    String[] groupNames;
    try {
      groupNames=getUnixGroups();
    }
 catch (    Exception e) {
      LOG.warn("Couldn't get unix groups, using " + DEFAULT_GROUP,e);
      groupNames=new String[1];
      groupNames[0]=DEFAULT_GROUP;
    }
    ugi=new UnixUserGroupInformation(userName,groupNames);
    user2UGIMap.put(ugi.getUserName(),ugi);
    return ugi;
  }
 catch (  Exception e) {
    throw new LoginException("Login failed: " + e.getMessage());
  }
}
