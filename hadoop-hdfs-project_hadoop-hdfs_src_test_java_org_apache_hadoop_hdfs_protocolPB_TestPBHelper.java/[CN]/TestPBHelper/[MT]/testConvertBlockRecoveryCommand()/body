{
  DatanodeInfo[] dnInfo=new DatanodeInfo[]{getDNInfo(),getDNInfo()};
  List<RecoveringBlock> blks=ImmutableList.of(new RecoveringBlock(getExtendedBlock(1),dnInfo,3),new RecoveringBlock(getExtendedBlock(2),dnInfo,3));
  BlockRecoveryCommand cmd=new BlockRecoveryCommand(blks);
  BlockRecoveryCommandProto proto=PBHelper.convert(cmd);
  assertEquals(1,proto.getBlocks(0).getBlock().getB().getBlockId());
  assertEquals(2,proto.getBlocks(1).getBlock().getB().getBlockId());
  BlockRecoveryCommand cmd2=PBHelper.convert(proto);
  List<RecoveringBlock> cmd2Blks=Lists.newArrayList(cmd2.getRecoveringBlocks());
  assertEquals(blks.get(0).getBlock(),cmd2Blks.get(0).getBlock());
  assertEquals(blks.get(1).getBlock(),cmd2Blks.get(1).getBlock());
  assertEquals(Joiner.on(",").join(blks),Joiner.on(",").join(cmd2Blks));
  assertEquals(cmd.toString(),cmd2.toString());
}
