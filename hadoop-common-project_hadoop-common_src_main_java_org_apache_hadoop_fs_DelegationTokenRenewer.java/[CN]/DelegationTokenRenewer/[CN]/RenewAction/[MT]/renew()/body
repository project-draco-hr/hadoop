{
  final T fs=weakFs.get();
  final boolean b=fs != null;
  if (b) {
synchronized (fs) {
      try {
        long expires=token.renew(fs.getConf());
        updateRenewalTime(expires - Time.now());
      }
 catch (      IOException ie) {
        try {
          Token<?>[] tokens=fs.addDelegationTokens(null,null);
          if (tokens.length == 0) {
            throw new IOException("addDelegationTokens returned no tokens");
          }
          token=tokens[0];
          updateRenewalTime(renewCycle);
          fs.setDelegationToken(token);
        }
 catch (        IOException ie2) {
          isValid=false;
          throw new IOException("Can't renew or get new delegation token ",ie);
        }
      }
    }
  }
  return b;
}
