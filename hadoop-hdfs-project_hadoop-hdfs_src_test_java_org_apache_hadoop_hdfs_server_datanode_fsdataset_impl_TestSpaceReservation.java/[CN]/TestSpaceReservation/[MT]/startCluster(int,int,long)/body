{
  initConfig(blockSize);
  cluster=new MiniDFSCluster.Builder(conf).storagesPerDatanode(STORAGES_PER_DATANODE).numDataNodes(numDatanodes).build();
  fs=cluster.getFileSystem();
  client=fs.getClient();
  cluster.waitActive();
  if (perVolumeCapacity >= 0) {
    try (FsDatasetSpi.FsVolumeReferences volumes=cluster.getDataNodes().get(0).getFSDataset().getFsVolumeReferences()){
      singletonVolumeRef=volumes.get(0).obtainReference();
    }
     singletonVolume=((FsVolumeImpl)singletonVolumeRef.getVolume());
    singletonVolume.setCapacityForTesting(perVolumeCapacity);
  }
}
