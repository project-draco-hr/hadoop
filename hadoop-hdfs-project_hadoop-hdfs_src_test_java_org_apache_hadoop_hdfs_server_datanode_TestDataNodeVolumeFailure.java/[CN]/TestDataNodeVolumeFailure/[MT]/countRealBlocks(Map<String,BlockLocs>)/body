{
  int total=0;
  final String bpid=cluster.getNamesystem().getBlockPoolId();
  for (int i=0; i < dn_num; i++) {
    for (int j=0; j <= 1; j++) {
      File storageDir=MiniDFSCluster.getStorageDir(i,j);
      File dir=MiniDFSCluster.getFinalizedDir(storageDir,bpid);
      if (dir == null) {
        System.out.println("dir is null for dn=" + i + " and data_dir="+ j);
        continue;
      }
      String[] res=metaFilesInDir(dir);
      if (res == null) {
        System.out.println("res is null for dir = " + dir + " i="+ i+ " and j="+ j);
        continue;
      }
      for (      String s : res) {
        assertNotNull("Block file name should not be null",s);
        String bid=s.substring(s.indexOf("_") + 1,s.lastIndexOf("_"));
        BlockLocs val=map.get(bid);
        if (val == null) {
          val=new BlockLocs();
        }
        val.num_files++;
        map.put(bid,val);
      }
      total+=res.length;
    }
  }
  return total;
}
