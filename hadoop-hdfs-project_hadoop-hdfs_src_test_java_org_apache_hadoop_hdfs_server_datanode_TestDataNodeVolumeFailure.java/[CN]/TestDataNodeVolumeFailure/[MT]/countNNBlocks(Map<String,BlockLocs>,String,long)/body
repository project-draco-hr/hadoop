{
  int total=0;
  NamenodeProtocols nn=cluster.getNameNodeRpc();
  List<LocatedBlock> locatedBlocks=nn.getBlockLocations(path,0,size).getLocatedBlocks();
  for (  LocatedBlock lb : locatedBlocks) {
    String blockId="" + lb.getBlock().getBlockId();
    DatanodeInfo[] dn_locs=lb.getLocations();
    BlockLocs bl=map.get(blockId);
    if (bl == null) {
      bl=new BlockLocs();
    }
    total+=dn_locs.length;
    bl.num_locs+=dn_locs.length;
    map.put(blockId,bl);
  }
  return total;
}
