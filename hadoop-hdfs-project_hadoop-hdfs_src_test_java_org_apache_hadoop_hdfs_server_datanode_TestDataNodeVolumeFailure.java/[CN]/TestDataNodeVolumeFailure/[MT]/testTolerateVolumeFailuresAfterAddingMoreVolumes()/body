{
  final File dn0Vol1=new File(dataDir,"data" + (2 * 0 + 1));
  final File dn0Vol2=new File(dataDir,"data" + (2 * 0 + 2));
  final File dn0VolNew=new File(dataDir,"data_new");
  final DataNode dn0=cluster.getDataNodes().get(0);
  final String oldDataDirs=dn0.getConf().get(DFSConfigKeys.DFS_DATANODE_DATA_DIR_KEY);
  assertThat(dn0.reconfigurePropertyImpl(DFSConfigKeys.DFS_DATANODE_DATA_DIR_KEY,oldDataDirs + "," + dn0VolNew.getAbsolutePath()),is(dn0.getConf().get(DFSConfigKeys.DFS_DATANODE_DATA_DIR_KEY)));
  DataNodeTestUtils.injectDataDirFailure(dn0Vol1);
  checkDiskErrorSync(dn0);
  assertTrue(dn0.shouldRun());
  DataNodeTestUtils.injectDataDirFailure(dn0Vol2);
  checkDiskErrorSync(dn0);
  assertFalse(dn0.shouldRun());
}
