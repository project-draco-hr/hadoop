{
  if (!deleteDuplicateReplicas) {
    return replica1;
  }
  ReplicaInfo replicaToKeep;
  ReplicaInfo replicaToDelete;
  if (replica1.getGenerationStamp() != replica2.getGenerationStamp()) {
    replicaToKeep=replica1.getGenerationStamp() > replica2.getGenerationStamp() ? replica1 : replica2;
  }
 else   if (replica1.getNumBytes() != replica2.getNumBytes()) {
    replicaToKeep=replica1.getNumBytes() > replica2.getNumBytes() ? replica1 : replica2;
  }
 else   if (replica1.getVolume().isTransientStorage() && !replica2.getVolume().isTransientStorage()) {
    replicaToKeep=replica2;
  }
 else {
    replicaToKeep=replica1;
  }
  replicaToDelete=(replicaToKeep == replica1) ? replica2 : replica1;
  if (LOG.isDebugEnabled()) {
    LOG.debug("resolveDuplicateReplicas decide to keep " + replicaToKeep + ".  Will try to delete "+ replicaToDelete);
  }
  volumeMap.add(bpid,replicaToKeep);
  final File blockFile=replicaToDelete.getBlockFile();
  if (!blockFile.delete()) {
    LOG.warn("Failed to delete block file " + blockFile);
  }
  final File metaFile=replicaToDelete.getMetaFile();
  if (!metaFile.delete()) {
    LOG.warn("Failed to delete meta file " + metaFile);
  }
  return replicaToKeep;
}
