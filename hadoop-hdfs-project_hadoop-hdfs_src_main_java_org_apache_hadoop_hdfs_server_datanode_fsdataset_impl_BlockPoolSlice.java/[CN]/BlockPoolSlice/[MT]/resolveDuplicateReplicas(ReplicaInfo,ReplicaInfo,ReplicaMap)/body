{
  if (!deleteDuplicateReplicas) {
    return replica1;
  }
  ReplicaInfo replicaToKeep;
  ReplicaInfo replicaToDelete;
  if (replica1.getGenerationStamp() != replica2.getGenerationStamp()) {
    replicaToKeep=replica1.getGenerationStamp() > replica2.getGenerationStamp() ? replica1 : replica2;
  }
 else   if (replica1.getNumBytes() != replica2.getNumBytes()) {
    replicaToKeep=replica1.getNumBytes() > replica2.getNumBytes() ? replica1 : replica2;
  }
 else   if (replica1.getVolume().isTransientStorage() && !replica2.getVolume().isTransientStorage()) {
    replicaToKeep=replica2;
  }
 else {
    replicaToKeep=replica1;
  }
  replicaToDelete=(replicaToKeep == replica1) ? replica2 : replica1;
  volumeMap.add(bpid,replicaToKeep);
  replicaToDelete.getBlockFile().delete();
  replicaToDelete.getMetaFile().delete();
  FsDatasetImpl.LOG.info("resolveDuplicateReplicas keeping " + replicaToKeep.getBlockFile() + ", deleting "+ replicaToDelete.getBlockFile());
  return replicaToKeep;
}
