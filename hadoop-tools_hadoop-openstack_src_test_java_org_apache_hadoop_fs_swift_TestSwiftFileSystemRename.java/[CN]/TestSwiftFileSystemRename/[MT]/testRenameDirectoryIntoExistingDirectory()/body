{
  assumeRenameSupported();
  Path src=path("/test/olddir/dir");
  fs.mkdirs(src);
  createFile(path("/test/olddir/dir/file1"));
  createFile(path("/test/olddir/dir/subdir/file2"));
  Path dst=path("/test/new/newdir");
  fs.mkdirs(dst);
  rename(src,dst,true,false,true);
  assertExists("new dir",path("/test/new/newdir/dir"));
  assertExists("Renamed nested file1",path("/test/new/newdir/dir/file1"));
  assertPathDoesNotExist("Nested file1 should have been deleted",path("/test/olddir/dir/file1"));
  assertExists("Renamed nested subdir",path("/test/new/newdir/dir/subdir/"));
  assertExists("file under subdir",path("/test/new/newdir/dir/subdir/file2"));
  assertPathDoesNotExist("Nested /test/hadoop/dir/subdir/file2 still exists",path("/test/olddir/dir/subdir/file2"));
}
