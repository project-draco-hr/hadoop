{
  writeSnapshot(out);
  out.writeInt(childrenSize);
  out.writeBoolean(isSnapshotRoot);
  if (!isSnapshotRoot) {
    if (snapshotINode != null) {
      out.writeBoolean(true);
      FSImageSerialization.writeINodeDirectoryAttributes(snapshotINode,out);
    }
 else {
      out.writeBoolean(false);
    }
  }
  diff.write(out,referenceMap);
}
