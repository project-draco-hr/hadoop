{
  ContainerExecutor exec=mock(ContainerExecutor.class);
  LocalizerTracker mockLocalizerTracker=mock(LocalizerTracker.class);
  DeletionService delService=mock(DeletionService.class);
  NMContext nmContext=new NMContext(new NMContainerTokenSecretManager(conf),new NMTokenSecretManagerInNM(),null,new ApplicationACLsManager(conf),stateStore,false);
  ResourceLocalizationService rawService=new ResourceLocalizationService(dispatcher,exec,delService,dirsHandler,nmContext);
  ResourceLocalizationService spyService=spy(rawService);
  doReturn(mockServer).when(spyService).createServer();
  doReturn(mockLocalizerTracker).when(spyService).createLocalizerTracker(isA(Configuration.class));
  doReturn(lfs).when(spyService).getLocalFileContext(isA(Configuration.class));
  return spyService;
}
