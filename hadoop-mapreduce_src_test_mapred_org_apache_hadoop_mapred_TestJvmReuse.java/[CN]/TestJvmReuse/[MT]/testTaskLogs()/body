{
  MiniMRCluster mr=null;
  try {
    Configuration conf=new Configuration();
    final int taskTrackers=1;
    conf.setInt("mapred.tasktracker.map.tasks.maximum",1);
    mr=new MiniMRCluster(taskTrackers,"file:///",1);
    final Path inDir=new Path(rootDir,"input");
    final Path outDir=new Path(rootDir,"output");
    JobConf jobConf=mr.createJobConf();
    jobConf.setOutputCommitter(TestTaskFail.CommitterWithLogs.class);
    RunningJob rJob=launchJob(jobConf,inDir,outDir);
    rJob.waitForCompletion();
    validateJob(rJob,mr);
  }
  finally {
    if (mr != null) {
      mr.shutdown();
    }
  }
}
