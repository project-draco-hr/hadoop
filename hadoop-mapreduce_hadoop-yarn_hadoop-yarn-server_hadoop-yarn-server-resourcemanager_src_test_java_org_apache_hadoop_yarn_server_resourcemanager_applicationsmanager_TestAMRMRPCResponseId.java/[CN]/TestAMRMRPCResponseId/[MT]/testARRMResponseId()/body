{
  MockNM nm1=rm.registerNode("h1:1234",5000);
  RMApp app=rm.submitApp(2000);
  nm1.nodeHeartbeat(true);
  RMAppAttempt attempt=app.getCurrentAppAttempt();
  MockAM am=rm.sendAMLaunched(attempt.getAppAttemptId());
  am.registerAppAttempt();
  AllocateRequest allocateRequest=recordFactory.newRecordInstance(AllocateRequest.class);
  allocateRequest.setApplicationAttemptId(attempt.getAppAttemptId());
  AMResponse response=amService.allocate(allocateRequest).getAMResponse();
  Assert.assertEquals(1,response.getResponseId());
  Assert.assertFalse(response.getReboot());
  allocateRequest.setResponseId(response.getResponseId());
  response=amService.allocate(allocateRequest).getAMResponse();
  Assert.assertEquals(2,response.getResponseId());
  response=amService.allocate(allocateRequest).getAMResponse();
  Assert.assertEquals(2,response.getResponseId());
  allocateRequest.setResponseId(0);
  response=amService.allocate(allocateRequest).getAMResponse();
  Assert.assertTrue(response.getReboot());
}
