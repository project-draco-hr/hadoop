{
  if (!isLocalFS()) {
    FileSystem fs=FileSystem.get(getProxiedFSConf());
    fs.mkdirs(getProxiedFSTestDir());
    Path path=new Path(getProxiedFSTestDir(),"foo.txt");
    OutputStream os=fs.create(path);
    os.write(1);
    os.close();
    fs.close();
    final String name1="user.a1";
    final byte[] value1=new byte[]{0x31,0x32,0x33};
    final String name2="user.a2";
    final byte[] value2=new byte[]{0x41,0x42,0x43};
    final String name3="user.a3";
    final byte[] value3=null;
    final String name4="trusted.a1";
    final byte[] value4=new byte[]{0x31,0x32,0x33};
    fs=FileSystem.get(getProxiedFSConf());
    fs.setXAttr(path,name1,value1);
    fs.setXAttr(path,name2,value2);
    fs.setXAttr(path,name3,value3);
    fs.setXAttr(path,name4,value4);
    fs.close();
    fs=getHttpFSFileSystem();
    List<String> names=Lists.newArrayList();
    names.add(name1);
    names.add(name2);
    names.add(name3);
    names.add(name4);
    Map<String,byte[]> xAttrs=fs.getXAttrs(path,names);
    fs.close();
    assertEquals(4,xAttrs.size());
    assertArrayEquals(value1,xAttrs.get(name1));
    assertArrayEquals(value2,xAttrs.get(name2));
    assertArrayEquals(new byte[0],xAttrs.get(name3));
    assertArrayEquals(value4,xAttrs.get(name4));
    fs=getHttpFSFileSystem();
    byte[] value=fs.getXAttr(path,name1);
    assertArrayEquals(value1,value);
    final String name5="a1";
    try {
      value=fs.getXAttr(path,name5);
      Assert.fail("Get xAttr with incorrect name format should fail.");
    }
 catch (    IOException e) {
    }
catch (    IllegalArgumentException e) {
    }
    fs.close();
    fs=getHttpFSFileSystem();
    xAttrs=fs.getXAttrs(path);
    fs.close();
    assertEquals(4,xAttrs.size());
    assertArrayEquals(value1,xAttrs.get(name1));
    assertArrayEquals(value2,xAttrs.get(name2));
    assertArrayEquals(new byte[0],xAttrs.get(name3));
    assertArrayEquals(value4,xAttrs.get(name4));
  }
}
