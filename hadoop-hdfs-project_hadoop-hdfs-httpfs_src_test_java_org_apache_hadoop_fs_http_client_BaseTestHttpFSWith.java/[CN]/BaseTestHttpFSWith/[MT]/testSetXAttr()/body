{
  if (!isLocalFS()) {
    FileSystem fs=FileSystem.get(getProxiedFSConf());
    fs.mkdirs(getProxiedFSTestDir());
    Path path=new Path(getProxiedFSTestDir(),"foo.txt");
    OutputStream os=fs.create(path);
    os.write(1);
    os.close();
    fs.close();
    final String name1="user.a1";
    final byte[] value1=new byte[]{0x31,0x32,0x33};
    final String name2="user.a2";
    final byte[] value2=new byte[]{0x41,0x42,0x43};
    final String name3="user.a3";
    final byte[] value3=null;
    final String name4="trusted.a1";
    final byte[] value4=new byte[]{0x31,0x32,0x33};
    final String name5="a1";
    fs=getHttpFSFileSystem();
    fs.setXAttr(path,name1,value1);
    fs.setXAttr(path,name2,value2);
    fs.setXAttr(path,name3,value3);
    fs.setXAttr(path,name4,value4);
    try {
      fs.setXAttr(path,name5,value1);
      Assert.fail("Set xAttr with incorrect name format should fail.");
    }
 catch (    IOException e) {
    }
catch (    IllegalArgumentException e) {
    }
    fs.close();
    fs=FileSystem.get(getProxiedFSConf());
    Map<String,byte[]> xAttrs=fs.getXAttrs(path);
    fs.close();
    Assert.assertEquals(4,xAttrs.size());
    Assert.assertArrayEquals(value1,xAttrs.get(name1));
    Assert.assertArrayEquals(value2,xAttrs.get(name2));
    Assert.assertArrayEquals(new byte[0],xAttrs.get(name3));
    Assert.assertArrayEquals(value4,xAttrs.get(name4));
  }
}
