{
  String src=FILE_NAME_PREFIX + "foo";
  FSDataOutputStream fout=fs.create(new Path(src),true,4096,(short)1,512L);
  for (int i=0; i < 1024; i++) {
    fout.write(123);
  }
  fout.hflush();
  DFSClient dfsclient=DFSClientAdapter.getDFSClient(fs);
  LocatedBlocks blocks=dfsclient.getNamenode().getBlockLocations(src,0,Integer.MAX_VALUE);
  int orginalNumBlocks=blocks.locatedBlockCount();
  LocatedBlock b=blocks.getLastLocatedBlock();
  dfsclient.getNamenode().abandonBlock(b.getBlock(),src,dfsclient.clientName);
  dfsclient.getNamenode().abandonBlock(b.getBlock(),src,dfsclient.clientName);
  fout.close();
  cluster.restartNameNode();
  blocks=dfsclient.getNamenode().getBlockLocations(src,0,Integer.MAX_VALUE);
  Assert.assertEquals("Blocks " + b + " has not been abandoned.",orginalNumBlocks,blocks.locatedBlockCount() + 1);
}
