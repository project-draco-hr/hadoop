{
  MapWritable m=new MapWritable();
  final Text t=new Text(getName());
  m.put(t,t);
  int count=m.size();
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  DataOutputStream dos=new DataOutputStream(baos);
  m.write(dos);
  dos.close();
  m.put(new Text("key1"),new Text("value1"));
  m.put(new Text("key2"),new Text("value2"));
  ByteArrayInputStream bais=new ByteArrayInputStream(baos.toByteArray());
  DataInputStream dis=new DataInputStream(bais);
  m.readFields(dis);
  assertEquals(count,m.size());
  assertTrue(m.get(t).equals(t));
  dis.close();
}
