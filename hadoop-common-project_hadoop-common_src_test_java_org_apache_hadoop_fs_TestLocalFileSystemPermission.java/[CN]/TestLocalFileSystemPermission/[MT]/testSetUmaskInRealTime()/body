{
  assumeNotWindows();
  LocalFileSystem localfs=FileSystem.getLocal(new Configuration());
  Configuration conf=localfs.getConf();
  conf.set(CommonConfigurationKeys.FS_PERMISSIONS_UMASK_KEY,"022");
  LOGGER.info("Current umask is {}",conf.get(CommonConfigurationKeys.FS_PERMISSIONS_UMASK_KEY));
  Path dir=new Path(TEST_PATH_PREFIX + "dir");
  Path dir2=new Path(TEST_PATH_PREFIX + "dir2");
  try {
    assertTrue(localfs.mkdirs(dir));
    FsPermission initialPermission=getPermission(localfs,dir);
    assertEquals("With umask 022 permission should be 755 since the default " + "permission is 777",new FsPermission("755"),initialPermission);
    conf.set(CommonConfigurationKeys.FS_PERMISSIONS_UMASK_KEY,"062");
    assertTrue(localfs.mkdirs(dir2));
    FsPermission finalPermission=localfs.getFileStatus(dir2).getPermission();
    assertThat("With umask 062 permission should not be 755 since the " + "default permission is 777",new FsPermission("755"),is(not(finalPermission)));
    assertEquals("With umask 062 we expect 715 since the default permission is 777",new FsPermission("715"),finalPermission);
  }
  finally {
    conf.set(CommonConfigurationKeys.FS_PERMISSIONS_UMASK_KEY,"022");
    cleanup(localfs,dir);
    cleanup(localfs,dir2);
  }
}
