{
  visitor.start(inputStream.getVersion());
  while (true) {
    try {
      FSEditLogOp op=inputStream.readOp();
      if (op == null)       break;
      if (fixTxIds) {
        if (nextTxId <= 0) {
          nextTxId=op.getTransactionId();
          if (nextTxId <= 0) {
            nextTxId=1;
          }
        }
        op.setTransactionId(nextTxId);
        nextTxId++;
      }
      visitor.visitOp(op);
    }
 catch (    IOException e) {
      if (!recoveryMode) {
        visitor.close(e);
        throw e;
      }
      LOG.error("Got IOException while reading stream!  Resyncing.",e);
      inputStream.resync();
    }
catch (    RuntimeException e) {
      if (!recoveryMode) {
        visitor.close(e);
        throw e;
      }
      LOG.error("Got RuntimeException while reading stream!  Resyncing.",e);
      inputStream.resync();
    }
  }
  visitor.close(null);
}
