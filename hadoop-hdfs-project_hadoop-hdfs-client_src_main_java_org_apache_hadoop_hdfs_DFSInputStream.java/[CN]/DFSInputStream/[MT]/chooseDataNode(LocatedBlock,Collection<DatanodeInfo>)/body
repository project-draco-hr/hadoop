{
  while (true) {
    DNAddrPair result=getBestNodeDNAddrPair(block,ignoredNodes);
    if (result != null) {
      return result;
    }
 else {
      String errMsg=getBestNodeDNAddrPairErrorString(block.getLocations(),deadNodes,ignoredNodes);
      String blockInfo=block.getBlock() + " file=" + src;
      if (failures >= dfsClient.getConf().getMaxBlockAcquireFailures()) {
        String description="Could not obtain block: " + blockInfo;
        DFSClient.LOG.warn(description + errMsg + ". Throwing a BlockMissingException");
        throw new BlockMissingException(src,description,block.getStartOffset());
      }
      DatanodeInfo[] nodes=block.getLocations();
      if (nodes == null || nodes.length == 0) {
        DFSClient.LOG.info("No node available for " + blockInfo);
      }
      DFSClient.LOG.info("Could not obtain " + block.getBlock() + " from any node: "+ errMsg+ ". Will get new block locations from namenode and retry...");
      try {
        final int timeWindow=dfsClient.getConf().getTimeWindow();
        double waitTime=timeWindow * failures + timeWindow * (failures + 1) * ThreadLocalRandom.current().nextDouble();
        DFSClient.LOG.warn("DFS chooseDataNode: got # " + (failures + 1) + " IOException, will wait for "+ waitTime+ " msec.");
        Thread.sleep((long)waitTime);
      }
 catch (      InterruptedException ignored) {
      }
      deadNodes.clear();
      openInfo(true);
      block=refreshLocatedBlock(block);
      failures++;
    }
  }
}
