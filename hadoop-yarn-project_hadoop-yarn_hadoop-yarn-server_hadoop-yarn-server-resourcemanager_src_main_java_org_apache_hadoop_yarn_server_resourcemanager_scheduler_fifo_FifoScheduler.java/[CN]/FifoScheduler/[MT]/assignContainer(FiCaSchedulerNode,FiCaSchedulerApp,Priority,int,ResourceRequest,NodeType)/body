{
  LOG.debug("assignContainers:" + " node=" + node.getRMNode().getNodeAddress() + " application="+ application.getApplicationId().getId()+ " priority="+ priority.getPriority()+ " assignableContainers="+ assignableContainers+ " request="+ request+ " type="+ type);
  Resource capability=request.getCapability();
  int availableContainers=node.getAvailableResource().getMemory() / capability.getMemory();
  int assignedContainers=Math.min(assignableContainers,availableContainers);
  if (assignedContainers > 0) {
    for (int i=0; i < assignedContainers; ++i) {
      NodeId nodeId=node.getRMNode().getNodeID();
      ContainerId containerId=BuilderUtils.newContainerId(application.getApplicationAttemptId(),application.getNewContainerId());
      ContainerToken containerToken=null;
      if (UserGroupInformation.isSecurityEnabled()) {
        containerToken=this.rmContext.getContainerTokenSecretManager().createContainerToken(containerId,nodeId,application.getUser(),capability);
        if (containerToken == null) {
          return i;
        }
      }
      Container container=BuilderUtils.newContainer(containerId,nodeId,node.getRMNode().getHttpAddress(),capability,priority,containerToken);
      RMContainer rmContainer=application.allocate(type,node,priority,request,container);
      node.allocateContainer(application.getApplicationId(),rmContainer);
      Resources.addTo(usedResource,capability);
    }
  }
  return assignedContainers;
}
