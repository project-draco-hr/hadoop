{
  LOG.debug("assignContainers:" + " node=" + node.getRMNode().getNodeAddress() + " #applications="+ applications.size());
  for (  Map.Entry<ApplicationId,SchedulerApplication<FiCaSchedulerApp>> e : applications.entrySet()) {
    FiCaSchedulerApp application=e.getValue().getCurrentAppAttempt();
    if (application == null) {
      continue;
    }
    LOG.debug("pre-assignContainers");
    application.showRequests();
synchronized (application) {
      if (SchedulerAppUtils.isPlaceBlacklisted(application,node,LOG)) {
        continue;
      }
      for (      SchedulerRequestKey schedulerKey : application.getSchedulerKeys()) {
        int maxContainers=getMaxAllocatableContainers(application,schedulerKey,node,NodeType.OFF_SWITCH);
        if (maxContainers > 0) {
          int assignedContainers=assignContainersOnNode(node,application,schedulerKey);
          if (assignedContainers == 0) {
            break;
          }
        }
      }
    }
    LOG.debug("post-assignContainers");
    application.showRequests();
    if (Resources.lessThan(resourceCalculator,getClusterResource(),node.getUnallocatedResource(),minimumAllocation)) {
      break;
    }
  }
  for (  SchedulerApplication<FiCaSchedulerApp> application : applications.values()) {
    FiCaSchedulerApp attempt=(FiCaSchedulerApp)application.getCurrentAppAttempt();
    if (attempt == null) {
      continue;
    }
    updateAppHeadRoom(attempt);
  }
}
