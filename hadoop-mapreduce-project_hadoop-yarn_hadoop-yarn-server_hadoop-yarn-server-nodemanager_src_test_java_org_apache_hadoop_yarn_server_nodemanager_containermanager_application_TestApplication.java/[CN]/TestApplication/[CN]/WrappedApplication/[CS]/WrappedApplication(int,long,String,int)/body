{
  dispatcher=new DrainDispatcher();
  dispatcher.init(null);
  localizerBus=mock(EventHandler.class);
  launcherBus=mock(EventHandler.class);
  monitorBus=mock(EventHandler.class);
  auxBus=mock(EventHandler.class);
  containerBus=mock(EventHandler.class);
  logAggregationBus=mock(EventHandler.class);
  dispatcher.register(LocalizationEventType.class,localizerBus);
  dispatcher.register(ContainersLauncherEventType.class,launcherBus);
  dispatcher.register(ContainersMonitorEventType.class,monitorBus);
  dispatcher.register(AuxServicesEventType.class,auxBus);
  dispatcher.register(ContainerEventType.class,containerBus);
  dispatcher.register(LogAggregatorEventType.class,logAggregationBus);
  context=mock(Context.class);
  this.user=user;
  this.appId=BuilderUtils.newApplicationId(timestamp,id);
  app=new ApplicationImpl(dispatcher,new ApplicationACLsManager(new Configuration()),this.user,appId,null,context);
  containers=new ArrayList<Container>();
  for (int i=0; i < numContainers; i++) {
    containers.add(createMockedContainer(this.appId,i));
  }
  dispatcher.start();
}
