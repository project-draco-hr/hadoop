{
  WrappedApplication wa=null;
  try {
    wa=new WrappedApplication(2,314159265358979L,"yak",3);
    wa.initApplication(0);
    assertEquals(ApplicationState.INITING,wa.app.getApplicationState());
    assertEquals(1,wa.app.getContainers().size());
    wa.applicationInited();
    assertEquals(ApplicationState.RUNNING,wa.app.getApplicationState());
    verify(wa.containerBus).handle(argThat(new ContainerInitMatcher(wa.containers.get(0).getContainerID())));
    wa.initApplication(1);
    wa.initApplication(2);
    assertEquals(ApplicationState.RUNNING,wa.app.getApplicationState());
    assertEquals(3,wa.app.getContainers().size());
    for (int i=1; i < wa.containers.size(); i++) {
      verify(wa.containerBus).handle(argThat(new ContainerInitMatcher(wa.containers.get(i).getContainerID())));
    }
  }
  finally {
    if (wa != null)     wa.finished();
  }
}
