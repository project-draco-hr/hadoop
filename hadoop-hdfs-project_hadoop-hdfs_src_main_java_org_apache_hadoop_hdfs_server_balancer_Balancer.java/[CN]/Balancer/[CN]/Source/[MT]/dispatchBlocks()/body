{
  long startTime=Time.now();
  this.blocksToReceive=2 * scheduledSize;
  boolean isTimeUp=false;
  while (!isTimeUp && scheduledSize > 0 && (!srcBlockList.isEmpty() || blocksToReceive > 0)) {
    PendingBlockMove pendingBlock=chooseNextBlockToMove();
    if (pendingBlock != null) {
      pendingBlock.scheduleBlockMove();
      continue;
    }
    filterMovedBlocks();
    if (shouldFetchMoreBlocks()) {
      try {
        blocksToReceive-=getBlockList();
        continue;
      }
 catch (      IOException e) {
        LOG.warn("Exception while getting block list",e);
        return;
      }
    }
    if (Time.now() - startTime > MAX_ITERATION_TIME) {
      isTimeUp=true;
      continue;
    }
    try {
synchronized (Balancer.this) {
        Balancer.this.wait(1000);
      }
    }
 catch (    InterruptedException ignored) {
    }
  }
}
