{
  if (source.storageType != target.storageType) {
    return false;
  }
  if (movedBlocks.contains(block.getBlock())) {
    return false;
  }
  if (block.isLocatedOn(target)) {
    return false;
  }
  if (cluster.isNodeGroupAware() && isOnSameNodeGroupWithReplicas(target,block,source)) {
    return false;
  }
  boolean goodBlock=false;
  if (cluster.isOnSameRack(source.getDatanode(),target.getDatanode())) {
    goodBlock=true;
  }
 else {
    boolean notOnSameRack=true;
synchronized (block) {
      for (      BalancerDatanode.StorageGroup loc : block.getLocations()) {
        if (cluster.isOnSameRack(loc.getDatanode(),target.getDatanode())) {
          notOnSameRack=false;
          break;
        }
      }
    }
    if (notOnSameRack) {
      goodBlock=true;
    }
 else {
      for (      BalancerDatanode.StorageGroup loc : block.getLocations()) {
        if (loc != source && cluster.isOnSameRack(loc.getDatanode(),source.getDatanode())) {
          goodBlock=true;
          break;
        }
      }
    }
  }
  return goodBlock;
}
