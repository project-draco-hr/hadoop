{
  if (cluster.isNodeGroupAware()) {
    chooseStorageGroups(Matcher.SAME_NODE_GROUP);
  }
  chooseStorageGroups(Matcher.SAME_RACK);
  chooseStorageGroups(Matcher.ANY_OTHER);
  Preconditions.checkState(storageGroupMap.size() >= sources.size() + targets.size(),"Mismatched number of datanodes (" + storageGroupMap.size() + " < "+ sources.size()+ " sources, "+ targets.size()+ " targets)");
  long bytesToMove=0L;
  for (  Source src : sources) {
    bytesToMove+=src.getScheduledSize();
  }
  return bytesToMove;
}
