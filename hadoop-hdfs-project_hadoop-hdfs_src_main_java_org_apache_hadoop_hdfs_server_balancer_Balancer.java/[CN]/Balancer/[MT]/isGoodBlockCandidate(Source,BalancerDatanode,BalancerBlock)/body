{
  if (movedBlocks.contains(block)) {
    return false;
  }
  if (block.isLocatedOnDatanode(target)) {
    return false;
  }
  boolean goodBlock=false;
  if (cluster.isOnSameRack(source.getDatanode(),target.getDatanode())) {
    goodBlock=true;
  }
 else {
    boolean notOnSameRack=true;
synchronized (block) {
      for (      BalancerDatanode loc : block.locations) {
        if (cluster.isOnSameRack(loc.datanode,target.datanode)) {
          notOnSameRack=false;
          break;
        }
      }
    }
    if (notOnSameRack) {
      goodBlock=true;
    }
 else {
      for (      BalancerDatanode loc : block.locations) {
        if (loc != source && cluster.isOnSameRack(loc.datanode,source.datanode)) {
          goodBlock=true;
          break;
        }
      }
    }
  }
  return goodBlock;
}
