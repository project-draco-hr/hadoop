{
  final long sleeptime=2000 * conf.getLong(DFSConfigKeys.DFS_HEARTBEAT_INTERVAL_KEY,DFSConfigKeys.DFS_HEARTBEAT_INTERVAL_DEFAULT);
  LOG.info("namenodes  = " + namenodes);
  LOG.info("parameters = " + p);
  final Formatter formatter=new Formatter(System.out);
  System.out.println("Time Stamp               Iteration#  Bytes Already Moved  Bytes Left To Move  Bytes Being Moved");
  List<NameNodeConnector> connectors=Collections.emptyList();
  try {
    connectors=NameNodeConnector.newNameNodeConnectors(namenodes,Balancer.class.getSimpleName(),BALANCER_ID_PATH,conf);
    boolean done=false;
    for (int iteration=0; !done; iteration++) {
      done=true;
      Collections.shuffle(connectors);
      for (      NameNodeConnector nnc : connectors) {
        final Balancer b=new Balancer(nnc,p,conf);
        final ExitStatus r=b.run(iteration,formatter,conf);
        b.resetData(conf);
        if (r == ExitStatus.IN_PROGRESS) {
          done=false;
        }
 else         if (r != ExitStatus.SUCCESS) {
          return r.getExitCode();
        }
      }
      if (!done) {
        Thread.sleep(sleeptime);
      }
    }
  }
  finally {
    for (    NameNodeConnector nnc : connectors) {
      IOUtils.cleanup(LOG,nnc);
    }
  }
  return ExitStatus.SUCCESS.getExitCode();
}
