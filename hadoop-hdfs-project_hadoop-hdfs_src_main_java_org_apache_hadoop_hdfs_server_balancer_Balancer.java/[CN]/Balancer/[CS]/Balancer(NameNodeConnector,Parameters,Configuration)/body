{
  this.threshold=p.threshold;
  this.policy=p.policy;
  this.nodesToBeExcluded=p.nodesToBeExcluded;
  this.nodesToBeIncluded=p.nodesToBeIncluded;
  this.nnc=theblockpool;
  this.keyManager=nnc.getKeyManager();
  final long movedWinWidth=conf.getLong(DFSConfigKeys.DFS_BALANCER_MOVEDWINWIDTH_KEY,DFSConfigKeys.DFS_BALANCER_MOVEDWINWIDTH_DEFAULT);
  movedBlocks=new MovedBlocks<BalancerDatanode.StorageGroup>(movedWinWidth);
  cluster=NetworkTopology.getInstance(conf);
  this.moverExecutor=Executors.newFixedThreadPool(conf.getInt(DFSConfigKeys.DFS_BALANCER_MOVERTHREADS_KEY,DFSConfigKeys.DFS_BALANCER_MOVERTHREADS_DEFAULT));
  this.dispatcherExecutor=Executors.newFixedThreadPool(conf.getInt(DFSConfigKeys.DFS_BALANCER_DISPATCHERTHREADS_KEY,DFSConfigKeys.DFS_BALANCER_DISPATCHERTHREADS_DEFAULT));
  this.maxConcurrentMovesPerNode=conf.getInt(DFSConfigKeys.DFS_DATANODE_BALANCE_MAX_NUM_CONCURRENT_MOVES_KEY,DFSConfigKeys.DFS_DATANODE_BALANCE_MAX_NUM_CONCURRENT_MOVES_DEFAULT);
  this.saslClient=new SaslDataTransferClient(DataTransferSaslUtil.getSaslPropertiesResolver(conf),TrustedChannelResolver.getInstance(conf),conf.getBoolean(IPC_CLIENT_FALLBACK_TO_SIMPLE_AUTH_ALLOWED_KEY,IPC_CLIENT_FALLBACK_TO_SIMPLE_AUTH_ALLOWED_DEFAULT));
}
