{
  MemoryRMStateStore memStore=new MemoryRMStateStore(){
    @Override public synchronized void updateApplicationAttemptStateInternal(    ApplicationAttemptId appAttemptId,    ApplicationAttemptStateData attemptState){
    }
  }
;
  memStore.init(conf);
  rm1=new MockRM(conf,memStore);
  rm1.start();
  MockNM nm1=new MockNM("127.0.0.1:1234",15120,rm1.getResourceTrackerService());
  nm1.registerNode();
  RMApp app1=rm1.submitApp(200);
  MockAM am1=MockRM.launchAndRegisterAM(app1,rm1,nm1);
  MockRM.finishAMAndVerifyAppState(app1,rm1,nm1,am1);
  ApplicationStateData appSavedState=memStore.getState().getApplicationState().get(app1.getApplicationId());
  assertEquals(RMAppState.FINISHED,appSavedState.getState());
  assertNull(appSavedState.getAttempt(am1.getApplicationAttemptId()).getState());
  rm2=new MockRM(conf,memStore);
  rm2.start();
  RMApp recoveredApp1=rm2.getRMContext().getRMApps().get(app1.getApplicationId());
  assertEquals(RMAppState.FINISHED,recoveredApp1.getState());
  assertEquals(RMAppAttemptState.FINISHED,recoveredApp1.getCurrentAppAttempt().getState());
}
