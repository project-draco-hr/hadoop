{
  hdfs.mkdirs(sub);
  int bytesRead;
  byte[] buffer=new byte[BLOCKSIZE * 8];
  FSDataInputStream fis=null;
  FileStatus fileStatus=null;
  Path file1=new Path(sub,file1Name);
  DFSTestUtil.createFile(hdfs,file1,0,REPLICATION,SEED);
  DFSTestUtil.appendFile(hdfs,file1,BLOCKSIZE);
  hdfs.allowSnapshot(sub);
  hdfs.createSnapshot(sub,snapshot1);
  DFSTestUtil.appendFile(hdfs,file1,BLOCKSIZE);
  fileStatus=hdfs.getFileStatus(file1);
  assertThat(fileStatus.getLen(),is((long)BLOCKSIZE * 2));
  fis=hdfs.open(file1);
  bytesRead=fis.read(0,buffer,0,buffer.length);
  assertThat(bytesRead,is(BLOCKSIZE * 2));
  fis.close();
  Path file1snap1=SnapshotTestHelper.getSnapshotPath(sub,snapshot1,file1Name);
  fis=hdfs.open(file1snap1);
  fileStatus=hdfs.getFileStatus(file1snap1);
  assertThat(fileStatus.getLen(),is((long)BLOCKSIZE));
  bytesRead=fis.read(0,buffer,0,buffer.length);
  assertThat(bytesRead,is(BLOCKSIZE));
  fis.close();
}
