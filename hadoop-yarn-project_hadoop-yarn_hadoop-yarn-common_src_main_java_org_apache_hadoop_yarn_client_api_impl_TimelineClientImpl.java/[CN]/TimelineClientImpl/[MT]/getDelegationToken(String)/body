{
  boolean isProxyAccess=UserGroupInformation.getCurrentUser().getAuthenticationMethod() == UserGroupInformation.AuthenticationMethod.PROXY;
  final String doAsUser=isProxyAccess ? UserGroupInformation.getCurrentUser().getShortUserName() : null;
  PrivilegedExceptionAction<Token<TimelineDelegationTokenIdentifier>> getDTAction=new PrivilegedExceptionAction<Token<TimelineDelegationTokenIdentifier>>(){
    @Override public Token<TimelineDelegationTokenIdentifier> run() throws Exception {
      DelegationTokenAuthenticatedURL authUrl=new DelegationTokenAuthenticatedURL(authenticator,connConfigurator);
      return (Token)authUrl.getDelegationToken(resURI.toURL(),token,renewer,doAsUser);
    }
  }
;
  return (Token<TimelineDelegationTokenIdentifier>)operateDelegationToken(getDTAction);
}
