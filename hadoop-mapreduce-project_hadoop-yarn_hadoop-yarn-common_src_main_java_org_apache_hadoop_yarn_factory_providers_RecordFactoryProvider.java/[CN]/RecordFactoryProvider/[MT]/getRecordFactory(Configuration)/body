{
  if (conf == null) {
    conf=defaultConf;
  }
  String recordFactoryClassName=conf.get(RECORD_FACTORY_CLASS_KEY);
  if (recordFactoryClassName == null) {
    String serializer=conf.get(RPC_SERIALIZER_KEY,RPC_SERIALIZER_DEFAULT);
    if (serializer.equals(RPC_SERIALIZER_DEFAULT)) {
      return RecordFactoryPBImpl.get();
    }
 else {
      throw new YarnException("Unknown serializer: [" + conf.get(RPC_SERIALIZER_KEY) + "]. Use keys: ["+ RECORD_FACTORY_CLASS_KEY+ "] to specify Record factory");
    }
  }
 else {
    return (RecordFactory)getFactoryClassInstance(recordFactoryClassName);
  }
}
