{
  try {
    DatanodeProtocolClientSideTranslatorPB nnSpy=spyOnDnCallsToNn();
    injectBlockReceived();
    injectBlockReceived();
    Thread.sleep(2000);
    Mockito.verify(nnSpy,atLeastOnce()).blockReceivedAndDeleted(any(DatanodeRegistration.class),anyString(),any(StorageReceivedDeletedBlocks[].class));
    assertFalse(actor.hasPendingIBR());
  }
  finally {
    cluster.shutdown();
    cluster=null;
  }
}
