{
  InetSocketAddress serviceAddr=null;
  if (clientService != null) {
    serviceAddr=clientService.getBindAddress();
  }
  try {
    RegisterApplicationMasterRequest request=recordFactory.newRecordInstance(RegisterApplicationMasterRequest.class);
    if (serviceAddr != null) {
      request.setHost(serviceAddr.getHostName());
      request.setRpcPort(serviceAddr.getPort());
      request.setTrackingUrl(MRWebAppUtil.getAMWebappScheme(getConfig()) + serviceAddr.getHostName() + ":"+ clientService.getHttpPort());
    }
    RegisterApplicationMasterResponse response=scheduler.registerApplicationMaster(request);
    isApplicationMasterRegistered=true;
    maxContainerCapability=response.getMaximumResourceCapability();
    this.context.getClusterInfo().setMaxContainerCapability(maxContainerCapability);
    if (UserGroupInformation.isSecurityEnabled()) {
      setClientToAMToken(response.getClientToAMTokenMasterKey());
    }
    this.applicationACLs=response.getApplicationACLs();
    LOG.info("maxContainerCapability: " + maxContainerCapability);
    String queue=response.getQueue();
    LOG.info("queue: " + queue);
    job.setQueueName(queue);
    this.schedulerResourceTypes.addAll(response.getSchedulerResourceTypes());
  }
 catch (  Exception are) {
    LOG.error("Exception while registering",are);
    throw new YarnRuntimeException(are);
  }
}
