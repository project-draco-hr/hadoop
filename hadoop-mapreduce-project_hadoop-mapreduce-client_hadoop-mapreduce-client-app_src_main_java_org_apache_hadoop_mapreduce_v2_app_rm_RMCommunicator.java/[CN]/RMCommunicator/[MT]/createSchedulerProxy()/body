{
  final Configuration conf=getConfig();
  final YarnRPC rpc=YarnRPC.create(conf);
  final InetSocketAddress serviceAddr=conf.getSocketAddr(YarnConfiguration.RM_SCHEDULER_ADDRESS,YarnConfiguration.DEFAULT_RM_SCHEDULER_ADDRESS,YarnConfiguration.DEFAULT_RM_SCHEDULER_PORT);
  UserGroupInformation currentUser;
  try {
    currentUser=UserGroupInformation.getCurrentUser();
  }
 catch (  IOException e) {
    throw new YarnRuntimeException(e);
  }
  return currentUser.doAs(new PrivilegedAction<ApplicationMasterProtocol>(){
    @Override public ApplicationMasterProtocol run(){
      return (ApplicationMasterProtocol)rpc.getProxy(ApplicationMasterProtocol.class,serviceAddr,conf);
    }
  }
);
}
