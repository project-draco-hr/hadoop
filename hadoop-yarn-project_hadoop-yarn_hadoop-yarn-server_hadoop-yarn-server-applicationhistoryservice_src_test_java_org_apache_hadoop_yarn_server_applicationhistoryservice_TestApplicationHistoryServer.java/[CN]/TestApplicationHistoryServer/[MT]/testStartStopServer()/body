{
  ApplicationHistoryServer historyServer=new ApplicationHistoryServer();
  Configuration config=new YarnConfiguration();
  config.setClass(YarnConfiguration.TIMELINE_SERVICE_STORE,MemoryTimelineStore.class,TimelineStore.class);
  config.set(YarnConfiguration.TIMELINE_SERVICE_WEBAPP_ADDRESS,"localhost:0");
  try {
    historyServer.init(config);
    assertEquals(STATE.INITED,historyServer.getServiceState());
    assertEquals(5,historyServer.getServices().size());
    ApplicationHistoryClientService historyService=historyServer.getClientService();
    assertNotNull(historyServer.getClientService());
    assertEquals(STATE.INITED,historyService.getServiceState());
    historyServer.start();
    assertEquals(STATE.STARTED,historyServer.getServiceState());
    assertEquals(STATE.STARTED,historyService.getServiceState());
    historyServer.stop();
    assertEquals(STATE.STOPPED,historyServer.getServiceState());
  }
  finally {
    historyServer.stop();
  }
}
