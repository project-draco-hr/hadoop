{
  final BlockStoragePolicy policy=blockStoragePolicies.getPolicy(status.getStoragePolicy());
  final List<StorageType> types=policy.chooseStorageTypes(status.getReplication());
  final LocatedBlocks locatedBlocks=status.getBlockLocations();
  boolean hasRemaining=false;
  final boolean lastBlkComplete=locatedBlocks.isLastBlockComplete();
  List<LocatedBlock> lbs=locatedBlocks.getLocatedBlocks();
  for (int i=0; i < lbs.size(); i++) {
    if (i == lbs.size() - 1 && !lastBlkComplete) {
      continue;
    }
    LocatedBlock lb=lbs.get(i);
    final StorageTypeDiff diff=new StorageTypeDiff(types,lb.getStorageTypes());
    if (!diff.removeOverlap()) {
      if (scheduleMoves4Block(diff,lb)) {
        hasRemaining|=(diff.existing.size() > 1 && diff.expected.size() > 1);
      }
    }
  }
  return hasRemaining;
}
