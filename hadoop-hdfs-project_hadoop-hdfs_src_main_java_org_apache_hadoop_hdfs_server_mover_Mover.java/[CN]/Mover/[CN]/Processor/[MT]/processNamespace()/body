{
  getSnapshottableDirs();
  boolean hasRemaining=false;
  for (  Path target : targetPaths) {
    hasRemaining|=processPath(target.toUri().getPath());
  }
  boolean hasFailed=Dispatcher.waitForMoveCompletion(storages.targets.values());
  if (hasFailed) {
    if (retryCount.get() == retryMaxAttempts) {
      throw new IOException("Failed to move some block's after " + retryMaxAttempts + " retries.");
    }
 else {
      retryCount.incrementAndGet();
    }
  }
 else {
    retryCount.set(0);
  }
  hasRemaining|=hasFailed;
  return hasRemaining;
}
