{
  getSnapshottableDirs();
  Result result=new Result();
  for (  Path target : targetPaths) {
    processPath(target.toUri().getPath(),result);
  }
  boolean hasFailed=Dispatcher.waitForMoveCompletion(storages.targets.values());
  if (hasFailed) {
    if (retryCount.get() == retryMaxAttempts) {
      throw new IOException("Failed to move some block's after " + retryMaxAttempts + " retries.");
    }
 else {
      retryCount.incrementAndGet();
    }
  }
 else {
    retryCount.set(0);
  }
  result.updateHasRemaining(hasFailed);
  return result;
}
