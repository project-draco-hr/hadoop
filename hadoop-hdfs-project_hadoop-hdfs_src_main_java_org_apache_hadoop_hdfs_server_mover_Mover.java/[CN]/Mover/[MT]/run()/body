{
  try {
    final List<DatanodeStorageReport> reports=dispatcher.init();
    for (    DatanodeStorageReport r : reports) {
      final DDatanode dn=dispatcher.newDatanode(r.getDatanodeInfo());
      for (      StorageType t : StorageType.asList()) {
        final long maxRemaining=getMaxRemaining(r,t);
        if (maxRemaining > 0L) {
          final Source source=dn.addSource(t,Long.MAX_VALUE,dispatcher);
          final StorageGroup target=dn.addTarget(t,maxRemaining);
          storages.add(source,target);
        }
      }
    }
    new Processor().processNamespace();
    return ExitStatus.IN_PROGRESS;
  }
 catch (  IllegalArgumentException e) {
    System.out.println(e + ".  Exiting ...");
    return ExitStatus.ILLEGAL_ARGUMENTS;
  }
catch (  IOException e) {
    System.out.println(e + ".  Exiting ...");
    return ExitStatus.IO_EXCEPTION;
  }
 finally {
    dispatcher.shutdownNow();
  }
}
