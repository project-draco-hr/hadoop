{
  initStoragePolicies();
  final List<DatanodeStorageReport> reports=dispatcher.init();
  for (  DatanodeStorageReport r : reports) {
    final DDatanode dn=dispatcher.newDatanode(r.getDatanodeInfo());
    for (    StorageType t : StorageType.getMovableTypes()) {
      final Source source=dn.addSource(t,Long.MAX_VALUE,dispatcher);
      final long maxRemaining=getMaxRemaining(r,t);
      final StorageGroup target=maxRemaining > 0L ? dn.addTarget(t,maxRemaining) : null;
      storages.add(source,target);
    }
  }
}
