{
  int length=(int)replica.length();
  ByteArrayOutputStream content=new ByteArrayOutputStream(length);
  FileInputStream in=new FileInputStream(replica);
  try {
    byte[] buffer=new byte[1024];
    int total=0;
    while (total < length) {
      int n=in.read(buffer);
      if (n <= 0) {
        break;
      }
      content.write(buffer,0,n);
      total+=n;
    }
    if (total < length) {
      Assert.fail("Failed to read all content of replica");
    }
    return content.toByteArray();
  }
  finally {
    in.close();
  }
}
