{
  SecurityUtilTestHelper.setTokenServiceUseIp(true);
  Configuration conf=new Configuration();
  URI webHdfsUri=URI.create("webhdfs://localhost:0");
  UserGroupInformation ugi=UserGroupInformation.getCurrentUser();
  Token<?> token=null;
  Token<?> hdfsToken=new Token<TokenIdentifier>(new byte[0],new byte[0],DelegationTokenIdentifier.HDFS_DELEGATION_KIND,new Text("127.0.0.1:8020"));
  ugi.addToken(hdfsToken);
  WebHdfsFileSystem fs=(WebHdfsFileSystem)FileSystem.get(webHdfsUri,conf);
  token=fs.selectDelegationToken();
  assertNotNull(token);
  assertEquals(hdfsToken,token);
  Token<?> webHdfsToken=new Token<TokenIdentifier>(new byte[0],new byte[0],WebHdfsFileSystem.TOKEN_KIND,new Text("127.0.0.1:0"));
  ugi.addToken(webHdfsToken);
  token=fs.selectDelegationToken();
  assertNotNull(token);
  assertEquals(webHdfsToken,token);
  SecurityUtilTestHelper.setTokenServiceUseIp(false);
  token=fs.selectDelegationToken();
  assertNull(token);
  hdfsToken=new Token<TokenIdentifier>(new byte[0],new byte[0],DelegationTokenIdentifier.HDFS_DELEGATION_KIND,new Text("localhost:8020"));
  ugi.addToken(hdfsToken);
  token=fs.selectDelegationToken();
  assertNotNull(token);
  assertEquals(hdfsToken,token);
  webHdfsToken=new Token<TokenIdentifier>(new byte[0],new byte[0],WebHdfsFileSystem.TOKEN_KIND,new Text("localhost:0"));
  ugi.addToken(webHdfsToken);
  token=fs.selectDelegationToken();
  assertNotNull(token);
  assertEquals(webHdfsToken,token);
}
