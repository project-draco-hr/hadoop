{
  lock.lock();
  try {
    HashMap<DatanodeInfo,PerDatanodeVisitorInfo> info=new HashMap<DatanodeInfo,PerDatanodeVisitorInfo>();
    for (    Entry<DatanodeInfo,EndpointShmManager> entry : datanodes.entrySet()) {
      info.put(entry.getKey(),entry.getValue().getVisitorInfo());
    }
    visitor.visit(info);
  }
  finally {
    lock.unlock();
  }
}
