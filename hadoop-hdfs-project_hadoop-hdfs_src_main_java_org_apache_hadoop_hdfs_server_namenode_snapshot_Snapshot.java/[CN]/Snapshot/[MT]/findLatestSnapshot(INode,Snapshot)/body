{
  Snapshot latest=null;
  for (; inode != null; inode=inode.getParent()) {
    if (inode.isDirectory()) {
      final INodeDirectory dir=inode.asDirectory();
      if (dir instanceof INodeDirectoryWithSnapshot) {
        final Snapshot s=((INodeDirectoryWithSnapshot)dir).getDiffs().getPrior(anchor);
        if (latest == null || (s != null && ID_COMPARATOR.compare(latest,s) < 0)) {
          latest=s;
        }
      }
    }
  }
  return latest;
}
