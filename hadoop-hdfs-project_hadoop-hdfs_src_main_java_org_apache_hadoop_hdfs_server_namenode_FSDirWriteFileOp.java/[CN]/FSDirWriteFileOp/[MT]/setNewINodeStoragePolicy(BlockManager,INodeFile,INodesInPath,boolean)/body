{
  if (isLazyPersist) {
    BlockStoragePolicy lpPolicy=bm.getStoragePolicy("LAZY_PERSIST");
    if (lpPolicy == null) {
      throw new HadoopIllegalArgumentException("The LAZY_PERSIST storage policy has been disabled " + "by the administrator.");
    }
    inode.setStoragePolicyID(lpPolicy.getId(),iip.getLatestSnapshotId());
  }
 else {
    BlockStoragePolicy effectivePolicy=bm.getStoragePolicy(inode.getStoragePolicyID());
    if (effectivePolicy != null && effectivePolicy.isCopyOnCreateFile()) {
      inode.setStoragePolicyID(effectivePolicy.getId(),iip.getLatestSnapshotId());
    }
  }
}
