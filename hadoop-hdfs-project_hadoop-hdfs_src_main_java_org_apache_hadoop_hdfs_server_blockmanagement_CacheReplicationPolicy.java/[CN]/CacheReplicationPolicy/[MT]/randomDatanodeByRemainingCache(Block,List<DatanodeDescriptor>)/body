{
  Collections.shuffle(targets);
  TreeMap<Long,DatanodeDescriptor> lottery=new TreeMap<Long,DatanodeDescriptor>();
  long totalCacheAvailable=0;
  for (  DatanodeDescriptor dn : targets) {
    long remaining=dn.getCacheRemaining();
    totalCacheAvailable+=remaining;
    lottery.put(totalCacheAvailable,dn);
  }
  RandomData r=new RandomDataImpl();
  long winningTicket=r.nextLong(0,totalCacheAvailable - 1);
  Entry<Long,DatanodeDescriptor> winner=lottery.higherEntry(winningTicket);
  return winner.getValue();
}
