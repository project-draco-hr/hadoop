{
  LOG.info("Recovering File Lease");
  cluster.setLeasePeriod(1000,HdfsConstants.LEASE_HARDLIMIT_PERIOD);
  int tries=60;
  boolean recovered=false;
  FSDataOutputStream out=null;
  while (!recovered && tries-- > 0) {
    try {
      out=fs.append(file1);
      LOG.info("Successfully opened for append");
      recovered=true;
    }
 catch (    IOException e) {
      LOG.info("Failed open for append, waiting on lease recovery");
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException ex) {
      }
    }
  }
  if (out != null) {
    out.close();
  }
  if (!recovered) {
    fail("Recovery should take < 1 min");
  }
  LOG.info("Past out lease recovery");
}
