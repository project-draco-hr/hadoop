{
  task.handleTaskAttemptCompletion(((TaskTAttemptEvent)event).getTaskAttemptID(),TaskAttemptCompletionEventStatus.KILLED);
  if (task.finishedAttempts == task.attempts.size()) {
    if (task.historyTaskStartGenerated) {
      TaskFailedEvent taskFailedEvent=createTaskFailedEvent(task,null,finalState,null);
      task.eventHandler.handle(new JobHistoryEvent(task.taskId.getJobId(),taskFailedEvent));
    }
 else {
      LOG.debug("Not generating HistoryFinish event since start event not" + " generated for task: " + task.getID());
    }
    task.eventHandler.handle(new JobTaskEvent(task.taskId,finalState));
    return finalState;
  }
  return task.getState();
}
