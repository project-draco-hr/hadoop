{
  TaskAttempt attempt=createAttempt();
  LOG.info("Created attempt " + attempt.getID());
switch (attempts.size()) {
case 0:
    attempts=Collections.singletonMap(attempt.getID(),attempt);
  break;
case 1:
Map newAttempts=new LinkedHashMap<TaskAttemptId,TaskAttempt>(maxAttempts);
newAttempts.putAll(attempts);
attempts=newAttempts;
attempts.put(attempt.getID(),attempt);
break;
default :
attempts.put(attempt.getID(),attempt);
break;
}
++nextAttemptNumber;
++numberUncompletedAttempts;
if (failedAttempts > 0) {
eventHandler.handle(new TaskAttemptEvent(attempt.getID(),TaskAttemptEventType.TA_RESCHEDULE));
}
 else {
eventHandler.handle(new TaskAttemptEvent(attempt.getID(),TaskAttemptEventType.TA_SCHEDULE));
}
}
