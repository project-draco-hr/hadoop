{
  try {
    List<DatanodeInfoProto> excl=req.getExcludeNodesList();
    LocatedBlock result=server.addBlock(req.getSrc(),req.getClientName(),req.hasPrevious() ? PBHelper.convert(req.getPrevious()) : null,(excl == null || excl.size() == 0) ? null : PBHelper.convert(excl.toArray(new DatanodeInfoProto[excl.size()])));
    return AddBlockResponseProto.newBuilder().setBlock(PBHelper.convert(result)).build();
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
}
