{
  try {
    ArrayList<PathCacheDirective> input=new ArrayList<PathCacheDirective>(request.getElementsCount());
    for (int i=0; i < request.getElementsCount(); i++) {
      PathCacheDirectiveProto proto=request.getElements(i);
      input.add(new PathCacheDirective(proto.getPath(),proto.getPool().getId()));
    }
    List<Fallible<PathCacheEntry>> output=server.addPathCacheDirectives(input);
    AddPathCacheDirectivesResponseProto.Builder builder=AddPathCacheDirectivesResponseProto.newBuilder();
    for (int idx=0; idx < output.size(); idx++) {
      try {
        PathCacheEntry entry=output.get(idx).get();
        builder.addResults(entry.getEntryId());
      }
 catch (      EmptyPathError ioe) {
        builder.addResults(AddPathCacheDirectiveErrorProto.EMPTY_PATH_ERROR_VALUE);
      }
catch (      InvalidPathNameError ioe) {
        builder.addResults(AddPathCacheDirectiveErrorProto.INVALID_PATH_NAME_ERROR_VALUE);
      }
catch (      InvalidPoolError ioe) {
        builder.addResults(AddPathCacheDirectiveErrorProto.INVALID_POOL_NAME_ERROR_VALUE);
      }
catch (      IOException ioe) {
        builder.addResults(AddPathCacheDirectiveErrorProto.UNEXPECTED_ADD_ERROR_VALUE);
      }
    }
    return builder.build();
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
}
