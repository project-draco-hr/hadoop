{
  try {
    RemoteIterator<CachePoolInfo> iter=server.listCachePools(request.getPrevPoolName());
    ListCachePoolsResponseProto.Builder responseBuilder=ListCachePoolsResponseProto.newBuilder();
    String prevPoolName=null;
    while (iter.hasNext()) {
      CachePoolInfo pool=iter.next();
      ListCachePoolsResponseElementProto.Builder elemBuilder=ListCachePoolsResponseElementProto.newBuilder();
      elemBuilder.setPoolName(pool.getPoolName());
      if (pool.getOwnerName() != null) {
        elemBuilder.setOwnerName(pool.getOwnerName());
      }
      if (pool.getGroupName() != null) {
        elemBuilder.setGroupName(pool.getGroupName());
      }
      if (pool.getMode() != null) {
        elemBuilder.setMode(pool.getMode().toShort());
      }
      if (pool.getWeight() != null) {
        elemBuilder.setWeight(pool.getWeight());
      }
      responseBuilder.addElements(elemBuilder.build());
      prevPoolName=pool.getPoolName();
    }
    if (prevPoolName == null) {
      responseBuilder.setHasMore(false);
    }
 else {
      iter=server.listCachePools(prevPoolName);
      responseBuilder.setHasMore(iter.hasNext());
    }
    return responseBuilder.build();
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
}
