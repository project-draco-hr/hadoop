{
  Configuration conf=new HdfsConfiguration();
  MiniDFSCluster cluster=null;
  try {
    cluster=new MiniDFSCluster.Builder(conf).numDataNodes((int)3).build();
    cluster.waitActive();
    FileSystem fs=cluster.getFileSystem();
    Path file=new Path("testEvictWriter.dat");
    FSDataOutputStream out=fs.create(file,(short)2);
    out.write(0x31);
    out.hflush();
    DFSOutputStream dfsOut=(DFSOutputStream)out.getWrappedStream();
    DatanodeInfo[] nodes=dfsOut.getPipeline();
    Assert.assertEquals(2,nodes.length);
    String dnAddr=nodes[1].getIpcAddr(false);
    DFSAdmin dfsadmin=new DFSAdmin(conf);
    final String[] args1={"-evictWriters",dnAddr};
    Assert.assertEquals(0,dfsadmin.run(args1));
    out.write(0x31);
    out.hflush();
    nodes=dfsOut.getPipeline();
    try {
      Assert.assertTrue(nodes.length > 0);
      for (int i=0; i < nodes.length; i++) {
        Assert.assertFalse(dnAddr.equals(nodes[i].getIpcAddr(false)));
      }
    }
  finally {
      out.close();
    }
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
