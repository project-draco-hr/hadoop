{
  String errorMessage="TESTING: fc.truncate() threw IOE";
  File testDir=new File(System.getProperty("test.build.data","/tmp"));
  assertTrue("could not create test directory",testDir.exists() || testDir.mkdirs());
  File f=new File(testDir,"edits");
  assertTrue("could not create test file",f.createNewFile());
  EditLogFileOutputStream elos=new EditLogFileOutputStream(f,0);
  FileChannel mockFc=Mockito.spy(elos.getFileChannelForTesting());
  Mockito.doThrow(new IOException(errorMessage)).when(mockFc).truncate(Mockito.anyLong());
  elos.setFileChannelForTesting(mockFc);
  try {
    elos.close();
    fail("elos.close() succeeded, but should have thrown");
  }
 catch (  IOException e) {
    assertEquals("wrong IOE thrown from elos.close()",e.getMessage(),errorMessage);
  }
  assertEquals("fc was not nulled when elos.close() failed",elos.getFileChannelForTesting(),null);
}
