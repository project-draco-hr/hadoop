{
  WebResource r=resource();
  Application app=new MockApp(1);
  nmContext.getApplications().put(app.getAppId(),app);
  addAppContainers(app);
  Application app2=new MockApp("foo",1234,2);
  nmContext.getApplications().put(app2.getAppId(),app2);
  addAppContainers(app2);
  try {
    r.path("ws").path("v1").path("node").path("apps").queryParam("state","FOO_STATE").accept(MediaType.APPLICATION_XML).get(JSONObject.class);
    fail("should have thrown exception on invalid user query");
  }
 catch (  UniformInterfaceException ue) {
    ClientResponse response=ue.getResponse();
    assertEquals(Status.BAD_REQUEST,response.getClientResponseStatus());
    assertEquals(MediaType.APPLICATION_XML_TYPE,response.getType());
    String msg=response.getEntity(String.class);
    DocumentBuilderFactory dbf=DocumentBuilderFactory.newInstance();
    DocumentBuilder db=dbf.newDocumentBuilder();
    InputSource is=new InputSource();
    is.setCharacterStream(new StringReader(msg));
    Document dom=db.parse(is);
    NodeList nodes=dom.getElementsByTagName("RemoteException");
    Element element=(Element)nodes.item(0);
    String message=WebServicesTestUtils.getXmlString(element,"message");
    String type=WebServicesTestUtils.getXmlString(element,"exception");
    String classname=WebServicesTestUtils.getXmlString(element,"javaClassName");
    verifyStatInvalidException(message,type,classname);
  }
}
