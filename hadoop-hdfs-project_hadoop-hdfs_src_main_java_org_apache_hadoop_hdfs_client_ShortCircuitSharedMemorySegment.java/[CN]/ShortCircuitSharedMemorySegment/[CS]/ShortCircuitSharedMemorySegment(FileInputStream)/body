{
  if (!NativeIO.isAvailable()) {
    throw new UnsupportedOperationException("NativeIO is not available.");
  }
  if (Shell.WINDOWS) {
    throw new UnsupportedOperationException("ShortCircuitSharedMemorySegment is not yet implemented " + "for Windows.");
  }
  if (unsafe == null) {
    throw new UnsupportedOperationException("can't use ShortCircuitSharedMemorySegment because we failed to " + "load misc.Unsafe.");
  }
  this.refCount.reference();
  this.stream=stream;
  this.length=getEffectiveLength(stream);
  this.baseAddress=POSIX.mmap(this.stream.getFD(),POSIX.MMAP_PROT_READ | POSIX.MMAP_PROT_WRITE,true,this.length);
}
