{
  String dir=TestDirHelper.getTestDir().getAbsolutePath();
  Configuration conf=new Configuration(false);
  conf.set("server.services",StringUtils.join(",",Arrays.asList(DelegationTokenManagerService.class.getName())));
  HttpFSServerWebApp server=new HttpFSServerWebApp(dir,dir,dir,dir,conf);
  server.setAuthority(new InetSocketAddress(InetAddress.getLocalHost(),14000));
  server.init();
  DelegationTokenManager tm=server.get(DelegationTokenManager.class);
  Token token=tm.createToken(UserGroupInformation.getCurrentUser(),"foo");
  Assert.assertNotNull(token);
  tm.verifyToken(token);
  Assert.assertTrue(tm.renewToken(token,"foo") > System.currentTimeMillis());
  tm.cancelToken(token,"foo");
  try {
    tm.verifyToken(token);
    Assert.fail();
  }
 catch (  DelegationTokenManagerException ex) {
  }
catch (  Exception ex) {
    Assert.fail();
  }
  server.destroy();
}
