{
  if (xAttrs == null || xAttrs.isEmpty()) {
    return null;
  }
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  try {
    for (    XAttr a : xAttrs) {
      int nsOrd=a.getNameSpace().ordinal();
      Preconditions.checkArgument(nsOrd < 8,"Too many namespaces.");
      int nid=XAttrStorage.getNameSerialNumber(a.getName());
      Preconditions.checkArgument(nid < XATTR_NAME_ID_MAX,"Too large serial number of the xattr name");
      int v=((nsOrd & XATTR_NAMESPACE_MASK) << XATTR_NAMESPACE_OFFSET) | (nid & XATTR_NAME_MASK);
      out.write(Ints.toByteArray(v));
      int vlen=a.getValue() == null ? 0 : a.getValue().length;
      Preconditions.checkArgument(vlen < XATTR_VALUE_LEN_MAX,"The length of xAttr values is too long.");
      out.write((byte)(vlen >> 8));
      out.write((byte)(vlen));
      if (vlen > 0) {
        out.write(a.getValue());
      }
    }
  }
 catch (  IOException e) {
  }
  return out.toByteArray();
}
