{
  String dtParam="";
  if (dt != null) {
    dtParam=JspHelper.getDelegationTokenUrlParam(dt);
  }
  InetSocketAddress nnAddress=(InetSocketAddress)getServletContext().getAttribute(NameNodeHttpServer.NAMENODE_ADDRESS_ATTRIBUTE_KEY);
  String nnHostPort=nnAddress == null ? null : NameNode.getHostPortString(nnAddress);
  String addrParam=JspHelper.getUrlParam(JspHelper.NAMENODE_ADDRESS,nnHostPort);
  return new URI(request.getScheme(),null,request.getServerName(),request.getServerPort(),"/streamFile" + i.getFullName(parent),"&ugi=" + ugi.getShortUserName() + dtParam+ addrParam,null);
}
