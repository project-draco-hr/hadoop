{
  Preconditions.checkNotNull(params.getPeer());
  Preconditions.checkNotNull(params.getBlock());
  Preconditions.checkNotNull(params.getDatanodeID());
  Peer peer=params.getPeer();
  peer.setReadTimeout(params.getConf().socketTimeout);
  peer.setWriteTimeout(HdfsServerConstants.WRITE_TIMEOUT);
  if (params.getConf().useLegacyBlockReader) {
    return RemoteBlockReader.newBlockReader(params);
  }
 else {
    return RemoteBlockReader2.newBlockReader(params);
  }
}
