{
  if (LOG.isTraceEnabled()) {
    LOG.trace(this + ": trying to create a remote block reader from a " + "TCP socket");
  }
  BlockReader blockReader=null;
  while (true) {
    BlockReaderPeer curPeer=null;
    Peer peer=null;
    try {
      curPeer=nextTcpPeer();
      if (curPeer == null)       break;
      if (curPeer.fromCache)       remainingCacheTries--;
      peer=curPeer.peer;
      blockReader=getRemoteBlockReader(peer);
      return blockReader;
    }
 catch (    IOException ioe) {
      if (isSecurityException(ioe)) {
        if (LOG.isTraceEnabled()) {
          LOG.trace(this + ": got security exception while constructing " + "a remote block reader from "+ peer,ioe);
        }
        throw ioe;
      }
      if ((curPeer != null) && curPeer.fromCache) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Closed potentially stale remote peer " + peer,ioe);
        }
      }
 else {
        LOG.warn("I/O error constructing remote block reader.",ioe);
        throw ioe;
      }
    }
 finally {
      if (blockReader == null) {
        IOUtils.cleanup(LOG,peer);
      }
    }
  }
  return null;
}
