{
  DataOutputBuffer out=new DataOutputBuffer();
  DataInputBuffer in=new DataInputBuffer();
  for (int i=0; i < NUM_ITERATIONS; i++) {
    String before;
    if (i == 0)     before=getLongString();
 else     before=getTestString();
    out.reset();
    Text.writeString(out,before);
    in.reset(out.getData(),out.getLength());
    String after=Text.readString(in);
    assertTrue(before.equals(after));
    int strLenSize=WritableUtils.getVIntSize(Text.utf8Length(before));
    String after2=new String(out.getData(),strLenSize,out.getLength() - strLenSize,"UTF-8");
    assertTrue(before.equals(after2));
  }
}
