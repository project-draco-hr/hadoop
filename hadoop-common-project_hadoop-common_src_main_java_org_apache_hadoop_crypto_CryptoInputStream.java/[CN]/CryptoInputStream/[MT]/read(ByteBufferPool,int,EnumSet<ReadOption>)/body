{
  checkStream();
  try {
    if (outBuffer.remaining() > 0) {
      ((Seekable)in).seek(getPos());
      resetStreamOffset(getPos());
    }
    final ByteBuffer buffer=((HasEnhancedByteBufferAccess)in).read(bufferPool,maxLength,opts);
    if (buffer != null) {
      final int n=buffer.remaining();
      if (n > 0) {
        streamOffset+=buffer.remaining();
        final int pos=buffer.position();
        decrypt(buffer,n,pos);
      }
    }
    return buffer;
  }
 catch (  ClassCastException e) {
    throw new UnsupportedOperationException("This stream does not support " + "enhanced byte buffer access.");
  }
}
