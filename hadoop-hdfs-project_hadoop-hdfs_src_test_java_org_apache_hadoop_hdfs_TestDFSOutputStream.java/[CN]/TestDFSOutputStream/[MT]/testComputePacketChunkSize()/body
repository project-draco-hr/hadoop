{
  DistributedFileSystem fs=cluster.getFileSystem();
  FSDataOutputStream os=fs.create(new Path("/test"));
  DFSOutputStream dos=(DFSOutputStream)Whitebox.getInternalState(os,"wrappedStream");
  final int packetSize=64 * 1024;
  final int bytesPerChecksum=512;
  Method method=dos.getClass().getDeclaredMethod("computePacketChunkSize",int.class,int.class);
  method.setAccessible(true);
  method.invoke(dos,packetSize,bytesPerChecksum);
  Field field=dos.getClass().getDeclaredField("packetSize");
  field.setAccessible(true);
  Assert.assertTrue((Integer)field.get(dos) + 33 < packetSize);
  Assert.assertTrue((Integer)field.get(dos) + 257 < packetSize);
}
