{
  if (!isNativeSnappyLoaded(conf)) {
    throw new RuntimeException("native-snappy library not available");
  }
  int bufferSize=conf.getInt(SNAPPY_BUFFER_SIZE_KEY,DEFAULT_SNAPPY_BUFFER_SIZE);
  int compressionOverhead=Snappy.maxCompressedLength(bufferSize) - bufferSize;
  return new BlockCompressorStream(out,compressor,bufferSize,compressionOverhead);
}
