{
  Directory readDir=new RAMDirectory();
  updateIndex(readDir,0,numDocsPerUpdate,new KeepOnlyLastCommitDeletionPolicy());
  verify(readDir,numDocsPerUpdate);
  IndexOutput out=readDir.createOutput("_" + (numDocsPerUpdate / maxBufferedDocs + 2) + ".cfs");
  out.writeInt(0);
  out.close();
  Directory writeDir=new RAMDirectory();
  Directory mixedDir=new MixedDirectory(readDir,writeDir);
  updateIndex(mixedDir,numDocsPerUpdate,numDocsPerUpdate,new MixedDeletionPolicy());
  verify(readDir,numDocsPerUpdate);
  verify(mixedDir,2 * numDocsPerUpdate);
}
