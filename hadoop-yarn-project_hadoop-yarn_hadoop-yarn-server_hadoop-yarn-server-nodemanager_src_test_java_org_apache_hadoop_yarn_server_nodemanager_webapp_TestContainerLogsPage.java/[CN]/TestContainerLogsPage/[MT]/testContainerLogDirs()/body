{
  File absLogDir=new File("target",TestNMWebServer.class.getSimpleName() + "LogDir").getAbsoluteFile();
  String logdirwithFile=absLogDir.toURI().toString();
  Configuration conf=new Configuration();
  conf.set(YarnConfiguration.NM_LOG_DIRS,logdirwithFile);
  NodeHealthCheckerService healthChecker=createNodeHealthCheckerService(conf);
  healthChecker.init(conf);
  LocalDirsHandlerService dirsHandler=healthChecker.getDiskHandler();
  NMContext nmContext=new NodeManager.NMContext(null,null,dirsHandler,new ApplicationACLsManager(conf),new NMNullStateStoreService());
  RecordFactory recordFactory=RecordFactoryProvider.getRecordFactory(conf);
  String user="nobody";
  long clusterTimeStamp=1234;
  ApplicationId appId=BuilderUtils.newApplicationId(recordFactory,clusterTimeStamp,1);
  Application app=mock(Application.class);
  when(app.getUser()).thenReturn(user);
  when(app.getAppId()).thenReturn(appId);
  ApplicationAttemptId appAttemptId=BuilderUtils.newApplicationAttemptId(appId,1);
  ContainerId container1=BuilderUtils.newContainerId(recordFactory,appId,appAttemptId,0);
  nmContext.getApplications().put(appId,app);
  MockContainer container=new MockContainer(appAttemptId,new AsyncDispatcher(),conf,user,appId,1);
  container.setState(ContainerState.RUNNING);
  nmContext.getContainers().put(container1,container);
  List<File> files=null;
  files=ContainerLogsUtils.getContainerLogDirs(container1,user,nmContext);
  Assert.assertTrue(!(files.get(0).toString().contains("file:")));
  nmContext.getContainers().remove(container1);
  Assert.assertNull(nmContext.getContainers().get(container1));
  files=ContainerLogsUtils.getContainerLogDirs(container1,user,nmContext);
  Assert.assertTrue(!(files.get(0).toString().contains("file:")));
  LocalDirsHandlerService dirsHandlerForFullDisk=spy(dirsHandler);
  when(dirsHandlerForFullDisk.getLogDirs()).thenReturn(new ArrayList<String>());
  when(dirsHandlerForFullDisk.getLogDirsForRead()).thenReturn(Arrays.asList(new String[]{absLogDir.getAbsolutePath()}));
  nmContext=new NodeManager.NMContext(null,null,dirsHandlerForFullDisk,new ApplicationACLsManager(conf),new NMNullStateStoreService());
  nmContext.getApplications().put(appId,app);
  container.setState(ContainerState.RUNNING);
  nmContext.getContainers().put(container1,container);
  List<File> dirs=ContainerLogsUtils.getContainerLogDirs(container1,user,nmContext);
  File containerLogDir=new File(absLogDir,appId + "/" + container1);
  Assert.assertTrue(dirs.contains(containerLogDir));
}
