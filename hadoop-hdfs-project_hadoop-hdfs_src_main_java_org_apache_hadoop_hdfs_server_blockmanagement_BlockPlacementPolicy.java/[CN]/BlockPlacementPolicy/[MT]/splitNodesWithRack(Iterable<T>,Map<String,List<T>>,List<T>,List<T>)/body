{
  for (  T s : storagesOrDataNodes) {
    final String rackName=getRack(getDatanodeInfo(s));
    List<T> storageList=rackMap.get(rackName);
    if (storageList == null) {
      storageList=new ArrayList<T>();
      rackMap.put(rackName,storageList);
    }
    storageList.add(s);
  }
  for (  List<T> storageList : rackMap.values()) {
    if (storageList.size() == 1) {
      exactlyOne.add(storageList.get(0));
    }
 else {
      moreThanOne.addAll(storageList);
    }
  }
}
