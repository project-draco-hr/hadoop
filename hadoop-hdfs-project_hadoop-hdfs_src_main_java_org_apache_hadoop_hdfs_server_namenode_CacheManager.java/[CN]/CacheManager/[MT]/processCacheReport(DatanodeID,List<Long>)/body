{
  namesystem.writeLock();
  final long startTime=Time.monotonicNow();
  final long endTime;
  try {
    final DatanodeDescriptor datanode=blockManager.getDatanodeManager().getDatanode(datanodeID);
    if (datanode == null || !datanode.isAlive) {
      throw new IOException("processCacheReport from dead or unregistered datanode: " + datanode);
    }
    processCacheReportImpl(datanode,blockIds);
  }
  finally {
    endTime=Time.monotonicNow();
    namesystem.writeUnlock();
  }
  final NameNodeMetrics metrics=NameNode.getNameNodeMetrics();
  if (metrics != null) {
    metrics.addCacheBlockReport((int)(endTime - startTime));
  }
  LOG.debug("Processed cache report from {}, blocks: {}, " + "processing time: {} msecs",datanodeID,blockIds.size(),(endTime - startTime));
}
