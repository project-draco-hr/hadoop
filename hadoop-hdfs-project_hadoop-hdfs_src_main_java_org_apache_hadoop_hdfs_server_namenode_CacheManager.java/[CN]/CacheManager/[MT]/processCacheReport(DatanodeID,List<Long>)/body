{
  if (!enabled) {
    LOG.info("Ignoring cache report from " + datanodeID + " because "+ DFS_NAMENODE_CACHING_ENABLED_KEY+ " = false. "+ "number of blocks: "+ blockIds.size());
    return;
  }
  namesystem.writeLock();
  final long startTime=Time.monotonicNow();
  final long endTime;
  try {
    final DatanodeDescriptor datanode=blockManager.getDatanodeManager().getDatanode(datanodeID);
    if (datanode == null || !datanode.isAlive) {
      throw new IOException("processCacheReport from dead or unregistered datanode: " + datanode);
    }
    processCacheReportImpl(datanode,blockIds);
  }
  finally {
    endTime=Time.monotonicNow();
    namesystem.writeUnlock();
  }
  final NameNodeMetrics metrics=NameNode.getNameNodeMetrics();
  if (metrics != null) {
    metrics.addCacheBlockReport((int)(endTime - startTime));
  }
  LOG.info("Processed cache report from " + datanodeID + ", blocks: "+ blockIds.size()+ ", processing time: "+ (endTime - startTime)+ " msecs");
}
