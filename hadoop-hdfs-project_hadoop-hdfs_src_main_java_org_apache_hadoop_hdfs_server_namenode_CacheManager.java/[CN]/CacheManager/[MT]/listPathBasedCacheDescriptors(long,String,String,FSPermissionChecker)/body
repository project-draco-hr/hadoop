{
  final int NUM_PRE_ALLOCATED_ENTRIES=16;
  if (filterPath != null) {
    if (!DFSUtil.isValidName(filterPath)) {
      throw new IOException("invalid path name '" + filterPath + "'");
    }
  }
  ArrayList<PathBasedCacheDescriptor> replies=new ArrayList<PathBasedCacheDescriptor>(NUM_PRE_ALLOCATED_ENTRIES);
  int numReplies=0;
  SortedMap<Long,PathBasedCacheEntry> tailMap=entriesById.tailMap(prevId + 1);
  for (  Entry<Long,PathBasedCacheEntry> cur : tailMap.entrySet()) {
    if (numReplies >= maxListCacheDescriptorsResponses) {
      return new BatchedListEntries<PathBasedCacheDescriptor>(replies,true);
    }
    PathBasedCacheEntry curEntry=cur.getValue();
    PathBasedCacheDirective directive=cur.getValue().getDescriptor();
    if (filterPool != null && !directive.getPool().equals(filterPool)) {
      continue;
    }
    if (filterPath != null && !directive.getPath().equals(filterPath)) {
      continue;
    }
    if (pc.checkPermission(curEntry.getPool(),FsAction.READ)) {
      replies.add(cur.getValue().getDescriptor());
      numReplies++;
    }
  }
  return new BatchedListEntries<PathBasedCacheDescriptor>(replies,false);
}
