{
  long expiryTime;
  CacheDirectiveInfo.Expiration expiration=directive.getExpiration();
  if (expiration != null) {
    if (expiration.getMillis() < 0) {
      throw new InvalidRequestException("Cannot set a negative expiration: " + expiration.getMillis());
    }
    expiryTime=expiration.getAbsoluteMillis();
  }
 else {
    expiryTime=defaultValue;
  }
  return expiryTime;
}
