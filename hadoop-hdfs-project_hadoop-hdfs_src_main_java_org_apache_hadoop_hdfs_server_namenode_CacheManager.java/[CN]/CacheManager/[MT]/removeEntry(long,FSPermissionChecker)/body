{
  if (entryId <= 0) {
    LOG.info("removeEntry " + entryId + ": invalid non-positive entry ID.");
    return new Fallible<Long>(new InvalidIdException(entryId));
  }
  PathBasedCacheEntry existing=entriesById.get(entryId);
  if (existing == null) {
    LOG.info("removeEntry " + entryId + ": entry not found.");
    return new Fallible<Long>(new NoSuchIdException(entryId));
  }
  CachePool pool=cachePools.get(existing.getDirective().getPool());
  if (pool == null) {
    LOG.info("removeEntry " + entryId + ": pool not found for directive "+ existing.getDirective());
    return new Fallible<Long>(new UnexpectedRemovePathBasedCacheEntryException(entryId));
  }
  if ((pc != null) && (!pc.checkPermission(pool,FsAction.WRITE))) {
    LOG.info("removeEntry " + entryId + ": write permission denied to "+ "pool "+ pool+ " for entry "+ existing);
    return new Fallible<Long>(new RemovePermissionDeniedException(entryId));
  }
  if (entriesByDirective.remove(existing.getDirective()) == null) {
    LOG.warn("removeEntry " + entryId + ": failed to find existing entry "+ existing+ " in entriesByDirective");
    return new Fallible<Long>(new UnexpectedRemovePathBasedCacheEntryException(entryId));
  }
  String path=existing.getDirective().getPath();
  List<PathBasedCacheEntry> entries=entriesByPath.get(path);
  if (entries == null || !entries.remove(existing)) {
    return new Fallible<Long>(new UnexpectedRemovePathBasedCacheEntryException(entryId));
  }
  if (entries.size() == 0) {
    entriesByPath.remove(path);
  }
  entriesById.remove(entryId);
  try {
    INode node=dir.getINode(existing.getDirective().getPath());
    if (node.isFile()) {
      namesystem.setCacheReplicationInt(existing.getDirective().getPath(),(short)0);
    }
  }
 catch (  IOException e) {
    LOG.warn("removeEntry " + entryId + ": failure while setting cache"+ " replication factor",e);
    return new Fallible<Long>(e);
  }
  LOG.info("removeEntry successful for PathCacheEntry id " + entryId);
  return new Fallible<Long>(entryId);
}
