{
  ZooKeeper zkc=connectZooKeeper(zkEnsemble);
  try {
    boolean up=false;
    int mostRecentSize=0;
    for (int i=0; i < timeout; i++) {
      try {
        List<String> children=zkc.getChildren("/ledgers/available",false);
        mostRecentSize=children.size();
        if (LOG.isDebugEnabled()) {
          LOG.debug("Found " + mostRecentSize + " bookies up, "+ "waiting for "+ count);
          if (LOG.isTraceEnabled()) {
            for (            String child : children) {
              LOG.trace(" server: " + child);
            }
          }
        }
        if (mostRecentSize == count) {
          up=true;
          break;
        }
      }
 catch (      KeeperException e) {
      }
      Thread.sleep(1000);
    }
    return mostRecentSize;
  }
  finally {
    zkc.close();
  }
}
