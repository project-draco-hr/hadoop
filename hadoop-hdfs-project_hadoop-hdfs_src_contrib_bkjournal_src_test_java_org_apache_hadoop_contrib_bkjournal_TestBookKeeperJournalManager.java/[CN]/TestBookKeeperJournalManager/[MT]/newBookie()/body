{
  int port=nextPort++;
  ServerConfiguration bookieConf=new ServerConfiguration();
  bookieConf.setBookiePort(port);
  File tmpdir=File.createTempFile("bookie" + Integer.toString(port) + "_","test");
  tmpdir.delete();
  tmpdir.mkdir();
  bookieConf.setZkServers(zkEnsemble);
  bookieConf.setJournalDirName(tmpdir.getPath());
  bookieConf.setLedgerDirNames(new String[]{tmpdir.getPath()});
  BookieServer b=new BookieServer(bookieConf);
  b.start();
  for (int i=0; i < 10 && !b.isRunning(); i++) {
    Thread.sleep(10000);
  }
  if (!b.isRunning()) {
    throw new IOException("Bookie would not start");
  }
  return b;
}
