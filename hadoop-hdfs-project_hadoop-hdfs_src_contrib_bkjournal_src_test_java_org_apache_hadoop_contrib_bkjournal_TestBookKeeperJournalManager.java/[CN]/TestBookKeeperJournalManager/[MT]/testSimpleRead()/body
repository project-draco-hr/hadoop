{
  NamespaceInfo nsi=newNSInfo();
  BookKeeperJournalManager bkjm=new BookKeeperJournalManager(conf,BKJMUtil.createJournalURI("/hdfsjournal-simpleread"),nsi);
  bkjm.format(nsi);
  final long numTransactions=10000;
  EditLogOutputStream out=bkjm.startLogSegment(1);
  for (long i=1; i <= numTransactions; i++) {
    FSEditLogOp op=FSEditLogTestUtil.getNoOpInstance();
    op.setTransactionId(i);
    out.write(op);
  }
  out.close();
  bkjm.finalizeLogSegment(1,numTransactions);
  EditLogInputStream in=bkjm.getInputStream(1,true);
  try {
    assertEquals(numTransactions,FSEditLogTestUtil.countTransactionsInStream(in));
  }
  finally {
    in.close();
  }
}
