{
  final Server server=RPC.getServer(TestProtocol.class,new TestImpl(),ADDRESS,0,5,true,conf,null);
  server.enableSecurity();
  server.start();
  boolean succeeded=false;
  final InetSocketAddress addr=NetUtils.getConnectAddress(server);
  TestProtocol proxy=null;
  try {
    proxy=(TestProtocol)RPC.getProxy(TestProtocol.class,TestProtocol.versionID,addr,conf);
  }
 catch (  RemoteException e) {
    LOG.info("LOGGING MESSAGE: " + e.getLocalizedMessage());
    assertTrue(e.unwrapRemoteException() instanceof AccessControlException);
    succeeded=true;
  }
 finally {
    server.stop();
    if (proxy != null) {
      RPC.stopProxy(proxy);
    }
  }
  assertTrue(succeeded);
}
