{
  DFSTestUtil.createFile(hdfs,file1,1024,REPLICATION,seed);
  String[] names=INode.getPathNames(file1.toString());
  byte[][] components=INode.getPathComponents(names);
  INodesInPath nodesInPath=fsdir.rootDir.getExistingPathINodes(components,components.length,false);
  INode[] inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length);
  assertSnapshot(nodesInPath,false,s4,-1);
  assertEquals(inodes[components.length - 1].getFullPathName(),file1.toString());
  hdfs.allowSnapshot(sub1.toString());
  hdfs.createSnapshot("s3",sub1.toString());
  DFSTestUtil.appendFile(hdfs,file1,"the content for appending");
  String snapshotPath=sub1.toString() + "/.snapshot/s3/file1";
  names=INode.getPathNames(snapshotPath);
  components=INode.getPathComponents(names);
  INodesInPath ssNodesInPath=fsdir.rootDir.getExistingPathINodes(components,components.length,false);
  INode[] ssInodes=ssNodesInPath.getINodes();
  assertEquals(ssInodes.length,components.length - 1);
  final Snapshot s3=getSnapshot(ssNodesInPath,"s3");
  assertSnapshot(ssNodesInPath,true,s3,3);
  INode snapshotFileNode=ssInodes[ssInodes.length - 1];
  assertEquals(snapshotFileNode.getLocalName(),file1.getName());
  assertTrue(snapshotFileNode instanceof INodeFileSnapshot);
  assertEquals(inodes[inodes.length - 1].getModificationTime(),ssInodes[ssInodes.length - 1].getModificationTime());
  names=INode.getPathNames(file1.toString());
  components=INode.getPathComponents(names);
  INodesInPath newNodesInPath=fsdir.rootDir.getExistingPathINodes(components,components.length,false);
  assertSnapshot(newNodesInPath,false,s3,-1);
  INode[] newInodes=newNodesInPath.getINodes();
  assertEquals(newInodes.length,components.length);
  final int last=components.length - 1;
  assertEquals(newInodes[last].getFullPathName(),file1.toString());
  Assert.assertFalse(inodes[last].getModificationTime() == newInodes[last].getModificationTime());
}
