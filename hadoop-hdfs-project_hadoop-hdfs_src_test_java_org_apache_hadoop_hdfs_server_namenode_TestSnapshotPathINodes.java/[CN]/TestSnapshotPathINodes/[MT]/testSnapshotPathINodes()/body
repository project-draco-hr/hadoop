{
  hdfs.allowSnapshot(sub1.toString());
  hdfs.createSnapshot("s1",sub1.toString());
  String snapshotPath=sub1.toString() + "/.snapshot/s1/file1";
  String[] names=INode.getPathNames(snapshotPath);
  byte[][] components=INode.getPathComponents(names);
  INodesInPath nodesInPath=fsdir.rootDir.getExistingPathINodes(components,components.length,false);
  INode[] inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length - 1);
  final Snapshot snapshot=getSnapshot(nodesInPath,"s1");
  assertSnapshot(nodesInPath,true,snapshot,3);
  INode snapshotFileNode=inodes[inodes.length - 1];
  assertINodeFile(snapshotFileNode,file1);
  assertTrue(snapshotFileNode.getParent() instanceof INodeDirectoryWithSnapshot);
  nodesInPath=fsdir.rootDir.getExistingPathINodes(components,1,false);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,1);
  assertSnapshot(nodesInPath,true,snapshot,-1);
  assertINodeFile(nodesInPath.getLastINode(),file1);
  nodesInPath=fsdir.rootDir.getExistingPathINodes(components,2,false);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,2);
  assertSnapshot(nodesInPath,true,snapshot,0);
  assertINodeFile(nodesInPath.getLastINode(),file1);
  String dotSnapshotPath=sub1.toString() + "/.snapshot";
  names=INode.getPathNames(dotSnapshotPath);
  components=INode.getPathComponents(names);
  nodesInPath=fsdir.rootDir.getExistingPathINodes(components,components.length,false);
  inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length - 1);
  assertSnapshot(nodesInPath,true,snapshot,-1);
  assertEquals(inodes[inodes.length - 1].getFullPathName(),sub1.toString());
  assertFalse(inodes[inodes.length - 1] instanceof INodeFileSnapshot);
}
