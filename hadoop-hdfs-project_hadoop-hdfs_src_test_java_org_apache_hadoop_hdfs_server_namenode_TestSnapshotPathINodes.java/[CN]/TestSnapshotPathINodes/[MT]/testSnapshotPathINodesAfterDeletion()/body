{
  hdfs.allowSnapshot(sub1.toString());
  hdfs.createSnapshot("s2",sub1.toString());
  hdfs.delete(file1,false);
  final Snapshot snapshot;
{
    String snapshotPath=sub1.toString() + "/.snapshot/s2/file1";
    String[] names=INode.getPathNames(snapshotPath);
    byte[][] components=INode.getPathComponents(names);
    INodesInPath nodesInPath=fsdir.rootDir.getExistingPathINodes(components,components.length,false);
    INode[] inodes=nodesInPath.getINodes();
    assertEquals(inodes.length,components.length - 1);
    snapshot=getSnapshot(nodesInPath,"s2");
    assertSnapshot(nodesInPath,true,snapshot,3);
    assertTrue(inodes[nodesInPath.getSnapshotRootIndex()] instanceof INodeDirectoryWithSnapshot);
    INode snapshotFileNode=inodes[inodes.length - 1];
    assertEquals(snapshotFileNode.getLocalName(),file1.getName());
    assertTrue(snapshotFileNode instanceof INodeFileSnapshot);
    assertTrue(snapshotFileNode.getParent() instanceof INodeDirectoryWithSnapshot);
  }
  String[] names=INode.getPathNames(file1.toString());
  byte[][] components=INode.getPathComponents(names);
  INodesInPath nodesInPath=fsdir.rootDir.getExistingPathINodes(components,components.length,false);
  INode[] inodes=nodesInPath.getINodes();
  assertEquals(inodes.length,components.length);
  assertEquals(nodesInPath.getNumNonNull(),components.length - 1);
  assertSnapshot(nodesInPath,false,snapshot,-1);
  assertNull(inodes[components.length - 1]);
  assertEquals(inodes[components.length - 2].getFullPathName(),sub1.toString());
  assertEquals(inodes[components.length - 3].getFullPathName(),dir.toString());
}
