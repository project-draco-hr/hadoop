{
  final HttpURLConnection conn=(HttpURLConnection)connectionFactory.openConnection(url);
  final boolean doOutput=op.getDoOutput();
  conn.setRequestMethod(op.getType().toString());
  conn.setInstanceFollowRedirects(false);
switch (op.getType()) {
case POST:
case PUT:
{
      conn.setDoOutput(true);
      if (!doOutput) {
        conn.getOutputStream().close();
      }
 else {
        conn.setRequestProperty("Content-Type",MediaType.APPLICATION_OCTET_STREAM);
        conn.setChunkedStreamingMode(32 << 10);
      }
      break;
    }
default :
{
    conn.setDoOutput(doOutput);
    break;
  }
}
conn.connect();
return conn;
}
