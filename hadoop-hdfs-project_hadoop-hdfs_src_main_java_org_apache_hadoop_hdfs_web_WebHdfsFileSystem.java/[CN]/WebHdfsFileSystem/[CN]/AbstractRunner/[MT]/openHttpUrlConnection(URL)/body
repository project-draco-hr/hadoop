{
  final HttpURLConnection conn;
  try {
    if (op.getRequireAuth()) {
      LOG.debug("open AuthenticatedURL connection");
      UserGroupInformation.getCurrentUser().checkTGTAndReloginFromKeytab();
      final AuthenticatedURL.Token authToken=new AuthenticatedURL.Token();
      conn=new AuthenticatedURL(AUTH,CONN_CONFIGURATOR).openConnection(url,authToken);
    }
 else {
      LOG.debug("open URL connection");
      conn=(HttpURLConnection)connectionFactory.openConnection(url);
    }
  }
 catch (  AuthenticationException e) {
    throw new IOException(e);
  }
  return conn;
}
