{
  final Text serviceName=SecurityUtil.buildTokenService(nnAddr);
  Token<?> token=webhdfspTokenSelector.selectToken(serviceName,ugi.getTokens());
  if (token == null) {
    token=DelegationTokenSelector.selectHdfsDelegationToken(nnAddr,ugi,getConf());
  }
  boolean createdToken=false;
  if (token == null) {
    token=getDelegationToken(null);
    createdToken=(token != null);
  }
  if (token != null) {
    setDelegationToken(token);
    if (createdToken) {
      dtRenewer.addRenewAction(this);
      LOG.debug("Created new DT for " + token.getService());
    }
 else {
      LOG.debug("Found existing DT for " + token.getService());
    }
  }
}
