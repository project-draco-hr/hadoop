{
  final HttpURLConnection conn;
  try {
    if (ugi.hasKerberosCredentials()) {
      conn=new AuthenticatedURL(AUTH).openConnection(url,authToken);
    }
 else {
      conn=(HttpURLConnection)url.openConnection();
    }
  }
 catch (  AuthenticationException e) {
    throw new IOException("Authentication failed, url=" + url,e);
  }
  return conn;
}
