{
  final URL url=toUrl(op,fspath,parameters);
  HttpURLConnection conn=getHttpUrlConnection(url);
  try {
    conn.setRequestMethod(op.getType().toString());
    if (op.getDoOutput()) {
      conn=twoStepWrite(conn,op);
    }
    conn.setDoOutput(op.getDoOutput());
    conn.connect();
    return conn;
  }
 catch (  IOException e) {
    conn.disconnect();
    throw e;
  }
}
