{
  final URL url=toUrl(op,fspath,parameters);
  final HttpURLConnection conn;
  try {
    conn=new AuthenticatedURL(AUTH).openConnection(url,authToken);
  }
 catch (  AuthenticationException e) {
    throw new IOException("Authentication failed, url=" + url,e);
  }
  try {
    conn.setRequestMethod(op.getType().toString());
    conn.setDoOutput(op.getDoOutput());
    if (op.getDoOutput()) {
      conn.setRequestProperty("Expect","100-Continue");
      conn.setInstanceFollowRedirects(true);
    }
    conn.connect();
    return conn;
  }
 catch (  IOException e) {
    conn.disconnect();
    throw e;
  }
}
