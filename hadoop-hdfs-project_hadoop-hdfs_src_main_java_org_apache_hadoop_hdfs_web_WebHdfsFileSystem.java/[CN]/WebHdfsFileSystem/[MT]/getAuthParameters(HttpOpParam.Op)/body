{
  List<Param<?,?>> authParams=Lists.newArrayList();
  Token<?> token=null;
  if (UserGroupInformation.isSecurityEnabled() && op != GetOpParam.Op.GETDELEGATIONTOKEN && op != PutOpParam.Op.RENEWDELEGATIONTOKEN && op != PutOpParam.Op.CANCELDELEGATIONTOKEN) {
    token=getDelegationToken();
  }
  if (token != null) {
    authParams.add(new DelegationParam(token.encodeToUrlString()));
  }
 else {
    UserGroupInformation userUgi=ugi;
    UserGroupInformation realUgi=userUgi.getRealUser();
    if (realUgi != null) {
      authParams.add(new DoAsParam(userUgi.getShortUserName()));
      userUgi=realUgi;
    }
    authParams.add(new UserParam(userUgi.getShortUserName()));
  }
  return authParams.toArray(new Param<?,?>[0]);
}
