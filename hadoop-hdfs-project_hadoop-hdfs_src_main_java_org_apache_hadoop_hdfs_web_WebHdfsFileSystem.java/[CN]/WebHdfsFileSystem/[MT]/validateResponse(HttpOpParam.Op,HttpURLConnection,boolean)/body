{
  final int code=conn.getResponseCode();
  if (code == HttpURLConnection.HTTP_UNAUTHORIZED) {
    throw new IOException(new AuthenticationException(conn.getResponseMessage()));
  }
  if (code != op.getExpectedHttpResponseCode()) {
    final Map<?,?> m;
    try {
      m=jsonParse(conn,true);
    }
 catch (    Exception e) {
      throw new IOException("Unexpected HTTP response: code=" + code + " != "+ op.getExpectedHttpResponseCode()+ ", "+ op.toQueryString()+ ", message="+ conn.getResponseMessage(),e);
    }
    if (m == null) {
      throw new IOException("Unexpected HTTP response: code=" + code + " != "+ op.getExpectedHttpResponseCode()+ ", "+ op.toQueryString()+ ", message="+ conn.getResponseMessage());
    }
 else     if (m.get(RemoteException.class.getSimpleName()) == null) {
      return m;
    }
    final RemoteException re=JsonUtil.toRemoteException(m);
    throw unwrapException ? toIOException(re) : re;
  }
  return null;
}
