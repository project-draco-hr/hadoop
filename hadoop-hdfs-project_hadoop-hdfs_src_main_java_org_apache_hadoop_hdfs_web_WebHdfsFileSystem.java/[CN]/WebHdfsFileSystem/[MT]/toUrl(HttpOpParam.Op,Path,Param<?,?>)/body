{
  final String path=PATH_PREFIX + (fspath == null ? "/" : makeQualified(fspath).toUri().getPath());
  final String query=op.toQueryString() + '&' + new UserParam(ugi)+ Param.toSortedString("&",parameters);
  final URL url;
  if (op == PutOpParam.Op.RENEWDELEGATIONTOKEN || op == GetOpParam.Op.GETDELEGATIONTOKEN || op == GetOpParam.Op.GETDELEGATIONTOKENS) {
    url=getNamenodeURL(path,query);
  }
 else {
    url=getNamenodeURL(path,addDt2Query(query));
  }
  if (LOG.isTraceEnabled()) {
    LOG.trace("url=" + url);
  }
  return url;
}
