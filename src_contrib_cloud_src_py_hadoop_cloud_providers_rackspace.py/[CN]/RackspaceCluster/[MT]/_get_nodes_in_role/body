def _get_nodes_in_role(self, role, state_filter=None):
    all_nodes = RackspaceCluster._list_nodes(self.driver)
    nodes = []
    for node in all_nodes:
        try:
            if ((node.extra['metadata']['cluster'] == self.name) and (role in node.extra['metadata']['roles'].split(','))):
                if ((state_filter == None) or (node.state == STATE_MAP[state_filter])):
                    nodes.append(node)
        except KeyError:
            pass
    return nodes
