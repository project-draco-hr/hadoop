{
  if (node == null)   return;
  if (node instanceof InnerNode) {
    throw new IllegalArgumentException("Not allow to add an inner node: " + NodeBase.getPath(node));
  }
  netlock.writeLock().lock();
  try {
    Node rack=getNode(node.getNetworkLocation());
    if (rack != null && !(rack instanceof InnerNode)) {
      throw new IllegalArgumentException("Unexpected data node " + node.toString() + " at an illegal network location");
    }
    if (clusterMap.add(node)) {
      LOG.info("Adding a new node: " + NodeBase.getPath(node));
      if (rack == null) {
        numOfRacks++;
      }
    }
    if (LOG.isDebugEnabled()) {
      LOG.debug("NetworkTopology became:\n" + this.toString());
    }
  }
  finally {
    netlock.writeLock().unlock();
  }
}
