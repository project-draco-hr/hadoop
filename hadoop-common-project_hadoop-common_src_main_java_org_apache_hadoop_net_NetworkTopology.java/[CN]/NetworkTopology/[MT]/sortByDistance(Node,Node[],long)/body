{
  int[] weights=new int[nodes.length];
  for (int i=0; i < nodes.length; i++) {
    weights[i]=getWeight(reader,nodes[i]);
  }
  TreeMap<Integer,List<Node>> tree=new TreeMap<Integer,List<Node>>();
  for (int i=0; i < nodes.length; i++) {
    int weight=weights[i];
    Node node=nodes[i];
    List<Node> list=tree.get(weight);
    if (list == null) {
      list=Lists.newArrayListWithExpectedSize(1);
      tree.put(weight,list);
    }
    list.add(node);
  }
  Random rand=getRandom();
  rand.setSeed(seed);
  int idx=0;
  for (  List<Node> list : tree.values()) {
    if (list != null) {
      Collections.shuffle(list,rand);
      for (      Node n : list) {
        nodes[idx]=n;
        idx++;
      }
    }
  }
  Preconditions.checkState(idx == nodes.length,"Sorted the wrong number of nodes!");
}
