{
  EditLogOutputStream stm=qjm.startLogSegment(startTxId,NameNodeLayoutVersion.CURRENT_LAYOUT_VERSION);
  assertExistsInQuorum(cluster,NNStorage.getInProgressEditsFileName(startTxId));
  writeTxns(stm,startTxId,numTxns);
  if (finalize) {
    stm.close();
    qjm.finalizeLogSegment(startTxId,startTxId + numTxns - 1);
    return null;
  }
 else {
    return stm;
  }
}
