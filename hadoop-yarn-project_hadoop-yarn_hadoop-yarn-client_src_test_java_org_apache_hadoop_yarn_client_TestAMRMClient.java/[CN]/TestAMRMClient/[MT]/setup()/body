{
  conf=new YarnConfiguration();
  yarnCluster=new MiniYARNCluster(TestAMRMClient.class.getName(),nodeCount,1,1);
  yarnCluster.init(conf);
  yarnCluster.start();
  yarnClient=new YarnClientImpl();
  yarnClient.init(conf);
  yarnClient.start();
  nodeReports=yarnClient.getNodeReports();
  GetNewApplicationResponse newApp=yarnClient.getNewApplication();
  ApplicationId appId=newApp.getApplicationId();
  ApplicationSubmissionContext appContext=Records.newRecord(ApplicationSubmissionContext.class);
  appContext.setApplicationId(appId);
  appContext.setApplicationName("Test");
  Priority pri=Records.newRecord(Priority.class);
  pri.setPriority(0);
  appContext.setPriority(pri);
  appContext.setQueue("default");
  ContainerLaunchContext amContainer=Records.newRecord(ContainerLaunchContext.class);
  appContext.setAMContainerSpec(amContainer);
  appContext.setUnmanagedAM(true);
  SubmitApplicationRequest appRequest=Records.newRecord(SubmitApplicationRequest.class);
  appRequest.setApplicationSubmissionContext(appContext);
  yarnClient.submitApplication(appContext);
  while (true) {
    ApplicationReport appReport=yarnClient.getApplicationReport(appId);
    if (appReport.getYarnApplicationState() == YarnApplicationState.ACCEPTED) {
      attemptId=appReport.getCurrentApplicationAttemptId();
      break;
    }
  }
}
