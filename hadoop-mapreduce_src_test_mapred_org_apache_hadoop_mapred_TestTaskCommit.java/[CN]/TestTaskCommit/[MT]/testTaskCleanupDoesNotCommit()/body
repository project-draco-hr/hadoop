{
  JobConf job=new JobConf();
  job.setOutputCommitter(CommitterWithoutCleanup.class);
  Path outDir=new Path(rootDir,"output");
  FileOutputFormat.setOutputPath(job,outDir);
  String dummyAttemptID="attempt_200707121733_0001_m_000000_0";
  TaskAttemptID attemptID=TaskAttemptID.forName(dummyAttemptID);
  OutputCommitter committer=new CommitterWithoutCleanup();
  JobContext jContext=new JobContextImpl(job,attemptID.getJobID());
  committer.setupJob(jContext);
  dummyAttemptID="attempt_200707121733_0001_m_000001_0";
  attemptID=TaskAttemptID.forName(dummyAttemptID);
  Task task=new MapTask(null,attemptID,0,null,1);
  task.setConf(job);
  task.localizeConfiguration(job);
  task.initialize(job,attemptID.getJobID(),Reporter.NULL,false);
  String file="test.txt";
  FileSystem localFs=FileSystem.getLocal(job);
  TextOutputFormat<Text,Text> theOutputFormat=new TextOutputFormat<Text,Text>();
  RecordWriter<Text,Text> theRecordWriter=theOutputFormat.getRecordWriter(localFs,job,file,Reporter.NULL);
  theRecordWriter.write(new Text("key"),new Text("value"));
  theRecordWriter.close(Reporter.NULL);
  task.setTaskCleanupTask();
  MyUmbilical umbilical=new MyUmbilical();
  task.run(job,umbilical);
  assertTrue("Task did not succeed",umbilical.taskDone);
}
