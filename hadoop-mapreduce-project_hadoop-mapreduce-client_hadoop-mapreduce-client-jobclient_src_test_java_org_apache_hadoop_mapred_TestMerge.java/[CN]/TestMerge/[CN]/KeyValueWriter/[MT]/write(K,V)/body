{
  if (key.getClass() != keyClass) {
    throw new IOException("wrong key class: " + key.getClass() + " is not "+ keyClass);
  }
  if (value.getClass() != valueClass) {
    throw new IOException("wrong value class: " + value.getClass() + " is not "+ valueClass);
  }
  keySerializer.serialize(key);
  int keyLength=dataBuffer.getLength();
  if (keyLength < 0) {
    throw new IOException("Negative key-length not allowed: " + keyLength + " for "+ key);
  }
  valueSerializer.serialize(value);
  int valueLength=dataBuffer.getLength() - keyLength;
  if (valueLength < 0) {
    throw new IOException("Negative value-length not allowed: " + valueLength + " for "+ value);
  }
  WritableUtils.writeVInt(outputStream,keyLength);
  WritableUtils.writeVInt(outputStream,valueLength);
  outputStream.write(dataBuffer.getData(),0,dataBuffer.getLength());
  dataBuffer.reset();
}
