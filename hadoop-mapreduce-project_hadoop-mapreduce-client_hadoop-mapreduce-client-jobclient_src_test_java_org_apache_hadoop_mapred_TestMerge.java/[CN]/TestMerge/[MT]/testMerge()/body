{
  MiniDFSCluster dfsCluster=null;
  MiniMRClientCluster mrCluster=null;
  FileSystem fileSystem=null;
  try {
    Configuration conf=new Configuration();
    dfsCluster=new MiniDFSCluster.Builder(conf).numDataNodes(NUM_HADOOP_DATA_NODES).build();
    fileSystem=dfsCluster.getFileSystem();
    mrCluster=MiniMRClientClusterFactory.create(this.getClass(),NUM_HADOOP_DATA_NODES,conf);
    createInput(fileSystem);
    runMergeTest(new JobConf(mrCluster.getConfig()),fileSystem);
  }
  finally {
    if (dfsCluster != null) {
      dfsCluster.shutdown();
    }
    if (mrCluster != null) {
      mrCluster.stop();
    }
  }
}
