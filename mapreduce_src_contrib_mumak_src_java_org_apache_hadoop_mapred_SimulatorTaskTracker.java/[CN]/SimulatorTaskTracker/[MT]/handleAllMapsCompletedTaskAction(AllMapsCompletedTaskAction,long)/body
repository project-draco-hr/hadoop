{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Handling all maps completed task action " + action);
  }
  TaskAttemptID taskId=action.getTaskID();
  SimulatorTaskInProgress tip=tasks.get(taskId);
  TaskStatus status=tip.getTaskStatus();
  if (status.getIsMap()) {
    throw new IllegalStateException("Invalid AllMapsCompletedTaskAction, task attempt " + "to be notified is a map: " + taskId + " "+ status);
  }
  if (status.getPhase() != Phase.SHUFFLE) {
    throw new IllegalArgumentException("Reducer task attempt already notified: " + taskId + " "+ status);
  }
  status.setPhase(Phase.REDUCE);
  status.setShuffleFinishTime(now);
  status.setSortFinishTime(now);
  TaskAttemptCompletionEvent e=createTaskAttemptCompletionEvent(tip,now);
  return Collections.<SimulatorEvent>singletonList(e);
}
