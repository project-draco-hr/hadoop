{
  final short repl=3;
  final int blockSize=1024;
  final int numOfBlocks=2;
  Path dir=getTestRootPath(fSys,"test/hadoop");
  Path file=getTestRootPath(fSys,"test/hadoop/file");
  final byte[] data=getFileData(numOfBlocks,blockSize);
  createFile(fSys,file,data,blockSize,repl);
  final int newLength=blockSize;
  boolean isReady=fSys.truncate(file,newLength);
  Assert.assertTrue("Recovery is not expected.",isReady);
  FileStatus fileStatus=fSys.getFileStatus(file);
  Assert.assertEquals(fileStatus.getLen(),newLength);
  AppendTestUtil.checkFullFile(fSys,file,newLength,data,file.toString());
  ContentSummary cs=fSys.getContentSummary(dir);
  Assert.assertEquals("Bad disk space usage",cs.getSpaceConsumed(),newLength * repl);
  Assert.assertTrue("Deleted",fSys.delete(dir,true));
}
