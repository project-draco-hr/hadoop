{
  final WebHdfsFileSystem webhdfs=(WebHdfsFileSystem)fileSystem;
  Path file=getTestRootPath(fSys,"test/hadoop/file");
  createFile(file);
  final HttpOpParam.Op op=GetOpParam.Op.GETHOMEDIRECTORY;
  final URL url=webhdfs.toUrl(op,file);
  final HttpURLConnection conn=(HttpURLConnection)url.openConnection();
  conn.setRequestMethod(op.getType().toString());
  conn.connect();
  InputStream myIn=new InputStream(){
    private HttpURLConnection localConn=conn;
    @Override public void close() throws IOException {
      closedInputStream=true;
      localConn.getInputStream().close();
    }
    @Override public int read() throws IOException {
      return localConn.getInputStream().read();
    }
  }
;
  final HttpURLConnection spyConn=spy(conn);
  doReturn(myIn).when(spyConn).getInputStream();
  try {
    Assert.assertFalse(closedInputStream);
    WebHdfsFileSystem.jsonParse(spyConn,false);
    Assert.assertTrue(closedInputStream);
  }
 catch (  IOException ioe) {
    junit.framework.TestCase.fail();
  }
  conn.disconnect();
}
