{
  if (writer != null && writer != Thread.currentThread() && writer.isAlive()) {
    writer.interrupt();
    try {
      writer.join(xceiverStopTimeout);
      if (writer.isAlive()) {
        final String msg="Join on writer thread " + writer + " timed out";
        DataNode.LOG.warn(msg + "\n" + StringUtils.getStackTrace(writer));
        throw new IOException(msg);
      }
    }
 catch (    InterruptedException e) {
      throw new IOException("Waiting for writer thread is interrupted.");
    }
  }
}
