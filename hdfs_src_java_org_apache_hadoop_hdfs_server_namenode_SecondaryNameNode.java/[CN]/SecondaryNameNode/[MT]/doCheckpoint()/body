{
  startCheckpoint();
  CheckpointSignature sig=namenode.rollEditLog();
  if (ErrorSimulator.getErrorSimulation(0)) {
    throw new IOException("Simulating error0 " + "after creating edits.new");
  }
  boolean loadImage=downloadCheckpointFiles(sig);
  doMerge(sig,loadImage);
  putFSImage(sig);
  if (ErrorSimulator.getErrorSimulation(1)) {
    throw new IOException("Simulating error1 " + "after uploading new image to NameNode");
  }
  namenode.rollFsImage(sig);
  checkpointImage.endCheckpoint();
  LOG.warn("Checkpoint done. New Image Size: " + checkpointImage.getStorage().getFsImageName().length());
  return loadImage;
}
