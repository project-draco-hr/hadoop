{
  if (UserGroupInformation.isSecurityEnabled()) {
    UserGroupInformation ugi=null;
    try {
      ugi=UserGroupInformation.getLoginUser();
    }
 catch (    IOException e) {
      LOG.error(StringUtils.stringifyException(e));
      e.printStackTrace();
      Runtime.getRuntime().exit(-1);
    }
    ugi.doAs(new PrivilegedAction<Object>(){
      @Override public Object run(){
        doWork();
        return null;
      }
    }
);
  }
 else {
    doWork();
  }
}
