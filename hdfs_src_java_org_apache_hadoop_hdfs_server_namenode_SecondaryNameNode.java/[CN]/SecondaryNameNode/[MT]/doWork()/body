{
  long period=5 * 60;
  if (checkpointPeriod < period) {
    period=checkpointPeriod;
  }
  while (shouldRun) {
    try {
      Thread.sleep(1000 * period);
    }
 catch (    InterruptedException ie) {
    }
    if (!shouldRun) {
      break;
    }
    try {
      if (UserGroupInformation.isSecurityEnabled())       UserGroupInformation.getCurrentUser().reloginFromKeytab();
      long now=System.currentTimeMillis();
      long size=namenode.getEditLogSize();
      if (size >= checkpointSize || now >= lastCheckpointTime + 1000 * checkpointPeriod) {
        doCheckpoint();
        lastCheckpointTime=now;
      }
    }
 catch (    IOException e) {
      LOG.error("Exception in doCheckpoint: ");
      LOG.error(StringUtils.stringifyException(e));
      e.printStackTrace();
      checkpointImage.getStorage().imageDigest=null;
    }
catch (    Throwable e) {
      LOG.error("Throwable Exception in doCheckpoint: ");
      LOG.error(StringUtils.stringifyException(e));
      e.printStackTrace();
      Runtime.getRuntime().exit(-1);
    }
  }
}
