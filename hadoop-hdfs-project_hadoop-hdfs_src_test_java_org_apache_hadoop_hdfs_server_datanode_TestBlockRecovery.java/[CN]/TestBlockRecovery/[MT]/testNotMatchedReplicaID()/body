{
  if (LOG.isDebugEnabled()) {
    LOG.debug("Running " + GenericTestUtils.getMethodName());
  }
  ReplicaInPipelineInterface replicaInfo=dn.data.createRbw(StorageType.DEFAULT,block,false).getReplica();
  ReplicaOutputStreams streams=null;
  try {
    streams=replicaInfo.createStreams(true,DataChecksum.newDataChecksum(DataChecksum.Type.CRC32,512));
    streams.getChecksumOut().write('a');
    dn.data.initReplicaRecovery(new RecoveringBlock(block,null,RECOVERY_ID + 1));
    try {
      dn.syncBlock(rBlock,initBlockRecords(dn));
      fail("Sync should fail");
    }
 catch (    IOException e) {
      e.getMessage().startsWith("Cannot recover ");
    }
    DatanodeProtocol namenode=dn.getActiveNamenodeForBP(POOL_ID);
    verify(namenode,never()).commitBlockSynchronization(any(ExtendedBlock.class),anyLong(),anyLong(),anyBoolean(),anyBoolean(),any(DatanodeID[].class),any(String[].class));
  }
  finally {
    streams.close();
  }
}
