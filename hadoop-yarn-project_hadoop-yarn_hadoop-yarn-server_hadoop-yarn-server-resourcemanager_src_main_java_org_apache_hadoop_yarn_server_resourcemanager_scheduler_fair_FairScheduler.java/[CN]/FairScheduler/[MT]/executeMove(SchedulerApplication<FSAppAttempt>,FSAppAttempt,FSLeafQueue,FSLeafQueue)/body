{
  boolean wasRunnable=oldQueue.removeApp(attempt);
  boolean nowRunnable=maxRunningEnforcer.canAppBeRunnable(newQueue,attempt.getUser());
  if (wasRunnable && !nowRunnable) {
    throw new IllegalStateException("Should have already verified that app " + attempt.getApplicationId() + " would be runnable in new queue");
  }
  if (wasRunnable) {
    maxRunningEnforcer.untrackRunnableApp(attempt);
  }
 else   if (nowRunnable) {
    maxRunningEnforcer.untrackNonRunnableApp(attempt);
  }
  attempt.move(newQueue);
  app.setQueue(newQueue);
  newQueue.addApp(attempt,nowRunnable);
  if (nowRunnable) {
    maxRunningEnforcer.trackRunnableApp(attempt);
  }
  if (wasRunnable) {
    maxRunningEnforcer.updateRunnabilityOnAppRemoval(attempt,oldQueue);
  }
}
