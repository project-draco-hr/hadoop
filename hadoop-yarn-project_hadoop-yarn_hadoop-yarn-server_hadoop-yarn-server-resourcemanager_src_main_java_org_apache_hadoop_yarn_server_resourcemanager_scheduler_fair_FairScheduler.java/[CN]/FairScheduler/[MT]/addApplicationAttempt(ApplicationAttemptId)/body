{
  SchedulerApplication application=applications.get(applicationAttemptId.getApplicationId());
  String user=application.getUser();
  FSLeafQueue queue=(FSLeafQueue)application.getQueue();
  FSSchedulerApp schedulerApp=new FSSchedulerApp(applicationAttemptId,user,queue,new ActiveUsersManager(getRootQueueMetrics()),rmContext);
  boolean runnable=maxRunningEnforcer.canAppBeRunnable(queue,user);
  queue.addApp(schedulerApp,runnable);
  if (runnable) {
    maxRunningEnforcer.trackRunnableApp(schedulerApp);
  }
 else {
    maxRunningEnforcer.trackNonRunnableApp(schedulerApp);
  }
  queue.getMetrics().submitApp(user,applicationAttemptId.getAttemptId());
  appAttempts.put(applicationAttemptId,schedulerApp);
  LOG.info("Added Application Attempt " + applicationAttemptId + " to scheduler from user: "+ user+ ", currently active: "+ appAttempts.size());
  rmContext.getDispatcher().getEventHandler().handle(new RMAppAttemptEvent(applicationAttemptId,RMAppAttemptEventType.ATTEMPT_ADDED));
}
