{
  LOG.info("Application " + applicationAttemptId + " is done."+ " finalState="+ rmAppAttemptFinalState);
  FSSchedulerApp application=applications.get(applicationAttemptId);
  if (application == null) {
    LOG.info("Unknown application " + applicationAttemptId + " has completed!");
    return;
  }
  for (  RMContainer rmContainer : application.getLiveContainers()) {
    completedContainer(rmContainer,SchedulerUtils.createAbnormalContainerStatus(rmContainer.getContainerId(),SchedulerUtils.COMPLETED_APPLICATION),RMContainerEventType.KILL);
  }
  for (  RMContainer rmContainer : application.getReservedContainers()) {
    completedContainer(rmContainer,SchedulerUtils.createAbnormalContainerStatus(rmContainer.getContainerId(),"Application Complete"),RMContainerEventType.KILL);
  }
  application.stop(rmAppAttemptFinalState);
  FSLeafQueue queue=queueMgr.getLeafQueue(application.getQueue().getQueueName(),false);
  boolean wasRunnable=queue.removeApp(application);
  if (wasRunnable) {
    maxRunningEnforcer.updateRunnabilityOnAppRemoval(application);
  }
 else {
    maxRunningEnforcer.untrackNonRunnableApp(application);
  }
  applications.remove(applicationAttemptId);
}
