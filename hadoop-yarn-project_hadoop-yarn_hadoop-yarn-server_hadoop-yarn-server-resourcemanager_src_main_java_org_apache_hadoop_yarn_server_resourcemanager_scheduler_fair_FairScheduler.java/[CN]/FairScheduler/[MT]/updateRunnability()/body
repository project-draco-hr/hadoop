{
  List<AppSchedulable> apps=new ArrayList<AppSchedulable>();
  for (  FSLeafQueue leafQueue : queueMgr.getLeafQueues()) {
    for (    AppSchedulable a : leafQueue.getAppSchedulables()) {
      a.setRunnable(false);
      apps.add(a);
    }
  }
  Collections.sort(apps,new FifoAppComparator());
  Map<String,Integer> userApps=new HashMap<String,Integer>();
  Map<String,Integer> queueApps=new HashMap<String,Integer>();
  for (  AppSchedulable app : apps) {
    String user=app.getApp().getUser();
    String queue=app.getApp().getQueueName();
    int userCount=userApps.containsKey(user) ? userApps.get(user) : 0;
    int queueCount=queueApps.containsKey(queue) ? queueApps.get(queue) : 0;
    if (userCount < queueMgr.getUserMaxApps(user) && queueCount < queueMgr.getQueueMaxApps(queue)) {
      userApps.put(user,userCount + 1);
      queueApps.put(queue,queueCount + 1);
      app.setRunnable(true);
    }
  }
}
