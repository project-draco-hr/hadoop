{
  if (queueName == null || queueName.isEmpty()) {
    String message="Reject application " + applicationAttemptId + " submitted by user "+ user+ " with an empty queue name.";
    LOG.info(message);
    rmContext.getDispatcher().getEventHandler().handle(new RMAppAttemptRejectedEvent(applicationAttemptId,message));
    return;
  }
  RMApp rmApp=rmContext.getRMApps().get(applicationAttemptId.getApplicationId());
  FSLeafQueue queue=assignToQueue(rmApp,queueName,user);
  if (queue == null) {
    rmContext.getDispatcher().getEventHandler().handle(new RMAppAttemptRejectedEvent(applicationAttemptId,"Application rejected by queue placement policy"));
    return;
  }
  FSSchedulerApp schedulerApp=new FSSchedulerApp(applicationAttemptId,user,queue,new ActiveUsersManager(getRootQueueMetrics()),rmContext);
  UserGroupInformation userUgi=UserGroupInformation.createRemoteUser(user);
  if (!queue.hasAccess(QueueACL.SUBMIT_APPLICATIONS,userUgi) && !queue.hasAccess(QueueACL.ADMINISTER_QUEUE,userUgi)) {
    String msg="User " + userUgi.getUserName() + " cannot submit applications to queue "+ queue.getName();
    LOG.info(msg);
    rmContext.getDispatcher().getEventHandler().handle(new RMAppAttemptRejectedEvent(applicationAttemptId,msg));
    return;
  }
  boolean runnable=maxRunningEnforcer.canAppBeRunnable(queue,user);
  queue.addApp(schedulerApp,runnable);
  if (runnable) {
    maxRunningEnforcer.trackRunnableApp(schedulerApp);
  }
 else {
    maxRunningEnforcer.trackNonRunnableApp(schedulerApp);
  }
  queue.getMetrics().submitApp(user,applicationAttemptId.getAttemptId());
  applications.put(applicationAttemptId,schedulerApp);
  LOG.info("Application Submission: " + applicationAttemptId + ", user: "+ user+ ", currently active: "+ applications.size());
  rmContext.getDispatcher().getEventHandler().handle(new RMAppAttemptEvent(applicationAttemptId,RMAppAttemptEventType.APP_ACCEPTED));
}
