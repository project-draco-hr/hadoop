{
  String queueName=targetQueue.getQueueName();
  ApplicationAttemptId appAttId=app.getApplicationAttemptId();
  FSQueue lowestCommonAncestor=findLowestCommonAncestorQueue(oldQueue,targetQueue);
  Resource consumption=app.getCurrentConsumption();
  FSQueue cur=targetQueue;
  while (cur != lowestCommonAncestor) {
    if (cur.getNumRunnableApps() == cur.getMaxRunningApps()) {
      throw new YarnException("Moving app attempt " + appAttId + " to queue "+ queueName+ " would violate queue maxRunningApps constraints on"+ " queue "+ cur.getQueueName());
    }
    if (!Resources.fitsIn(Resources.add(cur.getResourceUsage(),consumption),cur.getMaxShare())) {
      throw new YarnException("Moving app attempt " + appAttId + " to queue "+ queueName+ " would violate queue maxShare constraints on"+ " queue "+ cur.getQueueName());
    }
    cur=cur.getParent();
  }
}
