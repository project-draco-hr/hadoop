{
  GetClusterMetricsRequest req=GetClusterMetricsRequest.newInstance();
  for (int i=0; i < timeout / 10; i++) {
    ResourceManager rm=getResourceManager();
    if (rm == null) {
      throw new YarnException("Can not find the active RM.");
    }
 else     if (nodeManagers.length == rm.getClientRMService().getClusterMetrics(req).getClusterMetrics().getNumNodeManagers()) {
      LOG.info("All Node Managers connected in MiniYARNCluster");
      return true;
    }
    Thread.sleep(10);
  }
  LOG.info("Node Managers did not connect within 5000ms");
  return false;
}
