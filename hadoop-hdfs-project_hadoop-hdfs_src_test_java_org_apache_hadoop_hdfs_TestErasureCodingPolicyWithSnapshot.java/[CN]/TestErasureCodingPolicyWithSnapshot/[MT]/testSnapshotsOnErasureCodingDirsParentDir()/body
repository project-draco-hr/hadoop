{
  final int len=1024;
  final Path ecDirParent=new Path("/parent");
  final Path ecDir=new Path(ecDirParent,"ecdir");
  final Path ecFile=new Path(ecDir,"ecfile");
  fs.mkdirs(ecDir);
  fs.allowSnapshot(ecDirParent);
  fs.setErasureCodingPolicy(ecDir,sysDefaultPolicy);
  DFSTestUtil.createFile(fs,ecFile,len,(short)1,0xFEED);
  String contents=DFSTestUtil.readFile(fs,ecFile);
  final Path snap1=fs.createSnapshot(ecDirParent,"snap1");
  final Path snap1ECDir=new Path(snap1,ecDir.getName());
  assertEquals("Got unexpected erasure coding policy",sysDefaultPolicy,fs.getErasureCodingPolicy(snap1ECDir));
  fs.delete(ecDir,true);
  fs.mkdir(ecDir,FsPermission.getDirDefault());
  final Path snap2=fs.createSnapshot(ecDirParent,"snap2");
  final Path snap2ECDir=new Path(snap2,ecDir.getName());
  assertNull("Expected null erasure coding policy",fs.getErasureCodingPolicy(snap2ECDir));
  fs.setErasureCodingPolicy(ecDir,sysDefaultPolicy);
  final Path snap3=fs.createSnapshot(ecDirParent,"snap3");
  final Path snap3ECDir=new Path(snap3,ecDir.getName());
  ErasureCodingPolicy ezSnap3=fs.getErasureCodingPolicy(snap3ECDir);
  assertEquals("Got unexpected erasure coding policy",sysDefaultPolicy,ezSnap3);
  assertEquals("Got unexpected erasure coding policy",sysDefaultPolicy,fs.getErasureCodingPolicy(snap1ECDir));
  assertEquals("Got unexpected erasure coding policy",sysDefaultPolicy,fs.getErasureCodingPolicy(snap2ECDir));
  final Path snapshottedECFile=new Path(snap1.toString() + "/" + ecDir.getName()+ "/"+ ecFile.getName());
  assertEquals("Contents of snapshotted file have changed unexpectedly",contents,DFSTestUtil.readFile(fs,snapshottedECFile));
  fs.deleteSnapshot(ecDirParent,snap2.getName());
  assertEquals("Got unexpected erasure coding policy",sysDefaultPolicy,fs.getErasureCodingPolicy(snap1ECDir));
  assertEquals("Got unexpected erasure coding policy",sysDefaultPolicy,fs.getErasureCodingPolicy(snap3ECDir));
  fs.deleteSnapshot(ecDirParent,snap1.getName());
  assertEquals("Got unexpected erasure coding policy",sysDefaultPolicy,fs.getErasureCodingPolicy(snap3ECDir));
}
