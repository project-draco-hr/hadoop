{
  final Path ecDir=new Path("/ecdir");
  fs.mkdirs(ecDir);
  fs.allowSnapshot(ecDir);
  fs.setErasureCodingPolicy(ecDir,sysDefaultPolicy);
  final Path snap1=fs.createSnapshot(ecDir,"snap1");
  ErasureCodingPolicy ecSnap=fs.getErasureCodingPolicy(snap1);
  assertEquals("Got unexpected erasure coding policy",sysDefaultPolicy,ecSnap);
  fs.setSafeMode(SafeModeAction.SAFEMODE_ENTER);
  fs.saveNamespace();
  fs.setSafeMode(SafeModeAction.SAFEMODE_LEAVE);
  cluster.restartNameNode(true);
  ErasureCodingPolicy ecSnap1=fs.getErasureCodingPolicy(snap1);
  assertEquals("Got unexpected erasure coding policy",sysDefaultPolicy,ecSnap1);
  assertEquals("Got unexpected ecSchema",ecSnap.getSchema(),ecSnap1.getSchema());
}
