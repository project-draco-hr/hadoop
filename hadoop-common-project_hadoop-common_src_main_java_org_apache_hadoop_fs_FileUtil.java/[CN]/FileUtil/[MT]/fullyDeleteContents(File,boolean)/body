{
  if (tryGrantPermissions) {
    grantPermissions(dir);
  }
  boolean deletionSucceeded=true;
  final File[] contents=dir.listFiles();
  if (contents != null) {
    for (int i=0; i < contents.length; i++) {
      if (contents[i].isFile()) {
        if (!deleteImpl(contents[i],true)) {
          deletionSucceeded=false;
          continue;
        }
      }
 else {
        boolean b=false;
        b=deleteImpl(contents[i],false);
        if (b) {
          continue;
        }
        if (!fullyDelete(contents[i],tryGrantPermissions)) {
          deletionSucceeded=false;
        }
      }
    }
  }
  return deletionSucceeded;
}
