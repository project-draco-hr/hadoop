{
  TaskReport report=recordFactory.newRecordInstance(TaskReport.class);
  readLock.lock();
  try {
    TaskAttempt bestAttempt=selectBestAttempt();
    report.setTaskId(taskId);
    report.setStartTime(getLaunchTime());
    report.setFinishTime(getFinishTime());
    report.setTaskState(getState());
    report.setProgress(bestAttempt == null ? 0f : bestAttempt.getProgress());
    report.setStatus(bestAttempt == null ? "" : bestAttempt.getReport().getStateString());
    for (    TaskAttempt attempt : attempts.values()) {
      if (TaskAttemptState.RUNNING.equals(attempt.getState())) {
        report.addRunningAttempt(attempt.getID());
      }
    }
    report.setSuccessfulAttempt(successfulAttempt);
    for (    TaskAttempt att : attempts.values()) {
      String prefix="AttemptID:" + att.getID() + " Info:";
      for (      CharSequence cs : att.getDiagnostics()) {
        report.addDiagnostics(prefix + cs);
      }
    }
    report.setCounters(TypeConverter.toYarn(bestAttempt == null ? TaskAttemptImpl.EMPTY_COUNTERS : bestAttempt.getCounters()));
    return report;
  }
  finally {
    readLock.unlock();
  }
}
