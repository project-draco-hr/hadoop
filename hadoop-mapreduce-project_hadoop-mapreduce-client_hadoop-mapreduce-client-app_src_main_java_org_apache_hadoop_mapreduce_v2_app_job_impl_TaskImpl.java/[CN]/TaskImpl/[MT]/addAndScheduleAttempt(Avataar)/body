{
  TaskAttempt attempt=createAttempt();
  ((TaskAttemptImpl)attempt).setAvataar(avataar);
  if (LOG.isDebugEnabled()) {
    LOG.debug("Created attempt " + attempt.getID());
  }
switch (attempts.size()) {
case 0:
    attempts=Collections.singletonMap(attempt.getID(),attempt);
  break;
case 1:
Map<TaskAttemptId,TaskAttempt> newAttempts=new LinkedHashMap<TaskAttemptId,TaskAttempt>(maxAttempts);
newAttempts.putAll(attempts);
attempts=newAttempts;
attempts.put(attempt.getID(),attempt);
break;
default :
attempts.put(attempt.getID(),attempt);
break;
}
if (taskAttemptsFromPreviousGeneration.isEmpty()) {
++nextAttemptNumber;
}
 else {
nextAttemptNumber=taskAttemptsFromPreviousGeneration.remove(0).getAttemptId().getId();
}
inProgressAttempts.add(attempt.getID());
if (failedAttempts.size() > 0) {
eventHandler.handle(new TaskAttemptEvent(attempt.getID(),TaskAttemptEventType.TA_RESCHEDULE));
}
 else {
eventHandler.handle(new TaskAttemptEvent(attempt.getID(),TaskAttemptEventType.TA_SCHEDULE));
}
}
