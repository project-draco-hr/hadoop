{
  TaskAttemptId taskAttemptId=((TaskTAttemptEvent)event).getTaskAttemptID();
  task.handleTaskAttemptCompletion(taskAttemptId,taCompletionEventStatus);
  task.finishedAttempts.add(taskAttemptId);
  if (task.finishedAttempts.size() == task.attempts.size()) {
    if (task.historyTaskStartGenerated) {
      TaskFailedEvent taskFailedEvent=createTaskFailedEvent(task,null,finalState,null);
      task.eventHandler.handle(new JobHistoryEvent(task.taskId.getJobId(),taskFailedEvent));
    }
 else {
      LOG.debug("Not generating HistoryFinish event since start event not" + " generated for task: " + task.getID());
    }
    task.eventHandler.handle(new JobTaskEvent(task.taskId,getExternalState(finalState)));
    return finalState;
  }
  return task.getInternalState();
}
