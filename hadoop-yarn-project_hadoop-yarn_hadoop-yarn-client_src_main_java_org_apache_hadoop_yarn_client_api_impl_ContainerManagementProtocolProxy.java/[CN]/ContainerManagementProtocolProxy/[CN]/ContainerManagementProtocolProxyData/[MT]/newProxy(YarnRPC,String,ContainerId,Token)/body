{
  if (token == null) {
    throw new InvalidToken("No NMToken sent for " + containerManagerBindAddr);
  }
  final InetSocketAddress cmAddr=NetUtils.createSocketAddr(containerManagerBindAddr);
  LOG.info("Opening proxy : " + containerManagerBindAddr);
  UserGroupInformation user=UserGroupInformation.createRemoteUser(containerId.getApplicationAttemptId().toString());
  org.apache.hadoop.security.token.Token<NMTokenIdentifier> nmToken=ConverterUtils.convertFromYarn(token,cmAddr);
  user.addToken(nmToken);
  ContainerManagementProtocol proxy=user.doAs(new PrivilegedAction<ContainerManagementProtocol>(){
    @Override public ContainerManagementProtocol run(){
      return (ContainerManagementProtocol)rpc.getProxy(ContainerManagementProtocol.class,cmAddr,conf);
    }
  }
);
  return proxy;
}
