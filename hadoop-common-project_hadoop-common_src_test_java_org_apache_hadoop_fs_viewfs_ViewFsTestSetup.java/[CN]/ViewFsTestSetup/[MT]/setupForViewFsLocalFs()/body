{
  FileContext fsTarget=FileContext.getLocalFSFileContext();
  Path targetOfTests=FileContextTestHelper.getTestRootPath(fsTarget);
  fsTarget.delete(targetOfTests,true);
  fsTarget.mkdir(targetOfTests,FileContext.DEFAULT_PERM,true);
  Configuration conf=new Configuration();
  String testDir=FileContextTestHelper.getTestRootPath(fsTarget).toUri().getPath();
  linkUpFirstComponents(conf,testDir,fsTarget,"test dir");
  setUpHomeDir(conf,fsTarget);
  String wdDir=fsTarget.getWorkingDirectory().toUri().getPath();
  linkUpFirstComponents(conf,wdDir,fsTarget,"working dir");
  FileContext fc=FileContext.getFileContext(FsConstants.VIEWFS_URI,conf);
  fc.setWorkingDirectory(new Path(wdDir));
  Log.info("Working dir is: " + fc.getWorkingDirectory());
  return fc;
}
