{
  long now=System.currentTimeMillis();
  try {
    FileStatus[] historyFiles=doneDirFs.listStatus(done);
    if (historyFiles != null) {
      for (      FileStatus f : historyFiles) {
        if (now - f.getModificationTime() > maxAgeOfHistoryFiles) {
          doneDirFs.delete(f.getPath(),true);
          LOG.info("Deleting old history file : " + f.getPath());
        }
      }
    }
synchronized (jobHistoryFileMap) {
      Iterator<Entry<JobID,MovedFileInfo>> it=jobHistoryFileMap.entrySet().iterator();
      while (it.hasNext()) {
        MovedFileInfo info=it.next().getValue();
        if (now - info.timestamp > maxAgeOfHistoryFiles) {
          it.remove();
        }
 else {
          break;
        }
      }
    }
  }
 catch (  IOException ie) {
    LOG.info("Error cleaning up history directory" + StringUtils.stringifyException(ie));
  }
}
