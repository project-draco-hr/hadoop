{
  conf=getConf();
  Configuration[] overlays=new Configuration[numDNs];
  for (int i=0; i < overlays.length; i++) {
    int offset=i * 10;
    Configuration c=new Configuration();
    c.set(DFSConfigKeys.DFS_DATANODE_ADDRESS_KEY,"127.0.0.1:" + ServerSocketUtil.getPort(19866 + offset,100));
    c.set(DFSConfigKeys.DFS_DATANODE_IPC_ADDRESS_KEY,"127.0.0.1:" + ServerSocketUtil.getPort(19867 + offset,100));
    overlays[i]=c;
  }
  cluster=new MiniDFSCluster.Builder(conf).nameNodePort(ServerSocketUtil.getPort(19820,100)).nameNodeHttpPort(ServerSocketUtil.getPort(19870,100)).numDataNodes(numDNs).build();
  cluster.getFileSystem().getClient().setErasureCodingPolicy("/",null);
  try {
    cluster.waitActive();
    doTestRead(conf,cluster,true);
  }
  finally {
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
