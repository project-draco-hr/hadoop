{
  RandomAccessFile out=new RandomAccessFile(new File(fileToCorrupt.toString()),"rw");
  byte[] buf=new byte[(int)fileSys.getFileStatus(file).getLen()];
  int corruptFileLen=(int)fileSys.getFileStatus(fileToCorrupt).getLen();
  assertTrue(buf.length >= corruptFileLen);
  rand.nextBytes(buf);
  out.seek(corruptFileLen / 2);
  out.write(buf,0,corruptFileLen / 4);
  out.close();
  boolean gotException=false;
  InputStream in=fileSys.open(file);
  try {
    IOUtils.readFully(in,buf,0,buf.length);
  }
 catch (  ChecksumException e) {
    gotException=true;
  }
  assertTrue(gotException);
  in.close();
}
