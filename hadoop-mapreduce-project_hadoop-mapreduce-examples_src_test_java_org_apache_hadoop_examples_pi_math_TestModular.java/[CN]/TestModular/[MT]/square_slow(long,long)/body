{
  long r=0;
  for (long s=z; z > 0; z>>=1) {
    if ((((int)z) & 1) == 1) {
      r+=s;
      if (r >= n)       r-=n;
    }
    s<<=1;
    if (s >= n)     s-=n;
  }
  return r;
}
