{
  try {
    signature=URLDecoder.decode(signature,"UTF-8");
  }
 catch (  Exception e) {
    LOG.error("Authorization exception:",e);
    return NO_ACCESS;
  }
  if (debug) {
    LOG.debug(data + " sig: " + signature+ " user: "+ user+ " time: "+ timestamp);
  }
  try {
    loadACL();
    UserACL userACL=acl.get(user);
    if (userACL == null) {
      return NO_ACCESS;
    }
    String signatureTest=hmac(data,userACL.key);
    if (debug) {
      LOG.debug("SignatureTest " + signatureTest);
      LOG.debug("Signature " + signature);
    }
    if (signatureTest.equals(signature) && !isReplay(timestamp,signature,userACL)) {
      return (userACL.role.equals("admin")) ? ADMIN : USER;
    }
  }
 catch (  Exception e) {
    LOG.error("Athorization exception:",e);
  }
  return NO_ACCESS;
}
