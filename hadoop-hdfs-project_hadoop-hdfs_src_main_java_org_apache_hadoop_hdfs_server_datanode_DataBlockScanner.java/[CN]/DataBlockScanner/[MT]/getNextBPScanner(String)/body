{
  String nextBpId=null;
  while ((nextBpId == null) && datanode.shouldRun && !blockScannerThread.isInterrupted()) {
    waitForInit(currentBpId);
synchronized (this) {
      if (getBlockPoolSetSize() > 0) {
        long lastScanTime=0;
        for (        String bpid : blockPoolScannerMap.keySet()) {
          final long t=getBPScanner(bpid).getLastScanTime();
          if (t != 0L) {
            if (bpid == null || t < lastScanTime) {
              lastScanTime=t;
              nextBpId=bpid;
            }
          }
        }
        if (nextBpId == null) {
          nextBpId=blockPoolScannerMap.higherKey(currentBpId);
          if (nextBpId == null) {
            nextBpId=blockPoolScannerMap.firstKey();
          }
        }
        if (nextBpId != null) {
          return getBPScanner(nextBpId);
        }
      }
    }
    LOG.warn("No block pool is up, going to wait");
    try {
      Thread.sleep(5000);
    }
 catch (    InterruptedException ex) {
      LOG.warn("Received exception: " + ex);
      blockScannerThread.interrupt();
      return null;
    }
  }
  return null;
}
