{
  clearAllPendingReduceRequests();
  int preemptionReduceNumForOneMap=ResourceCalculatorUtils.divideAndCeilContainers(mapResourceRequest,reduceResourceRequest,getSchedulerResourceTypes());
  int preemptionReduceNumForPreemptionLimit=ResourceCalculatorUtils.divideAndCeilContainers(Resources.multiply(getResourceLimit(),maxReducePreemptionLimit),reduceResourceRequest,getSchedulerResourceTypes());
  int preemptionReduceNumForAllMaps=ResourceCalculatorUtils.divideAndCeilContainers(Resources.multiply(mapResourceRequest,hangingMapRequests),reduceResourceRequest,getSchedulerResourceTypes());
  int toPreempt=Math.min(Math.max(preemptionReduceNumForOneMap,preemptionReduceNumForPreemptionLimit),preemptionReduceNumForAllMaps);
  LOG.info("Going to preempt " + toPreempt + " due to lack of space for maps");
  assignedRequests.preemptReduce(toPreempt);
}
