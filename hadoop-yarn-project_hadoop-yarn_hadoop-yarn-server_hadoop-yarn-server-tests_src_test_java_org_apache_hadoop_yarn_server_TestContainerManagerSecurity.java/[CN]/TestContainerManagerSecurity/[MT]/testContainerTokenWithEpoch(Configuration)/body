{
  LOG.info("Running test for serializing/deserializing containerIds");
  NMTokenSecretManagerInRM nmTokenSecretManagerInRM=yarnCluster.getResourceManager().getRMContext().getNMTokenSecretManager();
  ApplicationId appId=ApplicationId.newInstance(1,1);
  ApplicationAttemptId appAttemptId=ApplicationAttemptId.newInstance(appId,0);
  ContainerId cId=ContainerId.newInstance(appAttemptId,(5L << 40) | 3L);
  NodeManager nm=yarnCluster.getNodeManager(0);
  NMTokenSecretManagerInNM nmTokenSecretManagerInNM=nm.getNMContext().getNMTokenSecretManager();
  String user="test";
  waitForNMToReceiveNMTokenKey(nmTokenSecretManagerInNM,nm);
  NodeId nodeId=nm.getNMContext().getNodeId();
  Assert.assertEquals(nmTokenSecretManagerInNM.getCurrentKey().getKeyId(),nmTokenSecretManagerInRM.getCurrentKey().getKeyId());
  RMContainerTokenSecretManager containerTokenSecretManager=yarnCluster.getResourceManager().getRMContext().getContainerTokenSecretManager();
  Resource r=Resource.newInstance(1230,2);
  Token containerToken=containerTokenSecretManager.createContainerToken(cId,nodeId,user,r,Priority.newInstance(0),0);
  ByteArrayDataInput input=ByteStreams.newDataInput(containerToken.getIdentifier().array());
  ContainerTokenIdentifier containerTokenIdentifier=new ContainerTokenIdentifier();
  containerTokenIdentifier.readFields(input);
  Assert.assertEquals(cId,containerTokenIdentifier.getContainerID());
  Assert.assertEquals(cId.toString(),containerTokenIdentifier.getContainerID().toString());
  Token nmToken=nmTokenSecretManagerInRM.createNMToken(appAttemptId,nodeId,user);
  YarnRPC rpc=YarnRPC.create(conf);
  testStartContainer(rpc,appAttemptId,nodeId,containerToken,nmToken,false);
  List<ContainerId> containerIds=new LinkedList<ContainerId>();
  containerIds.add(cId);
  ContainerManagementProtocol proxy=getContainerManagementProtocolProxy(rpc,nmToken,nodeId,user);
  GetContainerStatusesResponse res=proxy.getContainerStatuses(GetContainerStatusesRequest.newInstance(containerIds));
  Assert.assertNotNull(res.getContainerStatuses().get(0));
  Assert.assertEquals(cId,res.getContainerStatuses().get(0).getContainerId());
  Assert.assertEquals(cId.toString(),res.getContainerStatuses().get(0).getContainerId().toString());
}
