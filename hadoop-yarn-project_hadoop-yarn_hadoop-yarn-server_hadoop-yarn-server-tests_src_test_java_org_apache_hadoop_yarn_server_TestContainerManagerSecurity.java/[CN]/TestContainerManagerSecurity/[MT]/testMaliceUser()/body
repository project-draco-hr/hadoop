{
  LOG.info("Running test for malice user");
  ResourceManager resourceManager=yarnCluster.getResourceManager();
  final YarnRPC yarnRPC=YarnRPC.create(conf);
  ApplicationId appID=resourceManager.getClientRMService().getNewApplication(Records.newRecord(GetNewApplicationRequest.class)).getApplicationId();
  AMRMProtocol scheduler=submitAndRegisterApplication(resourceManager,yarnRPC,appID);
  final Container allocatedContainer=requestAndGetContainer(scheduler,appID);
  org.apache.hadoop.yarn.api.records.Token containerToken=allocatedContainer.getContainerToken();
  ContainerTokenIdentifier originalContainerTokenId=BuilderUtils.newContainerTokenIdentifier(containerToken);
  Resource modifiedResource=BuilderUtils.newResource(2048,1);
  ContainerTokenIdentifier modifiedIdentifier=new ContainerTokenIdentifier(originalContainerTokenId.getContainerID(),originalContainerTokenId.getNmHostAddress(),"testUser",modifiedResource,Long.MAX_VALUE,originalContainerTokenId.getMasterKeyId(),ResourceManager.clusterTimeStamp);
  Token<ContainerTokenIdentifier> modifiedToken=new Token<ContainerTokenIdentifier>(modifiedIdentifier.getBytes(),containerToken.getPassword().array(),new Text(containerToken.getKind()),new Text(containerToken.getService()));
  makeTamperedStartContainerCall(yarnRPC,allocatedContainer,modifiedIdentifier,modifiedToken);
  ContainerId newContainerId=BuilderUtils.newContainerId(BuilderUtils.newApplicationAttemptId(originalContainerTokenId.getContainerID().getApplicationAttemptId().getApplicationId(),1),originalContainerTokenId.getContainerID().getId() + 42);
  modifiedIdentifier=new ContainerTokenIdentifier(newContainerId,originalContainerTokenId.getNmHostAddress(),"testUser",originalContainerTokenId.getResource(),Long.MAX_VALUE,originalContainerTokenId.getMasterKeyId(),ResourceManager.clusterTimeStamp);
  modifiedToken=new Token<ContainerTokenIdentifier>(modifiedIdentifier.getBytes(),containerToken.getPassword().array(),new Text(containerToken.getKind()),new Text(containerToken.getService()));
  makeTamperedStartContainerCall(yarnRPC,allocatedContainer,modifiedIdentifier,modifiedToken);
  KillApplicationRequest request=Records.newRecord(KillApplicationRequest.class);
  request.setApplicationId(appID);
  resourceManager.getClientRMService().forceKillApplication(request);
}
