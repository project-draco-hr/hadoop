{
  SecurityUtilTestHelper.setTokenServiceUseIp(true);
  Configuration conf=new Configuration();
  conf.setClass("fs.hftp.impl",MyHftpFileSystem.class,FileSystem.class);
  int httpPort=80;
  int httpsPort=443;
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_HTTP_PORT_KEY,httpPort);
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_HTTPS_PORT_KEY,httpsPort);
  URI fsUri=URI.create("hftp://localhost");
  MyHftpFileSystem fs=(MyHftpFileSystem)FileSystem.newInstance(fsUri,conf);
  assertEquals(httpPort,fs.getCanonicalUri().getPort());
  checkTokenSelection(fs,httpPort,conf);
  fsUri=URI.create("hftp://localhost:" + httpPort);
  fs=(MyHftpFileSystem)FileSystem.newInstance(fsUri,conf);
  assertEquals(httpPort,fs.getCanonicalUri().getPort());
  checkTokenSelection(fs,httpPort,conf);
  fsUri=URI.create("hftp://localhost:" + (httpPort + 1));
  fs=(MyHftpFileSystem)FileSystem.newInstance(fsUri,conf);
  assertEquals(httpPort + 1,fs.getCanonicalUri().getPort());
  checkTokenSelection(fs,httpPort + 1,conf);
  conf.setInt(DFSConfigKeys.DFS_NAMENODE_HTTPS_PORT_KEY,5);
}
