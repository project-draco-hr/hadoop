{
  long bytes=0;
  while (true) {
    int b=in.read();
    if (b == -1) {
      break;
    }
    bytes+=1;
    byte c=(byte)b;
    if (c == EOL || c == delimiter) {
      break;
    }
    if (c == '\r') {
      in.mark(1);
      byte nextC=(byte)in.read();
      if (nextC != EOL || c == delimiter) {
        in.reset();
      }
 else {
        bytes+=1;
      }
      break;
    }
    if (out != null) {
      out.write(c);
    }
  }
  return bytes;
}
