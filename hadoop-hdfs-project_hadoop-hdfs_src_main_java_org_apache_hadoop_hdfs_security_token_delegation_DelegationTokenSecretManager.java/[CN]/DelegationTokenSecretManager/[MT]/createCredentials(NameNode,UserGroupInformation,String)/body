{
  final Token<DelegationTokenIdentifier> token=namenode.getRpcServer().getDelegationToken(new Text(renewer));
  if (token == null) {
    throw new IOException("Failed to get the token for " + renewer + ", user="+ ugi.getShortUserName());
  }
  final InetSocketAddress addr=namenode.getNameNodeAddress();
  SecurityUtil.setTokenService(token,addr);
  final Credentials c=new Credentials();
  c.addToken(new Text(ugi.getShortUserName()),token);
  return c;
}
