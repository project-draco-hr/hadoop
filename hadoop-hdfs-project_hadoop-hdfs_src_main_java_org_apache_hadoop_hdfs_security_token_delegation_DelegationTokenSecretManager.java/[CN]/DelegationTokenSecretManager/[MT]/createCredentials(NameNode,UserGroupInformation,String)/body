{
  final Token<DelegationTokenIdentifier> token=namenode.getRpcServer().getDelegationToken(new Text(renewer));
  if (token == null) {
    throw new IOException("Failed to get the token for " + renewer + ", user="+ ugi.getShortUserName());
  }
  final InetSocketAddress addr=namenode.getNameNodeAddress();
  final String s=addr.getAddress().getHostAddress() + ":" + addr.getPort();
  token.setService(new Text(s));
  final Credentials c=new Credentials();
  c.addToken(new Text(ugi.getShortUserName()),token);
  return c;
}
