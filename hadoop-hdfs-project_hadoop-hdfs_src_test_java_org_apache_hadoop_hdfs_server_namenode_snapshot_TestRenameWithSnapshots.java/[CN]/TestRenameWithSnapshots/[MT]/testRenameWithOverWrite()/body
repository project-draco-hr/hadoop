{
  final Path root=new Path("/");
  final Path foo=new Path(root,"foo");
  final Path file1InFoo=new Path(foo,"file1");
  final Path file2InFoo=new Path(foo,"file2");
  final Path file3InFoo=new Path(foo,"file3");
  DFSTestUtil.createFile(hdfs,file1InFoo,1L,REPL,SEED);
  DFSTestUtil.createFile(hdfs,file2InFoo,1L,REPL,SEED);
  DFSTestUtil.createFile(hdfs,file3InFoo,1L,REPL,SEED);
  final Path bar=new Path(root,"bar");
  hdfs.mkdirs(bar);
  SnapshotTestHelper.createSnapshot(hdfs,root,"s0");
  final Path fileInBar=new Path(bar,"file1");
  hdfs.rename(file1InFoo,fileInBar);
  final Path newDir=new Path(root,"newDir");
  hdfs.rename(bar,newDir);
  final Path file2InNewDir=new Path(newDir,"file2");
  hdfs.rename(file2InFoo,file2InNewDir);
  final Path file1InNewDir=new Path(newDir,"file1");
  hdfs.rename(file3InFoo,file1InNewDir,Rename.OVERWRITE);
  SnapshotTestHelper.createSnapshot(hdfs,root,"s1");
  SnapshotDiffReport report=hdfs.getSnapshotDiffReport(root,"s0","s1");
  LOG.info("DiffList is \n\"" + report.toString() + "\"");
  List<DiffReportEntry> entries=report.getDiffList();
  assertEquals(7,entries.size());
  assertTrue(existsInDiffReport(entries,DiffType.MODIFY,"",null));
  assertTrue(existsInDiffReport(entries,DiffType.MODIFY,foo.getName(),null));
  assertTrue(existsInDiffReport(entries,DiffType.MODIFY,bar.getName(),null));
  assertTrue(existsInDiffReport(entries,DiffType.DELETE,"foo/file1",null));
  assertTrue(existsInDiffReport(entries,DiffType.RENAME,"bar","newDir"));
  assertTrue(existsInDiffReport(entries,DiffType.RENAME,"foo/file2","newDir/file2"));
  assertTrue(existsInDiffReport(entries,DiffType.RENAME,"foo/file3","newDir/file1"));
}
