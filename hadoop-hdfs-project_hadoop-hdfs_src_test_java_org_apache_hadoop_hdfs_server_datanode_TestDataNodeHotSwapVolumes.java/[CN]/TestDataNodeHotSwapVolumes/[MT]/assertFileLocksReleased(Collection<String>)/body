{
  for (  String dir : dirs) {
    StorageLocation sl=StorageLocation.parse(dir);
    File lockFile=new File(sl.getFile(),Storage.STORAGE_FILE_LOCK);
    RandomAccessFile raf=null;
    FileChannel channel=null;
    FileLock lock=null;
    try {
      raf=new RandomAccessFile(lockFile,"rws");
      channel=raf.getChannel();
      lock=channel.tryLock();
      assertNotNull(String.format("Lock file at %s appears to be held by a different process.",lockFile.getAbsolutePath()),lock);
    }
 catch (    OverlappingFileLockException e) {
      fail(String.format("Must release lock file at %s.",lockFile.getAbsolutePath()));
    }
 finally {
      if (lock != null) {
        try {
          lock.release();
        }
 catch (        IOException e) {
          LOG.warn(String.format("I/O error releasing file lock %s.",lockFile.getAbsolutePath()),e);
        }
      }
      IOUtils.cleanup(null,channel,raf);
    }
  }
}
