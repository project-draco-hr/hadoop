{
  startDFSCluster(1,1);
  String bpid=cluster.getNamesystem().getBlockPoolId();
  Path testFile=new Path("/test");
  createFile(testFile,4);
  addVolumes(2);
  DFSTestUtil.appendFile(cluster.getFileSystem(),testFile,BLOCK_SIZE * 8);
  verifyFileLength(cluster.getFileSystem(),testFile,8 + 4);
  List<Integer> expectedNumBlocks=Arrays.asList(2,2,4,4);
  List<Map<DatanodeStorage,BlockListAsLongs>> blockReports=cluster.getAllBlockReports(bpid);
  assertEquals(1,blockReports.size());
  assertEquals(4,blockReports.get(0).size());
  Map<DatanodeStorage,BlockListAsLongs> dnReport=blockReports.get(0);
  List<Integer> actualNumBlocks=new ArrayList<Integer>();
  for (  BlockListAsLongs blockList : dnReport.values()) {
    actualNumBlocks.add(blockList.getNumberOfBlocks());
  }
  Collections.sort(actualNumBlocks);
  assertEquals(expectedNumBlocks,actualNumBlocks);
}
