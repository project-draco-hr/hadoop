{
  startDFSCluster(1,1);
  DataNode dn=cluster.getDataNodes().get(0);
  Configuration conf=dn.getConf();
  String oldPaths=conf.get(DFS_DATANODE_DATA_DIR_KEY);
  List<StorageLocation> oldLocations=new ArrayList<StorageLocation>();
  for (  String path : oldPaths.split(",")) {
    oldLocations.add(StorageLocation.parse(path));
  }
  assertFalse(oldLocations.isEmpty());
  String newPaths=oldLocations.get(0).getFile().getAbsolutePath() + ",/foo/path1,/foo/path2";
  DataNode.ChangedVolumes changedVolumes=dn.parseChangedVolumes(newPaths);
  List<StorageLocation> newVolumes=changedVolumes.newLocations;
  assertEquals(2,newVolumes.size());
  assertEquals(new File("/foo/path1").getAbsolutePath(),newVolumes.get(0).getFile().getAbsolutePath());
  assertEquals(new File("/foo/path2").getAbsolutePath(),newVolumes.get(1).getFile().getAbsolutePath());
  List<StorageLocation> removedVolumes=changedVolumes.deactivateLocations;
  assertEquals(1,removedVolumes.size());
  assertEquals(oldLocations.get(1).getFile(),removedVolumes.get(0).getFile());
  assertEquals(1,changedVolumes.unchangedLocations.size());
  assertEquals(oldLocations.get(0).getFile(),changedVolumes.unchangedLocations.get(0).getFile());
}
