{
  editLog.startLogSegment(txid,true,namesystem.getEffectiveLayoutVersion());
  if (bnState == BNState.DROP_UNTIL_NEXT_ROLL) {
    setState(BNState.JOURNAL_ONLY);
  }
  if (stopApplyingEditsOnNextRoll) {
    if (bnState == BNState.IN_SYNC) {
      LOG.info("Stopped applying edits to prepare for checkpoint.");
      setState(BNState.JOURNAL_ONLY);
    }
    stopApplyingEditsOnNextRoll=false;
    notifyAll();
  }
}
