{
  Configuration conf=new Configuration();
  LocalFileSystem localFs=FileSystem.getLocal(conf);
  Path testPath=new Path(TEST_ROOT_DIR,"testPath");
  Path testPath11=new Path(TEST_ROOT_DIR,"testPath11");
  FSDataOutputStream fout=localFs.create(testPath);
  fout.write("testing".getBytes());
  fout.close();
  fout=localFs.create(testPath11);
  fout.write("testing you".getBytes());
  fout.close();
  TestLocalFileSystem.readFile(localFs,testPath,128);
  TestLocalFileSystem.readFile(localFs,testPath,511);
  TestLocalFileSystem.readFile(localFs,testPath,512);
  TestLocalFileSystem.readFile(localFs,testPath,513);
  TestLocalFileSystem.readFile(localFs,testPath,1023);
  TestLocalFileSystem.readFile(localFs,testPath,1024);
  TestLocalFileSystem.readFile(localFs,testPath,1025);
  localFs.delete(localFs.getChecksumFile(testPath),true);
  assertTrue("checksum deleted",!localFs.exists(localFs.getChecksumFile(testPath)));
  FileUtil.copy(localFs,localFs.getChecksumFile(testPath11),localFs,localFs.getChecksumFile(testPath),false,true,conf);
  assertTrue("checksum exists",localFs.exists(localFs.getChecksumFile(testPath)));
  boolean errorRead=false;
  try {
    TestLocalFileSystem.readFile(localFs,testPath,1024);
  }
 catch (  ChecksumException ie) {
    errorRead=true;
  }
  assertTrue("error reading",errorRead);
  try {
    localFs.setVerifyChecksum(false);
    String str=TestLocalFileSystem.readFile(localFs,testPath,1024);
    assertTrue("read","testing".equals(str));
  }
  finally {
    localFs.setVerifyChecksum(true);
  }
}
