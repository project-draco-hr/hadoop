{
  if (!hasProxyUserPrivileges) {
    LOG.info("RM proxy-user privilege is not enabled. Skip requesting hdfs tokens.");
    return;
  }
  Credentials credentials=new Credentials();
  Token<?>[] newTokens=obtainSystemTokensForUser(user,credentials);
  LOG.info("Received new tokens for " + applicationId + ". Received "+ newTokens.length+ " tokens.");
  if (newTokens.length > 0) {
    for (    Token<?> token : newTokens) {
      if (token.isManaged()) {
        DelegationTokenToRenew tokenToRenew=new DelegationTokenToRenew(applicationId,token,getConfig(),Time.now(),shouldCancelAtEnd,user);
        renewToken(tokenToRenew);
        setTimerForTokenRenewal(tokenToRenew);
        appTokens.get(applicationId).add(tokenToRenew);
        LOG.info("Received new token " + token);
      }
    }
  }
  DataOutputBuffer dob=new DataOutputBuffer();
  credentials.writeTokenStorageToStream(dob);
  ByteBuffer byteBuffer=ByteBuffer.wrap(dob.getData(),0,dob.getLength());
  rmContext.getSystemCredentialsForApps().put(applicationId,byteBuffer);
}
