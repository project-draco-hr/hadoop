{
  Metadata meta=getMetadata(name);
  if (meta == null) {
    throw new IOException("Key " + name + " not found");
  }
  if (meta.getBitLength() != 8 * material.length) {
    throw new IOException("Wrong key length. Required " + meta.getBitLength() + ", but got "+ (8 * material.length));
  }
  int nextVersion=meta.addVersion();
  credentials.addSecretKey(new Text(name),meta.serialize());
  String versionName=buildVersionName(name,nextVersion);
  credentials.addSecretKey(new Text(versionName),material);
  return new KeyVersion(name,versionName,material);
}
