{
  final MockFileSystem fs=new MockFileSystem();
  final MockFileSystem mockFs=fs.getRawFileSystem();
  if (service != null) {
    when(mockFs.getCanonicalServiceName()).thenReturn(service.toString());
    when(mockFs.getDelegationToken(any(String.class))).thenAnswer(new Answer<Token<?>>(){
      @Override public Token<?> answer(      InvocationOnMock invocation) throws Throwable {
        Token<?> token=new Token<TokenIdentifier>();
        token.setService(service);
        return token;
      }
    }
);
  }
  when(mockFs.getChildFileSystems()).thenReturn(children);
  return fs;
}
