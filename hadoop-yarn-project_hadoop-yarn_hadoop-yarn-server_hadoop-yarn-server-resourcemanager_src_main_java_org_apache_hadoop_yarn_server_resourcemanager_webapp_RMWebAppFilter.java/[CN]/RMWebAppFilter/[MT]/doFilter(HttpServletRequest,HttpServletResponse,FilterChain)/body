{
  response.setCharacterEncoding("UTF-8");
  String uri=HtmlQuoting.quoteHtmlChars(request.getRequestURI());
  if (uri == null) {
    uri="/";
  }
  RMWebApp rmWebApp=injector.getInstance(RMWebApp.class);
  rmWebApp.checkIfStandbyRM();
  if (rmWebApp.isStandby() && shouldRedirect(rmWebApp,uri)) {
    String redirectPath=rmWebApp.getRedirectPath() + uri;
    if (redirectPath != null && !redirectPath.isEmpty()) {
      String redirectMsg="This is standby RM. The redirect url is: " + redirectPath;
      PrintWriter out=response.getWriter();
      out.println(redirectMsg);
      response.setHeader("Location",redirectPath);
      response.setStatus(HttpServletResponse.SC_TEMPORARY_REDIRECT);
      return;
    }
  }
  super.doFilter(request,response,chain);
}
