{
  if (t == null) {
    return 0;
  }
  Integer sn=t2i.get(t);
  if (sn == null) {
    sn=max.getAndIncrement();
    if (sn < 0) {
      throw new IllegalStateException("Too many elements!");
    }
    Integer old=t2i.putIfAbsent(t,sn);
    if (old != null) {
      return old;
    }
    i2t.put(sn,t);
  }
  return sn;
}
