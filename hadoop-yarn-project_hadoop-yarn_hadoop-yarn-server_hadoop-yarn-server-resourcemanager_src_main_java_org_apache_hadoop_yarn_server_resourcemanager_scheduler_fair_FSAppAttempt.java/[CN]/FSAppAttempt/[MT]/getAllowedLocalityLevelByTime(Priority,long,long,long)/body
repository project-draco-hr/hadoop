{
  if (nodeLocalityDelayMs < 0 || rackLocalityDelayMs < 0) {
    return NodeType.OFF_SWITCH;
  }
  if (!allowedLocalityLevel.containsKey(priority)) {
    allowedLocalityLevel.put(priority,NodeType.NODE_LOCAL);
    return NodeType.NODE_LOCAL;
  }
  NodeType allowed=allowedLocalityLevel.get(priority);
  if (allowed.equals(NodeType.OFF_SWITCH)) {
    return NodeType.OFF_SWITCH;
  }
  long waitTime=currentTimeMs;
  if (lastScheduledContainer.containsKey(priority)) {
    waitTime-=lastScheduledContainer.get(priority);
  }
 else {
    waitTime-=getStartTime();
  }
  long thresholdTime=allowed.equals(NodeType.NODE_LOCAL) ? nodeLocalityDelayMs : rackLocalityDelayMs;
  if (waitTime > thresholdTime) {
    if (allowed.equals(NodeType.NODE_LOCAL)) {
      allowedLocalityLevel.put(priority,NodeType.RACK_LOCAL);
      resetSchedulingOpportunities(priority,currentTimeMs);
    }
 else     if (allowed.equals(NodeType.RACK_LOCAL)) {
      allowedLocalityLevel.put(priority,NodeType.OFF_SWITCH);
      resetSchedulingOpportunities(priority,currentTimeMs);
    }
  }
  return allowedLocalityLevel.get(priority);
}
