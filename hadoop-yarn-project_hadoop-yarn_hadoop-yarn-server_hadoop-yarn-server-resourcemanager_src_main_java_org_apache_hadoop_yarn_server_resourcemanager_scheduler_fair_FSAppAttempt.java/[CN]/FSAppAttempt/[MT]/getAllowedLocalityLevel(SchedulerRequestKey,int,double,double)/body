{
  if (nodeLocalityThreshold > 1.0) {
    nodeLocalityThreshold=1.0;
  }
  if (rackLocalityThreshold > 1.0) {
    rackLocalityThreshold=1.0;
  }
  if (nodeLocalityThreshold < 0.0 || rackLocalityThreshold < 0.0) {
    return NodeType.OFF_SWITCH;
  }
  if (!allowedLocalityLevel.containsKey(schedulerKey)) {
    allowedLocalityLevel.put(schedulerKey,NodeType.NODE_LOCAL);
    return NodeType.NODE_LOCAL;
  }
  NodeType allowed=allowedLocalityLevel.get(schedulerKey);
  if (allowed.equals(NodeType.OFF_SWITCH))   return NodeType.OFF_SWITCH;
  double threshold=allowed.equals(NodeType.NODE_LOCAL) ? nodeLocalityThreshold : rackLocalityThreshold;
  if (getSchedulingOpportunities(schedulerKey) > (numNodes * threshold)) {
    if (allowed.equals(NodeType.NODE_LOCAL)) {
      allowedLocalityLevel.put(schedulerKey,NodeType.RACK_LOCAL);
      resetSchedulingOpportunities(schedulerKey);
    }
 else     if (allowed.equals(NodeType.RACK_LOCAL)) {
      allowedLocalityLevel.put(schedulerKey,NodeType.OFF_SWITCH);
      resetSchedulingOpportunities(schedulerKey);
    }
  }
  return allowedLocalityLevel.get(schedulerKey);
}
