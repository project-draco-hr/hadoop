{
  Configuration conf=new Configuration();
  MiniDFSNNTopology topology=new MiniDFSNNTopology().addNameservice(new MiniDFSNNTopology.NSConf("ha-nn-uri-0").addNN(new MiniDFSNNTopology.NNConf("nn1").setHttpPort(10001)).addNN(new MiniDFSNNTopology.NNConf("nn2").setHttpPort(10002)));
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(conf).nnTopology(topology).numDataNodes(0).build();
  FileSystem fs=null;
  try {
    cluster.waitActive();
    cluster.transitionToActive(0);
    HATestUtil.setFailoverConfigurations(cluster,conf,"ha-nn-uri-0",0);
    fs=HATestUtil.configureFailoverFs(cluster,conf);
    fs.mkdirs(new Path("/test1"));
    fs.mkdirs(new Path("/test2"));
    runFsck(conf);
    cluster.transitionToStandby(0);
    cluster.transitionToActive(1);
    runFsck(conf);
  }
  finally {
    if (fs != null) {
      fs.close();
    }
    if (cluster != null) {
      cluster.shutdown();
    }
  }
}
