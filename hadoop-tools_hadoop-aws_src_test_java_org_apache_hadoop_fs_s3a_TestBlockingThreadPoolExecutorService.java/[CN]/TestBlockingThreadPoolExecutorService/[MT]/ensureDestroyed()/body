{
  if (tpe == null) {
    return;
  }
  int shutdownTries=SHUTDOWN_WAIT_TRIES;
  tpe.shutdown();
  if (!tpe.isShutdown()) {
    throw new RuntimeException("Shutdown had no effect.");
  }
  while (!tpe.awaitTermination(SHUTDOWN_WAIT_MSEC,TimeUnit.MILLISECONDS)) {
    LOG.info("Waiting for thread pool shutdown.");
    if (shutdownTries-- <= 0) {
      LOG.error("Failed to terminate thread pool gracefully.");
      break;
    }
  }
  if (!tpe.isTerminated()) {
    tpe.shutdownNow();
    if (!tpe.awaitTermination(SHUTDOWN_WAIT_MSEC,TimeUnit.MILLISECONDS)) {
      throw new RuntimeException("Failed to terminate thread pool in timely manner.");
    }
  }
  tpe=null;
}
