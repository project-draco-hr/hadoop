{
  MiniMRCluster mr=null;
  try {
    mr=new MiniMRCluster(1,"file:///",4);
    JobConf conf=mr.createJobConf();
    conf.setKeepTaskFilesPattern(".*");
    conf.set(SIDE_EFFECT_DIR_PROPERTY,TEST_ROOT_DIR + "/isolationrunnerjob/sideeffect");
    deleteSideEffectFiles(conf);
    JobID jobId=runJobNormally(conf);
    assertEquals(1,countSideEffectFiles(conf,"map"));
    assertEquals(1,countSideEffectFiles(conf,"reduce"));
    deleteSideEffectFiles(conf);
    FileSystem localFs=FileSystem.getLocal(conf);
    Path mapJobXml=getAttemptJobXml(mr.getTaskTrackerRunner(0).getTaskTracker().getJobConf(),jobId,TaskType.MAP).makeQualified(localFs);
    assertTrue(localFs.exists(mapJobXml));
    new IsolationRunner().run(new String[]{new File(mapJobXml.toUri()).getCanonicalPath()});
    assertEquals(1,countSideEffectFiles(conf,"map"));
    assertEquals(0,countSideEffectFiles(conf,"reduce"));
    deleteSideEffectFiles(conf);
  }
  finally {
    if (mr != null) {
      mr.shutdown();
    }
  }
}
