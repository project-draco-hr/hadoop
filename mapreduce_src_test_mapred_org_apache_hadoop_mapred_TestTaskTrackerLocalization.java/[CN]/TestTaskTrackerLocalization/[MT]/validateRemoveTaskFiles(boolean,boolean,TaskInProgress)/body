{
  String dir=(!needCleanup || jvmReuse) ? TaskTracker.getTaskWorkDir(task.getUser(),task.getJobID().toString(),taskId.toString(),task.isTaskCleanupTask()) : TaskTracker.getLocalTaskDir(task.getUser(),task.getJobID().toString(),taskId.toString(),task.isTaskCleanupTask());
  Path[] paths=tracker.getLocalFiles(localizedJobConf,dir);
  assertTrue("No paths found",paths.length > 0);
  for (  Path p : paths) {
    if (tracker.getLocalFileSystem().exists(p)) {
      createFileAndSetPermissions(localizedJobConf,p);
    }
  }
  InlineCleanupQueue cleanupQueue=new InlineCleanupQueue();
  tracker.setCleanupThread(cleanupQueue);
  tip.removeTaskFiles(needCleanup,taskId);
  if (jvmReuse) {
    assertTrue("cleanup queue is not empty after removeTaskFiles() in case " + "of jvm reuse.",cleanupQueue.isQueueEmpty());
    boolean workDirExists=false;
    for (    Path p : paths) {
      if (tracker.getLocalFileSystem().exists(p)) {
        workDirExists=true;
      }
    }
    assertTrue("work dir does not exist in case of jvm reuse",workDirExists);
    JvmManager.deleteWorkDir(tracker,task);
  }
  assertTrue("Some task files are not deleted!! Number of stale paths is " + cleanupQueue.stalePaths.size(),cleanupQueue.stalePaths.size() == 0);
}
