{
  String id=appId.toString();
  TimelineCollector collectorInTable;
  boolean collectorIsNew=false;
synchronized (collectors) {
    collectorInTable=collectors.get(id);
    if (collectorInTable == null) {
      try {
        collector.init(getConfig());
        collector.start();
        collectors.put(id,collector);
        LOG.info("the collector for " + id + " was added");
        collectorInTable=collector;
        collectorIsNew=true;
      }
 catch (      Exception e) {
        throw new YarnRuntimeException(e);
      }
    }
 else {
      String msg="the collector for " + id + " already exists!";
      LOG.error(msg);
    }
  }
  if (collectorIsNew) {
    try {
      updateTimelineCollectorContext(appId,collector);
      reportNewCollectorToNM(appId);
    }
 catch (    Exception e) {
      LOG.error("Failed to communicate with NM Collector Service for " + appId);
      throw new YarnRuntimeException(e);
    }
  }
  return collectorInTable;
}
