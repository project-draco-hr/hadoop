{
  long clientVersion;
  clientVersion=RPC.getProtocolVersion(method.getDeclaringClass());
  int clientMethodsHash=ProtocolSignature.getFingerprint(method.getDeclaringClass().getMethods());
  ProtocolSignature serverInfo=((VersionedProtocol)proxy).getProtocolSignature(RPC.getProtocolName(protocol),clientVersion,clientMethodsHash);
  long serverVersion=serverInfo.getVersion();
  if (serverVersion != clientVersion) {
    throw new RPC.VersionMismatch(protocol.getName(),clientVersion,serverVersion);
  }
  int[] serverMethodsCodes=serverInfo.getMethods();
  if (serverMethodsCodes != null) {
    serverMethods=new HashSet<Integer>(serverMethodsCodes.length);
    for (    int m : serverMethodsCodes) {
      this.serverMethods.add(Integer.valueOf(m));
    }
  }
  serverMethodsFetched=true;
}
