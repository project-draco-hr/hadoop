{
  Preconditions.checkArgument(req.getUri().startsWith(WEBHDFS_PREFIX));
  QueryStringDecoder queryString=new QueryStringDecoder(req.getUri());
  params=new ParameterParser(queryString,conf);
  DataNodeUGIProvider ugiProvider=new DataNodeUGIProvider(params);
  ugi=ugiProvider.ugi();
  path=params.path();
  injectToken();
  ugi.doAs(new PrivilegedExceptionAction<Void>(){
    @Override public Void run() throws Exception {
      handle(ctx,req);
      return null;
    }
  }
);
}
