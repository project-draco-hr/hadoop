{
  String cluster="kompaction_cluster1";
  String user="kompaction_FlowRun__user1";
  String flow="kompaction_flowRun_flow_name";
  String flowVersion="AF1021C19F1351";
  long runid=1449526652000L;
  int start=10;
  int count=2000;
  int appIdSuffix=1;
  HBaseTimelineWriterImpl hbi=null;
  long insertTs=System.currentTimeMillis() - count;
  Configuration c1=util.getConfiguration();
  TimelineEntities te1=null;
  TimelineEntity entityApp1=null;
  try {
    hbi=new HBaseTimelineWriterImpl(c1);
    hbi.init(c1);
    for (int i=start; i < start + count; i++) {
      String appName="application_10240000000000_" + appIdSuffix;
      insertTs++;
      te1=new TimelineEntities();
      entityApp1=TestFlowDataGenerator.getEntityMetricsApp1(insertTs,c1);
      te1.addEntity(entityApp1);
      hbi.write(cluster,user,flow,flowVersion,runid,appName,te1);
      appName="application_2048000000000_7" + appIdSuffix;
      insertTs++;
      te1=new TimelineEntities();
      entityApp1=TestFlowDataGenerator.getEntityMetricsApp2(insertTs);
      te1.addEntity(entityApp1);
      hbi.write(cluster,user,flow,flowVersion,runid,appName,te1);
    }
  }
  finally {
    String appName="application_10240000000000_" + appIdSuffix;
    te1=new TimelineEntities();
    entityApp1=TestFlowDataGenerator.getEntityMetricsApp1Complete(insertTs + 1,c1);
    te1.addEntity(entityApp1);
    if (hbi != null) {
      hbi.write(cluster,user,flow,flowVersion,runid,appName,te1);
      hbi.flush();
      hbi.close();
    }
  }
  HRegionServer server=util.getRSForFirstRegionInTable(TableName.valueOf(FlowRunTable.DEFAULT_TABLE_NAME));
  List<Region> regions=server.getOnlineRegions(TableName.valueOf(FlowRunTable.DEFAULT_TABLE_NAME));
  assertTrue("Didn't find any regions for primary table!",regions.size() > 0);
  for (  Region region : regions) {
    region.flush(true);
    region.compact(true);
  }
  checkFlowRunTable(cluster,user,flow,runid,c1,4);
}
