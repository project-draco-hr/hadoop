{
  if (flag.contains(CreateFlag.APPEND)) {
    if (!exists(f)) {
      if (flag.contains(CreateFlag.CREATE))       return create(f,false,bufferSize,replication,blockSize,progress);
    }
    return append(f,bufferSize,progress);
  }
  FSDataOutputStream out=create(f,flag.contains(CreateFlag.OVERWRITE),bufferSize,replication,blockSize,progress);
  setPermission(f,permission);
  return out;
}
