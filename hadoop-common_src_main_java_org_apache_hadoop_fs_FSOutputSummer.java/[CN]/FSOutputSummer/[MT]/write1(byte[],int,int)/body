{
  if (count == 0 && len >= buf.length) {
    final int length=buf.length;
    sum.update(b,off,length);
    writeChecksumChunk(b,off,length,false);
    return length;
  }
  int bytesToCopy=buf.length - count;
  bytesToCopy=(len < bytesToCopy) ? len : bytesToCopy;
  sum.update(b,off,bytesToCopy);
  System.arraycopy(b,off,buf,count,bytesToCopy);
  count+=bytesToCopy;
  if (count == buf.length) {
    flushBuffer();
  }
  return bytesToCopy;
}
