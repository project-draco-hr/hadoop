{
  if (snapshot == null) {
    if (!isCurrentFileDeleted()) {
      recordModification(prior,null);
      deleteCurrentFile();
    }
    Util.collectBlocksAndClear(this,collectedBlocks,removedINodes);
    return Quota.Counts.newInstance();
  }
 else {
    prior=getDiffs().updatePrior(snapshot,prior);
    return diffs.deleteSnapshotDiff(snapshot,prior,this,collectedBlocks,removedINodes,countDiffChange);
  }
}
