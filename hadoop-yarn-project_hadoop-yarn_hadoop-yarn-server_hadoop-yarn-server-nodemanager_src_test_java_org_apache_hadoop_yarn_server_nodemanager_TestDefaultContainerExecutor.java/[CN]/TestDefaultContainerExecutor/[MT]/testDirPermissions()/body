{
  deleteTmpFiles();
  final String user="somebody";
  final String appId="app_12345_123";
  final FsPermission userCachePerm=new FsPermission(DefaultContainerExecutor.USER_PERM);
  final FsPermission appCachePerm=new FsPermission(DefaultContainerExecutor.APPCACHE_PERM);
  final FsPermission fileCachePerm=new FsPermission(DefaultContainerExecutor.FILECACHE_PERM);
  final FsPermission appDirPerm=new FsPermission(DefaultContainerExecutor.APPDIR_PERM);
  List<String> localDirs=new ArrayList<String>();
  localDirs.add(new Path(BASE_TMP_PATH,"localDirA").toString());
  localDirs.add(new Path(BASE_TMP_PATH,"localDirB").toString());
  List<String> logDirs=new ArrayList<String>();
  logDirs.add(new Path(BASE_TMP_PATH,"logDirA").toString());
  logDirs.add(new Path(BASE_TMP_PATH,"logDirB").toString());
  Configuration conf=new Configuration();
  conf.set(CommonConfigurationKeys.FS_PERMISSIONS_UMASK_KEY,"077");
  FileContext lfs=FileContext.getLocalFSFileContext(conf);
  DefaultContainerExecutor executor=new DefaultContainerExecutor(lfs);
  executor.setConf(conf);
  executor.init();
  try {
    executor.createUserLocalDirs(localDirs,user);
    executor.createUserCacheDirs(localDirs,user);
    executor.createAppDirs(localDirs,user,appId);
    for (    String dir : localDirs) {
      FileStatus stats=lfs.getFileStatus(new Path(new Path(dir,ContainerLocalizer.USERCACHE),user));
      Assert.assertEquals(userCachePerm,stats.getPermission());
    }
    for (    String dir : localDirs) {
      Path userCachePath=new Path(new Path(dir,ContainerLocalizer.USERCACHE),user);
      Path appCachePath=new Path(userCachePath,ContainerLocalizer.APPCACHE);
      FileStatus stats=lfs.getFileStatus(appCachePath);
      Assert.assertEquals(appCachePerm,stats.getPermission());
      stats=lfs.getFileStatus(new Path(userCachePath,ContainerLocalizer.FILECACHE));
      Assert.assertEquals(fileCachePerm,stats.getPermission());
      stats=lfs.getFileStatus(new Path(appCachePath,appId));
      Assert.assertEquals(appDirPerm,stats.getPermission());
    }
    String[] permissionsArray={"000","111","555","710","777"};
    for (    String perm : permissionsArray) {
      conf.set(YarnConfiguration.NM_DEFAULT_CONTAINER_EXECUTOR_LOG_DIRS_PERMISSIONS,perm);
      executor.clearLogDirPermissions();
      FsPermission logDirPerm=new FsPermission(executor.getLogDirPermissions());
      executor.createAppLogDirs(appId,logDirs,user);
      for (      String dir : logDirs) {
        FileStatus stats=lfs.getFileStatus(new Path(dir,appId));
        Assert.assertEquals(logDirPerm,stats.getPermission());
        lfs.delete(new Path(dir,appId),true);
      }
    }
  }
  finally {
    deleteTmpFiles();
  }
}
