{
  rm.start();
  MockNM amNodeManager=rm.registerNode("amNM:1234",2048);
  rm.submitApp(1024);
  amNodeManager.nodeHeartbeat(true);
  WebResource r=resource();
  try {
    r.path("ws").path("v1").path("cluster").path("apps").queryParam("state","INVALID_test").accept(MediaType.APPLICATION_JSON).get(JSONObject.class);
    fail("should have thrown exception on invalid state query");
  }
 catch (  UniformInterfaceException ue) {
    ClientResponse response=ue.getResponse();
    assertEquals(Status.BAD_REQUEST,response.getClientResponseStatus());
    assertEquals(MediaType.APPLICATION_JSON_TYPE,response.getType());
    JSONObject msg=response.getEntity(JSONObject.class);
    JSONObject exception=msg.getJSONObject("RemoteException");
    assertEquals("incorrect number of elements",3,exception.length());
    String message=exception.getString("message");
    String type=exception.getString("exception");
    String classname=exception.getString("javaClassName");
    WebServicesTestUtils.checkStringContains("exception message","org.apache.hadoop.yarn.server.resourcemanager.rmapp.RMAppState.INVALID_test",message);
    WebServicesTestUtils.checkStringMatch("exception type","IllegalArgumentException",type);
    WebServicesTestUtils.checkStringMatch("exception classname","java.lang.IllegalArgumentException",classname);
  }
 finally {
    rm.stop();
  }
}
