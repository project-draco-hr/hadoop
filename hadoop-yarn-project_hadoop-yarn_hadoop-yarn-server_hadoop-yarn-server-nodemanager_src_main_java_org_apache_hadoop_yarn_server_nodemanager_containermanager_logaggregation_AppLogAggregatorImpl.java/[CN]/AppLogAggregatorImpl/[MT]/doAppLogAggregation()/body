{
  while (!this.appFinishing.get() && !this.aborted.get()) {
synchronized (this) {
      try {
        if (this.logAggregationContext != null && this.logAggregationContext.getRollingIntervalSeconds() > 0) {
          wait(this.logAggregationContext.getRollingIntervalSeconds() * 1000);
          if (this.appFinishing.get() || this.aborted.get()) {
            break;
          }
          uploadLogsForContainers();
        }
 else {
          wait(THREAD_SLEEP_TIME);
        }
      }
 catch (      InterruptedException e) {
        LOG.warn("PendingContainers queue is interrupted");
        this.appFinishing.set(true);
      }
    }
  }
  if (this.aborted.get()) {
    return;
  }
  uploadLogsForContainers();
  List<String> rootLogDirs=dirsHandler.getLogDirs();
  Path[] localAppLogDirs=new Path[rootLogDirs.size()];
  int index=0;
  for (  String rootLogDir : rootLogDirs) {
    localAppLogDirs[index]=new Path(rootLogDir,this.applicationId);
    index++;
  }
  this.delService.delete(this.userUgi.getShortUserName(),null,localAppLogDirs);
  this.dispatcher.getEventHandler().handle(new ApplicationEvent(this.appId,ApplicationEventType.APPLICATION_LOG_HANDLING_FINISHED));
  this.appAggregationFinished.set(true);
}
