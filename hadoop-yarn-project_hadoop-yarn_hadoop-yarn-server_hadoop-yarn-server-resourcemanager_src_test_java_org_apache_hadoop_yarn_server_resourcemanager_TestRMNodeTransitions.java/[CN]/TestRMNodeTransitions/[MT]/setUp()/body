{
  InlineDispatcher rmDispatcher=new InlineDispatcher();
  rmContext=new RMContextImpl(rmDispatcher,mock(ContainerAllocationExpirer.class),null,null,mock(DelegationTokenRenewer.class),null,null,null,null,null);
  NodesListManager nodesListManager=mock(NodesListManager.class);
  HostsFileReader reader=mock(HostsFileReader.class);
  when(nodesListManager.getHostsReader()).thenReturn(reader);
  ((RMContextImpl)rmContext).setNodesListManager(nodesListManager);
  scheduler=mock(YarnScheduler.class);
  doAnswer(new Answer<Void>(){
    @Override public Void answer(    InvocationOnMock invocation) throws Throwable {
      final SchedulerEvent event=(SchedulerEvent)(invocation.getArguments()[0]);
      eventType=event.getType();
      if (eventType == SchedulerEventType.NODE_UPDATE) {
        List<UpdatedContainerInfo> lastestContainersInfoList=((NodeUpdateSchedulerEvent)event).getRMNode().pullContainerUpdates();
        for (        UpdatedContainerInfo lastestContainersInfo : lastestContainersInfoList) {
          completedContainers.addAll(lastestContainersInfo.getCompletedContainers());
        }
      }
      return null;
    }
  }
).when(scheduler).handle(any(SchedulerEvent.class));
  rmDispatcher.register(SchedulerEventType.class,new TestSchedulerEventDispatcher());
  rmDispatcher.register(NodesListManagerEventType.class,new TestNodeListManagerEventDispatcher());
  NodeId nodeId=BuilderUtils.newNodeId("localhost",0);
  node=new RMNodeImpl(nodeId,rmContext,null,0,0,null,null,null);
  nodesListManagerEvent=null;
}
