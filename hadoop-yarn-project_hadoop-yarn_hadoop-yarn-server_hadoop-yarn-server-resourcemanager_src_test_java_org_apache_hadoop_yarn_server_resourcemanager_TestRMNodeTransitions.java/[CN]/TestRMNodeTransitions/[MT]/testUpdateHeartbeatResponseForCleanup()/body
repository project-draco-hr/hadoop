{
  RMNodeImpl node=getRunningNode();
  NodeId nodeId=node.getNodeID();
  ContainerId completedContainerId=BuilderUtils.newContainerId(BuilderUtils.newApplicationAttemptId(BuilderUtils.newApplicationId(0,0),0),0);
  node.handle(new RMNodeCleanContainerEvent(nodeId,completedContainerId));
  Assert.assertEquals(1,node.getContainersToCleanUp().size());
  ApplicationId finishedAppId=BuilderUtils.newApplicationId(0,1);
  node.handle(new RMNodeCleanAppEvent(nodeId,finishedAppId));
  Assert.assertEquals(1,node.getAppsToCleanup().size());
  RMNodeStatusEvent statusEvent=getMockRMNodeStatusEvent();
  node.handle(statusEvent);
  Assert.assertEquals(1,node.getContainersToCleanUp().size());
  Assert.assertEquals(1,node.getAppsToCleanup().size());
  HeartbeatResponse hbrsp=Records.newRecord(HeartbeatResponse.class);
  node.updateHeartbeatResponseForCleanup(hbrsp);
  Assert.assertEquals(0,node.getContainersToCleanUp().size());
  Assert.assertEquals(0,node.getAppsToCleanup().size());
  Assert.assertEquals(1,hbrsp.getContainersToCleanupCount());
  Assert.assertEquals(completedContainerId,hbrsp.getContainerToCleanup(0));
  Assert.assertEquals(1,hbrsp.getApplicationsToCleanupCount());
  Assert.assertEquals(finishedAppId,hbrsp.getApplicationsToCleanup(0));
}
