{
  RMNodeImpl node=getDecommissioningNode();
  ClusterMetrics cm=ClusterMetrics.getMetrics();
  int initialActive=cm.getNumActiveNMs();
  int initialDecommissioning=cm.getNumDecommissioningNMs();
  int initialDecommissioned=cm.getNumDecommisionedNMs();
  Assert.assertEquals(NodeState.DECOMMISSIONING,node.getState());
  RMNodeStatusEvent statusEvent=getMockRMNodeStatusEventWithRunningApps();
  node.handle(statusEvent);
  Assert.assertEquals(NodeState.DECOMMISSIONING,node.getState());
  Assert.assertEquals("Active Nodes",initialActive,cm.getNumActiveNMs());
  Assert.assertEquals("Decommissioning Nodes",initialDecommissioning,cm.getNumDecommissioningNMs());
  Assert.assertEquals("Decommissioned Nodes",initialDecommissioned,cm.getNumDecommisionedNMs());
  statusEvent=getMockRMNodeStatusEventWithoutRunningApps();
  node.handle(statusEvent);
  Assert.assertEquals(NodeState.DECOMMISSIONED,node.getState());
  Assert.assertEquals("Active Nodes",initialActive,cm.getNumActiveNMs());
  Assert.assertEquals("Decommissioning Nodes",initialDecommissioning - 1,cm.getNumDecommissioningNMs());
  Assert.assertEquals("Decommissioned Nodes",initialDecommissioned + 1,cm.getNumDecommisionedNMs());
}
