{
  configureNameNodes(nnTopology,federation,conf);
  int nnCounter=0;
  int nsCounter=0;
  for (  MiniDFSNNTopology.NSConf nameservice : nnTopology.getNameservices()) {
    configureNameService(nameservice,nsCounter++,manageNameDfsSharedDirs,manageNameDfsDirs,enableManagedDfsDirsRedundancy,format,operation,clusterId,nnCounter);
    nnCounter+=nameservice.getNNs().size();
  }
  for (  NameNodeInfo nn : namenodes.values()) {
    Configuration nnConf=nn.conf;
    for (    NameNodeInfo nnInfo : namenodes.values()) {
      if (nn.equals(nnInfo)) {
        continue;
      }
      copyKeys(conf,nnConf,nnInfo.nameserviceId,nnInfo.nnId);
    }
  }
}
