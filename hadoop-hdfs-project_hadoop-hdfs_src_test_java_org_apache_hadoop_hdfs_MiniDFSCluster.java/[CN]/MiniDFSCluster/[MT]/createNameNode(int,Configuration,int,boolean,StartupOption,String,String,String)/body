{
  if (format) {
    DFSTestUtil.formatNameNode(conf);
  }
  if (operation == StartupOption.UPGRADE) {
    operation.setClusterId(clusterId);
  }
  String[] args=(operation == null || operation == StartupOption.FORMAT || operation == StartupOption.REGULAR) ? new String[]{} : new String[]{operation.getName()};
  NameNode nn=NameNode.createNameNode(args,conf);
  if (operation == StartupOption.RECOVER) {
    return;
  }
  conf.set(DFSUtil.addKeySuffixes(DFS_NAMENODE_RPC_ADDRESS_KEY,nameserviceId,nnId),nn.getNameNodeAddressHostPortString());
  conf.set(DFSUtil.addKeySuffixes(DFS_NAMENODE_HTTP_ADDRESS_KEY,nameserviceId,nnId),NetUtils.getHostPortString(nn.getHttpAddress()));
  DFSUtil.setGenericConf(conf,nameserviceId,nnId,DFS_NAMENODE_HTTP_ADDRESS_KEY);
  nameNodes[nnIndex]=new NameNodeInfo(nn,nameserviceId,nnId,new Configuration(conf));
}
