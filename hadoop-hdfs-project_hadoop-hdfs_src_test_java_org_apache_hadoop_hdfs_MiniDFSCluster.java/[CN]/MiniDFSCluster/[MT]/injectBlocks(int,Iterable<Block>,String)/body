{
  if (dataNodeIndex < 0 || dataNodeIndex > dataNodes.size()) {
    throw new IndexOutOfBoundsException();
  }
  final DataNode dn=dataNodes.get(dataNodeIndex).datanode;
  final FsDatasetSpi<?> dataSet=DataNodeTestUtils.getFSDataset(dn);
  if (!(dataSet instanceof SimulatedFSDataset)) {
    throw new IOException("injectBlocks is valid only for SimilatedFSDataset");
  }
  if (bpid == null) {
    bpid=getNamesystem().getBlockPoolId();
  }
  SimulatedFSDataset sdataset=(SimulatedFSDataset)dataSet;
  sdataset.injectBlocks(bpid,blocksToInject);
  dataNodes.get(dataNodeIndex).datanode.scheduleAllBlockReport(0);
}
