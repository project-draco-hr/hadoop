{
  if (!federation)   throw new IOException("cannot add namenode to non-federated cluster");
  int nnIndex=nameNodes.length;
  int numNameNodes=nameNodes.length + 1;
  NameNodeInfo[] newlist=new NameNodeInfo[numNameNodes];
  System.arraycopy(nameNodes,0,newlist,0,nameNodes.length);
  nameNodes=newlist;
  String nameserviceId=NAMESERVICE_ID_PREFIX + (nnIndex + 1);
  String nameserviceIds=conf.get(DFS_FEDERATION_NAMESERVICES);
  nameserviceIds+="," + nameserviceId;
  conf.set(DFS_FEDERATION_NAMESERVICES,nameserviceIds);
  String nnId=null;
  initNameNodeAddress(conf,nameserviceId,new NNConf(nnId).setIpcPort(namenodePort));
  initNameNodeConf(conf,nameserviceId,nnId,true,nnIndex);
  createNameNode(nnIndex,conf,numDataNodes,true,null,null,nameserviceId,nnId);
  for (  DataNodeProperties dn : dataNodes) {
    DataNode datanode=dn.datanode;
    datanode.refreshNamenodes(conf);
  }
  waitActive(nnIndex);
  return nameNodes[nnIndex].nameNode;
}
