{
  Configuration conf=new HdfsConfiguration();
  File tmpDir=new File(conf.get("hadoop.tmp.dir"));
  if (!tmpDir.exists()) {
    if (!tmpDir.mkdirs())     throw new IOException("Cannot create temporary directory: " + tmpDir);
  }
  File tmpFile=new File(tmpDir,"thefile");
  URI uri=tmpFile.toURI();
  FileSystem fs=FileSystem.get(uri,conf);
  try {
    byte[] fileContent=new byte[1024];
    for (int i=0; i < fileContent.length; ++i)     fileContent[i]=(byte)i;
    OutputStream os=fs.create(new Path(uri.getPath()));
    os.write(fileContent);
    os.close();
    URL fileURL=uri.toURL();
    InputStream is=fileURL.openStream();
    assertNotNull(is);
    byte[] bytes=new byte[4096];
    assertEquals(1024,is.read(bytes));
    is.close();
    for (int i=0; i < fileContent.length; ++i)     assertEquals(fileContent[i],bytes[i]);
    fs.delete(new Path(uri.getPath()),false);
  }
  finally {
    fs.close();
  }
}
