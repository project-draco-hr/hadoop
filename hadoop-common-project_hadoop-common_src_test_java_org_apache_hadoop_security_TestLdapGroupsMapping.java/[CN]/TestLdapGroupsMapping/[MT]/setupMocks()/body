{
  mockContext=mock(DirContext.class);
  doReturn(mockContext).when(mappingSpy).getDirContext();
  NamingEnumeration mockUserNamingEnum=mock(NamingEnumeration.class);
  NamingEnumeration mockGroupNamingEnum=mock(NamingEnumeration.class);
  when(mockContext.search(anyString(),anyString(),any(Object[].class),any(SearchControls.class))).thenReturn(mockUserNamingEnum,mockGroupNamingEnum);
  SearchResult mockUserResult=mock(SearchResult.class);
  when(mockUserNamingEnum.hasMoreElements()).thenReturn(true);
  when(mockUserNamingEnum.nextElement()).thenReturn(mockUserResult);
  when(mockUserResult.getNameInNamespace()).thenReturn("CN=some_user,DC=test,DC=com");
  SearchResult mockGroupResult=mock(SearchResult.class);
  when(mockGroupNamingEnum.hasMoreElements()).thenReturn(true,true,false);
  when(mockGroupNamingEnum.nextElement()).thenReturn(mockGroupResult);
  Attribute group1Attr=new BasicAttribute("cn");
  group1Attr.add("group1");
  Attributes group1Attrs=new BasicAttributes();
  group1Attrs.put(group1Attr);
  Attribute group2Attr=new BasicAttribute("cn");
  group2Attr.add("group2");
  Attributes group2Attrs=new BasicAttributes();
  group2Attrs.put(group2Attr);
  when(mockGroupResult.getAttributes()).thenReturn(group1Attrs,group2Attrs);
}
