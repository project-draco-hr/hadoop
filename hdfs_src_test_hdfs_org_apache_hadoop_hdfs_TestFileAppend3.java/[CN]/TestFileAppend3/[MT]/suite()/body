{
  return new TestSetup(new TestSuite(TestFileAppend3.class)){
    protected void setUp() throws java.lang.Exception {
      AppendTestUtil.LOG.info("setUp()");
      conf=new HdfsConfiguration();
      conf.setInt(DFSConfigKeys.DFS_BYTES_PER_CHECKSUM_KEY,512);
      conf.setBoolean("dfs.support.append",true);
      buffersize=conf.getInt("io.file.buffer.size",4096);
      cluster=new MiniDFSCluster.Builder(conf).numDataNodes(DATANODE_NUM).build();
      fs=(DistributedFileSystem)cluster.getFileSystem();
    }
    protected void tearDown() throws Exception {
      AppendTestUtil.LOG.info("tearDown()");
      if (fs != null)       fs.close();
      if (cluster != null)       cluster.shutdown();
    }
  }
;
}
