{
  InetSocketAddress nnAddr=new InetSocketAddress("localhost",cluster.getNameNodePort());
  DFSClient client=new DFSClient(nnAddr,conf);
  LocatedBlock block=client.getNamenode().getBlockLocations(testFile.toString(),0,FILE_SIZE).getLocatedBlocks().get(0);
  DataNode dn=util.getDataNode(block);
  InetSocketAddress dnAddr=dn.getXferAddress();
  Socket[] dnSockets=new Socket[CACHE_SIZE];
  for (int i=0; i < dnSockets.length; ++i) {
    dnSockets[i]=client.socketFactory.createSocket(dnAddr.getAddress(),dnAddr.getPort());
    cache.put(dnSockets[i],null);
  }
  assertEquals(CACHE_SIZE,client.socketCache.size());
  Thread.sleep(CACHE_EXPIRY_MS + 1000);
  assertEquals(0,client.socketCache.size());
  Thread.sleep(CACHE_EXPIRY_MS + 1000);
}
