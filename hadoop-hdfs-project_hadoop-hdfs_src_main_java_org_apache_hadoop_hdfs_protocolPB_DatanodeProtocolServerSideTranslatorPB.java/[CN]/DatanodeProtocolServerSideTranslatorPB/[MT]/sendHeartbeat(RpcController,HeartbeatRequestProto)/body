{
  DatanodeCommand[] cmds;
  try {
    cmds=impl.sendHeartbeat(PBHelper.convert(request.getRegistration()),request.getCapacity(),request.getDfsUsed(),request.getRemaining(),request.getBlockPoolUsed(),request.getXmitsInProgress(),request.getXceiverCount(),request.getFailedVolumes());
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
  HeartbeatResponseProto.Builder builder=HeartbeatResponseProto.newBuilder();
  if (cmds != null) {
    for (int i=0; i < cmds.length; i++) {
      builder.addCmds(i,PBHelper.convert(cmds[i]));
    }
  }
  return builder.build();
}
