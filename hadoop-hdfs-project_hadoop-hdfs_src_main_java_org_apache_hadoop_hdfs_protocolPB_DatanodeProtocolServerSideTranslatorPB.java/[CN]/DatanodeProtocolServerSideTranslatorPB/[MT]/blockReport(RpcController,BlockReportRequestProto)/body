{
  DatanodeCommand cmd=null;
  StorageBlockReport[] report=new StorageBlockReport[request.getReportsCount()];
  int index=0;
  for (  StorageBlockReportProto s : request.getReportsList()) {
    List<Long> blockIds=s.getBlocksList();
    long[] blocks=new long[blockIds.size()];
    for (int i=0; i < blockIds.size(); i++) {
      blocks[i]=blockIds.get(i);
    }
    report[index++]=new StorageBlockReport(PBHelper.convert(s.getStorage()),blocks);
  }
  try {
    cmd=impl.blockReport(PBHelper.convert(request.getRegistration()),request.getBlockPoolId(),report);
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
  BlockReportResponseProto.Builder builder=BlockReportResponseProto.newBuilder();
  if (cmd != null) {
    builder.setCmd(PBHelper.convert(cmd));
  }
  return builder.build();
}
