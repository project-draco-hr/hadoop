{
  DatanodeCommand cmd=null;
  List<Long> blockIds=request.getBlocksList();
  long[] blocks=new long[blockIds.size()];
  for (int i=0; i < blockIds.size(); i++) {
    blocks[i]=blockIds.get(i);
  }
  try {
    cmd=impl.blockReport(PBHelper.convert(request.getRegistration()),request.getBlockPoolId(),blocks);
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
  BlockReportResponseProto.Builder builder=BlockReportResponseProto.newBuilder();
  if (cmd != null) {
    builder.setCmd(PBHelper.convert(cmd));
  }
  return builder.build();
}
