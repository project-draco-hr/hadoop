{
  DatanodeRegistration registration=PBHelper.convert(request.getRegistration());
  DatanodeRegistration registrationResp;
  DatanodeStorage[] storages=new DatanodeStorage[request.getStoragesCount()];
  for (int i=0; i < request.getStoragesCount(); i++) {
    storages[i]=PBHelper.convert(request.getStorages(i));
  }
  try {
    registrationResp=impl.registerDatanode(registration,storages);
  }
 catch (  IOException e) {
    throw new ServiceException(e);
  }
  return RegisterDatanodeResponseProto.newBuilder().setRegistration(PBHelper.convert(registrationResp)).build();
}
