{
  if (connectionRetryPolicy == null) {
    final int max=conf.getInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECT_MAX_RETRIES_KEY,CommonConfigurationKeysPublic.IPC_CLIENT_CONNECT_MAX_RETRIES_DEFAULT);
    connectionRetryPolicy=RetryPolicies.retryUpToMaximumCountWithFixedSleep(max,1,TimeUnit.SECONDS);
  }
  String remotePrincipal=getRemotePrincipal(conf,addr,protocol);
  boolean doPing=conf.getBoolean(CommonConfigurationKeys.IPC_CLIENT_PING_KEY,true);
  return new ConnectionId(addr,protocol,ticket,rpcTimeout,remotePrincipal,conf.getInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECTION_MAXIDLETIME_KEY,CommonConfigurationKeysPublic.IPC_CLIENT_CONNECTION_MAXIDLETIME_DEFAULT),connectionRetryPolicy,conf.getInt(CommonConfigurationKeysPublic.IPC_CLIENT_CONNECT_MAX_RETRIES_ON_SOCKET_TIMEOUTS_KEY,CommonConfigurationKeysPublic.IPC_CLIENT_CONNECT_MAX_RETRIES_ON_SOCKET_TIMEOUTS_DEFAULT),conf.getBoolean(CommonConfigurationKeysPublic.IPC_CLIENT_TCPNODELAY_KEY,CommonConfigurationKeysPublic.IPC_CLIENT_TCPNODELAY_DEFAULT),doPing,(doPing ? Client.getPingInterval(conf) : 0));
}
