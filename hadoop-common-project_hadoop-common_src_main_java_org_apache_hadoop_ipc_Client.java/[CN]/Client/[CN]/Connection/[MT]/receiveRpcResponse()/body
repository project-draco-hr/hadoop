{
  if (shouldCloseConnection.get()) {
    return;
  }
  touch();
  try {
    RpcResponseHeaderProto response=RpcResponseHeaderProto.parseDelimitedFrom(in);
    if (response == null) {
      throw new IOException("Response is null.");
    }
    int callId=response.getCallId();
    if (LOG.isDebugEnabled())     LOG.debug(getName() + " got value #" + callId);
    Call call=calls.get(callId);
    RpcStatusProto status=response.getStatus();
    if (status == RpcStatusProto.SUCCESS) {
      Writable value=ReflectionUtils.newInstance(valueClass,conf);
      value.readFields(in);
      call.setRpcResponse(value);
      calls.remove(callId);
    }
 else     if (status == RpcStatusProto.ERROR) {
      call.setException(new RemoteException(WritableUtils.readString(in),WritableUtils.readString(in)));
      calls.remove(callId);
    }
 else     if (status == RpcStatusProto.FATAL) {
      markClosed(new RemoteException(WritableUtils.readString(in),WritableUtils.readString(in)));
    }
  }
 catch (  IOException e) {
    markClosed(e);
  }
}
