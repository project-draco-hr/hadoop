{
  if (!running.get()) {
    throw new IOException("The client is stopped");
  }
  Connection connection;
  while (true) {
    try {
      connection=connections.get(remoteId,new Callable<Connection>(){
        @Override public Connection call() throws Exception {
          return new Connection(remoteId,serviceClass);
        }
      }
);
    }
 catch (    ExecutionException e) {
      Throwable cause=e.getCause();
      if (cause instanceof IOException) {
        throw (IOException)cause;
      }
 else {
        throw new IOException(cause);
      }
    }
    if (connection.addCall(call)) {
      break;
    }
 else {
      connections.invalidate(remoteId);
    }
  }
  connection.setupIOstreams(fallbackToSimpleAuth);
  return connection;
}
