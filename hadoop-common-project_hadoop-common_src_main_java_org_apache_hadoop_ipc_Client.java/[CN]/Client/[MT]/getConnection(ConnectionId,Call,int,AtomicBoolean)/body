{
  if (!running.get()) {
    throw new IOException("The client is stopped");
  }
  Connection connection;
  while (true) {
    connection=connections.get(remoteId);
    if (connection == null) {
      connection=new Connection(remoteId,serviceClass);
      Connection existing=connections.putIfAbsent(remoteId,connection);
      if (existing != null) {
        connection=existing;
      }
    }
    if (connection.addCall(call)) {
      break;
    }
 else {
      connections.remove(remoteId,connection);
    }
  }
  connection.setupIOstreams(fallbackToSimpleAuth);
  return connection;
}
