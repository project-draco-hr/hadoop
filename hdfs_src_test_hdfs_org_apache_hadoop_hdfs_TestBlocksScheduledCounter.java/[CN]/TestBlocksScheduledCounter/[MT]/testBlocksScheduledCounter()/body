{
  MiniDFSCluster cluster=new MiniDFSCluster.Builder(new HdfsConfiguration()).build();
  cluster.waitActive();
  FileSystem fs=cluster.getFileSystem();
  FSDataOutputStream out=fs.create(new Path("/testBlockScheduledCounter"));
  for (int i=0; i < 1024; i++) {
    out.write(i);
  }
  ((DFSOutputStream)(out.getWrappedStream())).hflush();
  ArrayList<DatanodeDescriptor> dnList=new ArrayList<DatanodeDescriptor>();
  cluster.getNamesystem().DFSNodesStatus(dnList,dnList);
  DatanodeDescriptor dn=dnList.get(0);
  assertEquals(1,dn.getBlocksScheduled());
  out.close();
  assertEquals(0,dn.getBlocksScheduled());
}
