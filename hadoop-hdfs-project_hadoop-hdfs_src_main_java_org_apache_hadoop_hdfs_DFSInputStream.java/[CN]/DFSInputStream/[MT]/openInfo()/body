{
  lastBlockBeingWrittenLength=fetchLocatedBlocksAndGetLastBlockLength();
  int retriesForLastBlockLength=3;
  while (retriesForLastBlockLength > 0) {
    if (lastBlockBeingWrittenLength == -1) {
      DFSClient.LOG.warn("Last block locations not available. " + "Datanodes might not have reported blocks completely." + " Will retry for " + retriesForLastBlockLength + " times");
      waitFor(4000);
      lastBlockBeingWrittenLength=fetchLocatedBlocksAndGetLastBlockLength();
    }
 else {
      break;
    }
    retriesForLastBlockLength--;
  }
  if (retriesForLastBlockLength == 0) {
    throw new IOException("Could not obtain the last block locations.");
  }
}
