{
  if (rmContainer == null) {
    rmContainer=new RMContainerImpl(container,getApplicationAttemptId(),node.getNodeID(),rmContext.getDispatcher().getEventHandler(),rmContext.getContainerAllocationExpirer());
    Resources.addTo(currentReservation,container.getResource());
    resetReReservations(priority);
  }
 else {
    addReReservation(priority);
  }
  rmContainer.handle(new RMContainerReservedEvent(container.getId(),container.getResource(),node.getNodeID(),priority));
  Map<NodeId,RMContainer> reservedContainers=this.reservedContainers.get(priority);
  if (reservedContainers == null) {
    reservedContainers=new HashMap<NodeId,RMContainer>();
    this.reservedContainers.put(priority,reservedContainers);
  }
  reservedContainers.put(node.getNodeID(),rmContainer);
  LOG.info("Application " + getApplicationId() + " reserved container "+ rmContainer+ " on node "+ node+ ", currently has "+ reservedContainers.size()+ " at priority "+ priority+ "; currentReservation "+ currentReservation.getMemory());
  return rmContainer;
}
