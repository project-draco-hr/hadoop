{
  if (isStopped) {
    return null;
  }
  if (getTotalRequiredResources(priority) <= 0) {
    return null;
  }
  RMContainer rmContainer=new RMContainerImpl(container,this.getApplicationAttemptId(),node.getNodeID(),appSchedulingInfo.getUser(),this.rmContext);
  newlyAllocatedContainers.add(rmContainer);
  liveContainers.put(container.getId(),rmContainer);
  List<ResourceRequest> resourceRequestList=appSchedulingInfo.allocate(type,node,priority,request,container);
  attemptResourceUsage.incUsed(node.getPartition(),container.getResource());
  ((RMContainerImpl)rmContainer).setResourceRequests(resourceRequestList);
  rmContainer.handle(new RMContainerEvent(container.getId(),RMContainerEventType.START));
  if (LOG.isDebugEnabled()) {
    LOG.debug("allocate: applicationAttemptId=" + container.getId().getApplicationAttemptId() + " container="+ container.getId()+ " host="+ container.getNodeId().getHost()+ " type="+ type);
  }
  RMAuditLogger.logSuccess(getUser(),AuditConstants.ALLOC_CONTAINER,"SchedulerApp",getApplicationId(),container.getId());
  return rmContainer;
}
