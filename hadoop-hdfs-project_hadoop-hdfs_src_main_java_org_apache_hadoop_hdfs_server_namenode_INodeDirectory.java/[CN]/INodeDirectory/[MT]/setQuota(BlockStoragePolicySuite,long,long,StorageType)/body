{
  DirectoryWithQuotaFeature quota=getDirectoryWithQuotaFeature();
  if (quota != null) {
    if (type != null) {
      quota.setQuota(ssQuota,type);
    }
 else {
      quota.setQuota(nsQuota,ssQuota);
    }
    if (!isQuotaSet() && !isRoot()) {
      removeFeature(quota);
    }
  }
 else {
    final QuotaCounts c=computeQuotaUsage(bsps);
    DirectoryWithQuotaFeature.Builder builder=new DirectoryWithQuotaFeature.Builder().nameSpaceQuota(nsQuota);
    if (type != null) {
      builder.typeQuota(type,ssQuota);
    }
 else {
      builder.storageSpaceQuota(ssQuota);
    }
    addDirectoryWithQuotaFeature(builder.build()).setSpaceConsumed(c);
  }
}
