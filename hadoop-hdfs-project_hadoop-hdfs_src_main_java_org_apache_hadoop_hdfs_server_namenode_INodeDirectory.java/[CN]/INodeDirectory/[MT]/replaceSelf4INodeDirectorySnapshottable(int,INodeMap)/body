{
  Preconditions.checkState(!(this instanceof INodeDirectorySnapshottable),"this is already an INodeDirectorySnapshottable, this=%s",this);
  final INodeDirectorySnapshottable s=new INodeDirectorySnapshottable(this);
  replaceSelf(s,inodeMap).getDirectoryWithSnapshotFeature().getDiffs().saveSelf2Snapshot(latestSnapshotId,s,this);
  return s;
}
