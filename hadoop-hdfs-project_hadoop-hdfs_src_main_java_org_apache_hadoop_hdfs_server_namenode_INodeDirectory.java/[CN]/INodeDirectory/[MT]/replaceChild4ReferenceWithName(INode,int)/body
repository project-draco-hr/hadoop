{
  Preconditions.checkArgument(latestSnapshotId != Snapshot.CURRENT_STATE_ID);
  if (oldChild instanceof INodeReference.WithName) {
    return (INodeReference.WithName)oldChild;
  }
  final INodeReference.WithCount withCount;
  if (oldChild.isReference()) {
    Preconditions.checkState(oldChild instanceof INodeReference.DstReference);
    withCount=(INodeReference.WithCount)oldChild.asReference().getReferredINode();
  }
 else {
    withCount=new INodeReference.WithCount(null,oldChild);
  }
  final INodeReference.WithName ref=new INodeReference.WithName(this,withCount,oldChild.getLocalNameBytes(),latestSnapshotId);
  replaceChild(oldChild,ref,null);
  return ref;
}
