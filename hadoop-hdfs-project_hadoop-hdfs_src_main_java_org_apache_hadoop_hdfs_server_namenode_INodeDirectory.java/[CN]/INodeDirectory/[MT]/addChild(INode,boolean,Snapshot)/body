{
  if (latestSnapshot != null) {
    final INodeDirectoryWithSnapshot dir=INodeDirectoryWithSnapshot.replaceDir(this,latestSnapshot);
    return dir.addChild(node,setModTime,latestSnapshot);
  }
  if (children == null) {
    children=new ArrayList<INode>(DEFAULT_FILES_PER_DIRECTORY);
  }
  final int low=searchChildren(node);
  if (low >= 0) {
    return false;
  }
  node.parent=this;
  children.add(-low - 1,node);
  if (setModTime) {
    updateModificationTime(node.getModificationTime());
  }
  if (node.getGroupName() == null) {
    node.setGroup(getGroupName());
  }
  return true;
}
