{
  DirectoryWithSnapshotFeature sf=getDirectoryWithSnapshotFeature();
  Preconditions.checkState(sf != null,"Directory does not have snapshot feature");
  boolean removeDeletedChild=sf.getDiffs().removeChild(ListType.DELETED,deletedChild);
  int sid=removeDeletedChild ? Snapshot.CURRENT_STATE_ID : latestSnapshotId;
  final boolean added=addChild(deletedChild,true,sid);
  if (added && !removeDeletedChild) {
    final Quota.Counts counts=deletedChild.computeQuotaUsage();
    addSpaceConsumed(counts.get(Quota.NAMESPACE),counts.get(Quota.DISKSPACE),false);
  }
}
