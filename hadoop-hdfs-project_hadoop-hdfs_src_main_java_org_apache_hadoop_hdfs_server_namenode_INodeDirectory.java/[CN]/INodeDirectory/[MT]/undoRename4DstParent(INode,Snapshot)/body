{
  DirectoryWithSnapshotFeature sf=getDirectoryWithSnapshotFeature();
  Preconditions.checkState(sf != null,"Directory does not have snapshot feature");
  boolean removeDeletedChild=sf.getDiffs().removeChild(ListType.DELETED,deletedChild);
  final boolean added=addChild(deletedChild,true,removeDeletedChild ? null : latestSnapshot);
  if (added && !removeDeletedChild) {
    final Quota.Counts counts=deletedChild.computeQuotaUsage();
    addSpaceConsumed(counts.get(Quota.NAMESPACE),counts.get(Quota.DISKSPACE),false);
  }
}
