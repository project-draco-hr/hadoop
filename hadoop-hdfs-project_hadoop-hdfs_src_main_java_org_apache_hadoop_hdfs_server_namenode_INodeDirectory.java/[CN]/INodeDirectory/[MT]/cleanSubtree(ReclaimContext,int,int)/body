{
  DirectoryWithSnapshotFeature sf=getDirectoryWithSnapshotFeature();
  if (sf != null) {
    sf.cleanDirectory(reclaimContext,this,snapshotId,priorSnapshotId);
  }
 else {
    if (priorSnapshotId == Snapshot.NO_SNAPSHOT_ID && snapshotId == Snapshot.CURRENT_STATE_ID) {
      destroyAndCollectBlocks(reclaimContext);
    }
 else {
      QuotaCounts old=reclaimContext.quotaDelta().getCountsCopy();
      cleanSubtreeRecursively(reclaimContext,snapshotId,priorSnapshotId,null);
      QuotaCounts current=reclaimContext.quotaDelta().getCountsCopy();
      current.subtract(old);
      if (isQuotaSet()) {
        reclaimContext.quotaDelta().addQuotaDirUpdate(this,current);
      }
    }
  }
}
