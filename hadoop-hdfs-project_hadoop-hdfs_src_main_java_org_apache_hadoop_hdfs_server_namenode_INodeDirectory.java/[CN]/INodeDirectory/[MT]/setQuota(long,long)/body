{
  DirectoryWithQuotaFeature quota=getDirectoryWithQuotaFeature();
  if (quota != null) {
    quota.setQuota(nsQuota,dsQuota);
    if (!isQuotaSet() && !isRoot()) {
      removeFeature(quota);
    }
  }
 else {
    final Quota.Counts c=computeQuotaUsage();
    quota=addDirectoryWithQuotaFeature(nsQuota,dsQuota);
    quota.setSpaceConsumed(c.get(Quota.NAMESPACE),c.get(Quota.DISKSPACE));
  }
}
