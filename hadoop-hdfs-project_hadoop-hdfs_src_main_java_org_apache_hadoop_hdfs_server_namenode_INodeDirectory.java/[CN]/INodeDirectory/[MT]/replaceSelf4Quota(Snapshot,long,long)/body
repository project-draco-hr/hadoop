{
  Preconditions.checkState(!(this instanceof INodeDirectoryWithQuota),"this is already an INodeDirectoryWithQuota, this=%s",this);
  if (latest == null) {
    final INodeDirectoryWithQuota q=new INodeDirectoryWithQuota(this,true,nsQuota,dsQuota);
    replaceSelf(q);
    return q;
  }
 else {
    final INodeDirectoryWithSnapshot s=INodeDirectoryWithSnapshot.newInstance(this,null);
    s.setQuota(nsQuota,dsQuota,null);
    replaceSelf(s);
    s.save2Snapshot(latest,this);
    return s;
  }
}
