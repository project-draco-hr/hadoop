{
  Preconditions.checkState(!(this instanceof INodeDirectoryWithQuota),"this is already an INodeDirectoryWithQuota, this=%s",this);
  if (latest == null) {
    final INodeDirectoryWithQuota q=new INodeDirectoryWithQuota(this,true,nsQuota,dsQuota);
    replaceSelf(q);
    return q;
  }
 else {
    final INodeDirectoryWithSnapshot s=new INodeDirectoryWithSnapshot(this);
    s.setQuota(nsQuota,dsQuota,null);
    return replaceSelf(s).saveSelf2Snapshot(latest,this);
  }
}
