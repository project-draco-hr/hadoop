{
  final INodeReference ref=getParentReference();
  if (ref != null) {
    ref.setReferredINode(newDir);
    if (inodeMap != null) {
      inodeMap.put(newDir);
    }
  }
 else {
    final INodeDirectory parent=getParent();
    Preconditions.checkArgument(parent != null,"parent is null, this=%s",this);
    parent.replaceChild(this,newDir,inodeMap);
  }
  clear();
  return newDir;
}
