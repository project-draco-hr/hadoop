{
  File prevDir=sd.getPreviousDir();
  if (!prevDir.exists()) {
    return;
  }
  File tmpDir=sd.getRemovedTmp();
  Preconditions.checkState(!tmpDir.exists(),"removed.tmp directory must not exist for rollback." + "Consider restarting for recovery.");
  File curDir=sd.getCurrentDir();
  Preconditions.checkState(curDir.exists(),"Current directory must exist for rollback.");
  NNStorage.rename(curDir,tmpDir);
  NNStorage.rename(prevDir,curDir);
  NNStorage.deleteDir(tmpDir);
  LOG.info("Rollback of " + sd.getRoot() + " is complete.");
}
