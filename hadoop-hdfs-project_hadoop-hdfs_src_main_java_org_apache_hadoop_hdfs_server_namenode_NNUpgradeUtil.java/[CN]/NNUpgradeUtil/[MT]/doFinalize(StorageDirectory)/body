{
  File prevDir=sd.getPreviousDir();
  if (!prevDir.exists()) {
    LOG.info("Directory " + prevDir + " does not exist.");
    LOG.info("Finalize upgrade for " + sd.getRoot() + " is not required.");
    return;
  }
  LOG.info("Finalizing upgrade of storage directory " + sd.getRoot());
  Preconditions.checkState(sd.getCurrentDir().exists(),"Current directory must exist.");
  final File tmpDir=sd.getFinalizedTmp();
  NNStorage.rename(prevDir,tmpDir);
  NNStorage.deleteDir(tmpDir);
  LOG.info("Finalize upgrade for " + sd.getRoot() + " is complete.");
}
