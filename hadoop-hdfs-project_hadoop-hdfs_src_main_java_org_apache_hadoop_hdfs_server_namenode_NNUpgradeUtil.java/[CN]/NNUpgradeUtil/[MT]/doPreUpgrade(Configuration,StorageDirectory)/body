{
  LOG.info("Starting upgrade of storage directory " + sd.getRoot());
  renameCurToTmp(sd);
  final Path curDir=sd.getCurrentDir().toPath();
  final Path tmpDir=sd.getPreviousTmp().toPath();
  Files.walkFileTree(tmpDir,Collections.<FileVisitOption>emptySet(),1,new SimpleFileVisitor<Path>(){
    @Override public FileVisitResult visitFile(    Path file,    BasicFileAttributes attrs) throws IOException {
      String name=file.getFileName().toString();
      if (Files.isRegularFile(file) && name.startsWith(NNStorage.NameNodeFile.EDITS.getName())) {
        Path newFile=curDir.resolve(name);
        Files.createLink(newFile,file);
      }
      return super.visitFile(file,attrs);
    }
  }
);
}
