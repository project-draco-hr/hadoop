{
  URL url=new URL("http://localhost:" + infoPort + "/blockScannerReport?listblocks");
  long lastWarnTime=Time.monotonicNow();
  if (newTime <= 0)   newTime=1L;
  long verificationTime=0;
  String block=DFSTestUtil.getFirstBlock(fs,file).getBlockName();
  long failtime=(timeout <= 0) ? Long.MAX_VALUE : Time.monotonicNow() + timeout;
  while (verificationTime < newTime) {
    if (failtime < Time.monotonicNow()) {
      throw new TimeoutException("failed to achieve block verification after " + timeout + " msec.  Current verification timestamp = "+ verificationTime+ ", requested verification time > "+ newTime);
    }
    String response=DFSTestUtil.urlGet(url);
    if (blocksValidated >= 0) {
      for (Matcher matcher=pattern_blockVerify.matcher(response); matcher.find(); ) {
        if (block.equals(matcher.group(1))) {
          assertEquals(1,blocksValidated);
          break;
        }
      }
    }
    for (Matcher matcher=pattern.matcher(response); matcher.find(); ) {
      if (block.equals(matcher.group(1))) {
        verificationTime=Long.parseLong(matcher.group(2));
        break;
      }
    }
    if (verificationTime < newTime) {
      long now=Time.monotonicNow();
      if ((now - lastWarnTime) >= 5 * 1000) {
        LOG.info("Waiting for verification of " + block);
        lastWarnTime=now;
      }
      try {
        Thread.sleep(500);
      }
 catch (      InterruptedException ignored) {
      }
    }
  }
  return verificationTime;
}
